import{y as Kt,v as Qt,b as we,a as v,d as ke,f as C,c as ce,s as oe,j as Se,t as Ae}from"./CvdcXPsy.js";import{s as ee,g as r,a as b,u as Ue,f as M,p as ge,t as H,e as pe,aA as $e,c as m,h as te,d as x,r as g,n as De,b as ze,aB as _t,aR as Wt,z as qt,bn as xt}from"./-h67YDCL.js";import{_ as Gt,i as Z}from"./DG6c9x1x.js";import{e as Qe,i as St}from"./DBJvd_ZN.js";import{c as ie}from"./C52XBfTo.js";import{a as Ke,p as mt}from"./DoDeW8UU.js";import{f as Te,a as de,s as ue,r as Jt,b as Ze}from"./vjiKTA8K.js";import{b as bt}from"./ByH5JKyU.js";import{p as O}from"./6dG0wjw8.js";import{N as Ie,H as Yt,d as ct,I as Ut,J as At,K as Xt,o as $t,L as Ct,M as er,n as re,c as tr,s as at,O as rr,e as or}from"./CAJmB2zv.js";import{r as Pt,c as wt,U as Ce}from"./Dk4THxss.js";import{t as he}from"./DqdFoxb9.js";import{u as ar}from"./Xqq2-EA3.js";import{c as dt,L as nr,I as Oe,R as sr}from"./BClDDyYv.js";import{D as Lt,a as Nt,R as Ot}from"./y2uKFtaO.js";import{B as He,I as ir}from"./B3t7n0XN.js";import{s as Dt}from"./0JHOh1sT.js";import{b as zt}from"./Bif2btQW.js";import{R as lr,a as Tt,E as Je}from"./sNEEs8rM.js";import{a as ur,D as cr}from"./BeHDsRkZ.js";import{T as nt}from"./C75qor0g.js";import{g as kt}from"./D1jhUNbu.js";import{c as dr}from"./BBFhD2Ph.js";class vr{blossom;#e=ee("idle");#t=ee(null);#r=ee(null);#o=ee(null);constructor(e){this.blossom=e}get status(){return r(this.#e)}get progress(){return r(this.#t)}get result(){return r(this.#r)}get error(){return r(this.#o)}get state(){return{status:r(this.#e),progress:r(this.#t),result:r(this.#r),error:r(this.#o)}}async upload(e,t){b(this.#e,"uploading"),b(this.#t,{loaded:0,total:e.size,percentage:0},!0),b(this.#r,null),b(this.#o,null);try{const o={...t,onProgress:s=>{const n=Math.round(s.loaded/s.total*100);return b(this.#t,{loaded:s.loaded,total:s.total,percentage:n},!0),"continue"}},a=await this.blossom.upload(e,o);return b(this.#e,"success"),b(this.#r,a,!0),a}catch(o){throw b(this.#e,"error"),b(this.#o,o instanceof Error?o:new Error(String(o)),!0),o}}reset(){b(this.#e,"idle"),b(this.#t,null),b(this.#r,null),b(this.#o,null)}}function fr(c){return new vr(c)}class hr{#e;#t;constructor(e,t){this.#e=e,this.#t=Kt(t)}get current(){return this.#t(),this.#e()}}const gr=/\(.+\)/,pr=new Set(["all","print","screen","and","or","not","only"]);class mr extends hr{constructor(e,t){let o=gr.test(e)||e.split(/[\s,]+/).some(s=>pr.has(s.trim()))?e:`(${e})`;const a=window.matchMedia(o);super(()=>a.matches,s=>Qt(a,"change",s))}}function br(c,e){const t=Pt(e);let o=ee(null);Ue(()=>{const{event:n}=c();if(!n?.id){b(o,null);return}b(o,t.$subscribe(()=>({filters:[{kinds:[Ie.Text,Ie.GenericReply],...n.filter()}],closeOnEose:!1})),!0)});const a=M(()=>{const n=r(o);if(!n)return{count:0,hasReplied:!1,pubkeys:[]};const{event:f}=c();if(!f?.id)return{count:0,hasReplied:!1,pubkeys:[]};const i=Array.from(n.events).filter(l=>Yt(f,l)),u=i.map(l=>l.pubkey);return{count:i.length,hasReplied:t.$currentPubkey?i.some(l=>l.pubkey===t.$currentPubkey):!1,pubkeys:u}});async function s(n){const{event:f}=c();if(!f?.id)throw new Error("No event to reply to");if(!t.$currentPubkey)throw new Error("User must be logged in to reply");const i=f.reply();return i.content=n,await i.publish(),i}return{get count(){return r(a).count},get hasReplied(){return r(a).hasReplied},get pubkeys(){return r(a).pubkeys},reply:s}}var yr=we('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>');function _r(c,e){ge(e,!0);let t=O(e,"size",3,20),o=O(e,"class",3,"");var a=yr();H(s=>{de(a,"width",t()),de(a,"height",t()),ue(a,0,s)},[()=>Te(wt("",o()))]),v(c,a),pe()}function wr(c,e){const t=Pt(e);let o=ee(null);Ue(()=>{const{event:f}=c();if(!f?.id){b(o,null);return}b(o,t.$subscribe(()=>({filters:[{kinds:[Ie.Repost,Ie.GenericRepost],...f.filter()},{"#q":[f.tagId()]}],closeOnEose:!1})),!0)});const a=M(()=>{const f=r(o);if(!f)return{count:0,hasReposted:!1,pubkeys:[]};const i=f.events;if(!i)return{count:0,hasReposted:!1,pubkeys:[]};let u;const l=new Set;for(const d of i)l.add(d.pubkey),t.$currentPubkey&&d.pubkey===t.$currentPubkey&&(u=d);const p=!!u;return{count:l.size,hasReposted:p,pubkeys:Array.from(l),userRepost:u}});async function s(){const{event:f}=c();if(!f?.id)throw new Error("No event to repost");if(!t.$currentPubkey)throw new Error("User must be logged in to repost");return r(a).hasReposted&&r(a).userRepost?(await r(a).userRepost.delete(),r(a).userRepost):await f.repost(!0)}async function n(f){const{event:i}=c();if(!i?.id)throw new Error("No event to quote");if(!t.$currentPubkey)throw new Error("User must be logged in to quote");const u=new ct(e,{kind:Ie.Text,content:f});return u.tag(i,void 0,!1,"q"),await u.publish(),u}return{get count(){return r(a).count},get hasReposted(){return r(a).hasReposted},get pubkeys(){return r(a).pubkeys},repost:s,quote:n}}var xr=we('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M16.3884 3L17.3913 3.97574C17.8393 4.41165 18.0633 4.62961 17.9844 4.81481C17.9056 5 17.5888 5 16.9552 5H9.19422C5.22096 5 2 8.13401 2 12C2 13.4872 2.47668 14.8662 3.2895 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7.61156 21L6.60875 20.0243C6.16074 19.5883 5.93673 19.3704 6.01557 19.1852C6.09441 19 6.4112 19 7.04478 19H14.8058C18.779 19 22 15.866 22 12C22 10.5128 21.5233 9.13383 20.7105 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>');function kr(c,e){let t=O(e,"class",3,""),o=O(e,"size",3,18);var a=xr();H(()=>{de(a,"width",o()),de(a,"height",o()),ue(a,0,Te(t()))}),v(c,a)}function Er(c,e){const t=e||$e("ndk");let o=ee(null),a=ee(0),s=ee(!1);Ue(()=>{const{target:u}=c();if(!u){b(o,null);return}b(o,t.$subscribe(()=>({filters:[{kinds:[Ie.Zap],...u.filter()}],closeOnEose:!1})),!0)});const n=M(()=>{const u=r(o);if(!u)return{count:r(s)?1:0,totalAmount:r(a),hasZapped:r(s)};const l=Array.from(u.events),p=l.map(At).filter(Boolean),d=p.reduce((k,_)=>k+(_?.amount||0),0),h=t.$currentPubkey?p.some(k=>k?.zapper===t.$currentPubkey):!1;return{count:l.length+(r(s)?1:0),totalAmount:Math.floor(d/1e3)+r(a),hasZapped:h||r(s)}});async function f(u,l){const{target:p}=c();if(!p)throw new Error("No target to zap");if(!t.$currentPubkey)throw new Error("User must be logged in to zap");b(a,u,!0),b(s,!0);try{await new Ut(p,u*1e3,"msat",{comment:l}).zap(),setTimeout(()=>{b(a,0),b(s,!1)},3e3)}catch(d){throw b(a,0),b(s,!1),d}}const i=M(()=>r(o)?Array.from(r(o).events):[]);return{get count(){return r(n).count},get totalAmount(){return r(n).totalAmount},get hasZapped(){return r(n).hasZapped},get events(){return r(i)},zap:f}}var Rr=we('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14H12L11 22L21 10H12L13 2Z"></path></svg>');function Sr(c,e){ge(e,!0);let t=O(e,"size",3,18),o=O(e,"filled",3,!1),a=O(e,"class",3,"");var s=Rr();H(n=>{de(s,"width",t()),de(s,"height",t()),de(s,"fill",o()?"currentColor":"none"),ue(s,0,n)},[()=>Te(wt("",a()))]),v(c,s),pe()}const ye={SERVER_UNAVAILABLE:"SERVER_UNAVAILABLE",SERVER_ERROR:"SERVER_ERROR",SERVER_REJECTED:"SERVER_REJECTED",SERVER_TIMEOUT:"SERVER_TIMEOUT",SERVER_LIST_EMPTY:"SERVER_LIST_EMPTY",SERVER_INVALID_RESPONSE:"SERVER_INVALID_RESPONSE",NO_SIGNER:"NO_SIGNER",AUTH_REQUIRED:"AUTH_REQUIRED",AUTH_INVALID:"AUTH_INVALID",AUTH_EXPIRED:"AUTH_EXPIRED",AUTH_REJECTED:"AUTH_REJECTED",UPLOAD_TOO_LARGE:"UPLOAD_TOO_LARGE",UPLOAD_INVALID_TYPE:"UPLOAD_INVALID_TYPE",UPLOAD_FAILED:"UPLOAD_FAILED",ALL_SERVERS_FAILED:"ALL_SERVERS_FAILED",BLOB_NOT_FOUND:"BLOB_NOT_FOUND",USER_SERVER_LIST_NOT_FOUND:"USER_SERVER_LIST_NOT_FOUND",SERVER_UNSUPPORTED:"SERVER_UNSUPPORTED",FORMAT_UNSUPPORTED:"FORMAT_UNSUPPORTED",NO_SHA256_CALCULATOR:"NO_SHA256_CALCULATOR"},Ur=24242,Ft={maxRetries:3,retryDelay:1e3,backoffFactor:1.5,retryableStatusCodes:[408,429,500,502,503,504]},Ar={Accept:"application/json"},Cr="ndk:blossom",Pr=[500,501,502,503,504,505];class et extends Error{constructor(e,t,o,a){super(e),this.name="NDKBlossomError",this.code=t,this.serverUrl=o,this.cause=a}}class Xe extends et{constructor(e,t,o,a){super(e,t,o,a),this.name="NDKBlossomUploadError"}}class Re extends et{constructor(e,t,o,a,s){super(e,t,o,s),this.name="NDKBlossomServerError",this.status=a}}class st extends et{constructor(e,t,o,a){super(e,t,o,a),this.name="NDKBlossomAuthError"}}class ot extends et{constructor(e,t,o,a){super(e,t,o,a),this.name="NDKBlossomNotFoundError"}}class rt extends et{constructor(e,t,o,a){super(e,t,o,a),this.name="NDKBlossomOptimizationError"}}class lt{constructor(e=Cr){this.debugger=Xt(e)}error(e,t){this.log("error",e,t)}warn(e,t){this.log("warn",e,t)}info(e,t){this.log("info",e,t)}debug(e,t){this.log("debug",e,t)}log(e,t,o){const a=`[${e.toUpperCase()}] ${t}`;o!==void 0?this.debugger(a,o):this.debugger(a)}}class Lr{constructor(e){this.logFunction=e}error(e,t){this.logFunction("error",e,t)}warn(e,t){this.logFunction("warn",e,t)}info(e,t){this.logFunction("info",e,t)}debug(e,t){this.logFunction("debug",e,t)}}const Nr=new lt("ndk:blossom:auth");async function It(c,e,t={}){try{const o=new ct(c);o.kind=Ur,o.created_at=Math.floor(Date.now()/1e3),o.content=t.content||`${e.charAt(0).toUpperCase()+e.slice(1)} blob`;const a=[["t",e]];t.sha256&&(Array.isArray(t.sha256)?t.sha256:[t.sha256]).forEach(u=>{a.push(["x",u])});const s=t.expirationSeconds||3600,n=Math.floor(Date.now()/1e3)+s;a.push(["expiration",n.toString()]),o.tags=a;const f=t.signer??c.signer;return await o.sign(f),Nr.debug(`Created Blossom auth event for action: ${e}`),o}catch(o){throw o instanceof st?o:new st(`Failed to create auth event: ${o.message}`,ye.AUTH_REQUIRED,void 0,o)}}function Mt(c,e){const t=JSON.stringify(e.rawEvent()),o=btoa(t);return{...c,Authorization:`Nostr ${o}`}}async function Bt(c,e,t={}){const o=await It(c,e,{sha256:t.sha256,content:t.content,expirationSeconds:t.expirationSeconds,signer:t.signer}),a=Mt(t.fetchOptions?.headers||{},o);return{...t.fetchOptions||{},headers:a}}const Or=Object.freeze(Object.defineProperty({__proto__:null,addAuthHeaders:Mt,createAuthEvent:It,createAuthenticatedFetchOptions:Bt},Symbol.toStringTag,{value:"Module"})),Dr=new lt;async function Ye(c,e={},t={},o=Dr){const a={...Ft,...t},s={...Ar,...e.headers||{}};let n=0;const f=()=>a.retryDelay*a.backoffFactor**n;for(;n<=a.maxRetries;)try{const i=await fetch(c,{...e,headers:s});if(!i.ok&&a.retryableStatusCodes.includes(i.status)&&n<a.maxRetries){n++;const u=f();o.warn(`Request failed with status ${i.status}, retrying in ${u}ms (attempt ${n}/${a.maxRetries})`,{url:c}),await new Promise(l=>setTimeout(l,u));continue}return i}catch(i){if(n<a.maxRetries){n++;const u=f();o.warn(`Network error, retrying in ${u}ms (attempt ${n}/${a.maxRetries})`,{url:c,error:i}),await new Promise(l=>setTimeout(l,u))}else throw new Re(`Network request failed after ${a.maxRetries} retries: ${i.message}`,ye.SERVER_UNAVAILABLE,c,void 0,i)}throw new Re(`Request failed after ${a.maxRetries} retries`,ye.SERVER_UNAVAILABLE,c)}async function zr(c,e={},t={}){try{return(await Ye(c,{...e,method:"HEAD"},t)).ok}catch{return!1}}async function it(c,e,t={}){const a=`${c.endsWith("/")?c.slice(0,-1):c}/${e}`;return zr(a,{method:"HEAD"},t)}async function Tr(c,e){if(!c.ok)throw Pr.includes(c.status)?new Re(`Server error: ${c.status} ${c.statusText}`,ye.SERVER_ERROR,e,c.status):new Re(`Request rejected: ${c.status} ${c.statusText}`,ye.SERVER_REJECTED,e,c.status);try{return await c.json()}catch(t){throw new Re(`Invalid JSON response: ${t.message}`,ye.SERVER_INVALID_RESPONSE,e,c.status,t)}}const _e=new lt("ndk:blossom:uploader");async function ut(c,e,t,o={}){if(_e.debug(`Uploading file to ${t}`,{fileName:e.name,fileType:e.type,fileSize:e.size}),!o.sha256Calculator)throw new Xe("SHA256Calculator is required for upload. Please provide one in options.","NO_SHA256_CALCULATOR",t);const s=await o.sha256Calculator.calculateSha256(e);_e.debug(`File hash: ${s}`);try{const n=t.endsWith("/")?t.slice(0,-1):t,f=`${n}/upload`,i=await Bt(c,"upload",{sha256:s,content:`Upload ${e.name}`,signer:o.signer,fetchOptions:{method:"PUT",body:e,headers:{"Content-Type":e.type||"application/octet-stream",...o.headers}}});if(o.onProgress){const p=i.body;if(p instanceof File||p instanceof Blob){const d=new XMLHttpRequest;return await new Promise((k,_)=>{d.upload.addEventListener("progress",P=>{P.lengthComputable&&o.onProgress?.({loaded:P.loaded,total:P.total})}),d.addEventListener("load",()=>{if(d.status>=200&&d.status<300)try{const P=JSON.parse(d.responseText);k(P)}catch(P){_(new Re(`Invalid response from server: ${P.message}`,ye.SERVER_INVALID_RESPONSE,t,d.status,P))}else _(new Re(`Upload failed with status ${d.status}`,ye.SERVER_REJECTED,t,d.status))}),d.addEventListener("error",()=>{_(new Re("Network error during upload",ye.SERVER_UNAVAILABLE,t))}),d.addEventListener("abort",()=>{_(new Re("Upload aborted",ye.UPLOAD_FAILED,t))}),d.open("PUT",f);for(const[P,U]of Object.entries(i.headers||{}))d.setRequestHeader(P,U);d.send(p)})}}const u=await Ye(f,i,{maxRetries:o.maxRetries,retryDelay:o.retryDelay});return await Tr(u,t),{url:`${n}/${s}`,size:e.size.toString(),m:e.type,x:s}}catch(n){throw n instanceof Re||n instanceof st?n:new Xe(`Upload failed: ${n.message}`,ye.UPLOAD_FAILED,t,n)}}async function Fr(c,e,t={}){if(_e.debug("Starting file upload",{fileName:e.name,fileType:e.type,fileSize:e.size}),_e.debug("Upload options:",{hasServer:!!t.server,hasFallbackServer:!!t.fallbackServer,fallbackServer:t.fallbackServer,allOptions:t}),t.server)try{const i=await ut(c.ndk,e,t.server,t);return _e.debug(`Upload successful to specified server ${t.server}`),i}catch(i){throw _e.error(`Upload to specified server ${t.server} failed:`,i),new Xe(`Upload failed on specified server: ${t.server}: ${i.message}`,ye.UPLOAD_FAILED)}const o=await c.getServerList();let a=[];o&&Array.isArray(o.servers)&&(a=o.servers);const s=[];for(const i of a)try{const u=await ut(c.ndk,e,i,t);return _e.debug(`Upload successful to ${i}`),u}catch(u){if(_e.error(`Upload to ${i} failed:`,u),s.push({serverUrl:i,error:u}),t.onServerError&&u instanceof Re&&t.onServerError(u,i)==="retry")try{const p=await ut(c.ndk,e,i,t);return _e.debug(`Retry upload successful to ${i}`),p}catch(p){_e.error(`Retry upload to ${i} failed:`,p),s.push({serverUrl:i,error:p})}}if(t.fallbackServer)try{const i=await ut(c.ndk,e,t.fallbackServer,t);return _e.debug(`Upload successful to fallback server ${t.fallbackServer}`),i}catch(i){_e.error(`Upload to fallback server ${t.fallbackServer} failed:`,i),s.push({serverUrl:t.fallbackServer,error:i})}const n=s.map(i=>{const u=i.error;let l=`${i.serverUrl}: ${u.message}`;return u instanceof Re?(l+=` (status: ${u.status}, code: ${u.code})`,u.cause&&(l+=` - ${u.cause.message}`)):u instanceof st?l+=` (auth error, code: ${u.code})`:u instanceof Xe&&(l+=` (code: ${u.code})`,u.cause&&(l+=` - cause: ${u.cause.message}`)),l}),f=a.length===0?`No blossom servers configured. Please add servers to your profile or provide a fallbackServer. ${t.fallbackServer?`Fallback server also failed: ${n[0]||"unknown error"}`:""}`:`Upload failed on all ${a.length} configured server(s)${t.fallbackServer?" and fallback server":""}:
${n.join(`
`)}`;throw _e.error(f),new Xe(f,ye.ALL_SERVERS_FAILED)}async function vt(c,e){_e.debug(`Searching for hash ${e} in nostr events`);const t={"#x":[e],limit:10};try{const o=await c.fetchEvents(t);if(o.size===0)return[];const a=new Set;for(const s of o)for(const n of s.tags){if(n[0]==="imeta"){const f=$t(n);f.url&&f.x===e&&a.add(f.url)}n[0]==="url"&&n[1]&&jt(n[1])===e&&a.add(n[1])}return Array.from(a)}catch(o){return _e.error("Error searching for hash in nostr:",o),[]}}const be=new lt("ndk:blossom:url-healing");function jt(c){try{const o=new URL(c).pathname.split("/"),a=o[o.length-1],s=a.includes(".")?a.split(".")[0]:a;return/^[a-f0-9]{64}$/i.test(s)?s:void 0}catch(e){be.error(`Error extracting hash from URL ${c}:`,e);return}}async function ft(c,e){if(c.length===0)return;const t=e?c.filter(o=>o!==e):c;if(t.length!==0){for(const o of t)try{if(await it(o,""))return be.debug(`Found working URL: ${o}`),o}catch(a){be.debug(`URL check failed for ${o}:`,a)}return be.debug(`No working URLs found, returning first URL: ${t[0]}`),t[0]}}async function Ir(c,e,t){be.debug(`Fixing URL: ${t}`);const o=jt(t);if(!o)return be.debug(`Invalid URL, no hash found: ${t}`),t;try{if(await it(t,""))return be.debug(`Original URL works, no need to fix: ${t}`),t}catch(a){be.debug(`Original URL check failed: ${a}`)}try{const a={kinds:[Ie.BlossomList],authors:[e.pubkey]},s=await c.fetchEvent(a);let n=[];if(s&&(n=Ct(s).servers),n.length===0){be.debug(`No servers found for user ${e.pubkey}`);const u=await vt(c,o),l=await ft(u,t);return l||t}for(const u of n)try{const p=`${u.endsWith("/")?u.slice(0,-1):u}/${o}`;if(await it(u,o))return be.debug(`Found alternative server: ${p}`),p}catch(l){be.debug(`Server check failed for ${u}:`,l)}const f=await vt(c,o),i=await ft(f,t);return i||(be.debug(`Could not fix URL: ${t}`),t)}catch(a){return be.debug(`Error fixing URL: ${a}`),t}}async function Mr(c,e,t){be.debug(`Getting blob URL for hash: ${t}`);try{const o={kinds:[Ie.BlossomList],authors:[e.pubkey]},a=await c.fetchEvent(o);let s=[];if(a&&(s=a.tags.filter(n=>n[0]==="server"&&n[1]).map(n=>n[1])),s.length===0){be.debug(`No servers found for user ${e.pubkey}`);const n=await vt(c,t),f=await ft(n);if(f)return f;throw new ot(`No servers found for user ${e.pubkey}`,ye.USER_SERVER_LIST_NOT_FOUND)}for(const n of s)try{const i=`${n.endsWith("/")?n.slice(0,-1):n}/${t}`;if(await it(n,t))return be.debug(`Found blob on server: ${i}`),i}catch(f){be.debug(`Server check failed for ${n}:`,f)}throw new ot(`Blob with hash ${t} not found on any of user's servers`,ye.BLOB_NOT_FOUND)}catch(o){if(o instanceof ot)throw o;const a=await vt(c,t),s=await ft(a);if(s)return s;throw new ot(`Failed to get blob URL: ${o.message}`,ye.BLOB_NOT_FOUND,void 0,o)}}class Br{async calculateSha256(e){const t=await e.arrayBuffer(),o=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map(a=>a.toString(16).padStart(2,"0")).join("")}}let pt;function jr(){return pt||(pt=new Br),pt}const Vr={calculateSha256:async c=>jr().calculateSha256(c)};class Hr{constructor(e,t){this.serverConfigs=new Map,this.debugMode=!1,this.ndk=e,this.signer=t,this.retryOptions=Ft,this.logger=new lt,this.sha256Calculator=Vr}set debug(e){this.debugMode=e}get debug(){return this.debugMode}set loggerFunction(e){this.logger=new Lr(e)}setSHA256Calculator(e){this.sha256Calculator=e}getSHA256Calculator(){return this.sha256Calculator}set serverList(e){this._serverList=e}async getServerList(e){if(this._serverList)return this.logger.debug(`Using cached server list with ${this._serverList.servers.length} servers`),this._serverList;if(e??(e=this.ndk.activeUser),!e)throw this.logger.error("No user available to fetch server list"),new et("No user available to fetch server list","NO_SIGNER");this.logger.debug(`Fetching server list for user ${e.pubkey}`);const t={kinds:er.kinds,authors:[e.pubkey]},o=await this.ndk.fetchEvent(t);if(!o){this.logger.warn(`No blossom server list event found for user ${e.pubkey}`);return}return this._serverList=Ct(o),this.logger.debug(`Found server list with ${this._serverList.servers.length} servers: ${this._serverList.servers.join(", ")}`),this._serverList}async upload(e,t={}){try{return this.onUploadProgress&&(t.onProgress=a=>this.onUploadProgress?this.onUploadProgress(a,e,"unknown"):"continue"),t.sha256Calculator||(t.sha256Calculator=this.getSHA256Calculator()),t.signer||(t.signer=this.signer),await Fr(this,e,t)}catch(o){throw this.onUploadFailed&&o instanceof Error&&this.onUploadFailed(o.message,o instanceof Xe?o.serverUrl:void 0,e),o}}async fixUrl(e,t){return Ir(this.ndk,e,t)}async getBlob(e){try{return await Ye(e,{},this.retryOptions)}catch(t){throw new ot(`Failed to fetch blob: ${t.message}`,"BLOB_NOT_FOUND",e,t)}}async getBlobByHash(e,t){const o=await Mr(this.ndk,e,t);return this.getBlob(o)}async listBlobs(e){const t=await this.getServerList();let o=[];if(t&&(o=t.servers),o.length===0)return this.logger.error(`No servers found for user ${e.pubkey}`),[];const a=new Map;for(const s of o)try{const f=`${s.endsWith("/")?s.slice(0,-1):s}/list/${e.pubkey}`,i=await Ye(f,{},this.retryOptions);if(!i.ok)continue;const u=await i.json();if(Array.isArray(u))for(const l of u){const p={url:l.url,size:l.size?.toString(),m:l.mime_type,x:l.sha256,dim:l.width&&l.height?`${l.width}x${l.height}`:void 0,blurhash:l.blurhash,alt:l.alt};l.sha256&&a.set(l.sha256,p)}}catch(n){this.logger.error(`Error listing blobs on server ${s}:`,n)}return Array.from(a.values())}async deleteBlob(e){const t=this.signer??this.ndk.signer;if(!t)throw new st("No signer available to delete blob","NO_SIGNER");const o=(await t.user()).pubkey,a={kinds:[Ie.BlossomList],authors:[o]},s=await this.ndk.fetchEvent(a);let n=[];if(s&&(n=s.tags.filter(i=>i[0]==="server"&&i[1]).map(i=>i[1])),n.length===0)return this.logger.error(`No servers found for user ${o}`),!1;let f=!1;for(const i of n)try{const l=`${i.endsWith("/")?i.slice(0,-1):i}/${e}`,p=await Zr(this.ndk,"delete",{sha256:e,content:`Delete blob ${e}`,signer:t,fetchOptions:{method:"DELETE"}});(await Ye(l,p,this.retryOptions)).ok&&(f=!0)}catch(u){this.logger.error(`Error deleting blob on server ${i}:`,u)}return f}async checkServerForBlob(e,t){return it(e,t)}setRetryOptions(e){this.retryOptions={...this.retryOptions,...e}}setServerConfig(e,t){this.serverConfigs.set(e,t)}async getOptimizedBlob(e,t={}){try{const o=new URL(e),a=`${o.protocol}//${o.host}`,s=o.pathname.split("/").pop();if(!s)throw new rt("Invalid URL, no hash found","BLOB_NOT_FOUND",e);let n=`${a}/media/${s}`;const f=new URLSearchParams;for(const[u,l]of Object.entries(t))l!==void 0&&f.append(u,l.toString());f.toString()&&(n+=`?${f.toString()}`);const i=await Ye(n,{},this.retryOptions);if(!i.ok)throw new rt(`Failed to get optimized blob: ${i.status} ${i.statusText}`,"SERVER_REJECTED",e);return i}catch(o){throw o instanceof rt?o:new rt(`Failed to get optimized blob: ${o.message}`,"SERVER_UNSUPPORTED",e,o)}}async getOptimizedUrl(e,t={}){const o=new URL(e),a=`${o.protocol}//${o.host}`,s=o.pathname.split("/").pop();if(!s)throw new rt("Invalid URL, no hash found","BLOB_NOT_FOUND",e);let n=`${a}/media/${s}`;const f=new URLSearchParams;for(const[i,u]of Object.entries(t))u!==void 0&&f.append(i,u.toString());return f.toString()&&(n+=`?${f.toString()}`),n}generateSrcset(e,t){const o=[],a=new URL(e),s=`${a.protocol}//${a.host}`,n=a.pathname.split("/").pop();if(!n)return"";for(const f of t){const i=new URLSearchParams;i.append("width",f.width.toString()),f.format&&i.append("format",f.format);const u=`${s}/media/${n}?${i.toString()}`;o.push(`${u} ${f.width}w`)}return o.join(", ")}}async function Zr(c,e,t={}){const{createAuthenticatedFetchOptions:o}=await Gt(async()=>{const{createAuthenticatedFetchOptions:a}=await Promise.resolve().then(()=>Or);return{createAuthenticatedFetchOptions:a}},void 0,import.meta.url);return o(c,e,t)}var Kr=C('<button type="button" class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 hover:bg-primary/30 text-foreground rounded-full text-xs transition-colors"><!> <span class="max-w-[100px] truncate"> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>');function Qr(c,e){ge(e,!0);let t=ee(null);Ue(()=>{re.fetchUser(e.pubkey).then(i=>{i?.fetchProfile().then(u=>{b(t,u,!0)})})});const o=M(()=>r(t)?.displayName||r(t)?.name||`${e.pubkey.slice(0,8)}...`);var a=Kr();a.__click=()=>e.onRemove(e.pubkey);var s=m(a);ie(s,()=>Ce.Root,(i,u)=>{u(i,{get ndk(){return re},get pubkey(){return e.pubkey},children:(l,p)=>{var d=ce(),h=te(d);ie(h,()=>Ce.Avatar,(k,_)=>{_(k,{class:"w-3.5 h-3.5 flex-shrink-0"})}),v(l,d)},$$slots:{default:!0}})});var n=x(s,2),f=m(n,!0);g(n),De(2),g(a),H(()=>oe(f,r(o))),v(c,a),pe()}ke(["click"]);var Wr=C('<div class="text-xs text-muted-foreground truncate"> </div>'),qr=we('<svg class="w-3 h-3 text-primary-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),Gr=C("<div><!></div>"),Jr=C('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div> <!></button>');function Yr(c,e){ge(e,!0);let t=ee(null);Ue(()=>{re.fetchUser(e.pubkey).then(h=>{h?.fetchProfile().then(k=>{b(t,k,!0)})})});const o=M(()=>r(t)?.displayName||r(t)?.name||`${e.pubkey.slice(0,8)}...`);var a=Jr();a.__click=()=>e.onToggle(e.pubkey);var s=m(a);ie(s,()=>Ce.Root,(h,k)=>{k(h,{get ndk(){return re},get pubkey(){return e.pubkey},children:(_,P)=>{var U=ce(),E=te(U);ie(E,()=>Ce.Avatar,(I,j)=>{j(I,{class:"flex-shrink-0"})}),v(_,U)},$$slots:{default:!0}})});var n=x(s,2),f=m(n),i=m(f,!0);g(f);var u=x(f,2);{var l=h=>{var k=Wr(),_=m(k,!0);g(k),H(()=>oe(_,r(t).nip05)),v(h,k)};Z(u,h=>{r(t)?.nip05&&h(l)})}g(n);var p=x(n,2);{var d=h=>{var k=Gr(),_=m(k);{var P=U=>{var E=qr();v(U,E)};Z(_,U=>{e.isSelected&&U(P)})}g(k),H(()=>ue(k,1,`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${e.isSelected?"bg-primary border-primary":"border-border"}`)),v(h,k)};Z(p,h=>{e.showCheckbox&&h(d)})}g(a),H(()=>{ue(a,1,`w-full flex items-center gap-2 p-2 rounded-md transition-colors ${e.isSelected?"bg-primary/20":"hover:bg-muted"}`),oe(i,r(o))}),v(c,a),pe()}ke(["click"]);var Xr=C('<button type="button" class="absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-xs font-medium transition-colors">Add</button>'),$r=C('<p class="text-xs text-muted-foreground mt-1.5">Search follows or paste npub/hex/NIP-05</p>'),eo=C('<div class="px-3 py-2 border-b border-border bg-muted/30"><div class="text-xs font-medium text-muted-foreground mb-2"> </div> <div class="flex flex-wrap gap-1.5"></div></div>'),to=C('<div class="text-center py-8 px-3 text-muted-foreground text-sm"> </div>'),ro=C('<div class="p-2 space-y-1"></div>'),oo=C('<div class="flex flex-col max-h-[400px]"><div class="p-3 border-b border-border"><h3 class="font-semibold text-sm mb-2">Tag people</h3> <div class="relative"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search or paste npub/identifier..." class="w-full pl-8 pr-16 py-2 bg-muted border border-border rounded-lg text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <!></div> <!></div> <!> <div class="overflow-y-auto flex-1"><!></div></div>');function Et(c,e){ge(e,!0);let t=O(e,"searchQuery",15);var o=oo(),a=m(o),s=x(m(a),2),n=x(m(s),2);Jt(n),n.__keydown=U=>{U.key==="Enter"&&e.isIdentifierInput&&e.onAddByIdentifier()};var f=x(n,2);{var i=U=>{var E=Xr();E.__click=function(...I){e.onAddByIdentifier?.apply(this,I)},v(U,E)};Z(f,U=>{e.isIdentifierInput&&U(i)})}g(s);var u=x(s,2);{var l=U=>{var E=$r();v(U,E)};Z(u,U=>{t()||U(l)})}g(a);var p=x(a,2);{var d=U=>{var E=eo(),I=m(E),j=m(I);g(I);var T=x(I,2);Qe(T,20,()=>e.selectedPubkeys,K=>K,(K,W)=>{Qr(K,{get pubkey(){return W},get onRemove(){return e.onRemoveUser}})}),g(T),g(E),H(()=>oe(j,`Selected (${e.selectedPubkeys.length??""})`)),v(U,E)};Z(p,U=>{e.selectedPubkeys.length>0&&U(d)})}var h=x(p,2),k=m(h);{var _=U=>{var E=to(),I=m(E,!0);g(E),H(()=>oe(I,t()?"No matches found":"You don't follow anyone yet")),v(U,E)},P=U=>{var E=ro();Qe(E,20,()=>e.filteredFollows,I=>I,(I,j)=>{{let T=M(()=>e.selectedPubkeys.includes(j));Yr(I,{get pubkey(){return j},get isSelected(){return r(T)},get showCheckbox(){return e.multiple},get onToggle(){return e.onToggleUser}})}}),g(E),v(U,E)};Z(k,U=>{e.filteredFollows.length===0?U(_):U(P,!1)})}g(h),g(o),zt(n,t),v(c,o),pe()}ke(["keydown","click"]);var ao=C('<span class="ml-auto text-xs bg-primary/20 text-primary rounded-full px-2 py-0.5"> </span>'),no=C('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <span> </span> <!>',1),so=C('<span class="absolute -top-1 -right-1 text-[10px] bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center"> </span>'),io=we('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><!>',1),lo=C('<div role="presentation" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"><div role="dialog" tabindex="-1" style="width: 380px;" class="bg-card border border-border rounded-lg shadow-xl overflow-hidden"><!></div></div>'),uo=C('<div class="bg-card border border-border rounded-lg shadow-xl z-50 overflow-hidden"><!></div>'),co=C('<div class="relative"><!> <!></div>');function vo(c,e){ge(e,!0);let t=O(e,"selectedPubkeys",31,()=>ze([])),o=O(e,"multiple",3,!0),a=O(e,"buttonClass",3,""),s=O(e,"disabled",3,!1),n=O(e,"iconOnly",3,!0),f=O(e,"open",15,!1),i=ee(""),u=ee(null),l=ee(ze({top:0,left:0,width:0}));const p=re.$subscribe(()=>re.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[re.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),d=M(()=>{const w=p.events[0];return w?new Set(w.tags.filter(A=>A[0]==="p").map(A=>A[1])):new Set});let h=ee(ze(new Map));const k=M(()=>r(i)?Array.from(r(h).entries()).filter(([A])=>r(d).has(A)).map(([A])=>A).slice(0,50):Array.from(r(d)).slice(0,50));Ue(()=>{if(!r(i).trim()||!re.cacheAdapter?.getProfiles){b(h,new Map,!0);return}const w=r(i).toLowerCase();re.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:w}).then(A=>{b(h,A??new Map,!0)}).catch(A=>{console.error("Failed to search profiles:",A),b(h,new Map,!0)})});function _(){if(!f()&&r(u)){const w=r(u).getBoundingClientRect();b(l,{top:w.bottom+4,left:w.left,width:Math.max(w.width,380)},!0)}f(!f())}const P=M(()=>a().includes("hidden"));Ue(()=>{if(f()&&r(P)){const w=window.innerWidth,A=window.innerHeight,G=380;b(l,{top:(A-400)/2,left:(w-G)/2,width:G},!0)}});function U(w){o()?t().includes(w)?t(t().filter(A=>A!==w)):t([...t(),w]):(t([w]),f(!1)),e.onSelect?.(t())}function E(w){t(t().filter(A=>A!==w)),e.onSelect?.(t())}async function I(){if(r(i).trim())try{const w=r(i).trim(),A=await re.fetchUser(w);A?.pubkey?(o()?t().includes(A.pubkey)||(t([...t(),A.pubkey]),e.onSelect?.(t()),he.success("User added")):(t([A.pubkey]),e.onSelect?.(t()),f(!1)),b(i,"")):he.error("User not found")}catch(w){console.error("Failed to fetch user:",w),he.error("Failed to fetch user")}}function j(){f(!1)}const T=M(()=>{const w=r(i).trim();return w.length>0&&(w.startsWith("npub1")||w.startsWith("nprofile1")||w.includes("@")||w.length===64&&/^[0-9a-f]+$/i.test(w))});var K=co(),W=m(K);{let w=M(()=>n()?"icon":"default"),A=M(()=>n()?"h-8 w-8":"w-full justify-start"),G=M(a),ae=M(()=>e.buttonLabel||"Tag people");He(W,{type:"button",variant:"ghost",get size(){return r(w)},get class(){return`${r(A)??""} ${r(G)??""}`},get disabled(){return s()},onclick:_,get title(){return r(ae)},get ref(){return r(u)},set ref(ne){b(u,ne,!0)},children:(ne,Y)=>{var V=ce(),z=te(V);{var F=X=>{var J=no(),L=x(te(J),2),S=m(L,!0);g(L);var Q=x(L,2);{var le=$=>{var y=ao(),N=m(y,!0);g(y),H(()=>oe(N,t().length)),v($,y)};Z(Q,$=>{t().length>0&&$(le)})}H(()=>oe(S,e.buttonLabel)),v(X,J)},B=X=>{var J=io(),L=x(te(J));{var S=Q=>{var le=so(),$=m(le,!0);g(le),H(()=>oe($,t().length)),v(Q,le)};Z(L,Q=>{t().length>0&&Q(S)})}v(X,J)};Z(z,X=>{!n()&&e.buttonLabel?X(F):X(B,!1)})}v(ne,V)},$$slots:{default:!0}})}var R=x(W,2);{var D=w=>{var A=ce(),G=te(A);{var ae=Y=>{var V=lo();V.__click=j,V.__keydown=B=>B.key==="Escape"&&j();var z=m(V);z.__click=B=>B.stopPropagation(),z.__keydown=B=>B.stopPropagation();var F=m(z);Et(F,{get isIdentifierInput(){return r(T)},get selectedPubkeys(){return t()},get filteredFollows(){return r(k)},get multiple(){return o()},onSearchQueryChange:B=>b(i,B,!0),onAddByIdentifier:I,onRemoveUser:E,onToggleUser:U,get searchQuery(){return r(i)},set searchQuery(B){b(i,B,!0)}}),g(z),g(V),Ke(V,B=>mt?.(B)),v(Y,V)},ne=Y=>{var V=uo(),z=m(V);Et(z,{get isIdentifierInput(){return r(T)},get selectedPubkeys(){return t()},get filteredFollows(){return r(k)},get multiple(){return o()},onSearchQueryChange:F=>b(i,F,!0),onAddByIdentifier:I,onRemoveUser:E,onToggleUser:U,get searchQuery(){return r(i)},set searchQuery(F){b(i,F,!0)}}),g(V),Ke(V,F=>mt?.(F)),Ke(V,(F,B)=>dt?.(F,B),()=>j),H(()=>Ze(V,`position: fixed; top: ${r(l).top??""}px; left: ${r(l).left??""}px; width: 380px;`)),v(Y,V)};Z(G,Y=>{r(P)?Y(ae):Y(ne,!1)})}v(w,A)};Z(R,w=>{f()&&w(D)})}g(K),v(c,K),pe()}ke(["click","keydown"]);var fo=C('<div class="text-xs text-muted-foreground truncate"> </div>'),ho=C('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div></button>');function go(c,e){ge(e,!0);let t=ee(null);Ue(()=>{re.fetchUser(e.pubkey).then(l=>{l?.fetchProfile().then(p=>{b(t,p,!0)})})});var o=ho();o.__click=l=>{l.preventDefault(),l.stopPropagation(),e.onSelect(e.pubkey)};var a=m(o);ie(a,()=>Ce.Root,(l,p)=>{p(l,{get ndk(){return re},get pubkey(){return e.pubkey},children:(d,h)=>{var k=ce(),_=te(k);ie(_,()=>Ce.Avatar,(P,U)=>{U(P,{class:"flex-shrink-0"})}),v(d,k)},$$slots:{default:!0}})});var s=x(a,2),n=m(s),f=m(n,!0);g(n);var i=x(n,2);{var u=l=>{var p=fo(),d=m(p,!0);g(p),H(()=>oe(d,r(t).nip05)),v(l,p)};Z(i,l=>{r(t)?.nip05&&l(u)})}g(s),g(o),H(()=>{ue(o,1,`w-full flex items-center gap-2 p-2 transition-colors ${e.isSelected?"bg-primary/20":"hover:bg-muted"}`),oe(f,r(t)?.displayName||r(t)?.name||"Anonymous")}),Se("mouseenter",o,function(...l){e.onMouseEnter?.apply(this,l)}),v(c,o),pe()}ke(["click"]);var po=C('<div class="bg-card border border-border rounded-lg shadow-xl z-[1003] overflow-hidden"><div class="max-h-[300px] overflow-y-auto"></div></div>');function mo(c,e){ge(e,!0);let t=ee(0);const o=re.$subscribe(()=>re.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[re.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),a=M(()=>{const d=o.events[0];return d?new Set(d.tags.filter(h=>h[0]==="p").map(h=>h[1])):new Set});let s=ee(ze(new Map));const n=M(()=>e.searchQuery?Array.from(r(s).entries()).filter(([h])=>r(a).has(h)).map(([h])=>h).slice(0,10):Array.from(r(a)).slice(0,10));Ue(()=>{if(!e.searchQuery.trim()||!re.cacheAdapter?.getProfiles){b(s,new Map,!0);return}const d=e.searchQuery.toLowerCase();re.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:d}).then(h=>{b(s,h??new Map,!0)}).catch(h=>{console.error("Failed to search profiles:",h),b(s,new Map,!0)})}),Ue(()=>{r(t)>=r(n).length&&b(t,Math.max(0,r(n).length-1),!0)});function f(d){const h=re.getUser({pubkey:d}),k=Array.from(h.relayUrls||[]),_=tr.nprofileEncode({pubkey:d,relays:k.slice(0,3)});e.onSelect(`nostr:${_}`)}function i(d){switch(d.key){case"ArrowDown":d.preventDefault(),b(t,(r(t)+1)%r(n).length);break;case"ArrowUp":d.preventDefault(),b(t,r(t)===0?r(n).length-1:r(t)-1,!0);break;case"Enter":d.preventDefault(),r(n).length>0&&f(r(n)[r(t)]);break;case"Escape":d.preventDefault(),e.onClose();break}}var u=ce();Se("keydown",_t,i);var l=te(u);{var p=d=>{var h=po(),k=m(h);Qe(k,22,()=>r(n),_=>_,(_,P,U)=>{{let E=M(()=>r(U)===r(t));go(_,{get pubkey(){return P},get isSelected(){return r(E)},onSelect:f,onMouseEnter:()=>b(t,r(U),!0)})}}),g(k),g(h),Ke(h,_=>mt?.(_)),H(()=>Ze(h,`position: fixed; top: ${e.position.top??""}px; left: ${e.position.left??""}px; max-width: 320px;`)),v(d,h)};Z(l,d=>{r(n).length>0&&d(p)})}v(c,u),pe()}function bo(c,e,t){const o=ze({show:!1,searchQuery:"",startIndex:0,position:{top:0,left:0},markers:new Map});function a(l){const p=l.selectionStart,d=document.createElement("div"),h=window.getComputedStyle(l);["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(I=>{d.style[I]=h[I]}),d.style.position="absolute",d.style.visibility="hidden",d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word",document.body.appendChild(d);const _=l.value.substring(0,p);d.textContent=_;const P=document.createElement("span");P.textContent=l.value.substring(p)||".",d.appendChild(P);const U=l.getBoundingClientRect(),E={top:U.top+P.offsetTop+parseInt(h.borderTopWidth)-l.scrollTop+20,left:U.left+P.offsetLeft+parseInt(h.borderLeftWidth)};return document.body.removeChild(d),E}function s(l){const p=l.target,d=p.selectionStart,h=p.value.substring(0,d),k=h.lastIndexOf("@");if(k!==-1){const _=h.substring(k+1),P=k>0?h[k-1]:" ",U=_.includes(" ")||_.includes(`
`);if((P===" "||P===`
`||k===0)&&!U){o.startIndex=k,o.searchQuery=_,o.position=a(p),o.show=!0;return}}o.show=!1}async function n(l){const p=c();if(!p)return;const d=e(),h=p.selectionStart;if(!l.match(/nostr:nprofile1([a-z0-9]+)/))return;const _=re.getUser({nprofile:l.replace("nostr:","")});await _.fetchProfile();const P=_.profile?.nip05?`@${_.profile.nip05}`:`@${_.profile?.displayName||_.profile?.name||_.npub.slice(0,12)}`;o.markers.set(P,l);const U=d.substring(0,o.startIndex),E=d.substring(h);t(U+P+" "+E);const I=o.startIndex+P.length+1;setTimeout(()=>{p.selectionStart=p.selectionEnd=I,p.focus()},0),o.show=!1,o.searchQuery=""}function f(){o.show=!1,o.searchQuery=""}function i(l){let p=l;for(const[d,h]of o.markers)for(;p.includes(d);)p=p.replace(d,h);return p}function u(){o.markers.clear(),o.show=!1,o.searchQuery=""}return{get show(){return o.show},get searchQuery(){return o.searchQuery},get position(){return o.position},handleInput:s,insertMention:n,closeMentionPicker:f,getContentWithNostrEntities:i,reset:u}}var yo=C('<div class="absolute inset-0 flex items-center justify-center"><div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div></div>'),_o=C('<button type="button" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),wo=C('<div class="relative group"><img alt="Upload preview"/> <!></div>'),xo=C('<div class="flex flex-wrap gap-2 mt-2"></div>'),ko=we('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Eo=C('<div><input type="file" accept="image/*" multiple class="hidden"/> <div><textarea class="w-full min-h-[120px] max-md:flex-1 max-md:min-h-0 bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none focus:ring-0 text-lg"></textarea> <!></div> <div class="flex items-center gap-2 mt-2 pt-2 border-t border-border"><!> <!> <!></div></div> <!>',1);function Ro(c,e){ge(e,!0);let t=O(e,"value",15,""),o=O(e,"placeholder",3,"What's on your mind?"),a=O(e,"autofocus",3,!1),s=O(e,"disabled",3,!1),n=O(e,"class",3,""),f=O(e,"selectedMentions",31,()=>ze([]));const i=new Hr(re),u=fr(i);let l,p,d=ee(!1),h=ee(ze([])),k=ee(!1);const _=bo(()=>l,()=>t(),y=>t(y));async function P(y){if(!y.type.startsWith("image/")){he.error("Please select an image file");return}const N=URL.createObjectURL(y),q=r(h).length;b(h,[...r(h),{url:"",preview:N}],!0),b(k,!0);try{await u.upload(y,{fallbackServer:"https://blossom.primal.net"}),u.result?.url&&(r(h)[q]={url:u.result.url,preview:N},U(u.result.url),he.success("Image uploaded"))}catch(se){console.error("Upload failed:",se),he.error("Failed to upload image"),b(h,r(h).filter((ve,fe)=>fe!==q),!0)}finally{b(k,!1)}}function U(y){const N=l;if(!N)return;const q=N.selectionStart,se=N.selectionEnd,ve=`
${y}
`;t(t().slice(0,q)+ve+t().slice(se)),setTimeout(()=>{N.selectionStart=N.selectionEnd=q+ve.length,N.focus()},0)}function E(y){const N=r(h)[y];N.url&&t(t().replace(`
${N.url}
`,"").replace(N.url,"")),URL.revokeObjectURL(N.preview),b(h,r(h).filter((q,se)=>se!==y),!0)}function I(y){const N=y.target,q=N.files?.[0];q&&P(q),N.value=""}function j(y){y.preventDefault(),b(d,!0)}function T(y){y.preventDefault(),b(d,!1)}async function K(y){y.preventDefault(),b(d,!1);const N=y.dataTransfer?.files;if(N&&N.length>0)for(const q of Array.from(N))q.type.startsWith("image/")&&await P(q)}async function W(y){const N=y.clipboardData?.items;if(N){for(const q of Array.from(N))if(q.type.startsWith("image/")){y.preventDefault();const se=q.getAsFile();se&&await P(se)}}}function R(){p?.click()}function D(){return _.getContentWithNostrEntities(t())}function w(){t(""),_.reset(),b(h,[],!0)}function A(y){_.show||y.key==="Enter"&&y.stopPropagation()}var G={getContentWithNostrEntities:D,reset:w},ae=Eo(),ne=te(ae),Y=m(ne);Y.__change=I,bt(Y,y=>p=y,()=>p);var V=x(Y,2),z=m(V);qt(z),Wt(z,a()),z.__input=function(...y){_.handleInput?.apply(this,y)},z.__keydown=A,bt(z,y=>l=y,()=>l);var F=x(z,2);{var B=y=>{var N=xo();Qe(N,23,()=>r(h),q=>q.preview,(q,se,ve)=>{var fe=wo(),me=m(fe),xe=x(me,2);{var Me=Ee=>{var Le=yo();v(Ee,Le)},Pe=Ee=>{var Le=_o();Le.__click=()=>E(r(ve)),v(Ee,Le)};Z(xe,Ee=>{r(se).url?Ee(Pe,!1):Ee(Me)})}g(fe),H(()=>{de(me,"src",r(se).preview),ue(me,1,`w-20 h-20 object-cover rounded-lg border ${r(se).url?"":"opacity-50 animate-pulse"}`)}),v(q,fe)}),g(N),v(y,N)};Z(F,y=>{r(h).length>0&&y(B)})}g(V);var X=x(V,2),J=m(X);{var L=y=>{var N=ce(),q=te(N);Dt(q,()=>e.relayButton),v(y,N)};Z(J,y=>{e.relayButton&&y(L)})}var S=x(J,2);{let y=M(()=>s()||r(k));He(S,{type:"button",variant:"ghost",size:"icon",onclick:R,get disabled(){return r(y)},class:"h-8 w-8",title:"Add image",children:(N,q)=>{var se=ko();v(N,se)},$$slots:{default:!0}})}var Q=x(S,2);vo(Q,{get onSelect(){return e.onMentionsChange},get disabled(){return s()},get selectedPubkeys(){return f()},set selectedPubkeys(y){f(y)}}),g(X),g(ne);var le=x(ne,2);{var $=y=>{mo(y,{get position(){return _.position},get searchQuery(){return _.searchQuery},get onSelect(){return _.insertMention},get onClose(){return _.closeMentionPicker}})};Z(le,y=>{_.show&&y($)})}return H(()=>{ue(ne,1,`relative flex-1 flex flex-col ${n()??""}`),ue(V,1,`flex-1 flex flex-col ${r(d)?"ring-2 ring-primary ring-offset-2 rounded-lg":""}`),de(z,"placeholder",o()),z.disabled=s()}),Se("dragover",V,j),Se("dragleave",V,T),Se("drop",V,K),Se("paste",z,W),zt(z,t),v(c,ae),pe(G)}ke(["change","input","keydown","click"]);function So(c){const e=ze({selectedRelayUrls:[]}),t=M(()=>at.relays.filter(o=>o.enabled));return Ue(()=>{c()&&(at.selectedRelay?e.selectedRelayUrls=[at.selectedRelay]:e.selectedRelayUrls.length===0&&(e.selectedRelayUrls=r(t).filter(o=>o.write).map(o=>o.url)))}),{get selectedRelayUrls(){return e.selectedRelayUrls},set selectedRelayUrls(o){e.selectedRelayUrls=o},get allRelays(){return r(t)}}}var Uo=C('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),Ao=C('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),Co=C('<span class="text-xl mr-2">âš¡</span> ',1),Po=C("<!> <!>",1),Lo=C('<div class="relative -mx-6 -mt-6 px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">âš¡</span></div> <div><!> <!></div></div></div> <div class="space-y-6"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!> <!></div>',1);function No(c,e){ge(e,!0);let t=O(e,"open",15,!1);const o=[{value:10,label:"10",emoji:"â˜•"},{value:21,label:"21",emoji:"âš¡"},{value:50,label:"50",emoji:"ðŸ¤™"},{value:100,label:"100",emoji:"ðŸ’¯"},{value:500,label:"500",emoji:"ðŸ”¥"},{value:1e3,label:"1K",emoji:"ðŸ’Ž"},{value:2100,label:"2.1K",emoji:"ðŸš€"},{value:5e3,label:"5K",emoji:"ðŸ‘‘"}];let a=ee(ze(at.zap.defaultAmount)),s=ee(""),n=ee(!1);function f(h){b(a,h,!0),b(n,!1),b(s,"")}function i(){b(n,!0);const h=Number.parseInt(r(s));!Number.isNaN(h)&&h>0&&b(a,h,!0)}function u(){r(a)>0&&e.onZap(r(a))}function l(h){h.key==="Enter"&&r(a)>0&&u()}var p=ce();Se("keydown",_t,l);var d=te(p);ie(d,()=>Ot,(h,k)=>{k(h,{get open(){return t()},onOpenChange:_=>{_?t(!0):e.onCancel()},children:(_,P)=>{var U=ce(),E=te(U);ie(E,()=>Lt,(I,j)=>{j(I,{class:"max-w-md bg-background border-2 border-primary/30 shadow-2xl shadow-primary/50",children:(T,K)=>{var W=Lo(),R=te(W),D=x(m(R),2),w=x(m(D),2),A=m(w);ie(A,()=>Nt,(L,S)=>{S(L,{class:"text-xl text-foreground",children:(Q,le)=>{De();var $=Ae("Zap Amount");v(Q,$)},$$slots:{default:!0}})});var G=x(A,2);ie(G,()=>ur,(L,S)=>{S(L,{class:"text-sm text-muted-foreground",children:(Q,le)=>{De();var $=Ae("Choose your zap amount");v(Q,$)},$$slots:{default:!0}})}),g(w),g(D),g(R);var ae=x(R,2),ne=m(ae);Qe(ne,21,()=>o,St,(L,S)=>{{let Q=M(()=>r(a)===r(S).value&&!r(n)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");He(L,{variant:"ghost",onclick:()=>f(r(S).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${r(Q)??""}`},children:(le,$)=>{var y=Uo(),N=x(te(y),2),q=m(N),se=m(q,!0);g(q);var ve=x(q,2),fe=m(ve,!0);g(ve),g(N),H(()=>{oe(se,r(S).emoji),ue(ve,1,`text-xs font-bold ${r(a)===r(S).value&&!r(n)?"text-primary-foreground":"text-foreground"}`),oe(fe,r(S).label)}),v(le,y)},$$slots:{default:!0}})}}),g(ne);var Y=x(ne,2),V=m(Y);nr(V,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(L,S)=>{De();var Q=Ae("Custom Amount");v(L,Q)},$$slots:{default:!0}});var z=x(V,2),F=m(z);{let L=M(()=>r(n)?"border-primary":"border-border");ir(F,{id:"custom-amount",type:"number",oninput:i,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${r(L)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return r(s)},set value(S){b(s,S,!0)}})}De(2),g(z),g(Y);var B=x(Y,2);{var X=L=>{var S=Ao(),Q=m(S),le=x(m(Q),2),$=m(le);g(le),g(Q),g(S),H(y=>oe($,`${y??""} sats`),[()=>r(a).toLocaleString()]),v(L,S)};Z(B,L=>{r(a)>0&&L(X)})}var J=x(B,2);ie(J,()=>cr,(L,S)=>{S(L,{class:"flex gap-3 sm:space-x-0",children:(Q,le)=>{var $=Po(),y=te($);He(y,{variant:"outline",get onclick(){return e.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(q,se)=>{De();var ve=Ae("Cancel");v(q,ve)},$$slots:{default:!0}});var N=x(y,2);{let q=M(()=>r(a)<=0);He(N,{onclick:u,get disabled(){return r(q)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(se,ve)=>{var fe=Co(),me=x(te(fe));H(xe=>oe(me,` Zap ${xe??""}`),[()=>r(a)>0?r(a).toLocaleString():""]),v(se,fe)},$$slots:{default:!0}})}v(Q,$)},$$slots:{default:!0}})}),g(ae),v(T,W)},$$slots:{default:!0}})}),v(_,U)},$$slots:{default:!0}})}),v(c,p),pe()}var Oo=we('<svg class="w-6 h-6 animate-spin text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),Do=we('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),zo=we('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),To=we('<svg stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Fo=C('<button type="button"><div><!></div> <span class="text-xs font-semibold text-white"><!></span></button>'),Io=we('<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),Mo=we('<svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>'),Bo=we('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),jo=we('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),Vo=we('<svg class="w-5 h-5" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Ho=C('<span class="text-xs opacity-70"> </span>'),Zo=C(" <!>",1),Ko=C('<button type="button"><!> <span class="text-sm group-hover:underline"><!></span></button>'),Qo=C("<!> <!>",1);function Rt(c,e){ge(e,!0);const t=O(e,"variant",3,"default"),o=re.$zaps(()=>({target:e.event,validated:!0}));let a=ee(0),s=ee(!1);const n=M(()=>{if(r(s))return!0;const R=re.$currentPubkey;return R?rr(o.events,R):!1}),f=M(()=>{const R=o.totalAmount+r(a);return R>=1e6?`${(R/1e6).toFixed(1)}M`:R>=1e3?`${(R/1e3).toFixed(1)}K`:R.toString()}),i=M(()=>o.count+(r(s)?1:0));let u=ee(!1),l=ee(!1),p=ee(!1),d=null;async function h(R){if(!re.signer){he.error("Please login to zap");return}b(a,R,!0),b(s,!0),b(l,!0);try{await new Ut(e.event,R*1e3,"msat").zap(),b(p,!0),setTimeout(()=>b(p,!1),2e3),he.success(`Zapped ${R} sats!`)}catch(D){console.error("Failed to zap:",D);const w=D instanceof Error?D.message:"Failed to send zap";b(a,0),b(s,!1),w.includes("wallet")||w.includes("NWC")?he.error("Lightning wallet error. Please check your wallet connection in settings."):w.includes("invoice")?he.error("Failed to create invoice. The recipient may not have a Lightning address configured."):he.error("Failed to send zap. Please try again.")}finally{b(l,!1),setTimeout(()=>{b(a,0),b(s,!1)},3e3)}}async function k(R){R.stopPropagation(),!(r(l)||!re.signer)&&await h(at.zap.defaultAmount)}function _(R){b(u,!1),h(R)}function P(R){R.preventDefault(),R.stopPropagation(),d=setTimeout(()=>{b(u,!0),d=null},500)}function U(R){d&&(clearTimeout(d),d=null,(R.type==="mouseup"||R.type==="touchend")&&k(R))}function E(){d&&(clearTimeout(d),d=null)}var I=Qo(),j=te(I);{var T=R=>{var D=Fo();D.__mousedown=P,D.__mouseup=U,D.__touchstart=P,D.__touchend=U;var w=m(D),A=m(w);{var G=F=>{var B=Oo();v(F,B)},ae=F=>{var B=To(),X=m(B);{var J=S=>{var Q=Do();v(S,Q)},L=S=>{var Q=zo();v(S,Q)};Z(X,S=>{r(n)?S(J):S(L,!1)})}g(B),H(()=>{ue(B,0,`w-6 h-6 transition-colors ${r(n)?"text-yellow-400":"text-white"}`),de(B,"fill",r(n)?"currentColor":"none")}),v(F,B)};Z(A,F=>{r(l)?F(G):F(ae,!1)})}g(w);var ne=x(w,2),Y=m(ne);{var V=F=>{var B=Ae();H(()=>oe(B,r(f))),v(F,B)},z=F=>{var B=Ae("Zap");v(F,B)};Z(Y,F=>{o.totalAmount+r(a)>0?F(V):F(z,!1)})}g(ne),g(D),H(()=>{D.disabled=r(l),ue(D,1,`flex flex-col items-center gap-1 hover:scale-110 transition-transform group ${r(l)?"opacity-50 cursor-wait":""}`),ue(w,1,`w-12 h-12 rounded-full backdrop-blur-sm flex items-center justify-center transition-colors ${r(p)?"bg-yellow-400/30":r(n)?"bg-yellow-400/20":"bg-white/20"}`)}),Se("mouseleave",D,E),Se("touchcancel",D,E),v(R,D)},K=R=>{var D=Ko();D.__mousedown=P,D.__mouseup=U,D.__touchstart=P,D.__touchend=U;var w=m(D);{var A=z=>{var F=Io();v(z,F)},G=z=>{var F=ce(),B=te(F);{var X=L=>{var S=Mo();v(L,S)},J=L=>{var S=Vo(),Q=m(S);{var le=y=>{var N=Bo();v(y,N)},$=y=>{var N=jo();v(y,N)};Z(Q,y=>{r(n)?y(le):y($,!1)})}g(S),H(()=>de(S,"fill",r(n)?"currentColor":"none")),v(L,S)};Z(B,L=>{r(p)?L(X):L(J,!1)},!0)}v(z,F)};Z(w,z=>{r(l)?z(A):z(G,!1)})}var ae=x(w,2),ne=m(ae);{var Y=z=>{var F=Ae("Zapped!");v(z,F)},V=z=>{var F=ce(),B=te(F);{var X=L=>{var S=Ae("Zapping...");v(L,S)},J=L=>{var S=ce(),Q=te(S);{var le=y=>{var N=Zo(),q=te(N),se=x(q);{var ve=fe=>{var me=Ho(),xe=m(me);g(me),H(()=>oe(xe,`(${r(i)??""})`)),v(fe,me)};Z(se,fe=>{r(i)>0&&fe(ve)})}H(()=>oe(q,`${r(f)??""} `)),v(y,N)},$=y=>{var N=Ae("Zap");v(y,N)};Z(Q,y=>{o.totalAmount+r(a)>0?y(le):y($,!1)},!0)}v(L,S)};Z(B,L=>{r(l)?L(X):L(J,!1)},!0)}v(z,F)};Z(ne,z=>{r(p)?z(Y):z(V,!1)})}g(ae),g(D),H(()=>{D.disabled=r(l),ue(D,1,`relative flex items-center gap-2 transition-colors group ${r(p)||r(n)?"text-yellow-400":"text-muted-foreground hover:text-yellow-400"} ${r(l)?"opacity-50 cursor-wait":""}`)}),Se("mouseleave",D,E),Se("touchcancel",D,E),v(R,D)};Z(j,R=>{t()==="tiktok"?R(T):R(K,!1)})}var W=x(j,2);No(W,{get event(){return e.event},onZap:_,onCancel:()=>b(u,!1),get open(){return r(u)},set open(R){b(u,R,!0)}}),v(c,I),pe()}ke(["mousedown","mouseup","touchstart","touchend"]);var Wo=C('<div class="absolute bottom-full mb-2 right-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),qo=C('<div class="flex flex-col items-center gap-6 text-white"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <div class="relative"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <!></div> <button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div><!></div> <span class="text-xs font-semibold"> </span></button> <!></div>'),Go=C('<div class="absolute bottom-full mb-2 left-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><!> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><!> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),Jo=C('<div><button type="button" class="flex items-center gap-2 hover:text-primary transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <div class="relative"><button type="button" class="flex items-center gap-2 hover:text-green-400 transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <!></div> <!> <!></div>'),Yo=C("<!> <!> <!>",1);function ln(c,e){ge(e,!0);const t=O(e,"variant",3,"default");let o=ee(!1),a=ee(!1),s=ee(!1);const n=re.$subscribe(()=>({filters:[{kinds:[1,1111,6,16],...e.event.filter()}],subId:"interactions"})),f=M(()=>Array.from(n.events??[]).filter(E=>E.kind===1||E.kind===1111).length),i=M(()=>Array.from(n.events??[]).filter(E=>E.kind===6||E.kind===16).length),u=M(()=>t()!=="tiktok"?null:Tt(()=>({event:e.event}),re)),l=M(()=>r(u)?r(u).get("â¤ï¸")??{count:0,hasReacted:!1,pubkeys:[],emoji:"â¤ï¸"}:{count:0,hasReacted:!1});async function p(){if(!re.signer){he.error("Please login to repost");return}try{await e.event.repost(),he.success("Note reposted")}catch(E){console.error("Failed to repost:",E),he.error("Failed to repost")}}var d=Yo(),h=te(d);{var k=E=>{var I=qo(),j=m(I);j.__click=S=>{S.stopPropagation(),b(o,!0)};var T=m(j),K=m(T);Oe(K,{name:"message",size:"lg"}),g(T);var W=x(T,2),R=m(W,!0);g(W),g(j);var D=x(j,2),w=m(D);w.__click=S=>{S.stopPropagation(),b(s,!r(s))};var A=m(w),G=m(A);Oe(G,{name:"repost",size:"lg"}),g(A);var ae=x(A,2),ne=m(ae,!0);g(ae),g(w);var Y=x(w,2);{var V=S=>{var Q=Wo();Q.__click=y=>y.stopPropagation();var le=m(Q);le.__click=y=>{y.stopPropagation(),b(s,!1),p()};var $=x(le,2);$.__click=y=>{y.stopPropagation(),b(s,!1),b(a,!0)},g(Q),Ke(Q,(y,N)=>dt?.(y,N),()=>()=>b(s,!1)),v(S,Q)};Z(Y,S=>{r(s)&&S(V)})}g(D);var z=x(D,2);z.__click=S=>{S.stopPropagation(),r(u)&&r(u).react("â¤ï¸").catch(Q=>{console.error("Failed to react:",Q),he.error("Failed to add reaction")})};var F=m(z),B=m(F);{let S=M(()=>r(l).hasReacted?"animate-[heartbeat_0.3s_ease-in-out]":"");Oe(B,{name:"heart-filled",size:"lg",get class(){return r(S)}})}g(F);var X=x(F,2),J=m(X,!0);g(X),g(z);var L=x(z,2);Rt(L,{get event(){return e.event},variant:"tiktok"}),g(I),H(()=>{oe(R,r(f)),oe(ne,r(i)),ue(F,1,`w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-red-400 transition-colors ${r(l).hasReacted?"bg-red-400/30":""}`),oe(J,r(l).count)}),v(E,I)},_=E=>{var I=Jo(),j=m(I);j.__click=z=>{z.stopPropagation(),b(o,!0)};var T=m(j);Oe(T,{name:"message",size:"md"});var K=x(T,2),W=m(K,!0);g(K),g(j);var R=x(j,2),D=m(R);D.__click=z=>{z.stopPropagation(),b(s,!r(s))};var w=m(D);Oe(w,{name:"repost",size:"md"});var A=x(w,2),G=m(A,!0);g(A),g(D);var ae=x(D,2);{var ne=z=>{var F=Go();F.__click=S=>S.stopPropagation();var B=m(F);B.__click=S=>{S.stopPropagation(),b(s,!1),p()};var X=m(B);Oe(X,{name:"repost",size:"md"}),De(2),g(B);var J=x(B,2);J.__click=S=>{S.stopPropagation(),b(s,!1),b(a,!0)};var L=m(J);Oe(L,{name:"message",size:"md"}),De(2),g(J),g(F),Ke(F,(S,Q)=>dt?.(S,Q),()=>()=>b(s,!1)),v(z,F)};Z(ae,z=>{r(s)&&z(ne)})}g(R);var Y=x(R,2);lr(Y,{get event(){return e.event},emoji:"â¤ï¸",class:"hover:text-red-400 transition-colors group [&>span]:text-sm [&>span]:group-hover:underline"});var V=x(Y,2);Rt(V,{get event(){return e.event}}),g(I),H(()=>{ue(I,1,`flex items-center gap-3 sm:gap-6 ${t()==="thread-main"?"border-t border-border pt-3":""} text-muted-foreground`),oe(W,r(f)),oe(G,r(i))}),v(E,I)};Z(h,E=>{t()==="tiktok"?E(k):E(_,!1)})}var P=x(h,2);yt(P,{get replyTo(){return e.event},get open(){return r(o)},set open(E){b(o,E,!0)}});var U=x(P,2);yt(U,{get quotedEvent(){return e.event},get open(){return r(a)},set open(E){b(a,E,!0)}}),v(c,d),pe()}ke(["click"]);function Xo(c,e){const t=M(c),o=M(()=>r(t).pubkeys),a=M(()=>xt(r(t).skipCurrentUser,!1)),s=M(()=>xt(r(t).onlyFollows,!1)),n=M(()=>e?.$follows||new Set),f=M(()=>e?.$currentPubkey),i=M(()=>{if(!e)return[];let d=r(o);return r(a)&&r(f)&&(d=d.filter(h=>h!==r(f))),r(s)&&r(f)&&(d=d.filter(h=>r(n).has(h))),d.map(h=>e.getUser({pubkey:h}))}),u=M(()=>r(i).filter(d=>r(n).has(d.pubkey))),l=M(()=>r(i).filter(d=>!r(n).has(d.pubkey))),p=M(()=>[...r(u),...r(l)]);return{get users(){return r(p)},get followedUsers(){return r(u)},get unfollowedUsers(){return r(l)}}}var $o=C('<button type="button" class="block p-0 border-none bg-none cursor-pointer transition-transform duration-200 hover:scale-110 hover:!z-[9999] focus-visible:outline-2 focus-visible:outline-primary focus-visible:outline-offset-2 focus-visible:rounded-full"><!></button>'),ea=C('<div data-avatar-group="" class="avatar-wrapper"><!></div>'),ta=C('<div data-avatar-group="" class="relative transition-transform duration-200"><!></div>'),ra=C('<button type="button" class="p-0 border-none bg-none cursor-pointer font-semibold text-muted-foreground transition-colors hover:text-foreground focus-visible:outline-2 focus-visible:outline-primary focus-visible:outline-offset-2 focus-visible:rounded"> </button>'),oa=C('<span class="inline-block"> </span>'),aa=C('<div data-avatar-group="" class="flex items-center font-semibold text-muted-foreground"><!></div>'),na=C('<button type="button" class="w-full h-full rounded-full border-none bg-none cursor-pointer flex items-center justify-center font-semibold text-muted-foreground transition-all duration-200 hover:bg-muted-hover hover:text-foreground hover:scale-110 focus-visible:outline-2 focus-visible:outline-primary focus-visible:outline-offset-2"> </button>'),sa=C('<div class="w-full h-full flex items-center justify-center"> </div>'),ia=C('<div data-avatar-group="" class="relative rounded-full bg-muted border-2 border-background flex items-center justify-center font-semibold text-muted-foreground flex-shrink-0"><!></div>'),la=C('<div data-avatar-group="" role="group" aria-label="User avatars"><!> <!></div>');function ht(c,e){ge(e,!0);let t=O(e,"pubkeys",19,()=>[]),o=O(e,"skipCurrentUser",3,!1),a=O(e,"onlyFollows",3,!1),s=O(e,"max",3,5),n=O(e,"size",3,40),f=O(e,"spacing",3,"normal"),i=O(e,"overflowVariant",3,"avatar"),u=O(e,"direction",3,"horizontal"),l=O(e,"class",3,"");const p=Xo(()=>({pubkeys:t(),skipCurrentUser:o(),onlyFollows:a()}),e.ndk),d=M(()=>p.users.slice(0,s())),h=M(()=>Math.max(0,p.users.length-s())),_={tight:-8,normal:-12,loose:-6}[f()],P=M(()=>u()==="vertical");var U=la(),E=m(U);Qe(E,19,()=>r(d),T=>T.pubkey,(T,K,W)=>{var R=ta();let D;var w=m(R);ie(w,()=>Ce.Root,(A,G)=>{G(A,{get ndk(){return e.ndk},get user(){return r(K)},children:(ae,ne)=>{var Y=ce(),V=te(Y);{var z=B=>{var X=$o();X.__click=()=>e.onAvatarClick?.(r(K));let J;var L=m(X);ie(L,()=>Ce.Avatar,(S,Q)=>{Q(S,{class:"ring-2 ring-background w-full h-full"})}),g(X),H(()=>J=Ze(X,"",J,{width:`${n()??""}px`,height:`${n()??""}px`})),v(B,X)},F=B=>{var X=ea();let J;var L=m(X);ie(L,()=>Ce.Avatar,(S,Q)=>{Q(S,{class:"ring-2 ring-background w-full h-full"})}),g(X),H(()=>J=Ze(X,"",J,{width:`${n()??""}px`,height:`${n()??""}px`})),v(B,X)};Z(V,B=>{e.onAvatarClick?B(z):B(F,!1)})}v(ae,Y)},$$slots:{default:!0}})}),g(R),H(()=>D=Ze(R,"",D,{"margin-left":!r(P)&&r(W)!==0?`${_}px`:"0","margin-top":r(P)&&r(W)!==0?`${_}px`:"0","z-index":r(d).length-r(W)})),v(T,R)});var I=x(E,2);{var j=T=>{var K=ce(),W=te(K);{var R=w=>{var A=ce(),G=te(A);Dt(G,()=>e.overflowSnippet,()=>r(h)),v(w,A)},D=w=>{var A=ce(),G=te(A);{var ae=Y=>{var V=aa();let z;var F=m(V);{var B=J=>{var L=ra();L.__click=function(...Q){e.onOverflowClick?.apply(this,Q)};var S=m(L);g(L),H(()=>oe(S,`+${r(h)??""}`)),v(J,L)},X=J=>{var L=oa(),S=m(L);g(L),H(()=>oe(S,`+${r(h)??""}`)),v(J,L)};Z(F,J=>{e.onOverflowClick?J(B):J(X,!1)})}g(V),H(()=>z=Ze(V,"",z,{"margin-left":r(P)?"0":"8px","margin-top":r(P)?"8px":"0"})),v(Y,V)},ne=Y=>{var V=ia();let z;var F=m(V);{var B=J=>{var L=na();L.__click=function(...Q){e.onOverflowClick?.apply(this,Q)};var S=m(L);g(L),H(()=>oe(S,`+${r(h)??""}`)),v(J,L)},X=J=>{var L=sa(),S=m(L);g(L),H(()=>oe(S,`+${r(h)??""}`)),v(J,L)};Z(F,J=>{e.onOverflowClick?J(B):J(X,!1)})}g(V),H(()=>z=Ze(V,"",z,{"margin-left":r(P)?"0":`${_}px`,"margin-top":r(P)?`${_}px`:"0",width:`${n()??""}px`,height:`${n()??""}px`,"font-size":`${n()*.35}px`,"z-index":0})),v(Y,V)};Z(G,Y=>{i()==="text"?Y(ae):Y(ne,!1)},!0)}v(w,A)};Z(W,w=>{e.overflowSnippet?w(R):w(D,!1)})}v(T,K)};Z(I,T=>{r(h)>0&&i()!=="none"&&T(j)})}g(U),H(T=>ue(U,1,T),[()=>Te(wt("relative flex",r(P)?"flex-col items-start":"items-center",l()))]),v(c,U),pe()}ke(["click"]);var ua=C('<span class="text-sm font-medium text-muted-foreground"> </span>'),ca=C("<!> <!>",1),da=C('<button data-repost-button-avatars="" type="button"><!> <!></button>');function va(c,e){ge(e,!0);let t=O(e,"variant",3,"ghost"),o=O(e,"max",3,3),a=O(e,"avatarSize",3,24),s=O(e,"spacing",3,"tight"),n=O(e,"showCount",3,!0),f=O(e,"onlyFollows",3,!0),i=O(e,"class",3,"");const u=$e("ndk"),l=e.ndk||u,p=wr(()=>({event:e.event}),l),d=nt({base:"inline-flex items-center gap-2 cursor-pointer font-medium text-sm transition-all rounded-md outline-none disabled:pointer-events-none disabled:opacity-50",variants:{variant:{ghost:"px-3 py-2 hover:bg-accent hover:text-accent-foreground",outline:"px-3 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border",pill:"px-4 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border rounded-full",solid:"px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90"}}});async function h(){if(e.onclick)e.onclick();else{if(!l?.$currentPubkey)return;try{await p.repost()}catch(E){console.error("Failed to repost:",E)}}}var k=da();k.__click=h;var _=m(k);kr(_,{size:16,class:"flex-shrink-0"});var P=x(_,2);{var U=E=>{var I=ca(),j=te(I);ht(j,{get ndk(){return l},get pubkeys(){return p.pubkeys},get max(){return o()},get size(){return a()},get spacing(){return s()},overflowVariant:"none",skipCurrentUser:!1,get onlyFollows(){return f()}});var T=x(j,2);{var K=W=>{var R=ua(),D=m(R,!0);g(R),H(()=>oe(D,p.count)),v(W,R)};Z(T,W=>{n()&&p.count>0&&W(K)})}v(E,I)};Z(P,E=>{p.pubkeys.length>0&&E(U)})}g(k),H(E=>{de(k,"data-variant",t()),ue(k,1,E),de(k,"aria-label",`${p.count} ${p.count===1?"repost":"reposts"}`)},[()=>Te(d({variant:t(),class:i()}))]),v(c,k),pe()}ke(["click"]);var fa=C('<span class="text-sm font-medium text-muted-foreground"> </span>'),ha=C("<!> <!>",1),ga=C('<button data-reaction-button-avatars="" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" color="currentColor"><path d="M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg> <!></button>');function pa(c,e){ge(e,!0);let t=O(e,"variant",3,"ghost"),o=O(e,"emoji",3,"â¤ï¸"),a=O(e,"max",3,3),s=O(e,"avatarSize",3,24),n=O(e,"spacing",3,"tight"),f=O(e,"showCount",3,!0),i=O(e,"countMode",3,"total"),u=O(e,"onlyFollows",3,!0),l=O(e,"class",3,"");const p=$e("ndk"),d=e.ndk||p,h=Tt(()=>({event:e.event}),d),k=M(()=>h?.get(o())??{count:0,hasReacted:!1,pubkeys:[],emoji:o()}),_=M(()=>i()==="total"?h.totalCount:r(k).count),P=nt({base:"inline-flex items-center gap-2 cursor-pointer font-medium text-sm transition-all rounded-md outline-none disabled:pointer-events-none disabled:opacity-50",variants:{variant:{ghost:"px-3 py-2 hover:bg-accent hover:text-accent-foreground",outline:"px-3 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border",pill:"px-4 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border rounded-full",solid:"px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90"},active:{true:"text-red-500",false:""}}}),U=nt({base:"flex-shrink-0",variants:{active:{true:"animate-[heartbeat_0.3s_ease-in-out]",false:""}}});function E(){h.react(o()),e.onclick?.()}var I=ga();I.__click=E;var j=m(I),T=x(j,2);{var K=W=>{var R=ha(),D=te(R);ht(D,{get ndk(){return d},get pubkeys(){return r(k).pubkeys},get max(){return a()},get size(){return s()},get spacing(){return n()},overflowVariant:"none",skipCurrentUser:!1,get onlyFollows(){return u()}});var w=x(D,2);{var A=G=>{var ae=fa(),ne=m(ae,!0);g(ae),H(()=>oe(ne,r(_))),v(G,ae)};Z(w,G=>{f()&&r(_)>0&&G(A)})}v(W,R)};Z(T,W=>{r(k).pubkeys.length>0&&W(K)})}g(I),H((W,R)=>{de(I,"data-variant",t()),ue(I,1,W),de(I,"aria-label",`${r(_)} ${r(_)===1?"reaction":"reactions"}`),ue(j,0,R),de(j,"fill",r(k).hasReacted?"currentColor":"none")},[()=>Te(P({variant:t(),active:r(k).hasReacted,class:l()})),()=>Te(U({active:r(k).hasReacted}))]),v(c,I),pe()}ke(["click"]);var ma=C('<span class="text-sm font-medium text-muted-foreground"> </span>'),ba=C("<!> <!>",1),ya=C('<button data-reply-button-avatars="" type="button"><!> <!></button>');function _a(c,e){ge(e,!0);let t=O(e,"variant",3,"ghost"),o=O(e,"max",3,3),a=O(e,"avatarSize",3,24),s=O(e,"spacing",3,"tight"),n=O(e,"showCount",3,!0),f=O(e,"onlyFollows",3,!0),i=O(e,"class",3,"");const u=$e("ndk"),l=e.ndk||u,p=br(()=>({event:e.event}),l),d=nt({base:"inline-flex items-center gap-2 cursor-pointer font-medium text-sm transition-all rounded-md outline-none disabled:pointer-events-none disabled:opacity-50",variants:{variant:{ghost:"px-3 py-2 hover:bg-accent hover:text-accent-foreground",outline:"px-3 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border",pill:"px-4 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border rounded-full",solid:"px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90"}}});function h(){e.onclick?.()}var k=ya();k.__click=h;var _=m(k);_r(_,{size:16,class:"flex-shrink-0"});var P=x(_,2);{var U=E=>{var I=ba(),j=te(I);ht(j,{get ndk(){return l},get pubkeys(){return p.pubkeys},get max(){return o()},get size(){return a()},get spacing(){return s()},overflowVariant:"none",skipCurrentUser:!1,get onlyFollows(){return f()}});var T=x(j,2);{var K=W=>{var R=ma(),D=m(R,!0);g(R),H(()=>oe(D,p.count)),v(W,R)};Z(T,W=>{n()&&p.count>0&&W(K)})}v(E,I)};Z(P,E=>{p.pubkeys.length>0&&E(U)})}g(k),H(E=>{de(k,"data-variant",t()),ue(k,1,E),de(k,"aria-label",`${p.count} ${p.count===1?"reply":"replies"}`)},[()=>Te(d({variant:t(),class:i()}))]),v(c,k),pe()}ke(["click"]);var wa=C('<span class="text-sm font-medium text-amber-500"> </span>'),xa=C('<button data-zap-button-avatars="" type="button"><!> <!> <!></button>');function ka(c,e){ge(e,!0);let t=O(e,"variant",3,"ghost"),o=O(e,"max",3,3),a=O(e,"avatarSize",3,24),s=O(e,"spacing",3,"tight"),n=O(e,"showCount",3,!0),f=O(e,"onlyFollows",3,!0),i=O(e,"class",3,"");const u=Symbol.for("event-card"),l=$e(u),p=$e("ndk"),d=e.ndk||l?.ndk||p,h=e.event||l?.event,k=M(()=>h||e.user),_=Er(()=>({target:r(k)}),d),P=M(()=>Array.from(new Set(_.events.map(At).filter(Boolean).map(w=>w.zapper).filter(Boolean)))),U=nt({base:"inline-flex items-center gap-2 cursor-pointer font-medium text-sm transition-all rounded-md outline-none disabled:pointer-events-none disabled:opacity-50",variants:{variant:{ghost:"px-3 py-2 hover:bg-accent hover:text-accent-foreground",outline:"px-3 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border",pill:"px-4 py-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground border border-border rounded-full",solid:"px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90"}}});function E(){e.onclick?.(_.zap)}const I=M(()=>r(P).length>0||_.hasZapped);var j=xa();j.__click=E;var T=m(j);Sr(T,{size:16,get filled(){return r(I)},class:"flex-shrink-0"});var K=x(T,2);{var W=w=>{ht(w,{get ndk(){return d},get pubkeys(){return r(P)},get max(){return o()},get size(){return a()},get spacing(){return s()},overflowVariant:"none",skipCurrentUser:!1,get onlyFollows(){return f()}})};Z(K,w=>{r(P).length>0&&w(W)})}var R=x(K,2);{var D=w=>{var A=wa(),G=m(A,!0);g(A),H(()=>oe(G,_.totalAmount)),v(w,A)};Z(R,w=>{n()&&_.totalAmount>0&&w(D)})}g(j),H(w=>{de(j,"data-variant",t()),ue(j,1,w),de(j,"aria-label",`${_.totalAmount} sats from ${_.count} ${_.count===1?"zapper":"zappers"}`)},[()=>Te(U({variant:t(),class:i()}))]),v(c,j),pe()}ke(["click"]);var Ea=C("<!> <!> <!> <!>",1),Ra=C('<div><!> <!></div> <!> <div class="mb-2"><!></div> <!>',1),Sa=C("<!> <!>",1);function Ua(c,e){ge(e,!0),O(e,"showActions",3,!0);const t=O(e,"variant",3,"default");O(e,"showThreadLine",3,!1),O(e,"compact",3,!1);let o=ee(!1);const a=M(()=>t()==="thread-main"?"lg":t()==="thread-reply"?"md":"sm"),s=M(()=>t()==="thread-main"?"text-lg leading-relaxed":"text-base"),n=M(()=>t()==="thread-main"?"bg-card/50":(t()==="default","hover:bg-card/30")),f=M(()=>t()==="default"||e.onNavigate!==void 0),i=M(()=>t()==="thread-main"?"full":"compact"),u=M(()=>t()==="thread-main"?"mb-2":"mb-1.5");function l(_){_(1,"test zap from agora")}function p(_){const P=re.getUser(_);kt(`/p/${P.npub}`)}var d=Sa(),h=te(d);ie(h,()=>Je.Root,(_,P)=>{P(_,{get ndk(){return re},get event(){return e.event},get interactive(){return r(f)},onclick:()=>kt(`/e/${e.event.encode()}`),onUserClick:p,get class(){return`p-3 sm:p-4 flex flex-col max-sm:max-w-screen ${r(n)??""} transition-colors min-w-0 border-b border-border`},children:(U,E)=>{var I=Ra(),j=te(I),T=m(j);ie(T,()=>Je.Header,(A,G)=>{G(A,{get variant(){return r(i)},get avatarSize(){return r(a)}})});var K=x(T,2);ie(K,()=>Je.Dropdown,(A,G)=>{G(A,{})}),g(j);var W=x(j,2);ie(W,()=>Je.ReplyIndicator,(A,G)=>{G(A,{})});var R=x(W,2),D=m(R);ie(D,()=>Je.Content,(A,G)=>{G(A,{get class(){return r(s)}})}),g(R);var w=x(R,2);ie(w,()=>Je.Actions,(A,G)=>{G(A,{children:(ae,ne)=>{var Y=Ea(),V=te(Y);_a(V,{get ndk(){return re},get event(){return e.event},class:"hover:bg-muted",onclick:()=>b(o,!0)});var z=x(V,2);pa(z,{get ndk(){return re},get event(){return e.event},class:"hover:bg-muted"});var F=x(z,2);va(F,{get ndk(){return re},get event(){return e.event},class:"hover:bg-muted"});var B=x(F,2);ka(B,{get ndk(){return re},get event(){return e.event},class:"hover:bg-muted",onclick:l}),v(ae,Y)},$$slots:{default:!0}})}),H(A=>ue(j,1,A),[()=>Te(dr(r(u),"flex flex-row justify-between"))]),v(U,I)},$$slots:{default:!0}})});var k=x(h,2);yt(k,{get replyTo(){return e.event},get open(){return r(o)},set open(_){b(o,_,!0)}}),v(c,d),pe()}var Aa=C('<div class="-mx-6 px-4 py-3 mb-4 border-b border-border bg-card/50"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3 break-all"> </p></div></div></div>'),Ca=C('<img alt="" class="w-5 h-5 rounded border border-background"/>'),Pa=C('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><!></div>'),La=C('<div class="flex items-center -space-x-1"></div>'),Na=C('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Oa=C('<div class="relative"><!> <!></div>'),Da=C('<div class="absolute top-full left-0 mt-2 bg-popover border border-border rounded-lg shadow-xl z-[100] w-80 max-h-[400px] overflow-y-auto transition-all duration-200"><!></div>'),za=C('<div class="relative"><!> <!></div>'),Ta=C('<div class="-mx-6 px-4 py-3 mb-4 border-y border-border bg-muted/30"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="border border-border rounded-lg overflow-hidden bg-card"><!></div></div>'),Fa=C('<div class="flex items-center justify-between -mx-6 -mt-6 px-4 py-3 mb-4 border-b border-border"><!> <!> <!></div> <!> <div class="relative mb-4"><!></div> <!>',1);function yt(c,e){ge(e,!0),new mr("(min-width: 768px)");let t=O(e,"open",15,!1),o=ee(""),a=ee(!1),s=ee(!1),n=ee(!1),f=ee(ze([])),i,u=ee(null);Ue(()=>{if(!e.replyTo){b(u,null);return}e.replyTo.author.fetchProfile().then(T=>{b(u,T,!0)})});const l=So(()=>t()),p=M(()=>l.selectedRelayUrls),d=M(()=>l.allRelays);async function h(){if(!(!r(o).trim()||r(a)||r(p).length===0))try{b(a,!0);const T=i?.getContentWithNostrEntities()??r(o);let K;e.replyTo?K=e.replyTo.reply():e.quotedEvent?(K=new ct(re),K.kind=1,K.tag(e.quotedEvent,void 0,!1,"q")):(K=new ct(re),K.kind=1),K.content=e.quotedEvent?`${T}
nostr:${e.quotedEvent.encode()}`:T,e.replyTo||(K.isProtected=r(n)),r(f).forEach(R=>{K.tags.push(["p",R])}),await K.sign();const W=or.fromRelayUrls(r(p),re);if(await K.publish(W),K.publishStatus==="error"){const R=K.publishError;console.error("Publish error object:",R),console.error("Relay errors:",R?.relayErrors);const D=R?.relayErrors||{},w=Object.entries(D);if(w.length>0){const A=w.map(([G,ae])=>`â€¢ ${G.replace("wss://","")}: ${ae}`).join(`
`);he.error(`Failed to publish to relays:

${A}`)}else he.error(`Failed to publish: ${R?.message||"Not enough relays received the event"}`);return}i?.reset(),b(o,""),b(f,[],!0),t(!1),he.success(e.replyTo?"Reply published":e.quotedEvent?"Quote published":"Note published"),e.onPublished?.(),e.onClose?.()}catch(T){console.error("Failed to publish note:",T),he.error(`Failed to publish: ${T instanceof Error?T.message:"Unknown error"}`)}finally{b(a,!1)}}function k(T){l.selectedRelayUrls.includes(T)?l.selectedRelayUrls=l.selectedRelayUrls.filter(K=>K!==T):l.selectedRelayUrls=[...l.selectedRelayUrls,T]}function _(T){l.selectedRelayUrls=[T],b(s,!1)}function P(){b(s,!1)}function U(){r(a)||(t(!1),b(o,""),b(f,[],!0),e.onClose?.())}function E(T){(T.metaKey||T.ctrlKey)&&T.key==="Enter"&&h()}var I=ce();Se("keydown",_t,E);var j=te(I);ie(j,()=>Ot,(T,K)=>{K(T,{get open(){return t()},onOpenChange:W=>{W?t(!0):U()},children:(W,R)=>{var D=ce(),w=te(D);ie(w,()=>Lt,(A,G)=>{G(A,{class:"md:max-w-2xl !overflow-visible",hideClose:!0,children:(ae,ne)=>{var Y=Fa(),V=te(Y),z=m(V);He(z,{variant:"ghost",size:"icon",onclick:U,get disabled(){return r(a)},class:"h-10 w-10",children:($,y)=>{Oe($,{name:"close",size:"lg"})},$$slots:{default:!0}});var F=x(z,2);ie(F,()=>Nt,($,y)=>{y($,{class:"text-lg",children:(N,q)=>{De();var se=Ae();H(()=>oe(se,e.replyTo?"Reply":e.quotedEvent?"Quote":"Compose")),v(N,se)},$$slots:{default:!0}})});var B=x(F,2);{let $=M(()=>!r(o).trim()||r(a)||r(p).length===0);He(B,{onclick:h,get disabled(){return r($)},class:"rounded-full px-6",size:"sm",children:(y,N)=>{De();var q=Ae();H(()=>oe(q,r(a)?"Publishing...":"Post")),v(y,q)},$$slots:{default:!0}})}g(V);var X=x(V,2);{var J=$=>{var y=Aa(),N=m(y),q=m(N);ie(q,()=>Ce.Root,(Le,Ne)=>{Ne(Le,{get ndk(){return re},get pubkey(){return e.replyTo.pubkey},children:(Fe,tt)=>{var We=ce(),qe=te(We);ie(qe,()=>Ce.Avatar,(Be,je)=>{je(Be,{class:"w-10 h-10"})}),v(Fe,We)},$$slots:{default:!0}})});var se=x(q,2),ve=m(se),fe=m(ve),me=m(fe,!0);g(fe);var xe=x(fe,2),Me=m(xe);g(xe),g(ve);var Pe=x(ve,2),Ee=m(Pe,!0);g(Pe),g(se),g(N),g(y),H((Le,Ne)=>{oe(me,Le),oe(Me,`@${Ne??""}`),oe(Ee,e.replyTo.content)},[()=>r(u).displayName||r(u).name||`${e.replyTo.pubkey.slice(0,8)}...`,()=>r(u).name||e.replyTo.pubkey.slice(0,8)]),v($,y)};Z(X,$=>{e.replyTo&&r(u)&&$(J)})}var L=x(X,2),S=m(L);{const $=N=>{var q=za(),se=m(q);He(se,{type:"button",variant:"ghost",size:"icon",onclick:()=>b(s,!r(s)),get disabled(){return r(a)},class:"h-8 w-8",title:"Select relays",children:(me,xe)=>{var Me=ce(),Pe=te(Me);{var Ee=Ne=>{var Fe=La();Qe(Fe,21,()=>r(p),St,(tt,We)=>{const qe=M(()=>r(d).find(Ve=>Ve.url===r(We))),Be=M(()=>r(qe)?ar(r(qe).url):null);var je=ce(),gt=te(je);{var Vt=Ve=>{var Ge=Ca();H(()=>de(Ge,"src",r(Be).info.icon)),v(Ve,Ge)},Ht=Ve=>{var Ge=Pa(),Zt=m(Ge);Oe(Zt,{name:"relay",size:"xs",class:"text-muted-foreground"}),g(Ge),v(Ve,Ge)};Z(gt,Ve=>{r(Be)?.info?.icon?Ve(Vt):Ve(Ht,!1)})}v(tt,je)}),g(Fe),v(Ne,Fe)},Le=Ne=>{var Fe=Oa(),tt=m(Fe);Oe(tt,{name:"relay",size:"md"});var We=x(tt,2);{var qe=Be=>{var je=Na(),gt=m(je,!0);g(je),H(()=>oe(gt,r(p).length)),v(Be,je)};Z(We,Be=>{r(p).length>2&&Be(qe)})}g(Fe),v(Ne,Fe)};Z(Pe,Ne=>{r(p).length<=2&&r(p).length>0?Ne(Ee):Ne(Le,!1)})}v(me,Me)},$$slots:{default:!0}});var ve=x(se,2);{var fe=me=>{var xe=Da(),Me=m(xe);sr(Me,{get selectedRelayUrls(){return r(p)},onToggleRelay:k,onSelectOnly:_,get isProtected(){return r(n)},set isProtected(Pe){b(n,Pe,!0)}}),g(xe),Ke(xe,(Pe,Ee)=>dt?.(Pe,Ee),()=>P),v(me,xe)};Z(ve,me=>{r(s)&&me(fe)})}g(q),v(N,q)};let y=M(()=>e.replyTo?"Write your reply...":e.quotedEvent?"Add your thoughts...":"What's on your mind?");bt(Ro(S,{get placeholder(){return r(y)},autofocus:!0,get disabled(){return r(a)},get value(){return r(o)},set value(N){b(o,N,!0)},get selectedMentions(){return r(f)},set selectedMentions(N){b(f,N,!0)},relayButton:$,$$slots:{relayButton:!0}}),N=>i=N,()=>i)}g(L);var Q=x(L,2);{var le=$=>{var y=Ta(),N=x(m(y),2),q=m(N);Ua(q,{get event(){return e.quotedEvent},showActions:!1}),g(N),g(y),v($,y)};Z(Q,$=>{e.quotedEvent&&$(le)})}v(ae,Y)},$$slots:{default:!0}})}),v(W,D)},$$slots:{default:!0}})}),v(c,I),pe()}export{ht as A,yt as C,ln as E,mr as M,Ua as N,vo as U,Hr as a,Ro as b,fr as c};
