import{f as _,a as c,c as x,j as W,r as ie,s as Z}from"./CvdcXPsy.js";import{bj as ye,aA as M,b as Ue,u as H,p as L,a as l,s as C,g as t,f as b,aK as we,c as F,t as P,e as A,r as K,d as oe,h as E}from"./-h67YDCL.js";import{s as ne}from"./0JHOh1sT.js";import{g as Ne,f as D,s as S,a as ae,b as le}from"./vjiKTA8K.js";import{p as I}from"./6dG0wjw8.js";import{S as xe}from"./CAJmB2zv.js";import{t as Ee}from"./0JNfDbnS.js";import{i as y}from"./DG6c9x1x.js";function fe(d){const e=d.slice(0,6),m=`#${e}`,r=parseInt(e.slice(0,2),16),a=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16),n=Math.max(r,a,i)/255,s=Math.min(r,a,i)/255,f=(n+s)/2;let o=0,u=0;if(n!==s){const g=n-s;switch(u=f>.5?g/(2-n-s):g/(n+s),n){case r/255:o=((a/255-i/255)/g+(a<i?6:0))/6;break;case a/255:o=((i/255-r/255)/g+2)/6;break;case i/255:o=((r/255-a/255)/g+4)/6;break}}const h=(o*360+30)%360,R=Math.min(f*100+10,90);return`linear-gradient(135deg, ${m}, hsl(${h}, ${u*100}%, ${R}%))`}function z(...d){return Ee(Ne(d))}const re="ndk";function Pe(d){if(d)return d;try{if(ye(re)){const e=M(re);if(e)return e}}catch{}throw new Error(`NDK not found. Either:
1. Provide as second parameter: createBuilder(() => config, ndk)
2. Set in Svelte context: setContext('${re}', ndk)`)}const te=new xe;function Ie(d,e){const m=Pe(e),r=Ue({profile:null,user:null,loading:!1});async function a(i){r.loading=!0;try{const n=typeof i=="string"?await m.fetchUser(i):i;if(!n){r.profile=null,r.user=null,r.loading=!1;return}const s=n.pubkey;if(n.profile){r.profile=n.profile,r.user=n,r.loading=!1;return}let f=te.get(s);f||(f=n.fetchProfile({closeOnEose:!0,groupable:!0,groupableDelay:250}).finally(()=>{te.delete(s)}),te.set(s,f));const o=await f;r.profile=o||null,r.user=n}catch(n){console.error("Failed to fetch profile:",n),r.profile=null,r.user=null}r.loading=!1}return H(()=>{const{user:i}=d();i?a(i):(r.profile=null,r.user=null,r.loading=!1)}),{get profile(){return r.profile},get user(){return r.user},get loading(){return r.loading}}}const G=Symbol("user");var Se=_('<div data-user-root=""><!></div>');function Re(d,e){L(e,!0);let m=I(e,"class",3,"");const r=b(()=>{if(e.user)return e.user;if(e.npub)try{return e.ndk.getUser({npub:e.npub})}catch{return null}if(e.pubkey)try{return e.ndk.getUser({pubkey:e.pubkey})}catch{return null}return null});let a=C(null);H(()=>{e.profile!==void 0?l(a,null):t(r)?l(a,Ie(()=>({user:t(r)}),e.ndk),!0):l(a,null)});const i=b(()=>e.profile!==void 0?e.profile:t(a)?.profile);we(G,{get ndk(){return e.ndk},get user(){return e.user},get ndkUser(){return t(r)},get profile(){return t(i)},get onclick(){return e.onclick}});var s=Se(),f=F(s);ne(f,()=>e.children),K(s),P(o=>S(s,1,o),[()=>D(z("contents",m()))]),c(d,s),A()}var Ce=_('<div class="rounded-full flex items-center justify-center w-full h-full absolute inset-0"> </div>'),Fe=_('<img data-user-avatar--img=""/>'),Ke=_('<div data-user-avatar=""><!> <!></div>');function Te(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(G);if(!r)throw new Error("User.Avatar must be used within User.Root");const a=b(()=>r.profile?.picture||e.fallback),i=b(()=>r.ndkUser?.pubkey?fe(r.ndkUser.pubkey):"var(--primary)");let n=C(!1),s=C(!1);function f(){l(n,!0),l(s,!1)}function o(){l(n,!1),l(s,!0)}H(()=>{l(n,!1),l(s,!1)});var u=Ke(),h=F(u);{var R=v=>{var p=x(),O=E(p);{var U=w=>{var N=x(),X=E(N);ne(X,()=>e.customFallback),c(w,N)},T=w=>{var N=Ce(),X=F(N,!0);K(N),P(Y=>{le(N,`background: ${t(i)??""};`),Z(X,Y)},[()=>r.ndkUser?.pubkey?.slice(0,2).toUpperCase()??"??"]),c(w,N)};y(O,w=>{e.customFallback?w(U):w(T,!1)})}c(v,p)};y(h,v=>{(!t(n)||!t(a))&&v(R)})}var g=oe(h,2);{var k=v=>{var p=Fe();P(O=>{ae(p,"src",t(a)),ae(p,"alt",e.alt),S(p,1,O)},[()=>D(z("rounded-full object-cover block w-full h-full absolute inset-0 bg-background",t(n)?"opacity-100":"opacity-0"))]),W("load",p,f),W("error",p,o),ie(p),c(v,p)};y(g,v=>{t(a)&&v(k)})}K(u),P(v=>S(u,1,v),[()=>D(z("rounded-full relative w-12 h-12",m()))]),c(d,u),A()}var Ve=_('<span data-user-name=""> </span>');function je(d,e){L(e,!0);let m=I(e,"field",3,"displayName"),r=I(e,"class",3,"");const a=M(G);if(!a)throw new Error("User.Name must be used within User.Root");const i=b(()=>{if(a.ndkUser)try{return a.ndkUser.pubkey}catch{return}}),n=b(()=>{if(!a.profile)return t(i)?.slice(0,8)+"..."||"Unknown";if(m()==="name")return a.profile.name||t(i)?.slice(0,8)+"...";if(m()==="displayName")return a.profile.displayName||a.profile.name||t(i)?.slice(0,8)+"...";if(m()==="both"){const o=a.profile.displayName||a.profile.name,u=a.profile.name&&a.profile.name!==a.profile.displayName?a.profile.name:null;return u?`${o} (@${u})`:o||t(i)?.slice(0,8)+"..."}return t(i)?.slice(0,8)+"..."||"Unknown"});var s=Ve(),f=F(s,!0);K(s),P(o=>{S(s,1,o),Z(f,t(n))},[()=>D(z(r()))]),c(d,s),A()}var Be=_('<p data-user-bio=""> </p>');function De(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(G);if(!r)throw new Error("User.Bio must be used within User.Root");const a=b(()=>r.profile?.about||"");var i=x(),n=E(i);{var s=f=>{var o=Be(),u=F(o,!0);K(o),P(h=>{S(o,1,h),Z(u,t(a))},[()=>D(z(m()))]),c(f,o)};y(n,f=>{t(a)&&f(s)})}c(d,i),A()}var Me=_('<img alt="Profile banner"/>'),Le=_('<div data-user-banner=""><!></div>');function Ae(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(G);if(!r)throw new Error("User.Banner must be used within User.Root");const a=b(()=>r.profile),i=b(()=>r.ndkUser);let n=C(!1),s=C(!1);const f=b(()=>{const k=t(i)?.pubkey;return k?`background: ${fe(k)}`:"background: var(--primary)"});H(()=>{t(a)?.banner&&(l(n,!1),l(s,!1))});function o(){l(n,!0),l(s,!1)}function u(){l(n,!1),l(s,!0)}var h=Le(),R=F(h);{var g=k=>{var v=Me();let p;P(()=>{ae(v,"src",t(a).banner),p=S(v,1,"w-full h-full object-cover",null,p,{"opacity-0":!t(n)})}),W("load",v,o),W("error",v,u),ie(v),c(k,v)};y(R,k=>{t(a)?.banner&&k(g)})}K(h),P(()=>{S(h,1,`relative w-full h-48 ${m()??""}`),le(h,t(f))}),c(d,h),A()}var Ge=_('<span title="Verifying NIP-05...">⋯</span>'),Oe=_('<span title="NIP-05 verified">✓</span>'),Xe=_('<span title="NIP-05 does not match pubkey">✗</span>'),Ye=_('<span data-user-nip05=""> <!></span>');function qe(d,e){L(e,!0);const m=/^(?:([\w.+-]+)@)?([\w.-]+)$/;function r(U){return U||""}let a=I(e,"showNip05",3,!0),i=I(e,"showVerified",3,!0),n=I(e,"class",3,"");const s=M(G);if(!s)throw new Error("User.Nip05 must be used within User.Root");const f=b(()=>s.profile),o=b(()=>s.ndkUser),u=b(()=>t(f)?.nip05),h=b(()=>t(u)?m.test(t(u)):!1),R=b(()=>r(t(u)));let g=C(void 0),k=C(!1);H(()=>{if(!i()||!t(u)||!t(o)||!t(h)){l(g,void 0);return}l(g,void 0),l(k,!0),t(o).validateNip05(t(u)).then(U=>{l(g,U,!0),l(k,!1)}).catch(()=>{l(g,null),l(k,!1)})});var v=x(),p=E(v);{var O=U=>{var T=Ye(),w=F(T),N=oe(w);{var X=Y=>{var se=x(),ue=E(se);{var ce=V=>{var q=x(),$=E(q);ne($,()=>e.verificationSnippet,()=>({status:t(g),isVerifying:t(k)})),c(V,q)},de=V=>{var q=x(),$=E(q);{var ve=j=>{var J=Ge();c(j,J)},me=j=>{var J=x(),ge=E(J);{var pe=B=>{var Q=Oe();c(B,Q)},be=B=>{var Q=x(),he=E(Q);{var ke=ee=>{var _e=Xe();c(ee,_e)};y(he,ee=>{t(g)===!1&&ee(ke)},!0)}c(B,Q)};y(ge,B=>{t(g)===!0?B(pe):B(be,!1)},!0)}c(j,J)};y($,j=>{t(k)?j(ve):j(me,!1)})}c(V,q)};y(ue,V=>{e.verificationSnippet?V(ce):V(de,!1)})}c(Y,se)};y(N,Y=>{i()&&Y(X)})}K(T),P(()=>{S(T,1,D(n())),Z(w,`${t(R)??""} `)}),c(U,T)};y(p,U=>{a()&&t(u)&&U(O)})}c(d,v),A()}const rr={Root:Re,Avatar:Te,Name:je,Bio:De,Banner:Ae,Nip05:qe};export{rr as U,Ie as a,z as c,Pe as r};
