import{d as Bt,c as l,a as r,f as q,s as J,t as rt}from"./CvdcXPsy.js";import{p as zt,aA as It,aK as Kt,g as t,f as N,u as Ut,a as et,s as jt,h as d,e as Ot,t as I,c as _t,r as mt,n as Zt}from"./-h67YDCL.js";import{i as c}from"./DG6c9x1x.js";import{e as Tt,i as Ft}from"./DBJvd_ZN.js";import{c as U}from"./C52XBfTo.js";import{s as Nt,a as Mt}from"./vjiKTA8K.js";import{p as St}from"./6dG0wjw8.js";import{B as Yt}from"./CAJmB2zv.js";class Dt{blockNsfw=!0;mentionComponent=null;hashtagComponent=null;linkComponent=null;mediaComponent=null;fallbackComponent=null;handlers=new Map;mentionPriority=0;hashtagPriority=0;linkPriority=0;mediaPriority=0;fallbackPriority=0;addKind(e,n,s=1){if(Array.isArray(e))for(const o of e){const m=this.handlers.get(o);(!m||s>=m.priority)&&this.handlers.set(o,{component:n,wrapper:null,priority:s})}else{const o=e.kinds||[],m=e.from?e:null;for(const f of o){const E=this.handlers.get(f);(!E||s>=E.priority)&&this.handlers.set(f,{component:n,wrapper:m,priority:s})}}}setMentionComponent(e,n=1){n>=this.mentionPriority&&(this.mentionComponent=e,this.mentionPriority=n)}setHashtagComponent(e,n=1){n>=this.hashtagPriority&&(this.hashtagComponent=e,this.hashtagPriority=n)}setLinkComponent(e,n=1){n>=this.linkPriority&&(this.linkComponent=e,this.linkPriority=n)}setMediaComponent(e,n=1){n>=this.mediaPriority&&(this.mediaComponent=e,this.mediaPriority=n)}setFallbackComponent(e,n=1){n>=this.fallbackPriority&&(this.fallbackComponent=e,this.fallbackPriority=n)}getKindHandler(e){if(e!==void 0)return this.handlers.get(e)}hasKindHandler(e){return e===void 0?!1:this.handlers.has(e)}getRegisteredKinds(){return Array.from(this.handlers.keys()).sort((e,n)=>e-n)}getInlinePriorities(){return{mention:this.mentionPriority,hashtag:this.hashtagPriority,link:this.linkPriority,media:this.mediaPriority,fallback:this.fallbackPriority}}getKindPriorities(){const e=new Map;for(const[n,s]of this.handlers)e.set(n,s.priority);return e}clear(){this.handlers.clear(),this.mentionComponent=null,this.hashtagComponent=null,this.linkComponent=null,this.mediaComponent=null,this.fallbackComponent=null,this.mentionPriority=0,this.hashtagPriority=0,this.linkPriority=0,this.mediaPriority=0,this.fallbackPriority=0}}const Ht=new Dt,yt=Symbol("content-renderer"),Xt=Symbol.for("entity-click"),qt={EMOJI_SHORTCODE:/:([a-zA-Z0-9_]+):/g,NOSTR_URI:/nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,HASHTAG:/(^|\s)#([a-zA-Z0-9_\u0080-\uFFFF]+)(?=\s|$|[^\w])/g,MEDIA_FILE:/https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov)(\?[^\s<>"]*)?/gi,YOUTUBE:/https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,URL:/https?:\/\/[^\s<>"]+/gi};function Rt(a){const e=new Map;if(!Array.isArray(a))return console.warn("[buildEmojiMap] Expected tags to be an array, got:",typeof a),e;for(const[n,s,o]of a)n==="emoji"&&s&&o&&e.set(s,o);return e}function Gt(a,e){const n=e.get(a);return n?{type:"emoji",content:a,data:n}:{type:"text",content:`:${a}:`}}function Jt(a){try{const e=a.substring(0,a.indexOf("1")+1);if(Yt.decode(a),e==="npub1")return{type:"npub",content:a,data:a};if(e==="nprofile1")return{type:"nprofile",content:a,data:a};if(e==="note1"||e==="nevent1"||e==="naddr1")return{type:"event-ref",content:a,data:a}}catch{console.warn("[EventContent] Failed to decode Nostr URI:",a)}return{type:"text",content:`nostr:${a}`}}function Lt(a){return/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(a)}function Vt(a){return/\.(mp4|webm|mov)(\?|$)/i.test(a)}function Qt(a){return/youtube\.com|youtu\.be/i.test(a)}function $t(a,e){const n=a.match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(n){const[,s,o]=n;return s?{type:"hashtag",content:o,data:o}:{type:"hashtag",content:o,data:o}}if(a.startsWith(":")&&a.endsWith(":")){const s=a.slice(1,-1);return Gt(s,e)}return a.startsWith("nostr:")?Jt(a.slice(6)):Lt(a)||Vt(a)||Qt(a)?{type:"media",content:a}:a.startsWith("http")?{type:"link",content:a}:{type:"text",content:a}}function te(a){const e=[];for(const n of Object.values(qt)){n.lastIndex=0;let s=n.exec(a);for(;s!==null;)e.push({match:s,index:s.index}),s=n.exec(a)}return e.sort((n,s)=>n.index-s.index)}function ee(a,e){const n=[],s=te(a);let o=0;for(const{match:m,index:f}of s)if(!(f<o)){if(f>o&&n.push({type:"text",content:a.slice(o,f)}),m[0].match(/^\s?#[a-zA-Z0-9_\u0080-\uFFFF]+$/)){const E=m[0].match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(E){const[,i,R]=E;i&&n.push({type:"text",content:i}),n.push({type:"hashtag",content:R,data:R})}}else n.push($t(m[0],e));o=f+m[0].length}return o<a.length&&n.push({type:"text",content:a.slice(o)}),n}function Wt(a){return/^\s*$/.test(a)}function ne(a){const e=[];let n=[],s=[];function o(){n.length!==0&&(n.length===1?e.push({type:"media",content:n[0]}):e.push({type:"image-grid",content:"",data:n}),n=[],s=[])}function m(){for(const f of s)e.push(f);s=[]}for(const f of a)f.type==="media"&&Lt(f.content)?n.push(f.content):f.type==="text"&&Wt(f.content)&&n.length>0?s.push(f):(o(),m(),e.push(f));return o(),e}function ae(a){const e=[];let n=[],s=[];function o(){n.length!==0&&(n.length===1?e.push({type:"link",content:n[0]}):e.push({type:"link-group",content:"",data:n}),n=[],s=[])}function m(){for(const f of s)e.push(f);s=[]}for(const f of a)f.type==="link"?n.push(f.content):f.type==="text"&&Wt(f.content)&&n.length>0?s.push(f):(o(),m(),e.push(f));return o(),e}function re(a){return{get segments(){const e=String(a().event?.content??a().content??""),n=a().event,s=n?.tags&&Array.isArray(n.tags)?n.tags.filter(E=>E[0]==="emoji"):a().emojiTags??[],o=Rt(s),m=ee(e,o),f=ne(m);return ae(f)},get content(){return String(a().event?.content??a().content??"").trim()},get emojiMap(){const e=a().event,n=e?.tags&&Array.isArray(e.tags)?e.tags.filter(s=>s[0]==="emoji"):a().emojiTags??[];return Rt(n)}}}var oe=q('<div><div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span>Loading event...</span></div>'),ie=q("<div><span>Failed to load event</span></div>"),se=q('<div role="button" tabindex="0" class="cursor-pointer"><!></div>'),le=q('<div role="button" tabindex="0" class="cursor-pointer"><!></div>'),de=q('<button class="cursor-pointer font-mono text-sm bg-transparent border-none p-0 m-0 inline text-inherit"> </button>'),fe=q("<code> </code>");function ce(a,e){zt(e,!0);let n=St(e,"class",3,"");const s=It(yt),o=N(()=>e.renderer??s?.renderer??Ht),m=It(Xt);Kt(yt,{get renderer(){return t(o)}});let f=jt(void 0),E=jt(!0),i=jt(void 0);Ut(()=>{et(E,!0),et(i,void 0),et(f,void 0),e.ndk.fetchEvent(e.bech32).then(b=>{et(f,b??void 0,!0),et(E,!1)}).catch(b=>{et(i,b,!0),et(E,!1)})});const R=N(()=>({event:t(f),loading:t(E),error:t(i)}));let ot=N(()=>t(o).getKindHandler(t(R).event?.kind)),it=N(()=>t(ot)?.component),st=N(()=>t(o).fallbackComponent),C=N(()=>t(R).event&&t(ot)?.wrapper?.from?t(ot).wrapper.from(t(R).event):t(R).event);function K(b){m?.onEventClick&&t(C)&&(b.stopPropagation(),m.onEventClick(t(C)))}var ht=l(),kt=d(ht);{var bt=b=>{var Z=oe();I(()=>Nt(Z,1,`flex items-center gap-2 p-3 rounded-lg border border-border bg-muted text-sm ${n()??""}`)),r(b,Z)},G=b=>{var Z=l(),lt=d(Z);{var V=P=>{var S=ie();I(()=>Nt(S,1,`p-3 rounded-lg border border-border bg-muted text-sm text-destructive ${n()??""}`)),r(P,S)},O=P=>{var S=l(),Q=d(S);{var A=w=>{var H=l(),Y=d(H);{var L=p=>{var _=se();_.__click=K,_.__keydown=g=>g.key==="Enter"&&K(g);var F=_t(_);U(F,()=>t(it),(g,v)=>{v(g,{get ndk(){return e.ndk},get event(){return t(C)}})}),mt(_),r(p,_)},T=p=>{var _=l(),F=d(_);U(F,()=>t(it),(g,v)=>{v(g,{get ndk(){return e.ndk},get event(){return t(C)}})}),r(p,_)};c(Y,p=>{m?.onEventClick?p(L):p(T,!1)})}r(w,H)},j=w=>{var H=l(),Y=d(H);{var L=p=>{var _=l(),F=d(_);{var g=h=>{var y=le();y.__click=K,y.__keydown=x=>x.key==="Enter"&&K(x);var M=_t(y);U(M,()=>t(st),(x,u)=>{u(x,{get ndk(){return e.ndk},get event(){return t(C)},get class(){return n()}})}),mt(y),r(h,y)},v=h=>{var y=l(),M=d(y);U(M,()=>t(st),(x,u)=>{u(x,{get ndk(){return e.ndk},get event(){return t(C)},get class(){return n()}})}),r(h,y)};c(F,h=>{m?.onEventClick?h(g):h(v,!1)})}r(p,_)},T=p=>{var _=l(),F=d(_);{var g=v=>{var h=l(),y=d(h);{var M=u=>{var k=de();k.__click=K;var W=_t(k,!0);mt(k),I(()=>J(W,e.bech32)),r(u,k)},x=u=>{var k=fe(),W=_t(k,!0);mt(k),I(()=>J(W,e.bech32)),r(u,k)};c(y,u=>{m?.onEventClick?u(M):u(x,!1)})}r(v,h)};c(F,v=>{t(C)&&v(g)},!0)}r(p,_)};c(Y,p=>{t(st)&&t(C)?p(L):p(T,!1)},!0)}r(w,H)};c(Q,w=>{t(it)&&t(C)?w(A):w(j,!1)},!0)}r(P,S)};c(lt,P=>{t(R).error?P(V):P(O,!1)},!0)}r(b,Z)};c(kt,b=>{t(R).loading?b(bt):b(G,!1)})}r(a,ht),Ot()}Bt(["click","keydown"]);var ve=q('<img class="inline-block w-[1.25em] h-[1.25em] align-middle mx-[0.1em]"/>'),ue=q('<img alt="" class="w-full h-auto object-cover rounded-lg aspect-square"/>'),me=q("<div></div>");function xe(a,e){zt(e,!0);let n=St(e,"class",3,"");const s=It(yt),o=N(()=>e.renderer??s?.renderer??Ht);Kt(yt,{get renderer(){return t(o)}});const m=re(()=>({event:e.event,content:e.content,emojiTags:e.emojiTags}));var f=me();Tt(f,21,()=>m.segments,Ft,(E,i)=>{var R=l(),ot=d(R);{var it=C=>{var K=rt();I(()=>J(K,t(i).content)),r(C,K)},st=C=>{var K=l(),ht=d(K);{var kt=G=>{var b=l(),Z=d(b);{var lt=V=>{var O=l(),P=d(O);{var S=A=>{const j=N(()=>t(o).mentionComponent);var w=l(),H=d(w);U(H,()=>t(j),(Y,L)=>{L(Y,{get ndk(){return e.ndk},get bech32(){return t(i).data}})}),r(A,w)},Q=A=>{var j=rt();I(()=>J(j,t(i).content)),r(A,j)};c(P,A=>{t(o).mentionComponent?A(S):A(Q,!1)})}r(V,O)};c(Z,V=>{t(i).data&&typeof t(i).data=="string"&&V(lt)})}r(G,b)},bt=G=>{var b=l(),Z=d(b);{var lt=O=>{var P=l(),S=d(P);{var Q=A=>{ce(A,{get ndk(){return e.ndk},get bech32(){return t(i).data}})};c(S,A=>{t(i).data&&typeof t(i).data=="string"&&A(Q)})}r(O,P)},V=O=>{var P=l(),S=d(P);{var Q=j=>{var w=l(),H=d(w);{var Y=L=>{var T=l(),p=d(T);{var _=g=>{const v=N(()=>t(o).hashtagComponent);var h=l(),y=d(h);U(y,()=>t(v),(M,x)=>{x(M,{get ndk(){return e.ndk},get tag(){return t(i).data}})}),r(g,h)},F=g=>{var v=rt();I(()=>J(v,`#${t(i).data??""}`)),r(g,v)};c(p,g=>{t(o).hashtagComponent?g(_):g(F,!1)})}r(L,T)};c(H,L=>{t(i).data&&typeof t(i).data=="string"&&L(Y)})}r(j,w)},A=j=>{var w=l(),H=d(w);{var Y=T=>{var p=l(),_=d(p);{var F=v=>{const h=N(()=>t(o).linkComponent);var y=l(),M=d(y);U(M,()=>t(h),(x,u)=>{u(x,{get url(){return t(i).content}})}),r(v,y)},g=v=>{var h=rt();I(()=>J(h,t(i).content)),r(v,h)};c(_,v=>{t(o).linkComponent?v(F):v(g,!1)})}r(T,p)},L=T=>{var p=l(),_=d(p);{var F=v=>{var h=l(),y=d(h);{var M=u=>{const k=N(()=>t(o).mediaComponent);var W=l(),dt=d(W);U(dt,()=>t(k),($,z)=>{z($,{get url(){return t(i).content}})}),r(u,W)},x=u=>{var k=rt();I(()=>J(k,t(i).content)),r(u,k)};c(y,u=>{t(o).mediaComponent?u(M):u(x,!1)})}r(v,h)},g=v=>{var h=l(),y=d(h);{var M=u=>{var k=l(),W=d(k);{var dt=$=>{var z=ve();I(()=>{Mt(z,"src",t(i).data),Mt(z,"alt",`:${t(i).content??""}:`)}),r($,z)};c(W,$=>{typeof t(i).data=="string"&&$(dt)})}r(u,k)},x=u=>{var k=l(),W=d(k);{var dt=z=>{var ft=l(),Ct=d(ft);{var xt=tt=>{var ct=l(),wt=d(ct);{var Et=D=>{const nt=N(()=>t(o).mediaComponent);var at=l(),ut=d(at);U(ut,()=>t(nt),(B,X)=>{X(B,{get url(){return t(i).data}})}),r(D,at)},vt=D=>{var nt=l(),at=d(nt);Tt(at,17,()=>t(i).data,Ft,(ut,B)=>{var X=ue();I(()=>Mt(X,"src",t(B))),r(ut,X)}),r(D,nt)};c(wt,D=>{t(o).mediaComponent?D(Et):D(vt,!1)})}r(tt,ct)};c(Ct,tt=>{t(i).data&&Array.isArray(t(i).data)&&tt(xt)})}r(z,ft)},$=z=>{var ft=l(),Ct=d(ft);{var xt=tt=>{var ct=l(),wt=d(ct);{var Et=vt=>{var D=l(),nt=d(D);{var at=B=>{const X=N(()=>t(o).linkComponent);var pt=l(),Pt=d(pt);U(Pt,()=>t(X),(At,gt)=>{gt(At,{get url(){return t(i).data}})}),r(B,pt)},ut=B=>{var X=l(),pt=d(X);Tt(pt,17,()=>t(i).data,Ft,(Pt,At)=>{Zt();var gt=rt();I(()=>J(gt,t(At))),r(Pt,gt)}),r(B,X)};c(nt,B=>{t(o).linkComponent?B(at):B(ut,!1)})}r(vt,D)};c(wt,vt=>{t(i).data&&Array.isArray(t(i).data)&&vt(Et)})}r(tt,ct)};c(Ct,tt=>{t(i).type==="link-group"&&tt(xt)},!0)}r(z,ft)};c(W,z=>{t(i).type==="image-grid"?z(dt):z($,!1)},!0)}r(u,k)};c(y,u=>{t(i).type==="emoji"?u(M):u(x,!1)},!0)}r(v,h)};c(_,v=>{t(i).type==="media"?v(F):v(g,!1)},!0)}r(T,p)};c(H,T=>{t(i).type==="link"?T(Y):T(L,!1)},!0)}r(j,w)};c(S,j=>{t(i).type==="hashtag"?j(Q):j(A,!1)},!0)}r(O,P)};c(Z,O=>{t(i).type==="event-ref"?O(lt):O(V,!1)},!0)}r(G,b)};c(ht,G=>{t(i).type==="npub"||t(i).type==="nprofile"?G(kt):G(bt,!1)},!0)}r(C,K)};c(ot,C=>{t(i).type==="text"?C(it):C(st,!1)})}r(E,R)}),mt(f),I(()=>Nt(f,1,`whitespace-pre-wrap wrap-break-words leading-relaxed ${n()??""}`)),r(a,f),Ot()}export{yt as C,xe as E,Ht as a,ce as b,Xt as c,Jt as d};
