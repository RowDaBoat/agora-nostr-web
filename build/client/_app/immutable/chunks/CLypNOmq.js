import{f as S,s as J,a as h,d as ue,c as me,j as Y,b as ve}from"./CvdcXPsy.js";import{p as ee,c,d as g,r as u,t as B,g as e,f as w,e as te,s as k,b as fe,h as pe,a as i,z as ge}from"./-h67YDCL.js";import{i as C}from"./DG6c9x1x.js";import{s as he}from"./0JHOh1sT.js";import{s as P}from"./vjiKTA8K.js";import{p as Z}from"./6dG0wjw8.js";import{I as xe}from"./BClDDyYv.js";import{b as be}from"./Bif2btQW.js";import{b as $}from"./ByH5JKyU.js";import{a as _e,c as ye,U as ke}from"./Cq1keEic.js";import{n as D}from"./CAJmB2zv.js";import{U as we}from"./drvMETkT.js";import{B as Se}from"./B3t7n0XN.js";import{t as G}from"./DqdFoxb9.js";var ze=S('<div class="mb-3 text-muted-foreground opacity-50"><!></div>'),Ee=S("<p> </p>"),Ue=S('<div class="mt-4"><!></div>'),Ce=S("<div><!> <p> </p> <!> <!></div>");function Qe(K,a){ee(a,!0);const o=Z(a,"size",3,"md"),m=Z(a,"class",3,""),d=w(()=>({sm:"py-6",md:"py-12",lg:"py-16"})[o()]),f=w(()=>({sm:"lg",md:"xl",lg:"xl"})[o()]),F=w(()=>({sm:"text-sm",md:"text-base",lg:"text-lg"})[o()]),M=w(()=>({sm:"text-xs",md:"text-sm",lg:"text-base"})[o()]);var z=Ce(),E=c(z);{var j=l=>{var s=ze(),b=c(s);xe(b,{get name(){return a.icon},get size(){return e(f)}}),u(s),h(l,s)};C(E,l=>{a.icon&&l(j)})}var x=g(E,2),H=c(x,!0);u(x);var L=g(x,2);{var O=l=>{var s=Ee(),b=c(s,!0);u(s),B(()=>{P(s,1,`${e(M)??""} text-muted-foreground/70 text-center mt-1 max-w-md`),J(b,a.description)}),h(l,s)};C(L,l=>{a.description&&l(O)})}var N=g(L,2);{var V=l=>{var s=Ue(),b=c(s);he(b,()=>a.action),u(s),h(l,s)};C(N,l=>{a.action&&l(V)})}u(z),B(()=>{P(z,1,`flex flex-col items-center justify-center ${e(d)??""} ${m()??""}`),P(x,1,`${e(F)??""} font-medium text-muted-foreground text-center`),J(H,a.title)}),h(K,z),te()}var Fe=S('<button type="button" class="w-7 h-7 bg-accent text-white rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-200 active:scale-90"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button>'),Me=ve('<svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),je=S('<div class="flex items-center justify-between pt-2 border-t border-neutral-200 dark:border-neutral-800 opacity-100 transition-opacity duration-200"><div class="flex gap-1"><!> <!></div> <button type="button" class="px-[18px] py-2 bg-accent text-white rounded-[18px] font-semibold text-[14px] transition-all duration-150 active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed"> </button></div>'),Ie=S('<div class="mb-8"><div class="flex gap-2.5 items-end max-md:items-start"><!> <div class="flex-1 flex flex-col gap-2"><div><input type="file" accept="image/*" class="hidden"/> <textarea placeholder="Share your thoughts..." rows="1"></textarea> <!> <!></div></div></div></div>');function Re(K,a){ee(a,!0);let o=k(""),m=k(!1),d=k(!1),f=k(void 0),F=k(void 0),M=k(fe([]));const z=new _e(D),E=ye(z);let j=k(!1);const x=w(()=>e(o).trim().length>0);async function H(){if(!(!D.$currentUser||!e(o).trim())){i(m,!0);try{const t=a.article.reply();if(t.content=e(o),await t.publish(),t.publishStatus==="error"){const v=t.publishError?.relayErrors||{},U=Object.entries(v).map(([_,I])=>`${_}: ${I}`).join(`
`);a.onError(`Failed to publish:
${U||"Unknown error"}`);return}i(o,""),i(d,!1),i(M,[],!0)}catch(t){const r=t instanceof Error?t.message:"Failed to publish comment";a.onError(r)}finally{i(m,!1)}}}function L(){i(d,!0)}function O(){setTimeout(()=>{e(o).trim()||i(d,!1)},100)}function N(){if(!e(f))return;e(f).style.height="auto";const t=Math.min(150,Math.max(20,e(f).scrollHeight));e(f).style.height=t+"px"}async function V(t){if(!t.type.startsWith("image/")){G.error("Please select an image file");return}i(j,!0);try{await E.upload(t,{fallbackServer:"https://blossom.primal.net"}),E.result?.url&&(l(E.result.url),G.success("Image uploaded"))}catch(r){console.error("Upload failed:",r),G.error("Failed to upload image")}finally{i(j,!1)}}function l(t){const r=e(f);if(!r)return;const v=r.selectionStart,U=r.selectionEnd,_=`
${t}
`;i(o,e(o).slice(0,v)+_+e(o).slice(U)),setTimeout(()=>{r.selectionStart=r.selectionEnd=v+_.length,r.focus(),N()},0)}function s(t){const r=t.target,v=r.files?.[0];v&&V(v),r.value=""}function b(){e(F)?.click()}var Q=me(),re=pe(Q);{var ae=t=>{var r=Ie(),v=c(r),U=c(v);{let n=w(()=>e(d)?"w-9 h-9":"w-8 h-8");we(U,{get pubkey(){return D.$currentUser.pubkey},variant:"avatar",get avatarSize(){return e(n)},class:"transition-all duration-300 max-md:mt-0.5"})}var _=g(U,2),I=c(_),W=c(I);W.__change=s,$(W,n=>i(F,n),()=>e(F));var p=g(W,2);ge(p),p.__input=N,$(p,n=>i(f,n),()=>e(f));var R=g(p,2);{var oe=n=>{var y=Fe();y.__click=H,B(()=>y.disabled=e(m)),h(n,y)};C(R,n=>{e(x)&&!e(d)&&n(oe)})}var ne=g(R,2);{var se=n=>{var y=je(),q=c(y),X=c(q);{let A=w(()=>e(m)||e(j));Se(X,{type:"button",variant:"ghost",size:"icon",onclick:b,get disabled(){return e(A)},class:"h-8 w-8",children:(de,Be)=>{var ce=Me();h(de,ce)},$$slots:{default:!0}})}var ie=g(X,2);ke(ie,{get disabled(){return e(m)},get selectedPubkeys(){return e(M)},set selectedPubkeys(A){i(M,A,!0)}}),u(q);var T=g(q,2);T.__click=H;var le=c(T,!0);u(T),u(y),B(()=>{T.disabled=!e(x)||e(m),J(le,e(m)?"Posting...":"Comment")}),h(n,y)};C(ne,n=>{e(d)&&n(se)})}u(I),u(_),u(v),u(r),B(()=>{P(I,1,`bg-neutral-50 dark:bg-card border border rounded-[18px] ${e(d)?"rounded-[14px] p-3":"py-2.5 px-3.5"} transition-all duration-300 ${e(d)?"border-neutral-300 dark:border-neutral-700":"border-neutral-200 dark:border-neutral-800"} flex ${e(d)?"flex-col":"items-center"} gap-2`),p.disabled=e(m),P(p,1,`w-full bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none text-[15px] leading-[1.4] transition-all duration-300 ${e(d)?"max-h-[150px]":"max-h-9"} overflow-hidden`)}),Y("focus",p,L),Y("blur",p,O),be(p,()=>e(o),n=>i(o,n)),h(t,r)};C(re,t=>{D.$currentUser&&t(ae)})}h(K,Q),te()}ue(["change","input","click"]);export{Re as C,Qe as E};
