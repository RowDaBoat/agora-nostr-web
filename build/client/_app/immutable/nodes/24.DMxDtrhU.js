import{d as ht,f as u,a as s,s as l,c as me,b as He,t as xt}from"../chunks/CvdcXPsy.js";import{p as bt,g as e,f as O,u as pe,a as n,s as M,b as _t,e as kt,c as t,r,d as o,t as Q,h as K,n as ne}from"../chunks/-h67YDCL.js";import{i as C}from"../chunks/DG6c9x1x.js";import{c as Ke}from"../chunks/C52XBfTo.js";import{s as wt,a as Ve}from"../chunks/CptlhHpT.js";import{p as yt}from"../chunks/aVfrvTxa.js";import{g as he}from"../chunks/D1jhUNbu.js";import{n as U,f as De,A as $t,g as Mt,h as Ct}from"../chunks/CAJmB2zv.js";import{d as jt}from"../chunks/JQBZd0wI.js";import{U as Je}from"../chunks/Dk4THxss.js";import{o as We}from"../chunks/DmYduYj6.js";import{$ as Nt}from"../chunks/CIoNh8li.js";import{B as se,I as It}from"../chunks/B3t7n0XN.js";var St=u('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-orange-600 mx-auto mb-4"></div> <p class="text-muted-foreground"> </p></div></div>'),Ht=u('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div> <h2 class="text-xl font-bold text-foreground mb-2"> </h2> <p class="text-muted-foreground mb-6"> </p> <button class="px-6 py-2 bg-primary hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors"> </button></div></div>'),At=u('<div class="flex flex-col items-center mb-8 -mt-20"><div class="relative mb-4"><div class="w-24 h-24 rounded-full ring-4 ring-white dark:ring-neutral-900 overflow-hidden bg-neutral-200 dark:bg-neutral-800 flex items-center justify-center"><!></div></div> <div class="text-center"><h2 class="text-xl font-bold text-foreground"> </h2> <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"> </p></div></div>'),Et=u('<div class="mb-8 p-6 bg-neutral-50 dark:bg-neutral-800/50 rounded-xl border border-border"><p class="text-foreground whitespace-pre-wrap leading-relaxed"> </p></div>'),Bt=u('<!> <!> <div class="text-center mb-8"><h1 class="text-3xl font-bold mb-3 text-foreground"> </h1> <p class="text-muted-foreground"> </p></div> <div class="space-y-5 mb-10"><div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-primary dark:text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div></div> <div class="space-y-4"><button class="w-full py-3 text-lg font-semibold bg-primary hover:from-primary-700 hover:to-primary-800 text-white shadow-lg transition-all duration-200 hover:shadow-xl rounded-xl flex items-center justify-center gap-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg></button> <button class="w-full text-center text-muted-foreground hover:text-neutral-900 dark:hover:text-neutral-200 transition-colors py-2"> <span class="font-semibold underline"> </span></button></div> <div class="mt-8 pt-6 border-t border-neutral-200 dark:border-neutral-800"><p class="text-xs text-center text-neutral-500"> </p></div>',1),Lt=u('<div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm"> </div>'),Pt=He('<svg class="w-5 h-5 animate-spin ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),Rt=u('<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg> <div class="flex-1 text-left"><div class="font-semibold">Browser Extension (NIP-07)</div> <div class="text-sm text-muted-foreground">Use Alby, nos2x, or similar</div></div> <!>',1),Ut=u('<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path></svg> <div class="flex-1 text-left"><div class="font-semibold">Private Key</div> <div class="text-sm text-muted-foreground">Login with your nsec or hex key</div></div>',1),Ft=u('<span class="font-semibold underline">Create a new account</span>'),Tt=u(`<!> <!> <div class="relative my-6"><div class="absolute inset-0 flex items-center"><span class="w-full border-t border-border"></span></div> <div class="relative flex justify-center text-xs uppercase"><span class="bg-card px-2 text-muted-foreground">Don't have an account?</span></div></div> <!>`,1),zt=He('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Logging in...',1),Yt=He('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path></svg> Login',1),Ot=u('<div class="space-y-4"><div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg text-blue-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div>Enter your private key (nsec or hex format). This will be stored locally in your browser.</div></div> <!> <div class="flex gap-2"><!> <!></div></div>'),Kt=u('<div class="-mt-8"><h2 class="text-2xl font-bold text-foreground mb-2 text-center">Welcome Back</h2> <p class="text-muted-foreground mb-8 text-center">Sign in to accept your invite</p> <div class="space-y-3"><!> <!></div></div>'),Vt=u('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden"><div class="h-32 bg-primary opacity-90"></div> <div class="px-8 pb-8 pt-12"><!></div></div>'),Dt=u('<div class="min-h-screen bg-gradient-to-b from-neutral-50 to-neutral-100 dark:from-neutral-950 dark:to-neutral-900 flex items-center justify-center p-4"><div class="w-full max-w-xl"><!></div></div>');function sr(Ge,qe){bt(qe,!0);const Qe=()=>Ve(yt,"$page",Ae),d=()=>Ve(Nt,"$t",Ae),[Ae,Xe]=wt(),E=O(()=>Qe().params.code),Ze=O(()=>e(E)?e(E).slice(0,12):null),Ee=O(()=>e(E)&&e(E).length>12?e(E).slice(12):null),xe=U.$subscribe(()=>({filters:{kinds:[513],"#d":[e(Ze)],limit:1},relayUrls:[...$t],subId:"invite",cacheUsage:De.ONLY_RELAY,closeOnEose:!0}));let x=M(null);pe(()=>{n(x,e(x)??xe.events[0],!0)});let a=M(null);pe(()=>{!e(x)||!e(E)||e(a)||(async()=>{try{const v=e(x).tags.filter(f=>f[0]==="code").map(f=>f[1]);if(v.length===0)return;const g=e(x).relay?.url||Array.from(e(x).onRelays)[0]?.url;let _;if(e(Ee)){const f=await jt(e(x).content,e(Ee));_=JSON.parse(f)}else _=JSON.parse(e(x).content);n(a,{..._,inviteEventId:e(x).id,inviteRelay:g,inviteCode:v[0],validCodes:v},!0)}catch(i){console.error("Failed to parse invite:",i)}})()});let Be=M(_t(new Set)),be=M(!1);pe(()=>{!e(x)||!e(a)||e(be)||(async()=>{n(be,!0);const i=e(a).inviteRelay;if(i)try{const v=await U.guardrailOff().fetchEvents({kinds:[514],"#e":[e(x).id]},{relayUrls:[i],subId:"invite-redemptions",cacheUsage:De.ONLY_RELAY}),g=new Set;for(const f of v){const k=f.tags.find(j=>j[0]==="code");k?.[1]&&g.add(k[1])}n(Be,g,!0);const _=e(a).validCodes?.filter(f=>!g.has(f))||[];_.length>0&&(e(a).inviteCode=_[0])}catch(v){console.error("Failed to fetch redemptions:",v)}})()});const et=O(()=>e(a)?.validCodes?e(a).validCodes.some(i=>!e(Be).has(i)):!1);let le=M(null);pe(()=>{const i=e(a)?.inviter;if(!i){n(le,null);return}U.fetchUser(i).then(v=>{v?.fetchProfile().then(g=>{n(le,g,!0)})})});const tt=O(()=>!e(E)||!e(a)),Le=O(()=>{if(!e(E)||xe.events.length===0&&xe.eosed)return d()("onboarding.invite.inviteNotFound");if(e(a)&&!e(et)&&e(be)){const i=e(a).inviter?"them":"the inviter";return d()("onboarding.invite.inviteReachedMax",{values:{inviter:i}})}return null});let _e=M(!1),b=M(!1),V=M(null),D=M(""),y=M("");function rt(){e(a)&&(We.setInvite({welcomeMessage:e(a).welcomeMessage,recipientName:e(a).recipientName,cashuToken:e(a).cashuToken,inviter:e(a).inviter,inviteEventId:e(a).inviteEventId,inviteRelay:e(a).inviteRelay,inviteCode:e(a).inviteCode}),he("/onboarding"))}function at(){e(a)&&We.setInvite({welcomeMessage:e(a).welcomeMessage,recipientName:e(a).recipientName,cashuToken:e(a).cashuToken,inviter:e(a).inviter,inviteEventId:e(a).inviteEventId,inviteRelay:e(a).inviteRelay,inviteCode:e(a).inviteCode}),n(_e,!0)}async function ot(){if(!window.nostr){n(y,"No Nostr extension found. Please install Alby or nos2x.");return}if(!U.$sessions){n(y,"Sessions not available");return}try{n(b,!0),n(y,"");const i=new Mt;await U.$sessions.login(i),he("/onboarding")}catch(i){n(y,i instanceof Error?i.message:"Failed to login",!0)}finally{n(b,!1)}}async function Pe(){if(!e(D).trim()){n(y,"Please enter your nsec");return}if(!U.$sessions){n(y,"Sessions not available");return}try{n(b,!0),n(y,"");const i=new Ct(e(D).trim());await U.$sessions.login(i),he("/onboarding")}catch(i){n(y,i instanceof Error?i.message:"Invalid nsec",!0)}finally{n(b,!1)}}var ke=Dt(),Re=t(ke),it=t(Re);{var nt=i=>{var v=St(),g=t(v),_=o(t(g),2),f=t(_,!0);r(_),r(g),r(v),Q(k=>l(f,k),[()=>d()("onboarding.invite.loadingInvite")]),s(i,v)},st=i=>{var v=me(),g=K(v);{var _=k=>{var j=Ht(),X=t(j),Z=o(t(X),2),we=t(Z,!0);r(Z);var ee=o(Z,2),B=t(ee,!0);r(ee);var $=o(ee,2);$.__click=()=>he("/");var F=t($,!0);r($),r(X),r(j),Q((J,W)=>{l(we,J),l(B,e(Le)),l(F,W)},[()=>d()("onboarding.invite.inviteNotFound"),()=>d()("onboarding.invite.goHome")]),s(k,j)},f=k=>{var j=Vt(),X=o(t(j),2),Z=t(X);{var we=B=>{var $=Bt(),F=K($);{var J=H=>{var A=At(),R=t(A),q=t(R),je=t(q);Ke(je,()=>Je.Root,(ie,Se)=>{Se(ie,{get ndk(){return U},get pubkey(){return e(a).inviter},children:(ft,Jt)=>{var Oe=me(),gt=K(Oe);Ke(gt,()=>Je.Avatar,(mt,pt)=>{pt(mt,{class:"w-full h-full object-cover [&>*]:w-full [&>*]:h-full [&>*]:object-cover"})}),s(ft,Oe)},$$slots:{default:!0}})}),r(q),r(R);var fe=o(R,2),oe=t(fe),Ne=t(oe,!0);r(oe);var ge=o(oe,2),Ie=t(ge,!0);r(ge),r(fe),r(A),Q(ie=>{l(Ne,e(le)?.displayName||e(le)?.name||"Someone"),l(Ie,ie)},[()=>d()("onboarding.invite.invitedYou")]),s(H,A)};C(F,H=>{e(a)?.inviter&&H(J)})}var W=o(F,2);{var ye=H=>{var A=Et(),R=t(A),q=t(R,!0);r(R),r(A),Q(()=>l(q,e(a).welcomeMessage)),s(H,A)};C(W,H=>{e(a)?.welcomeMessage&&H(ye)})}var te=o(W,2),re=t(te),m=t(re,!0);r(re);var p=o(re,2),L=t(p,!0);r(p),r(te);var P=o(te,2),N=t(P),h=o(t(N),2),I=t(h),w=t(I,!0);r(I);var T=o(I,2),ae=t(T,!0);r(T),r(h),r(N);var c=o(N,2),z=o(t(c),2),G=t(z),de=t(G,!0);r(G);var ve=o(G,2),$e=t(ve,!0);r(ve),r(z),r(c);var ce=o(c,2),S=o(t(ce),2),Y=t(S),lt=t(Y,!0);r(Y);var Ue=o(Y,2),dt=t(Ue,!0);r(Ue),r(S),r(ce),r(P);var Me=o(P,2),ue=t(Me);ue.__click=rt;var vt=t(ue);ne(),r(ue);var Ce=o(ue,2);Ce.__click=at;var Fe=t(Ce),Te=o(Fe),ct=t(Te,!0);r(Te),r(Ce),r(Me);var ze=o(Me,2),Ye=t(ze),ut=t(Ye,!0);r(Ye),r(ze),Q((H,A,R,q,je,fe,oe,Ne,ge,Ie,ie,Se)=>{l(m,H),l(L,A),l(w,R),l(ae,q),l(de,je),l($e,fe),l(lt,oe),l(dt,Ne),l(vt,`${ge??""} `),l(Fe,`${Ie??""}  `),l(ct,ie),l(ut,Se)},[()=>d()("onboarding.invite.yourVoiceMatters"),()=>d()("onboarding.invite.joinGlobal"),()=>d()("onboarding.invite.ownYourVoice.title"),()=>d()("onboarding.invite.ownYourVoice.description"),()=>d()("onboarding.invite.earnFromStories.title"),()=>d()("onboarding.invite.earnFromStories.description"),()=>d()("onboarding.invite.connectCommunity.title"),()=>d()("onboarding.invite.connectCommunity.description"),()=>d()("onboarding.invite.startJourney"),()=>d()("onboarding.invite.alreadyHaveAccount"),()=>d()("onboarding.invite.signInHere"),()=>d()("onboarding.invite.trustSignals")]),s(B,$)},ee=B=>{var $=Kt(),F=o(t($),4),J=t(F);{var W=m=>{var p=Lt(),L=t(p,!0);r(p),Q(()=>l(L,e(y))),s(m,p)};C(J,m=>{e(y)&&m(W)})}var ye=o(J,2);{var te=m=>{var p=Tt(),L=K(p);se(L,{variant:"outline",onclick:()=>{n(V,"nip07"),ot()},get disabled(){return e(b)},class:"w-full p-4 h-auto justify-start",children:(h,I)=>{var w=Rt(),T=o(K(w),4);{var ae=c=>{var z=Pt();s(c,z)};C(T,c=>{e(b)&&e(V)==="nip07"&&c(ae)})}s(h,w)},$$slots:{default:!0}});var P=o(L,2);se(P,{variant:"outline",onclick:()=>n(V,"nsec"),get disabled(){return e(b)},class:"w-full p-4 h-auto justify-start",children:(h,I)=>{var w=Ut();ne(2),s(h,w)},$$slots:{default:!0}});var N=o(P,4);se(N,{variant:"ghost",onclick:()=>n(_e,!1),class:"w-full",children:(h,I)=>{var w=Ft();s(h,w)},$$slots:{default:!0}}),s(m,p)},re=m=>{var p=me(),L=K(p);{var P=N=>{var h=Ot(),I=o(t(h),2);It(I,{type:"password",placeholder:"nsec1... or hex key",get disabled(){return e(b)},onkeydown:c=>{c.key==="Enter"&&e(D)&&Pe()},get value(){return e(D)},set value(c){n(D,c,!0)}});var w=o(I,2),T=t(w);se(T,{variant:"outline",onclick:()=>n(V,null),get disabled(){return e(b)},class:"flex-1",children:(c,z)=>{ne();var G=xt("Back");s(c,G)},$$slots:{default:!0}});var ae=o(T,2);{let c=O(()=>e(b)||!e(D).trim());se(ae,{onclick:Pe,get disabled(){return e(c)},class:"flex-1",children:(z,G)=>{var de=me(),ve=K(de);{var $e=S=>{var Y=zt();ne(),s(S,Y)},ce=S=>{var Y=Yt();ne(),s(S,Y)};C(ve,S=>{e(b)?S($e):S(ce,!1)})}s(z,de)},$$slots:{default:!0}})}r(w),r(h),s(N,h)};C(L,N=>{e(V)==="nsec"&&N(P)},!0)}s(m,p)};C(ye,m=>{e(V)?m(re,!1):m(te)})}r(F),r($),s(B,$)};C(Z,B=>{e(_e)?B(ee,!1):B(we)})}r(X),r(j),s(k,j)};C(g,k=>{e(Le)?k(_):k(f,!1)},!0)}s(i,v)};C(it,i=>{e(tt)?i(nt):i(st,!1)})}r(Re),r(ke),s(Ge,ke),kt(),Xe()}ht(["click"]);export{sr as component};
