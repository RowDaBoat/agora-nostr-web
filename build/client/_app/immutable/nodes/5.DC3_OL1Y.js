import{d as ke,f as x,a as m,c as ne,s as A}from"../chunks/CvdcXPsy.js";import{p as ce,s as $,b as we,u as ie,a as F,ay as Ie,d,c as r,r as t,e as fe,h as ee,g as e,f as P,t as D}from"../chunks/-h67YDCL.js";import{i as R}from"../chunks/DG6c9x1x.js";import{e as oe,i as Ae}from"../chunks/DBJvd_ZN.js";import{n as L,i as Pe,s as je,f as ge}from"../chunks/CAJmB2zv.js";import{h as ue}from"../chunks/Cu6qrFqU.js";import{c as K}from"../chunks/C52XBfTo.js";import{a as pe,b as be,s as Ne}from"../chunks/vjiKTA8K.js";import{U as q}from"../chunks/Dk4THxss.js";import{g as _e}from"../chunks/CAO0s-lY.js";import{f as Se}from"../chunks/KSN4Ur19.js";import{N as Te}from"../chunks/b8skZAYQ.js";import{P as Me}from"../chunks/bUK0MCKq.js";var Ee=x('<p class="text-muted-foreground text-center py-8">No invites yet in this Agora</p>'),Re=x('<p class="text-xs text-muted-foreground truncate"> </p>'),Be=x('<a class="relative bg-gradient-to-b from-primary/5 to-transparent border border-border rounded-xl p-6 hover:border-primary/50 transition-all hover:shadow-lg group"><div class="absolute -top-3 left-1/2 -translate-x-1/2"><div class="w-12 h-12 rounded-full bg-card border-2 border-border flex items-center justify-center text-2xl group-hover:border-primary transition-colors"> </div></div> <div class="flex justify-center mt-6 mb-4"><!></div> <div class="text-center mb-4"><h3 class="font-bold text-lg text-foreground truncate mb-1"> </h3> <!></div> <div class="bg-muted/50 rounded-lg p-3"><div class="text-center"><div class="text-3xl font-bold text-primary mb-1"> </div> <div class="text-xs text-muted-foreground"> </div></div></div> <div class="mt-3"><div class="h-1.5 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),Ue=x('<button class="w-full flex items-center justify-center gap-2 py-3 text-sm font-medium text-primary hover:text-primary/80 transition-colors"><span> </span> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>'),Ce=x('<a class="flex items-center gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors"><div class="flex items-center gap-3 flex-1"><span class="text-lg font-semibold text-muted-foreground w-8"> </span> <!> <div class="flex-1 min-w-0"><div class="font-medium text-foreground truncate"> </div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="hidden md:block w-32"><div class="h-2 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),Le=x('<div class="mt-4 space-y-2 border-t border-border pt-4"></div>'),Ve=x('<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6"></div> <!> <!>',1),Oe=x('<div><h2 class="text-xl font-bold text-foreground mb-6">ğŸ† Top Inviters</h2> <!></div>');function Ye(B,c){ce(c,!0);let p=$(!1);function w(s){return s===1?"ğŸ¥‡":s===2?"ğŸ¥ˆ":s===3?"ğŸ¥‰":""}const h=P(()=>c.stats.slice(0,3)),j=P(()=>c.stats.slice(3,10)),U=P(()=>Math.max(...c.stats.map(s=>s.successfulInvites),1));let N=$(we(new Map)),E=$(0);ie(()=>{console.log("[TopInvitersPodium] $effect running, stats count:",c.stats.length);const s=new Map;let i=0;const v=c.stats.length;if(v===0){F(N,s,!0);return}c.stats.forEach(n=>{L.fetchUser(n.pubkey).then(l=>{l?.fetchProfile().then(y=>{console.log("[TopInvitersPodium] Setting profile for",n.pubkey),s.set(n.pubkey,y||null),i++,i===v&&(F(N,s,!0),Ie(E))})})})});var S=Oe(),G=d(r(S),2);{var V=s=>{var i=Ee();m(s,i)},J=s=>{var i=Ve(),v=ee(i);oe(v,21,()=>e(h),o=>o.pubkey,(o,u)=>{const _=P(()=>e(N).get(e(u).pubkey));var g=Be(),a=r(g),f=r(a),I=r(f,!0);t(f),t(a);var k=d(a,2),ae=r(k);K(ae,()=>q.Root,(T,M)=>{M(T,{get ndk(){return L},get pubkey(){return e(u).pubkey},children:(C,Ze)=>{var me=ne(),xe=ee(me);K(xe,()=>q.Avatar,(he,ye)=>{ye(he,{class:"w-24 h-24 rounded-full ring-4 ring-primary/20"})}),m(C,me)},$$slots:{default:!0}})}),t(k);var O=d(k,2),Y=r(O),Q=r(Y,!0);t(Y);var de=d(Y,2);{var te=T=>{var M=Re(),C=r(M,!0);t(M),D(()=>A(C,e(_).nip05)),m(T,M)};R(de,T=>{e(_)?.nip05&&T(te)})}t(O);var W=d(O,2),X=r(W),H=r(X),ve=r(H,!0);t(H);var z=d(H,2),Z=r(z,!0);t(z),t(X),t(W);var re=d(W,2),le=r(re),se=r(le);t(le),t(re),t(g),D((T,M,C)=>{pe(g,"href",T),A(I,M),A(Q,e(_)?.displayName||e(_)?.name||"Anonymous"),A(ve,e(u).successfulInvites),A(Z,e(u).successfulInvites===1?"person joined":"people joined"),be(se,`width: ${C??""}%`)},[()=>_e(e(u).pubkey),()=>w(e(u).rank),()=>Math.min(100,e(u).successfulInvites/e(U)*100)]),m(o,g)}),t(v);var n=d(v,2);{var l=o=>{var u=Ue();u.__click=()=>F(p,!e(p));var _=r(u),g=r(_,!0);t(_);var a=d(_,2);t(u),D(()=>{A(g,e(p)?"Show Less":`View Top ${c.stats.length} Inviters`),Ne(a,0,`w-4 h-4 transition-transform duration-200 ${e(p)?"rotate-180":""}`)}),m(o,u)};R(n,o=>{c.stats.length>3&&o(l)})}var y=d(n,2);{var b=o=>{var u=Le();oe(u,21,()=>e(j),_=>_.pubkey,(_,g)=>{const a=P(()=>e(N).get(e(g).pubkey));var f=Ce(),I=r(f),k=r(I),ae=r(k);t(k);var O=d(k,2);K(O,()=>q.Root,(z,Z)=>{Z(z,{get ndk(){return L},get pubkey(){return e(g).pubkey},children:(re,le)=>{var se=ne(),T=ee(se);K(T,()=>q.Avatar,(M,C)=>{C(M,{class:"w-10 h-10 rounded-full"})}),m(re,se)},$$slots:{default:!0}})});var Y=d(O,2),Q=r(Y),de=r(Q,!0);t(Q);var te=d(Q,2),W=r(te);t(te),t(Y),t(I);var X=d(I,2),H=r(X),ve=r(H);t(H),t(X),t(f),D((z,Z)=>{pe(f,"href",z),A(ae,`${e(g).rank??""}.`),A(de,e(a)?.displayName||e(a)?.name||"Anonymous"),A(W,`${e(g).successfulInvites??""} ${e(g).successfulInvites===1?"person joined":"people joined"}`),be(ve,`width: ${Z??""}%`)},[()=>_e(e(g).pubkey),()=>Math.min(100,e(g).successfulInvites/e(U)*100)]),m(_,f)}),t(u),m(o,u)};R(y,o=>{e(p)&&e(j).length>0&&o(b)})}m(s,i)};R(G,s=>{c.stats.length===0?s(V):s(J,!1)})}t(S),m(B,S),fe()}ke(["click"]);var He=x('<div class="text-muted-foreground">Invited by <span class="font-medium text-primary"> </span></div>'),ze=x("<div></div>"),De=x('<div class="border border-border rounded-lg p-4 hover:border-primary/50 transition-colors"><div class="flex items-center gap-3 mb-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-lg">ğŸ‘‹</span> <span class="font-semibold text-foreground"> </span></div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="mb-3 text-foreground whitespace-pre-wrap line-clamp-4"> </div> <div class="flex items-center justify-between text-sm"><!></div></div>');function Ke(B,c){ce(c,!0);let p=$(null),w=$(null);ie(()=>{console.log("[IntroductionCard] $effect running for author:",c.event.pubkey),c.event.author.fetchProfile().then(b=>{F(p,b,!0)})}),ie(()=>{if(console.log("[IntroductionCard] $effect running for invitedBy:",c.invitedBy),!c.invitedBy){F(w,null);return}L.fetchUser(c.invitedBy).then(b=>{b?.fetchProfile().then(o=>{F(w,o,!0)})})});var h=De(),j=r(h),U=r(j);K(U,()=>q.Root,(b,o)=>{o(b,{get ndk(){return L},get pubkey(){return c.event.pubkey},children:(u,_)=>{var g=ne(),a=ee(g);K(a,()=>q.Avatar,(f,I)=>{I(f,{class:"w-12 h-12 rounded-full"})}),m(u,g)},$$slots:{default:!0}})});var N=d(U,2),E=r(N),S=d(r(E),2),G=r(S,!0);t(S),t(E);var V=d(E,2),J=r(V,!0);t(V),t(N),t(j);var s=d(j,2),i=r(s,!0);t(s);var v=d(s,2),n=r(v);{var l=b=>{var o=He(),u=d(r(o)),_=r(u);t(u),t(o),D(()=>A(_,`@${(e(w).name||"anonymous")??""}`)),m(b,o)},y=b=>{var o=ze();m(b,o)};R(n,b=>{e(w)?b(l):b(y,!1)})}t(v),t(h),D(b=>{A(G,e(p)?.displayName||e(p)?.name||"Anonymous"),A(J,b),A(i,c.event.content)},[()=>Se(c.event.created_at||0)]),m(B,h),fe()}const qe=B=>{Me(B,{title:"ğŸ† Agora Invites",subtitle:"Community growth and new members"})};var Fe=x('<div class="min-h-screen flex items-center justify-center p-4"><div class="text-center"><svg class="w-16 h-16 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <h2 class="text-xl font-semibold text-foreground mb-2">Select an Agora</h2> <p class="text-muted-foreground">This page shows community invites for a specific Agora</p></div></div>'),Ge=x('<p class="text-muted-foreground text-center py-8">No new members yet</p>'),Je=x('<div class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>'),Qe=x('<p class="text-muted-foreground text-center py-8">No introductions yet</p>'),We=x('<div class="space-y-4"></div>'),Xe=x('<div class="w-full lg:max-w-4xl mx-auto p-4 space-y-6"><!> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">ğŸ‘‹ New Members</h2> <!></div> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">ğŸ’¬ Introductions</h2> <!></div></div>');function ct(B,c){ce(c,!0);const p=P(()=>je.selectedRelay),w=P(()=>e(p)?Pe(e(p)):!1),h=P(()=>(console.log("[INVITES] redemptionsSubscription $derived.by running",{selectedRelay:e(p),isAgora:e(w)}),!e(p)||!e(w)?null:L.$subscribe(()=>({filters:[{kinds:[514]}],relayUrls:[e(p)],subId:"invite-redemptions",cacheUsage:ge.ONLY_RELAY,closeOnEose:!0})))),j=P(()=>(console.log("[INVITES] introductionsSubscription $derived.by running",{selectedRelay:e(p),isAgora:e(w)}),!e(p)||!e(w)?null:L.$subscribe(()=>({filters:[{kinds:[1],"#t":["introduction"],limit:20}],relayUrls:[e(p)],cacheUsage:ge.ONLY_RELAY,exclusiveRelay:!0,closeOnEose:!0})))),U=P(()=>{if(console.log("[INVITES] inviterStats $derived.by running",e(h)?.events.length),!e(h))return[];const s=e(h).events,i=new Map;for(const n of s){const l=n.tags.find(y=>y[0]==="p");if(l?.[1]){const y=l[1];i.set(y,(i.get(y)||0)+1)}}const v=Array.from(i.entries()).map(([n,l])=>({pubkey:n,totalInvites:l,successfulInvites:l,rank:0}));return v.sort((n,l)=>l.successfulInvites-n.successfulInvites),v.forEach((n,l)=>{n.rank=l+1}),v.slice(0,10)}),N=P(()=>{if(console.log("[INVITES] introductions $derived.by running",e(j)?.events.length,e(h)?.events.length),!e(j)||!e(h))return[];const s=e(j).events,i=e(h).events,v=new Map;for(const n of i){const l=n.tags.find(y=>y[0]==="p");l&&l[1]&&v.set(n.pubkey,l[1])}return s.map(n=>({event:n,invitedBy:v.get(n.pubkey)||null})).sort((n,l)=>(l.event.created_at||0)-(n.event.created_at||0)).slice(0,10)}),E=P(()=>(console.log("[INVITES] newMembers $derived.by running",e(h)?.events.length),e(h)?e(h).events.map(i=>{const v=i.tags.find(n=>n[0]==="p");return{memberPubkey:i.pubkey,inviterPubkey:v?.[1]||null,joinedAt:i.created_at||0}}).sort((i,v)=>v.joinedAt-i.joinedAt).slice(0,20):[]));ie(()=>(e(w)?ue.header=qe:ue.clear(),()=>{ue.clear()}));var S=ne(),G=ee(S);{var V=s=>{var i=Fe();m(s,i)},J=s=>{var i=Xe(),v=r(i);Ye(v,{get stats(){return e(U)}});var n=d(v,2),l=d(r(n),2);{var y=a=>{var f=Ge();m(a,f)},b=a=>{var f=Je();oe(f,21,()=>e(E).slice(0,6),Ae,(I,k)=>{Te(I,{get memberPubkey(){return e(k).memberPubkey},get inviterPubkey(){return e(k).inviterPubkey},get joinedAt(){return e(k).joinedAt}})}),t(f),m(a,f)};R(l,a=>{e(E).length===0?a(y):a(b,!1)})}t(n);var o=d(n,2),u=d(r(o),2);{var _=a=>{var f=Qe();m(a,f)},g=a=>{var f=We();oe(f,21,()=>e(N),I=>I.event.id,(I,k)=>{Ke(I,{get event(){return e(k).event},get invitedBy(){return e(k).invitedBy}})}),t(f),m(a,f)};R(u,a=>{e(N).length===0?a(_):a(g,!1)})}t(o),t(i),m(s,i)};R(G,s=>{e(w)?s(J,!1):s(V)})}m(B,S),fe()}export{ct as component};
