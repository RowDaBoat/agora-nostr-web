import{f as v,c as te,a as s,s as B,d as He}from"../chunks/CvdcXPsy.js";import{p as ke,u as pe,a as p,s as q,c as a,h as L,d,g as e,r,t as C,e as we,f as W}from"../chunks/-h67YDCL.js";import{i as g}from"../chunks/DG6c9x1x.js";import{e as Fe}from"../chunks/DBJvd_ZN.js";import{s as ee,a as xe}from"../chunks/vjiKTA8K.js";import{s as Se,a as Ge}from"../chunks/CptlhHpT.js";import{n as M,a as Je,N as Oe}from"../chunks/CAJmB2zv.js";import{p as Qe}from"../chunks/aVfrvTxa.js";import{g as Ve}from"../chunks/D1jhUNbu.js";import{t as he}from"../chunks/DqdFoxb9.js";import{f as Ae}from"../chunks/ClJwdCiS.js";import{U as ve}from"../chunks/Dk4THxss.js";import{A as We,N as Xe}from"../chunks/Cq1keEic.js";import{C as Ye}from"../chunks/s_lyd6x4.js";import{c as E}from"../chunks/C52XBfTo.js";import{p as de}from"../chunks/6dG0wjw8.js";import{F as Ze}from"../chunks/C0u-ace5.js";import{f as $e}from"../chunks/KSN4Ur19.js";import{F as me}from"../chunks/C6TKWL_4.js";import{g as et}from"../chunks/sNEEs8rM.js";var tt=v('<p class="text-sm text-muted-foreground truncate"> </p>'),rt=v('<a class="block group"><h4 class="font-semibold text-foreground group-hover:text-primary transition-colors truncate"> </h4> <!></a>'),at=v('<p class="text-sm text-muted-foreground truncate"> </p>'),ot=v('<h4 class="font-semibold text-foreground truncate"> </h4> <!>',1),st=v("<span> </span>"),lt=v("<span>â€¢</span>"),nt=v('<!> <span>Invited by <a class="text-primary hover:underline"> </a></span>',1),it=v('<div class="flex items-center gap-2 mt-1 text-xs text-muted-foreground"><!> <!></div>'),dt=v('<p class="mt-2 text-sm text-foreground/80 line-clamp-2"> </p>'),vt=v('<div class="flex-shrink-0"><!></div>'),ut=v('<div><!> <div class="flex-1 min-w-0"><div class="flex items-start justify-between gap-2"><div class="flex-1 min-w-0"><!> <!> <!></div> <!></div></div></div>');function ct(re,n){ke(n,!0);let ae=de(n,"showFollow",3,!0),H=de(n,"showAbout",3,!0),X=de(n,"clickable",3,!0),S=de(n,"class",3,"");console.log("called usercard with",{pubkey:n.pubkey});let G=q(void 0),_=q(null),b=q(void 0),A=q(null);pe(()=>{M.fetchUser(n.pubkey).then(o=>{p(G,o,!0),o?.fetchProfile().then(l=>{p(_,l,!0)})})}),pe(()=>{if(!n.inviterPubkey){p(b,void 0),p(A,null);return}M.fetchUser(n.inviterPubkey).then(o=>{p(b,o,!0),o?.fetchProfile().then(l=>{p(A,l,!0)})})});var i=ut(),U=a(i);E(U,()=>ve.Root,(o,l)=>{l(o,{get ndk(){return M},get pubkey(){return n.pubkey},children:(f,y)=>{var P=te(),N=L(P);E(N,()=>ve.Avatar,(u,t)=>{t(u,{class:"w-12 h-12 rounded-full"})}),s(f,P)},$$slots:{default:!0}})});var h=d(U,2),D=a(h),z=a(D),J=a(z);{var O=o=>{var l=rt(),f=a(l),y=a(f,!0);r(f);var P=d(f,2);{var N=u=>{var t=tt(),x=a(t,!0);r(t),C(()=>B(x,e(_).nip05)),s(u,t)};g(P,u=>{e(_)?.nip05&&u(N)})}r(l),C(()=>{xe(l,"href",`/p/${e(G).npub??""}`),B(y,e(_)?.displayName||e(_)?.name||"Anon")}),s(o,l)},I=o=>{var l=ot(),f=L(l),y=a(f,!0);r(f);var P=d(f,2);{var N=u=>{var t=at(),x=a(t,!0);r(t),C(()=>B(x,e(_).nip05)),s(u,t)};g(P,u=>{e(_)?.nip05&&u(N)})}C(()=>B(y,e(_)?.displayName||e(_)?.name||"Anon")),s(o,l)};g(J,o=>{X()?o(O):o(I,!1)})}var Y=d(J,2);{var oe=o=>{var l=it(),f=a(l);{var y=u=>{var t=st(),x=a(t);r(t),C(K=>B(x,`Joined ${K??""}`),[()=>$e(n.joinedAt)]),s(u,t)};g(f,u=>{n.joinedAt&&u(y)})}var P=d(f,2);{var N=u=>{var t=nt(),x=L(t);{var K=F=>{var le=lt();s(F,le)};g(x,F=>{n.joinedAt&&F(K)})}var R=d(x,2),T=d(a(R)),j=a(T,!0);r(T),r(R),C(()=>{xe(T,"href",`/p/${e(b)?.npub??""}`),B(j,e(A).displayName||e(A).name||"someone")}),s(u,t)};g(P,u=>{n.inviterPubkey&&e(A)&&u(N)})}r(l),s(o,l)};g(Y,o=>{(n.joinedAt||n.inviterPubkey)&&o(oe)})}var k=d(Y,2);{var w=o=>{var l=dt(),f=a(l,!0);r(l),C(()=>B(f,e(_).about)),s(o,l)};g(k,o=>{H()&&e(_)?.about&&o(w)})}r(z);var se=d(z,2);{var Q=o=>{var l=vt(),f=a(l);Ze(f,{get ndk(){return M},get target(){return n.pubkey}}),r(l),s(o,l)};g(se,o=>{ae()&&o(Q)})}r(D),r(h),r(i),C(()=>ee(i,1,`flex items-start gap-3 p-4 bg-card rounded-lg border border-border hover:border-primary/30 transition-colors ${S()??""}`)),s(re,i),we()}var ft=v('<div class="flex items-center gap-2 text-xs opacity-70 mb-auto"><!> <!></div>'),mt=v('<button data-follow-pack-hero="" type="button"><!> <div class="absolute inset-0 z-[5] bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div> <div class="absolute inset-0 z-10 h-full flex flex-col p-8 text-white text-left"><div class="space-y-4 flex flex-col h-full justify-end"><!> <!> <div class="flex items-center gap-4 text-sm"><!> <!></div></div></div></button>');function pt(re,n){ke(n,!0);let ae=de(n,"class",3,"");const H=et(n.ndk);var X=te(),S=L(X);E(S,()=>me.Root,(G,_)=>{_(G,{get ndk(){return H},get followPack(){return n.followPack},get onclick(){return n.onclick},children:(b,A)=>{var i=mt(),U=a(i);E(U,()=>me.Image,(k,w)=>{w(k,{class:"absolute inset-0 w-full h-full z-0",showGradient:!0})});var h=d(U,4),D=a(h),z=a(D);E(z,()=>me.Title,(k,w)=>{w(k,{class:"text-4xl font-bold text-left",lines:2})});var J=d(z,2);E(J,()=>me.Description,(k,w)=>{w(k,{class:"text-base max-w-2xl text-left",maxLength:200,lines:2})});var O=d(J,2),I=a(O);We(I,{get ndk(){return H},get pubkeys(){return n.followPack.pubkeys},max:5,size:32,spacing:"loose"});var Y=d(I,2);{var oe=k=>{var w=te(),se=L(w);E(se,()=>ve.Root,(Q,o)=>{o(Q,{get ndk(){return H},get user(){return n.followPack.author},class:"flex-1 flex flex-col items-end",children:(l,f)=>{var y=ft(),P=a(y);E(P,()=>ve.Avatar,(u,t)=>{t(u,{class:"w-5 h-5"})});var N=d(P,2);E(N,()=>ve.Name,(u,t)=>{t(u,{class:"text-xs"})}),r(y),s(l,y)},$$slots:{default:!0}})}),s(k,w)};g(Y,k=>{n.followPack.author&&k(oe)})}r(O),r(D),r(h),r(i),C(()=>ee(i,1,`group relative w-full h-[400px] rounded-3xl overflow-hidden bg-card hover:shadow-2xl transition-shadow ${ae()??""}`)),s(b,i)},$$slots:{default:!0}})}),s(re,X),we()}var gt=v('<button class="flex items-center gap-2 px-4 py-2 bg-muted hover:bg-muted/80 text-foreground font-medium rounded-lg transition-colors whitespace-nowrap svelte-1xwqwht"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg> Edit Pack</button>'),_t=v('<button class="flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 disabled:bg-muted text-primary-foreground font-medium rounded-lg transition-colors whitespace-nowrap svelte-1xwqwht"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg> </button>'),bt=v('<div class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary"></div>'),ht=v('<div class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary"></div>'),xt=v('<div class="p-8 text-center text-muted-foreground">Loading notes from pack members...</div>'),kt=v('<div class="p-8 text-center text-muted-foreground">No notes found from pack members</div>'),wt=v('<div class="divide-y divide-neutral-800/50 border-y border-border"><!></div>'),yt=v('<div class="grid gap-4 md:grid-cols-2"></div>'),Pt=v('<!> <div class="action-bar bg-card border border-border rounded-xl p-4 mb-6 svelte-1xwqwht"><div class="flex items-center justify-between svelte-1xwqwht"><div class="flex items-center gap-2 svelte-1xwqwht"><!> <button><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button></div></div></div> <div class="border-b border-border mb-6"><div class="flex gap-6"><button>Feed <!></button> <button> <!></button></div></div> <!>',1),Ft=v('<div class="text-center py-12"><div class="inline-block w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mb-4"></div> <p class="text-muted-foreground">Loading follow pack...</p></div>'),At=v('<div class="text-center py-12"><p class="text-muted-foreground">Follow pack not found</p> <button class="text-primary hover:text-primary/90 mt-4 inline-block transition-colors">Browse all packs</button></div>'),Nt=v('<div class="pack-detail-container svelte-1xwqwht"><div class="pack-header svelte-1xwqwht"><button class="back-btn svelte-1xwqwht"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> <span>Back to Packs</span></button></div> <div class="pack-content svelte-1xwqwht"><!> <!></div></div>');function Vt(re,n){ke(n,!0);const ae=()=>Ge(Qe,"$page",H),[H,X]=Se();let S=q(!1),G=q(null);const _=W(()=>ae().params.packId);let b=q("feed"),A=q(!1),i=q(null),U=q(!0);pe(()=>{e(_)&&(p(U,!0),M.fetchEvent(e(_)).then(t=>{t&&p(i,Je.from(t),!0),p(U,!1)}).catch(t=>{console.error("Failed to fetch pack:",t),p(U,!1)}))});let h=W(()=>e(i)?.tags.filter(t=>t[0]==="p").map(t=>t[1])||[]),D=q(null);pe(()=>{if(!e(i)?.author){p(D,null);return}e(i).author.fetchProfile().then(t=>{p(D,t,!0)})});let z=W(()=>e(i)?Ae.isFavorite(e(i).id):!1),J=W(()=>e(i)&&M.$currentUser?e(i).pubkey===M.$currentUser.pubkey:!1);const O=W(()=>e(b)==="feed"&&e(h).length>0?(console.log(`[FollowPackDetail] Creating subscription for ${e(h).length} members`),M.$subscribe(()=>({filters:[{kinds:[Oe.Text],authors:e(h),limit:50}],bufferMs:100}))):null),I=W(()=>e(O)?.events||[]),Y=W(()=>e(O)?.eosed||!1);function oe(){e(i)&&Ae.toggleFavorite(e(i).id)}async function k(){if(!e(i)||!M.activeUser||e(h).length===0){he.error("Please login to follow users");return}p(A,!0);try{he.success(`Following ${e(h).length} users`),M.$follows.add(e(h))}catch(t){console.error("Error following all users:",t),he.error("Failed to follow users")}finally{p(A,!1)}}function w(){Ve("/packs")}function se(){e(i)&&(p(G,e(i),!0),p(S,!0))}var Q=Nt(),o=a(Q),l=a(o);l.__click=w,r(o);var f=d(o,2),y=a(f);{var P=t=>{var x=Pt(),K=L(x);pt(K,{get ndk(){return M},get followPack(){return e(i)},class:"mb-6"});var R=d(K,2),T=a(R),j=a(T),F=a(j);{var le=c=>{var m=gt();m.__click=se,s(c,m)},Ne=c=>{var m=_t();m.__click=k;var V=d(a(m));r(m),C(()=>{m.disabled=e(A),B(V,` ${e(A)?"Following...":"Follow All"}`)}),s(c,m)};g(F,c=>{e(J)?c(le):c(Ne,!1)})}var ne=d(F,2);ne.__click=oe;var je=a(ne);r(ne),r(j),r(T),r(R);var ge=d(R,2),ye=a(ge),ie=a(ye);ie.__click=()=>p(b,"feed");var Ce=d(a(ie));{var qe=c=>{var m=bt();s(c,m)};g(Ce,c=>{e(b)==="feed"&&c(qe)})}r(ie);var ue=d(ie,2);ue.__click=()=>p(b,"members");var Pe=a(ue),Me=d(Pe);{var Ue=c=>{var m=ht();s(c,m)};g(Me,c=>{e(b)==="members"&&c(Ue)})}r(ue),r(ye),r(ge);var ze=d(ge,2);{var Be=c=>{var m=wt(),V=a(m);{var _e=Z=>{var ce=xt();s(Z,ce)},Le=Z=>{var ce=te(),De=L(ce);{var Ie=$=>{var fe=kt();s($,fe)},Ke=$=>{var fe=te(),Re=L(fe);Fe(Re,17,()=>e(I),be=>be.id,(be,Te)=>{Xe(be,{get event(){return e(Te)}})}),s($,fe)};g(De,$=>{e(I).length===0?$(Ie):$(Ke,!1)},!0)}s(Z,ce)};g(V,Z=>{e(I).length===0&&!e(Y)?Z(_e):Z(Le,!1)})}r(m),s(c,m)},Ee=c=>{var m=yt();Fe(m,20,()=>e(h),V=>V,(V,_e)=>{ct(V,{get pubkey(){return _e}})}),r(m),s(c,m)};g(ze,c=>{e(b)==="feed"?c(Be):c(Ee,!1)})}C(()=>{ee(ne,1,`p-2.5 rounded-lg transition-colors ${e(z)?"bg-red-500/10 text-red-500":"bg-muted text-muted-foreground hover:text-foreground"}`),xe(ne,"title",e(z)?"Remove from favorites":"Add to favorites"),ee(je,0,`w-5 h-5 ${e(z)?"fill-current":""}`),ee(ie,1,`pb-3 px-1 font-medium transition-colors relative ${e(b)==="feed"?"text-foreground":"text-muted-foreground hover:text-foreground"}`),ee(ue,1,`pb-3 px-1 font-medium transition-colors relative ${e(b)==="members"?"text-foreground":"text-muted-foreground hover:text-foreground"}`),B(Pe,`Members (${e(h).length??""}) `)}),s(t,x)},N=t=>{var x=te(),K=L(x);{var R=j=>{var F=Ft();s(j,F)},T=j=>{var F=At(),le=d(a(F),2);le.__click=w,r(F),s(j,F)};g(K,j=>{e(U)?j(R):j(T,!1)},!0)}s(t,x)};g(y,t=>{e(i)?t(P):t(N,!1)})}var u=d(y,2);Ye(u,{get editingPack(){return e(G)},get open(){return e(S)},set open(t){p(S,t,!0)}}),r(f),r(Q),s(re,Q),we(),X()}He(["click"]);export{Vt as component};
