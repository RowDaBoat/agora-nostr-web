import{d as G,f as m,s as q,a as r,c as P,t as J}from"../chunks/CvdcXPsy.js";import{p as B,u as ee,a as O,s as K,c as i,d as x,r as l,t as V,g as A,e as R,h,n as te}from"../chunks/-h67YDCL.js";import{i as M}from"../chunks/DG6c9x1x.js";import{n as z}from"../chunks/CAJmB2zv.js";import{e as re}from"../chunks/DBJvd_ZN.js";import{c as N}from"../chunks/C52XBfTo.js";import{g as Q}from"../chunks/D1jhUNbu.js";import{U as F}from"../chunks/Dk4THxss.js";import{T as ae}from"../chunks/CSxV4X3F.js";import{D as se,a as oe,R as ne}from"../chunks/y2uKFtaO.js";import{U as ie}from"../chunks/DNu_4apC.js";import{D as le}from"../chunks/BFIKOW_n.js";import{m as ve}from"../chunks/BL8Mvof4.js";var de=m('<div class="text-xs text-neutral-500 flex-shrink-0 ml-2"><!></div>'),ce=m('<span class="text-neutral-500">You:</span>'),fe=m("<!> ",1),ue=m('<div class="ml-2 flex-shrink-0 min-w-[20px] h-5 px-1.5 rounded-full bg-primary flex items-center justify-center"><span class="text-xs font-bold text-primary-foreground"> </span></div>'),me=m('<button class="w-full flex items-center gap-3 px-4 py-4 hover:bg-neutral-900/50 transition-colors text-left"><!> <div class="flex-1 min-w-0"><div class="flex items-center justify-between mb-1"><div class="font-semibold text-white truncate"> </div> <!></div> <div class="flex items-center justify-between"><p class="text-sm text-neutral-400 truncate flex-1"><!></p> <!></div></div></button>');function ge(_,a){B(a,!0);const o=a.conversation.getOtherParticipant(),v=a.conversation.getLastMessage();let c=K(null);ee(()=>{if(!o?.pubkey){O(c,null);return}z.fetchUser(o.pubkey).then(e=>{e?.fetchProfile().then(t=>{O(c,t,!0)})})});function f(){o&&Q(`/messages/${o.npub}`)}var s=me();s.__click=f;var n=i(s);{var C=e=>{var t=P(),u=h(t);N(u,()=>F.Root,(w,y)=>{y(w,{get ndk(){return z},get pubkey(){return o.pubkey},children:(j,L)=>{var E=P(),W=h(E);N(W,()=>F.Avatar,(X,Z)=>{Z(X,{class:"w-12 h-12 flex-shrink-0"})}),r(j,E)},$$slots:{default:!0}})}),r(e,t)};M(n,e=>{o&&e(C)})}var d=x(n,2),g=i(d),b=i(g),S=i(b,!0);l(b);var D=x(b,2);{var p=e=>{var t=de(),u=i(t);ae(u,{get timestamp(){return v.timestamp}}),l(t),r(e,t)};M(D,e=>{v&&e(p)})}l(g);var k=x(g,2),U=i(k),$=i(U);{var H=e=>{var t=fe(),u=h(t);{var w=j=>{var L=ce();r(j,L)};M(u,j=>{v.sender.pubkey===z.activeUser?.pubkey&&j(w)})}var y=x(u);V(()=>q(y,` ${v.content??""}`)),r(e,t)},I=e=>{var t=J("No messages yet");r(e,t)};M($,e=>{v?e(H):e(I,!1)})}l(U);var T=x(U,2);{var Y=e=>{var t=ue(),u=i(t),w=i(u,!0);l(u),l(t),V(y=>q(w,y),[()=>a.conversation.getUnreadCount()>99?"99+":a.conversation.getUnreadCount()]),r(e,t)};M(T,e=>{a.conversation.getUnreadCount()>0&&e(Y)})}l(k),l(d),l(s),V(()=>q(S,A(c)?.name||A(c)?.displayName||"Anonymous")),r(_,s),R()}G(["click"]);var pe=m(`<div class="flex flex-col items-center justify-center py-16 px-6 text-center"><svg class="w-20 h-20 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <h3 class="text-xl font-semibold text-white mb-2">No messages yet</h3> <p class="text-neutral-400 max-w-sm">Start a conversation by visiting someone's profile and clicking the message button</p></div>`),xe=m('<div class="divide-y divide-neutral-800/50"><!></div>');function he(_,a){B(a,!0);var o=xe(),v=i(o);{var c=s=>{var n=pe();r(s,n)},f=s=>{var n=P(),C=h(n);re(C,17,()=>a.conversations,d=>d.id,(d,g)=>{ge(d,{get conversation(){return A(g)}})}),r(s,n)};M(v,s=>{a.conversations.length===0?s(c):s(f,!1)})}l(o),r(_,o),R()}var _e=m("<!> <!>",1);function be(_,a){B(a,!0);function o(f){Q(`/messages/${f.npub}`),a.onClose()}var v=P(),c=h(v);N(c,()=>ne,(f,s)=>{s(f,{get open(){return a.isOpen},onOpenChange:n=>{n||a.onClose()},children:(n,C)=>{var d=P(),g=h(d);N(g,()=>se,(b,S)=>{S(b,{class:"max-w-md",children:(D,p)=>{var k=_e(),U=h(k);N(U,()=>le,(H,I)=>{I(H,{children:(T,Y)=>{var e=P(),t=h(e);N(t,()=>oe,(u,w)=>{w(u,{children:(y,j)=>{te();var L=J("New Message");r(y,L)},$$slots:{default:!0}})}),r(T,e)},$$slots:{default:!0}})});var $=x(U,2);ie($,{get ndk(){return z},onSelect:o,placeholder:"Search by name, NIP-05, or paste npub..."}),r(D,k)},$$slots:{default:!0}})}),r(n,d)},$$slots:{default:!0}})}),r(_,v),R()}var ke=m('<div class="flex flex-col items-center justify-center h-full px-6 text-center"><svg class="w-20 h-20 text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <h3 class="text-xl font-semibold text-foreground mb-2">Sign in required</h3> <p class="text-muted-foreground max-w-sm">Please sign in to view and send direct messages</p></div>'),we=m('<div class="h-full flex flex-col"><div class="sticky top-0 z-10 bg-background border-b border-border/50 px-4 py-3"><div class="flex items-center justify-between"><h1 class="text-xl font-bold text-foreground">Messages</h1> <button class="p-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-primary" title="New message"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="flex-1 overflow-y-auto"><!></div></div> <!>',1);function Be(_,a){B(a,!0);let o=K(!1);function v(){O(o,!0)}var c=we(),f=h(c),s=i(f),n=i(s),C=x(i(n),2);C.__click=v,l(n),l(s);var d=x(s,2),g=i(d);{var b=p=>{var k=ke();r(p,k)},S=p=>{he(p,{get conversations(){return ve.conversations}})};M(g,p=>{z.$currentUser?p(S,!1):p(b)})}l(d),l(f);var D=x(f,2);be(D,{get isOpen(){return A(o)},onClose:()=>O(o,!1)}),r(_,c),R()}G(["click"]);export{Be as component};
