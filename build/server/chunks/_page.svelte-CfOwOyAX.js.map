{"version":3,"file":"_page.svelte-CfOwOyAX.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(app)/messages/_page.svelte.js"],"sourcesContent":["import \"clsx\";\nimport { n as ndk } from \"../../../../chunks/ndk.svelte.js\";\nimport { e as ensure_array_like } from \"../../../../chunks/index2.js\";\nimport { e as escape_html } from \"../../../../chunks/escaping.js\";\nimport \"@sveltejs/kit/internal\";\nimport \"../../../../chunks/exports.js\";\nimport \"../../../../chunks/utils.js\";\nimport \"@sveltejs/kit/internal/server\";\nimport \"../../../../chunks/state.svelte.js\";\nimport { U as User } from \"../../../../chunks/index4.js\";\nimport { T as TimeAgo } from \"../../../../chunks/TimeAgo.js\";\nimport { g as goto } from \"../../../../chunks/client.js\";\nimport { R as Root, D as Dialog_content, a as Dialog_title } from \"../../../../chunks/index3.js\";\nimport { U as User_search_combobox, m as messagesStore } from \"../../../../chunks/user-search-combobox.js\";\nimport { D as Dialog_header } from \"../../../../chunks/dialog-header.js\";\nfunction ConversationListItem($$renderer, $$props) {\n  $$renderer.component(($$renderer2) => {\n    const { conversation } = $$props;\n    const participant = conversation.getOtherParticipant();\n    const lastMessage = conversation.getLastMessage();\n    $$renderer2.push(`<button class=\"w-full flex items-center gap-3 px-4 py-4 hover:bg-neutral-900/50 transition-colors text-left\">`);\n    if (participant) {\n      $$renderer2.push(\"<!--[-->\");\n      $$renderer2.push(`<!---->`);\n      User.Root($$renderer2, {\n        ndk,\n        pubkey: participant.pubkey,\n        children: ($$renderer3) => {\n          $$renderer3.push(`<!---->`);\n          User.Avatar($$renderer3, { class: \"w-12 h-12 flex-shrink-0\" });\n          $$renderer3.push(`<!---->`);\n        },\n        $$slots: { default: true }\n      });\n      $$renderer2.push(`<!---->`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n    }\n    $$renderer2.push(`<!--]--> <div class=\"flex-1 min-w-0\"><div class=\"flex items-center justify-between mb-1\"><div class=\"font-semibold text-white truncate\">${escape_html(\"Anonymous\")}</div> `);\n    if (lastMessage) {\n      $$renderer2.push(\"<!--[-->\");\n      $$renderer2.push(`<div class=\"text-xs text-neutral-500 flex-shrink-0 ml-2\">`);\n      TimeAgo($$renderer2, { timestamp: lastMessage.timestamp });\n      $$renderer2.push(`<!----></div>`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n    }\n    $$renderer2.push(`<!--]--></div> <div class=\"flex items-center justify-between\"><p class=\"text-sm text-neutral-400 truncate flex-1\">`);\n    if (lastMessage) {\n      $$renderer2.push(\"<!--[-->\");\n      if (lastMessage.sender.pubkey === ndk.activeUser?.pubkey) {\n        $$renderer2.push(\"<!--[-->\");\n        $$renderer2.push(`<span class=\"text-neutral-500\">You:</span>`);\n      } else {\n        $$renderer2.push(\"<!--[!-->\");\n      }\n      $$renderer2.push(`<!--]--> ${escape_html(lastMessage.content)}`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n      $$renderer2.push(`No messages yet`);\n    }\n    $$renderer2.push(`<!--]--></p> `);\n    if (conversation.getUnreadCount() > 0) {\n      $$renderer2.push(\"<!--[-->\");\n      $$renderer2.push(`<div class=\"ml-2 flex-shrink-0 min-w-[20px] h-5 px-1.5 rounded-full bg-primary flex items-center justify-center\"><span class=\"text-xs font-bold text-primary-foreground\">${escape_html(conversation.getUnreadCount() > 99 ? \"99+\" : conversation.getUnreadCount())}</span></div>`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n    }\n    $$renderer2.push(`<!--]--></div></div></button>`);\n  });\n}\nfunction ConversationList($$renderer, $$props) {\n  $$renderer.component(($$renderer2) => {\n    const { conversations } = $$props;\n    $$renderer2.push(`<div class=\"divide-y divide-neutral-800/50\">`);\n    if (conversations.length === 0) {\n      $$renderer2.push(\"<!--[-->\");\n      $$renderer2.push(`<div class=\"flex flex-col items-center justify-center py-16 px-6 text-center\"><svg class=\"w-20 h-20 text-neutral-700 mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"></path></svg> <h3 class=\"text-xl font-semibold text-white mb-2\">No messages yet</h3> <p class=\"text-neutral-400 max-w-sm\">Start a conversation by visiting someone's profile and clicking the message button</p></div>`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n      $$renderer2.push(`<!--[-->`);\n      const each_array = ensure_array_like(conversations);\n      for (let $$index = 0, $$length = each_array.length; $$index < $$length; $$index++) {\n        let conversation = each_array[$$index];\n        ConversationListItem($$renderer2, { conversation });\n      }\n      $$renderer2.push(`<!--]-->`);\n    }\n    $$renderer2.push(`<!--]--></div>`);\n  });\n}\nfunction NewMessageModal($$renderer, $$props) {\n  $$renderer.component(($$renderer2) => {\n    const { isOpen, onClose } = $$props;\n    function handleUserSelect(user) {\n      goto(`/messages/${user.npub}`);\n      onClose();\n    }\n    $$renderer2.push(`<!---->`);\n    Root($$renderer2, {\n      open: isOpen,\n      onOpenChange: (newOpen) => {\n        if (!newOpen) onClose();\n      },\n      children: ($$renderer3) => {\n        $$renderer3.push(`<!---->`);\n        Dialog_content($$renderer3, {\n          class: \"max-w-md\",\n          children: ($$renderer4) => {\n            $$renderer4.push(`<!---->`);\n            Dialog_header($$renderer4, {\n              children: ($$renderer5) => {\n                $$renderer5.push(`<!---->`);\n                Dialog_title($$renderer5, {\n                  children: ($$renderer6) => {\n                    $$renderer6.push(`<!---->New Message`);\n                  },\n                  $$slots: { default: true }\n                });\n                $$renderer5.push(`<!---->`);\n              },\n              $$slots: { default: true }\n            });\n            $$renderer4.push(`<!----> `);\n            User_search_combobox($$renderer4, {\n              ndk,\n              onSelect: handleUserSelect,\n              placeholder: \"Search by name, NIP-05, or paste npub...\"\n            });\n            $$renderer4.push(`<!---->`);\n          },\n          $$slots: { default: true }\n        });\n        $$renderer3.push(`<!---->`);\n      },\n      $$slots: { default: true }\n    });\n    $$renderer2.push(`<!---->`);\n  });\n}\nfunction _page($$renderer, $$props) {\n  $$renderer.component(($$renderer2) => {\n    let showNewMessageModal = false;\n    $$renderer2.push(`<div class=\"h-full flex flex-col\"><div class=\"sticky top-0 z-10 bg-background border-b border-border/50 px-4 py-3\"><div class=\"flex items-center justify-between\"><h1 class=\"text-xl font-bold text-foreground\">Messages</h1> <button class=\"p-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-primary\" title=\"New message\"><svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"></path></svg></button></div></div> <div class=\"flex-1 overflow-y-auto\">`);\n    if (!ndk.$currentUser) {\n      $$renderer2.push(\"<!--[-->\");\n      $$renderer2.push(`<div class=\"flex flex-col items-center justify-center h-full px-6 text-center\"><svg class=\"w-20 h-20 text-muted mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path></svg> <h3 class=\"text-xl font-semibold text-foreground mb-2\">Sign in required</h3> <p class=\"text-muted-foreground max-w-sm\">Please sign in to view and send direct messages</p></div>`);\n    } else {\n      $$renderer2.push(\"<!--[!-->\");\n      ConversationList($$renderer2, { conversations: messagesStore.conversations });\n    }\n    $$renderer2.push(`<!--]--></div></div> `);\n    NewMessageModal($$renderer2, {\n      isOpen: showNewMessageModal,\n      onClose: () => showNewMessageModal = false\n    });\n    $$renderer2.push(`<!---->`);\n  });\n}\nexport {\n  _page as default\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA,SAAS,oBAAoB,CAAC,UAAU,EAAE,OAAO,EAAE;AACnD,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,WAAW,KAAK;AACxC,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,OAAO;AACpC,IAAI,MAAM,WAAW,GAAG,YAAY,CAAC,mBAAmB,EAAE;AAC1D,IAAI,MAAM,WAAW,GAAG,YAAY,CAAC,cAAc,EAAE;AACrD,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,6GAA6G,CAAC,CAAC;AACrI,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACjC,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;AAC7B,QAAQ,GAAG;AACX,QAAQ,MAAM,EAAE,WAAW,CAAC,MAAM;AAClC,QAAQ,QAAQ,EAAE,CAAC,WAAW,KAAK;AACnC,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACrC,UAAU,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE,KAAK,EAAE,yBAAyB,EAAE,CAAC;AACxE,UAAU,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACrC,QAAQ,CAAC;AACT,QAAQ,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI;AAChC,OAAO,CAAC;AACR,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACjC,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,wIAAwI,EAAE,WAAW,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC,CAAC;AAClM,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,yDAAyD,CAAC,CAAC;AACnF,MAAM,OAAO,CAAC,WAAW,EAAE,EAAE,SAAS,EAAE,WAAW,CAAC,SAAS,EAAE,CAAC;AAChE,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,aAAa,CAAC,CAAC;AACvC,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,kHAAkH,CAAC,CAAC;AAC1I,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,IAAI,WAAW,CAAC,MAAM,CAAC,MAAM,KAAK,GAAG,CAAC,UAAU,EAAE,MAAM,EAAE;AAChE,QAAQ,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AACpC,QAAQ,WAAW,CAAC,IAAI,CAAC,CAAC,0CAA0C,CAAC,CAAC;AACtE,MAAM,CAAC,MAAM;AACb,QAAQ,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACrC,MAAM;AACN,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,WAAW,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACtE,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,eAAe,CAAC,CAAC;AACzC,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,aAAa,CAAC,CAAC;AACrC,IAAI,IAAI,YAAY,CAAC,cAAc,EAAE,GAAG,CAAC,EAAE;AAC3C,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,yKAAyK,EAAE,WAAW,CAAC,YAAY,CAAC,cAAc,EAAE,GAAG,EAAE,GAAG,KAAK,GAAG,YAAY,CAAC,cAAc,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC;AAC1S,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,6BAA6B,CAAC,CAAC;AACrD,EAAE,CAAC,CAAC;AACJ;AACA,SAAS,gBAAgB,CAAC,UAAU,EAAE,OAAO,EAAE;AAC/C,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,WAAW,KAAK;AACxC,IAAI,MAAM,EAAE,aAAa,EAAE,GAAG,OAAO;AACrC,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,4CAA4C,CAAC,CAAC;AACpE,IAAI,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE;AACpC,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,inBAAinB,CAAC,CAAC;AAC3oB,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC;AAClC,MAAM,MAAM,UAAU,GAAG,iBAAiB,CAAC,aAAa,CAAC;AACzD,MAAM,KAAK,IAAI,OAAO,GAAG,CAAC,EAAE,QAAQ,GAAG,UAAU,CAAC,MAAM,EAAE,OAAO,GAAG,QAAQ,EAAE,OAAO,EAAE,EAAE;AACzF,QAAQ,IAAI,YAAY,GAAG,UAAU,CAAC,OAAO,CAAC;AAC9C,QAAQ,oBAAoB,CAAC,WAAW,EAAE,EAAE,YAAY,EAAE,CAAC;AAC3D,MAAM;AACN,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC;AAClC,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,CAAC;AACtC,EAAE,CAAC,CAAC;AACJ;AACA,SAAS,eAAe,CAAC,UAAU,EAAE,OAAO,EAAE;AAC9C,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,WAAW,KAAK;AACxC,IAAI,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,OAAO;AACvC,IAAI,SAAS,gBAAgB,CAAC,IAAI,EAAE;AACpC,MAAM,IAAI,CAAC,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACpC,MAAM,OAAO,EAAE;AACf,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AAC/B,IAAI,IAAI,CAAC,WAAW,EAAE;AACtB,MAAM,IAAI,EAAE,MAAM;AAClB,MAAM,YAAY,EAAE,CAAC,OAAO,KAAK;AACjC,QAAQ,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE;AAC/B,MAAM,CAAC;AACP,MAAM,QAAQ,EAAE,CAAC,WAAW,KAAK;AACjC,QAAQ,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACnC,QAAQ,cAAc,CAAC,WAAW,EAAE;AACpC,UAAU,KAAK,EAAE,UAAU;AAC3B,UAAU,QAAQ,EAAE,CAAC,WAAW,KAAK;AACrC,YAAY,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACvC,YAAY,aAAa,CAAC,WAAW,EAAE;AACvC,cAAc,QAAQ,EAAE,CAAC,WAAW,KAAK;AACzC,gBAAgB,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AAC3C,gBAAgB,YAAY,CAAC,WAAW,EAAE;AAC1C,kBAAkB,QAAQ,EAAE,CAAC,WAAW,KAAK;AAC7C,oBAAoB,WAAW,CAAC,IAAI,CAAC,CAAC,kBAAkB,CAAC,CAAC;AAC1D,kBAAkB,CAAC;AACnB,kBAAkB,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI;AAC1C,iBAAiB,CAAC;AAClB,gBAAgB,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AAC3C,cAAc,CAAC;AACf,cAAc,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI;AACtC,aAAa,CAAC;AACd,YAAY,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC;AACxC,YAAY,oBAAoB,CAAC,WAAW,EAAE;AAC9C,cAAc,GAAG;AACjB,cAAc,QAAQ,EAAE,gBAAgB;AACxC,cAAc,WAAW,EAAE;AAC3B,aAAa,CAAC;AACd,YAAY,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACvC,UAAU,CAAC;AACX,UAAU,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI;AAClC,SAAS,CAAC;AACV,QAAQ,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AACnC,MAAM,CAAC;AACP,MAAM,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI;AAC9B,KAAK,CAAC;AACN,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AAC/B,EAAE,CAAC,CAAC;AACJ;AACA,SAAS,KAAK,CAAC,UAAU,EAAE,OAAO,EAAE;AACpC,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,WAAW,KAAK;AACxC,IAAI,IAAI,mBAAmB,GAAG,KAAK;AACnC,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,skBAAskB,CAAC,CAAC;AAC9lB,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE;AAC3B,MAAM,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC;AAClC,MAAM,WAAW,CAAC,IAAI,CAAC,CAAC,2hBAA2hB,CAAC,CAAC;AACrjB,IAAI,CAAC,MAAM;AACX,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;AACnC,MAAM,gBAAgB,CAAC,WAAW,EAAE,EAAE,aAAa,EAAE,aAAa,CAAC,aAAa,EAAE,CAAC;AACnF,IAAI;AACJ,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,qBAAqB,CAAC,CAAC;AAC7C,IAAI,eAAe,CAAC,WAAW,EAAE;AACjC,MAAM,MAAM,EAAE,mBAAmB;AACjC,MAAM,OAAO,EAAE,MAAM,mBAAmB,GAAG;AAC3C,KAAK,CAAC;AACN,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;AAC/B,EAAE,CAAC,CAAC;AACJ;;;;"}