{"version":3,"file":"npubcash.svelte-CJyS_ttu.js","sources":["../../../.svelte-kit/adapter-node/chunks/npubcash.svelte.js"],"sourcesContent":["import \"clsx\";\nimport { NDKEvent } from \"@nostr-dev-kit/ndk\";\nimport { s as settings, n as ndk } from \"./ndk.svelte.js\";\nconst NIP98_KIND = 27235;\nconst NPUB_CASH_DOMAIN = \"npub.cash\";\nconst NPUB_CASH_BASE_URL = `https://${NPUB_CASH_DOMAIN}`;\nclass NpubCashStore {\n  enabled = false;\n  loading = false;\n  lastCheck = null;\n  constructor() {\n    this.enabled = settings.wallet.npubCashEnabled;\n  }\n  /**\n   * Get the npub.cash Lightning address for the current user\n   */\n  getLightningAddress() {\n    if (!ndk.$currentUser) {\n      return \"\";\n    }\n    return `${ndk.$currentUser.npub}@${NPUB_CASH_DOMAIN}`;\n  }\n  /**\n   * Generate NIP-98 authentication event for HTTP requests\n   */\n  async generateNip98Event(url, method) {\n    const event = new NDKEvent(ndk);\n    event.kind = NIP98_KIND;\n    event.tags = [[\"u\", url], [\"method\", method]];\n    await event.sign();\n    const eventString = JSON.stringify(event.rawEvent());\n    return btoa(eventString);\n  }\n  /**\n   * Get account info from npub.cash\n   */\n  async getInfo() {\n    const url = `${NPUB_CASH_BASE_URL}/api/v1/info`;\n    const authHeader = await this.generateNip98Event(url, \"GET\");\n    const response = await fetch(url, {\n      method: \"GET\",\n      headers: { Authorization: `Nostr ${authHeader}` }\n    });\n    const info = await response.json();\n    return info;\n  }\n  /**\n   * Check balance on npub.cash\n   */\n  async getBalance() {\n    if (!this.enabled) {\n      return 0;\n    }\n    const url = `${NPUB_CASH_BASE_URL}/api/v1/balance`;\n    try {\n      const authHeader = await this.generateNip98Event(url, \"GET\");\n      const response = await fetch(url, {\n        method: \"GET\",\n        headers: { Authorization: `Nostr ${authHeader}` }\n      });\n      const balance = await response.json();\n      if (balance.error) {\n        console.error(\"npub.cash balance error:\", balance.error);\n        return 0;\n      }\n      return balance.data;\n    } catch (e) {\n      console.error(\"Failed to get npub.cash balance:\", e);\n      return 0;\n    }\n  }\n  /**\n   * Claim ecash token from npub.cash\n   */\n  async getClaim() {\n    const url = `${NPUB_CASH_BASE_URL}/api/v1/claim`;\n    try {\n      const authHeader = await this.generateNip98Event(url, \"GET\");\n      const response = await fetch(url, {\n        method: \"GET\",\n        headers: { Authorization: `Nostr ${authHeader}` }\n      });\n      const claim = await response.json();\n      if (claim.error) {\n        console.error(\"npub.cash claim error:\", claim.error);\n        return \"\";\n      }\n      return claim.data.token;\n    } catch (e) {\n      console.error(\"Failed to claim from npub.cash:\", e);\n      return \"\";\n    }\n  }\n  /**\n   * Check balance and claim any available tokens\n   */\n  async claimTokens() {\n    if (!this.enabled) {\n      return null;\n    }\n    try {\n      const balance = await this.getBalance();\n      console.log(\"npub.cash balance:\", balance, \"sats\");\n      if (balance > 0) {\n        const token = await this.getClaim();\n        if (token) {\n          console.log(\"Claimed token from npub.cash\");\n          this.lastCheck = Date.now();\n          return token;\n        }\n      }\n      this.lastCheck = Date.now();\n      return null;\n    } catch (e) {\n      console.error(\"Failed to claim tokens:\", e);\n      return null;\n    }\n  }\n  /**\n   * Enable npub.cash integration\n   */\n  setEnabled(enabled) {\n    this.enabled = enabled;\n    settings.wallet.npubCashEnabled = enabled;\n    settings.save();\n  }\n}\nconst npubCash = new NpubCashStore();\nexport {\n  npubCash as n\n};\n"],"names":[],"mappings":"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"}