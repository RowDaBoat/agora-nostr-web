import{f as s,s as D,a as t,d as Ft,c as Y,i as Mt,t as mt,j as Tt}from"../chunks/DNmf0A2m.js";import{a as pe,x as Ht,g as e,s as h,p as Lt,u as bt,e as a,b as m,r,d as l,y as Pe,t as k,c as Rt,f as w,aI as hr,aH as pr}from"../chunks/DpkVnRja.js";import{i as p}from"../chunks/Btb_Ey2R.js";import{e as Te,i as $t}from"../chunks/DD8s4tVe.js";import{c as fe}from"../chunks/CSx53_lc.js";import{s as gr,a as fr}from"../chunks/DyCGT0HY.js";import{p as mr,n as Oe,B as Vt,d as Kt,s as he,e as _r,f as xr,N as ft,C as br,b as wr}from"../chunks/QTLWRGLp.js";import{l as qt}from"../chunks/C43Cn2wZ.js";import{h as Gt}from"../chunks/Jrqc4XQc.js";import{E as kr,u as yr,U as $r,N as Mr}from"../chunks/DiXitoXJ.js";import{M as Cr,A as Pr}from"../chunks/B__lVf-X.js";import{c as Ue,a as ut}from"../chunks/Ci0hv7jC.js";import{T as jr}from"../chunks/CIGJmmxV.js";import{g as Lr}from"../chunks/Dtp51Kds.js";import{H as Qt}from"../chunks/BEgNpPxX.js";import{M as Rr}from"../chunks/Cp8mZpvR.js";import{a as Ot}from"../chunks/Danls9zm.js";import{b as It}from"../chunks/-Mgh5RB7.js";import{U as Dt}from"../chunks/BYRURnlO.js";import{c as At,L as Yt}from"../chunks/CLRodnOG.js";import{R as zr,h as Hr,c as Nt}from"../chunks/DGh-0Kjw.js";import{u as Et}from"../chunks/ACGw3gZU.js";import{p as Wt}from"../chunks/f_qAQkK6.js";import{N as Fr,c as Sr}from"../chunks/CwXZxT0m.js";import{t as ct}from"../chunks/BHGJODx2.js";import{M as tr,D as rr,a as ar,R as or,b as sr,c as lr,d as nr}from"../chunks/ExIc70cS.js";import{D as ir}from"../chunks/DuCXCqgL.js";import{D as Br,a as dr}from"../chunks/BJCNLf3C.js";import{I as Jt,B as Le}from"../chunks/OHIcQ-QL.js";import{T as Xt}from"../chunks/Cm-nUtcq.js";import{S as Ur}from"../chunks/FBAAKbhk.js";import{D as Tr}from"../chunks/BGQ6BdS-.js";import{R as Zt}from"../chunks/Bw8OG36z.js";import{p as er}from"../chunks/Bm7To3ke.js";import{p as Ar}from"../chunks/Uk33IviR.js";class Ir{#e=pe(Ht(new Set));get _selectedHashtags(){return e(this.#e)}set _selectedHashtags(_){h(this.#e,_,!0)}get selectedHashtags(){return Array.from(this._selectedHashtags)}get hasFilters(){return this._selectedHashtags.size>0}toggleHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)?this._selectedHashtags.delete(C):this._selectedHashtags.add(C),this._selectedHashtags=new Set(this._selectedHashtags)}addHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)||(this._selectedHashtags.add(C),this._selectedHashtags=new Set(this._selectedHashtags))}removeHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)&&(this._selectedHashtags.delete(C),this._selectedHashtags=new Set(this._selectedHashtags))}clearAll(){this._selectedHashtags.clear(),this._selectedHashtags=new Set}isSelected(_){return this._selectedHashtags.has(_.toLowerCase())}}const ht=new Ir;var Dr=s('<img class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy"/> <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent opacity-60"></div>',1),Er=s('<div class="w-full h-full flex items-center justify-center"><svg class="w-16 h-16 text-primary/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div>'),Nr=s('<p class="text-xs text-muted-foreground"><!></p>'),Vr=s('<a class="group block flex-shrink-0 w-[280px] h-[360px] rounded-2xl overflow-hidden bg-card hover:bg-muted transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl hover:shadow-primary/10"><div class="relative w-full h-48 overflow-hidden bg-gradient-to-br bg-primary/20"><!></div> <div class="p-4 flex flex-col h-[calc(100%-12rem)]"><h3 class="font-bold text-base text-foreground mb-2 line-clamp-2 leading-snug font-serif"> </h3> <p class="text-muted-foreground text-xs mb-3 line-clamp-3 leading-relaxed flex-1"> </p> <div class="flex items-center gap-2 mt-auto pt-2 border-t border-border"><div class="flex-1 min-w-0"><p class="text-xs font-medium text-muted-foreground truncate"> </p> <!></div> <svg class="w-5 h-5 text-primary opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></div></div></a>');function Or(Ge,_){Lt(_,!0);let C=pe(void 0),E=pe(null);bt(()=>{h(C,_.article.author,!0),_.article.author.fetchProfile().then(se=>{h(E,se,!0)})});const y=m(()=>_.article.title||"Untitled"),H=m(()=>_.article.summary),g=m(()=>_.article.image),B=m(()=>_.article.published_at||_.article.created_at),A=m(()=>Lr(_.article,e(C))),Z=m(()=>e(E)?.name||e(E)?.displayName||"Anonymous"),N=m(()=>{const se=e(H)||_.article.content;return se.slice(0,100)+(se.length>100?"...":"")});var P=Vr(),q=a(P),oe=a(q);{var i=se=>{var we=Dr(),ke=w(we);Pe(2),k(()=>{Ue(ke,"src",e(g)),Ue(ke,"alt",e(y))}),t(se,we)},b=se=>{var we=Er();t(se,we)};p(oe,se=>{e(g)?se(i):se(b,!1)})}r(q);var I=l(q,2),J=a(I),Re=a(J,!0);r(J);var n=l(J,2),$=a(n,!0);r(n);var V=l(n,2),j=a(V),me=a(j),ee=a(me,!0);r(me);var lt=l(me,2);{var Qe=se=>{var we=Nr(),ke=a(we);jr(ke,{get timestamp(){return e(B)}}),r(we),t(se,we)};p(lt,se=>{e(B)&&se(Qe)})}r(j),Pe(2),r(V),r(I),r(P),k(()=>{Ue(P,"href",e(A)),D(Re,e(y)),D($,e(N)),D(ee,e(Z))}),t(Ge,P),Rt()}var Wr=s('<div class="flex items-center justify-center h-[calc(100vh-12rem)] text-muted-foreground">No videos found</div>'),Kr=Mt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path></svg>'),qr=Mt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>'),Gr=s('<p class="text-white text-sm mb-3 line-clamp-3"> </p>'),Qr=s('<div class="relative w-screen snap-start snap-always flex items-center justify-center bg-black h-screen lg:h-screen"><video class="w-full h-full object-contain" loop playsinline="" preload="auto"><track kind="captions"/></video> <div class="absolute inset-0 pointer-events-none"><div class="absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-center gap-3"><!> <div class="flex-1 min-w-0"><div class="text-white font-semibold text-sm truncate"> </div></div></div></div> <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-auto"><button class="w-12 h-12 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm flex items-center justify-center transition-colors" type="button"><!></button></div> <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-end gap-4"><div class="flex-1 min-w-0 mb-2"><!></div> <div class="flex flex-col items-center gap-4 pb-2"><!></div></div></div></div></div>',2),Yr=s('<div class="fixed inset-0 overflow-y-scroll snap-y snap-mandatory scrollbar-hide bg-black lg:bottom-0 bottom-[72px] svelte-znq7e9"></div>');function Jr(Ge,_){Lt(_,!0);let C=pe(null),E=pe(!0);function y(i){const b=/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi;return i.match(b)||[]}function H(i){const b=i.m,I=i.url;if(b&&b.startsWith("video/"))return"video";if(I){const J=I.split(".").pop()?.toLowerCase();if(["mp4","webm","mov","avi","mkv"].includes(J||""))return"video"}return"other"}const g=m(()=>_.events.flatMap(i=>{const J=i.tags.filter(n=>n[0]==="imeta").map(n=>mr(n)).filter(n=>n.url&&H(n)==="video").map(n=>({event:i,imeta:n}));return J.length>0?J:y(i.content).map(n=>{const $=n.split(".").pop()?.toLowerCase();return{event:i,imeta:{url:n,m:"video/"+$}}})}));let B=null,A=new Map;hr(()=>(B=new IntersectionObserver(i=>{i.forEach(b=>{const I=b.target;b.isIntersecting&&b.intersectionRatio>.5?I.play().catch(J=>{console.log("Auto-play prevented:",J)}):I.pause()})},{root:null,threshold:[.5]}),setTimeout(()=>{const i=A.get(0);i&&i.play().catch(b=>{console.log("Auto-play prevented:",b)})},100),()=>{B?.disconnect()}));function Z(i,b){return A.set(b,i),B&&B.observe(i),{destroy(){A.delete(b),B&&B.unobserve(i)}}}var N=Y(),P=w(N);{var q=i=>{var b=Wr();t(i,b)},oe=i=>{var b=Yr();Te(b,23,()=>e(g),({event:I,imeta:J},Re)=>`${I.id}-${Re}`,(I,J,Re)=>{let n=()=>e(J).event,$=()=>e(J).imeta;var V=Qr(),j=a(V);Ot(j,(te,le)=>Z?.(te,le),()=>e(Re));var me=l(j,2),ee=a(me),lt=a(ee),Qe=a(lt);fe(Qe,()=>Dt.Root,(te,le)=>{le(te,{get ndk(){return Oe},get pubkey(){return n().pubkey},children:(Ae,L)=>{var f=Y(),o=w(f);fe(o,()=>Dt.Avatar,(c,d)=>{d(c,{class:"w-10 h-10 rounded-full border-2 border-white"})}),t(Ae,f)},$$slots:{default:!0}})});var se=l(Qe,2),we=a(se),ke=a(we,!0);r(we),r(se),r(lt),r(ee);var nt=l(ee,2),it=a(nt);it.__click=()=>h(E,!e(E));var tt=a(it);{var rt=te=>{var le=Kr();t(te,le)},Ye=te=>{var le=qr();t(te,le)};p(tt,te=>{e(E)?te(rt):te(Ye,!1)})}r(it),r(nt);var We=l(nt,2),dt=a(We),at=a(dt),v=a(at);{var F=te=>{var le=Gr(),Ae=a(le,!0);r(le),k(L=>D(Ae,L),[()=>n().content.replace($().url||"","").trim()]),t(te,le)};p(v,te=>{n().content&&te(F)})}r(at);var ve=l(at,2),ot=a(ve);kr(ot,{get event(){return n()},variant:"tiktok"}),r(ve),r(dt),r(We),r(me),r(V),k(te=>{Ue(j,"src",$().url),j.muted=e(E),D(ke,te),Ue(it,"aria-label",e(E)?"Unmute":"Mute")},[()=>n().author?.profile?.name||n().author?.npub?.substring(0,8)]),t(I,V)}),r(b),It(b,I=>h(C,I),()=>e(C)),t(i,b)};p(P,i=>{e(g).length===0?i(q):i(oe,!1)})}t(Ge,N),Rt()}Ft(["click"]);var Xr=s('<button><span class="text-xs">#</span> <span> </span></button>'),Zr=s('<button class="flex-shrink-0 inline-flex items-center gap-1 px-2 py-1.5 rounded-full text-xs font-medium bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all" title="Clear all filters"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ea=s("<!> <!>",1),ta=s('<h1 class="text-xl font-bold text-foreground"> </h1>'),ra=s('<div><div class="py-2 pl-2 sm:p-4 w-full"><div class="flex items-center gap-2 min-w-0"><div class="flex-shrink-0 relative z-20"><!></div> <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide flex-1 min-w-0 max-w-full"><!></div></div></div> <!></div>');function aa(Ge,_){Lt(_,!0);const C=m(()=>_.selectedFilter==="videos");let E=pe(null);bt(()=>{if(!e(E))return;const i=()=>{const b=e(C)?0:e(E).offsetHeight;document.documentElement.style.setProperty("--header-height",`${b}px`)};return i(),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}});var y=ra(),H=a(y),g=a(H),B=a(g),A=a(B);zr(A,{iconOnly:!0}),r(B);var Z=l(B,2),N=a(Z);{var P=i=>{var b=ea(),I=w(b);Te(I,17,()=>Vt.interests,$t,(n,$)=>{var V=Xr();V.__click=()=>ht.toggleHashtag(e($));var j=l(a(V),2),me=a(j,!0);r(j),r(V),k(ee=>{ut(V,1,`flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all ${ee??""}`),D(me,e($))},[()=>ht.isSelected(e($))?"bg-primary text-foreground border-2 border-primary-400":"bg-muted text-muted-foreground border-2 border-border hover:border"]),t(n,V)});var J=l(I,2);{var Re=n=>{var $=Zr();$.__click=()=>ht.clearAll(),t(n,$)};p(J,n=>{ht.hasFilters&&n(Re)})}t(i,b)},q=i=>{var b=Y(),I=w(b);{var J=Re=>{var n=ta(),$=a(n,!0);r(n),k(()=>D($,_.headerTitle.text)),t(Re,n)};p(I,Re=>{_.headerTitle&&Re(J)},!0)}t(i,b)};p(N,i=>{Vt.interests.length>0?i(P):i(q,!1)})}r(Z),r(g),r(H);var oe=l(H,2);Cr(oe,{get selectedFilter(){return _.selectedFilter},get onFilterChange(){return _.onFilterChange}}),r(y),It(y,i=>h(E,i),()=>e(E)),k(()=>ut(y,1,`sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border ${e(C)?"hidden":""}`)),t(Ge,y),Rt()}Ft(["click"]);var oa=s('<button class="w-full px-3 py-2 text-sm text-left border border-primary rounded-lg bg-primary/5 hover:bg-primary/10 transition-colors mb-4"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span class="text-primary font-medium"> </span></div> <p class="text-xs text-muted-foreground mt-1 ml-6">Press Enter or click to add</p></button>'),sa=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),la=s('<div class="mb-4 flex flex-wrap gap-2"></div>'),na=s('<div class="text-center py-12"><svg class="w-12 h-12 text-muted-foreground mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> <p class="text-muted-foreground"> </p></div>'),ia=s('<button><span class="font-medium truncate"> </span> <span class="text-xs text-muted-foreground ml-2 flex-shrink-0"> </span></button>'),da=s('<div class="grid grid-cols-2 gap-2"></div>'),va=s('<p class="text-xs text-muted-foreground"> </p> <!>',1),ca=s('<!> <div class="mb-4"><!></div> <!> <!> <div class="flex-1 overflow-y-auto -mx-6 px-6"><!></div> <!>',1),ua=s('<button class="w-full px-3 py-2 text-sm text-left border border-primary rounded-lg bg-primary/5 hover:bg-primary/10 transition-colors mb-4"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span class="text-primary font-medium"> </span></div> <p class="text-xs text-muted-foreground mt-1 ml-6">Press Enter or click to add</p></button>'),ha=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),pa=s('<div class="mb-4 flex flex-wrap gap-2"></div>'),ga=s('<div class="text-center py-12"><svg class="w-12 h-12 text-muted-foreground mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> <p class="text-muted-foreground"> </p></div>'),fa=s('<button><span class="font-medium truncate"> </span> <span class="text-xs text-muted-foreground ml-2 flex-shrink-0"> </span></button>'),ma=s('<div class="grid grid-cols-2 gap-2"></div>'),_a=s('<p class="text-xs text-muted-foreground"> </p> <!>',1),xa=s('<!> <div class="px-4"><div class="mb-4"><!></div> <!> <!> <div class="flex-1 overflow-y-auto max-h-[50vh]"><!></div></div> <!>',1);function ba(Ge,_){Lt(_,!0);let C=Wt(_,"selectedTags",19,()=>[]),E=Wt(_,"open",15,!1);const y=new tr("(min-width: 768px)");let H=pe(Ht([])),g=pe("");const B=m(()=>{if(!e(g))return e(H);const n=e(g).toLowerCase();return e(H).filter($=>$.tag.toLowerCase().includes(n))}),A=m(()=>{if(!e(g).trim())return!1;const n=e(g).trim().toLowerCase().replace(/^#/,"");return!e(H).some($=>$.tag.toLowerCase()===n)&&!C().some($=>$.toLowerCase()===n)}),Z=m(()=>he.selectedRelay||he.relays.find(n=>n.enabled&&n.read)?.url),N=Oe.$fetchEvents(()=>E()?{filters:{kinds:[1,20,21,22],limit:500},cacheUsage:e(Z)?Kt.ONLY_RELAY:Kt.CACHE_FIRST,relayUrls:e(Z)?[e(Z)]:void 0}:void 0);bt(()=>{if(!N){h(H,[],!0);return}const n=new Ur;for(const $ of N){const V=$.tags.filter(j=>j[0]==="t"&&j[1]);for(const j of V){const me=j[1].toLowerCase();n.set(me,(n.get(me)||0)+1)}}h(H,Array.from(n.entries()).map(([$,V])=>({tag:$,count:V})).sort(($,V)=>V.count-$.count).slice(0,100),!0)});function P(n){C().includes(n)?_.onTagsChange?.(C().filter($=>$!==n)):_.onTagsChange?.([...C(),n])}function q(){if(!e(A))return;const n=e(g).trim().toLowerCase().replace(/^#/,"");_.onTagsChange?.([...C(),n]),h(g,"")}function oe(n){n.key==="Enter"&&e(A)&&(n.preventDefault(),q())}function i(){E(!1),h(g,""),_.onClose?.()}var b=Y(),I=w(b);{var J=n=>{var $=Y(),V=w($);fe(V,()=>or,(j,me)=>{me(j,{get open(){return E()},onOpenChange:ee=>{E(ee),ee||i()},children:(ee,lt)=>{var Qe=Y(),se=w(Qe);fe(se,()=>rr,(we,ke)=>{ke(we,{class:"max-w-xl max-h-[80vh] flex flex-col",children:(nt,it)=>{var tt=ca(),rt=w(tt);fe(rt,()=>Br,(L,f)=>{f(L,{children:(o,c)=>{var d=Y(),u=w(d);fe(u,()=>ar,(S,R)=>{R(S,{children:(z,G)=>{Pe();var ye=mt("Select Hashtags");t(z,ye)},$$slots:{default:!0}})}),t(o,d)},$$slots:{default:!0}})});var Ye=l(rt,2),We=a(Ye);Jt(We,{type:"text",onkeydown:oe,placeholder:"Search hashtags...",autofocus:!0,get value(){return e(g)},set value(L){h(g,L,!0)}}),r(Ye);var dt=l(Ye,2);{var at=L=>{var f=oa();f.__click=q;var o=a(f),c=l(a(o),2),d=a(c);r(c),r(o),Pe(2),r(f),k(u=>D(d,`Add custom tag: #${u??""}`),[()=>e(g).trim().toLowerCase().replace(/^#/,"")]),t(L,f)};p(dt,L=>{e(A)&&L(at)})}var v=l(dt,2);{var F=L=>{var f=la();Te(f,20,C,o=>o,(o,c)=>{var d=sa();d.__click=()=>P(c);var u=a(d),S=a(u);r(u),Pe(2),r(d),k(()=>D(S,`#${c??""}`)),t(o,d)}),r(f),t(L,f)};p(v,L=>{C().length>0&&L(F)})}var ve=l(v,2),ot=a(ve);{var te=L=>{var f=na(),o=l(a(f),2),c=a(o,!0);r(o),r(f),k(()=>D(c,e(g)?"No hashtags found matching your search":"No popular hashtags found")),t(L,f)},le=L=>{var f=da();Te(f,21,()=>e(B),({tag:o,count:c})=>o,(o,c)=>{let d=()=>e(c).tag,u=()=>e(c).count;const S=m(()=>C().includes(d()));var R=ia();R.__click=()=>P(d());var z=a(R),G=a(z);r(z);var ye=l(z,2),re=a(ye,!0);r(ye),r(R),k(()=>{ut(R,1,`flex items-center justify-between px-3 py-2 rounded-lg border transition-colors ${e(S)?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted"}`),D(G,`#${d()??""}`),D(re,u())}),t(o,R)}),r(f),t(L,f)};p(ot,L=>{e(B).length===0?L(te):L(le,!1)})}r(ve);var Ae=l(ve,2);fe(Ae,()=>Tr,(L,f)=>{f(L,{class:"flex items-center justify-between pt-4 border-t border-border -mx-6 px-6",children:(o,c)=>{var d=va(),u=w(d),S=a(u);r(u);var R=l(u,2);Le(R,{onclick:i,children:(z,G)=>{Pe();var ye=mt("Done");t(z,ye)},$$slots:{default:!0}}),k(()=>D(S,`${C().length??""} ${C().length===1?"tag":"tags"} selected`)),t(o,d)},$$slots:{default:!0}})}),t(nt,tt)},$$slots:{default:!0}})}),t(ee,Qe)},$$slots:{default:!0}})}),t(n,$)},Re=n=>{var $=Y(),V=w($);fe(V,()=>nr,(j,me)=>{me(j,{get open(){return E()},onOpenChange:ee=>{E(ee),ee||i()},children:(ee,lt)=>{var Qe=Y(),se=w(Qe);fe(se,()=>sr,(we,ke)=>{ke(we,{children:(nt,it)=>{var tt=xa(),rt=w(tt);fe(rt,()=>dr,(f,o)=>{o(f,{class:"text-left",children:(c,d)=>{var u=Y(),S=w(u);fe(S,()=>lr,(R,z)=>{z(R,{children:(G,ye)=>{Pe();var re=mt("Select Hashtags");t(G,re)},$$slots:{default:!0}})}),t(c,u)},$$slots:{default:!0}})});var Ye=l(rt,2),We=a(Ye),dt=a(We);Jt(dt,{type:"text",onkeydown:oe,placeholder:"Search hashtags...",autofocus:!0,get value(){return e(g)},set value(f){h(g,f,!0)}}),r(We);var at=l(We,2);{var v=f=>{var o=ua();o.__click=q;var c=a(o),d=l(a(c),2),u=a(d);r(d),r(c),Pe(2),r(o),k(S=>D(u,`Add custom tag: #${S??""}`),[()=>e(g).trim().toLowerCase().replace(/^#/,"")]),t(f,o)};p(at,f=>{e(A)&&f(v)})}var F=l(at,2);{var ve=f=>{var o=pa();Te(o,20,C,c=>c,(c,d)=>{var u=ha();u.__click=()=>P(d);var S=a(u),R=a(S);r(S),Pe(2),r(u),k(()=>D(R,`#${d??""}`)),t(c,u)}),r(o),t(f,o)};p(F,f=>{C().length>0&&f(ve)})}var ot=l(F,2),te=a(ot);{var le=f=>{var o=ga(),c=l(a(o),2),d=a(c,!0);r(c),r(o),k(()=>D(d,e(g)?"No hashtags found matching your search":"No popular hashtags found")),t(f,o)},Ae=f=>{var o=ma();Te(o,21,()=>e(B),({tag:c,count:d})=>c,(c,d)=>{let u=()=>e(d).tag,S=()=>e(d).count;const R=m(()=>C().includes(u()));var z=fa();z.__click=()=>P(u());var G=a(z),ye=a(G);r(G);var re=l(G,2),ze=a(re,!0);r(re),r(z),k(()=>{ut(z,1,`flex items-center justify-between px-3 py-2 rounded-lg border transition-colors ${e(R)?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted"}`),D(ye,`#${u()??""}`),D(ze,S())}),t(c,z)}),r(o),t(f,o)};p(te,f=>{e(B).length===0?f(le):f(Ae,!1)})}r(ot),r(Ye);var L=l(Ye,2);fe(L,()=>ir,(f,o)=>{o(f,{class:"pt-2 flex items-center justify-between",children:(c,d)=>{var u=_a(),S=w(u),R=a(S);r(S);var z=l(S,2);Le(z,{onclick:i,children:(G,ye)=>{Pe();var re=mt("Done");t(G,re)},$$slots:{default:!0}}),k(()=>D(R,`${C().length??""} ${C().length===1?"tag":"tags"} selected`)),t(c,u)},$$slots:{default:!0}})}),t(nt,tt)},$$slots:{default:!0}})}),t(ee,Qe)},$$slots:{default:!0}})}),t(n,$)};p(I,n=>{y.current?n(J):n(Re,!1)})}t(Ge,b),Rt()}Ft(["click"]);function wa(Ge,_,C=5){const E="0123456789bcdefghjkmnpqrstuvwxyz";let y=0,H=0,g=!0,B="",A=[-90,90],Z=[-180,180];for(;B.length<C;){if(g){const N=(Z[0]+Z[1])/2;_>=N?(y|=1<<4-H,Z[0]=N):Z[1]=N}else{const N=(A[0]+A[1])/2;Ge>=N?(y|=1<<4-H,A[0]=N):A[1]=N}g=!g,H++,H===5&&(B+=E[y],H=0,y=0)}return B}var ka=s("<button></button>"),ya=s('<div class="absolute bottom-3 left-0 right-0 flex justify-center gap-1"></div>'),$a=s('<button><img alt="" class="w-full h-full object-cover rounded"/></button>'),Ma=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Ca=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Pa=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg> <!></div>'),ja=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'),La=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Ra=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <!></div>'),za=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>'),Ha=s('<img alt="" class="w-5 h-5 rounded border border-background"/>'),Fa=s('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),Sa=s('<div class="flex items-center -space-x-1"></div>'),Ba=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Ua=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),Ta=s('<div role="presentation"><div role="dialog" tabindex="-1"><!></div></div>'),Aa=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Ia=s('<div class="flex flex-wrap gap-2 items-center"></div>'),Da=s('<div class="text-sm text-muted-foreground flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span> </span> <button class="ml-1 hover:text-foreground transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Ea=s('<div class="md:grid md:grid-cols-[2fr,3fr] md:h-full"><div class="md:border-r border-border md:p-6 p-0"><div class="relative w-full md:aspect-square md:rounded-lg overflow-hidden bg-black"><img class="w-full h-full object-contain"/> <button title="Remove this image" class="absolute top-2 right-2 p-2 bg-black/60 text-white rounded-full hover:bg-black/80 transition-colors backdrop-blur-sm" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!></div> <div class="hidden md:flex items-center gap-2 overflow-x-auto pb-2 mt-4"><!> <button title="Add more images" class="w-16 h-16 rounded border-2 border-dashed border-border hover:border-primary hover:bg-muted transition-all flex items-center justify-center flex-shrink-0" aria-label="Add more images"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="p-4 md:p-6 space-y-4 md:overflow-auto"><!> <div class="flex items-center gap-1 border-t border-border pt-3"><!> <!> <!> <!> <!> <div class="relative"><!></div></div> <!> <!> <!></div></div>'),Na=s('<p class="text-sm text-muted-foreground"> </p>'),Va=s('<div class="flex flex-col items-center gap-2"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <!></div>'),Oa=s('<svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-lg font-medium text-foreground mb-2">Drop images here</p> <p class="text-sm text-muted-foreground">or click to browse</p> <p class="text-xs text-muted-foreground mt-2">Multiple images supported</p>',1),Wa=s('<p class="text-xs text-muted-foreground"> </p>'),Ka=s('<div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <p class="text-sm text-muted-foreground">Uploading...</p> <!></div>'),qa=s('<svg class="w-16 h-16 text-muted-foreground mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-muted-foreground mb-4">No images selected</p> <!>',1),Ga=s('<div class="hidden md:flex items-center justify-center p-12 h-full"><div role="button" tabindex="0"><!></div></div> <div class="md:hidden flex items-center justify-center p-8 h-full min-h-[60vh]"><div class="text-center"><!></div></div>',1),Qa=s('<div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4 border-b border-border bg-background"><button title="Close and discard post" class="text-foreground hover:text-muted-foreground transition-colors" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!> <!></div> <div class="flex-1 overflow-auto"><input type="file" accept="image/*" multiple class="hidden"/> <!></div>',1),Ya=s("<button></button>"),Ja=s('<div class="absolute bottom-3 left-0 right-0 flex justify-center gap-1"></div>'),Xa=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Za=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),eo=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg> <!></div>'),to=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'),ro=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),ao=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <!></div>'),oo=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>'),so=s('<img alt="" class="w-5 h-5 rounded border border-background"/>'),lo=s('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),no=s('<div class="flex items-center -space-x-1"></div>'),io=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),vo=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),co=s('<div role="presentation"><div role="dialog" tabindex="-1"><!></div></div>'),uo=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ho=s('<div class="flex flex-wrap gap-2 items-center"></div>'),po=s('<div class="text-sm text-muted-foreground flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span> </span> <button class="ml-1 hover:text-foreground transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),go=s('<div class="space-y-4"><div class="relative w-full overflow-hidden bg-black"><img class="w-full h-full object-contain"/> <button title="Remove this image" class="absolute top-2 right-2 p-2 bg-black/60 text-white rounded-full hover:bg-black/80 transition-colors backdrop-blur-sm" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!></div> <!> <div class="flex items-center gap-1 border-t border-border pt-3"><!> <!> <!> <!> <!> <div class="relative"><!></div></div> <!> <!> <!></div>'),fo=s('<p class="text-xs text-muted-foreground"> </p>'),mo=s('<div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <p class="text-sm text-muted-foreground">Uploading...</p> <!></div>'),_o=s('<svg class="w-16 h-16 text-muted-foreground mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-muted-foreground mb-4">No images selected</p> <!>',1),xo=s('<div class="flex items-center justify-center p-8 h-full min-h-[60vh]"><div class="text-center"><!></div></div>'),bo=s("<!> <!>",1),wo=s('<!> <div class="px-4 overflow-auto flex-1"><input type="file" accept="image/*" multiple class="hidden"/> <!></div> <!>',1),ko=s("<!> <!> <!>",1);function yo(Ge,_){Lt(_,!0);const C=new tr("(min-width: 768px)");let E=Wt(_,"open",15,!1),y=pe(!1),H=pe(0),g=pe(!1),B=pe(!1),A=pe(!1),Z=pe(""),N=pe(""),P=pe(Ht([])),q=pe(Ht([])),oe=pe(!1),i=pe(Ht([])),b,I=pe(!1),J=pe(!1);const Re=new Fr(Oe),n=Sr(Re),$=m(()=>window.innerWidth<768),V=yr(()=>E()),j=m(()=>V.selectedRelayUrls),me=m(()=>V.allRelays);bt(()=>{E()&&e($)&&e(i).length===0&&setTimeout(()=>{b?.click()},300)});async function ee(o){if(!o.type.startsWith("image/")){ct.error("Please select an image file");return}try{if(await n.upload(o,{fallbackServer:"https://blossom.primal.net"}),n.result?.url){const c=new Image,d=await new Promise(u=>{c.onload=()=>u({width:c.width,height:c.height}),c.src=URL.createObjectURL(o)});h(i,[...e(i),{url:n.result.url,mimeType:o.type,hash:n.result.sha256||"",blurhash:n.result.blurhash,dimensions:d}],!0),h(H,e(i).length-1)}}catch(c){console.error("Upload failed:",c),ct.error("Failed to upload image")}}function lt(o){const d=o.target.files;d&&Array.from(d).forEach(u=>ee(u))}function Qe(o){o.preventDefault(),h(I,!0)}function se(){h(I,!1)}async function we(o){o.preventDefault(),h(I,!1);const c=o.dataTransfer?.files;c&&Array.from(c).forEach(d=>ee(d))}function ke(){b?.click()}function nt(o){h(i,e(i).filter((c,d)=>d!==o),!0),e(H)>=e(i).length&&h(H,Math.max(0,e(i).length-1),!0)}function it(o){h(P,e(P).filter(c=>c!==o),!0)}function tt(o){h(P,o,!0)}function rt(o){V.selectedRelayUrls.includes(o)?V.selectedRelayUrls=V.selectedRelayUrls.filter(c=>c!==o):V.selectedRelayUrls=[...V.selectedRelayUrls,o]}function Ye(o){V.selectedRelayUrls=[o],h(g,!1)}function We(){h(g,!1)}function dt(){navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{const c=o.coords.latitude,d=o.coords.longitude,u=wa(c,d,5);h(N,`Near ${u}`),ct.success("Location detected")},o=>{console.error("Error getting location:",o),ct.error("Could not get your location")}):ct.error("Geolocation is not supported")}async function at(){if(!e(Z).trim()||e(i).length===0||e(y)){e(i).length===0?ct.error("Please add at least one image"):ct.error("Please add a caption");return}if(!Oe.$currentUser){ct.error("Please log in to create a media post");return}if(e(j).length===0){ct.error("Please select at least one relay to publish to");return}try{h(y,!0);const o=new _r(Oe);if(o.kind=20,o.content=e(Z).trim(),o.isProtected=e(J),e(i).forEach(d=>{const u=["imeta",`url ${d.url}`,`m ${d.mimeType}`];d.hash&&u.push(`x ${d.hash}`),d.blurhash&&u.push(`blurhash ${d.blurhash}`),d.dimensions&&u.push(`dim ${d.dimensions.width}x${d.dimensions.height}`),o.tags.push(u)}),e(P).forEach(d=>{o.tags.push(["t",d])}),e(q).forEach(d=>{o.tags.push(["p",d])}),e(N).trim())if(e(N).startsWith("Near ")){const d=e(N).replace("Near ","");for(let u=3;u<=d.length;u++)o.tags.push(["g",d.substring(0,u)])}else o.tags.push(["location",e(N).trim()]);e(oe)&&o.tags.push(["content-warning","nsfw"]),await o.sign();const c=xr.fromRelayUrls(e(j),Oe);if(await o.publish(c),o.publishStatus==="error"){const u=o.publishError?.relayErrors||{},S=Object.entries(u).map(([R,z])=>`${R}: ${z}`).join(`
`);ct.error(`Failed to publish:
${S||"Unknown error"}`);return}ct.success("Posted!"),v(),E(!1),_.onClose?.()}catch(o){console.error("Failed to publish media post:",o),ct.error(`Failed to publish: ${o instanceof Error?o.message:"Unknown error"}`)}finally{h(y,!1)}}function v(){h(Z,""),h(N,""),h(P,[],!0),h(q,[],!0),h(i,[],!0),h(H,0),h(oe,!1),h(g,!1),h(B,!1),h(A,!1)}function F(){e(y)||(v(),E(!1),_.onClose?.())}function ve(o){o.key==="Escape"&&!e(y)&&F()}var ot=ko();Tt("keydown",pr,ve);var te=w(ot);{var le=o=>{var c=Y(),d=w(c);fe(d,()=>or,(u,S)=>{S(u,{get open(){return E()},onOpenChange:R=>{E(R),R||F()},children:(R,z)=>{var G=Y(),ye=w(G);fe(ye,()=>rr,(re,ze)=>{ze(re,{class:"max-md:!max-w-none max-md:!w-full max-md:!h-[100vh] max-md:!m-0 max-md:!rounded-none max-w-6xl max-h-[90vh] overflow-hidden flex flex-col p-0",children:(X,ce)=>{var _e=Qa(),ge=w(_e),xe=a(ge);xe.__click=F;var De=l(xe,2);fe(De,()=>ar,(ne,$e)=>{$e(ne,{class:"text-lg md:text-xl font-semibold",children:(ue,ae)=>{Pe();var Me=mt("New Post");t(ue,Me)},$$slots:{default:!0}})});var Je=l(De,2);{let ne=m(()=>!e(Z).trim()||e(i).length===0||e(y)||e(j).length===0);Le(Je,{onclick:at,get disabled(){return e(ne)},size:"sm",class:"h-9 px-4",children:($e,ue)=>{Pe();var ae=mt();k(()=>D(ae,e(y)?"Posting...":"Post")),t($e,ae)},$$slots:{default:!0}})}r(ge);var Ke=l(ge,2),Ct=a(Ke);Ct.__change=lt,It(Ct,ne=>b=ne,()=>b);var zt=l(Ct,2);{var Ee=ne=>{var $e=Ea(),ue=a($e),ae=a(ue),Me=a(ae),Ce=l(Me,2);Ce.__click=()=>nt(e(H));var Ne=l(Ce,2);{var qe=x=>{var M=ya();Te(M,21,()=>e(i),$t,(K,U,T)=>{var je=ka();je.__click=()=>h(H,T,!0),Ue(je,"title",`View image ${T+1}`),Ue(je,"aria-label",`View image ${T+1}`),k(()=>ut(je,1,`w-2 h-2 rounded-full transition-all ${e(H)===T?"bg-white w-6":"bg-white/50"}`)),t(K,je)}),r(M),t(x,M)};p(Ne,x=>{e(i).length>1&&x(qe)})}r(ae);var He=l(ae,2),st=a(He);Te(st,17,()=>e(i),$t,(x,M,K)=>{var U=$a();U.__click=()=>h(H,K,!0),Ue(U,"title",`View image ${K+1}`),Ue(U,"aria-label",`View image ${K+1}`);var T=a(U);r(U),k(()=>{ut(U,1,`w-16 h-16 rounded border-2 transition-all flex-shrink-0 ${e(H)===K?"border-primary":"border-border"}`),Ue(T,"src",e(M).url)}),t(x,U)});var wt=l(st,2);wt.__click=ke,r(He),r(ue);var Pt=l(ue,2),be=a(Pt);{let x=m(()=>!e($));Xt(be,{placeholder:"Write a caption...",rows:4,get autofocus(){return e(x)},class:"resize-none border-0 focus-visible:ring-0 px-3 text-base placeholder:text-muted-foreground",get value(){return e(Z)},set value(M){h(Z,M,!0)}})}var Fe=l(be,2),pt=a(Fe);Le(pt,{type:"button",variant:"ghost",size:"icon",onclick:ke,get disabled(){return e(y)},title:"Add more images to your post",class:"h-8 w-8",children:(x,M)=>{var K=Ma();t(x,K)},$$slots:{default:!0}});var _t=l(pt,2);{let x=m(()=>e(P).length>0?"text-primary":"");Le(_t,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(B,!0),get disabled(){return e(y)},title:"Add hashtags to categorize your post and make it discoverable",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=Pa(),T=l(a(U),2);{var je=Be=>{var Ie=Ca(),xt=a(Ie,!0);r(Ie),k(()=>D(xt,e(P).length)),t(Be,Ie)};p(T,Be=>{e(P).length>0&&Be(je)})}r(U),t(M,U)},$$slots:{default:!0}})}var Ze=l(_t,2);{let x=m(()=>e(N)?"text-primary":"");Le(Ze,{type:"button",variant:"ghost",size:"icon",onclick:dt,get disabled(){return e(y)},title:"Add location - uses your device's GPS to tag where this was posted",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=ja();t(M,U)},$$slots:{default:!0}})}var et=l(Ze,2);{let x=m(()=>e(q).length>0?"text-primary":"");Le(et,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(A,!0),get disabled(){return e(y)},title:"Tag people in this post - they'll be notified",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=Ra(),T=l(a(U),2);{var je=Be=>{var Ie=La(),xt=a(Ie,!0);r(Ie),k(()=>D(xt,e(q).length)),t(Be,Ie)};p(T,Be=>{e(q).length>0&&Be(je)})}r(U),t(M,U)},$$slots:{default:!0}})}var kt=l(et,2);{let x=m(()=>e(oe)?"text-primary":"");Le(kt,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(oe,!e(oe)),get disabled(){return e(y)},title:"Mark as sensitive content (NSFW)",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=za();t(M,U)},$$slots:{default:!0}})}var St=l(kt,2),W=a(St);Le(W,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(g,!e(g)),get disabled(){return e(y)},title:"Choose which relays to publish this post to",class:"h-8 w-8",children:(x,M)=>{var K=Y(),U=w(K);{var T=Be=>{var Ie=Sa();Te(Ie,21,()=>e(j),$t,(xt,vt)=>{const gt=m(()=>e(me).find(yt=>yt.url===e(vt))),jt=m(()=>e(gt)?Et(e(gt).url):null);var Bt=Y(),vr=w(Bt);{var cr=yt=>{var Ut=Ha();k(()=>Ue(Ut,"src",e(jt).info.icon)),t(yt,Ut)},ur=yt=>{var Ut=Fa();t(yt,Ut)};p(vr,yt=>{e(jt)?.info?.icon?yt(cr):yt(ur,!1)})}t(xt,Bt)}),r(Ie),t(Be,Ie)},je=Be=>{var Ie=Ua(),xt=l(a(Ie),2);{var vt=gt=>{var jt=Ba(),Bt=a(jt,!0);r(jt),k(()=>D(Bt,e(j).length)),t(gt,jt)};p(xt,gt=>{e(j).length>2&&gt(vt)})}r(Ie),t(Be,Ie)};p(U,Be=>{e(j).length<=2&&e(j).length>0?Be(T):Be(je,!1)})}t(x,K)},$$slots:{default:!0}}),r(St),r(Fe);var O=l(Fe,2);{var ie=x=>{var M=Ta();M.__click=We,M.__keydown=T=>T.key==="Escape"&&We();var K=a(M);K.__click=T=>T.stopPropagation(),K.__keydown=T=>T.stopPropagation();var U=a(K);Zt(U,{get selectedRelayUrls(){return e(j)},onToggleRelay:rt,onSelectOnly:Ye,get isProtected(){return e(J)},set isProtected(T){h(J,T,!0)}}),r(K),r(M),Ot(M,T=>er?.(T)),k(()=>{ut(M,1,`fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity ${e(g)?"opacity-100":"opacity-0"}`),ut(K,1,`bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto transition-all ${e(g)?"scale-100 opacity-100":"scale-95 opacity-0"}`)}),t(x,M)};p(O,x=>{e(g)&&x(ie)})}var de=l(O,2);{var Q=x=>{var M=Ia();Te(M,21,()=>e(P),$t,(K,U)=>{var T=Aa();T.__click=()=>it(e(U));var je=a(T),Be=a(je);r(je),Pe(2),r(T),k(()=>D(Be,`#${e(U)??""}`)),t(K,T)}),r(M),t(x,M)};p(de,x=>{e(P).length>0&&x(Q)})}var Ve=l(de,2);{var Se=x=>{var M=Da(),K=l(a(M),2),U=a(K,!0);r(K);var T=l(K,2);T.__click=()=>h(N,""),r(M),k(()=>D(U,e(N))),t(x,M)};p(Ve,x=>{e(N)&&x(Se)})}r(Pt),r($e),k(()=>{Ue(Me,"src",e(i)[e(H)].url),Ue(Me,"alt",`Image ${e(H)+1}`)}),t(ne,$e)},Xe=ne=>{var $e=Ga(),ue=w($e),ae=a(ue);ae.__click=ke,ae.__keydown=be=>be.key==="Enter"&&ke();var Me=a(ae);{var Ce=be=>{var Fe=Va(),pt=l(a(Fe),2);{var _t=Ze=>{var et=Na(),kt=a(et);r(et),k(()=>D(kt,`${n.progress.percentage??""}%`)),t(Ze,et)};p(pt,Ze=>{n.progress&&Ze(_t)})}r(Fe),t(be,Fe)},Ne=be=>{var Fe=Oa();Pe(6),t(be,Fe)};p(Me,be=>{n.status==="uploading"?be(Ce):be(Ne,!1)})}r(ae),r(ue);var qe=l(ue,2),He=a(qe),st=a(He);{var wt=be=>{var Fe=Ka(),pt=l(a(Fe),4);{var _t=Ze=>{var et=Wa(),kt=a(et);r(et),k(()=>D(kt,`${n.progress.percentage??""}%`)),t(Ze,et)};p(pt,Ze=>{n.progress&&Ze(_t)})}r(Fe),t(be,Fe)},Pt=be=>{var Fe=qa(),pt=l(w(Fe),4);Le(pt,{onclick:ke,children:(_t,Ze)=>{Pe();var et=mt("Choose Photos");t(_t,et)},$$slots:{default:!0}}),t(be,Fe)};p(st,be=>{n.status==="uploading"?be(wt):be(Pt,!1)})}r(He),r(qe),k(()=>ut(ae,1,`w-full max-w-md aspect-square rounded-lg border-2 border-dashed border-border hover:border-primary hover:bg-muted/50 transition-all flex flex-col items-center justify-center cursor-pointer ${e(I)?"border-primary bg-muted/50":""} ${n.status==="uploading"?"pointer-events-none":""}`)),Tt("dragover",ae,Qe),Tt("dragleave",ae,se),Tt("drop",ae,we),t(ne,$e)};p(zt,ne=>{e(i).length>0?ne(Ee):ne(Xe,!1)})}r(Ke),k(()=>xe.disabled=e(y)),t(X,_e)},$$slots:{default:!0}})}),t(R,G)},$$slots:{default:!0}})}),t(o,c)},Ae=o=>{var c=Y(),d=w(c);fe(d,()=>nr,(u,S)=>{S(u,{get open(){return E()},onOpenChange:R=>{E(R),R||F()},children:(R,z)=>{var G=Y(),ye=w(G);fe(ye,()=>sr,(re,ze)=>{ze(re,{children:(X,ce)=>{var _e=wo(),ge=w(_e);fe(ge,()=>dr,(Ee,Xe)=>{Xe(Ee,{class:"text-left",children:(ne,$e)=>{var ue=Y(),ae=w(ue);fe(ae,()=>lr,(Me,Ce)=>{Ce(Me,{children:(Ne,qe)=>{Pe();var He=mt("New Post");t(Ne,He)},$$slots:{default:!0}})}),t(ne,ue)},$$slots:{default:!0}})});var xe=l(ge,2),De=a(xe);De.__change=lt,It(De,Ee=>b=Ee,()=>b);var Je=l(De,2);{var Ke=Ee=>{var Xe=go(),ne=a(Xe),$e=a(ne),ue=l($e,2);ue.__click=()=>nt(e(H));var ae=l(ue,2);{var Me=W=>{var O=Ja();Te(O,21,()=>e(i),$t,(ie,de,Q)=>{var Ve=Ya();Ve.__click=()=>h(H,Q,!0),Ue(Ve,"title",`View image ${Q+1}`),Ue(Ve,"aria-label",`View image ${Q+1}`),k(()=>ut(Ve,1,`w-2 h-2 rounded-full transition-all ${e(H)===Q?"bg-white w-6":"bg-white/50"}`)),t(ie,Ve)}),r(O),t(W,O)};p(ae,W=>{e(i).length>1&&W(Me)})}r(ne);var Ce=l(ne,2);{let W=m(()=>!e($));Xt(Ce,{placeholder:"Write a caption...",rows:4,get autofocus(){return e(W)},class:"resize-none border-0 focus-visible:ring-0 px-3 text-base placeholder:text-muted-foreground",get value(){return e(Z)},set value(O){h(Z,O,!0)}})}var Ne=l(Ce,2),qe=a(Ne);Le(qe,{type:"button",variant:"ghost",size:"icon",onclick:ke,get disabled(){return e(y)},title:"Add more images to your post",class:"h-8 w-8",children:(W,O)=>{var ie=Xa();t(W,ie)},$$slots:{default:!0}});var He=l(qe,2);{let W=m(()=>e(P).length>0?"text-primary":"");Le(He,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(B,!0),get disabled(){return e(y)},title:"Add hashtags to categorize your post and make it discoverable",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ie)=>{var de=eo(),Q=l(a(de),2);{var Ve=Se=>{var x=Za(),M=a(x,!0);r(x),k(()=>D(M,e(P).length)),t(Se,x)};p(Q,Se=>{e(P).length>0&&Se(Ve)})}r(de),t(O,de)},$$slots:{default:!0}})}var st=l(He,2);{let W=m(()=>e(N)?"text-primary":"");Le(st,{type:"button",variant:"ghost",size:"icon",onclick:dt,get disabled(){return e(y)},title:"Add location - uses your device's GPS to tag where this was posted",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ie)=>{var de=to();t(O,de)},$$slots:{default:!0}})}var wt=l(st,2);{let W=m(()=>e(q).length>0?"text-primary":"");Le(wt,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(A,!0),get disabled(){return e(y)},title:"Tag people in this post - they'll be notified",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ie)=>{var de=ao(),Q=l(a(de),2);{var Ve=Se=>{var x=ro(),M=a(x,!0);r(x),k(()=>D(M,e(q).length)),t(Se,x)};p(Q,Se=>{e(q).length>0&&Se(Ve)})}r(de),t(O,de)},$$slots:{default:!0}})}var Pt=l(wt,2);{let W=m(()=>e(oe)?"text-primary":"");Le(Pt,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(oe,!e(oe)),get disabled(){return e(y)},title:"Mark as sensitive content (NSFW)",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ie)=>{var de=oo();t(O,de)},$$slots:{default:!0}})}var be=l(Pt,2),Fe=a(be);Le(Fe,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(g,!e(g)),get disabled(){return e(y)},title:"Choose which relays to publish this post to",class:"h-8 w-8",children:(W,O)=>{var ie=Y(),de=w(ie);{var Q=Se=>{var x=no();Te(x,21,()=>e(j),$t,(M,K)=>{const U=m(()=>e(me).find(vt=>vt.url===e(K))),T=m(()=>e(U)?Et(e(U).url):null);var je=Y(),Be=w(je);{var Ie=vt=>{var gt=so();k(()=>Ue(gt,"src",e(T).info.icon)),t(vt,gt)},xt=vt=>{var gt=lo();t(vt,gt)};p(Be,vt=>{e(T)?.info?.icon?vt(Ie):vt(xt,!1)})}t(M,je)}),r(x),t(Se,x)},Ve=Se=>{var x=vo(),M=l(a(x),2);{var K=U=>{var T=io(),je=a(T,!0);r(T),k(()=>D(je,e(j).length)),t(U,T)};p(M,U=>{e(j).length>2&&U(K)})}r(x),t(Se,x)};p(de,Se=>{e(j).length<=2&&e(j).length>0?Se(Q):Se(Ve,!1)})}t(W,ie)},$$slots:{default:!0}}),r(be),r(Ne);var pt=l(Ne,2);{var _t=W=>{var O=co();O.__click=We,O.__keydown=Q=>Q.key==="Escape"&&We();var ie=a(O);ie.__click=Q=>Q.stopPropagation(),ie.__keydown=Q=>Q.stopPropagation();var de=a(ie);Zt(de,{get selectedRelayUrls(){return e(j)},onToggleRelay:rt,onSelectOnly:Ye,get isProtected(){return e(J)},set isProtected(Q){h(J,Q,!0)}}),r(ie),r(O),Ot(O,Q=>er?.(Q)),k(()=>{ut(O,1,`fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity ${e(g)?"opacity-100":"opacity-0"}`),ut(ie,1,`bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto transition-all ${e(g)?"scale-100 opacity-100":"scale-95 opacity-0"}`)}),t(W,O)};p(pt,W=>{e(g)&&W(_t)})}var Ze=l(pt,2);{var et=W=>{var O=ho();Te(O,21,()=>e(P),$t,(ie,de)=>{var Q=uo();Q.__click=()=>it(e(de));var Ve=a(Q),Se=a(Ve);r(Ve),Pe(2),r(Q),k(()=>D(Se,`#${e(de)??""}`)),t(ie,Q)}),r(O),t(W,O)};p(Ze,W=>{e(P).length>0&&W(et)})}var kt=l(Ze,2);{var St=W=>{var O=po(),ie=l(a(O),2),de=a(ie,!0);r(ie);var Q=l(ie,2);Q.__click=()=>h(N,""),r(O),k(()=>D(de,e(N))),t(W,O)};p(kt,W=>{e(N)&&W(St)})}r(Xe),k(()=>{Ue($e,"src",e(i)[e(H)].url),Ue($e,"alt",`Image ${e(H)+1}`)}),t(Ee,Xe)},Ct=Ee=>{var Xe=xo(),ne=a(Xe),$e=a(ne);{var ue=Me=>{var Ce=mo(),Ne=l(a(Ce),4);{var qe=He=>{var st=fo(),wt=a(st);r(st),k(()=>D(wt,`${n.progress.percentage??""}%`)),t(He,st)};p(Ne,He=>{n.progress&&He(qe)})}r(Ce),t(Me,Ce)},ae=Me=>{var Ce=_o(),Ne=l(w(Ce),4);Le(Ne,{onclick:ke,children:(qe,He)=>{Pe();var st=mt("Choose Photos");t(qe,st)},$$slots:{default:!0}}),t(Me,Ce)};p($e,Me=>{n.status==="uploading"?Me(ue):Me(ae,!1)})}r(ne),r(Xe),t(Ee,Xe)};p(Je,Ee=>{e(i).length>0?Ee(Ke):Ee(Ct,!1)})}r(xe);var zt=l(xe,2);fe(zt,()=>ir,(Ee,Xe)=>{Xe(Ee,{class:"pt-2",children:(ne,$e)=>{var ue=bo(),ae=w(ue);{let Ce=m(()=>!e(Z).trim()||e(i).length===0||e(y)||e(j).length===0);Le(ae,{onclick:at,get disabled(){return e(Ce)},class:"w-full",children:(Ne,qe)=>{Pe();var He=mt();k(()=>D(He,e(y)?"Posting...":"Post")),t(Ne,He)},$$slots:{default:!0}})}var Me=l(ae,2);Le(Me,{variant:"outline",onclick:F,get disabled(){return e(y)},class:"w-full",children:(Ce,Ne)=>{Pe();var qe=mt("Cancel");t(Ce,qe)},$$slots:{default:!0}}),t(ne,ue)},$$slots:{default:!0}})}),t(X,_e)},$$slots:{default:!0}})}),t(R,G)},$$slots:{default:!0}})}),t(o,c)};p(te,o=>{C.current?o(le):o(Ae,!1)})}var L=l(te,2);ba(L,{get selectedTags(){return e(P)},onTagsChange:tt,get open(){return e(B)},set open(o){h(B,o,!0)}});var f=l(L,2);$r(f,{buttonClass:"hidden",iconOnly:!1,get open(){return e(A)},set open(o){h(A,o,!0)},get selectedPubkeys(){return e(q)},set selectedPubkeys(o){h(q,o,!0)}}),t(Ge,ot),Rt()}Ft(["click","change","keydown"]);var $o=s('<div class="p-8 text-center text-muted-foreground">No articles found</div>'),Mo=s('<div class="p-8 text-center text-muted-foreground">Loading articles...</div>'),Co=s('<div class="snap-start snap-always"><!></div>'),Po=s('<div class="py-6 border-b border-border max-w-screen"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2 px-4"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg> Featured</h2> <div class="overflow-x-auto overflow-y-hidden scrollbar-hide snap-x snap-mandatory touch-pan-x"><div class="flex gap-4 px-4 pb-2"></div></div></div>'),jo=s('<div class="min-w-0"><!></div>'),Lo=s('<div class="px-4 py-6 border-b border-border"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> Recent Highlights</h2> <div class="grid grid-cols-2 gap-4 w-full"></div></div>'),Ro=s('<div class="px-4 py-6"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg> Latest Articles</h2> <div class="divide-y divide-neutral-800/50 -mx-4"></div></div>'),zo=s("<!> <!> <!>",1),Ho=s('<div class="pb-6"><!></div> <!>',1),Fo=s('<div class="p-8 text-center text-muted-foreground">No videos found</div>'),So=s('<div class="p-8 text-center text-muted-foreground">Loading videos...</div>'),Bo=s('<div class="p-8 text-center text-muted-foreground">No images found</div>'),Uo=s('<div class="p-8 text-center text-muted-foreground">Loading images...</div>'),To=s('<div class="sm:p-4"><!></div>'),Ao=s('<div class="flex justify-center py-2 lg:relative lg:static fixed bottom-20 left-0 right-0 z-[500] lg:z-auto pointer-events-none"><button class="flex items-center gap-2 px-4 py-2 bg-neutral-900/95 hover:bg-muted border border-primary/50 lg:border-border rounded-full transition-all shadow-lg backdrop-blur-sm pointer-events-auto"><div class="flex -space-x-2"></div> <span class="text-sm text-primary lg:text-foreground font-medium"> </span></button></div>'),Io=s('<div class="p-8 text-center text-muted-foreground">No notes found</div>'),Do=s("<!> <!> <!>",1),Eo=s('<div class="max-w-full mx-auto"><div class="flex flex-col"><!></div></div> <!>',1);function ys(Ge,_){Lt(_,!0);const C=()=>fr(Ar,"$page",E),[E,y]=gr(),H=v=>{aa(v,{get headerTitle(){return e(nt)},get selectedFilter(){return e(g)},onFilterChange:F=>h(g,F,!0)})};let g=pe("conversations");const B=m(()=>C().url.searchParams.get("relay"));bt(()=>{e(B)&&e(B)!==he.selectedRelay&&he.setSelectedRelay(e(B))}),bt(()=>{Hr.set(e(g))});const A=m(()=>br(e(B)||he.selectedRelay,he.relays.filter(v=>v.enabled&&v.read).map(v=>v.url))),Z=m(()=>Oe.$sessions?.follows||[]),N=m(()=>Array.from(e(Z)));function P(v){return v?.startsWith("followpack:")??!1}let q=pe(null);bt(()=>{if(!he.selectedRelay||!P(he.selectedRelay)){h(q,null);return}const v=he.selectedRelay.replace("followpack:","");Oe.fetchEvent(v).then(F=>{h(q,F,!0)}).catch(F=>{console.error("Failed to fetch selected pack:",F),h(q,null)})});const oe=m(()=>e(q)?e(q).tags.filter(v=>v[0]==="p").map(v=>v[1]):he.selectedRelay?[]:e(N)),i=At(Oe,()=>{const v=[{kinds:[ft.Text,9802],limit:200}];return ht.hasFilters&&(v[0]["#t"]=ht.selectedHashtags),(!he.selectedRelay||P(he.selectedRelay))&&e(oe).length>0&&(v[0].authors=e(oe)),!P(he.selectedRelay)&&Oe.$currentPubkey?(console.log("adding a filter for self"),v.push({...v[0],authors:[Oe.$currentPubkey]})):console.log("not adding filter for self",P,!!Oe.$currentPubkey),{filters:v,relayUrls:e(A).length>0?e(A):void 0,subId:"notes",cacheUnconstrainFilter:[],exclusiveRelay:!0}},{initialLimit:20,pageSize:20});console.log("[HomePage] Notes subscription created");const b=At(Oe,()=>{const v={kinds:[ft.Text,ft.Image,ft.Video,ft.ShortVideo],limit:300};return ht.hasFilters&&(v["#t"]=ht.selectedHashtags),(!he.selectedRelay||P(he.selectedRelay))&&e(oe).length>0&&(v.authors=e(oe)),{filters:[v],relayUrls:e(A).length>0?e(A):void 0,cacheUnconstrainFilter:[],subId:"home-media",exclusiveRelay:e(A).length>0}},{initialLimit:30,pageSize:30}),I=At(Oe,()=>{const v={kinds:[ft.Article],limit:100};return ht.hasFilters&&(v["#t"]=ht.selectedHashtags),(!he.selectedRelay||P(he.selectedRelay))&&e(oe).length>0&&(v.authors=e(oe)),{filters:[v],subId:"articles",exclusiveRelay:e(A).length>0,relayUrls:e(A).length>0?e(A):void 0}},{initialLimit:10,pageSize:10}),J=At(Oe,()=>{const v={kinds:[9802],limit:100};return ht.hasFilters&&(v["#t"]=ht.selectedHashtags),(!he.selectedRelay||P(he.selectedRelay))&&e(oe).length>0&&(v.authors=e(oe)),{filters:[v],subId:"highlights",exclusiveRelay:e(A).length>0,relayUrls:e(A).length>0?e(A):void 0}},{initialLimit:10,pageSize:10}),Re=m(()=>I.events.map(v=>wr.from(v))),n=m(()=>e(Re).filter(v=>v.title&&v.content).sort((v,F)=>(F.published_at??F.created_at??0)-(v.published_at??v.created_at??0))),$=m(()=>{const v=e(n).filter(ve=>ve.image),F=e(n).filter(ve=>!ve.image);return[...v,...F].slice(0,10)}),V=m(()=>J.events.slice(0,10)),j=m(()=>e(n).slice(10));function me(v,F){return(F==="image"?/(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|avif))/gi:/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi).test(v)}const ee=m(()=>e(g)==="images"?b.events.filter(v=>v.kind===ft.Image||v.kind===ft.Text&&me(v.content,"image")):e(g)==="videos"?b.events.filter(v=>v.kind===ft.Video||v.kind===ft.ShortVideo||v.kind===22||v.kind===ft.Text&&me(v.content,"video")):[]),lt=m(()=>e(g)==="articles"?[]:i.events),Qe=m(()=>e(g)==="articles"?I.hasMore:i.hasMore),se=m(()=>e(g)==="articles"?I.isLoading:i.isLoading);function we(){e(g)==="articles"?I.loadMore():i.loadMore()}const ke=m(()=>{const v=new Set,F=i.pendingEvents;for(const ve of F){if(v.size>=3)break;v.add(ve.pubkey)}return Array.from(v)}),nt=m(()=>Vt.interests.length>0?null:e(B)?{type:"text",text:Et(e(B)).info?.name||e(B).replace("wss://","").replace("ws://","")}:he.selectedRelay?P(he.selectedRelay)&&e(q)?{type:"text",text:e(q).tagValue("title")||"Untitled Pack"}:{type:"text",text:Et(he.selectedRelay).info?.name||he.selectedRelay.replace("wss://","").replace("ws://","")}:{type:"logo"});bt(()=>{e(g)==="articles"?qt.setReadsMode():qt.reset()}),bt(()=>(Gt.header=H,()=>{Gt.clear()}));var it=Eo(),tt=w(it),rt=a(tt),Ye=a(rt);{var We=v=>{var F=Ho(),ve=w(F),ot=a(ve);{var te=L=>{var f=$o();t(L,f)},le=L=>{var f=Y(),o=w(f);{var c=u=>{var S=Mo();t(u,S)},d=u=>{var S=zo(),R=w(S);{var z=X=>{var ce=Po(),_e=l(a(ce),2),ge=a(_e);Te(ge,21,()=>e($),xe=>xe.id,(xe,De)=>{var Je=Co(),Ke=a(Je);Or(Ke,{get article(){return e(De)}}),r(Je),t(xe,Je)}),r(ge),r(_e),r(ce),t(X,ce)};p(R,X=>{e($).length>0&&X(z)})}var G=l(R,2);{var ye=X=>{var ce=Lo(),_e=l(a(ce),2);Te(_e,21,()=>e(V),ge=>ge.id,(ge,xe)=>{var De=jo(),Je=a(De);Qt(Je,{get event(){return e(xe)},variant:"grid"}),r(De),t(ge,De)}),r(_e),r(ce),t(X,ce)};p(G,X=>{e(V).length>0&&X(ye)})}var re=l(G,2);{var ze=X=>{var ce=Ro(),_e=l(a(ce),2);Te(_e,21,()=>e(j),ge=>ge.id,(ge,xe)=>{Pr(ge,{get article(){return e(xe)}})}),r(_e),r(ce),t(X,ce)};p(re,X=>{e(j).length>0&&X(ze)})}t(u,S)};p(o,u=>{e(n).length===0?u(c):u(d,!1)},!0)}t(L,f)};p(ot,L=>{e(n).length===0&&I.eosed?L(te):L(le,!1)})}r(ve);var Ae=l(ve,2);Yt(Ae,{onIntersect:we,get hasMore(){return I.hasMore},get isLoading(){return I.isLoading}}),t(v,F)},dt=v=>{var F=Y(),ve=w(F);{var ot=le=>{var Ae=Y(),L=w(Ae);{var f=c=>{var d=Fo();t(c,d)},o=c=>{var d=Y(),u=w(d);{var S=z=>{var G=So();t(z,G)},R=z=>{Jr(z,{get events(){return e(ee)}})};p(u,z=>{e(ee).length===0?z(S):z(R,!1)},!0)}t(c,d)};p(L,c=>{e(ee).length===0&&b.eosed?c(f):c(o,!1)})}t(le,Ae)},te=le=>{var Ae=Y(),L=w(Ae);{var f=c=>{var d=To(),u=a(d);{var S=z=>{var G=Bo();t(z,G)},R=z=>{var G=Y(),ye=w(G);{var re=X=>{var ce=Uo();t(X,ce)},ze=X=>{Rr(X,{get events(){return e(ee)}})};p(ye,X=>{e(ee).length===0?X(re):X(ze,!1)},!0)}t(z,G)};p(u,z=>{e(ee).length===0&&b.eosed?z(S):z(R,!1)})}r(d),t(c,d)},o=c=>{var d=Do(),u=w(d);{var S=re=>{var ze=Ao(),X=a(ze);X.__click=()=>i.loadPendingEvents();var ce=a(X);Te(ce,20,()=>e(ke).slice(0,3),xe=>xe,(xe,De)=>{var Je=Y(),Ke=w(Je);fe(Ke,()=>Dt.Root,(Ct,zt)=>{zt(Ct,{get ndk(){return Oe},get pubkey(){return De},children:(Ee,Xe)=>{var ne=Y(),$e=w(ne);fe($e,()=>Dt.Avatar,(ue,ae)=>{ae(ue,{class:"w-6 h-6 rounded-full border-2 border-foreground"})}),t(Ee,ne)},$$slots:{default:!0}})}),t(xe,Je)}),r(ce);var _e=l(ce,2),ge=a(_e);r(_e),r(X),r(ze),k(()=>D(ge,`${i.pendingCount??""} new ${i.pendingCount===1?"note":"notes"}`)),t(re,ze)};p(u,re=>{i.pendingCount>0&&re(S)})}var R=l(u,2);{var z=re=>{var ze=Io();t(re,ze)},G=re=>{var ze=Y(),X=w(ze);Te(X,17,()=>e(lt),ce=>ce.id,(ce,_e)=>{var ge=Y(),xe=w(ge);{var De=Ke=>{Qt(Ke,{get event(){return e(_e)},variant:"feed"})},Je=Ke=>{Mr(Ke,{get event(){return e(_e)}})};p(xe,Ke=>{e(_e).kind===9802?Ke(De):Ke(Je,!1)})}t(ce,ge)}),t(re,ze)};p(R,re=>{e(lt).length===0?re(z):re(G,!1)})}var ye=l(R,2);Yt(ye,{onIntersect:we,get hasMore(){return e(Qe)},get isLoading(){return e(se)}}),t(c,d)};p(L,c=>{e(g)==="images"?c(f):c(o,!1)},!0)}t(le,Ae)};p(ve,le=>{e(g)==="videos"?le(ot):le(te,!1)},!0)}t(v,F)};p(Ye,v=>{e(g)==="articles"?v(We):v(dt,!1)})}r(rt),r(tt);var at=l(tt,2);yo(at,{onClose:()=>Nt.close(),get open(){return Nt.show},set open(v){Nt.show=v}}),t(Ge,it),Rt(),y()}Ft(["click"]);export{ys as component};
