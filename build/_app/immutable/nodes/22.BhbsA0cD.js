import{d as Je,f as j,a as k,s as n,c as Pe}from"../chunks/CiPFrJr-.js";import{p as Ge,g as e,u as y,a as ae,s as L,b as Y,x as Ke,c as qe,e as t,r,d as a,t as I,f as Qe,y as We}from"../chunks/CSbKtK4P.js";import{i as H,s as Xe,a as we}from"../chunks/87vUJtvC.js";import{p as Ze}from"../chunks/fk9xBW3Y.js";import{g as ie}from"../chunks/CTwadDAE.js";import{n as O,k as Me,A as De,f as et}from"../chunks/D0X4VYcq.js";import{d as tt}from"../chunks/BSM2-0iS.js";import{o as rt}from"../chunks/Ckk1NcCI.js";import{$ as at}from"../chunks/Ce4T6J7V.js";function it(oe,f){e(f)&&(rt.setInvite({welcomeMessage:e(f).welcomeMessage,recipientName:e(f).recipientName,cashuToken:e(f).cashuToken,inviter:e(f).inviter,inviteEventId:e(f).inviteEventId,inviteRelay:e(f).inviteRelay,inviteCode:e(f).inviteCode}),ie("/onboarding"))}function ot(){ie("/")}var nt=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-orange-600 mx-auto mb-4"></div> <p class="text-muted-foreground"> </p></div></div>'),st=()=>ie("/"),dt=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div> <h2 class="text-xl font-bold text-foreground mb-2"> </h2> <p class="text-muted-foreground mb-6"> </p> <button class="px-6 py-2 bg-primary hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors"> </button></div></div>'),lt=j('<div class="flex flex-col items-center mb-8 -mt-20"><div class="relative mb-4"><div class="w-24 h-24 rounded-full ring-4 ring-white dark:ring-neutral-900 overflow-hidden bg-neutral-200 dark:bg-neutral-800 flex items-center justify-center"><!></div></div> <div class="text-center"><h2 class="text-xl font-bold text-foreground"> </h2> <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"> </p></div></div>'),vt=j('<div class="mb-8 p-6 bg-neutral-50 dark:bg-neutral-800/50 rounded-xl border border-border"><p class="text-foreground whitespace-pre-wrap leading-relaxed"> </p></div>'),ct=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden"><div class="h-32 bg-primary opacity-90"></div> <div class="px-8 pb-8 pt-12"><!> <!> <div class="text-center mb-8"><h1 class="text-3xl font-bold mb-3 text-foreground"> </h1> <p class="text-muted-foreground"> </p></div> <div class="space-y-5 mb-10"><div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-primary dark:text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div></div> <div class="space-y-4"><button class="w-full py-6 text-lg font-semibold bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white shadow-lg transition-all duration-200 hover:shadow-xl rounded-xl flex items-center justify-center gap-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg></button> <button class="w-full text-center text-muted-foreground hover:text-neutral-900 dark:hover:text-neutral-200 transition-colors py-2"> <span class="font-semibold underline"> </span></button></div> <div class="mt-8 pt-6 border-t border-neutral-200 dark:border-neutral-800"><p class="text-xs text-center text-neutral-500"> </p></div></div></div>'),ut=j('<div class="min-h-screen bg-gradient-to-b from-neutral-50 to-neutral-100 dark:from-neutral-950 dark:to-neutral-900 flex items-center justify-center p-4"><div class="w-full max-w-xl"><!></div></div>');function yt(oe,f){Ge(f,!0);const Ce=()=>we(Ze,"$page",ne),i=()=>we(at,"$t",ne),[ne,je]=Xe(),b=y(()=>Ce().params.code),Se=y(()=>e(b)?e(b).slice(0,12):null),se=y(()=>e(b)&&e(b).length>12?e(b).slice(12):null),U=O.$subscribe(()=>({filters:{kinds:[513],"#d":[e(Se)],limit:1},relayUrls:[...De],subId:"invite",cacheUsage:Me.ONLY_RELAY,closeOnEose:!0}));let v=Y(null);ae(()=>{L(v,e(v)??U.events[0],!0)});let s=Y(null);ae(()=>{!e(v)||!e(b)||e(s)||(async()=>{try{const d=e(v).tags.filter(l=>l[0]==="code").map(l=>l[1]);if(d.length===0)return;const g=e(v).relay?.url||Array.from(e(v).onRelays)[0]?.url;let c;if(e(se)){const l=await tt(e(v).content,e(se));c=JSON.parse(l)}else c=JSON.parse(e(v).content);L(s,{...c,inviteEventId:e(v).id,inviteRelay:g,inviteCode:d[0],validCodes:d},!0)}catch(o){console.error("Failed to parse invite:",o)}})()});let de=Y(Ke(new Set)),T=Y(!1);ae(()=>{!e(v)||!e(s)||e(T)||(async()=>{L(T,!0);const o=e(s).inviteRelay;if(o)try{const d=await O.guardrailOff().fetchEvents({kinds:[514],"#e":[e(v).id]},{relayUrls:[o],subId:"invite-redemptions",cacheUsage:Me.ONLY_RELAY}),g=new Set;for(const l of d){const u=l.tags.find(p=>p[0]==="code");u?.[1]&&g.add(u[1])}L(de,g,!0);const c=e(s).validCodes?.filter(l=>!g.has(l))||[];c.length>0&&(e(s).inviteCode=c[0])}catch(d){console.error("Failed to fetch redemptions:",d)}})()});const Ne=y(()=>e(s)?.validCodes?e(s).validCodes.some(o=>!e(de).has(o)):!1),le=y(()=>{const o=e(s)?.inviter;return o?O.$fetchProfile(()=>o):null}),Ae=y(()=>!e(b)||!e(s)),ve=y(()=>{if(!e(b)||U.events.length===0&&U.eosed)return i()("onboarding.invite.inviteNotFound");if(e(s)&&!e(Ne)&&e(T)){const o=e(s).inviter?"them":"the inviter";return i()("onboarding.invite.inviteReachedMax",{values:{inviter:o}})}return null});var V=ut(),ce=t(V),Ie=t(ce);{var Re=o=>{var d=nt(),g=t(d),c=a(t(g),2),l=t(c,!0);r(c),r(g),r(d),I(u=>n(l,u),[()=>i()("onboarding.invite.loadingInvite")]),k(o,d)},$e=o=>{var d=Pe(),g=Qe(d);{var c=u=>{var p=dt(),S=t(p),w=a(t(S),2),z=t(w,!0);r(w);var M=a(w,2),B=t(M,!0);r(M);var _=a(M,2);_.__click=[st];var N=t(_,!0);r(_),r(S),r(p),I((J,R)=>{n(z,J),n(B,e(ve)),n(N,R)},[()=>i()("onboarding.invite.inviteNotFound"),()=>i()("onboarding.invite.goHome")]),k(u,p)},l=u=>{var p=ct(),S=a(t(p),2),w=t(S);{var z=m=>{var x=lt(),h=t(x),C=t(h),D=t(C);et(D,{get ndk(){return O},get pubkey(){return e(s).inviter},class:"w-full h-full object-cover [&>*]:w-full [&>*]:h-full [&>*]:object-cover"}),r(C),r(h);var E=a(h,2),A=t(E),ee=t(A,!0);r(A);var F=a(A,2),te=t(F,!0);r(F),r(E),r(x),I(re=>{n(ee,e(le)?.displayName||e(le)?.name||"Someone"),n(te,re)},[()=>i()("onboarding.invite.invitedYou")]),k(m,x)};H(w,m=>{e(s)?.inviter&&m(z)})}var M=a(w,2);{var B=m=>{var x=vt(),h=t(x),C=t(h,!0);r(h),r(x),I(()=>n(C,e(s).welcomeMessage)),k(m,x)};H(M,m=>{e(s)?.welcomeMessage&&m(B)})}var _=a(M,2),N=t(_),J=t(N,!0);r(N);var R=a(N,2),Ee=t(R,!0);r(R),r(_);var P=a(_,2),G=t(P),ue=a(t(G),2),K=t(ue),Fe=t(K,!0);r(K);var fe=a(K,2),Le=t(fe,!0);r(fe),r(ue),r(G);var q=a(G,2),ge=a(t(q),2),Q=t(ge),Ye=t(Q,!0);r(Q);var pe=a(Q,2),He=t(pe,!0);r(pe),r(ge),r(q);var me=a(q,2),xe=a(t(me),2),W=t(xe),Oe=t(W,!0);r(W);var be=a(W,2),Ue=t(be,!0);r(be),r(xe),r(me),r(P);var X=a(P,2),$=t(X);$.__click=[it,s];var Te=t($);We(),r($);var Z=a($,2);Z.__click=[ot];var he=t(Z),_e=a(he),Ve=t(_e,!0);r(_e),r(Z),r(X);var ke=a(X,2),ye=t(ke),ze=t(ye,!0);r(ye),r(ke),r(S),r(p),I((m,x,h,C,D,E,A,ee,F,te,re,Be)=>{n(J,m),n(Ee,x),n(Fe,h),n(Le,C),n(Ye,D),n(He,E),n(Oe,A),n(Ue,ee),n(Te,`${F??""} `),n(he,`${te??""}  `),n(Ve,re),n(ze,Be)},[()=>i()("onboarding.invite.yourVoiceMatters"),()=>i()("onboarding.invite.joinGlobal"),()=>i()("onboarding.invite.ownYourVoice.title"),()=>i()("onboarding.invite.ownYourVoice.description"),()=>i()("onboarding.invite.earnFromStories.title"),()=>i()("onboarding.invite.earnFromStories.description"),()=>i()("onboarding.invite.connectCommunity.title"),()=>i()("onboarding.invite.connectCommunity.description"),()=>i()("onboarding.invite.startJourney"),()=>i()("onboarding.invite.alreadyHaveAccount"),()=>i()("onboarding.invite.signInHere"),()=>i()("onboarding.invite.trustSignals")]),k(u,p)};H(g,u=>{e(ve)?u(c):u(l,!1)},!0)}k(o,d)};H(Ie,o=>{e(Ae)?o(Re):o($e,!1)})}r(ce),r(V),k(oe,V),qe(),je()}Je(["click"]);export{yt as component};
