import{d as Ir,c as vr,j as Ge,a as l,f as n,t as K,s as D,i as jr}from"../chunks/DNmf0A2m.js";import{a as X,x as Sr,g as e,s as d,p as Br,f as he,c as Er,aH as Vr,d as o,e as a,y,r as t,t as h,b as Me,u as Ur}from"../chunks/DpkVnRja.js";import{i as F}from"../chunks/Btb_Ey2R.js";import{e as le,i as be}from"../chunks/DD8s4tVe.js";import{a as Pr,f as Ke,c as xe,r as Fr}from"../chunks/Ci0hv7jC.js";import{b as zr}from"../chunks/Cl1e4hnh.js";import{n as ur,k as Ar}from"../chunks/QTLWRGLp.js";import{g as cr}from"../chunks/BFZgCa8b.js";import{h as Lr}from"../chunks/Jrqc4XQc.js";import{c as Cr}from"../chunks/D4c95ZgK.js";import{c as fe}from"../chunks/CSx53_lc.js";import{b as Dr}from"../chunks/-Mgh5RB7.js";import{p as Or}from"../chunks/f_qAQkK6.js";import{t as Qe}from"../chunks/BHGJODx2.js";import{M as Hr,D as Rr,a as Tr,R as qr,b as Nr,c as Wr,d as Gr}from"../chunks/ExIc70cS.js";import{D as Kr}from"../chunks/DuCXCqgL.js";import{D as Qr,a as Jr}from"../chunks/BJCNLf3C.js";import{I as _e,B as Je}from"../chunks/OHIcQ-QL.js";import{L as ee}from"../chunks/CRTsssmk.js";import{T as Mr}from"../chunks/Cm-nUtcq.js";import{N as Xr,c as Yr}from"../chunks/CwXZxT0m.js";import{D as Zr}from"../chunks/BGQ6BdS-.js";function et(Xe,Pe={}){const Ye=new Xr(Xe),S=Yr(Ye);let g=X(Sr([])),M=X(0),Q=X(!1);async function z(v){if(!v.type.startsWith("image/")){Qe.error("Please select an image file");return}try{if(await S.upload(v,{fallbackServer:Pe.fallbackServer||"https://blossom.primal.net"}),S.result?.url){const B=new Image,re=await new Promise(De=>{B.onload=()=>De({width:B.width,height:B.height}),B.src=URL.createObjectURL(v)}),Le=Array.isArray(S.result.sha256)?S.result.sha256[0]:S.result.sha256||"";d(g,[...e(g),{url:S.result.url,mimeType:v.type,hash:Le,blurhash:S.result.blurhash,dimensions:re}],!0),d(M,e(g).length-1)}}catch(B){console.error("Upload failed:",B),Qe.error("Failed to upload image")}}function ie(v){const re=v.target.files;re&&Array.from(re).forEach(Le=>z(Le))}function pe(v){v.preventDefault(),d(Q,!0)}function me(){d(Q,!1)}async function N(v){v.preventDefault(),d(Q,!1);const B=v.dataTransfer?.files;B&&Array.from(B).forEach(re=>z(re))}function W(v){d(g,e(g).filter((B,re)=>re!==v),!0),e(M)>=e(g).length&&d(M,Math.max(0,e(g).length-1),!0)}function A(){d(g,[],!0),d(M,0),d(Q,!1)}return{get uploadedImages(){return e(g)},set uploadedImages(v){d(g,v,!0)},get currentImageIndex(){return e(M)},set currentImageIndex(v){d(M,v,!0)},get isDragging(){return e(Q)},get uploadStatus(){return S.status},get uploadProgress(){return S.progress},uploadFile:z,handleFileInputChange:ie,handleDragOver:pe,handleDragLeave:me,handleDrop:N,removeImage:W,reset:A}}var rt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),tt=n('Title <span class="text-red-500">*</span>',1),ot=n('Description <span class="text-red-500">*</span>',1),at=n("<option> </option>"),st=n("<option> </option>"),lt=jr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),it=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),nt=n('<div class="flex flex-wrap gap-2"></div>'),dt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),vt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),ut=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),ct=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),pt=n("<!> <!>",1),gt=n('<!> <div class="space-y-6"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1),mt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),ft=n('Title <span class="text-red-500">*</span>',1),_t=n('Description <span class="text-red-500">*</span>',1),ht=n("<option> </option>"),bt=n("<option> </option>"),xt=jr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),yt=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),$t=n('<div class="flex flex-wrap gap-2"></div>'),kt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),wt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),Ct=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Pt=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),Lt=n("<!> <!>",1),Dt=n('<!> <div class="px-4 space-y-6 overflow-auto flex-1"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1);function Mt(Xe,Pe){Br(Pe,!0);const Ye=new Hr("(min-width: 768px)");let S=Or(Pe,"open",15,!1),g=X(!1),M=X(""),Q=X(""),z=X(""),ie=X(""),pe=X(""),me=X("USD"),N=X(void 0),W=X(Sr([])),A=X("");const v=et(ur,{fallbackServer:"https://blossom.primal.net"});let B;const re=["electronics","furniture","clothing","books","services","vehicles","real-estate","jobs","free","wanted"],Le=["USD","EUR","GBP","BTC","SATS"];function De(){e(A)&&!e(W).includes(e(A).toLowerCase())&&(d(W,[...e(W),e(A).toLowerCase()],!0),d(A,""))}function p(u){d(W,e(W).filter(m=>m!==u),!0)}async function k(){if(!e(M).trim()||!e(z).trim()||e(g)){Qe.error("Please provide a title and description");return}if(!ur.$currentUser){Qe.error("Please log in to create a listing");return}try{d(g,!0);const u=new Ar(ur);if(u.title=e(M).trim(),u.summary=e(Q).trim()||void 0,u.content=e(z).trim(),u.location=e(ie).trim()||void 0,u.published_at=Math.floor(Date.now()/1e3),u.tags.push(["status","active"]),e(pe).trim()&&(u.price={amount:parseFloat(e(pe)),currency:e(me),frequency:e(N)&&e(N)!=="once"?e(N):void 0}),e(W).forEach(m=>{u.tags.push(["t",m])}),v.uploadedImages.forEach(m=>{u.tags.push(["image",m.url])}),await u.sign(),await u.publish(),u.publishStatus==="error"){const $=u.publishError?.relayErrors||{},V=Object.entries($).map(([j,f])=>`${j}: ${f}`).join(`
`);Qe.error(`Failed to publish:
${V||"Unknown error"}`);return}Qe.success("Listing created successfully"),E(),S(!1),Pe.onClose?.(),cr("/marketplace")}catch(u){console.error("Failed to publish listing:",u),Qe.error(`Failed to create listing: ${u instanceof Error?u.message:"Unknown error"}`)}finally{d(g,!1)}}function E(){d(M,""),d(Q,""),d(z,""),d(ie,""),d(pe,""),d(me,"USD"),d(N,void 0),d(W,[],!0),d(A,""),v.reset()}function I(){e(g)||(E(),S(!1),Pe.onClose?.())}function Y(u){u.key==="Escape"&&!e(g)&&I()}var C=vr();Ge("keydown",Vr,Y);var b=he(C);{var J=u=>{var m=vr(),$=he(m);fe($,()=>qr,(V,j)=>{j(V,{get open(){return S()},onOpenChange:f=>{S(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Rr,(P,x)=>{x(P,{class:"max-w-4xl max-h-[90vh] overflow-y-auto",children:(q,de)=>{var oe=gt(),ye=he(oe);fe(ye,()=>Qr,(r,i)=>{i(r,{children:(s,w)=>{var c=rt(),_=o(a(c),2);fe(_,()=>Tr,(R,T)=>{T(R,{children:(we,We)=>{y();var Ce=K("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=o(ye,2),ae=a(ve),L=a(ae),U=a(L);ee(U,{for:"title",children:(r,i)=>{y();var s=tt();y(),l(r,s)},$$slots:{default:!0}});var ue=o(U,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(M)},set value(r){d(M,r,!0)}}),t(L);var se=o(L,2),$e=a(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=K("Summary");l(r,s)},$$slots:{default:!0}});var G=o($e,2);_e(G,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(Q)},set value(r){d(Q,r,!0)}}),t(se);var O=o(se,2),ce=a(O);ee(ce,{for:"content",children:(r,i)=>{y();var s=ot();y(),l(r,s)},$$slots:{default:!0}});var Ie=o(ce,2);Mr(Ie,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(z)},set value(r){d(z,r,!0)}}),t(O);var je=o(O,2),Ze=a(je);ee(Ze,{for:"location",children:(r,i)=>{y();var s=K("Location");l(r,s)},$$slots:{default:!0}});var pr=o(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(je),t(ae);var Se=o(ae,2),er=o(a(Se),2),Be=a(er),rr=a(Be);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=K("Amount");l(r,s)},$$slots:{default:!0}});var gr=o(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Be);var Ee=o(Be,2),tr=a(Ee);ee(tr,{for:"currency",children:(r,i)=>{y();var s=K("Currency");l(r,s)},$$slots:{default:!0}});var Ve=o(tr,2);le(Ve,21,()=>Le,be,(r,i)=>{var s=at(),w=a(s,!0);t(s);var c={};h(()=>{D(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ve),t(Ee);var or=o(Ee,2),ar=a(or);ee(ar,{for:"frequency",children:(r,i)=>{y();var s=K("Frequency");l(r,s)},$$slots:{default:!0}});var Ue=o(ar,2),Fe=a(Ue);Fe.value=(Fe.__value=void 0)??"";var ze=o(Fe);ze.value=ze.__value="hour";var Ae=o(ze);Ae.value=Ae.__value="day";var Oe=o(Ae);Oe.value=Oe.__value="week";var He=o(Oe);He.value=He.__value="month";var sr=o(He);sr.value=sr.__value="year",t(Ue),t(or),t(er),t(Se);var Re=o(Se,2),lr=o(a(Re),2),Te=a(lr),ke=a(Te),qe=a(ke);qe.value=qe.__value="";var mr=o(qe);le(mr,17,()=>re,be,(r,i)=>{var s=st(),w=a(s,!0);t(s);var c={};h(_=>{D(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=o(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),De())},get value(){return e(A)},set value(r){d(A,r,!0)}});var fr=o(ir,2);Je(fr,{type:"button",onclick:De,size:"icon",children:(r,i)=>{var s=lt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=o(Te,2);{var hr=r=>{var i=nt();le(i,21,()=>e(W),be,(s,w)=>{var c=it(),_=a(c),R=a(_,!0);t(_);var T=o(_,2);T.__click=()=>p(e(w)),t(c),h(()=>D(R,e(w))),l(s,c)}),t(i),l(r,i)};F(_r,r=>{e(W).length>0&&r(hr)})}t(lr),t(Re);var nr=o(Re,2),dr=o(a(nr),2),Ne=a(dr);Ne.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Dr(Ne,r=>B=r,()=>B);var H=o(Ne,2);H.__click=()=>B?.click();var br=a(H);{var xr=r=>{var i=dt(),s=o(a(i),2),w=a(s);t(s),t(i),h(()=>D(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=vt();y(4),l(r,i)};F(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(H);var $r=o(H,2);{var kr=r=>{var i=ct();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=ut(),R=a(_);xe(R,"alt",`Listing image ${c+1}`);var T=o(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};F($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=o(ve,2);fe(wr,()=>Zr,(r,i)=>{i(r,{class:"flex gap-3 sm:space-x-0",children:(s,w)=>{var c=pt(),_=he(c);Je(_,{variant:"outline",onclick:I,get disabled(){return e(g)},children:(T,we)=>{y();var We=K("Cancel");l(T,We)},$$slots:{default:!0}});var R=o(_,2);{let T=Me(()=>!e(M).trim()||!e(z).trim()||e(g));Je(R,{onclick:k,get disabled(){return e(T)},children:(we,We)=>{y();var Ce=K();h(()=>D(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}l(s,c)},$$slots:{default:!0}})}),h(()=>{H.disabled=v.uploadStatus==="uploading",Pr(H,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),Ke(Ve,()=>e(me),r=>d(me,r)),Ke(Ue,()=>e(N),r=>d(N,r)),Ke(ke,()=>e(A),r=>d(A,r)),Ge("dragover",H,function(...r){v.handleDragOver?.apply(this,r)}),Ge("dragleave",H,function(...r){v.handleDragLeave?.apply(this,r)}),Ge("drop",H,function(...r){v.handleDrop?.apply(this,r)}),l(q,oe)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)},te=u=>{var m=vr(),$=he(m);fe($,()=>Gr,(V,j)=>{j(V,{get open(){return S()},onOpenChange:f=>{S(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Nr,(P,x)=>{x(P,{children:(q,de)=>{var oe=Dt(),ye=he(oe);fe(ye,()=>Jr,(r,i)=>{i(r,{class:"text-left",children:(s,w)=>{var c=mt(),_=o(a(c),2);fe(_,()=>Wr,(R,T)=>{T(R,{children:(we,We)=>{y();var Ce=K("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=o(ye,2),ae=a(ve),L=a(ae),U=a(L);ee(U,{for:"title",children:(r,i)=>{y();var s=ft();y(),l(r,s)},$$slots:{default:!0}});var ue=o(U,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(M)},set value(r){d(M,r,!0)}}),t(L);var se=o(L,2),$e=a(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=K("Summary");l(r,s)},$$slots:{default:!0}});var G=o($e,2);_e(G,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(Q)},set value(r){d(Q,r,!0)}}),t(se);var O=o(se,2),ce=a(O);ee(ce,{for:"content",children:(r,i)=>{y();var s=_t();y(),l(r,s)},$$slots:{default:!0}});var Ie=o(ce,2);Mr(Ie,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(z)},set value(r){d(z,r,!0)}}),t(O);var je=o(O,2),Ze=a(je);ee(Ze,{for:"location",children:(r,i)=>{y();var s=K("Location");l(r,s)},$$slots:{default:!0}});var pr=o(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(je),t(ae);var Se=o(ae,2),er=o(a(Se),2),Be=a(er),rr=a(Be);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=K("Amount");l(r,s)},$$slots:{default:!0}});var gr=o(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Be);var Ee=o(Be,2),tr=a(Ee);ee(tr,{for:"currency",children:(r,i)=>{y();var s=K("Currency");l(r,s)},$$slots:{default:!0}});var Ve=o(tr,2);le(Ve,21,()=>Le,be,(r,i)=>{var s=ht(),w=a(s,!0);t(s);var c={};h(()=>{D(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ve),t(Ee);var or=o(Ee,2),ar=a(or);ee(ar,{for:"frequency",children:(r,i)=>{y();var s=K("Frequency");l(r,s)},$$slots:{default:!0}});var Ue=o(ar,2),Fe=a(Ue);Fe.value=(Fe.__value=void 0)??"";var ze=o(Fe);ze.value=ze.__value="hour";var Ae=o(ze);Ae.value=Ae.__value="day";var Oe=o(Ae);Oe.value=Oe.__value="week";var He=o(Oe);He.value=He.__value="month";var sr=o(He);sr.value=sr.__value="year",t(Ue),t(or),t(er),t(Se);var Re=o(Se,2),lr=o(a(Re),2),Te=a(lr),ke=a(Te),qe=a(ke);qe.value=qe.__value="";var mr=o(qe);le(mr,17,()=>re,be,(r,i)=>{var s=bt(),w=a(s,!0);t(s);var c={};h(_=>{D(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=o(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),De())},get value(){return e(A)},set value(r){d(A,r,!0)}});var fr=o(ir,2);Je(fr,{type:"button",onclick:De,size:"icon",children:(r,i)=>{var s=xt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=o(Te,2);{var hr=r=>{var i=$t();le(i,21,()=>e(W),be,(s,w)=>{var c=yt(),_=a(c),R=a(_,!0);t(_);var T=o(_,2);T.__click=()=>p(e(w)),t(c),h(()=>D(R,e(w))),l(s,c)}),t(i),l(r,i)};F(_r,r=>{e(W).length>0&&r(hr)})}t(lr),t(Re);var nr=o(Re,2),dr=o(a(nr),2),Ne=a(dr);Ne.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Dr(Ne,r=>B=r,()=>B);var H=o(Ne,2);H.__click=()=>B?.click();var br=a(H);{var xr=r=>{var i=kt(),s=o(a(i),2),w=a(s);t(s),t(i),h(()=>D(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=wt();y(4),l(r,i)};F(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(H);var $r=o(H,2);{var kr=r=>{var i=Pt();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=Ct(),R=a(_);xe(R,"alt",`Listing image ${c+1}`);var T=o(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};F($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=o(ve,2);fe(wr,()=>Kr,(r,i)=>{i(r,{class:"pt-2",children:(s,w)=>{var c=Lt(),_=he(c);{let T=Me(()=>!e(M).trim()||!e(z).trim()||e(g));Je(_,{onclick:k,get disabled(){return e(T)},class:"w-full",children:(we,We)=>{y();var Ce=K();h(()=>D(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}var R=o(_,2);Je(R,{variant:"outline",onclick:I,get disabled(){return e(g)},class:"w-full",children:(T,we)=>{y();var We=K("Cancel");l(T,We)},$$slots:{default:!0}}),l(s,c)},$$slots:{default:!0}})}),h(()=>{H.disabled=v.uploadStatus==="uploading",Pr(H,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),Ke(Ve,()=>e(me),r=>d(me,r)),Ke(Ue,()=>e(N),r=>d(N,r)),Ke(ke,()=>e(A),r=>d(A,r)),Ge("dragover",H,function(...r){v.handleDragOver?.apply(this,r)}),Ge("dragleave",H,function(...r){v.handleDragLeave?.apply(this,r)}),Ge("drop",H,function(...r){v.handleDrop?.apply(this,r)}),l(q,oe)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)};F(b,u=>{Ye.current?u(J):u(te,!1)})}l(Xe,C),Er()}Ir(["click","change"]);var It=n("<option> </option>"),jt=n('<div class="container mx-auto px-4 py-3 max-w-7xl"><div class="mb-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">Marketplace</h1> <button class="hidden sm:flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-foreground font-medium rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span>Create Listing</span></button></div> <div class="flex gap-2 sm:gap-3"><div class="flex-1"><div class="relative"><svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search listings..." class="w-full pl-10 h-12 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all"/></div></div> <div class="relative"><select class="h-12 px-4 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all appearance-none pr-10"></select> <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div></div></div>'),St=n('<div class="mb-6"><h2 class="text-xl font-semibold text-foreground"> </h2> <p class="text-sm text-muted-foreground mt-1"> </p></div>'),Bt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Et=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Vt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Ut=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Ft=n('<div class="col-span-full text-center py-12 text-muted-foreground">No listings found</div>'),zt=n('<div><!> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),At=n('<div class="text-center py-12 text-muted-foreground">No marketplace items yet</div>'),Ot=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Ht=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Rt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Tt=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),qt=n('<div class="mb-8"><h2 class="text-xl font-semibold text-foreground mb-4">Recent Listings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Nt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Wt=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Gt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Kt=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Qt=n('<div class="mb-8"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-foreground"> </h2> <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline">View All</button></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Jt=n("<!> <!>",1),Xt=n("<div><!></div>"),Yt=n('<div class="min-h-screen bg-neutral-50 dark:bg-background"><div class="container mx-auto px-4 py-4 max-w-7xl"><!></div> <!></div>');function $o(Xe,Pe){Br(Pe,!0);const Ye=p=>{var k=jt(),E=a(k),I=a(E),Y=o(a(I),2);Y.__click=()=>Cr.open(),t(I);var C=o(I,2),b=a(C),J=a(b),te=o(a(J),2);Fr(te),t(J),t(b);var u=o(b,2),m=a(u);le(m,21,()=>S,be,($,V)=>{var j=It(),f=a(j,!0);t(j);var ne={};h(()=>{D(f,e(V).label),ne!==(ne=e(V).value)&&(j.value=(j.__value=e(V).value)??"")}),l($,j)}),t(m),y(2),t(u),t(C),t(E),t(k),zr(te,()=>e(M),$=>d(M,$)),Ke(m,()=>e(g),$=>d(g,$)),l(p,k)},S=[{value:"",label:"All Categories"},{value:"electronics",label:"Electronics"},{value:"furniture",label:"Furniture"},{value:"clothing",label:"Clothing"},{value:"books",label:"Books"},{value:"services",label:"Services"},{value:"vehicles",label:"Vehicles"},{value:"real-estate",label:"Real Estate"},{value:"jobs",label:"Jobs"},{value:"free",label:"Free"},{value:"wanted",label:"Wanted"}];let g=X(""),M=X("");const Q=ur.$subscribe(()=>{const p={kinds:[30402],limit:50};return e(g)&&(p["#t"]=[e(g).toLowerCase()]),{filters:[p],bufferMs:100}}),z=Me(()=>Q.events.filter(p=>{if((p.tagValue("status")||"active")!=="active")return!1;if(!e(M))return!0;const E=e(M).toLowerCase(),I=p.tagValue("title")?.toLowerCase()||"",Y=p.tagValue("summary")?.toLowerCase()||"",C=p.content?.toLowerCase()||"",b=p.tagValue("location")?.toLowerCase()||"";return I.includes(E)||Y.includes(E)||C.includes(E)||b.includes(E)})),ie=Me(()=>{const p={};return e(z).forEach(k=>{const E=k.tags.filter(I=>I[0]==="t").map(I=>I[1]);E.length>0?E.forEach(I=>{const Y=I.toLowerCase();p[Y]||(p[Y]=[]),p[Y].push(k)}):(p.uncategorized||(p.uncategorized=[]),p.uncategorized.push(k))}),p}),pe=Me(()=>e(g)||e(M));function me(p){d(g,p,!0)}function N(p){return p.tagValue("image")}function W(p){const k=p.tags.find(E=>E[0]==="price");return!k||!k[1]||!k[2]?null:{amount:k[1],currency:k[2]}}Ur(()=>(Lr.header=Ye,()=>{Lr.clear()}));var A=Yt(),v=a(A),B=a(v);{var re=p=>{var k=zt(),E=a(k);{var I=C=>{var b=St(),J=a(b),te=a(J,!0);t(J);var u=o(J,2),m=a(u);t(u),t(b),h($=>{D(te,$),D(m,`${e(z).length??""} listings found`)},[()=>S.find($=>$.value===e(g))?.label||e(g)]),l(C,b)};F(E,C=>{e(g)&&C(I)})}var Y=o(E,2);le(Y,21,()=>e(z),C=>C.id,(C,b)=>{const J=Me(()=>W(e(b)));var te=Ut();te.__click=()=>cr(`/marketplace/${e(b).encode()}`);var u=a(te);{var m=P=>{var x=Bt(),q=a(x);t(x),h((de,oe)=>{xe(q,"src",de),xe(q,"alt",oe)},[()=>N(e(b)),()=>e(b).tagValue("title")||"Listing"]),l(P,x)};F(u,P=>{N(e(b))&&P(m)})}var $=o(u,2),V=a($),j=a(V,!0);t(V);var f=o(V,2);{var ne=P=>{var x=Et(),q=a(x,!0);t(x),h(de=>D(q,de),[()=>e(b).tagValue("summary")]),l(P,x)};F(f,P=>{e(b).tagValue("summary")&&P(ne)})}var Z=o(f,2);{var ge=P=>{var x=Vt(),q=a(x);t(x),h(()=>D(q,`${e(J).amount??""} ${e(J).currency??""}`)),l(P,x)};F(Z,P=>{e(J)&&P(ge)})}t($),t(te),h(P=>D(j,P),[()=>e(b).tagValue("title")||"Untitled"]),l(C,te)},C=>{var b=Ft();l(C,b)}),t(Y),t(k),l(p,k)},Le=p=>{var k=Xt(),E=a(k);{var I=C=>{var b=At();l(C,b)},Y=C=>{var b=Jt(),J=he(b);{var te=m=>{var $=qt(),V=o(a($),2);le(V,21,()=>e(z).slice(0,8),j=>j.id,(j,f)=>{const ne=Me(()=>W(e(f)));var Z=Tt();Z.__click=()=>cr(`/marketplace/${e(f).encode()}`);var ge=a(Z);{var P=L=>{var U=Ot(),ue=a(U);t(U),h((se,$e)=>{xe(ue,"src",se),xe(ue,"alt",$e)},[()=>N(e(f)),()=>e(f).tagValue("title")||"Listing"]),l(L,U)};F(ge,L=>{N(e(f))&&L(P)})}var x=o(ge,2),q=a(x),de=a(q,!0);t(q);var oe=o(q,2);{var ye=L=>{var U=Ht(),ue=a(U,!0);t(U),h(se=>D(ue,se),[()=>e(f).tagValue("summary")]),l(L,U)};F(oe,L=>{e(f).tagValue("summary")&&L(ye)})}var ve=o(oe,2);{var ae=L=>{var U=Rt(),ue=a(U);t(U),h(()=>D(ue,`${e(ne).amount??""} ${e(ne).currency??""}`)),l(L,U)};F(ve,L=>{e(ne)&&L(ae)})}t(x),t(Z),h(L=>D(de,L),[()=>e(f).tagValue("title")||"Untitled"]),l(j,Z)}),t(V),t($),l(m,$)};F(J,m=>{e(z).length>0&&m(te)})}var u=o(J,2);le(u,17,()=>S.filter(m=>m.value&&e(ie)[m.value]?.length>0),be,(m,$)=>{var V=Qt(),j=a(V),f=a(j),ne=a(f,!0);t(f);var Z=o(f,2);Z.__click=()=>me(e($).value),t(j);var ge=o(j,2);le(ge,21,()=>e(ie)[e($).value].slice(0,4),P=>P.id,(P,x)=>{const q=Me(()=>W(e(x)));var de=Kt();de.__click=()=>cr(`/marketplace/${e(x).encode()}`);var oe=a(de);{var ye=G=>{var O=Nt(),ce=a(O);t(O),h((Ie,je)=>{xe(ce,"src",Ie),xe(ce,"alt",je)},[()=>N(e(x)),()=>e(x).tagValue("title")||"Listing"]),l(G,O)};F(oe,G=>{N(e(x))&&G(ye)})}var ve=o(oe,2),ae=a(ve),L=a(ae,!0);t(ae);var U=o(ae,2);{var ue=G=>{var O=Wt(),ce=a(O,!0);t(O),h(Ie=>D(ce,Ie),[()=>e(x).tagValue("summary")]),l(G,O)};F(U,G=>{e(x).tagValue("summary")&&G(ue)})}var se=o(U,2);{var $e=G=>{var O=Gt(),ce=a(O);t(O),h(()=>D(ce,`${e(q).amount??""} ${e(q).currency??""}`)),l(G,O)};F(se,G=>{e(q)&&G($e)})}t(ve),t(de),h(G=>D(L,G),[()=>e(x).tagValue("title")||"Untitled"]),l(P,de)}),t(ge),t(V),h(()=>D(ne,e($).label)),l(m,V)}),l(C,b)};F(E,C=>{Object.keys(e(ie)).length===0?C(I):C(Y,!1)})}t(k),l(p,k)};F(B,p=>{e(pe)?p(re):p(Le,!1)})}t(v);var De=o(v,2);Mt(De,{onClose:()=>{Q.restart?.()},get open(){return Cr.show},set open(p){Cr.show=p}}),t(A),l(Xe,A),Er()}Ir(["click"]);export{$o as component};
