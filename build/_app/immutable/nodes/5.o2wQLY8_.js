import"../chunks/DsnmJJEf.js";import{d as Mt,p as nt,b as ce,K as jt,u as tt,s as f,aT as zt,i,j as a,k as o,r as t,e as r,h as it,f as w,g as e,a as J,t as U,l as C,c as fe,L as p,Q as ue,M as Te}from"../chunks/UP8uQ6W_.js";import{i as y}from"../chunks/_gFmmxLT.js";import{e as qe,i as Nt}from"../chunks/DA17f6bB.js";import{n as $e,s as Qe,k as _t,f as Rt,h as St,e as bt}from"../chunks/CnpwhG0Y.js";import{h as pt}from"../chunks/DbKP1xbZ.js";import{c as gt,N as Dt}from"../chunks/CmRsxUvT.js";import{c as yt,b as wt,a as ht,r as ot,h as kt}from"../chunks/BUa9uPHk.js";import{A as xt}from"../chunks/BoWL87Fx.js";import{g as $t}from"../chunks/7RLc7DUv.js";import{f as Tt}from"../chunks/KSN4Ur19.js";import{c as ke}from"../chunks/BjHSVvfl.js";import{a as It}from"../chunks/BKitiiqs.js";import{c as At}from"../chunks/B1i_fleE.js";import{p as Bt}from"../chunks/B36lUvow.js";import{u as at}from"../chunks/BUklZbww.js";import{c as Pt}from"../chunks/a7XEC-kH.js";import{g as Lt,a as Et,b as Ut,e as Ot}from"../chunks/BSM2-0iS.js";import{M as Vt,b as Wt,c as Yt,R as Gt,d as Ht,e as Kt,f as Ft}from"../chunks/5_jRFLjB.js";import{D as Jt,a as Qt}from"../chunks/8MhEYoCQ.js";import{D as qt}from"../chunks/BOdE5gG2.js";import{D as Xt,a as Zt}from"../chunks/DE0IEdZF.js";import{I as Ye,B as De}from"../chunks/BgcVqX2P.js";import{L as Ge}from"../chunks/DiRLJweC.js";import{T as Ct}from"../chunks/mZotqJh9.js";import{R as st}from"../chunks/DcUGv5_5.js";import{D as er}from"../chunks/jJGSuslB.js";import{P as tr}from"../chunks/BWfUfqc9.js";var rr=i('<p class="text-muted-foreground text-center py-8">No invites yet in this Agora</p>'),or=i('<p class="text-xs text-muted-foreground truncate"> </p>'),ar=i('<a class="relative bg-gradient-to-b from-primary/5 to-transparent border border-border rounded-xl p-6 hover:border-primary/50 transition-all hover:shadow-lg group"><div class="absolute -top-3 left-1/2 -translate-x-1/2"><div class="w-12 h-12 rounded-full bg-card border-2 border-border flex items-center justify-center text-2xl group-hover:border-primary transition-colors"> </div></div> <div class="flex justify-center mt-6 mb-4"><!></div> <div class="text-center mb-4"><h3 class="font-bold text-lg text-foreground truncate mb-1"> </h3> <!></div> <div class="bg-muted/50 rounded-lg p-3"><div class="text-center"><div class="text-3xl font-bold text-primary mb-1"> </div> <div class="text-xs text-muted-foreground"> </div></div></div> <div class="mt-3"><div class="h-1.5 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),sr=i('<button class="w-full flex items-center justify-center gap-2 py-3 text-sm font-medium text-primary hover:text-primary/80 transition-colors"><span> </span> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>'),nr=i('<a class="flex items-center gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors"><div class="flex items-center gap-3 flex-1"><span class="text-lg font-semibold text-muted-foreground w-8"> </span> <!> <div class="flex-1 min-w-0"><div class="font-medium text-foreground truncate"> </div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="hidden md:block w-32"><div class="h-2 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),ir=i('<div class="mt-4 space-y-2 border-t border-border pt-4"></div>'),lr=i('<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6"></div> <!> <!>',1),dr=i('<div><h2 class="text-xl font-bold text-foreground mb-6">üèÜ Top Inviters</h2> <!></div>');function vr(Be,k){nt(k,!0);let E=ce(!1);function O(s){return s===1?"ü•á":s===2?"ü•à":s===3?"ü•â":""}const Q=J(()=>k.stats.slice(0,3)),V=J(()=>k.stats.slice(3,10)),M=J(()=>Math.max(...k.stats.map(s=>s.successfulInvites),1));let j=ce(jt(new Map)),re=ce(0);tt(()=>{console.log("[TopInvitersPodium] $effect running, stats count:",k.stats.length);const s=new Map;let c=0;const h=k.stats.length;if(h===0){f(j,s,!0);return}k.stats.forEach(_=>{$e.fetchUser(_.pubkey).then(x=>{x?.fetchProfile().then(X=>{console.log("[TopInvitersPodium] Setting profile for",_.pubkey),s.set(_.pubkey,X||null),c++,c===h&&(f(j,s,!0),zt(re))})})})});var oe=dr(),ae=a(o(oe),2);{var me=s=>{var c=rr();r(s,c)},ze=s=>{var c=lr(),h=w(c);qe(h,21,()=>e(Q),I=>I.pubkey,(I,A)=>{const S=J(()=>e(j).get(e(A).pubkey));var Y=ar(),pe=o(Y),Ie=o(pe),z=o(Ie,!0);t(Ie),t(pe);var D=a(pe,2),u=o(D);xt(u,{get ndk(){return $e},get pubkey(){return e(A).pubkey},class:"w-24 h-24 rounded-full ring-4 ring-primary/20"}),t(D);var $=a(D,2),ge=o($),ye=o(ge,!0);t(ge);var Le=a(ge,2);{var N=Ae=>{var Ee=or(),Ke=o(Ee,!0);t(Ee),U(()=>C(Ke,e(S).nip05)),r(Ae,Ee)};y(Le,Ae=>{e(S)?.nip05&&Ae(N)})}t($);var Ne=a($,2),_e=o(Ne),we=o(_e),Re=o(we,!0);t(we);var se=a(we,2),Se=o(se,!0);t(se),t(_e),t(Ne);var rt=a(Ne,2),We=o(rt),He=o(We);t(We),t(rt),t(Y),U((Ae,Ee,Ke)=>{yt(Y,"href",Ae),C(z,Ee),C(ye,e(S)?.displayName||e(S)?.name||"Anonymous"),C(Re,e(A).successfulInvites),C(Se,e(A).successfulInvites===1?"person joined":"people joined"),wt(He,`width: ${Ke??""}%`)},[()=>$t(e(A).pubkey),()=>O(e(A).rank),()=>Math.min(100,e(A).successfulInvites/e(M)*100)]),r(I,Y)}),t(h);var _=a(h,2);{var x=I=>{var A=sr();A.__click=()=>f(E,!e(E));var S=o(A),Y=o(S,!0);t(S);var pe=a(S,2);t(A),U(()=>{C(Y,e(E)?"Show Less":`View Top ${k.stats.length} Inviters`),ht(pe,0,`w-4 h-4 transition-transform duration-200 ${e(E)?"rotate-180":""}`)}),r(I,A)};y(_,I=>{k.stats.length>3&&I(x)})}var X=a(_,2);{var W=I=>{var A=ir();qe(A,21,()=>e(V),S=>S.pubkey,(S,Y)=>{const pe=J(()=>e(j).get(e(Y).pubkey));var Ie=nr(),z=o(Ie),D=o(z),u=o(D);t(D);var $=a(D,2);xt($,{get ndk(){return $e},get pubkey(){return e(Y).pubkey},class:"w-10 h-10 rounded-full"});var ge=a($,2),ye=o(ge),Le=o(ye,!0);t(ye);var N=a(ye,2),Ne=o(N);t(N),t(ge),t(z);var _e=a(z,2),we=o(_e),Re=o(we);t(we),t(_e),t(Ie),U((se,Se)=>{yt(Ie,"href",se),C(u,`${e(Y).rank??""}.`),C(Le,e(pe)?.displayName||e(pe)?.name||"Anonymous"),C(Ne,`${e(Y).successfulInvites??""} ${e(Y).successfulInvites===1?"person joined":"people joined"}`),wt(Re,`width: ${Se??""}%`)},[()=>$t(e(Y).pubkey),()=>Math.min(100,e(Y).successfulInvites/e(M)*100)]),r(S,Ie)}),t(A),r(I,A)};y(X,I=>{e(E)&&e(V).length>0&&I(W)})}r(s,c)};y(ae,s=>{k.stats.length===0?s(me):s(ze,!1)})}t(oe),r(Be,oe),it()}Mt(["click"]);var cr=i('<div class="text-muted-foreground">Invited by <span class="font-medium text-primary"> </span></div>'),ur=i("<div></div>"),fr=i('<div class="border border-border rounded-lg p-4 hover:border-primary/50 transition-colors"><div class="flex items-center gap-3 mb-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-lg">üëã</span> <span class="font-semibold text-foreground"> </span></div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="mb-3 text-foreground whitespace-pre-wrap line-clamp-4"> </div> <div class="flex items-center justify-between text-sm"><!></div></div>');function mr(Be,k){nt(k,!0);let E=ce(null),O=ce(null);tt(()=>{console.log("[IntroductionCard] $effect running for author:",k.event.pubkey),k.event.author.fetchProfile().then(W=>{f(E,W,!0)})}),tt(()=>{if(console.log("[IntroductionCard] $effect running for invitedBy:",k.invitedBy),!k.invitedBy){f(O,null);return}$e.fetchUser(k.invitedBy).then(W=>{W?.fetchProfile().then(I=>{f(O,I,!0)})})});var Q=fr(),V=o(Q),M=o(V);xt(M,{get ndk(){return $e},get pubkey(){return k.event.pubkey},class:"w-12 h-12 rounded-full"});var j=a(M,2),re=o(j),oe=a(o(re),2),ae=o(oe,!0);t(oe),t(re);var me=a(re,2),ze=o(me,!0);t(me),t(j),t(V);var s=a(V,2),c=o(s,!0);t(s);var h=a(s,2),_=o(h);{var x=W=>{var I=cr(),A=a(o(I)),S=o(A);t(A),t(I),U(()=>C(S,`@${(e(O).name||"anonymous")??""}`)),r(W,I)},X=W=>{var I=ur();r(W,I)};y(_,W=>{e(O)?W(x):W(X,!1)})}t(h),t(Q),U(W=>{C(ae,e(E)?.displayName||e(E)?.name||"Anonymous"),C(ze,W),C(c,k.event.content)},[()=>Tt(k.event.created_at||0)]),r(Be,Q),it()}var pr=i("<!> <!>",1),gr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),_r=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),hr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),xr=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),br=i('<div class="text-xs text-muted-foreground truncate"> </div>'),yr=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),wr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),kr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),$r=Te(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Ir=Te('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Ar=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Pr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Cr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Mr=Te('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),jr=Te('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),zr=Te('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),Nr=i("<!> <!>",1),Rr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),Sr=i('<!> <div class="space-y-6"><!></div>',1),Dr=i("<!> <!>",1),Tr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),Br=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Lr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Er=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),Ur=i('<div class="text-xs text-muted-foreground truncate"> </div>'),Or=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),Vr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),Wr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),Yr=Te(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Gr=Te('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Hr=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Kr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Fr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Jr=Te('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),Qr=Te('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),qr=Te('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),Xr=i('<div class="flex gap-3 w-full"><!> <!></div>'),Zr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),eo=i('<!> <div class="space-y-6 px-4 overflow-y-auto pb-4"><!></div>',1);function to(Be,k){nt(k,!0);const E=new Vt("(min-width: 768px)");let O=Bt(k,"isOpen",15);const Q=`Welcome to Agora! üéâ

I'm inviting you to join Agora, a new kind of social network where you own your identity and content. No algorithms, no ads, just authentic connections.

Looking forward to connecting with you on the open social web!`;let V=ce(Q),M=ce(!1),j=ce(""),re=ce(""),oe=ce(10),ae=ce(""),me=ce(!1),ze=ce(!1),s=ce(jt([])),c=ce(!1);const h=J(()=>Qe.relays.filter(u=>u.enabled&&u.write&&_t(u.url)));tt(()=>{O()&&Qe.selectedRelay&&e(s).length===0&&_t(Qe.selectedRelay)&&e(h).some($=>$.url===Qe.selectedRelay)&&f(s,[Qe.selectedRelay],!0)});function _(u){e(s).includes(u)?f(s,e(s).filter($=>$!==u),!0):f(s,[...e(s),u],!0)}const x=J(()=>e(s).length===0?null:e(s).length===1?{url:e(s)[0],info:at(e(s)[0])}:null),X=J(()=>e(s).length===0?"Select Agora...":e(s).length===1?at(e(s)[0]).info?.name||e(s)[0].replace("wss://","").replace("ws://",""):`${e(s).length} Agoras selected`);async function W(){if(!$e.$currentUser){console.error("No user logged in");return}if(e(s).length===0){alert("Please select at least one Agora to publish the invite to.");return}f(me,!0);try{const u=Lt(),$=e(M)?Et():"",ge=[];for(let se=0;se<e(oe);se++)ge.push(Ut());const ye={welcomeMessage:e(V),recipientName:e(M)?e(j):void 0,cashuToken:e(M)&&e(re)?`cashu:${e(re)}`:void 0,createdAt:Date.now(),inviter:$e.$currentUser.pubkey},Le=e(M)?await Ot(JSON.stringify(ye),$):JSON.stringify(ye),N=new Rt($e);N.kind=513,N.content=Le,N.tags=[["d",u],...ge.map(se=>["code",se])],N.isProtected=!0,await N.sign(),N.isProtected=!0,console.log("Publishing invite event to selected Agoras...",N.id,e(s));const Ne=new Set;for(const se of e(s)){const Se=$e.pool.getRelay(se,!0);Se&&Ne.add(Se)}const _e=new St(Ne,$e);await N.publish(_e);const we=e(M)?`${u}${$}`:u,Re=`${window.location.origin}/i/${we}`;f(ae,Re),console.log("Invite created:",Re)}catch(u){console.error("Failed to generate invite:",u),alert("Failed to generate invite. Check console for details.")}finally{f(me,!1)}}async function I(){try{await navigator.clipboard.writeText(e(ae)),f(ze,!0),setTimeout(()=>f(ze,!1),2e3)}catch(u){console.error("Failed to copy:",u)}}async function A(){if(!navigator.share){console.log("Web Share API not supported, falling back to copy"),await I();return}try{await navigator.share({title:"Join Agora",text:e(M)&&e(j)?`${e(j)}, you're invited to join Agora!`:"You're invited to join Agora, a new kind of social network!",url:e(ae)})}catch(u){u.name!=="AbortError"&&console.error("Failed to share:",u)}}function S(){f(V,Q),f(M,!1),f(j,""),f(re,""),f(oe,10),f(ae,""),f(s,[],!0),f(c,!1),k.onClose()}function Y(){f(c,!1)}var pe=fe(),Ie=w(pe);{var z=u=>{var $=fe(),ge=w($);ke(ge,()=>Gt,(ye,Le)=>{Le(ye,{get open(){return O()},onOpenChange:N=>{O(N),N||S()},children:(N,Ne)=>{var _e=fe(),we=w(_e);ke(we,()=>Wt,(Re,se)=>{se(Re,{class:"max-w-lg max-h-[90vh] overflow-y-auto",children:(Se,rt)=>{var We=Sr(),He=w(We);ke(He,()=>Xt,(Z,ee)=>{ee(Z,{children:(G,he)=>{var xe=pr(),T=w(xe);ke(T,()=>Yt,(H,ne)=>{ne(H,{children:(ie,Pe)=>{p();var P=ue("Create an Invite");r(ie,P)},$$slots:{default:!0}})});var B=a(T,2);ke(B,()=>Jt,(H,ne)=>{ne(H,{children:(ie,Pe)=>{p();var P=ue("Invite someone to join Agora with a personal message");r(ie,P)},$$slots:{default:!0}})}),r(G,xe)},$$slots:{default:!0}})});var Ae=a(He,2),Ee=o(Ae);{var Ke=Z=>{var ee=Cr(),G=w(ee),he=o(G);Ge(he,{for:"welcome-message",children:(n,l)=>{p();var b=ue("Welcome Message");r(n,b)},$$slots:{default:!0}});var xe=a(he,2);Ct(xe,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(V)},set value(n){f(V,n,!0)}}),t(G);var T=a(G,2),B=a(o(T),2);B.__click=()=>f(c,!e(c));var H=o(B);{var ne=n=>{var l=gr();p(2),r(n,l)},ie=n=>{var l=fe(),b=w(l);{var K=d=>{var m=_r(),g=w(m);st(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),F=o(v,!0);t(v),U(()=>C(F,e(X))),r(d,m)},de=d=>{var m=hr(),g=a(w(m),2),v=o(g);t(g),U(()=>C(v,`${e(s).length??""} Agoras selected`)),r(d,m)};y(b,d=>{e(s).length===1&&e(x)?d(K):d(de,!1)},!0)}r(n,l)};y(H,n=>{e(s).length===0?n(ne):n(ie,!1)})}var Pe=a(H,2);t(B);var P=a(B,2);{var Ce=n=>{var l=wr(),b=o(l);{var K=d=>{var m=xr();r(d,m)},de=d=>{var m=fe(),g=w(m);qe(g,17,()=>e(h),v=>v.url,(v,F)=>{const ve=J(()=>at(e(F).url));var Ve=yr();Ve.__click=()=>{_(e(F).url)};var Fe=o(Ve);ot(Fe);var Xe=a(Fe,2);st(Xe,{get relayUrl(){return e(F).url},size:"md"});var Ze=a(Xe,2),Je=o(Ze),et=o(Je),ct=o(et,!0);t(et),p(2),t(Je);var ut=a(Je,2);{var ft=Me=>{var je=br(),mt=o(je,!0);t(je),U(()=>C(mt,e(ve).info.description)),r(Me,je)};y(ut,Me=>{e(ve).info?.description&&Me(ft)})}t(Ze),t(Ve),U((Me,je)=>{kt(Fe,Me),C(ct,je)},[()=>e(s).includes(e(F).url),()=>e(ve).info?.name||e(F).url.replace("wss://","").replace("ws://","")]),r(v,Ve)}),r(d,m)};y(b,d=>{e(h).length===0?d(K):d(de,!1)})}t(l),It(l,(d,m)=>Pt?.(d,m),()=>Y),r(n,l)};y(P,n=>{e(c)&&n(Ce)})}var te=a(P,2);{var Ue=n=>{var l=kr(),b=o(l);t(l),U(()=>C(b,`${e(s).length??""} Agoras selected`)),r(n,l)};y(te,n=>{e(s).length>1&&n(Ue)})}t(T);var q=a(T,2),le=o(q);Ge(le,{for:"max-uses",children:(n,l)=>{p();var b=ue("Maximum Uses");r(n,b)},$$slots:{default:!0}});var L=a(le,2);Ye(L,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(oe)},set value(n){f(oe,n,!0)}}),p(2),t(q);var R=a(q,2),Oe=o(R);ot(Oe),p(2),t(R);var be=a(R,2);{var dt=n=>{var l=Ar(),b=o(l),K=o(b);Ge(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,F)=>{var ve=$r();p(),r(v,ve)},$$slots:{default:!0}});var de=a(K,2);Ye(de,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(j)},set value(v){f(j,v,!0)}}),t(b);var d=a(b,2),m=o(d);Ge(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,F)=>{var ve=Ir();p(),r(v,ve)},$$slots:{default:!0}});var g=a(m,2);Ye(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(re)},set value(v){f(re,v,!0)}}),p(2),t(d),t(l),r(n,l)};y(be,n=>{e(M)&&n(dt)})}var vt=a(be,2);{let n=J(()=>e(me)||!e(V).trim()||e(s).length===0);De(vt,{onclick:W,get disabled(){return e(n)},class:"w-full",children:(l,b)=>{var K=fe(),de=w(K);{var d=g=>{var v=Pr();p(),r(g,v)},m=g=>{var v=ue("Generate Invite Link");r(g,v)};y(de,g=>{e(me)?g(d):g(m,!1)})}r(l,K)},$$slots:{default:!0}})}U(()=>ht(Pe,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(c)?"rotate-180":""}`)),At(Oe,()=>e(M),n=>f(M,n)),r(Z,ee)},lt=Z=>{var ee=Rr(),G=o(ee),he=a(o(G),4),xe=o(he,!0);t(he),t(G);var T=a(G,2),B=o(T),H=o(B);Ye(H,{type:"text",get value(){return e(ae)},readonly:!0,class:"flex-1 bg-transparent"});var ne=a(H,2);De(ne,{onclick:I,size:"sm",children:(P,Ce)=>{var te=fe(),Ue=w(te);{var q=L=>{var R=Mr();p(),r(L,R)},le=L=>{var R=jr();p(),r(L,R)};y(Ue,L=>{e(ze)?L(q):L(le,!1)})}r(P,te)},$$slots:{default:!0}}),t(B);var ie=a(B,2);De(ie,{onclick:A,variant:"outline",class:"w-full",children:(P,Ce)=>{var te=zr();p(),r(P,te)},$$slots:{default:!0}}),t(T);var Pe=a(T,2);ke(Pe,()=>er,(P,Ce)=>{Ce(P,{class:"flex gap-3 sm:space-x-0",children:(te,Ue)=>{var q=Nr(),le=w(q);De(le,{variant:"outline",onclick:()=>f(ae,""),class:"flex-1",children:(R,Oe)=>{p();var be=ue("Create Another");r(R,be)},$$slots:{default:!0}});var L=a(le,2);De(L,{onclick:S,class:"flex-1",children:(R,Oe)=>{p();var be=ue("Done");r(R,be)},$$slots:{default:!0}}),r(te,q)},$$slots:{default:!0}})}),t(ee),U(()=>C(xe,e(M)&&e(j)?`Your personalized invite for ${e(j)} is ready`:"Your invite link is ready to share")),r(Z,ee)};y(Ee,Z=>{e(ae)?Z(lt,!1):Z(Ke)})}t(Ae),r(Se,We)},$$slots:{default:!0}})}),r(N,_e)},$$slots:{default:!0}})}),r(u,$)},D=u=>{var $=fe(),ge=w($);ke(ge,()=>Ft,(ye,Le)=>{Le(ye,{get open(){return O()},onOpenChange:N=>{O(N),N||S()},children:(N,Ne)=>{var _e=fe(),we=w(_e);ke(we,()=>Ht,(Re,se)=>{se(Re,{children:(Se,rt)=>{var We=eo(),He=w(We);ke(He,()=>Zt,(Z,ee)=>{ee(Z,{class:"text-left",children:(G,he)=>{var xe=Dr(),T=w(xe);ke(T,()=>Kt,(H,ne)=>{ne(H,{children:(ie,Pe)=>{p();var P=ue("Create an Invite");r(ie,P)},$$slots:{default:!0}})});var B=a(T,2);ke(B,()=>Qt,(H,ne)=>{ne(H,{children:(ie,Pe)=>{p();var P=ue("Invite someone to join Agora with a personal message");r(ie,P)},$$slots:{default:!0}})}),r(G,xe)},$$slots:{default:!0}})});var Ae=a(He,2),Ee=o(Ae);{var Ke=Z=>{var ee=Fr(),G=w(ee),he=o(G);Ge(he,{for:"welcome-message",children:(n,l)=>{p();var b=ue("Welcome Message");r(n,b)},$$slots:{default:!0}});var xe=a(he,2);Ct(xe,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(V)},set value(n){f(V,n,!0)}}),t(G);var T=a(G,2),B=a(o(T),2);B.__click=()=>f(c,!e(c));var H=o(B);{var ne=n=>{var l=Tr();p(2),r(n,l)},ie=n=>{var l=fe(),b=w(l);{var K=d=>{var m=Br(),g=w(m);st(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),F=o(v,!0);t(v),U(()=>C(F,e(X))),r(d,m)},de=d=>{var m=Lr(),g=a(w(m),2),v=o(g);t(g),U(()=>C(v,`${e(s).length??""} Agoras selected`)),r(d,m)};y(b,d=>{e(s).length===1&&e(x)?d(K):d(de,!1)},!0)}r(n,l)};y(H,n=>{e(s).length===0?n(ne):n(ie,!1)})}var Pe=a(H,2);t(B);var P=a(B,2);{var Ce=n=>{var l=Vr(),b=o(l);{var K=d=>{var m=Er();r(d,m)},de=d=>{var m=fe(),g=w(m);qe(g,17,()=>e(h),v=>v.url,(v,F)=>{const ve=J(()=>at(e(F).url));var Ve=Or();Ve.__click=()=>{_(e(F).url)};var Fe=o(Ve);ot(Fe);var Xe=a(Fe,2);st(Xe,{get relayUrl(){return e(F).url},size:"md"});var Ze=a(Xe,2),Je=o(Ze),et=o(Je),ct=o(et,!0);t(et),p(2),t(Je);var ut=a(Je,2);{var ft=Me=>{var je=Ur(),mt=o(je,!0);t(je),U(()=>C(mt,e(ve).info.description)),r(Me,je)};y(ut,Me=>{e(ve).info?.description&&Me(ft)})}t(Ze),t(Ve),U((Me,je)=>{kt(Fe,Me),C(ct,je)},[()=>e(s).includes(e(F).url),()=>e(ve).info?.name||e(F).url.replace("wss://","").replace("ws://","")]),r(v,Ve)}),r(d,m)};y(b,d=>{e(h).length===0?d(K):d(de,!1)})}t(l),It(l,(d,m)=>Pt?.(d,m),()=>Y),r(n,l)};y(P,n=>{e(c)&&n(Ce)})}var te=a(P,2);{var Ue=n=>{var l=Wr(),b=o(l);t(l),U(()=>C(b,`${e(s).length??""} Agoras selected`)),r(n,l)};y(te,n=>{e(s).length>1&&n(Ue)})}t(T);var q=a(T,2),le=o(q);Ge(le,{for:"max-uses",children:(n,l)=>{p();var b=ue("Maximum Uses");r(n,b)},$$slots:{default:!0}});var L=a(le,2);Ye(L,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(oe)},set value(n){f(oe,n,!0)}}),p(2),t(q);var R=a(q,2),Oe=o(R);ot(Oe),p(2),t(R);var be=a(R,2);{var dt=n=>{var l=Hr(),b=o(l),K=o(b);Ge(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,F)=>{var ve=Yr();p(),r(v,ve)},$$slots:{default:!0}});var de=a(K,2);Ye(de,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(j)},set value(v){f(j,v,!0)}}),t(b);var d=a(b,2),m=o(d);Ge(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,F)=>{var ve=Gr();p(),r(v,ve)},$$slots:{default:!0}});var g=a(m,2);Ye(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(re)},set value(v){f(re,v,!0)}}),p(2),t(d),t(l),r(n,l)};y(be,n=>{e(M)&&n(dt)})}var vt=a(be,2);{let n=J(()=>e(me)||!e(V).trim()||e(s).length===0);De(vt,{onclick:W,get disabled(){return e(n)},class:"w-full",children:(l,b)=>{var K=fe(),de=w(K);{var d=g=>{var v=Kr();p(),r(g,v)},m=g=>{var v=ue("Generate Invite Link");r(g,v)};y(de,g=>{e(me)?g(d):g(m,!1)})}r(l,K)},$$slots:{default:!0}})}U(()=>ht(Pe,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(c)?"rotate-180":""}`)),At(Oe,()=>e(M),n=>f(M,n)),r(Z,ee)},lt=Z=>{var ee=Zr(),G=o(ee),he=a(o(G),4),xe=o(he,!0);t(he),t(G);var T=a(G,2),B=o(T),H=o(B);Ye(H,{type:"text",get value(){return e(ae)},readonly:!0,class:"flex-1 bg-transparent"});var ne=a(H,2);De(ne,{onclick:I,size:"sm",children:(P,Ce)=>{var te=fe(),Ue=w(te);{var q=L=>{var R=Jr();p(),r(L,R)},le=L=>{var R=Qr();p(),r(L,R)};y(Ue,L=>{e(ze)?L(q):L(le,!1)})}r(P,te)},$$slots:{default:!0}}),t(B);var ie=a(B,2);De(ie,{onclick:A,variant:"outline",class:"w-full",children:(P,Ce)=>{var te=qr();p(),r(P,te)},$$slots:{default:!0}}),t(T);var Pe=a(T,2);ke(Pe,()=>qt,(P,Ce)=>{Ce(P,{class:"pt-2",children:(te,Ue)=>{var q=Xr(),le=o(q);De(le,{variant:"outline",onclick:()=>f(ae,""),class:"flex-1",children:(R,Oe)=>{p();var be=ue("Create Another");r(R,be)},$$slots:{default:!0}});var L=a(le,2);De(L,{onclick:S,class:"flex-1",children:(R,Oe)=>{p();var be=ue("Done");r(R,be)},$$slots:{default:!0}}),t(q),r(te,q)},$$slots:{default:!0}})}),t(ee),U(()=>C(xe,e(M)&&e(j)?`Your personalized invite for ${e(j)} is ready`:"Your invite link is ready to share")),r(Z,ee)};y(Ee,Z=>{e(ae)?Z(lt,!1):Z(Ke)})}t(Ae),r(Se,We)},$$slots:{default:!0}})}),r(N,_e)},$$slots:{default:!0}})}),r(u,$)};y(Ie,u=>{E.current?u(z):u(D,!1)})}r(Be,pe),it()}Mt(["click"]);const ro=Be=>{tr(Be,{title:"üèÜ Agora Invites",subtitle:"Community growth and new members"})};var oo=i('<div class="min-h-screen flex items-center justify-center p-4"><div class="text-center"><svg class="w-16 h-16 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <h2 class="text-xl font-semibold text-foreground mb-2">Select an Agora</h2> <p class="text-muted-foreground">This page shows community invites for a specific Agora</p></div></div>'),ao=i('<p class="text-muted-foreground text-center py-8">No new members yet</p>'),so=i('<div class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>'),no=i('<p class="text-muted-foreground text-center py-8">No introductions yet</p>'),io=i('<div class="space-y-4"></div>'),lo=i('<div class="w-full lg:max-w-4xl mx-auto p-4 space-y-6"><!> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üëã New Members</h2> <!></div> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üí¨ Introductions</h2> <!></div></div> <!>',1);function Lo(Be,k){nt(k,!0);const E=J(()=>Qe.selectedRelay),O=J(()=>e(E)?_t(e(E)):!1),Q=J(()=>(console.log("[INVITES] redemptionsSubscription $derived.by running",{selectedRelay:e(E),isAgora:e(O)}),!e(E)||!e(O)?null:$e.$subscribe(()=>({filters:[{kinds:[514]}],relayUrls:[e(E)],subId:"invite-redemptions",cacheUsage:bt.ONLY_RELAY,closeOnEose:!0})))),V=J(()=>(console.log("[INVITES] introductionsSubscription $derived.by running",{selectedRelay:e(E),isAgora:e(O)}),!e(E)||!e(O)?null:$e.$subscribe(()=>({filters:[{kinds:[1],"#t":["introduction"],limit:20}],relayUrls:[e(E)],cacheUsage:bt.ONLY_RELAY,exclusiveRelay:!0,closeOnEose:!0})))),M=J(()=>{if(console.log("[INVITES] inviterStats $derived.by running",e(Q)?.events.length),!e(Q))return[];const s=e(Q).events,c=new Map;for(const _ of s){const x=_.tags.find(X=>X[0]==="p");if(x?.[1]){const X=x[1];c.set(X,(c.get(X)||0)+1)}}const h=Array.from(c.entries()).map(([_,x])=>({pubkey:_,totalInvites:x,successfulInvites:x,rank:0}));return h.sort((_,x)=>x.successfulInvites-_.successfulInvites),h.forEach((_,x)=>{_.rank=x+1}),h.slice(0,10)}),j=J(()=>{if(console.log("[INVITES] introductions $derived.by running",e(V)?.events.length,e(Q)?.events.length),!e(V)||!e(Q))return[];const s=e(V).events,c=e(Q).events,h=new Map;for(const _ of c){const x=_.tags.find(X=>X[0]==="p");x&&x[1]&&h.set(_.pubkey,x[1])}return s.map(_=>({event:_,invitedBy:h.get(_.pubkey)||null})).sort((_,x)=>(x.event.created_at||0)-(_.event.created_at||0)).slice(0,10)}),re=J(()=>(console.log("[INVITES] newMembers $derived.by running",e(Q)?.events.length),e(Q)?e(Q).events.map(c=>{const h=c.tags.find(_=>_[0]==="p");return{memberPubkey:c.pubkey,inviterPubkey:h?.[1]||null,joinedAt:c.created_at||0}}).sort((c,h)=>h.joinedAt-c.joinedAt).slice(0,20):[]));tt(()=>(e(O)?pt.header=ro:pt.clear(),()=>{pt.clear()}));var oe=fe(),ae=w(oe);{var me=s=>{var c=oo();r(s,c)},ze=s=>{var c=lo(),h=w(c),_=o(h);vr(_,{get stats(){return e(M)}});var x=a(_,2),X=a(o(x),2);{var W=z=>{var D=ao();r(z,D)},I=z=>{var D=so();qe(D,21,()=>e(re).slice(0,6),Nt,(u,$)=>{Dt(u,{get memberPubkey(){return e($).memberPubkey},get inviterPubkey(){return e($).inviterPubkey},get joinedAt(){return e($).joinedAt}})}),t(D),r(z,D)};y(X,z=>{e(re).length===0?z(W):z(I,!1)})}t(x);var A=a(x,2),S=a(o(A),2);{var Y=z=>{var D=no();r(z,D)},pe=z=>{var D=io();qe(D,21,()=>e(j),u=>u.event.id,(u,$)=>{mr(u,{get event(){return e($).event},get invitedBy(){return e($).invitedBy}})}),t(D),r(z,D)};y(S,z=>{e(j).length===0?z(Y):z(pe,!1)})}t(A),t(h);var Ie=a(h,2);to(Ie,{onClose:()=>gt.close(),get isOpen(){return gt.show},set isOpen(z){gt.show=z}}),r(s,c)};y(ae,s=>{e(O)?s(ze,!1):s(me)})}r(Be,oe),it()}export{Lo as component};
