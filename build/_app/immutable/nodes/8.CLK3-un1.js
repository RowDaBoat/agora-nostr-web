const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/QTLWRGLp.js","../chunks/PPVm8Dsz.js","../chunks/DpkVnRja.js","../chunks/FBAAKbhk.js"])))=>i.map(i=>d[i]);
import{d as Ae,c as ie,a as l,f as C,t as ce,i as Ee,s as ae}from"../chunks/DNmf0A2m.js";import{a as Q,aC as Ke,D as Ve,aB as Se,_ as Xe,g as e,aD as Ye,s as g,aE as Pe,x as xe,u as ze,p as Fe,f as N,c as Ue,y as A,d as c,e as p,r as f,b as ne,t as oe}from"../chunks/DpkVnRja.js";import{i as B}from"../chunks/Btb_Ey2R.js";import{e as ye,i as we}from"../chunks/DD8s4tVe.js";import{s as Ze,a as et}from"../chunks/DyCGT0HY.js";import{p as tt}from"../chunks/Uk33IviR.js";import{N as rt,n as Ne,c as Qe}from"../chunks/QTLWRGLp.js";import{S as We}from"../chunks/FBAAKbhk.js";import{r as st}from"../chunks/BYRURnlO.js";import{N as Le}from"../chunks/DiXitoXJ.js";import{H as Be}from"../chunks/BEgNpPxX.js";import{p as Je}from"../chunks/f_qAQkK6.js";import{_ as nt}from"../chunks/PPVm8Dsz.js";import{c as ee}from"../chunks/CSx53_lc.js";import{M as at,D as ot,a as it,R as lt,b as dt,c as ut,d as vt}from"../chunks/ExIc70cS.js";import{D as ct,a as ft}from"../chunks/B-DQEjp8.js";import{D as ht}from"../chunks/DuCXCqgL.js";import{D as pt,a as gt}from"../chunks/BJCNLf3C.js";import{I as qe,B as ge}from"../chunks/OHIcQ-QL.js";import{D as mt}from"../chunks/BGQ6BdS-.js";var _t=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],bt=["difference","intersection","symmetricDifference","union"],Ge=!1;class ke extends Set{#r=new Map;#e=Q(0);#t=Q(0);#s=Ke||-1;constructor(t){if(super(),Ve&&(t=new Set(t),Se(this.#e,"SvelteSet version"),Se(this.#t,"SvelteSet.size")),t){for(var a of t)super.add(a);this.#t.v=super.size}Ge||this.#a()}#n(t){return Ke===this.#s?Q(t):Xe(t)}#a(){Ge=!0;var t=ke.prototype,a=Set.prototype;for(const n of _t)t[n]=function(...r){return e(this.#e),a[n].apply(this,r)};for(const n of bt)t[n]=function(...r){e(this.#e);var i=a[n].apply(this,r);return new ke(i)}}has(t){var a=super.has(t),n=this.#r,r=n.get(t);if(r===void 0){if(!a)return e(this.#e),!1;r=this.#n(!0),Ve&&Se(r,`SvelteSet has(${Ye(t)})`),n.set(t,r)}return e(r),a}add(t){return super.has(t)||(super.add(t),g(this.#t,super.size),Pe(this.#e)),this}delete(t){var a=super.delete(t),n=this.#r,r=n.get(t);return r!==void 0&&(n.delete(t),g(r,!1)),a&&(g(this.#t,super.size),Pe(this.#e)),a}clear(){if(super.size!==0){super.clear();var t=this.#r;for(var a of t.values())g(a,!1);t.clear(),g(this.#t,0),Pe(this.#e)}}keys(){return this.values()}values(){return e(this.#e),super.values()}entries(){return e(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(this.#t)}}function je(h){if(!h)return null;const t=h.tags.find(r=>r[0]==="e"&&r[3]==="root");if(t)return t[1];if(h.tags.find(r=>r[0]==="e"&&r[3]==="reply"))return null;const n=h.tags.filter(r=>r[0]==="e");return n.length>0?n[0][1]:null}function Oe(h){if(!h)return null;const t=h.tags.find(r=>r[0]==="e"&&r[3]==="reply");if(t)return{id:t[1],relayHint:t[2]||void 0};const a=h.tags.find(r=>r[0]==="e"&&r[3]==="root");if(a&&a[1]!==h.id)return{id:a[1],relayHint:a[2]||void 0};const n=h.tags.filter(r=>r[0]==="e");if(n.length>0){const r=n[n.length-1];return{id:r[1],relayHint:r[2]||void 0}}return null}function xt(h,t,a=20){const n=[];let r=h,i=0;const s=new Set;for(;r&&i<a;){if(i++,s.has(r.id)){console.warn("Circular reference detected in thread",r.id);break}s.add(r.id);const d=Oe(r);if(d?.id)if(t.has(d.id)){const m=t.get(d.id);n.unshift({id:d.id,event:m,relayHint:d.relayHint}),r=m}else{n.unshift({id:d.id,event:null,relayHint:d.relayHint});break}else break}return i>=a&&console.warn(`Thread depth limit reached (${a})`),n}function yt(h,t,a,n=[]){const r=[];h&&h!==t&&r.push({ids:[h]},{kinds:a,"#e":[h]}),r.push({kinds:a,"#e":[t]});for(const i of n)i!==t&&i!==h&&r.push({kinds:a,"#e":[i]});return r.push({ids:[t]}),r}function wt(h,t,a=20){const n=[],r=h.pubkey,i=Array.from(t.values());let s=h,d=0;const m=new Set([h.id]);for(;d<a;){d++;const v=i.filter(b=>{if(m.has(b.id)||b.pubkey!==r)return!1;const F=b.tags.find(G=>G[0]==="e"&&G[3]==="reply");if(F)return F[1]===s.id;const Y=b.tags.filter(G=>G[0]==="e");return Y.length>0&&Y[Y.length-1][1]===s.id});if(v.sort((b,F)=>(b.created_at||0)-(F.created_at||0)),v.length===0)break;const k=v[0];m.add(k.id);const P=Oe(k);n.push({id:k.id,event:k,relayHint:P?.relayHint}),s=k}return n}function kt(h){return Array.from(h.keys())}function Et(h,t,a){const n=Oe(t),r={id:t.id,event:t,relayHint:n?.relayHint},i=[...h,r,...a];return i.map((s,d)=>{const m=d<i.length-1?i[d+1]:null,v=m?.event&&s.event?s.event.pubkey===m.event.pubkey:!1;return{...s,threading:{isSelfThread:v,showLineToNext:m!==null,depth:d,isMainChain:!0}}})}function $t(h,t,a){const n=[],r=[];for(const s of t){if(a.has(s.id))continue;const d=s.tags.find(v=>v[0]==="e"&&v[3]==="reply");let m=null;if(d)m=d[1];else{const v=s.tags.filter(k=>k[0]==="e");v.length>0&&(m=v[v.length-1][1])}m&&a.has(m)&&(m===h?n.push(s):r.push(s))}const i=(s,d)=>(s.created_at||0)-(d.created_at||0);return n.sort(i),r.sort(i),{replies:n,otherReplies:r}}function Tt(h,t){const a=st(t),{focusedEvent:n,maxDepth:r=20,kinds:i=[rt.Text,9802]}=h();let s=Q(xe([])),d=Q(xe([])),m=Q(xe([])),v=Q(null),k,P=new We,b=new We,F=new ke;ze(()=>{Y()});async function Y(){if(typeof n=="string"){const w=await a.fetchEvent(n);w&&(g(v,w,!0),G())}else g(v,n,!0),G()}function G(){if(!e(v)||k)return;const w=je(e(v)),_=yt(w,e(v).id,i);k=a.subscribe(_,{closeOnEose:!1,groupable:!1}),k.on("event",$=>{b.set($.id,$),te()}),te()}function te(){if(!e(v))return;const w=xt(e(v),b,r),_=wt(e(v),b,r),$=Et(w,e(v),_);g(s,$,!0);const O=new Set($.map(Z=>Z.id)),E=Array.from(b.values()),{replies:T,otherReplies:j}=$t(e(v).id,E,O);g(d,T,!0),g(m,j,!0),x(),o()}function x(){const w=e(s).filter(_=>!_.event);for(const _ of w){if(P.has(_.id))continue;const $=[{ids:[_.id]}];_.relayHint&&_.relayHint;const O=a.subscribe($,{closeOnEose:!0,groupable:!1});O.on("event",E=>{E.id===_.id&&(b.set(E.id,E),te(),O.stop(),P.delete(_.id))}),P.set(_.id,O)}}function o(){const _=kt(b).filter(E=>!F.has(E));if(_.length===0)return;_.forEach(E=>F.add(E));const $=_.map(E=>({kinds:i,"#e":[E]}));if($.length===0)return;const O=a.subscribe($,{closeOnEose:!0,groupable:!1});O.on("event",E=>{b.has(E.id)||b.set(E.id,E)}),O.on("eose",()=>{te(),O.stop()})}async function I(w){let _=null;if(typeof w=="string"){if(_=b.get(w)||null,!_){const T=await a.fetchEvent(w);T&&(_=T,b.set(T.id,T))}}else _=w,b.has(w.id)||b.set(w.id,w);if(!_)return;const $=e(v)?je(e(v)):null,O=je(_);$===O?(g(v,_,!0),te()):(U(),b.clear(),F.clear(),g(s,[],!0),g(d,[],!0),g(m,[],!0),g(v,_,!0),b.set(_.id,_),G())}function U(){k?.stop(),k=void 0;for(const w of P.values())w.stop();P.clear()}return ze(()=>()=>{U()}),{get events(){return e(s)},get replies(){return e(d)},get otherReplies(){return e(m)},get allReplies(){return[...e(d),...e(m)]},get focusedEventId(){return e(v)?.id??null},focusOn:I}}var Rt=C("<!> <!>",1),Mt=C('<div class="flex items-center justify-between p-2 bg-muted/30 rounded border border-border text-sm"><span class="font-mono text-xs truncate flex-1 mr-2"> </span> <button type="button" class="text-muted-foreground hover:text-destructive transition-colors p-1" aria-label="Remove relay"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),It=C('<div class="space-y-2"><div class="text-sm font-medium text-foreground"> </div> <div class="max-h-40 overflow-y-auto space-y-1"></div></div>'),Dt=C('<div class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),Ct=C('<div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 dark:text-green-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Event found! Loading...</span></div>'),Ht=Ee('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Searching...',1),St=Ee('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Search for Event',1),Pt=C("<!> <!>",1),Lt=C('<!> <div class="space-y-4"><div class="p-3 bg-muted/50 rounded-lg border border-border"><div class="text-xs text-muted-foreground mb-1 font-medium">Event ID (nevent)</div> <div class="font-mono text-xs break-all text-foreground"> </div></div> <div class="space-y-2"><label class="text-sm font-medium text-foreground">Add Relay URL</label> <div class="flex gap-2"><!> <!></div> <p class="text-xs text-muted-foreground">Enter relay URLs where this event might be stored (e.g., wss://relay.damus.io)</p></div> <!> <!> <!></div> <!>',1),Bt=C("<!> <!>",1),jt=C('<div class="flex items-center justify-between p-2 bg-muted/30 rounded border border-border text-sm"><span class="font-mono text-xs truncate flex-1 mr-2"> </span> <button type="button" class="text-muted-foreground hover:text-destructive transition-colors p-1" aria-label="Remove relay"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),zt=C('<div class="space-y-2"><div class="text-sm font-medium text-foreground"> </div> <div class="max-h-40 overflow-y-auto space-y-1"></div></div>'),Nt=C('<div class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),At=C('<div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 dark:text-green-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Event found! Loading...</span></div>'),Ft=Ee('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Searching...',1),Ut=Ee('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Search for Event',1),Ot=C('<div class="flex gap-3"><!> <!></div>'),Kt=C('<!> <div class="space-y-4 px-4"><div class="p-3 bg-muted/50 rounded-lg border border-border"><div class="text-xs text-muted-foreground mb-1 font-medium">Event ID (nevent)</div> <div class="font-mono text-xs break-all text-foreground"> </div></div> <div class="space-y-2"><label class="text-sm font-medium text-foreground">Add Relay URL</label> <div class="flex gap-2"><!> <!></div> <p class="text-xs text-muted-foreground">Enter relay URLs where this event might be stored (e.g., wss://relay.damus.io)</p></div> <!> <!> <!></div> <!>',1);function Vt(h,t){Fe(t,!0);const a=new at("(min-width: 768px)");let n=Je(t,"show",15),r=Q(""),i=Q(xe(t.relayHint?[t.relayHint]:[])),s=Q(!1),d=Q(""),m=Q(!1);const v=ne(()=>{try{return Qe.neventEncode({id:t.eventId,relays:t.relayHint?[t.relayHint]:[]})}catch{return t.eventId}});function k(){const o=e(r).trim();if(o){if(!o.startsWith("wss://")&&!o.startsWith("ws://")){g(d,"Relay URL must start with wss:// or ws://");return}if(e(i).includes(o)){g(d,"This relay is already in the list");return}g(i,[...e(i),o],!0),g(r,""),g(d,"")}}function P(o){g(i,e(i).filter(I=>I!==o),!0)}async function b(){if(e(i).length===0){g(d,"Please add at least one relay URL");return}g(s,!0),g(d,""),g(m,!1);try{const o=await nt(async()=>{const{NDKRelaySet:U}=await import("../chunks/QTLWRGLp.js").then(w=>w.V);return{NDKRelaySet:U}},__vite__mapDeps([0,1,2,3]),import.meta.url).then(({NDKRelaySet:U})=>U.fromRelayUrls(e(i),Ne)),I=await Ne.fetchEvent({ids:[t.eventId]},{closeOnEose:!0},o);I?(g(m,!0),t.onEventFound?.(I),setTimeout(()=>{n(!1)},1e3)):g(d,"Event not found on the specified relays")}catch(o){console.error("Error fetching event:",o),g(d,o instanceof Error?o.message:"Failed to fetch event",!0)}finally{g(s,!1)}}function F(o){o.key==="Enter"&&k()}var Y=ie(),G=N(Y);{var te=o=>{var I=ie(),U=N(I);ee(U,()=>lt,(w,_)=>{_(w,{get open(){return n()},set open($){n($)},children:($,O)=>{var E=ie(),T=N(E);ee(T,()=>ot,(j,Z)=>{Z(j,{class:"max-w-2xl",onClose:()=>n(!1),children:(le,me)=>{var de=Lt(),ue=N(de);ee(ue,()=>pt,(u,y)=>{y(u,{children:(R,V)=>{var L=Rt(),W=N(L);ee(W,()=>it,(M,D)=>{D(M,{children:(z,q)=>{A();var se=ce("Missing Event Explorer");l(z,se)},$$slots:{default:!0}})});var J=c(W,2);ee(J,()=>ct,(M,D)=>{D(M,{children:(z,q)=>{A();var se=ce("This event couldn't be found on the default relays. Try adding relay URLs where it might be stored.");l(z,se)},$$slots:{default:!0}})}),l(R,L)},$$slots:{default:!0}})});var H=c(ue,2),K=p(H),ve=c(p(K),2),fe=p(ve,!0);f(ve),f(K);var re=c(K,2),S=c(p(re),2),he=p(S);qe(he,{type:"text",placeholder:"wss://relay.example.com",get disabled(){return e(s)},onkeydown:F,class:"flex-1",get value(){return e(r)},set value(u){g(r,u,!0)}});var $e=c(he,2);{let u=ne(()=>e(s)||!e(r).trim());ge($e,{type:"button",onclick:k,get disabled(){return e(u)},variant:"outline",children:(y,R)=>{A();var V=ce("Add");l(y,V)},$$slots:{default:!0}})}f(S),A(2),f(re);var _e=c(re,2);{var Te=u=>{var y=It(),R=p(y),V=p(R);f(R);var L=c(R,2);ye(L,21,()=>e(i),we,(W,J)=>{var M=Mt(),D=p(M),z=p(D,!0);f(D);var q=c(D,2);q.__click=()=>P(e(J)),f(M),oe(()=>{ae(z,e(J)),q.disabled=e(s)}),l(W,M)}),f(L),f(y),oe(()=>ae(V,`Relays to search (${e(i).length??""})`)),l(u,y)};B(_e,u=>{e(i).length>0&&u(Te)})}var be=c(_e,2);{var Re=u=>{var y=Dt(),R=c(p(y),2),V=p(R,!0);f(R),f(y),oe(()=>ae(V,e(d))),l(u,y)};B(be,u=>{e(d)&&u(Re)})}var Me=c(be,2);{var Ie=u=>{var y=Ct();l(u,y)};B(Me,u=>{e(m)&&u(Ie)})}f(H);var De=c(H,2);ee(De,()=>mt,(u,y)=>{y(u,{children:(R,V)=>{var L=Pt(),W=N(L);ge(W,{type:"button",variant:"outline",onclick:()=>n(!1),get disabled(){return e(s)},children:(M,D)=>{A();var z=ce("Cancel");l(M,z)},$$slots:{default:!0}});var J=c(W,2);{let M=ne(()=>e(s)||e(i).length===0||e(m));ge(J,{type:"button",onclick:b,get disabled(){return e(M)},children:(D,z)=>{var q=ie(),se=N(q);{var Ce=X=>{var pe=Ht();A(),l(X,pe)},He=X=>{var pe=St();A(),l(X,pe)};B(se,X=>{e(s)?X(Ce):X(He,!1)})}l(D,q)},$$slots:{default:!0}})}l(R,L)},$$slots:{default:!0}})}),oe(()=>ae(fe,e(v))),l(le,de)},$$slots:{default:!0}})}),l($,E)},$$slots:{default:!0}})}),l(o,I)},x=o=>{var I=ie(),U=N(I);ee(U,()=>vt,(w,_)=>{_(w,{get open(){return n()},set open($){n($)},children:($,O)=>{var E=ie(),T=N(E);ee(T,()=>dt,(j,Z)=>{Z(j,{children:(le,me)=>{var de=Kt(),ue=N(de);ee(ue,()=>gt,(u,y)=>{y(u,{class:"text-left",children:(R,V)=>{var L=Bt(),W=N(L);ee(W,()=>ut,(M,D)=>{D(M,{children:(z,q)=>{A();var se=ce("Missing Event Explorer");l(z,se)},$$slots:{default:!0}})});var J=c(W,2);ee(J,()=>ft,(M,D)=>{D(M,{children:(z,q)=>{A();var se=ce("This event couldn't be found on the default relays. Try adding relay URLs where it might be stored.");l(z,se)},$$slots:{default:!0}})}),l(R,L)},$$slots:{default:!0}})});var H=c(ue,2),K=p(H),ve=c(p(K),2),fe=p(ve,!0);f(ve),f(K);var re=c(K,2),S=c(p(re),2),he=p(S);qe(he,{type:"text",placeholder:"wss://relay.example.com",get disabled(){return e(s)},onkeydown:F,class:"flex-1",get value(){return e(r)},set value(u){g(r,u,!0)}});var $e=c(he,2);{let u=ne(()=>e(s)||!e(r).trim());ge($e,{type:"button",onclick:k,get disabled(){return e(u)},variant:"outline",children:(y,R)=>{A();var V=ce("Add");l(y,V)},$$slots:{default:!0}})}f(S),A(2),f(re);var _e=c(re,2);{var Te=u=>{var y=zt(),R=p(y),V=p(R);f(R);var L=c(R,2);ye(L,21,()=>e(i),we,(W,J)=>{var M=jt(),D=p(M),z=p(D,!0);f(D);var q=c(D,2);q.__click=()=>P(e(J)),f(M),oe(()=>{ae(z,e(J)),q.disabled=e(s)}),l(W,M)}),f(L),f(y),oe(()=>ae(V,`Relays to search (${e(i).length??""})`)),l(u,y)};B(_e,u=>{e(i).length>0&&u(Te)})}var be=c(_e,2);{var Re=u=>{var y=Nt(),R=c(p(y),2),V=p(R,!0);f(R),f(y),oe(()=>ae(V,e(d))),l(u,y)};B(be,u=>{e(d)&&u(Re)})}var Me=c(be,2);{var Ie=u=>{var y=At();l(u,y)};B(Me,u=>{e(m)&&u(Ie)})}f(H);var De=c(H,2);ee(De,()=>ht,(u,y)=>{y(u,{class:"pt-2",children:(R,V)=>{var L=Ot(),W=p(L);ge(W,{type:"button",variant:"outline",onclick:()=>n(!1),get disabled(){return e(s)},class:"flex-1",children:(M,D)=>{A();var z=ce("Cancel");l(M,z)},$$slots:{default:!0}});var J=c(W,2);{let M=ne(()=>e(s)||e(i).length===0||e(m));ge(J,{type:"button",onclick:b,get disabled(){return e(M)},class:"flex-1",children:(D,z)=>{var q=ie(),se=N(q);{var Ce=X=>{var pe=Ft();A(),l(X,pe)},He=X=>{var pe=Ut();A(),l(X,pe)};B(se,X=>{e(s)?X(Ce):X(He,!1)})}l(D,q)},$$slots:{default:!0}})}f(L),l(R,L)},$$slots:{default:!0}})}),oe(()=>ae(fe,e(v))),l(le,de)},$$slots:{default:!0}})}),l($,E)},$$slots:{default:!0}})}),l(o,I)};B(G,o=>{a.current?o(te):o(x,!1)})}l(h,Y),Ue()}Ae(["click"]);var Wt=C('<div class="absolute left-[29px] -top-px h-[73px] w-0.5 bg-muted"></div> <div class="absolute left-[29px] top-[73px] bottom-0 w-0.5 bg-muted"></div>',1),qt=C('<p class="text-xs text-muted-foreground/70 font-mono truncate mb-3 bg-background/50 p-2 rounded"> </p>'),Gt=C(`<article class="p-3 sm:p-4 bg-muted/10 border-b border-border relative min-w-0"><!> <div class="p-4 border border-dashed border-muted-foreground/30 rounded-lg bg-muted/20"><div class="flex items-start gap-3"><div class="flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1 min-w-0"><p class="text-sm font-medium text-foreground mb-1">Missing Parent Event</p> <p class="text-xs text-muted-foreground mb-2">This note is replying to an event that couldn't be found on the default relays.</p> <!> <button type="button" class="text-sm text-primary hover:text-primary/80 underline transition-colors flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Try fetching from other relays</button></div></div></div></article> <!>`,1);function Qt(h,t){Fe(t,!0);let a=Je(t,"showThreadLine",3,!1),n=Q(!1);const r=ne(()=>{try{return Qe.neventEncode({id:t.eventId,relays:t.relayHint?[t.relayHint]:[]})}catch{return t.eventId}});var i=Gt(),s=N(i),d=p(s);{var m=x=>{var o=Wt();A(2),l(x,o)};B(d,x=>{a()&&x(m)})}var v=c(d,2),k=p(v),P=c(p(k),2),b=c(p(P),4);{var F=x=>{var o=qt(),I=p(o);f(o),oe(U=>ae(I,`${U??""}...`),[()=>e(r).slice(0,40)]),l(x,o)};B(b,x=>{e(r)&&x(F)})}var Y=c(b,2);Y.__click=()=>g(n,!0),f(P),f(k),f(v),f(s);var G=c(s,2);{var te=x=>{Vt(x,{get eventId(){return t.eventId},get relayHint(){return t.relayHint},get onEventFound(){return t.onEventFound},get show(){return e(n)},set show(o){g(n,o,!0)}})};B(G,x=>{e(n)&&x(te)})}l(h,i),Ue()}Ae(["click"]);var Jt=C('<div class="flex flex-col items-center justify-center mt-20"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div> <p class="mt-4 text-neutral-400">Loading thread...</p></div>'),Xt=C('<div class="px-4 py-3 border-b border-border"><h2 class="font-semibold text-foreground"> </h2></div> <!>',1),Yt=C('<main class="w-full lg:max-w-2xl mx-auto"><!> <!> <div><!></div></main>'),Zt=C('<div class="min-h-screen bg-background"><header class="sticky top-0 z-10 bg-background/80 backdrop-blur-md border-b border-border"><div class="flex items-center gap-4 px-4 py-3"><button class="p-2 hover:bg-neutral-900 rounded-lg transition-colors" aria-label="Go back"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button> <h1 class="text-xl font-semibold">Thread</h1></div></header> <!></div>');function xr(h,t){Fe(t,!0);const a=()=>et(tt,"$page",n),[n,r]=Ze(),i=ne(()=>a().params.nevent);let s=Q(null);ze(()=>{e(i)&&(g(s,null),g(s,Tt(()=>({focusedEvent:e(i)}),Ne),!0))});function d(x){if(e(s)){e(s).focusOn(x);const o=x.encode();window.history.pushState({},"",`/e/${o}`)}}const m=ne(()=>{if(!e(s))return null;const x=e(s).focusedEventId;return x&&e(s).events.find(I=>I.id===x)?.event||null}),v=ne(()=>{if(!e(s))return[];const x=e(s).focusedEventId;if(!x)return[];const o=e(s).events.findIndex(I=>I.id===x);return o===-1?[]:e(s).events.slice(0,o)});var k=Zt(),P=p(k),b=p(P),F=p(b);F.__click=()=>history.back(),A(2),f(b),f(P);var Y=c(P,2);{var G=x=>{var o=Jt();l(x,o)},te=x=>{var o=Yt(),I=p(o);ye(I,17,()=>e(v),we,(T,j,Z)=>{var le=ie(),me=N(le);{var de=H=>{{let K=ne(()=>Z<e(v).length-1);Qt(H,{get eventId(){return e(j).id},get relayHint(){return e(j).relayHint},get showThreadLine(){return e(K)},onEventFound:()=>{}})}},ue=H=>{var K=ie(),ve=N(K);{var fe=S=>{Be(S,{get event(){return e(j).event},variant:"default"})},re=S=>{{let he=ne(()=>Z<e(v).length-1);Le(S,{get event(){return e(j).event},variant:"thread-parent",get showThreadLine(){return e(he)},onNavigate:()=>e(j).event&&d(e(j).event)})}};B(ve,S=>{e(j).event.kind===9802?S(fe):S(re,!1)},!0)}l(H,K)};B(me,H=>{e(j).event?H(ue,!1):H(de)})}l(T,le)});var U=c(I,2);{var w=T=>{Be(T,{get event(){return e(m)},variant:"default"})},_=T=>{Le(T,{get event(){return e(m)},variant:"thread-main",showThreadLine:!1})};B(U,T=>{e(m).kind===9802?T(w):T(_,!1)})}var $=c(U,2),O=p($);{var E=T=>{var j=Xt(),Z=N(j),le=p(Z),me=p(le);f(le),f(Z);var de=c(Z,2);ye(de,17,()=>e(s).replies,we,(ue,H)=>{var K=ie(),ve=N(K);{var fe=S=>{Be(S,{get event(){return e(H)},variant:"default"})},re=S=>{Le(S,{get event(){return e(H)},variant:"thread-reply",onNavigate:()=>d(e(H))})};B(ve,S=>{e(H).kind===9802?S(fe):S(re,!1)})}l(ue,K)}),oe(()=>ae(me,`${e(s).replies.length??""} ${e(s).replies.length===1?"Reply":"Replies"}`)),l(T,j)};B(O,T=>{e(s)&&e(s).replies.length>0&&T(E)})}f($),f(o),l(x,o)};B(Y,x=>{e(m)?x(te,!1):x(G)})}f(k),l(h,k),Ue(),r()}Ae(["click"]);export{xr as component};
