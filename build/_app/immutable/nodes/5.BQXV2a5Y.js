import{d as Mt,f as i,a as t,c as se,s as M,t as xe,i as Ue}from"../chunks/DNmf0A2m.js";import{p as lt,a as _e,x as jt,u as ot,s as u,ax as Rt,d as a,e as o,r,c as dt,f as b,g as e,b as q,t as W,y as p}from"../chunks/DpkVnRja.js";import{i as w}from"../chunks/Btb_Ey2R.js";import{e as Ze,i as zt}from"../chunks/DD8s4tVe.js";import{n as Ce,s as qe,j as ht,e as Nt,f as St,d as bt}from"../chunks/QTLWRGLp.js";import{h as gt}from"../chunks/Jrqc4XQc.js";import{c as _t,N as Dt}from"../chunks/7I2W7SCc.js";import{c as te}from"../chunks/CSx53_lc.js";import{c as yt,b as wt,a as xt,r as st,g as kt}from"../chunks/Ci0hv7jC.js";import{U as Xe}from"../chunks/BYRURnlO.js";import{g as $t}from"../chunks/C5Sp5Tgr.js";import{f as Tt}from"../chunks/KSN4Ur19.js";import{a as It}from"../chunks/Danls9zm.js";import{d as At}from"../chunks/Cl1e4hnh.js";import{p as Bt}from"../chunks/f_qAQkK6.js";import{u as nt}from"../chunks/ACGw3gZU.js";import{c as Pt}from"../chunks/a7XEC-kH.js";import{g as Et,a as Lt,e as Ut,b as Ot}from"../chunks/JQBZd0wI.js";import{M as Vt,D as Wt,a as Yt,R as Gt,b as Ht,c as Ft,d as Jt}from"../chunks/ExIc70cS.js";import{D as Kt,a as Qt}from"../chunks/B-DQEjp8.js";import{D as qt}from"../chunks/DuCXCqgL.js";import{D as Xt,a as Zt}from"../chunks/BJCNLf3C.js";import{I as He,B as Le}from"../chunks/OHIcQ-QL.js";import{L as Fe}from"../chunks/CRTsssmk.js";import{T as Ct}from"../chunks/Cm-nUtcq.js";import{R as it}from"../chunks/HqbGqMNs.js";import{D as er}from"../chunks/BGQ6BdS-.js";import{P as tr}from"../chunks/Drx0G2VM.js";var rr=i('<p class="text-muted-foreground text-center py-8">No invites yet in this Agora</p>'),or=i('<p class="text-xs text-muted-foreground truncate"> </p>'),ar=i('<a class="relative bg-gradient-to-b from-primary/5 to-transparent border border-border rounded-xl p-6 hover:border-primary/50 transition-all hover:shadow-lg group"><div class="absolute -top-3 left-1/2 -translate-x-1/2"><div class="w-12 h-12 rounded-full bg-card border-2 border-border flex items-center justify-center text-2xl group-hover:border-primary transition-colors"> </div></div> <div class="flex justify-center mt-6 mb-4"><!></div> <div class="text-center mb-4"><h3 class="font-bold text-lg text-foreground truncate mb-1"> </h3> <!></div> <div class="bg-muted/50 rounded-lg p-3"><div class="text-center"><div class="text-3xl font-bold text-primary mb-1"> </div> <div class="text-xs text-muted-foreground"> </div></div></div> <div class="mt-3"><div class="h-1.5 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),sr=i('<button class="w-full flex items-center justify-center gap-2 py-3 text-sm font-medium text-primary hover:text-primary/80 transition-colors"><span> </span> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>'),nr=i('<a class="flex items-center gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors"><div class="flex items-center gap-3 flex-1"><span class="text-lg font-semibold text-muted-foreground w-8"> </span> <!> <div class="flex-1 min-w-0"><div class="font-medium text-foreground truncate"> </div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="hidden md:block w-32"><div class="h-2 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),ir=i('<div class="mt-4 space-y-2 border-t border-border pt-4"></div>'),lr=i('<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6"></div> <!> <!>',1),dr=i('<div><h2 class="text-xl font-bold text-foreground mb-6">üèÜ Top Inviters</h2> <!></div>');function vr(Oe,I){lt(I,!0);let O=_e(!1);function Y(s){return s===1?"ü•á":s===2?"ü•à":s===3?"ü•â":""}const X=q(()=>I.stats.slice(0,3)),G=q(()=>I.stats.slice(3,10)),j=q(()=>Math.max(...I.stats.map(s=>s.successfulInvites),1));let R=_e(jt(new Map)),ne=_e(0);ot(()=>{console.log("[TopInvitersPodium] $effect running, stats count:",I.stats.length);const s=new Map;let c=0;const h=I.stats.length;if(h===0){u(R,s,!0);return}I.stats.forEach(_=>{Ce.fetchUser(_.pubkey).then(x=>{x?.fetchProfile().then(re=>{console.log("[TopInvitersPodium] Setting profile for",_.pubkey),s.set(_.pubkey,re||null),c++,c===h&&(u(R,s,!0),Rt(ne))})})})});var ie=dr(),le=a(o(ie),2);{var be=s=>{var c=rr();t(s,c)},De=s=>{var c=lr(),h=b(c);Ze(h,21,()=>e(X),k=>k.pubkey,(k,$)=>{const N=q(()=>e(R).get(e($).pubkey));var S=ar(),de=o(S),ye=o(de),P=o(ye,!0);r(ye),r(de);var T=a(de,2),f=o(T);te(f,()=>Xe.Root,(ve,ke)=>{ke(ve,{get ndk(){return Ce},get pubkey(){return e($).pubkey},children:(je,at)=>{var V=se(),F=b(V);te(F,()=>Xe.Avatar,(B,ce)=>{ce(B,{class:"w-24 h-24 rounded-full ring-4 ring-primary/20"})}),t(je,V)},$$slots:{default:!0}})}),r(T);var A=a(T,2),we=o(A),Me=o(we,!0);r(we);var H=a(we,2);{var oe=ve=>{var ke=or(),je=o(ke,!0);r(ke),W(()=>M(je,e(N).nip05)),t(ve,ke)};w(H,ve=>{e(N)?.nip05&&ve(oe)})}r(A);var Te=a(A,2),he=o(Te),Ae=o(he),Be=o(Ae,!0);r(Ae);var Z=a(Ae,2),Pe=o(Z,!0);r(Z),r(he),r(Te);var Qe=a(Te,2),Ve=o(Qe),Ee=o(Ve);r(Ve),r(Qe),r(S),W((ve,ke,je)=>{yt(S,"href",ve),M(P,ke),M(Me,e(N)?.displayName||e(N)?.name||"Anonymous"),M(Be,e($).successfulInvites),M(Pe,e($).successfulInvites===1?"person joined":"people joined"),wt(Ee,`width: ${je??""}%`)},[()=>$t(e($).pubkey),()=>Y(e($).rank),()=>Math.min(100,e($).successfulInvites/e(j)*100)]),t(k,S)}),r(h);var _=a(h,2);{var x=k=>{var $=sr();$.__click=()=>u(O,!e(O));var N=o($),S=o(N,!0);r(N);var de=a(N,2);r($),W(()=>{M(S,e(O)?"Show Less":`View Top ${I.stats.length} Inviters`),xt(de,0,`w-4 h-4 transition-transform duration-200 ${e(O)?"rotate-180":""}`)}),t(k,$)};w(_,k=>{I.stats.length>3&&k(x)})}var re=a(_,2);{var D=k=>{var $=ir();Ze($,21,()=>e(G),N=>N.pubkey,(N,S)=>{const de=q(()=>e(R).get(e(S).pubkey));var ye=nr(),P=o(ye),T=o(P),f=o(T);r(T);var A=a(T,2);te(A,()=>Xe.Root,(Z,Pe)=>{Pe(Z,{get ndk(){return Ce},get pubkey(){return e(S).pubkey},children:(Qe,Ve)=>{var Ee=se(),ve=b(Ee);te(ve,()=>Xe.Avatar,(ke,je)=>{je(ke,{class:"w-10 h-10 rounded-full"})}),t(Qe,Ee)},$$slots:{default:!0}})});var we=a(A,2),Me=o(we),H=o(Me,!0);r(Me);var oe=a(Me,2),Te=o(oe);r(oe),r(we),r(P);var he=a(P,2),Ae=o(he),Be=o(Ae);r(Ae),r(he),r(ye),W((Z,Pe)=>{yt(ye,"href",Z),M(f,`${e(S).rank??""}.`),M(H,e(de)?.displayName||e(de)?.name||"Anonymous"),M(Te,`${e(S).successfulInvites??""} ${e(S).successfulInvites===1?"person joined":"people joined"}`),wt(Be,`width: ${Pe??""}%`)},[()=>$t(e(S).pubkey),()=>Math.min(100,e(S).successfulInvites/e(j)*100)]),t(N,ye)}),r($),t(k,$)};w(re,k=>{e(O)&&e(G).length>0&&k(D)})}t(s,c)};w(le,s=>{I.stats.length===0?s(be):s(De,!1)})}r(ie),t(Oe,ie),dt()}Mt(["click"]);var cr=i('<div class="text-muted-foreground">Invited by <span class="font-medium text-primary"> </span></div>'),ur=i("<div></div>"),fr=i('<div class="border border-border rounded-lg p-4 hover:border-primary/50 transition-colors"><div class="flex items-center gap-3 mb-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-lg">üëã</span> <span class="font-semibold text-foreground"> </span></div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="mb-3 text-foreground whitespace-pre-wrap line-clamp-4"> </div> <div class="flex items-center justify-between text-sm"><!></div></div>');function mr(Oe,I){lt(I,!0);let O=_e(null),Y=_e(null);ot(()=>{console.log("[IntroductionCard] $effect running for author:",I.event.pubkey),I.event.author.fetchProfile().then(D=>{u(O,D,!0)})}),ot(()=>{if(console.log("[IntroductionCard] $effect running for invitedBy:",I.invitedBy),!I.invitedBy){u(Y,null);return}Ce.fetchUser(I.invitedBy).then(D=>{D?.fetchProfile().then(k=>{u(Y,k,!0)})})});var X=fr(),G=o(X),j=o(G);te(j,()=>Xe.Root,(D,k)=>{k(D,{get ndk(){return Ce},get pubkey(){return I.event.pubkey},children:($,N)=>{var S=se(),de=b(S);te(de,()=>Xe.Avatar,(ye,P)=>{P(ye,{class:"w-12 h-12 rounded-full"})}),t($,S)},$$slots:{default:!0}})});var R=a(j,2),ne=o(R),ie=a(o(ne),2),le=o(ie,!0);r(ie),r(ne);var be=a(ne,2),De=o(be,!0);r(be),r(R),r(G);var s=a(G,2),c=o(s,!0);r(s);var h=a(s,2),_=o(h);{var x=D=>{var k=cr(),$=a(o(k)),N=o($);r($),r(k),W(()=>M(N,`@${(e(Y).name||"anonymous")??""}`)),t(D,k)},re=D=>{var k=ur();t(D,k)};w(_,D=>{e(Y)?D(x):D(re,!1)})}r(h),r(X),W(D=>{M(le,e(O)?.displayName||e(O)?.name||"Anonymous"),M(De,D),M(c,I.event.content)},[()=>Tt(I.event.created_at||0)]),t(Oe,X),dt()}var pr=i("<!> <!>",1),gr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),_r=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),hr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),xr=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),br=i('<div class="text-xs text-muted-foreground truncate"> </div>'),yr=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),wr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),kr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),$r=Ue(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Ir=Ue('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Ar=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Pr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Cr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Mr=Ue('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),jr=Ue('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),Rr=Ue('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),zr=i("<!> <!>",1),Nr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),Sr=i('<!> <div class="space-y-6"><!></div>',1),Dr=i("<!> <!>",1),Tr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),Br=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Er=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Lr=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),Ur=i('<div class="text-xs text-muted-foreground truncate"> </div>'),Or=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),Vr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),Wr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),Yr=Ue(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Gr=Ue('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Hr=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Fr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Jr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Kr=Ue('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),Qr=Ue('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),qr=Ue('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),Xr=i('<div class="flex gap-3 w-full"><!> <!></div>'),Zr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),eo=i('<!> <div class="space-y-6 px-4 overflow-y-auto pb-4"><!></div>',1);function to(Oe,I){lt(I,!0);const O=new Vt("(min-width: 768px)");let Y=Bt(I,"isOpen",15);const X=`Welcome to Agora! üéâ

I'm inviting you to join Agora, a new kind of social network where you own your identity and content. No algorithms, no ads, just authentic connections.

Looking forward to connecting with you on the open social web!`;let G=_e(X),j=_e(!1),R=_e(""),ne=_e(""),ie=_e(10),le=_e(""),be=_e(!1),De=_e(!1),s=_e(jt([])),c=_e(!1);const h=q(()=>qe.relays.filter(f=>f.enabled&&f.write&&ht(f.url)));ot(()=>{Y()&&qe.selectedRelay&&e(s).length===0&&ht(qe.selectedRelay)&&e(h).some(A=>A.url===qe.selectedRelay)&&u(s,[qe.selectedRelay],!0)});function _(f){e(s).includes(f)?u(s,e(s).filter(A=>A!==f),!0):u(s,[...e(s),f],!0)}const x=q(()=>e(s).length===0?null:e(s).length===1?{url:e(s)[0],info:nt(e(s)[0])}:null),re=q(()=>e(s).length===0?"Select Agora...":e(s).length===1?nt(e(s)[0]).info?.name||e(s)[0].replace("wss://","").replace("ws://",""):`${e(s).length} Agoras selected`);async function D(){if(!Ce.$currentUser){console.error("No user logged in");return}if(e(s).length===0){alert("Please select at least one Agora to publish the invite to.");return}u(be,!0);try{const f=e(j)?Et():"",A=[];for(let Z=0;Z<e(ie);Z++)A.push(Lt());const we={welcomeMessage:e(G),recipientName:e(j)?e(R):void 0,cashuToken:e(j)&&e(ne)?`cashu:${e(ne)}`:void 0,createdAt:Date.now(),inviter:Ce.$currentUser.pubkey},Me=e(j)?await Ut(JSON.stringify(we),f):JSON.stringify(we),H=new Nt(Ce);H.kind=513,H.content=Me,H.tags=[...A.map(Z=>["code",Z])],H.dTag=Ot(),H.isProtected=!0,H.isProtected=!0,console.log("Publishing invite event to selected Agoras...",H.id,e(s));const oe=new Set;for(const Z of e(s)){const Pe=Ce.pool.getRelay(Z,!0);Pe&&oe.add(Pe)}await H.sign();const Te=new St(oe,Ce);try{await H.publish(Te)}catch{console.log("going with the auth hack"),await H.publish(Te)}const he=H.dTag,Ae=e(j)?`${he}${f}`:he,Be=`${window.location.origin}/i/${Ae}`;u(le,Be),console.log("Invite created:",Be)}catch(f){console.error("Failed to generate invite:",f),alert("Failed to generate invite. Check console for details.")}finally{u(be,!1)}}async function k(){try{await navigator.clipboard.writeText(e(le)),u(De,!0),setTimeout(()=>u(De,!1),2e3)}catch(f){console.error("Failed to copy:",f)}}async function $(){if(!navigator.share){console.log("Web Share API not supported, falling back to copy"),await k();return}try{await navigator.share({title:"Join Agora",text:e(j)&&e(R)?`${e(R)}, you're invited to join Agora!`:"You're invited to join Agora, a new kind of social network!",url:e(le)})}catch(f){f.name!=="AbortError"&&console.error("Failed to share:",f)}}function N(){u(G,X),u(j,!1),u(R,""),u(ne,""),u(ie,10),u(le,""),u(s,[],!0),u(c,!1),I.onClose()}function S(){u(c,!1)}var de=se(),ye=b(de);{var P=f=>{var A=se(),we=b(A);te(we,()=>Gt,(Me,H)=>{H(Me,{get open(){return Y()},onOpenChange:oe=>{Y(oe),oe||N()},children:(oe,Te)=>{var he=se(),Ae=b(he);te(Ae,()=>Wt,(Be,Z)=>{Z(Be,{class:"max-w-lg max-h-[90vh] overflow-y-auto",children:(Pe,Qe)=>{var Ve=Sr(),Ee=b(Ve);te(Ee,()=>Xt,(V,F)=>{F(V,{children:(B,ce)=>{var $e=pr(),E=b($e);te(E,()=>Yt,(J,ue)=>{ue(J,{children:(fe,Re)=>{p();var C=xe("Create an Invite");t(fe,C)},$$slots:{default:!0}})});var L=a(E,2);te(L,()=>Kt,(J,ue)=>{ue(J,{children:(fe,Re)=>{p();var C=xe("Invite someone to join Agora with a personal message");t(fe,C)},$$slots:{default:!0}})}),t(B,$e)},$$slots:{default:!0}})});var ve=a(Ee,2),ke=o(ve);{var je=V=>{var F=Cr(),B=b(F),ce=o(B);Fe(ce,{for:"welcome-message",children:(n,l)=>{p();var y=xe("Welcome Message");t(n,y)},$$slots:{default:!0}});var $e=a(ce,2);Ct($e,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(G)},set value(n){u(G,n,!0)}}),r(B);var E=a(B,2),L=a(o(E),2);L.__click=()=>u(c,!e(c));var J=o(L);{var ue=n=>{var l=gr();p(2),t(n,l)},fe=n=>{var l=se(),y=b(l);{var K=d=>{var m=_r(),g=b(m);it(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),Q=o(v,!0);r(v),W(()=>M(Q,e(re))),t(d,m)},pe=d=>{var m=hr(),g=a(b(m),2),v=o(g);r(g),W(()=>M(v,`${e(s).length??""} Agoras selected`)),t(d,m)};w(y,d=>{e(s).length===1&&e(x)?d(K):d(pe,!1)},!0)}t(n,l)};w(J,n=>{e(s).length===0?n(ue):n(fe,!1)})}var Re=a(J,2);r(L);var C=a(L,2);{var ze=n=>{var l=wr(),y=o(l);{var K=d=>{var m=xr();t(d,m)},pe=d=>{var m=se(),g=b(m);Ze(g,17,()=>e(h),v=>v.url,(v,Q)=>{const ge=q(()=>nt(e(Q).url));var Ge=yr();Ge.__click=()=>{_(e(Q).url)};var Je=o(Ge);st(Je);var et=a(Je,2);it(et,{get relayUrl(){return e(Q).url},size:"md"});var tt=a(et,2),Ke=o(tt),rt=o(Ke),ut=o(rt,!0);r(rt),p(2),r(Ke);var ft=a(Ke,2);{var mt=Ne=>{var Se=br(),pt=o(Se,!0);r(Se),W(()=>M(pt,e(ge).info.description)),t(Ne,Se)};w(ft,Ne=>{e(ge).info?.description&&Ne(mt)})}r(tt),r(Ge),W((Ne,Se)=>{kt(Je,Ne),M(ut,Se)},[()=>e(s).includes(e(Q).url),()=>e(ge).info?.name||e(Q).url.replace("wss://","").replace("ws://","")]),t(v,Ge)}),t(d,m)};w(y,d=>{e(h).length===0?d(K):d(pe,!1)})}r(l),It(l,(d,m)=>Pt?.(d,m),()=>S),t(n,l)};w(C,n=>{e(c)&&n(ze)})}var ae=a(C,2);{var We=n=>{var l=kr(),y=o(l);r(l),W(()=>M(y,`${e(s).length??""} Agoras selected`)),t(n,l)};w(ae,n=>{e(s).length>1&&n(We)})}r(E);var ee=a(E,2),me=o(ee);Fe(me,{for:"max-uses",children:(n,l)=>{p();var y=xe("Maximum Uses");t(n,y)},$$slots:{default:!0}});var U=a(me,2);He(U,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(ie)},set value(n){u(ie,n,!0)}}),p(2),r(ee);var z=a(ee,2),Ye=o(z);st(Ye),p(2),r(z);var Ie=a(z,2);{var vt=n=>{var l=Ar(),y=o(l),K=o(y);Fe(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,Q)=>{var ge=$r();p(),t(v,ge)},$$slots:{default:!0}});var pe=a(K,2);He(pe,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(R)},set value(v){u(R,v,!0)}}),r(y);var d=a(y,2),m=o(d);Fe(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,Q)=>{var ge=Ir();p(),t(v,ge)},$$slots:{default:!0}});var g=a(m,2);He(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(ne)},set value(v){u(ne,v,!0)}}),p(2),r(d),r(l),t(n,l)};w(Ie,n=>{e(j)&&n(vt)})}var ct=a(Ie,2);{let n=q(()=>e(be)||!e(G).trim()||e(s).length===0);Le(ct,{onclick:D,get disabled(){return e(n)},class:"w-full",children:(l,y)=>{var K=se(),pe=b(K);{var d=g=>{var v=Pr();p(),t(g,v)},m=g=>{var v=xe("Generate Invite Link");t(g,v)};w(pe,g=>{e(be)?g(d):g(m,!1)})}t(l,K)},$$slots:{default:!0}})}W(()=>xt(Re,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(c)?"rotate-180":""}`)),At(Ye,()=>e(j),n=>u(j,n)),t(V,F)},at=V=>{var F=Nr(),B=o(F),ce=a(o(B),4),$e=o(ce,!0);r(ce),r(B);var E=a(B,2),L=o(E),J=o(L);He(J,{type:"text",get value(){return e(le)},readonly:!0,class:"flex-1 bg-transparent"});var ue=a(J,2);Le(ue,{onclick:k,size:"sm",children:(C,ze)=>{var ae=se(),We=b(ae);{var ee=U=>{var z=Mr();p(),t(U,z)},me=U=>{var z=jr();p(),t(U,z)};w(We,U=>{e(De)?U(ee):U(me,!1)})}t(C,ae)},$$slots:{default:!0}}),r(L);var fe=a(L,2);Le(fe,{onclick:$,variant:"outline",class:"w-full",children:(C,ze)=>{var ae=Rr();p(),t(C,ae)},$$slots:{default:!0}}),r(E);var Re=a(E,2);te(Re,()=>er,(C,ze)=>{ze(C,{class:"flex gap-3 sm:space-x-0",children:(ae,We)=>{var ee=zr(),me=b(ee);Le(me,{variant:"outline",onclick:()=>u(le,""),class:"flex-1",children:(z,Ye)=>{p();var Ie=xe("Create Another");t(z,Ie)},$$slots:{default:!0}});var U=a(me,2);Le(U,{onclick:N,class:"flex-1",children:(z,Ye)=>{p();var Ie=xe("Done");t(z,Ie)},$$slots:{default:!0}}),t(ae,ee)},$$slots:{default:!0}})}),r(F),W(()=>M($e,e(j)&&e(R)?`Your personalized invite for ${e(R)} is ready`:"Your invite link is ready to share")),t(V,F)};w(ke,V=>{e(le)?V(at,!1):V(je)})}r(ve),t(Pe,Ve)},$$slots:{default:!0}})}),t(oe,he)},$$slots:{default:!0}})}),t(f,A)},T=f=>{var A=se(),we=b(A);te(we,()=>Jt,(Me,H)=>{H(Me,{get open(){return Y()},onOpenChange:oe=>{Y(oe),oe||N()},children:(oe,Te)=>{var he=se(),Ae=b(he);te(Ae,()=>Ht,(Be,Z)=>{Z(Be,{children:(Pe,Qe)=>{var Ve=eo(),Ee=b(Ve);te(Ee,()=>Zt,(V,F)=>{F(V,{class:"text-left",children:(B,ce)=>{var $e=Dr(),E=b($e);te(E,()=>Ft,(J,ue)=>{ue(J,{children:(fe,Re)=>{p();var C=xe("Create an Invite");t(fe,C)},$$slots:{default:!0}})});var L=a(E,2);te(L,()=>Qt,(J,ue)=>{ue(J,{children:(fe,Re)=>{p();var C=xe("Invite someone to join Agora with a personal message");t(fe,C)},$$slots:{default:!0}})}),t(B,$e)},$$slots:{default:!0}})});var ve=a(Ee,2),ke=o(ve);{var je=V=>{var F=Jr(),B=b(F),ce=o(B);Fe(ce,{for:"welcome-message",children:(n,l)=>{p();var y=xe("Welcome Message");t(n,y)},$$slots:{default:!0}});var $e=a(ce,2);Ct($e,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(G)},set value(n){u(G,n,!0)}}),r(B);var E=a(B,2),L=a(o(E),2);L.__click=()=>u(c,!e(c));var J=o(L);{var ue=n=>{var l=Tr();p(2),t(n,l)},fe=n=>{var l=se(),y=b(l);{var K=d=>{var m=Br(),g=b(m);it(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),Q=o(v,!0);r(v),W(()=>M(Q,e(re))),t(d,m)},pe=d=>{var m=Er(),g=a(b(m),2),v=o(g);r(g),W(()=>M(v,`${e(s).length??""} Agoras selected`)),t(d,m)};w(y,d=>{e(s).length===1&&e(x)?d(K):d(pe,!1)},!0)}t(n,l)};w(J,n=>{e(s).length===0?n(ue):n(fe,!1)})}var Re=a(J,2);r(L);var C=a(L,2);{var ze=n=>{var l=Vr(),y=o(l);{var K=d=>{var m=Lr();t(d,m)},pe=d=>{var m=se(),g=b(m);Ze(g,17,()=>e(h),v=>v.url,(v,Q)=>{const ge=q(()=>nt(e(Q).url));var Ge=Or();Ge.__click=()=>{_(e(Q).url)};var Je=o(Ge);st(Je);var et=a(Je,2);it(et,{get relayUrl(){return e(Q).url},size:"md"});var tt=a(et,2),Ke=o(tt),rt=o(Ke),ut=o(rt,!0);r(rt),p(2),r(Ke);var ft=a(Ke,2);{var mt=Ne=>{var Se=Ur(),pt=o(Se,!0);r(Se),W(()=>M(pt,e(ge).info.description)),t(Ne,Se)};w(ft,Ne=>{e(ge).info?.description&&Ne(mt)})}r(tt),r(Ge),W((Ne,Se)=>{kt(Je,Ne),M(ut,Se)},[()=>e(s).includes(e(Q).url),()=>e(ge).info?.name||e(Q).url.replace("wss://","").replace("ws://","")]),t(v,Ge)}),t(d,m)};w(y,d=>{e(h).length===0?d(K):d(pe,!1)})}r(l),It(l,(d,m)=>Pt?.(d,m),()=>S),t(n,l)};w(C,n=>{e(c)&&n(ze)})}var ae=a(C,2);{var We=n=>{var l=Wr(),y=o(l);r(l),W(()=>M(y,`${e(s).length??""} Agoras selected`)),t(n,l)};w(ae,n=>{e(s).length>1&&n(We)})}r(E);var ee=a(E,2),me=o(ee);Fe(me,{for:"max-uses",children:(n,l)=>{p();var y=xe("Maximum Uses");t(n,y)},$$slots:{default:!0}});var U=a(me,2);He(U,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(ie)},set value(n){u(ie,n,!0)}}),p(2),r(ee);var z=a(ee,2),Ye=o(z);st(Ye),p(2),r(z);var Ie=a(z,2);{var vt=n=>{var l=Hr(),y=o(l),K=o(y);Fe(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,Q)=>{var ge=Yr();p(),t(v,ge)},$$slots:{default:!0}});var pe=a(K,2);He(pe,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(R)},set value(v){u(R,v,!0)}}),r(y);var d=a(y,2),m=o(d);Fe(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,Q)=>{var ge=Gr();p(),t(v,ge)},$$slots:{default:!0}});var g=a(m,2);He(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(ne)},set value(v){u(ne,v,!0)}}),p(2),r(d),r(l),t(n,l)};w(Ie,n=>{e(j)&&n(vt)})}var ct=a(Ie,2);{let n=q(()=>e(be)||!e(G).trim()||e(s).length===0);Le(ct,{onclick:D,get disabled(){return e(n)},class:"w-full",children:(l,y)=>{var K=se(),pe=b(K);{var d=g=>{var v=Fr();p(),t(g,v)},m=g=>{var v=xe("Generate Invite Link");t(g,v)};w(pe,g=>{e(be)?g(d):g(m,!1)})}t(l,K)},$$slots:{default:!0}})}W(()=>xt(Re,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(c)?"rotate-180":""}`)),At(Ye,()=>e(j),n=>u(j,n)),t(V,F)},at=V=>{var F=Zr(),B=o(F),ce=a(o(B),4),$e=o(ce,!0);r(ce),r(B);var E=a(B,2),L=o(E),J=o(L);He(J,{type:"text",get value(){return e(le)},readonly:!0,class:"flex-1 bg-transparent"});var ue=a(J,2);Le(ue,{onclick:k,size:"sm",children:(C,ze)=>{var ae=se(),We=b(ae);{var ee=U=>{var z=Kr();p(),t(U,z)},me=U=>{var z=Qr();p(),t(U,z)};w(We,U=>{e(De)?U(ee):U(me,!1)})}t(C,ae)},$$slots:{default:!0}}),r(L);var fe=a(L,2);Le(fe,{onclick:$,variant:"outline",class:"w-full",children:(C,ze)=>{var ae=qr();p(),t(C,ae)},$$slots:{default:!0}}),r(E);var Re=a(E,2);te(Re,()=>qt,(C,ze)=>{ze(C,{class:"pt-2",children:(ae,We)=>{var ee=Xr(),me=o(ee);Le(me,{variant:"outline",onclick:()=>u(le,""),class:"flex-1",children:(z,Ye)=>{p();var Ie=xe("Create Another");t(z,Ie)},$$slots:{default:!0}});var U=a(me,2);Le(U,{onclick:N,class:"flex-1",children:(z,Ye)=>{p();var Ie=xe("Done");t(z,Ie)},$$slots:{default:!0}}),r(ee),t(ae,ee)},$$slots:{default:!0}})}),r(F),W(()=>M($e,e(j)&&e(R)?`Your personalized invite for ${e(R)} is ready`:"Your invite link is ready to share")),t(V,F)};w(ke,V=>{e(le)?V(at,!1):V(je)})}r(ve),t(Pe,Ve)},$$slots:{default:!0}})}),t(oe,he)},$$slots:{default:!0}})}),t(f,A)};w(ye,f=>{O.current?f(P):f(T,!1)})}t(Oe,de),dt()}Mt(["click"]);const ro=Oe=>{tr(Oe,{title:"üèÜ Agora Invites",subtitle:"Community growth and new members"})};var oo=i('<div class="min-h-screen flex items-center justify-center p-4"><div class="text-center"><svg class="w-16 h-16 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <h2 class="text-xl font-semibold text-foreground mb-2">Select an Agora</h2> <p class="text-muted-foreground">This page shows community invites for a specific Agora</p></div></div>'),ao=i('<p class="text-muted-foreground text-center py-8">No new members yet</p>'),so=i('<div class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>'),no=i('<p class="text-muted-foreground text-center py-8">No introductions yet</p>'),io=i('<div class="space-y-4"></div>'),lo=i('<div class="w-full lg:max-w-4xl mx-auto p-4 space-y-6"><!> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üëã New Members</h2> <!></div> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üí¨ Introductions</h2> <!></div></div> <!>',1);function Eo(Oe,I){lt(I,!0);const O=q(()=>qe.selectedRelay),Y=q(()=>e(O)?ht(e(O)):!1),X=q(()=>(console.log("[INVITES] redemptionsSubscription $derived.by running",{selectedRelay:e(O),isAgora:e(Y)}),!e(O)||!e(Y)?null:Ce.$subscribe(()=>({filters:[{kinds:[514]}],relayUrls:[e(O)],subId:"invite-redemptions",cacheUsage:bt.ONLY_RELAY,closeOnEose:!0})))),G=q(()=>(console.log("[INVITES] introductionsSubscription $derived.by running",{selectedRelay:e(O),isAgora:e(Y)}),!e(O)||!e(Y)?null:Ce.$subscribe(()=>({filters:[{kinds:[1],"#t":["introduction"],limit:20}],relayUrls:[e(O)],cacheUsage:bt.ONLY_RELAY,exclusiveRelay:!0,closeOnEose:!0})))),j=q(()=>{if(console.log("[INVITES] inviterStats $derived.by running",e(X)?.events.length),!e(X))return[];const s=e(X).events,c=new Map;for(const _ of s){const x=_.tags.find(re=>re[0]==="p");if(x?.[1]){const re=x[1];c.set(re,(c.get(re)||0)+1)}}const h=Array.from(c.entries()).map(([_,x])=>({pubkey:_,totalInvites:x,successfulInvites:x,rank:0}));return h.sort((_,x)=>x.successfulInvites-_.successfulInvites),h.forEach((_,x)=>{_.rank=x+1}),h.slice(0,10)}),R=q(()=>{if(console.log("[INVITES] introductions $derived.by running",e(G)?.events.length,e(X)?.events.length),!e(G)||!e(X))return[];const s=e(G).events,c=e(X).events,h=new Map;for(const _ of c){const x=_.tags.find(re=>re[0]==="p");x&&x[1]&&h.set(_.pubkey,x[1])}return s.map(_=>({event:_,invitedBy:h.get(_.pubkey)||null})).sort((_,x)=>(x.event.created_at||0)-(_.event.created_at||0)).slice(0,10)}),ne=q(()=>(console.log("[INVITES] newMembers $derived.by running",e(X)?.events.length),e(X)?e(X).events.map(c=>{const h=c.tags.find(_=>_[0]==="p");return{memberPubkey:c.pubkey,inviterPubkey:h?.[1]||null,joinedAt:c.created_at||0}}).sort((c,h)=>h.joinedAt-c.joinedAt).slice(0,20):[]));ot(()=>(e(Y)?gt.header=ro:gt.clear(),()=>{gt.clear()}));var ie=se(),le=b(ie);{var be=s=>{var c=oo();t(s,c)},De=s=>{var c=lo(),h=b(c),_=o(h);vr(_,{get stats(){return e(j)}});var x=a(_,2),re=a(o(x),2);{var D=P=>{var T=ao();t(P,T)},k=P=>{var T=so();Ze(T,21,()=>e(ne).slice(0,6),zt,(f,A)=>{Dt(f,{get memberPubkey(){return e(A).memberPubkey},get inviterPubkey(){return e(A).inviterPubkey},get joinedAt(){return e(A).joinedAt}})}),r(T),t(P,T)};w(re,P=>{e(ne).length===0?P(D):P(k,!1)})}r(x);var $=a(x,2),N=a(o($),2);{var S=P=>{var T=no();t(P,T)},de=P=>{var T=io();Ze(T,21,()=>e(R),f=>f.event.id,(f,A)=>{mr(f,{get event(){return e(A).event},get invitedBy(){return e(A).invitedBy}})}),r(T),t(P,T)};w(N,P=>{e(R).length===0?P(S):P(de,!1)})}r($),r(h);var ye=a(h,2);to(ye,{onClose:()=>_t.close(),get isOpen(){return _t.show},set isOpen(P){_t.show=P}}),t(s,c)};w(le,s=>{e(Y)?s(De,!1):s(be)})}t(Oe,ie),dt()}export{Eo as component};
