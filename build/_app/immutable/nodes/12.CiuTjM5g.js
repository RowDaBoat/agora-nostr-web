import{d as se,f as v,s as S,a as o,t as Me,c as R}from"../chunks/CiPFrJr-.js";import{p as J,e as a,d as k,r,t as B,c as X,f as T,g as e,b as P,x as je,a as le,s as f,y as ve,u as Ue}from"../chunks/CSbKtK4P.js";import{i as _}from"../chunks/87vUJtvC.js";import{n as E,f as ze,e as de,r as Ne,h as ce}from"../chunks/D0X4VYcq.js";import{g as ue}from"../chunks/CTwadDAE.js";import{T as Be}from"../chunks/ChQzK9Kk.js";import{b as Se}from"../chunks/DphWBL27.js";import{b as Te}from"../chunks/I2MJeYPS.js";import{m as Ae}from"../chunks/CBcsBXzE.js";function Le(m,t){t&&ue(`/messages/${t.npub}`)}var Oe=v('<div class="text-xs text-neutral-500 flex-shrink-0 ml-2"><!></div>'),Pe=v('<span class="text-neutral-500">You:</span>'),Ee=v("<!> ",1),He=v('<div class="ml-2 flex-shrink-0 min-w-[20px] h-5 px-1.5 rounded-full bg-primary flex items-center justify-center"><span class="text-xs font-bold text-primary-foreground"> </span></div>'),Ie=v('<button class="w-full flex items-center gap-3 px-4 py-4 hover:bg-neutral-900/50 transition-colors text-left"><!> <div class="flex-1 min-w-0"><div class="flex items-center justify-between mb-1"><div class="font-semibold text-white truncate"> </div> <!></div> <div class="flex items-center justify-between"><p class="text-sm text-neutral-400 truncate flex-1"><!></p> <!></div></div></button>');function Ve(m,t){J(t,!0);const s=t.conversation.getOtherParticipant(),c=t.conversation.getLastMessage(),l=s?E.$fetchProfile(()=>s.pubkey):null;var y=Ie();y.__click=[Le,s];var u=a(y);{var C=i=>{ze(i,{get ndk(){return E},get pubkey(){return s.pubkey},class:"w-12 h-12 flex-shrink-0"})};_(u,i=>{s&&i(C)})}var w=k(u,2),p=a(w),M=a(p),H=a(M,!0);r(M);var I=k(M,2);{var n=i=>{var h=Oe(),z=a(h);Be(z,{get timestamp(){return c.timestamp}}),r(h),o(i,h)};_(I,i=>{c&&i(n)})}r(p);var x=k(p,2),U=a(x),V=a(U);{var Z=i=>{var h=Ee(),z=T(h);{var D=N=>{var $=Pe();o(N,$)};_(z,N=>{c.sender.pubkey===E.activeUser?.pubkey&&N(D)})}var d=k(z);B(()=>S(d,` ${c.content??""}`)),o(i,h)},W=i=>{var h=Me("No messages yet");o(i,h)};_(V,i=>{c?i(Z):i(W,!1)})}r(U);var Y=k(U,2);{var q=i=>{var h=He(),z=a(h),D=a(z,!0);r(z),r(h),B(d=>S(D,d),[()=>t.conversation.getUnreadCount()>99?"99+":t.conversation.getUnreadCount()]),o(i,h)};_(Y,i=>{t.conversation.getUnreadCount()>0&&i(q)})}r(x),r(w),r(y),B(()=>S(H,l?.name||l?.displayName||"Anonymous")),o(m,y),X()}se(["click"]);var We=v(`<div class="flex flex-col items-center justify-center py-16 px-6 text-center"><svg class="w-20 h-20 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <h3 class="text-xl font-semibold text-white mb-2">No messages yet</h3> <p class="text-neutral-400 max-w-sm">Start a conversation by visiting someone's profile and clicking the message button</p></div>`),qe=v('<div class="divide-y divide-neutral-800/50"><!></div>');function De(m,t){J(t,!0);var s=qe(),c=a(s);{var l=u=>{var C=We();o(u,C)},y=u=>{var C=R(),w=T(C);de(w,17,()=>t.conversations,p=>p.id,(p,M)=>{Ve(p,{get conversation(){return e(M)}})}),o(u,C)};_(c,u=>{t.conversations.length===0?u(l):u(y,!1)})}r(s),o(m,s),X()}function Ke(m,t,s,c){m.key==="Escape"?t.onClose():m.key==="Enter"&&!e(s)&&c()}var Qe=m=>m.stopPropagation(),Re=v('<div class="flex items-center justify-center py-12"><svg class="w-8 h-8 text-primary animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>'),Ye=v('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-neutral-400">No users found</p> <p class="text-sm text-neutral-600 mt-1">Try a different search term</p></div>'),Fe=(m,t,s)=>t(e(s)),Ge=v('<img class="w-12 h-12 rounded-full object-cover flex-shrink-0"/>'),Je=v('<div class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0"><span class="text-primary font-semibold text-lg"> </span></div>'),Xe=v('<div class="text-sm text-neutral-500 truncate"> </div>'),Ze=v('<div class="text-sm text-neutral-500 truncate"> </div>'),$e=v('<button class="w-full flex items-center gap-3 px-6 py-4 hover:bg-neutral-800 transition-colors text-left"><!> <div class="flex-1 min-w-0"><div class="font-semibold text-white truncate"> </div> <!></div> <svg class="w-5 h-5 text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>'),et=v('<div class="divide-y divide-neutral-800"></div>'),tt=v('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-neutral-400">Search for someone to message</p> <p class="text-sm text-neutral-600 mt-1">Enter a name or paste an npub</p></div>'),rt=v('<div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" role="button" tabindex="-1"><div class="w-full max-w-md bg-neutral-900 border border-neutral-800 rounded-lg shadow-xl" role="dialog" aria-modal="true"><div class="flex items-center justify-between px-6 py-4 border-b border-neutral-800"><h2 class="text-xl font-bold text-white">New Message</h2> <button class="p-2 hover:bg-neutral-800 rounded-lg transition-colors text-neutral-400 hover:text-white"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-6 border-b border-neutral-800"><div class="relative"><input type="text" placeholder="Search by name or paste npub..." class="w-full px-4 py-3 pl-12 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div> <div class="max-h-96 overflow-y-auto"><!></div></div></div>');function at(m,t){J(t,!0);let s=P(""),c=P(!1),l=P(je([])),y=P(null);async function u(){if(!e(s).trim()){f(l,[],!0);return}f(c,!0);try{if(e(s).startsWith("npub")||e(s).startsWith("nprofile"))try{const n=await E.$fetchUser(e(s).trim());n?f(l,[n],!0):f(l,[],!0)}catch(n){console.error("Invalid npub:",n),f(l,[],!0)}else try{const n=await E.$fetchUser(e(s).trim());n?f(l,[n],!0):f(l,[],!0)}catch(n){console.error("Search error:",n),f(l,[],!0)}}catch(n){console.error("Search error:",n),f(l,[],!0)}finally{f(c,!1)}}function C(n){f(y,n,!0),ue(`/messages/${n.npub}`),t.onClose()}let w=null;le(()=>(e(s).trim()?(w&&clearTimeout(w),w=setTimeout(()=>{u()},500)):f(l,[],!0),()=>{w&&clearTimeout(w)}));let p=P(null);le(()=>{t.isOpen&&e(p)&&setTimeout(()=>e(p)?.focus(),100)});var M=R(),H=T(M);{var I=n=>{var x=rt();x.__click=function(...d){t.onClose?.apply(this,d)},x.__keydown=[Ke,t,c,u];var U=a(x);U.__click=[Qe];var V=a(U),Z=k(a(V),2);Z.__click=function(...d){t.onClose?.apply(this,d)},r(V);var W=k(V,2),Y=a(W),q=a(Y);Ne(q),Te(q,d=>f(p,d),()=>e(p)),ve(2),r(Y),r(W);var i=k(W,2),h=a(i);{var z=d=>{var N=Re();o(d,N)},D=d=>{var N=R(),$=T(N);{var fe=A=>{var F=Ye();o(A,F)},me=A=>{var F=R(),pe=T(F);{var xe=L=>{var K=et();de(K,21,()=>e(l),ee=>ee.pubkey,(ee,oe)=>{const j=Ue(()=>e(oe).profile);var G=$e();G.__click=[Fe,C,oe];var ne=a(G);{var ge=b=>{var g=Ge();B(()=>{ce(g,"src",e(j).image),ce(g,"alt",e(j).name||"User")}),o(b,g)},_e=b=>{var g=Je(),O=a(g),re=a(O,!0);r(O),r(g),B(Q=>S(re,Q),[()=>e(j)?.name?.[0]?.toUpperCase()||"?"]),o(b,g)};_(ne,b=>{e(j)?.image?b(ge):b(_e,!1)})}var ie=k(ne,2),te=a(ie),be=a(te,!0);r(te);var ke=k(te,2);{var ye=b=>{var g=Xe(),O=a(g,!0);r(g),B(()=>S(O,e(j).nip05)),o(b,g)},we=b=>{var g=R(),O=T(g);{var re=Q=>{var ae=Ze(),Ce=a(ae,!0);r(ae),B(()=>S(Ce,e(j).about)),o(Q,ae)};_(O,Q=>{e(j)?.about&&Q(re)},!0)}o(b,g)};_(ke,b=>{e(j)?.nip05?b(ye):b(we,!1)})}r(ie),ve(2),r(G),B(()=>S(be,e(j)?.name||e(j)?.displayName||"Anonymous")),o(ee,G)}),r(K),o(L,K)},he=L=>{var K=tt();o(L,K)};_(pe,L=>{e(l).length>0?L(xe):L(he,!1)},!0)}o(A,F)};_($,A=>{e(s).trim()&&e(l).length===0?A(fe):A(me,!1)},!0)}o(d,N)};_(h,d=>{e(c)?d(z):d(D,!1)})}r(i),r(U),r(x),Se(q,()=>e(s),d=>f(s,d)),o(n,x)};_(H,n=>{t.isOpen&&n(I)})}o(m,M),X()}se(["click","keydown"]);function st(m,t){f(t,!0)}var ot=v('<div class="flex flex-col items-center justify-center h-full px-6 text-center"><svg class="w-20 h-20 text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <h3 class="text-xl font-semibold text-foreground mb-2">Sign in required</h3> <p class="text-muted-foreground max-w-sm">Please sign in to view and send direct messages</p></div>'),nt=v('<div class="h-full flex flex-col"><div class="sticky top-0 z-10 bg-background border-b border-border/50 px-4 py-3"><div class="flex items-center justify-between"><h1 class="text-xl font-bold text-foreground">Messages</h1> <button class="p-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-primary" title="New message"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="flex-1 overflow-y-auto"><!></div></div> <!>',1);function xt(m,t){J(t,!0);const s=E.$currentUser;let c=P(!1);var l=nt(),y=T(l),u=a(y),C=a(u),w=k(a(C),2);w.__click=[st,c],r(C),r(u);var p=k(u,2),M=a(p);{var H=x=>{var U=ot();o(x,U)},I=x=>{De(x,{get conversations(){return Ae.conversations}})};_(M,x=>{s?x(I,!1):x(H)})}r(p),r(y);var n=k(y,2);at(n,{get isOpen(){return e(c)},onClose:()=>f(c,!1)}),o(m,l),X()}se(["click"]);export{xt as component};
