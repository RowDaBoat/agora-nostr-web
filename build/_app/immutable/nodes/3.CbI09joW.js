import{f as i,s as te,a,d as kt,c as ue,j as vt,t as ht,i as bt}from"../chunks/CiPFrJr-.js";import{b as ee,x as dt,g as e,s as u,p as gt,e as o,u as _,r,d,y as Ie,t as N,c as ft,f as T,a as st,$ as Gt}from"../chunks/CSbKtK4P.js";import{i as f,p as $t,b as ct,d as Qt}from"../chunks/87vUJtvC.js";import{n as ke,h as je,T as Jt,e as He,f as St,i as q,k as Ye,d as ot,t as ut,m as Xt,o as Zt,N as Be,a1 as Lt,a2 as er,M as tr,j as rr}from"../chunks/D0X4VYcq.js";import{b as Pt}from"../chunks/I2MJeYPS.js";import{l as zt}from"../chunks/Bk0a0VIz.js";import{E as ar,N as or}from"../chunks/Cybom7lU.js";import{A as sr}from"../chunks/BFBlLZUW.js";import{T as lr}from"../chunks/ChQzK9Kk.js";import{g as ir}from"../chunks/BgxlgyeA.js";import{H as At}from"../chunks/D_SIBIBl.js";import{M as nr}from"../chunks/BVXFxIlg.js";import{a as Tt,p as dr}from"../chunks/DzBAiUtV.js";import{c as wt,L as Ft}from"../chunks/BZ_HYA_A.js";import{h as cr,R as vr,c as Ct}from"../chunks/BcBT0am5.js";import{u as Ut}from"../chunks/B6l-2YVB.js";import{M as ur}from"../chunks/DzmEV5EQ.js";import{N as hr,c as gr}from"../chunks/B_cmhmk_.js";import{t as Se}from"../chunks/B0fEDaa-.js";import{D as Et,a as Nt,B as We,b as Bt}from"../chunks/DFMKmhYe.js";import{T as fr}from"../chunks/ClqPSwVo.js";import{U as pr}from"../chunks/CGbTV4zP.js";import{I as mr}from"../chunks/C8b5RDJU.js";import{S as _r}from"../chunks/Do-LTnQB.js";import{R as xr}from"../chunks/1JgFLIq6.js";class br{#e=ee(dt(new Set));get _selectedHashtags(){return e(this.#e)}set _selectedHashtags(n){u(this.#e,n,!0)}get selectedHashtags(){return Array.from(this._selectedHashtags)}get hasFilters(){return this._selectedHashtags.size>0}toggleHashtag(n){const c=n.toLowerCase();this._selectedHashtags.has(c)?this._selectedHashtags.delete(c):this._selectedHashtags.add(c),this._selectedHashtags=new Set(this._selectedHashtags)}addHashtag(n){const c=n.toLowerCase();this._selectedHashtags.has(c)||(this._selectedHashtags.add(c),this._selectedHashtags=new Set(this._selectedHashtags))}removeHashtag(n){const c=n.toLowerCase();this._selectedHashtags.has(c)&&(this._selectedHashtags.delete(c),this._selectedHashtags=new Set(this._selectedHashtags))}clearAll(){this._selectedHashtags.clear(),this._selectedHashtags=new Set}isSelected(n){return this._selectedHashtags.has(n.toLowerCase())}}const Te=new br;var wr=i('<img class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy"/> <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent opacity-60"></div>',1),kr=i('<div class="w-full h-full flex items-center justify-center"><svg class="w-16 h-16 text-primary/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div>'),yr=i('<p class="text-xs text-muted-foreground"><!></p>'),Mr=i('<a class="group block flex-shrink-0 w-[280px] h-[360px] rounded-2xl overflow-hidden bg-card hover:bg-muted transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl hover:shadow-primary/10"><div class="relative w-full h-48 overflow-hidden bg-gradient-to-br bg-primary/20"><!></div> <div class="p-4 flex flex-col h-[calc(100%-12rem)]"><h3 class="font-bold text-base text-foreground mb-2 line-clamp-2 leading-snug font-serif"> </h3> <p class="text-muted-foreground text-xs mb-3 line-clamp-3 leading-relaxed flex-1"> </p> <div class="flex items-center gap-2 mt-auto pt-2 border-t border-border"><div class="flex-1 min-w-0"><p class="text-xs font-medium text-muted-foreground truncate"> </p> <!></div> <svg class="w-5 h-5 text-primary opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></div></div></a>');function Lr(H,n){gt(n,!0);const c=ke.$fetchUser(()=>n.article.pubkey),h=ke.$fetchProfile(()=>n.article.pubkey),z=_(()=>n.article.title||"Untitled"),B=_(()=>n.article.summary),b=_(()=>n.article.image),Y=_(()=>n.article.published_at||n.article.created_at),A=_(()=>ir(n.article,c)),C=_(()=>h?.name||h?.displayName||"Anonymous"),$=_(()=>{const F=e(B)||n.article.content;return F.slice(0,100)+(F.length>100?"...":"")});var O=Mr(),P=o(O),p=o(P);{var V=F=>{var G=wr(),xe=T(G);Ie(2),N(()=>{je(xe,"src",e(b)),je(xe,"alt",e(z))}),a(F,G)},se=F=>{var G=kr();a(F,G)};f(p,F=>{e(b)?F(V):F(se,!1)})}r(P);var v=d(P,2),m=o(v),le=o(m,!0);r(m);var w=d(m,2),re=o(w,!0);r(w);var ie=d(w,2),ce=o(ie),ve=o(ce),Oe=o(ve,!0);r(ve);var Ue=d(ve,2);{var $e=F=>{var G=yr(),xe=o(G);lr(xe,{get timestamp(){return e(Y)}}),r(G),a(F,G)};f(Ue,F=>{e(Y)&&F($e)})}r(ce),Ie(2),r(ie),r(v),r(O),N(()=>{je(O,"href",e(A)),te(le,e(z)),te(re,e($)),te(Oe,e(C))}),a(H,O),ft()}var Cr=i('<div class="flex items-center justify-center h-[calc(100vh-12rem)] text-muted-foreground">No videos found</div>'),$r=(H,n)=>u(n,!e(n)),Pr=vt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path></svg>'),Rr=vt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>'),jr=i('<p class="text-white text-sm mb-3 line-clamp-3"> </p>'),Hr=i('<div class="relative w-screen snap-start snap-always flex items-center justify-center bg-black" style="height: calc(100dvh - var(--header-height, 132px));"><video class="w-full h-full object-contain" loop playsinline="" preload="auto"><track kind="captions"/></video> <div class="absolute inset-0 pointer-events-none"><div class="absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-center gap-3"><!> <div class="flex-1 min-w-0"><div class="text-white font-semibold text-sm truncate"> </div></div></div></div> <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-auto"><button class="w-12 h-12 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm flex items-center justify-center transition-colors" type="button"><!></button></div> <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-end gap-4"><div class="flex-1 min-w-0 mb-2"><!></div> <div class="flex flex-col items-center gap-4 pb-2"><!></div></div></div></div></div>',2),zr=i('<div class="fixed inset-x-0 bottom-0 overflow-y-scroll snap-y snap-mandatory scrollbar-hide bg-black svelte-znq7e9" style="top: var(--header-height, 132px);"></div>');function Ar(H,n){gt(n,!0);let c=ee(null),h=ee(!0);function z(P){const p=/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi;return P.match(p)||[]}function B(P){const p=P.m,V=P.url;if(p&&p.startsWith("video/"))return"video";if(V){const se=V.split(".").pop()?.toLowerCase();if(["mp4","webm","mov","avi","mkv"].includes(se||""))return"video"}return"other"}const b=_(()=>n.events.flatMap(P=>{const se=P.tags.filter(m=>m[0]==="imeta").map(m=>Jt(m)).filter(m=>m.url&&B(m)==="video").map(m=>({event:P,imeta:m}));return se.length>0?se:z(P.content).map(m=>{const le=m.split(".").pop()?.toLowerCase();return{event:P,imeta:{url:m,m:"video/"+le}}})}));function Y(P){return{destroy(){}}}var A=ue(),C=T(A);{var $=P=>{var p=Cr();a(P,p)},O=P=>{var p=zr();He(p,23,()=>e(b),({event:V,imeta:se},v)=>`${V.id}-${v}`,(V,se)=>{let v=()=>e(se).event,m=()=>e(se).imeta;var le=Hr(),w=o(le);Tt(w,Q=>Y?.());var re=d(w,2),ie=o(re),ce=o(ie),ve=o(ce);St(ve,{get ndk(){return ke},get pubkey(){return v().pubkey},class:"w-10 h-10 rounded-full border-2 border-white"});var Oe=d(ve,2),Ue=o(Oe),$e=o(Ue,!0);r(Ue),r(Oe),r(ce),r(ie);var F=d(ie,2),G=o(F);G.__click=[$r,h];var xe=o(G);{var Ve=Q=>{var ye=Pr();a(Q,ye)},qe=Q=>{var ye=Rr();a(Q,ye)};f(xe,Q=>{e(h)?Q(Ve):Q(qe,!1)})}r(G),r(F);var Ee=d(F,2),Ke=o(Ee),ze=o(Ke),tt=o(ze);{var Ge=Q=>{var ye=jr(),Je=o(ye,!0);r(ye),N(I=>te(Je,I),[()=>v().content.replace(m().url||"","").trim()]),a(Q,ye)};f(tt,Q=>{v().content&&Q(Ge)})}r(ze);var De=d(ze,2),Qe=o(De);ar(Qe,{get event(){return v()},variant:"tiktok"}),r(De),r(Ke),r(Ee),r(re),r(le),N(Q=>{je(w,"src",m().url),w.muted=e(h),te($e,Q),je(G,"aria-label",e(h)?"Unmute":"Mute")},[()=>v().author?.profile?.name||v().author?.npub?.substring(0,8)]),a(V,le)}),r(p),Pt(p,V=>u(c,V),()=>e(c)),a(P,p)};f(C,P=>{e(b).length===0?P($):P(O,!1)})}a(H,A),ft()}kt(["click"]);var Fr=i('<button class="w-full px-3 py-2 text-sm text-left border border-primary rounded-lg bg-primary/5 hover:bg-primary/10 transition-colors mb-4"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span class="text-primary font-medium"> </span></div> <p class="text-xs text-muted-foreground mt-1 ml-6">Press Enter or click to add</p></button>'),Sr=(H,n,c)=>n(c),Tr=i('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Ur=i('<div class="mb-4 flex flex-wrap gap-2"></div>'),Er=i('<div class="flex items-center justify-center py-12"><div class="w-8 h-8 border-4 border-border border-t-primary rounded-full animate-spin"></div></div>'),Nr=i('<div class="text-center py-12"><svg class="w-12 h-12 text-muted-foreground mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> <p class="text-muted-foreground"> </p></div>'),Br=(H,n,c)=>n(c()),Ir=i('<button><span class="font-medium truncate"> </span> <span class="text-xs text-muted-foreground ml-2 flex-shrink-0"> </span></button>'),Or=i('<div class="grid grid-cols-2 gap-2"></div>'),Vr=i('<!> <div class="mb-4"><!></div> <!> <!> <div class="flex-1 overflow-y-auto -mx-6 px-6"><!></div> <div class="flex items-center justify-between pt-4 border-t border-border -mx-6 px-6"><p class="text-xs text-muted-foreground"> </p> <!></div>',1);function Dr(H,n){gt(n,!0);let c=$t(n,"selectedTags",19,()=>[]),h=$t(n,"open",15,!1),z=ee(!1),B=ee(dt([])),b=ee("");const Y=_(()=>{if(!e(b))return e(B);const v=e(b).toLowerCase();return e(B).filter(m=>m.tag.toLowerCase().includes(v))}),A=_(()=>{if(!e(b).trim())return!1;const v=e(b).trim().toLowerCase().replace(/^#/,"");return!e(B).some(m=>m.tag.toLowerCase()===v)&&!c().some(m=>m.toLowerCase()===v)});st(()=>{h()&&e(B).length===0&&C()});async function C(){u(z,!0);try{const v=q.selectedRelay||q.relays.find(re=>re.enabled&&re.read)?.url,m=[{kinds:[1,20,21,22],limit:500}],le=await ke.fetchEvents(m,{cacheUsage:v?Ye.ONLY_RELAY:Ye.CACHE_FIRST,relayUrls:v?[v]:void 0}),w=new _r;for(const re of le){const ie=re.tags.filter(ce=>ce[0]==="t"&&ce[1]);for(const ce of ie){const ve=ce[1].toLowerCase();w.set(ve,(w.get(ve)||0)+1)}}u(B,Array.from(w.entries()).map(([re,ie])=>({tag:re,count:ie})).sort((re,ie)=>ie.count-re.count).slice(0,100),!0)}catch(v){console.error("Failed to fetch popular hashtags:",v)}finally{u(z,!1)}}function $(v){c().includes(v)?n.onTagsChange?.(c().filter(m=>m!==v)):n.onTagsChange?.([...c(),v])}function O(){if(!e(A))return;const v=e(b).trim().toLowerCase().replace(/^#/,"");n.onTagsChange?.([...c(),v]),u(b,"")}function P(v){v.key==="Enter"&&e(A)&&(v.preventDefault(),O())}function p(){h(!1),u(b,""),n.onClose?.()}var V=ue(),se=T(V);ct(se,()=>Bt,(v,m)=>{m(v,{get open(){return h()},onOpenChange:le=>{h(le),le||p()},children:(le,w)=>{var re=ue(),ie=T(re);ct(ie,()=>Et,(ce,ve)=>{ve(ce,{class:"max-w-xl max-h-[80vh] flex flex-col",children:(Oe,Ue)=>{var $e=Vr(),F=T($e);ct(F,()=>Nt,(I,s)=>{s(I,{children:(t,l)=>{Ie();var g=ht("Select Hashtags");a(t,g)},$$slots:{default:!0}})});var G=d(F,2),xe=o(G);mr(xe,{type:"text",onkeydown:P,placeholder:"Search hashtags...",autofocus:!0,get value(){return e(b)},set value(I){u(b,I,!0)}}),r(G);var Ve=d(G,2);{var qe=I=>{var s=Fr();s.__click=O;var t=o(s),l=d(o(t),2),g=o(l);r(l),r(t),Ie(2),r(s),N(K=>te(g,`Add custom tag: #${K??""}`),[()=>e(b).trim().toLowerCase().replace(/^#/,"")]),a(I,s)};f(Ve,I=>{e(A)&&I(qe)})}var Ee=d(Ve,2);{var Ke=I=>{var s=Ur();He(s,20,c,t=>t,(t,l)=>{var g=Tr();g.__click=[Sr,$,l];var K=o(g),ae=o(K);r(K),Ie(2),r(g),N(()=>te(ae,`#${l??""}`)),a(t,g)}),r(s),a(I,s)};f(Ee,I=>{c().length>0&&I(Ke)})}var ze=d(Ee,2),tt=o(ze);{var Ge=I=>{var s=Er();a(I,s)},De=I=>{var s=ue(),t=T(s);{var l=K=>{var ae=Nr(),y=d(o(ae),2),U=o(y,!0);r(y),r(ae),N(()=>te(U,e(b)?"No hashtags found matching your search":"No popular hashtags found")),a(K,ae)},g=K=>{var ae=Or();He(ae,21,()=>e(Y),({tag:y,count:U})=>y,(y,U)=>{let W=()=>e(U).tag,he=()=>e(U).count;const ge=_(()=>c().includes(W()));var R=Ir();R.__click=[Br,$,W];var J=o(R),ne=o(J);r(J);var be=d(J,2),Me=o(be,!0);r(be),r(R),N(()=>{ot(R,1,`flex items-center justify-between px-3 py-2 rounded-lg border transition-colors ${e(ge)?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted"}`),te(ne,`#${W()??""}`),te(Me,he())}),a(y,R)}),r(ae),a(K,ae)};f(t,K=>{e(Y).length===0?K(l):K(g,!1)},!0)}a(I,s)};f(tt,I=>{e(z)?I(Ge):I(De,!1)})}r(ze);var Qe=d(ze,2),Q=o(Qe),ye=o(Q);r(Q);var Je=d(Q,2);We(Je,{onclick:p,children:(I,s)=>{Ie();var t=ht("Done");a(I,t)},$$slots:{default:!0}}),r(Qe),N(()=>te(ye,`${c().length??""} ${c().length===1?"tag":"tags"} selected`)),a(Oe,$e)},$$slots:{default:!0}})}),a(le,re)},$$slots:{default:!0}})}),a(H,V),ft()}kt(["click"]);function Yr(H,n,c=5){const h="0123456789bcdefghjkmnpqrstuvwxyz";let z=0,B=0,b=!0,Y="",A=[-90,90],C=[-180,180];for(;Y.length<c;){if(b){const $=(C[0]+C[1])/2;n>=$?(z|=1<<4-B,C[0]=$):C[1]=$}else{const $=(A[0]+A[1])/2;H>=$?(z|=1<<4-B,A[0]=$):A[1]=$}b=!b,B++,B===5&&(Y+=h[z],B=0,z=0)}return Y}function Kr(H,n){const h=H.target.files;h&&Array.from(h).forEach(z=>n(z))}var Wr=(H,n,c)=>n(e(c)),qr=i("<button></button>"),Gr=i('<div class="absolute bottom-3 left-0 right-0 flex justify-center gap-1"></div>'),Qr=i('<button><img alt="" class="w-full h-full object-cover rounded"/></button>'),Jr=vt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Xr=i('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Zr=i('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg> <!></div>'),ea=vt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'),ta=i('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),ra=i('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <!></div>'),aa=vt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>'),oa=i('<img alt="" class="w-5 h-5 rounded border border-background"/>'),sa=i('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),la=i('<div class="flex items-center -space-x-1"></div>'),ia=i('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),na=i('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),da=(H,n)=>H.key==="Escape"&&n(),ca=H=>H.stopPropagation(),va=H=>H.stopPropagation(),ua=i('<div role="presentation"><div role="dialog" tabindex="-1"><!></div></div>'),ha=(H,n,c)=>n(e(c)),ga=i('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),fa=i('<div class="flex flex-wrap gap-2 items-center"></div>'),pa=(H,n)=>u(n,""),ma=i('<div class="text-sm text-muted-foreground flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span> </span> <button class="ml-1 hover:text-foreground transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),_a=i('<div class="md:grid md:grid-cols-[2fr,3fr] md:h-full"><div class="md:border-r border-border md:p-6 p-0"><div class="relative w-full md:aspect-square md:rounded-lg overflow-hidden bg-black"><img class="w-full h-full object-contain"/> <button title="Remove this image" class="absolute top-2 right-2 p-2 bg-black/60 text-white rounded-full hover:bg-black/80 transition-colors backdrop-blur-sm" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!></div> <div class="hidden md:flex items-center gap-2 overflow-x-auto pb-2 mt-4"><!> <button title="Add more images" class="w-16 h-16 rounded border-2 border-dashed border-border hover:border-primary hover:bg-muted transition-all flex items-center justify-center flex-shrink-0" aria-label="Add more images"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="p-4 md:p-6 space-y-4 md:overflow-auto"><!> <div class="flex items-center gap-1 border-t border-border pt-3"><!> <!> <!> <!> <!> <div class="relative"><!></div></div> <!> <!> <!></div></div>'),xa=(H,n)=>H.key==="Enter"&&n(),ba=i('<p class="text-sm text-muted-foreground"> </p>'),wa=i('<div class="flex flex-col items-center gap-2"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <!></div>'),ka=i('<svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-lg font-medium text-foreground mb-2">Drop images here</p> <p class="text-sm text-muted-foreground">or click to browse</p> <p class="text-xs text-muted-foreground mt-2">Multiple images supported</p>',1),ya=i('<p class="text-xs text-muted-foreground"> </p>'),Ma=i('<div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <p class="text-sm text-muted-foreground">Uploading...</p> <!></div>'),La=i('<svg class="w-16 h-16 text-muted-foreground mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-muted-foreground mb-4">No images selected</p> <!>',1),Ca=i('<div class="hidden md:flex items-center justify-center p-12 h-full"><div role="button" tabindex="0"><!></div></div> <div class="md:hidden flex items-center justify-center p-8 h-full min-h-[60vh]"><div class="text-center"><!></div></div>',1),$a=i('<div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4 border-b border-border bg-background"><button title="Close and discard post" class="text-foreground hover:text-muted-foreground transition-colors" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!> <!></div> <div class="flex-1 overflow-auto"><input type="file" accept="image/*" multiple class="hidden"/> <!></div>',1),Pa=i("<!> <!> <!>",1);function Ra(H,n){gt(n,!0);let c=$t(n,"open",15,!1),h=ee(!1),z=ee(0),B=ee(!1),b=ee(!1),Y=ee(!1),A=ee(""),C=ee(""),$=ee(dt([])),O=ee(dt([])),P=ee(!1),p=ee(dt([])),V,se=ee(!1),v=ee(dt([])),m=ee(!1);const le=new hr(ke),w=gr(le),re=ke.$currentUser,ie=_(()=>Qt&&window.innerWidth<768),ce=_(()=>q.relays.filter(s=>s.enabled));st(()=>{c()&&e(ie)&&e(p).length===0&&setTimeout(()=>{V?.click()},300)}),st(()=>{c()&&(q.selectedRelay?u(v,[q.selectedRelay],!0):e(v).length===0&&u(v,e(ce).filter(s=>s.write).map(s=>s.url),!0))});async function ve(s){if(!s.type.startsWith("image/")){Se.error("Please select an image file");return}try{if(await w.upload(s,{fallbackServer:"https://blossom.primal.net"}),w.result?.url){const t=new Image,l=await new Promise(g=>{t.onload=()=>g({width:t.width,height:t.height}),t.src=URL.createObjectURL(s)});u(p,[...e(p),{url:w.result.url,mimeType:s.type,hash:w.result.sha256||"",blurhash:w.result.blurhash,dimensions:l}],!0),u(z,e(p).length-1)}}catch(t){console.error("Upload failed:",t),Se.error("Failed to upload image")}}function Oe(s){s.preventDefault(),u(se,!0)}function Ue(){u(se,!1)}async function $e(s){s.preventDefault(),u(se,!1);const t=s.dataTransfer?.files;t&&Array.from(t).forEach(l=>ve(l))}function F(){V?.click()}function G(s){u(p,e(p).filter((t,l)=>l!==s),!0),e(z)>=e(p).length&&u(z,Math.max(0,e(p).length-1),!0)}function xe(s){u($,e($).filter(t=>t!==s),!0)}function Ve(s){u($,s,!0)}function qe(s){e(v).includes(s)?u(v,e(v).filter(t=>t!==s),!0):u(v,[...e(v),s],!0)}function Ee(s){u(v,[s],!0),u(B,!1)}function Ke(){u(B,!1)}function ze(){navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const t=s.coords.latitude,l=s.coords.longitude,g=Yr(t,l,5);u(C,`Near ${g}`),Se.success("Location detected")},s=>{console.error("Error getting location:",s),Se.error("Could not get your location")}):Se.error("Geolocation is not supported")}async function tt(){if(!e(A).trim()||e(p).length===0||e(h)){e(p).length===0?Se.error("Please add at least one image"):Se.error("Please add a caption");return}if(!re){Se.error("Please log in to create a media post");return}if(e(v).length===0){Se.error("Please select at least one relay to publish to");return}try{u(h,!0);const s=new Xt(ke);if(s.kind=20,s.content=e(A).trim(),s.isProtected=e(m),e(p).forEach(l=>{const g=["imeta",`url ${l.url}`,`m ${l.mimeType}`];l.hash&&g.push(`x ${l.hash}`),l.blurhash&&g.push(`blurhash ${l.blurhash}`),l.dimensions&&g.push(`dim ${l.dimensions.width}x${l.dimensions.height}`),s.tags.push(g)}),e($).forEach(l=>{s.tags.push(["t",l])}),e(O).forEach(l=>{s.tags.push(["p",l])}),e(C).trim())if(e(C).startsWith("Near ")){const l=e(C).replace("Near ","");for(let g=3;g<=l.length;g++)s.tags.push(["g",l.substring(0,g)])}else s.tags.push(["location",e(C).trim()]);e(P)&&s.tags.push(["content-warning","nsfw"]),await s.sign();const t=Zt.fromRelayUrls(e(v),ke);if(await s.publish(t),s.publishStatus==="error"){const g=s.publishError?.relayErrors||{},K=Object.entries(g).map(([ae,y])=>`${ae}: ${y}`).join(`
`);Se.error(`Failed to publish:
${K||"Unknown error"}`);return}Se.success("Posted!"),Ge(),c(!1),n.onClose?.()}catch(s){console.error("Failed to publish media post:",s),Se.error(`Failed to publish: ${s instanceof Error?s.message:"Unknown error"}`)}finally{u(h,!1)}}function Ge(){u(A,""),u(C,""),u($,[],!0),u(O,[],!0),u(p,[],!0),u(z,0),u(P,!1),u(B,!1),u(b,!1),u(Y,!1)}function De(){e(h)||(Ge(),c(!1),n.onClose?.())}function Qe(s){s.key==="Escape"&&!e(h)&&De()}var Q=Pa();bt("keydown",Gt,Qe);var ye=T(Q);ct(ye,()=>Bt,(s,t)=>{t(s,{get open(){return c()},onOpenChange:l=>{c(l),l||De()},children:(l,g)=>{var K=ue(),ae=T(K);ct(ae,()=>Et,(y,U)=>{U(y,{class:"max-md:!max-w-none max-md:!w-full max-md:!h-[100vh] max-md:!m-0 max-md:!rounded-none max-w-6xl max-h-[90vh] overflow-hidden flex flex-col p-0",children:(W,he)=>{var ge=$a(),R=T(ge),J=o(R);J.__click=De;var ne=d(J,2);ct(ne,()=>Nt,(D,x)=>{x(D,{class:"text-lg md:text-xl font-semibold",children:(M,L)=>{Ie();var X=ht("New Post");a(M,X)},$$slots:{default:!0}})});var be=d(ne,2);{let D=_(()=>!e(A).trim()||e(p).length===0||e(h)||e(v).length===0);We(be,{onclick:tt,get disabled(){return e(D)},size:"sm",class:"h-9 px-4",children:(x,M)=>{Ie();var L=ht();N(()=>te(L,e(h)?"Posting...":"Post")),a(x,L)},$$slots:{default:!0}})}r(R);var Me=d(R,2),oe=o(Me);oe.__change=[Kr,ve],Pt(oe,D=>V=D,()=>V);var Pe=d(oe,2);{var rt=D=>{var x=_a(),M=o(x),L=o(M),X=o(L),de=d(X,2);de.__click=[Wr,G,z];var Re=d(de,2);{var Ae=j=>{var k=Gr();He(k,21,()=>e(p),ut,(E,S,Z)=>{var Ce=qr();Ce.__click=()=>u(z,Z,!0),je(Ce,"title",`View image ${Z+1}`),je(Ce,"aria-label",`View image ${Z+1}`),N(()=>ot(Ce,1,`w-2 h-2 rounded-full transition-all ${e(z)===Z?"bg-white w-6":"bg-white/50"}`)),a(E,Ce)}),r(k),a(j,k)};f(Re,j=>{e(p).length>1&&j(Ae)})}r(L);var Le=d(L,2),pt=o(Le);He(pt,17,()=>e(p),ut,(j,k,E)=>{var S=Qr();S.__click=()=>u(z,E,!0),je(S,"title",`View image ${E+1}`),je(S,"aria-label",`View image ${E+1}`);var Z=o(S);r(S),N(()=>{ot(S,1,`w-16 h-16 rounded border-2 transition-all flex-shrink-0 ${e(z)===E?"border-primary":"border-border"}`),je(Z,"src",e(k).url)}),a(j,S)});var yt=d(pt,2);yt.__click=F,r(Le),r(M);var mt=d(M,2),pe=o(mt);{let j=_(()=>!e(ie));fr(pe,{placeholder:"Write a caption...",rows:4,get autofocus(){return e(j)},class:"resize-none border-0 focus-visible:ring-0 px-3 text-base placeholder:text-muted-foreground",get value(){return e(A)},set value(k){u(A,k,!0)}})}var me=d(pe,2),Xe=o(me);We(Xe,{type:"button",variant:"ghost",size:"icon",onclick:F,get disabled(){return e(h)},title:"Add more images to your post",class:"h-8 w-8",children:(j,k)=>{var E=Jr();a(j,E)},$$slots:{default:!0}});var Ze=d(Xe,2);{let j=_(()=>e($).length>0?"text-primary":"");We(Ze,{type:"button",variant:"ghost",size:"icon",onclick:()=>u(b,!0),get disabled(){return e(h)},title:"Add hashtags to categorize your post and make it discoverable",get class(){return`h-8 w-8 ${e(j)??""}`},children:(k,E)=>{var S=Zr(),Z=d(o(S),2);{var Ce=_e=>{var we=Xr(),at=o(we,!0);r(we),N(()=>te(at,e($).length)),a(_e,we)};f(Z,_e=>{e($).length>0&&_e(Ce)})}r(S),a(k,S)},$$slots:{default:!0}})}var Ne=d(Ze,2);{let j=_(()=>e(C)?"text-primary":"");We(Ne,{type:"button",variant:"ghost",size:"icon",onclick:ze,get disabled(){return e(h)},title:"Add location - uses your device's GPS to tag where this was posted",get class(){return`h-8 w-8 ${e(j)??""}`},children:(k,E)=>{var S=ea();a(k,S)},$$slots:{default:!0}})}var Fe=d(Ne,2);{let j=_(()=>e(O).length>0?"text-primary":"");We(Fe,{type:"button",variant:"ghost",size:"icon",onclick:()=>u(Y,!0),get disabled(){return e(h)},title:"Tag people in this post - they'll be notified",get class(){return`h-8 w-8 ${e(j)??""}`},children:(k,E)=>{var S=ra(),Z=d(o(S),2);{var Ce=_e=>{var we=ta(),at=o(we,!0);r(we),N(()=>te(at,e(O).length)),a(_e,we)};f(Z,_e=>{e(O).length>0&&_e(Ce)})}r(S),a(k,S)},$$slots:{default:!0}})}var lt=d(Fe,2);{let j=_(()=>e(P)?"text-primary":"");We(lt,{type:"button",variant:"ghost",size:"icon",onclick:()=>u(P,!e(P)),get disabled(){return e(h)},title:"Mark as sensitive content (NSFW)",get class(){return`h-8 w-8 ${e(j)??""}`},children:(k,E)=>{var S=aa();a(k,S)},$$slots:{default:!0}})}var Rt=d(lt,2),It=o(Rt);We(It,{type:"button",variant:"ghost",size:"icon",onclick:()=>u(B,!e(B)),get disabled(){return e(h)},title:"Choose which relays to publish this post to",class:"h-8 w-8",children:(j,k)=>{var E=ue(),S=T(E);{var Z=_e=>{var we=la();He(we,21,()=>e(v),ut,(at,Mt)=>{const it=_(()=>e(ce).find(et=>et.url===e(Mt))),nt=_(()=>e(it)?Ut(e(it).url):null);var _t=ue(),Kt=T(_t);{var Wt=et=>{var xt=oa();N(()=>je(xt,"src",e(nt).info.icon)),a(et,xt)},qt=et=>{var xt=sa();a(et,xt)};f(Kt,et=>{e(nt)?.info?.icon?et(Wt):et(qt,!1)})}a(at,_t)}),r(we),a(_e,we)},Ce=_e=>{var we=na(),at=d(o(we),2);{var Mt=it=>{var nt=ia(),_t=o(nt,!0);r(nt),N(()=>te(_t,e(v).length)),a(it,nt)};f(at,it=>{e(v).length>2&&it(Mt)})}r(we),a(_e,we)};f(S,_e=>{e(v).length<=2&&e(v).length>0?_e(Z):_e(Ce,!1)})}a(j,E)},$$slots:{default:!0}}),r(Rt),r(me);var jt=d(me,2);{var Ot=j=>{var k=ua();k.__click=Ke,k.__keydown=[da,Ke];var E=o(k);E.__click=[ca],E.__keydown=[va];var S=o(E);xr(S,{get selectedRelayUrls(){return e(v)},onToggleRelay:qe,onSelectOnly:Ee,get isProtected(){return e(m)},set isProtected(Z){u(m,Z,!0)}}),r(E),r(k),Tt(k,Z=>dr?.(Z)),N(()=>{ot(k,1,`fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity ${e(B)?"opacity-100":"opacity-0"}`),ot(E,1,`bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto transition-all ${e(B)?"scale-100 opacity-100":"scale-95 opacity-0"}`)}),a(j,k)};f(jt,j=>{e(B)&&j(Ot)})}var Ht=d(jt,2);{var Vt=j=>{var k=fa();He(k,21,()=>e($),ut,(E,S)=>{var Z=ga();Z.__click=[ha,xe,S];var Ce=o(Z),_e=o(Ce);r(Ce),Ie(2),r(Z),N(()=>te(_e,`#${e(S)??""}`)),a(E,Z)}),r(k),a(j,k)};f(Ht,j=>{e($).length>0&&j(Vt)})}var Dt=d(Ht,2);{var Yt=j=>{var k=ma(),E=d(o(k),2),S=o(E,!0);r(E);var Z=d(E,2);Z.__click=[pa,C],r(k),N(()=>te(S,e(C))),a(j,k)};f(Dt,j=>{e(C)&&j(Yt)})}r(mt),r(x),N(()=>{je(X,"src",e(p)[e(z)].url),je(X,"alt",`Image ${e(z)+1}`)}),a(D,x)},fe=D=>{var x=Ca(),M=T(x),L=o(M);L.__click=F,L.__keydown=[xa,F];var X=o(L);{var de=pe=>{var me=wa(),Xe=d(o(me),2);{var Ze=Ne=>{var Fe=ba(),lt=o(Fe);r(Fe),N(()=>te(lt,`${w.progress.percentage??""}%`)),a(Ne,Fe)};f(Xe,Ne=>{w.progress&&Ne(Ze)})}r(me),a(pe,me)},Re=pe=>{var me=ka();Ie(6),a(pe,me)};f(X,pe=>{w.status==="uploading"?pe(de):pe(Re,!1)})}r(L),r(M);var Ae=d(M,2),Le=o(Ae),pt=o(Le);{var yt=pe=>{var me=Ma(),Xe=d(o(me),4);{var Ze=Ne=>{var Fe=ya(),lt=o(Fe);r(Fe),N(()=>te(lt,`${w.progress.percentage??""}%`)),a(Ne,Fe)};f(Xe,Ne=>{w.progress&&Ne(Ze)})}r(me),a(pe,me)},mt=pe=>{var me=La(),Xe=d(T(me),4);We(Xe,{onclick:F,children:(Ze,Ne)=>{Ie();var Fe=ht("Choose Photos");a(Ze,Fe)},$$slots:{default:!0}}),a(pe,me)};f(pt,pe=>{w.status==="uploading"?pe(yt):pe(mt,!1)})}r(Le),r(Ae),N(()=>ot(L,1,`w-full max-w-md aspect-square rounded-lg border-2 border-dashed border-border hover:border-primary hover:bg-muted/50 transition-all flex flex-col items-center justify-center cursor-pointer ${e(se)?"border-primary bg-muted/50":""} ${w.status==="uploading"?"pointer-events-none":""}`)),bt("dragover",L,Oe),bt("dragleave",L,Ue),bt("drop",L,$e),a(D,x)};f(Pe,D=>{e(p).length>0?D(rt):D(fe,!1)})}r(Me),N(()=>J.disabled=e(h)),a(W,ge)},$$slots:{default:!0}})}),a(l,K)},$$slots:{default:!0}})});var Je=d(ye,2);Dr(Je,{get selectedTags(){return e($)},onTagsChange:Ve,get open(){return e(b)},set open(s){u(b,s,!0)}});var I=d(Je,2);pr(I,{buttonClass:"hidden",iconOnly:!1,get open(){return e(Y)},set open(s){u(Y,s,!0)},get selectedPubkeys(){return e(O)},set selectedPubkeys(s){u(O,s,!0)}}),a(H,Q),ft()}kt(["click","change","keydown"]);var ja=(H,n)=>Te.toggleHashtag(e(n)),Ha=i('<button><span class="text-xs">#</span> <span> </span></button>'),za=()=>Te.clearAll(),Aa=i('<button class="flex-shrink-0 inline-flex items-center gap-1 px-2 py-1.5 rounded-full text-xs font-medium bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all" title="Clear all filters"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Fa=i("<!> <!>",1),Sa=vt(`<svg viewBox="0 0 575 250" class="h-8 w-auto" xmlns="http://www.w3.org/2000/svg"><style>.st1{fill:#FFFFFF;}</style><g><path class="st1" d="M123.9,165.4v-0.9c3.6-0.3,6.4-1.1,8.4-2.4c2-1.3,3.5-3.2,4.7-5.8l24.2-54.9h3.8l28.5,57.6
                c0.7,1.4,1.7,2.6,3.2,3.6c1.4,1,3.6,1.6,6.4,1.9v0.9h-27.7v-0.9c2.9-0.3,4.7-0.9,5.4-1.9c0.8-1,0.8-2.2,0.1-3.6l-21.5-44.6
                L141,156.3c-1.1,2.6-0.9,4.5,0.5,5.8c1.4,1.3,3.9,2.1,7.6,2.4v0.9H123.9z M163.1,87.7h8.8l-7.8,9.2h-3L163.1,87.7z"></path><path class="st1" d="M248.3,135.2c0-1.5-0.6-2.7-1.8-3.7c-1.2-0.9-3.3-1.5-6.1-1.8v-0.9H268v0.9c-2.9,0.3-4.9,0.9-6.1,1.8
                c-1.2,0.9-1.8,2.1-1.8,3.7v32.9c0,1.5,0.6,2.7,1.8,3.7c1.2,0.9,3.3,1.5,6.1,1.8v0.9h-29v-0.9c3.5-0.3,5.9-0.9,7.2-1.8
                c1.3-0.9,2-2.1,2-3.7v-11.1c-1.5,2.9-3.7,5.2-6.7,6.7c-2.9,1.6-6.8,2.3-11.5,2.3c-4.5,0-8.7-0.7-12.3-2.2c-3.7-1.5-6.8-3.6-9.4-6.4
                c-2.6-2.8-4.6-6.2-6-10.2c-1.4-4-2.1-8.6-2.1-13.6c0-5.1,0.7-9.6,2.2-13.7c1.5-4.1,3.7-7.5,6.6-10.4c2.9-2.9,6.5-5.1,10.9-6.7
                c4.4-1.6,9.4-2.3,15.1-2.3c3.8,0,7.5,0.3,11.2,1c3.7,0.7,7.2,1.7,10.6,3v15.6h-1.3c-1.1-2.5-2.3-4.8-3.7-6.8c-1.4-2-3-3.8-4.7-5.3
                c-1.8-1.5-3.7-2.6-5.9-3.4c-2.2-0.8-4.6-1.2-7.3-1.2c-3.6,0-6.8,0.7-9.5,2.1c-2.7,1.4-4.9,3.4-6.7,6c-1.8,2.6-3.2,5.7-4,9.3
                c-0.9,3.6-1.3,7.7-1.3,12.2c0,9.2,1.8,16.2,5.5,20.8c3.7,4.7,8.6,7,14.6,7c4.8,0,8.5-1.6,11.3-4.8c2.7-3.2,4.2-8.5,4.5-15.8V135.2z
                "></path><path class="st1" d="M370.2,101.4c12.3,0,21.4,1.4,27.3,4.3c5.8,2.9,8.8,6.9,8.8,12.1c0,3.8-1.6,7.1-4.7,9.7
                c-3.2,2.6-8,4.5-14.7,5.6l19,25.9c0.9,1.3,2.2,2.4,3.8,3.5c1.6,1,3.8,1.7,6.7,2v0.9h-27.7v-0.9c2.9-0.3,4.5-1,4.8-2
                c0.3-1,0-2.2-0.9-3.5l-17.9-24.8c-0.7,0.1-1.4,0.1-2.1,0.1c-0.8,0-1.5,0-2.3,0h-7.1V159c0,1.5,0.6,2.7,1.8,3.7
                c1.2,0.9,3.3,1.5,6.1,1.8v0.9h-27.7v-0.9c2.9-0.3,4.9-0.9,6.1-1.8c1.2-0.9,1.8-2.1,1.8-3.7v-51.2c0-1.5-0.6-2.7-1.8-3.7
                c-1.2-0.9-3.3-1.5-6.1-1.8v-0.9H370.2z M370.2,131.6c8.2,0,14.3-1.2,18.1-3.5c3.8-2.3,5.7-5.7,5.7-10.2c0-4.5-1.9-7.9-5.7-10.2
                c-3.8-2.3-9.8-3.5-18.1-3.5h-7.1v27.5H370.2z"></path><path class="st1" d="M418.9,165.4v-0.9c3.6-0.3,6.4-1.1,8.4-2.4c2-1.3,3.5-3.2,4.7-5.8l24.2-54.9h3.8l28.5,57.6
                c0.7,1.4,1.7,2.6,3.2,3.6c1.4,1,3.6,1.6,6.4,1.9v0.9h-27.7v-0.9c2.9-0.3,4.7-0.9,5.4-1.9c0.8-1,0.8-2.2,0.1-3.6l-21.5-44.6
                L436,156.3c-1.1,2.6-0.9,4.5,0.5,5.8c1.4,1.3,3.9,2.1,7.6,2.4v0.9H418.9z"></path><path class="st1" d="M335.1,120c-1.5-4-3.7-7.5-6.5-10.3c-2.8-2.9-6.2-5.1-10.1-6.6c-4-1.6-8.4-2.3-13.4-2.3
                c-4.9,0-9.3,0.8-13.3,2.3c-4,1.6-7.4,3.8-10.2,6.6c-2.8,2.9-5,6.3-6.5,10.3c-1.5,4-2.3,8.5-2.3,13.5s0.8,9.4,2.3,13.5
                c1.5,4,3.7,7.5,6.5,10.3c2.8,2.9,6.2,5.1,10.2,6.6c4,1.6,8.4,2.3,13.3,2.3c5,0,9.4-0.8,13.4-2.3c3.9-1.6,7.3-3.8,10.1-6.6
                c2.8-2.9,5-6.3,6.5-10.3c1.5-4,2.3-8.5,2.3-13.5S336.6,124,335.1,120z M305,163.4c-12.4,0-20.9-13.4-20.9-30s8.2-30,20.9-30
                c13,0,20.9,13.4,20.9,30S318,163.4,305,163.4z"></path></g></svg>`),Ta=i('<h1 class="text-xl font-bold text-foreground"> </h1>'),Ua=i('<div class="p-8 text-center text-muted-foreground">No articles found</div>'),Ea=i('<div class="p-8 text-center text-muted-foreground">Loading articles...</div>'),Na=i('<div class="snap-start snap-always"><!></div>'),Ba=i('<div class="py-6 border-b border-border"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2 px-4"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg> Featured</h2> <div class="overflow-x-auto overflow-y-hidden scrollbar-hide snap-x snap-mandatory touch-pan-x"><div class="flex gap-4 px-4 pb-2"></div></div></div>'),Ia=i('<div class="min-w-0"><!></div>'),Oa=i('<div class="px-4 py-6 border-b border-border"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> Recent Highlights</h2> <div class="grid grid-cols-2 gap-4 w-full"></div></div>'),Va=i('<div class="px-4 py-6"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg> Latest Articles</h2> <div class="divide-y divide-neutral-800/50 -mx-4"></div></div>'),Da=i("<!> <!> <!>",1),Ya=i('<div class="pb-6"><!></div> <!>',1),Ka=i('<div class="p-8 text-center text-muted-foreground">No videos found</div>'),Wa=i('<div class="p-8 text-center text-muted-foreground">Loading videos...</div>'),qa=i('<div class="p-8 text-center text-muted-foreground">No images found</div>'),Ga=i('<div class="p-8 text-center text-muted-foreground">Loading images...</div>'),Qa=i('<div class="p-4"><!></div>'),Ja=(H,n)=>n.loadPendingEvents(),Xa=i('<div class="flex justify-center py-2 lg:relative lg:static fixed bottom-20 left-0 right-0 z-[500] lg:z-auto pointer-events-none"><button class="flex items-center gap-2 px-4 py-2 bg-neutral-900/95 hover:bg-muted border border-primary/50 lg:border-border rounded-full transition-all shadow-lg backdrop-blur-sm pointer-events-auto"><div class="flex -space-x-2"></div> <span class="text-sm text-primary lg:text-foreground font-medium"> </span></button></div>'),Za=i('<div class="p-8 text-center text-muted-foreground">No notes found</div>'),eo=i("<!> <!> <!>",1),to=i('<div class="max-w-full mx-auto"><div class="sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border"><div class="px-4 py-4 max-sm:w-screen"><div class="flex items-center gap-2"><div class="flex-shrink-0 relative z-20"><!></div> <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide flex-1 min-w-0"><!></div></div></div> <!></div> <div class="divide-y divide-neutral-800/50"><!></div></div> <!>',1);function Po(H,n){gt(n,!0);let c=ee("conversations");st(()=>{cr.set(e(c))});const h=_(()=>er(q.selectedRelay,q.relays.filter(t=>t.enabled&&t.read).map(t=>t.url))),z=_(()=>ke.$sessions?.follows||[]),B=_(()=>Array.from(e(z)));function b(t){return t?.startsWith("followpack:")??!1}let Y=ee(null);st(()=>{if(!q.selectedRelay||!b(q.selectedRelay)){u(Y,null);return}const t=q.selectedRelay.replace("followpack:","");ke.fetchEvent(t).then(l=>{u(Y,l,!0)}).catch(l=>{console.error("Failed to fetch selected pack:",l),u(Y,null)})});const A=_(()=>e(Y)?e(Y).tags.filter(t=>t[0]==="p").map(t=>t[1]):q.selectedRelay?[]:e(B));console.log("[HomePage] Creating subscriptions");const C=wt(ke,()=>{const t={kinds:[Be.Text,9802],limit:200};return Te.hasFilters&&(t["#t"]=Te.selectedHashtags),(!q.selectedRelay||b(q.selectedRelay))&&e(A).length>0&&(t.authors=e(A)),console.log("Using filter:",t,"relays:",e(h)),{filters:[t],relayUrls:e(h).length>0?e(h):void 0,subId:"notes",cacheUsage:e(h).length>0?Ye.ONLY_RELAY:Ye.PARALLEL,exclusiveRelay:e(h).length>0}},{initialLimit:20,pageSize:20});console.log("[HomePage] Notes subscription created");const $=wt(ke,()=>{const t={kinds:[Be.Text,Be.Image,Be.Video,Be.ShortVideo,22],limit:300};return Te.hasFilters&&(t["#t"]=Te.selectedHashtags),(!q.selectedRelay||b(q.selectedRelay))&&e(A).length>0&&(t.authors=e(A)),{filters:[t],relayUrls:e(h).length>0?e(h):void 0,cacheUsage:e(h).length>0?Ye.ONLY_RELAY:Ye.PARALLEL,subId:"home-media",exclusiveRelay:e(h).length>0}},{initialLimit:30,pageSize:30}),O=wt(ke,()=>{const t={kinds:[Be.Article],limit:100};return Te.hasFilters&&(t["#t"]=Te.selectedHashtags),(!q.selectedRelay||b(q.selectedRelay))&&e(A).length>0&&(t.authors=e(A)),{filters:[t],cacheUsage:e(h).length>0?Ye.ONLY_RELAY:Ye.PARALLEL,subId:"articles",exclusiveRelay:e(h).length>0,relayUrls:e(h).length>0?e(h):void 0}},{initialLimit:10,pageSize:10}),P=wt(ke,()=>{const t={kinds:[9802],limit:100};return Te.hasFilters&&(t["#t"]=Te.selectedHashtags),(!q.selectedRelay||b(q.selectedRelay))&&e(A).length>0&&(t.authors=e(A)),{filters:[t],cacheUsage:e(h).length>0?Ye.ONLY_RELAY:Ye.PARALLEL,subId:"highlights",exclusiveRelay:e(h).length>0,relayUrls:e(h).length>0?e(h):void 0}},{initialLimit:10,pageSize:10}),p=_(()=>O.events.map(t=>rr.from(t))),V=_(()=>e(p).filter(t=>t.title&&t.content).sort((t,l)=>(l.published_at??l.created_at??0)-(t.published_at??t.created_at??0))),se=_(()=>{const t=e(V).filter(g=>g.image),l=e(V).filter(g=>!g.image);return[...t,...l].slice(0,10)}),v=_(()=>P.events.slice(0,10)),m=_(()=>e(V).slice(10));function le(t,l){return(l==="image"?/(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|avif))/gi:/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi).test(t)}const w=_(()=>e(c)==="images"?$.events.filter(t=>t.kind===Be.Image||t.kind===Be.Text&&le(t.content,"image")):e(c)==="videos"?$.events.filter(t=>t.kind===Be.Video||t.kind===Be.ShortVideo||t.kind===22||t.kind===Be.Text&&le(t.content,"video")):[]),re=_(()=>e(c)==="articles"?[]:C.events),ie=_(()=>e(c)==="articles"?O.hasMore:C.hasMore),ce=_(()=>e(c)==="articles"?O.isLoading:C.isLoading);function ve(){e(c)==="articles"?O.loadMore():C.loadMore()}const Oe=_(()=>{const t=new Set,l=C.pendingEvents;for(const g of l){if(t.size>=3)break;t.add(g.pubkey)}return Array.from(t)}),Ue=_(()=>Lt.interests.length>0?null:tr(q.selectedRelay)||!q.selectedRelay?{type:"logo"}:b(q.selectedRelay)&&e(Y)?{type:"text",text:e(Y).tagValue("title")||"Untitled Pack"}:{type:"text",text:Ut(q.selectedRelay).info?.name||q.selectedRelay.replace("wss://","").replace("ws://","")});st(()=>{e(c)==="articles"?zt.setReadsMode():zt.reset()});let $e=ee(null);st(()=>{if(!e($e))return;const t=()=>{const l=e($e).offsetHeight;document.documentElement.style.setProperty("--header-height",`${l}px`)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}});var F=to(),G=T(F),xe=o(G),Ve=o(xe),qe=o(Ve),Ee=o(qe),Ke=o(Ee);vr(Ke,{iconOnly:!0}),r(Ee);var ze=d(Ee,2),tt=o(ze);{var Ge=t=>{var l=Fa(),g=T(l);He(g,17,()=>Lt.interests,ut,(y,U)=>{var W=Ha();W.__click=[ja,U];var he=d(o(W),2),ge=o(he,!0);r(he),r(W),N(R=>{ot(W,1,`flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all ${R??""}`),te(ge,e(U))},[()=>Te.isSelected(e(U))?"bg-primary text-foreground border-2 border-primary-400":"bg-muted text-muted-foreground border-2 border-border hover:border"]),a(y,W)});var K=d(g,2);{var ae=y=>{var U=Aa();U.__click=[za],a(y,U)};f(K,y=>{Te.hasFilters&&y(ae)})}a(t,l)},De=t=>{var l=ue(),g=T(l);{var K=y=>{var U=Sa();a(y,U)},ae=y=>{var U=ue(),W=T(U);{var he=ge=>{var R=Ta(),J=o(R,!0);r(R),N(()=>te(J,e(Ue).text)),a(ge,R)};f(W,ge=>{e(Ue)&&ge(he)},!0)}a(y,U)};f(g,y=>{e(Ue)?.type==="logo"?y(K):y(ae,!1)},!0)}a(t,l)};f(tt,t=>{Lt.interests.length>0?t(Ge):t(De,!1)})}r(ze),r(qe),r(Ve);var Qe=d(Ve,2);ur(Qe,{get selectedFilter(){return e(c)},onFilterChange:t=>u(c,t,!0)}),r(xe),Pt(xe,t=>u($e,t),()=>e($e));var Q=d(xe,2),ye=o(Q);{var Je=t=>{var l=Ya(),g=T(l),K=o(g);{var ae=W=>{var he=Ua();a(W,he)},y=W=>{var he=ue(),ge=T(he);{var R=ne=>{var be=Ea();a(ne,be)},J=ne=>{var be=Da(),Me=T(be);{var oe=x=>{var M=Ba(),L=d(o(M),2),X=o(L);He(X,21,()=>e(se),de=>de.id,(de,Re)=>{var Ae=Na(),Le=o(Ae);Lr(Le,{get article(){return e(Re)}}),r(Ae),a(de,Ae)}),r(X),r(L),r(M),a(x,M)};f(Me,x=>{e(se).length>0&&x(oe)})}var Pe=d(Me,2);{var rt=x=>{var M=Oa(),L=d(o(M),2);He(L,21,()=>e(v),X=>X.id,(X,de)=>{var Re=Ia(),Ae=o(Re);At(Ae,{get event(){return e(de)},variant:"grid"}),r(Re),a(X,Re)}),r(L),r(M),a(x,M)};f(Pe,x=>{e(v).length>0&&x(rt)})}var fe=d(Pe,2);{var D=x=>{var M=Va(),L=d(o(M),2);He(L,21,()=>e(m),X=>X.id,(X,de)=>{sr(X,{get article(){return e(de)}})}),r(L),r(M),a(x,M)};f(fe,x=>{e(m).length>0&&x(D)})}a(ne,be)};f(ge,ne=>{e(V).length===0?ne(R):ne(J,!1)},!0)}a(W,he)};f(K,W=>{e(V).length===0&&O.eosed?W(ae):W(y,!1)})}r(g);var U=d(g,2);Ft(U,{onIntersect:ve,get hasMore(){return O.hasMore},get isLoading(){return O.isLoading}}),a(t,l)},I=t=>{var l=ue(),g=T(l);{var K=y=>{var U=ue(),W=T(U);{var he=R=>{var J=Ka();a(R,J)},ge=R=>{var J=ue(),ne=T(J);{var be=oe=>{var Pe=Wa();a(oe,Pe)},Me=oe=>{Ar(oe,{get events(){return e(w)}})};f(ne,oe=>{e(w).length===0?oe(be):oe(Me,!1)},!0)}a(R,J)};f(W,R=>{e(w).length===0&&$.eosed?R(he):R(ge,!1)})}a(y,U)},ae=y=>{var U=ue(),W=T(U);{var he=R=>{var J=Qa(),ne=o(J);{var be=oe=>{var Pe=qa();a(oe,Pe)},Me=oe=>{var Pe=ue(),rt=T(Pe);{var fe=x=>{var M=Ga();a(x,M)},D=x=>{nr(x,{get events(){return e(w)}})};f(rt,x=>{e(w).length===0?x(fe):x(D,!1)},!0)}a(oe,Pe)};f(ne,oe=>{e(w).length===0&&$.eosed?oe(be):oe(Me,!1)})}r(J),a(R,J)},ge=R=>{var J=eo(),ne=T(J);{var be=fe=>{var D=Xa(),x=o(D);x.__click=[Ja,C];var M=o(x);He(M,20,()=>e(Oe).slice(0,3),de=>de,(de,Re)=>{St(de,{get ndk(){return ke},get pubkey(){return Re},class:"w-6 h-6 rounded-full border-2 border-foreground"})}),r(M);var L=d(M,2),X=o(L);r(L),r(x),r(D),N(()=>te(X,`${C.pendingCount??""} new ${C.pendingCount===1?"note":"notes"}`)),a(fe,D)};f(ne,fe=>{C.pendingCount>0&&fe(be)})}var Me=d(ne,2);{var oe=fe=>{var D=Za();a(fe,D)},Pe=fe=>{var D=ue(),x=T(D);He(x,17,()=>e(re),M=>M.id,(M,L)=>{var X=ue(),de=T(X);{var Re=Le=>{At(Le,{get event(){return e(L)},variant:"feed"})},Ae=Le=>{or(Le,{get event(){return e(L)}})};f(de,Le=>{e(L).kind===9802?Le(Re):Le(Ae,!1)})}a(M,X)}),a(fe,D)};f(Me,fe=>{e(re).length===0?fe(oe):fe(Pe,!1)})}var rt=d(Me,2);Ft(rt,{onIntersect:ve,get hasMore(){return e(ie)},get isLoading(){return e(ce)}}),a(R,J)};f(W,R=>{e(c)==="images"?R(he):R(ge,!1)},!0)}a(y,U)};f(g,y=>{e(c)==="videos"?y(K):y(ae,!1)},!0)}a(t,l)};f(ye,t=>{e(c)==="articles"?t(Je):t(I,!1)})}r(Q),r(G);var s=d(G,2);Ra(s,{onClose:()=>Ct.close(),get open(){return Ct.show},set open(t){Ct.show=t}}),a(H,F),ft()}kt(["click"]);export{Po as component};
