import{f as u,c as te,a as s,s as B,d as Te}from"../chunks/DNmf0A2m.js";import{p as ke,u as pe,s as h,a as D,e as r,f as E,d as v,g as e,r as t,t as C,c as we,b as J}from"../chunks/DpkVnRja.js";import{i as b}from"../chunks/Btb_Ey2R.js";import{e as Fe}from"../chunks/DD8s4tVe.js";import{a as ee,c as xe}from"../chunks/Ci0hv7jC.js";import{s as He,a as Se}from"../chunks/DyCGT0HY.js";import{n as q,a as Ge,N as Je}from"../chunks/QTLWRGLp.js";import{p as Oe}from"../chunks/Uk33IviR.js";import{g as Qe}from"../chunks/BFZgCa8b.js";import{t as he}from"../chunks/BHGJODx2.js";import{f as Ae}from"../chunks/DGDGar-n.js";import{c as ie}from"../chunks/DJ8nsMRq.js";import{U as ve}from"../chunks/BYRURnlO.js";import{A as Ve,N as We}from"../chunks/DiXitoXJ.js";import{C as Xe}from"../chunks/B1ISCy5e.js";import{c as L}from"../chunks/CSx53_lc.js";import{p as de}from"../chunks/f_qAQkK6.js";import{F as Ye}from"../chunks/CV9zymzg.js";import{f as Ze}from"../chunks/KSN4Ur19.js";import{F as me}from"../chunks/RiWhrYJz.js";import{g as $e}from"../chunks/DSAIpCcp.js";var et=u('<p class="text-sm text-muted-foreground truncate"> </p>'),tt=u('<a class="block group"><h4 class="font-semibold text-foreground group-hover:text-primary transition-colors truncate"> </h4> <!></a>'),rt=u('<p class="text-sm text-muted-foreground truncate"> </p>'),at=u('<h4 class="font-semibold text-foreground truncate"> </h4> <!>',1),ot=u("<span> </span>"),st=u("<span>â€¢</span>"),lt=u('<!> <span>Invited by <a class="text-primary hover:underline"> </a></span>',1),nt=u('<div class="flex items-center gap-2 mt-1 text-xs text-muted-foreground"><!> <!></div>'),it=u('<p class="mt-2 text-sm text-foreground/80 line-clamp-2"> </p>'),dt=u('<div class="flex-shrink-0"><!></div>'),vt=u('<div><!> <div class="flex-1 min-w-0"><div class="flex items-start justify-between gap-2"><div class="flex-1 min-w-0"><!> <!> <!></div> <!></div></div></div>');function ut(re,n){ke(n,!0);let ae=de(n,"showFollow",3,!0),R=de(n,"showAbout",3,!0),O=de(n,"clickable",3,!0),Q=de(n,"class",3,"");console.log("called usercard with",{pubkey:n.pubkey});let w=D(void 0),g=D(null),c=D(void 0),j=D(null);pe(()=>{q.fetchUser(n.pubkey).then(a=>{h(w,a,!0),a?.fetchProfile().then(l=>{h(g,l,!0)})})}),pe(()=>{if(!n.inviterPubkey){h(c,void 0),h(j,null);return}q.fetchUser(n.inviterPubkey).then(a=>{h(c,a,!0),a?.fetchProfile().then(l=>{h(j,l,!0)})})});var _=vt(),I=r(_);L(I,()=>ve.Root,(a,l)=>{l(a,{get ndk(){return q},get pubkey(){return n.pubkey},children:(p,F)=>{var P=te(),o=E(P);L(o,()=>ve.Avatar,(i,d)=>{d(i,{class:"w-12 h-12 rounded-full"})}),s(p,P)},$$slots:{default:!0}})});var M=v(I,2),T=r(M),U=r(T),z=r(U);{var V=a=>{var l=tt(),p=r(l),F=r(p,!0);t(p);var P=v(p,2);{var o=i=>{var d=et(),k=r(d,!0);t(d),C(()=>B(k,e(g).nip05)),s(i,d)};b(P,i=>{e(g)?.nip05&&i(o)})}t(l),C(()=>{xe(l,"href",`/p/${e(w).npub??""}`),B(F,e(g)?.displayName||e(g)?.name||"Anon")}),s(a,l)},W=a=>{var l=at(),p=E(l),F=r(p,!0);t(p);var P=v(p,2);{var o=i=>{var d=rt(),k=r(d,!0);t(d),C(()=>B(k,e(g).nip05)),s(i,d)};b(P,i=>{e(g)?.nip05&&i(o)})}C(()=>B(F,e(g)?.displayName||e(g)?.name||"Anon")),s(a,l)};b(z,a=>{O()?a(V):a(W,!1)})}var X=v(z,2);{var Y=a=>{var l=nt(),p=r(l);{var F=i=>{var d=ot(),k=r(d);t(d),C(K=>B(k,`Joined ${K??""}`),[()=>Ze(n.joinedAt)]),s(i,d)};b(p,i=>{n.joinedAt&&i(F)})}var P=v(p,2);{var o=i=>{var d=lt(),k=E(d);{var K=le=>{var S=st();s(le,S)};b(k,le=>{n.joinedAt&&le(K)})}var A=v(k,2),N=v(r(A)),se=r(N,!0);t(N),t(A),C(()=>{xe(N,"href",`/p/${e(c)?.npub??""}`),B(se,e(j).displayName||e(j).name||"someone")}),s(i,d)};b(P,i=>{n.inviterPubkey&&e(j)&&i(o)})}t(l),s(a,l)};b(X,a=>{(n.joinedAt||n.inviterPubkey)&&a(Y)})}var y=v(X,2);{var x=a=>{var l=it(),p=r(l,!0);t(l),C(()=>B(p,e(g).about)),s(a,l)};b(y,a=>{R()&&e(g)?.about&&a(x)})}t(U);var H=v(U,2);{var oe=a=>{var l=dt(),p=r(l);Ye(p,{get ndk(){return q},get target(){return n.pubkey}}),t(l),s(a,l)};b(H,a=>{ae()&&a(oe)})}t(T),t(M),t(_),C(()=>ee(_,1,`flex items-start gap-3 p-4 bg-card rounded-lg border border-border hover:border-primary/30 transition-colors ${Q()??""}`)),s(re,_),we()}var ct=u('<div class="flex items-center gap-2 text-xs opacity-70 mb-auto"><!> <!></div>'),ft=u('<button data-follow-pack-hero="" type="button"><!> <div class="absolute inset-0 z-[5] bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div> <div class="absolute inset-0 z-10 h-full flex flex-col p-8 text-white text-left"><div class="space-y-4 flex flex-col h-full justify-end"><!> <!> <div class="flex items-center gap-4 text-sm"><!> <!></div></div></div></button>');function mt(re,n){ke(n,!0);let ae=de(n,"class",3,"");const R=$e(n.ndk);var O=te(),Q=E(O);L(Q,()=>me.Root,(w,g)=>{g(w,{get ndk(){return R},get followPack(){return n.followPack},get onclick(){return n.onclick},children:(c,j)=>{var _=ft(),I=r(_);L(I,()=>me.Image,(y,x)=>{x(y,{class:"absolute inset-0 w-full h-full z-0",showGradient:!0})});var M=v(I,4),T=r(M),U=r(T);L(U,()=>me.Title,(y,x)=>{x(y,{class:"text-4xl font-bold text-left",lines:2})});var z=v(U,2);L(z,()=>me.Description,(y,x)=>{x(y,{class:"text-base max-w-2xl text-left",maxLength:200,lines:2})});var V=v(z,2),W=r(V);Ve(W,{get ndk(){return R},get pubkeys(){return n.followPack.pubkeys},max:5,size:32,spacing:"loose"});var X=v(W,2);{var Y=y=>{var x=te(),H=E(x);L(H,()=>ve.Root,(oe,a)=>{a(oe,{get ndk(){return R},get user(){return n.followPack.author},class:"flex-1 flex flex-col items-end",children:(l,p)=>{var F=ct(),P=r(F);L(P,()=>ve.Avatar,(i,d)=>{d(i,{class:"w-5 h-5"})});var o=v(P,2);L(o,()=>ve.Name,(i,d)=>{d(i,{class:"text-xs"})}),t(F),s(l,F)},$$slots:{default:!0}})}),s(y,x)};b(X,y=>{n.followPack.author&&y(Y)})}t(V),t(T),t(M),t(_),C(()=>ee(_,1,`group relative w-full h-[400px] rounded-3xl overflow-hidden bg-card hover:shadow-2xl transition-shadow ${ae()??""}`)),s(c,_)},$$slots:{default:!0}})}),s(re,O),we()}var pt=u('<button class="flex items-center gap-2 px-4 py-2 bg-muted hover:bg-muted/80 text-foreground font-medium rounded-lg transition-colors whitespace-nowrap svelte-1xwqwht"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg> Edit Pack</button>'),gt=u('<button class="flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 disabled:bg-muted text-primary-foreground font-medium rounded-lg transition-colors whitespace-nowrap svelte-1xwqwht"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg> </button>'),_t=u('<div class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary"></div>'),bt=u('<div class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary"></div>'),ht=u('<div class="p-8 text-center text-muted-foreground">Loading notes from pack members...</div>'),xt=u('<div class="p-8 text-center text-muted-foreground">No notes found from pack members</div>'),kt=u('<div class="divide-y divide-neutral-800/50 border-y border-border"><!></div>'),wt=u('<div class="grid gap-4 md:grid-cols-2"></div>'),yt=u('<!> <div class="action-bar bg-card border border-border rounded-xl p-4 mb-6 svelte-1xwqwht"><div class="flex items-center justify-between svelte-1xwqwht"><div class="flex items-center gap-2 svelte-1xwqwht"><!> <button><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button></div></div></div> <div class="border-b border-border mb-6"><div class="flex gap-6"><button>Feed <!></button> <button> <!></button></div></div> <!>',1),Pt=u('<div class="text-center py-12"><div class="inline-block w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mb-4"></div> <p class="text-muted-foreground">Loading follow pack...</p></div>'),Ft=u('<div class="text-center py-12"><p class="text-muted-foreground">Follow pack not found</p> <button class="text-primary hover:text-primary/90 mt-4 inline-block transition-colors">Browse all packs</button></div>'),At=u('<div class="pack-detail-container svelte-1xwqwht"><div class="pack-header svelte-1xwqwht"><button class="back-btn svelte-1xwqwht"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> <span>Back to Packs</span></button></div> <div class="pack-content svelte-1xwqwht"><!> <!></div></div>');function Vt(re,n){ke(n,!0);const ae=()=>Se(Oe,"$page",R),[R,O]=He(),Q=J(()=>ae().params.packId);let w=D("feed"),g=D(!1),c=D(null),j=D(!0);pe(()=>{e(Q)&&(h(j,!0),q.fetchEvent(e(Q)).then(o=>{o&&h(c,Ge.from(o),!0),h(j,!1)}).catch(o=>{console.error("Failed to fetch pack:",o),h(j,!1)}))});let _=J(()=>e(c)?.tags.filter(o=>o[0]==="p").map(o=>o[1])||[]),I=D(null);pe(()=>{if(!e(c)?.author){h(I,null);return}e(c).author.fetchProfile().then(o=>{h(I,o,!0)})});let M=J(()=>e(c)?Ae.isFavorite(e(c).id):!1),T=J(()=>e(c)&&q.$currentUser?e(c).pubkey===q.$currentUser.pubkey:!1);const U=J(()=>e(w)==="feed"&&e(_).length>0?(console.log(`[FollowPackDetail] Creating subscription for ${e(_).length} members`),q.$subscribe(()=>({filters:[{kinds:[Je.Text],authors:e(_),limit:50}],bufferMs:100}))):null),z=J(()=>e(U)?.events||[]),V=J(()=>e(U)?.eosed||!1);function W(){e(c)&&Ae.toggleFavorite(e(c).id)}async function X(){if(!e(c)||!q.activeUser||e(_).length===0){he.error("Please login to follow users");return}h(g,!0);try{he.success(`Following ${e(_).length} users`),q.$follows.add(e(_))}catch(o){console.error("Error following all users:",o),he.error("Failed to follow users")}finally{h(g,!1)}}function Y(){Qe("/packs")}function y(){e(c)&&(ie.show=!0,ie.data=e(c))}var x=At(),H=r(x),oe=r(H);oe.__click=Y,t(H);var a=v(H,2),l=r(a);{var p=o=>{var i=yt(),d=E(i);mt(d,{get ndk(){return q},get followPack(){return e(c)},class:"mb-6"});var k=v(d,2),K=r(k),A=r(K),N=r(A);{var se=f=>{var m=pt();m.__click=y,s(f,m)},le=f=>{var m=gt();m.__click=X;var G=v(r(m));t(m),C(()=>{m.disabled=e(g),B(G,` ${e(g)?"Following...":"Follow All"}`)}),s(f,m)};b(N,f=>{e(T)?f(se):f(le,!1)})}var S=v(N,2);S.__click=W;var Ne=r(S);t(S),t(A),t(K),t(k);var ge=v(k,2),ye=r(ge),ne=r(ye);ne.__click=()=>h(w,"feed");var je=v(r(ne));{var Ce=f=>{var m=_t();s(f,m)};b(je,f=>{e(w)==="feed"&&f(Ce)})}t(ne);var ue=v(ne,2);ue.__click=()=>h(w,"members");var Pe=r(ue),qe=v(Pe);{var Me=f=>{var m=bt();s(f,m)};b(qe,f=>{e(w)==="members"&&f(Me)})}t(ue),t(ye),t(ge);var Ue=v(ge,2);{var ze=f=>{var m=kt(),G=r(m);{var _e=Z=>{var ce=ht();s(Z,ce)},Le=Z=>{var ce=te(),De=E(ce);{var Ee=$=>{var fe=xt();s($,fe)},Ie=$=>{var fe=te(),Ke=E(fe);Fe(Ke,17,()=>e(z),be=>be.id,(be,Re)=>{We(be,{get event(){return e(Re)}})}),s($,fe)};b(De,$=>{e(z).length===0?$(Ee):$(Ie,!1)},!0)}s(Z,ce)};b(G,Z=>{e(z).length===0&&!e(V)?Z(_e):Z(Le,!1)})}t(m),s(f,m)},Be=f=>{var m=wt();Fe(m,20,()=>e(_),G=>G,(G,_e)=>{ut(G,{get pubkey(){return _e}})}),t(m),s(f,m)};b(Ue,f=>{e(w)==="feed"?f(ze):f(Be,!1)})}C(()=>{ee(S,1,`p-2.5 rounded-lg transition-colors ${e(M)?"bg-red-500/10 text-red-500":"bg-muted text-muted-foreground hover:text-foreground"}`),xe(S,"title",e(M)?"Remove from favorites":"Add to favorites"),ee(Ne,0,`w-5 h-5 ${e(M)?"fill-current":""}`),ee(ne,1,`pb-3 px-1 font-medium transition-colors relative ${e(w)==="feed"?"text-foreground":"text-muted-foreground hover:text-foreground"}`),ee(ue,1,`pb-3 px-1 font-medium transition-colors relative ${e(w)==="members"?"text-foreground":"text-muted-foreground hover:text-foreground"}`),B(Pe,`Members (${e(_).length??""}) `)}),s(o,i)},F=o=>{var i=te(),d=E(i);{var k=A=>{var N=Pt();s(A,N)},K=A=>{var N=Ft(),se=v(r(N),2);se.__click=Y,t(N),s(A,N)};b(d,A=>{e(j)?A(k):A(K,!1)},!0)}s(o,i)};b(l,o=>{e(c)?o(p):o(F,!1)})}var P=v(l,2);Xe(P,{get editingPack(){return ie.data},get open(){return ie.show},set open(o){ie.show=o}}),t(a),t(x),s(re,x),we(),O()}Te(["click"]);export{Vt as component};
