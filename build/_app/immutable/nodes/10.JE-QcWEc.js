import{d as vr,c as dr,i as Ue,a as s,f as d,t as ge,j as Lr,s as S}from"../chunks/CiPFrJr-.js";import{b as N,x as cr,g as e,s as i,p as pr,f as Me,c as mr,$ as Pr,d as o,e as a,y as W,r,t as x,u as ye,a as Dr}from"../chunks/CSbKtK4P.js";import{p as Ir,b as De,i as R}from"../chunks/87vUJtvC.js";import{n as Be,e as ve,t as Ce,d as Mr,Q as Fe,R as jr,h as fe,r as Er}from"../chunks/D0X4VYcq.js";import{b as Sr}from"../chunks/DphWBL27.js";import{g as Oe}from"../chunks/CTwadDAE.js";import{h as ur}from"../chunks/BHoCnjht.js";import{c as Ye}from"../chunks/Cq_3NAdW.js";import{b as Vr}from"../chunks/I2MJeYPS.js";import{t as ke}from"../chunks/B0fEDaa-.js";import{D as Ur,a as Br,L as xe,B as Ze,b as Fr}from"../chunks/DFMKmhYe.js";import{D as Or,I as Ie,a as Ar}from"../chunks/C8b5RDJU.js";import{T as Rr}from"../chunks/ClqPSwVo.js";import{N as Tr,c as zr}from"../chunks/B_cmhmk_.js";function Nr(te,D={}){const J=new Tr(te),y=zr(J);let p=N(cr([])),V=N(0),T=N(!1);async function q(u){if(!u.type.startsWith("image/")){ke.error("Please select an image file");return}try{if(await y.upload(u,{fallbackServer:D.fallbackServer||"https://blossom.primal.net"}),y.result?.url){const U=new Image,X=await new Promise(he=>{U.onload=()=>he({width:U.width,height:U.height}),U.src=URL.createObjectURL(u)});i(p,[...e(p),{url:y.result.url,mimeType:u.type,hash:y.result.sha256||"",blurhash:y.result.blurhash,dimensions:X}],!0),i(V,e(p).length-1)}}catch(U){console.error("Upload failed:",U),ke.error("Failed to upload image")}}function ee(u){const X=u.target.files;X&&Array.from(X).forEach(he=>q(he))}function ce(u){u.preventDefault(),i(T,!0)}function ae(){i(T,!1)}async function I(u){u.preventDefault(),i(T,!1);const U=u.dataTransfer?.files;U&&Array.from(U).forEach(X=>q(X))}function z(u){i(p,e(p).filter((U,X)=>X!==u),!0),e(V)>=e(p).length&&i(V,Math.max(0,e(p).length-1),!0)}function _e(){i(p,[],!0),i(V,0),i(T,!1)}return{get uploadedImages(){return e(p)},set uploadedImages(u){i(p,u,!0)},get currentImageIndex(){return e(V)},set currentImageIndex(u){i(V,u,!0)},get isDragging(){return e(T)},get uploadStatus(){return y.status},get uploadProgress(){return y.progress},uploadFile:q,handleFileInputChange:ee,handleDragOver:ce,handleDragLeave:ae,handleDrop:I,removeImage:z,reset:_e}}var qr=d('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),Hr=d('Title <span class="text-red-500">*</span>',1),Gr=d('Description <span class="text-red-500">*</span>',1),Kr=d("<option> </option>"),Wr=d("<option> </option>"),Qr=Lr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),Jr=(te,D,J)=>D(e(J)),Xr=d('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Yr=d('<div class="flex flex-wrap gap-2"></div>'),Zr=d('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),et=d('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),rt=d('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),tt=d('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),at=d("<!> <!>",1),ot=d('<!> <div class="space-y-6"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1);function st(te,D){pr(D,!0);let J=Ir(D,"open",15,!1),y=N(!1),p=N(""),V=N(""),T=N(""),q=N(""),ee=N(""),ce=N("USD"),ae=N(void 0),I=N(cr([])),z=N("");const _e=Be.$currentUser,u=Nr(Be,{fallbackServer:"https://blossom.primal.net"});let U;const X=["electronics","furniture","clothing","books","services","vehicles","real-estate","jobs","free","wanted"],he=["USD","EUR","GBP","BTC","SATS"];function je(){e(z)&&!e(I).includes(e(z).toLowerCase())&&(i(I,[...e(I),e(z).toLowerCase()],!0),i(z,""))}function v(n){i(I,e(I).filter(w=>w!==n),!0)}async function _(){if(!e(p).trim()||!e(T).trim()||e(y)){ke.error("Please provide a title and description");return}if(!_e){ke.error("Please log in to create a listing");return}try{i(y,!0);const n=new jr(Be);if(n.title=e(p).trim(),n.summary=e(V).trim()||void 0,n.content=e(T).trim(),n.location=e(q).trim()||void 0,n.published_at=Math.floor(Date.now()/1e3),n.tags.push(["status","active"]),e(ee).trim()&&(n.price={amount:parseFloat(e(ee)),currency:e(ce),frequency:e(ae)&&e(ae)!=="once"?e(ae):void 0}),e(I).forEach(w=>{n.tags.push(["t",w])}),u.uploadedImages.forEach(w=>{n.tags.push(["image",w.url])}),await n.sign(),await n.publish(),n.publishStatus==="error"){const B=n.publishError?.relayErrors||{},C=Object.entries(B).map(([f,M])=>`${f}: ${M}`).join(`
`);ke.error(`Failed to publish:
${C||"Unknown error"}`);return}ke.success("Listing created successfully"),k(),J(!1),D.onClose?.(),Oe("/marketplace")}catch(n){console.error("Failed to publish listing:",n),ke.error(`Failed to create listing: ${n instanceof Error?n.message:"Unknown error"}`)}finally{i(y,!1)}}function k(){i(p,""),i(V,""),i(T,""),i(q,""),i(ee,""),i(ce,"USD"),i(ae,void 0),i(I,[],!0),i(z,""),u.reset()}function $(){e(y)||(k(),J(!1),D.onClose?.())}function H(n){n.key==="Escape"&&!e(y)&&$()}var h=dr();Ue("keydown",Pr,H);var m=Me(h);De(m,()=>Fr,(n,w)=>{w(n,{get open(){return J()},onOpenChange:B=>{J(B),B||$()},children:(B,C)=>{var f=dr(),M=Me(f);De(M,()=>Ur,(F,L)=>{L(F,{class:"max-w-4xl max-h-[90vh] overflow-y-auto",children:(Y,ie)=>{var oe=ot(),b=Me(oe);De(b,()=>Or,(t,c)=>{c(t,{children:(l,Z)=>{var P=qr(),K=o(a(P),2);De(K,()=>Br,(de,ue)=>{ue(de,{children:(Se,Xe)=>{W();var Ve=ge("Create Listing");s(Se,Ve)},$$slots:{default:!0}})}),r(P),s(l,P)},$$slots:{default:!0}})});var g=o(b,2),j=a(g),G=a(j),se=a(G);xe(se,{for:"title",children:(t,c)=>{W();var l=Hr();W(),s(t,l)},$$slots:{default:!0}});var Le=o(se,2);Ie(Le,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(p)},set value(t){i(p,t,!0)}}),r(G);var pe=o(G,2),me=a(pe);xe(me,{for:"summary",children:(t,c)=>{W();var l=ge("Summary");s(t,l)},$$slots:{default:!0}});var O=o(me,2);Ie(O,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(V)},set value(t){i(V,t,!0)}}),r(pe);var E=o(pe,2),re=a(E);xe(re,{for:"content",children:(t,c)=>{W();var l=Gr();W(),s(t,l)},$$slots:{default:!0}});var be=o(re,2);Rr(be,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(T)},set value(t){i(T,t,!0)}}),r(E);var we=o(E,2),A=a(we);xe(A,{for:"location",children:(t,c)=>{W();var l=ge("Location");s(t,l)},$$slots:{default:!0}});var Q=o(A,2);Ie(Q,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(q)},set value(t){i(q,t,!0)}}),r(we),r(j);var le=o(j,2),$e=o(a(le),2),Pe=a($e),er=a(Pe);xe(er,{for:"price-amount",children:(t,c)=>{W();var l=ge("Amount");s(t,l)},$$slots:{default:!0}});var gr=o(er,2);Ie(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(ee)},set value(t){i(ee,t,!0)}}),r(Pe);var Ae=o(Pe,2),rr=a(Ae);xe(rr,{for:"currency",children:(t,c)=>{W();var l=ge("Currency");s(t,l)},$$slots:{default:!0}});var Re=o(rr,2);ve(Re,21,()=>he,Ce,(t,c)=>{var l=Kr(),Z=a(l,!0);r(l);var P={};x(()=>{S(Z,e(c)),P!==(P=e(c))&&(l.value=(l.__value=e(c))??"")}),s(t,l)}),r(Re),r(Ae);var tr=o(Ae,2),ar=a(tr);xe(ar,{for:"frequency",children:(t,c)=>{W();var l=ge("Frequency");s(t,l)},$$slots:{default:!0}});var Te=o(ar,2),ze=a(Te);ze.value=(ze.__value=void 0)??"";var Ne=o(ze);Ne.value=Ne.__value="hour";var qe=o(Ne);qe.value=qe.__value="day";var He=o(qe);He.value=He.__value="week";var Ge=o(He);Ge.value=Ge.__value="month";var or=o(Ge);or.value=or.__value="year",r(Te),r(tr),r($e),r(le);var Ke=o(le,2),sr=o(a(Ke),2),We=a(sr),Ee=a(We),Qe=a(Ee);Qe.value=Qe.__value="";var fr=o(Qe);ve(fr,17,()=>X,Ce,(t,c)=>{var l=Wr(),Z=a(l,!0);r(l);var P={};x(K=>{S(Z,K),P!==(P=e(c))&&(l.value=(l.__value=e(c))??"")},[()=>e(c).charAt(0).toUpperCase()+e(c).slice(1)]),s(t,l)}),r(Ee);var lr=o(Ee,2);Ie(lr,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:t=>{t.key==="Enter"&&(t.preventDefault(),je())},get value(){return e(z)},set value(t){i(z,t,!0)}});var _r=o(lr,2);Ze(_r,{type:"button",onclick:je,size:"icon",children:(t,c)=>{var l=Qr();s(t,l)},$$slots:{default:!0}}),r(We);var hr=o(We,2);{var br=t=>{var c=Yr();ve(c,21,()=>e(I),Ce,(l,Z)=>{var P=Xr(),K=a(P),de=a(K,!0);r(K);var ue=o(K,2);ue.__click=[Jr,v,Z],r(P),x(()=>S(de,e(Z))),s(l,P)}),r(c),s(t,c)};R(hr,t=>{e(I).length>0&&t(br)})}r(sr),r(Ke);var ir=o(Ke,2),nr=o(a(ir),2),Je=a(nr);Je.__change=function(...t){u.handleFileInputChange?.apply(this,t)},Vr(Je,t=>U=t,()=>U);var ne=o(Je,2);ne.__click=()=>U?.click();var xr=a(ne);{var yr=t=>{var c=Zr(),l=o(a(c),2),Z=a(l);r(l),r(c),x(()=>S(Z,`${(u.uploadProgress?.percentage||0)??""}%`)),s(t,c)},kr=t=>{var c=et();W(4),s(t,c)};R(xr,t=>{u.uploadStatus==="uploading"?t(yr):t(kr,!1)})}r(ne);var wr=o(ne,2);{var $r=t=>{var c=tt();ve(c,21,()=>u.uploadedImages,Ce,(l,Z,P)=>{var K=rt(),de=a(K);fe(de,"alt",`Listing image ${P+1}`);var ue=o(de,2);ue.__click=()=>u.removeImage(P),r(K),x(()=>fe(de,"src",e(Z).url)),s(l,K)}),r(c),s(t,c)};R(wr,t=>{u.uploadedImages.length>0&&t($r)})}r(nr),r(ir),r(g);var Cr=o(g,2);De(Cr,()=>Ar,(t,c)=>{c(t,{class:"flex gap-3 sm:space-x-0",children:(l,Z)=>{var P=at(),K=Me(P);Ze(K,{variant:"outline",onclick:$,get disabled(){return e(y)},children:(ue,Se)=>{W();var Xe=ge("Cancel");s(ue,Xe)},$$slots:{default:!0}});var de=o(K,2);{let ue=ye(()=>!e(p).trim()||!e(T).trim()||e(y));Ze(de,{onclick:_,get disabled(){return e(ue)},children:(Se,Xe)=>{W();var Ve=ge();x(()=>S(Ve,e(y)?"Publishing...":"Publish Listing")),s(Se,Ve)},$$slots:{default:!0}})}s(l,P)},$$slots:{default:!0}})}),x(()=>{ne.disabled=u.uploadStatus==="uploading",Mr(ne,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${u.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),Fe(Re,()=>e(ce),t=>i(ce,t)),Fe(Te,()=>e(ae),t=>i(ae,t)),Fe(Ee,()=>e(z),t=>i(z,t)),Ue("dragover",ne,function(...t){u.handleDragOver?.apply(this,t)}),Ue("dragleave",ne,function(...t){u.handleDragLeave?.apply(this,t)}),Ue("drop",ne,function(...t){u.handleDrop?.apply(this,t)}),s(Y,oe)},$$slots:{default:!0}})}),s(B,f)},$$slots:{default:!0}})}),s(te,h),mr()}vr(["click","change"]);var lt=d("<option> </option>"),it=d('<div class="container mx-auto px-4 py-4 max-w-7xl"><div class="mb-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">Marketplace</h1> <button class="hidden sm:flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-foreground font-medium rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span>Create Listing</span></button></div> <div class="flex gap-2 sm:gap-3"><div class="flex-1"><div class="relative"><svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search listings..." class="w-full pl-10 h-12 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all"/></div></div> <div class="relative"><select class="h-12 px-4 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all appearance-none pr-10"></select> <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div></div></div>'),nt=d('<div class="mb-6"><h2 class="text-xl font-semibold text-foreground"> </h2> <p class="text-sm text-muted-foreground mt-1"> </p></div>'),dt=(te,D)=>Oe(`/marketplace/${e(D).encode()}`),ut=d('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),vt=d('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),ct=d('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),pt=d('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),mt=d('<div class="col-span-full text-center py-12 text-muted-foreground">No listings found</div>'),gt=d('<div><!> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),ft=d('<div class="text-center py-12 text-muted-foreground">No marketplace items yet</div>'),_t=(te,D)=>Oe(`/marketplace/${e(D).encode()}`),ht=d('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),bt=d('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),xt=d('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),yt=d('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),kt=d('<div class="mb-8"><h2 class="text-xl font-semibold text-foreground mb-4">Recent Listings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),wt=(te,D,J)=>D(e(J).value),$t=(te,D)=>Oe(`/marketplace/${e(D).encode()}`),Ct=d('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Lt=d('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Pt=d('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Dt=d('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),It=d('<div class="mb-8"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-foreground"> </h2> <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline">View All</button></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Mt=d("<!> <!>",1),jt=d("<div><!></div>"),Et=d('<div class="min-h-screen bg-neutral-50 dark:bg-background"><div class="container mx-auto px-4 py-4 max-w-7xl"><!></div> <!></div>');function Kt(te,D){pr(D,!0);const J=v=>{var _=it(),k=a(_),$=a(k),H=o(a($),2);H.__click=()=>Ye.open(),r($);var h=o($,2),m=a(h),n=a(m),w=o(a(n),2);Er(w),r(n),r(m);var B=o(m,2),C=a(B);ve(C,21,()=>y,Ce,(f,M)=>{var F=lt(),L=a(F,!0);r(F);var Y={};x(()=>{S(L,e(M).label),Y!==(Y=e(M).value)&&(F.value=(F.__value=e(M).value)??"")}),s(f,F)}),r(C),W(2),r(B),r(h),r(k),r(_),Sr(w,()=>e(V),f=>i(V,f)),Fe(C,()=>e(p),f=>i(p,f)),s(v,_)},y=[{value:"",label:"All Categories"},{value:"electronics",label:"Electronics"},{value:"furniture",label:"Furniture"},{value:"clothing",label:"Clothing"},{value:"books",label:"Books"},{value:"services",label:"Services"},{value:"vehicles",label:"Vehicles"},{value:"real-estate",label:"Real Estate"},{value:"jobs",label:"Jobs"},{value:"free",label:"Free"},{value:"wanted",label:"Wanted"}];let p=N(""),V=N("");const T=Be.$subscribe(()=>{const v={kinds:[30402],limit:50};return e(p)&&(v["#t"]=[e(p).toLowerCase()]),{filters:[v],bufferMs:100}}),q=ye(()=>T.events.filter(v=>{if((v.tagValue("status")||"active")!=="active")return!1;if(!e(V))return!0;const k=e(V).toLowerCase(),$=v.tagValue("title")?.toLowerCase()||"",H=v.tagValue("summary")?.toLowerCase()||"",h=v.content?.toLowerCase()||"",m=v.tagValue("location")?.toLowerCase()||"";return $.includes(k)||H.includes(k)||h.includes(k)||m.includes(k)})),ee=ye(()=>{const v={};return e(q).forEach(_=>{const k=_.tags.filter($=>$[0]==="t").map($=>$[1]);k.length>0?k.forEach($=>{const H=$.toLowerCase();v[H]||(v[H]=[]),v[H].push(_)}):(v.uncategorized||(v.uncategorized=[]),v.uncategorized.push(_))}),v}),ce=ye(()=>e(p)||e(V));function ae(v){i(p,v,!0)}function I(v){return v.tagValue("image")}function z(v){const _=v.tags.find(k=>k[0]==="price");return!_||!_[1]||!_[2]?null:{amount:_[1],currency:_[2]}}Dr(()=>(ur.header=J,()=>{ur.clear()}));var _e=Et(),u=a(_e),U=a(u);{var X=v=>{var _=gt(),k=a(_);{var $=h=>{var m=nt(),n=a(m),w=a(n,!0);r(n);var B=o(n,2),C=a(B);r(B),r(m),x(f=>{S(w,f),S(C,`${e(q).length??""} listings found`)},[()=>y.find(f=>f.value===e(p))?.label||e(p)]),s(h,m)};R(k,h=>{e(p)&&h($)})}var H=o(k,2);ve(H,21,()=>e(q),h=>h.id,(h,m)=>{const n=ye(()=>z(e(m)));var w=pt();w.__click=[dt,m];var B=a(w);{var C=b=>{var g=ut(),j=a(g);r(g),x((G,se)=>{fe(j,"src",G),fe(j,"alt",se)},[()=>I(e(m)),()=>e(m).tagValue("title")||"Listing"]),s(b,g)};R(B,b=>{I(e(m))&&b(C)})}var f=o(B,2),M=a(f),F=a(M,!0);r(M);var L=o(M,2);{var Y=b=>{var g=vt(),j=a(g,!0);r(g),x(G=>S(j,G),[()=>e(m).tagValue("summary")]),s(b,g)};R(L,b=>{e(m).tagValue("summary")&&b(Y)})}var ie=o(L,2);{var oe=b=>{var g=ct(),j=a(g);r(g),x(()=>S(j,`${e(n).amount??""} ${e(n).currency??""}`)),s(b,g)};R(ie,b=>{e(n)&&b(oe)})}r(f),r(w),x(b=>S(F,b),[()=>e(m).tagValue("title")||"Untitled"]),s(h,w)},h=>{var m=mt();s(h,m)}),r(H),r(_),s(v,_)},he=v=>{var _=jt(),k=a(_);{var $=h=>{var m=ft();s(h,m)},H=h=>{var m=Mt(),n=Me(m);{var w=C=>{var f=kt(),M=o(a(f),2);ve(M,21,()=>e(q).slice(0,8),F=>F.id,(F,L)=>{const Y=ye(()=>z(e(L)));var ie=yt();ie.__click=[_t,L];var oe=a(ie);{var b=O=>{var E=ht(),re=a(E);r(E),x((be,we)=>{fe(re,"src",be),fe(re,"alt",we)},[()=>I(e(L)),()=>e(L).tagValue("title")||"Listing"]),s(O,E)};R(oe,O=>{I(e(L))&&O(b)})}var g=o(oe,2),j=a(g),G=a(j,!0);r(j);var se=o(j,2);{var Le=O=>{var E=bt(),re=a(E,!0);r(E),x(be=>S(re,be),[()=>e(L).tagValue("summary")]),s(O,E)};R(se,O=>{e(L).tagValue("summary")&&O(Le)})}var pe=o(se,2);{var me=O=>{var E=xt(),re=a(E);r(E),x(()=>S(re,`${e(Y).amount??""} ${e(Y).currency??""}`)),s(O,E)};R(pe,O=>{e(Y)&&O(me)})}r(g),r(ie),x(O=>S(G,O),[()=>e(L).tagValue("title")||"Untitled"]),s(F,ie)}),r(M),r(f),s(C,f)};R(n,C=>{e(q).length>0&&C(w)})}var B=o(n,2);ve(B,17,()=>y.filter(C=>C.value&&e(ee)[C.value]?.length>0),Ce,(C,f)=>{var M=It(),F=a(M),L=a(F),Y=a(L,!0);r(L);var ie=o(L,2);ie.__click=[wt,ae,f],r(F);var oe=o(F,2);ve(oe,21,()=>e(ee)[e(f).value].slice(0,4),b=>b.id,(b,g)=>{const j=ye(()=>z(e(g)));var G=Dt();G.__click=[$t,g];var se=a(G);{var Le=A=>{var Q=Ct(),le=a(Q);r(Q),x(($e,Pe)=>{fe(le,"src",$e),fe(le,"alt",Pe)},[()=>I(e(g)),()=>e(g).tagValue("title")||"Listing"]),s(A,Q)};R(se,A=>{I(e(g))&&A(Le)})}var pe=o(se,2),me=a(pe),O=a(me,!0);r(me);var E=o(me,2);{var re=A=>{var Q=Lt(),le=a(Q,!0);r(Q),x($e=>S(le,$e),[()=>e(g).tagValue("summary")]),s(A,Q)};R(E,A=>{e(g).tagValue("summary")&&A(re)})}var be=o(E,2);{var we=A=>{var Q=Pt(),le=a(Q);r(Q),x(()=>S(le,`${e(j).amount??""} ${e(j).currency??""}`)),s(A,Q)};R(be,A=>{e(j)&&A(we)})}r(pe),r(G),x(A=>S(O,A),[()=>e(g).tagValue("title")||"Untitled"]),s(b,G)}),r(oe),r(M),x(()=>S(Y,e(f).label)),s(C,M)}),s(h,m)};R(k,h=>{Object.keys(e(ee)).length===0?h($):h(H,!1)})}r(_),s(v,_)};R(U,v=>{e(ce)?v(X):v(he,!1)})}r(u);var je=o(u,2);st(je,{onClose:()=>{T.restart?.()},get open(){return Ye.show},set open(v){Ye.show=v}}),r(_e),s(te,_e),mr()}vr(["click"]);export{Kt as component};
