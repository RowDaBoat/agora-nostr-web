const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/D0X4VYcq.js","../chunks/CSbKtK4P.js","../chunks/CiPFrJr-.js","../chunks/87vUJtvC.js","../assets/ndk.eAnDS4l7.css"])))=>i.map(i=>d[i]);
import{d as $e,c as Q,f as I,t as he,a as n,j as Pe,s as le}from"../chunks/CiPFrJr-.js";import{p as Re,b as ae,x as Le,f as H,y as J,d as l,e as s,r as o,s as p,g as e,u as q,t as de,c as Te,_ as Ue}from"../chunks/CSbKtK4P.js";import{p as Ce,b as ce,i as k,s as Be,a as Fe}from"../chunks/87vUJtvC.js";import{e as we,t as Ee,n as V,m as Ie,f as Ae}from"../chunks/D0X4VYcq.js";import{p as ze}from"../chunks/fk9xBW3Y.js";import{t as ye}from"../chunks/B0fEDaa-.js";import{N as Me}from"../chunks/Cybom7lU.js";import{H as xe}from"../chunks/D_SIBIBl.js";import{a as Ne}from"../chunks/CGbTV4zP.js";import{n as He}from"../chunks/BSsXfEb0.js";import{D as Se,a as Ke,B as ke,b as Oe}from"../chunks/DFMKmhYe.js";import{D as We,I as Ve,a as qe}from"../chunks/C8b5RDJU.js";import{D as Ge}from"../chunks/Do6nhxsB.js";var Je=I("<!> <!>",1),Qe=(X,a,M)=>a(e(M)),Xe=I('<div class="flex items-center justify-between p-2 bg-muted/30 rounded border border-border text-sm"><span class="font-mono text-xs truncate flex-1 mr-2"> </span> <button type="button" class="text-muted-foreground hover:text-destructive transition-colors p-1" aria-label="Remove relay"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Ye=I('<div class="space-y-2"><div class="text-sm font-medium text-foreground"> </div> <div class="max-h-40 overflow-y-auto space-y-1"></div></div>'),Ze=I('<div class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),et=I('<div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 dark:text-green-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Event found! Loading...</span></div>'),tt=Pe('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Searching...',1),rt=Pe('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Search for Event',1),at=I("<!> <!>",1),nt=I('<!> <div class="space-y-4"><div class="p-3 bg-muted/50 rounded-lg border border-border"><div class="text-xs text-muted-foreground mb-1 font-medium">Event ID (nevent)</div> <div class="font-mono text-xs break-all text-foreground"> </div></div> <div class="space-y-2"><label class="text-sm font-medium text-foreground">Add Relay URL</label> <div class="flex gap-2"><!> <!></div> <p class="text-xs text-muted-foreground">Enter relay URLs where this event might be stored (e.g., wss://relay.damus.io)</p></div> <!> <!> <!></div> <!>',1);function ot(X,a){Re(a,!0);let M=Ce(a,"show",15),$=ae(""),d=ae(Le(a.relayHint?[a.relayHint]:[])),P=ae(!1),t=ae(""),F=ae(!1);const Y=q(()=>{try{return He.neventEncode({id:a.eventId,relays:a.relayHint?[a.relayHint]:[]})}catch{return a.eventId}});function z(){const v=e($).trim();if(v){if(!v.startsWith("wss://")&&!v.startsWith("ws://")){p(t,"Relay URL must start with wss:// or ws://");return}if(e(d).includes(v)){p(t,"This relay is already in the list");return}p(d,[...e(d),v],!0),p($,""),p(t,"")}}function Z(v){p(d,e(d).filter(S=>S!==v),!0)}async function ne(){if(e(d).length===0){p(t,"Please add at least one relay URL");return}p(P,!0),p(t,""),p(F,!1);try{const v=await Ue(async()=>{const{NDKRelaySet:u}=await import("../chunks/D0X4VYcq.js").then(C=>C.aK);return{NDKRelaySet:u}},__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(({NDKRelaySet:u})=>u.fromRelayUrls(e(d),V)),S=await V.fetchEvent({ids:[a.eventId]},{closeOnEose:!0},v);S?(p(F,!0),a.onEventFound?.(S),setTimeout(()=>{M(!1)},1e3)):p(t,"Event not found on the specified relays")}catch(v){console.error("Error fetching event:",v),p(t,v instanceof Error?v.message:"Failed to fetch event",!0)}finally{p(P,!1)}}function oe(v){v.key==="Enter"&&z()}var G=Q(),ee=H(G);ce(ee,()=>Oe,(v,S)=>{S(v,{get open(){return M()},set open(u){M(u)},children:(u,C)=>{var se=Q(),fe=H(se);ce(fe,()=>Se,(pe,me)=>{me(pe,{class:"max-w-2xl",onClose:()=>M(!1),children:(_e,y)=>{var x=nt(),m=H(x);ce(m,()=>We,(r,i)=>{i(r,{children:(h,L)=>{var f=Je(),W=H(f);ce(W,()=>Ke,(U,B)=>{B(U,{children:(re,ie)=>{J();var ge=he("Missing Event Explorer");n(re,ge)},$$slots:{default:!0}})});var te=l(W,2);ce(te,()=>Ge,(U,B)=>{B(U,{children:(re,ie)=>{J();var ge=he("This event couldn't be found on the default relays. Try adding relay URLs where it might be stored.");n(re,ge)},$$slots:{default:!0}})}),n(h,f)},$$slots:{default:!0}})});var c=l(m,2),w=s(c),R=l(s(w),2),N=s(R,!0);o(R),o(w);var j=l(w,2),g=l(s(j),2),ve=s(g);Ve(ve,{type:"text",placeholder:"wss://relay.example.com",get disabled(){return e(P)},onkeydown:oe,class:"flex-1",get value(){return e($)},set value(r){p($,r,!0)}});var T=l(ve,2);{let r=q(()=>e(P)||!e($).trim());ke(T,{type:"button",onclick:z,get disabled(){return e(r)},variant:"outline",children:(i,h)=>{J();var L=he("Add");n(i,L)},$$slots:{default:!0}})}o(g),J(2),o(j);var _=l(j,2);{var A=r=>{var i=Ye(),h=s(i),L=s(h);o(h);var f=l(h,2);we(f,21,()=>e(d),Ee,(W,te)=>{var U=Xe(),B=s(U),re=s(B,!0);o(B);var ie=l(B,2);ie.__click=[Qe,Z,te],o(U),de(()=>{le(re,e(te)),ie.disabled=e(P)}),n(W,U)}),o(f),o(i),de(()=>le(L,`Relays to search (${e(d).length??""})`)),n(r,i)};k(_,r=>{e(d).length>0&&r(A)})}var D=l(_,2);{var K=r=>{var i=Ze(),h=l(s(i),2),L=s(h,!0);o(h),o(i),de(()=>le(L,e(t))),n(r,i)};k(D,r=>{e(t)&&r(K)})}var E=l(D,2);{var O=r=>{var i=et();n(r,i)};k(E,r=>{e(F)&&r(O)})}o(c);var b=l(c,2);ce(b,()=>qe,(r,i)=>{i(r,{children:(h,L)=>{var f=at(),W=H(f);ke(W,{type:"button",variant:"outline",onclick:()=>M(!1),get disabled(){return e(P)},children:(U,B)=>{J();var re=he("Cancel");n(U,re)},$$slots:{default:!0}});var te=l(W,2);{let U=q(()=>e(P)||e(d).length===0||e(F));ke(te,{type:"button",onclick:ne,get disabled(){return e(U)},children:(B,re)=>{var ie=Q(),ge=H(ie);{var je=ue=>{var be=tt();J(),n(ue,be)},De=ue=>{var be=rt();J(),n(ue,be)};k(ge,ue=>{e(P)?ue(je):ue(De,!1)})}n(B,ie)},$$slots:{default:!0}})}n(h,f)},$$slots:{default:!0}})}),de(()=>le(N,e(Y))),n(_e,x)},$$slots:{default:!0}})}),n(u,se)},$$slots:{default:!0}})}),n(X,G),Te()}$e(["click"]);var st=I('<div class="absolute left-[29px] -top-px h-[73px] w-0.5 bg-muted"></div> <div class="absolute left-[29px] top-[73px] bottom-0 w-0.5 bg-muted"></div>',1),it=I('<p class="text-xs text-muted-foreground/70 font-mono truncate mb-3 bg-background/50 p-2 rounded"> </p>'),lt=(X,a)=>p(a,!0),dt=I(`<article class="p-3 sm:p-4 bg-muted/10 border-b border-border relative min-w-0"><!> <div class="p-4 border border-dashed border-muted-foreground/30 rounded-lg bg-muted/20"><div class="flex items-start gap-3"><div class="flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1 min-w-0"><p class="text-sm font-medium text-foreground mb-1">Missing Parent Event</p> <p class="text-xs text-muted-foreground mb-2">This note is replying to an event that couldn't be found on the default relays.</p> <!> <button type="button" class="text-sm text-primary hover:text-primary/80 underline transition-colors flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Try fetching from other relays</button></div></div></div></article> <!>`,1);function vt(X,a){Re(a,!0);let M=Ce(a,"showThreadLine",3,!1),$=ae(!1);const d=q(()=>{try{return He.neventEncode({id:a.eventId,relays:a.relayHint?[a.relayHint]:[]})}catch{return a.eventId}});var P=dt(),t=H(P),F=s(t);{var Y=u=>{var C=st();J(2),n(u,C)};k(F,u=>{M()&&u(Y)})}var z=l(F,2),Z=s(z),ne=l(s(Z),2),oe=l(s(ne),4);{var G=u=>{var C=it(),se=s(C);o(C),de(fe=>le(se,`${fe??""}...`),[()=>e(d).slice(0,40)]),n(u,C)};k(oe,u=>{e(d)&&u(G)})}var ee=l(oe,2);ee.__click=[lt,$],o(ne),o(Z),o(z),o(t);var v=l(t,2);{var S=u=>{ot(u,{get eventId(){return a.eventId},get relayHint(){return a.relayHint},get onEventFound(){return a.onEventFound},get show(){return e($)},set show(C){p($,C,!0)}})};k(v,u=>{e($)&&u(S)})}n(X,P),Te()}$e(["click"]);async function ut(X,a,M,$){if(!(!V.signer||!e(a)||!M.ready)){p($,!0);try{const d=await M.reply();if(d.content=e(a),await d.publish(),d.publishStatus==="error"){const t=d.publishError?.relayErrors||{},F=Object.entries(t).map(([Y,z])=>`${Y}: ${z}`).join(`
`);ye.error(`Failed to publish:
${F||"Unknown error"}`);return}p(a,""),ye.success("Reply published")}catch(d){console.error("Failed to publish reply:",d),ye.error(`Failed to send reply: ${d instanceof Error?d.message:"Unknown error"}`)}finally{p($,!1)}}}var ct=()=>history.back(),ft=I('<div class="flex flex-col items-center justify-center mt-20"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div> <p class="mt-4 text-neutral-400">Loading note...</p></div>'),gt=I('<div class="border-b border-neutral-800 p-4"><div class="flex gap-3"><!> <div class="flex-1 flex flex-col gap-2"><div class="p-3 bg-background border border-border rounded-lg"><!></div> <div class="flex justify-end"><button class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"> </button></div></div></div></div>'),ht=I('<div class="px-4 py-3 border-b border-border"><h2 class="font-semibold text-foreground"> </h2></div> <!>',1),pt=I('<main class="max-w-2xl mx-auto"><!> <!> <!> <div><!></div></main>'),mt=I('<div class="min-h-screen bg-background"><header class="sticky top-0 z-10 bg-background/80 backdrop-blur-md border-b border-border"><div class="flex items-center gap-4 px-4 py-3"><button class="p-2 hover:bg-neutral-900 rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button> <h1 class="text-xl font-semibold">Thread</h1></div></header> <!></div>');function Ct(X,a){Re(a,!0);const M=()=>Fe(ze,"$page",$),[$,d]=Be(),P=q(()=>M().params.nevent),t=V.$fetchEvent(()=>e(P)),F=V.$currentUser,Y=V.$fetchProfile(()=>t.ready?t.pubkey:void 0),z=q(()=>{if(!t.ready)return null;const y=t.tags.find(c=>c[0]==="e"&&c[3]==="root");if(y)return y[1];const x=t.tags.find(c=>c[0]==="e"&&c[3]==="reply");if(x)return x[1];const m=t.tags.filter(c=>c[0]==="e");return m.length>0?m[0][1]:null}),Z=V.$subscribe(()=>{if(e(z))return{filters:[{ids:[e(z)]},{kinds:[1,9802],"#e":[e(z)]}],subId:"thread-events"}}),ne=V.$subscribe(()=>{if(t.ready)return{filters:[{kinds:[1,9802],"#e":[t.id]},{kinds:[1,9802],"#e":[t.id]}],subId:"main-event-replies"}}),oe=q(()=>{if(!t.ready||!Z||Z.events.length===0)return[];const y=[],x=new Map(Z.events.map(w=>[w.id,w]));let m=t,c=0;for(;m&&c<20;){c++;const w=m.tags.find(g=>g[0]==="e"&&g[3]==="reply"),R=m.tags.find(g=>g[0]==="e"&&g[3]==="root");let N=null,j=null;if(w)N=w[1],j=w;else if(R&&R[1]!==m.id)N=R[1],j=R;else{const g=m.tags.filter(ve=>ve[0]==="e");g.length>0&&(N=g[g.length-1][1],j=g[g.length-1])}if(N)if(x.has(N)){const g=x.get(N);y.unshift({type:"event",event:g}),m=g}else{const g=j&&j[2]?j[2]:void 0;y.unshift({type:"missing",eventId:N,relayHint:g});break}else break}return y}),G=q(()=>!ne||!t.ready?[]:ne.events.filter(m=>{const c=m.tags.find(R=>R[0]==="e"&&R[3]==="reply");if(c)return c[1]===t?.id;const w=m.tags.filter(R=>R[0]==="e");return w.length>0&&w[w.length-1][1]===t?.id}).sort((m,c)=>(m.created_at||0)-(c.created_at||0)));let ee=ae(""),v=ae(!1);function S(y){const x=y.encode();window.location.href=`/e/${x}`}var u=mt(),C=s(u),se=s(C),fe=s(se);fe.__click=[ct],J(2),o(se),o(C);var pe=l(C,2);{var me=y=>{var x=ft();n(y,x)},_e=y=>{var x=pt(),m=s(x);we(m,17,()=>e(oe),Ee,(T,_,A)=>{var D=Q(),K=H(D);{var E=b=>{{let r=q(()=>A<e(oe).length-1);vt(b,{get eventId(){return e(_).eventId},get relayHint(){return e(_).relayHint},get showThreadLine(){return e(r)},onEventFound:i=>{if(t.ready){const h=t.encode();window.location.href=`/e/${h}`}}})}},O=b=>{var r=Q(),i=H(r);{var h=f=>{xe(f,{get event(){return e(_).event},variant:"default"})},L=f=>{var W=Q(),te=H(W);{var U=B=>{};k(te,B=>{e(_).event instanceof Ie&&B(U)},!0)}n(f,W)};k(i,f=>{e(_).event.kind===9802?f(h):f(L,!1)},!0)}n(b,r)};k(K,b=>{e(_).type==="missing"?b(E):b(O,!1)})}n(T,D)});var c=l(m,2);{var w=T=>{var _=Q(),A=H(_);{var D=E=>{xe(E,{get event(){return t},variant:"default"})},K=E=>{var O=Q(),b=H(O);{var r=i=>{Me(i,{get event(){return t},variant:"thread-main",showThreadLine:!1})};k(b,i=>{t instanceof Ie&&i(r)},!0)}n(E,O)};k(A,E=>{t.kind===9802?E(D):E(K,!1)})}n(T,_)};k(c,T=>{t.ready&&T(w)})}var R=l(c,2);{var N=T=>{var _=gt(),A=s(_),D=s(A);Ae(D,{get ndk(){return V},get pubkey(){return F.pubkey},class:"w-10 h-10 flex-shrink-0"});var K=l(D,2),E=s(K),O=s(E);{let h=q(()=>`Reply to ${Y.ready?Y.name:"this note"}...`);Ne(O,{get placeholder(){return e(h)},get disabled(){return e(v)},get value(){return e(ee)},set value(L){p(ee,L,!0)}})}o(E);var b=l(E,2),r=s(b);r.__click=[ut,ee,t,v];var i=s(r,!0);o(r),o(b),o(K),o(A),o(_),de(h=>{r.disabled=h,le(i,e(v)?"Posting...":"Reply")},[()=>!e(ee).trim()||e(v)]),n(T,_)};k(R,T=>{V.signer&&F&&T(N)})}var j=l(R,2),g=s(j);{var ve=T=>{var _=ht(),A=H(_),D=s(A),K=s(D);o(D),o(A);var E=l(A,2);we(E,17,()=>e(G),Ee,(O,b)=>{var r=Q(),i=H(r);{var h=f=>{xe(f,{get event(){return e(b)},variant:"default"})},L=f=>{Me(f,{get event(){return e(b)},variant:"thread-reply",onNavigate:()=>S(e(b))})};k(i,f=>{e(b).kind===9802?f(h):f(L,!1)})}n(O,r)}),de(()=>le(K,`${e(G).length??""} ${e(G).length===1?"Reply":"Replies"}`)),n(T,_)};k(g,T=>{e(G).length>0&&T(ve)})}o(j),o(x),n(y,x)};k(pe,y=>{t.ready?y(_e,!1):y(me)})}o(u),n(X,u),Te(),d()}$e(["click"]);export{Ct as component};
