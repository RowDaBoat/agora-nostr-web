import{f as _,a as c,c as x,j as W,r as ie,s as Z}from"./DNmf0A2m.js";import{bq as ye,aJ as M,x as Ue,u as z,p as L,s as l,a as C,g as t,b,aN as we,t as P,c as G,e as F,r as K,d as oe,f as E}from"./DpkVnRja.js";import{s as ne}from"./CszMzaRi.js";import{j as Ne,e as D,a as S,c as ae,b as le}from"./Ci0hv7jC.js";import{p as I}from"./f_qAQkK6.js";import{S as xe}from"./FBAAKbhk.js";import{t as Ee}from"./0JNfDbnS.js";import{i as y}from"./Btb_Ey2R.js";import"./QTLWRGLp.js";function fe(d){const e=d.slice(0,6),m=`#${e}`,r=parseInt(e.slice(0,2),16),a=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16),n=Math.max(r,a,i)/255,s=Math.min(r,a,i)/255,f=(n+s)/2;let o=0,u=0;if(n!==s){const p=n-s;switch(u=f>.5?p/(2-n-s):p/(n+s),n){case r/255:o=((a/255-i/255)/p+(a<i?6:0))/6;break;case a/255:o=((i/255-r/255)/p+2)/6;break;case i/255:o=((r/255-a/255)/p+4)/6;break}}const h=(o*360+30)%360,R=Math.min(f*100+10,90);return`linear-gradient(135deg, ${m}, hsl(${h}, ${u*100}%, ${R}%))`}function J(...d){return Ee(Ne(d))}const re="ndk";function Pe(d){if(d)return d;try{if(ye(re)){const e=M(re);if(e)return e}}catch{}throw new Error(`NDK not found. Either:
1. Provide as second parameter: createBuilder(() => config, ndk)
2. Set in Svelte context: setContext('${re}', ndk)`)}const te=new xe;function Ie(d,e){const m=Pe(e),r=Ue({profile:null,user:null,loading:!1});async function a(i){r.loading=!0;try{const n=typeof i=="string"?await m.fetchUser(i):i;if(!n){r.profile=null,r.user=null,r.loading=!1;return}const s=n.pubkey;if(n.profile){r.profile=n.profile,r.user=n,r.loading=!1;return}let f=te.get(s);f||(f=n.fetchProfile({closeOnEose:!0,groupable:!0,groupableDelay:250}).finally(()=>{te.delete(s)}),te.set(s,f));const o=await f;r.profile=o||null,r.user=n}catch(n){console.error("Failed to fetch profile:",n),r.profile=null,r.user=null}r.loading=!1}return z(()=>{const{user:i}=d();i?a(i):(r.profile=null,r.user=null,r.loading=!1)}),{get profile(){return r.profile},get user(){return r.user},get loading(){return r.loading}}}const O=Symbol("user");var Se=_('<div data-user-root=""><!></div>');function Re(d,e){L(e,!0);let m=I(e,"class",3,"");const r=b(()=>{if(e.user)return e.user;if(e.pubkey)try{return e.ndk.getUser({pubkey:e.pubkey})}catch{return null}return null});let a=C(null);z(()=>{e.profile!==void 0?l(a,null):t(r)?l(a,Ie(()=>({user:t(r)}),e.ndk),!0):l(a,null)});const i=b(()=>e.profile!==void 0?e.profile:t(a)?.profile);we(O,{get ndk(){return e.ndk},get user(){return e.user},get ndkUser(){return t(r)},get profile(){return t(i)},get onclick(){return e.onclick}});var s=Se(),f=F(s);ne(f,()=>e.children),K(s),P(o=>S(s,1,o),[()=>D(J("contents",m()))]),c(d,s),G()}var Ce=_('<div class="rounded-full flex items-center justify-center w-full h-full absolute inset-0"> </div>'),Fe=_('<img data-user-avatar--img=""/>'),Ke=_('<div data-user-avatar=""><!> <!></div>');function Te(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(O);if(!r)throw new Error("User.Avatar must be used within User.Root");const a=b(()=>r.profile?.picture||e.fallback),i=b(()=>r.ndkUser?.pubkey?fe(r.ndkUser.pubkey):"var(--primary)");let n=C(!1),s=C(!1);function f(){l(n,!0),l(s,!1)}function o(){l(n,!1),l(s,!0)}z(()=>{l(n,!1),l(s,!1)});var u=Ke(),h=F(u);{var R=v=>{var g=x(),X=E(g);{var U=w=>{var N=x(),q=E(N);ne(q,()=>e.customFallback),c(w,N)},T=w=>{var N=Ce(),q=F(N,!0);K(N),P(A=>{le(N,`background: ${t(i)??""};`),Z(q,A)},[()=>r.ndkUser?.pubkey?.slice(0,2).toUpperCase()??"??"]),c(w,N)};y(X,w=>{e.customFallback?w(U):w(T,!1)})}c(v,g)};y(h,v=>{(!t(n)||!t(a))&&v(R)})}var p=oe(h,2);{var k=v=>{var g=Fe();P(X=>{ae(g,"src",t(a)),ae(g,"alt",e.alt),S(g,1,X)},[()=>D(J("rounded-full object-cover block w-full h-full absolute inset-0 bg-background",t(n)?"opacity-100":"opacity-0"))]),W("load",g,f),W("error",g,o),ie(g),c(v,g)};y(p,v=>{t(a)&&v(k)})}K(u),P(v=>S(u,1,v),[()=>D(J("rounded-full relative w-12 h-12",m()))]),c(d,u),G()}var Ve=_('<span data-user-name=""> </span>');function je(d,e){L(e,!0);let m=I(e,"field",3,"displayName"),r=I(e,"class",3,"");const a=M(O);if(!a)throw new Error("User.Name must be used within User.Root");const i=b(()=>{if(a.ndkUser)try{return a.ndkUser.pubkey}catch{return}}),n=b(()=>{if(!a.profile)return t(i)?.slice(0,8)+"..."||"Unknown";if(m()==="name")return a.profile.name||t(i)?.slice(0,8)+"...";if(m()==="displayName")return a.profile.displayName||a.profile.name||t(i)?.slice(0,8)+"...";if(m()==="both"){const o=a.profile.displayName||a.profile.name,u=a.profile.name&&a.profile.name!==a.profile.displayName?a.profile.name:null;return u?`${o} (@${u})`:o||t(i)?.slice(0,8)+"..."}return t(i)?.slice(0,8)+"..."||"Unknown"});var s=Ve(),f=F(s,!0);K(s),P(o=>{S(s,1,o),Z(f,t(n))},[()=>D(J(r()))]),c(d,s),G()}var Be=_('<p data-user-bio=""> </p>');function De(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(O);if(!r)throw new Error("User.Bio must be used within User.Root");const a=b(()=>r.profile?.about||"");var i=x(),n=E(i);{var s=f=>{var o=Be(),u=F(o,!0);K(o),P(h=>{S(o,1,h),Z(u,t(a))},[()=>D(J(m()))]),c(f,o)};y(n,f=>{t(a)&&f(s)})}c(d,i),G()}var Me=_('<img alt="Profile banner"/>'),Le=_('<div data-user-banner=""><!></div>');function Ge(d,e){L(e,!0);let m=I(e,"class",3,"");const r=M(O);if(!r)throw new Error("User.Banner must be used within User.Root");const a=b(()=>r.profile),i=b(()=>r.ndkUser);let n=C(!1),s=C(!1);const f=b(()=>{const k=t(i)?.pubkey;return k?`background: ${fe(k)}`:"background: var(--primary)"});z(()=>{t(a)?.banner&&(l(n,!1),l(s,!1))});function o(){l(n,!0),l(s,!1)}function u(){l(n,!1),l(s,!0)}var h=Le(),R=F(h);{var p=k=>{var v=Me();let g;P(()=>{ae(v,"src",t(a).banner),g=S(v,1,"w-full h-full object-cover",null,g,{"opacity-0":!t(n)})}),W("load",v,o),W("error",v,u),ie(v),c(k,v)};y(R,k=>{t(a)?.banner&&k(p)})}K(h),P(()=>{S(h,1,`relative w-full h-48 ${m()??""}`),le(h,t(f))}),c(d,h),G()}var Oe=_('<span title="Verifying NIP-05...">⋯</span>'),Xe=_('<span title="NIP-05 verified">✓</span>'),qe=_('<span title="NIP-05 does not match pubkey">✗</span>'),Ae=_('<span data-user-nip05=""> <!></span>');function Ye(d,e){L(e,!0);const m=/^(?:([\w.+-]+)@)?([\w.-]+)$/;function r(U){return U||""}let a=I(e,"showNip05",3,!0),i=I(e,"showVerified",3,!0),n=I(e,"class",3,"");const s=M(O);if(!s)throw new Error("User.Nip05 must be used within User.Root");const f=b(()=>s.profile),o=b(()=>s.ndkUser),u=b(()=>t(f)?.nip05),h=b(()=>t(u)?m.test(t(u)):!1),R=b(()=>r(t(u)));let p=C(void 0),k=C(!1);z(()=>{if(!i()||!t(u)||!t(o)||!t(h)){l(p,void 0);return}l(p,void 0),l(k,!0),t(o).validateNip05(t(u)).then(U=>{l(p,U,!0),l(k,!1)}).catch(()=>{l(p,null),l(k,!1)})});var v=x(),g=E(v);{var X=U=>{var T=Ae(),w=F(T),N=oe(w);{var q=A=>{var se=x(),ue=E(se);{var ce=V=>{var Y=x(),$=E(Y);ne($,()=>e.verificationSnippet,()=>({status:t(p),isVerifying:t(k)})),c(V,Y)},de=V=>{var Y=x(),$=E(Y);{var ve=j=>{var H=Oe();c(j,H)},me=j=>{var H=x(),pe=E(H);{var ge=B=>{var Q=Xe();c(B,Q)},be=B=>{var Q=x(),he=E(Q);{var ke=ee=>{var _e=qe();c(ee,_e)};y(he,ee=>{t(p)===!1&&ee(ke)},!0)}c(B,Q)};y(pe,B=>{t(p)===!0?B(ge):B(be,!1)},!0)}c(j,H)};y($,j=>{t(k)?j(ve):j(me,!1)})}c(V,Y)};y(ue,V=>{e.verificationSnippet?V(ce):V(de,!1)})}c(A,se)};y(N,A=>{i()&&A(q)})}K(T),P(()=>{S(T,1,D(n())),Z(w,`${t(R)??""} `)}),c(U,T)};y(g,U=>{a()&&t(u)&&U(X)})}c(d,v),G()}const tr={Root:Re,Avatar:Te,Name:je,Bio:De,Banner:Ge,Nip05:Ye};export{tr as U,Ie as a,J as c,Pe as r};
