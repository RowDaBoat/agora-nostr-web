import{b as r,g as s,s as o}from"./CSbKtK4P.js";import{i,n as c,m as u}from"./D0X4VYcq.js";const d=27235,h="npub.cash",l=`https://${h}`;class b{#e=r(!1);get enabled(){return s(this.#e)}set enabled(e){o(this.#e,e,!0)}#t=r(!1);get loading(){return s(this.#t)}set loading(e){o(this.#t,e,!0)}#n=r(null);get lastCheck(){return s(this.#n)}set lastCheck(e){o(this.#n,e,!0)}constructor(){this.enabled=i.wallet.npubCashEnabled}getLightningAddress(){return c.$currentUser?`${c.$currentUser.npub}@${h}`:""}async generateNip98Event(e,t){const a=new u(c);a.kind=d,a.tags=[["u",e],["method",t]],await a.sign();const n=JSON.stringify(a.rawEvent());return btoa(n)}async getInfo(){const e=`${l}/api/v1/info`,t=await this.generateNip98Event(e,"GET");return await(await fetch(e,{method:"GET",headers:{Authorization:`Nostr ${t}`}})).json()}async getBalance(){if(!this.enabled)return 0;const e=`${l}/api/v1/balance`;try{const t=await this.generateNip98Event(e,"GET"),n=await(await fetch(e,{method:"GET",headers:{Authorization:`Nostr ${t}`}})).json();return n.error?(console.error("npub.cash balance error:",n.error),0):n.data}catch(t){return console.error("Failed to get npub.cash balance:",t),0}}async getClaim(){const e=`${l}/api/v1/claim`;try{const t=await this.generateNip98Event(e,"GET"),n=await(await fetch(e,{method:"GET",headers:{Authorization:`Nostr ${t}`}})).json();return n.error?(console.error("npub.cash claim error:",n.error),""):n.data.token}catch(t){return console.error("Failed to claim from npub.cash:",t),""}}async claimTokens(){if(!this.enabled)return null;try{const e=await this.getBalance();if(console.log("npub.cash balance:",e,"sats"),e>0){const t=await this.getClaim();if(t)return console.log("Claimed token from npub.cash"),this.lastCheck=Date.now(),t}return this.lastCheck=Date.now(),null}catch(e){return console.error("Failed to claim tokens:",e),null}}setEnabled(e){this.enabled=e,i.wallet.npubCashEnabled=e,i.save()}}const m=new b;export{m as n};
