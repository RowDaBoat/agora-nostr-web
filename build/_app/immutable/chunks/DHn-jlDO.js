import{d as Ut,c as l,a as r,f as X,s as G,t as rt}from"./DNmf0A2m.js";import{p as Rt,aJ as It,aN as Ot,g as t,b as N,u as Zt,s as et,a as At,f as d,c as St,t as I,e as _t,r as mt,y as Bt}from"./DpkVnRja.js";import{i as c}from"./Btb_Ey2R.js";import{e as Tt,i as Ft}from"./DD8s4tVe.js";import{c as Z}from"./CSx53_lc.js";import{a as Nt,c as Mt}from"./Ci0hv7jC.js";import{p as Kt}from"./f_qAQkK6.js";import{z as Yt}from"./QTLWRGLp.js";class Dt{blockNsfw=!0;mentionComponent=null;hashtagComponent=null;linkComponent=null;mediaComponent=null;fallbackComponent=null;handlers=new Map;mentionPriority=0;hashtagPriority=0;linkPriority=0;mediaPriority=0;fallbackPriority=0;addKind(e,n,s=1){if(Array.isArray(e))for(const o of e){const m=this.handlers.get(o);(!m||s>=m.priority)&&this.handlers.set(o,{component:n,wrapper:null,priority:s})}else{const o=e.kinds||[],m=e.from?e:null;for(const f of o){const E=this.handlers.get(f);(!E||s>=E.priority)&&this.handlers.set(f,{component:n,wrapper:m,priority:s})}}}setMentionComponent(e,n=1){n>=this.mentionPriority&&(this.mentionComponent=e,this.mentionPriority=n)}setHashtagComponent(e,n=1){n>=this.hashtagPriority&&(this.hashtagComponent=e,this.hashtagPriority=n)}setLinkComponent(e,n=1){n>=this.linkPriority&&(this.linkComponent=e,this.linkPriority=n)}setMediaComponent(e,n=1){n>=this.mediaPriority&&(this.mediaComponent=e,this.mediaPriority=n)}setFallbackComponent(e,n=1){n>=this.fallbackPriority&&(this.fallbackComponent=e,this.fallbackPriority=n)}getKindHandler(e){if(e!==void 0)return this.handlers.get(e)}hasKindHandler(e){return e===void 0?!1:this.handlers.has(e)}getRegisteredKinds(){return Array.from(this.handlers.keys()).sort((e,n)=>e-n)}getInlinePriorities(){return{mention:this.mentionPriority,hashtag:this.hashtagPriority,link:this.linkPriority,media:this.mediaPriority,fallback:this.fallbackPriority}}getKindPriorities(){const e=new Map;for(const[n,s]of this.handlers)e.set(n,s.priority);return e}clear(){this.handlers.clear(),this.mentionComponent=null,this.hashtagComponent=null,this.linkComponent=null,this.mediaComponent=null,this.fallbackComponent=null,this.mentionPriority=0,this.hashtagPriority=0,this.linkPriority=0,this.mediaPriority=0,this.fallbackPriority=0}}const Ht=new Dt,yt=Symbol("content-renderer"),Jt=Symbol.for("entity-click"),Xt={EMOJI_SHORTCODE:/:([a-zA-Z0-9_]+):/g,NOSTR_URI:/nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,HASHTAG:/(^|\s)#([a-zA-Z0-9_\u0080-\uFFFF]+)(?=\s|$|[^\w])/g,MEDIA_FILE:/https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov)(\?[^\s<>"]*)?/gi,YOUTUBE:/https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,URL:/https?:\/\/[^\s<>"]+/gi};function zt(a){const e=new Map;if(!Array.isArray(a))return console.warn("[buildEmojiMap] Expected tags to be an array, got:",typeof a),e;for(const[n,s,o]of a)n==="emoji"&&s&&o&&e.set(s,o);return e}function qt(a,e){const n=e.get(a);return n?{type:"emoji",content:a,data:n}:{type:"text",content:`:${a}:`}}function Gt(a){try{const e=a.substring(0,a.indexOf("1")+1);if(Yt.decode(a),e==="npub1")return{type:"npub",content:a,data:a};if(e==="nprofile1")return{type:"nprofile",content:a,data:a};if(e==="note1"||e==="nevent1"||e==="naddr1")return{type:"event-ref",content:a,data:a}}catch{console.warn("[EventContent] Failed to decode Nostr URI:",a)}return{type:"text",content:`nostr:${a}`}}function Lt(a){return/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(a)}function Vt(a){return/\.(mp4|webm|mov)(\?|$)/i.test(a)}function Qt(a){return/youtube\.com|youtu\.be/i.test(a)}function $t(a,e){const n=a.match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(n){const[,s,o]=n;return s?{type:"hashtag",content:o,data:o}:{type:"hashtag",content:o,data:o}}if(a.startsWith(":")&&a.endsWith(":")){const s=a.slice(1,-1);return qt(s,e)}return a.startsWith("nostr:")?Gt(a.slice(6)):Lt(a)||Vt(a)||Qt(a)?{type:"media",content:a}:a.startsWith("http")?{type:"link",content:a}:{type:"text",content:a}}function te(a){const e=[];for(const n of Object.values(Xt)){n.lastIndex=0;let s=n.exec(a);for(;s!==null;)e.push({match:s,index:s.index}),s=n.exec(a)}return e.sort((n,s)=>n.index-s.index)}function ee(a,e){const n=[],s=te(a);let o=0;for(const{match:m,index:f}of s)if(!(f<o)){if(f>o&&n.push({type:"text",content:a.slice(o,f)}),m[0].match(/^\s?#[a-zA-Z0-9_\u0080-\uFFFF]+$/)){const E=m[0].match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(E){const[,i,z]=E;i&&n.push({type:"text",content:i}),n.push({type:"hashtag",content:z,data:z})}}else n.push($t(m[0],e));o=f+m[0].length}return o<a.length&&n.push({type:"text",content:a.slice(o)}),n}function Wt(a){return/^\s*$/.test(a)}function ne(a){const e=[];let n=[],s=[];function o(){n.length!==0&&(n.length===1?e.push({type:"media",content:n[0]}):e.push({type:"image-grid",content:"",data:n}),n=[],s=[])}function m(){for(const f of s)e.push(f);s=[]}for(const f of a)f.type==="media"&&Lt(f.content)?n.push(f.content):f.type==="text"&&Wt(f.content)&&n.length>0?s.push(f):(o(),m(),e.push(f));return o(),e}function ae(a){const e=[];let n=[],s=[];function o(){n.length!==0&&(n.length===1?e.push({type:"link",content:n[0]}):e.push({type:"link-group",content:"",data:n}),n=[],s=[])}function m(){for(const f of s)e.push(f);s=[]}for(const f of a)f.type==="link"?n.push(f.content):f.type==="text"&&Wt(f.content)&&n.length>0?s.push(f):(o(),m(),e.push(f));return o(),e}function re(a){return{get segments(){const e=String(a().event?.content??a().content??""),n=a().event,s=n?.tags&&Array.isArray(n.tags)?n.tags.filter(E=>E[0]==="emoji"):a().emojiTags??[],o=zt(s),m=ee(e,o),f=ne(m);return ae(f)},get content(){return String(a().event?.content??a().content??"").trim()},get emojiMap(){const e=a().event,n=e?.tags&&Array.isArray(e.tags)?e.tags.filter(s=>s[0]==="emoji"):a().emojiTags??[];return zt(n)}}}var oe=X('<div><div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span>Loading event...</span></div>'),ie=X("<div><span>Failed to load event</span></div>"),se=X('<div role="button" tabindex="0" class="cursor-pointer"><!></div>'),le=X('<div role="button" tabindex="0" class="cursor-pointer"><!></div>'),de=X('<button class="cursor-pointer font-mono text-sm bg-transparent border-none p-0 m-0 inline text-inherit"> </button>'),fe=X("<code> </code>");function ce(a,e){Rt(e,!0);let n=Kt(e,"class",3,"");const s=It(yt),o=N(()=>e.renderer??s?.renderer??Ht),m=It(Jt);Ot(yt,{get renderer(){return t(o)}});let f=At(void 0),E=At(!0),i=At(void 0);Zt(()=>{et(E,!0),et(i,void 0),et(f,void 0),e.ndk.fetchEvent(e.bech32).then(b=>{et(f,b??void 0,!0),et(E,!1)}).catch(b=>{et(i,b,!0),et(E,!1)})});const z=N(()=>({event:t(f),loading:t(E),error:t(i)}));let ot=N(()=>t(o).getKindHandler(t(z).event?.kind)),it=N(()=>t(ot)?.component),st=N(()=>t(o).fallbackComponent),C=N(()=>t(z).event&&t(ot)?.wrapper?.from?t(ot).wrapper.from(t(z).event):t(z).event);function O(b){m?.onEventClick&&t(C)&&(b.stopPropagation(),m.onEventClick(t(C)))}var ht=l(),kt=d(ht);{var bt=b=>{var B=oe();I(()=>Nt(B,1,`flex items-center gap-2 p-3 rounded-lg border border-border bg-muted text-sm ${n()??""}`)),r(b,B)},q=b=>{var B=l(),lt=d(B);{var V=P=>{var K=ie();I(()=>Nt(K,1,`p-3 rounded-lg border border-border bg-muted text-sm text-destructive ${n()??""}`)),r(P,K)},S=P=>{var K=l(),Q=d(K);{var j=w=>{var H=l(),Y=d(H);{var L=p=>{var _=se();_.__click=O,_.__keydown=g=>g.key==="Enter"&&O(g);var F=_t(_);Z(F,()=>t(it),(g,v)=>{v(g,{get ndk(){return e.ndk},get event(){return t(C)}})}),mt(_),r(p,_)},T=p=>{var _=l(),F=d(_);Z(F,()=>t(it),(g,v)=>{v(g,{get ndk(){return e.ndk},get event(){return t(C)}})}),r(p,_)};c(Y,p=>{m?.onEventClick?p(L):p(T,!1)})}r(w,H)},A=w=>{var H=l(),Y=d(H);{var L=p=>{var _=l(),F=d(_);{var g=h=>{var y=le();y.__click=O,y.__keydown=x=>x.key==="Enter"&&O(x);var M=_t(y);Z(M,()=>t(st),(x,u)=>{u(x,{get ndk(){return e.ndk},get event(){return t(C)},get class(){return n()}})}),mt(y),r(h,y)},v=h=>{var y=l(),M=d(y);Z(M,()=>t(st),(x,u)=>{u(x,{get ndk(){return e.ndk},get event(){return t(C)},get class(){return n()}})}),r(h,y)};c(F,h=>{m?.onEventClick?h(g):h(v,!1)})}r(p,_)},T=p=>{var _=l(),F=d(_);{var g=v=>{var h=l(),y=d(h);{var M=u=>{var k=de();k.__click=O;var W=_t(k,!0);mt(k),I(()=>G(W,e.bech32)),r(u,k)},x=u=>{var k=fe(),W=_t(k,!0);mt(k),I(()=>G(W,e.bech32)),r(u,k)};c(y,u=>{m?.onEventClick?u(M):u(x,!1)})}r(v,h)};c(F,v=>{t(C)&&v(g)},!0)}r(p,_)};c(Y,p=>{t(st)&&t(C)?p(L):p(T,!1)},!0)}r(w,H)};c(Q,w=>{t(it)&&t(C)?w(j):w(A,!1)},!0)}r(P,K)};c(lt,P=>{t(z).error?P(V):P(S,!1)},!0)}r(b,B)};c(kt,b=>{t(z).loading?b(bt):b(q,!1)})}r(a,ht),St()}Ut(["click","keydown"]);var ve=X('<img class="inline-block w-[1.25em] h-[1.25em] align-middle mx-[0.1em]"/>'),ue=X('<img alt="" class="w-full h-auto object-cover rounded-lg aspect-square"/>'),me=X("<div></div>");function xe(a,e){Rt(e,!0);let n=Kt(e,"class",3,"");const s=It(yt),o=N(()=>e.renderer??s?.renderer??Ht);Ot(yt,{get renderer(){return t(o)}});const m=re(()=>({event:e.event,content:e.content,emojiTags:e.emojiTags}));var f=me();Tt(f,21,()=>m.segments,Ft,(E,i)=>{var z=l(),ot=d(z);{var it=C=>{var O=rt();I(()=>G(O,t(i).content)),r(C,O)},st=C=>{var O=l(),ht=d(O);{var kt=q=>{var b=l(),B=d(b);{var lt=V=>{var S=l(),P=d(S);{var K=j=>{const A=N(()=>t(o).mentionComponent);var w=l(),H=d(w);Z(H,()=>t(A),(Y,L)=>{L(Y,{get ndk(){return e.ndk},get bech32(){return t(i).data}})}),r(j,w)},Q=j=>{var A=rt();I(()=>G(A,t(i).content)),r(j,A)};c(P,j=>{t(o).mentionComponent?j(K):j(Q,!1)})}r(V,S)};c(B,V=>{t(i).data&&typeof t(i).data=="string"&&V(lt)})}r(q,b)},bt=q=>{var b=l(),B=d(b);{var lt=S=>{var P=l(),K=d(P);{var Q=j=>{ce(j,{get ndk(){return e.ndk},get bech32(){return t(i).data}})};c(K,j=>{t(i).data&&typeof t(i).data=="string"&&j(Q)})}r(S,P)},V=S=>{var P=l(),K=d(P);{var Q=A=>{var w=l(),H=d(w);{var Y=L=>{var T=l(),p=d(T);{var _=g=>{const v=N(()=>t(o).hashtagComponent);var h=l(),y=d(h);Z(y,()=>t(v),(M,x)=>{x(M,{get ndk(){return e.ndk},get tag(){return t(i).data}})}),r(g,h)},F=g=>{var v=rt();I(()=>G(v,`#${t(i).data??""}`)),r(g,v)};c(p,g=>{t(o).hashtagComponent?g(_):g(F,!1)})}r(L,T)};c(H,L=>{t(i).data&&typeof t(i).data=="string"&&L(Y)})}r(A,w)},j=A=>{var w=l(),H=d(w);{var Y=T=>{var p=l(),_=d(p);{var F=v=>{const h=N(()=>t(o).linkComponent);var y=l(),M=d(y);Z(M,()=>t(h),(x,u)=>{u(x,{get url(){return t(i).content}})}),r(v,y)},g=v=>{var h=rt();I(()=>G(h,t(i).content)),r(v,h)};c(_,v=>{t(o).linkComponent?v(F):v(g,!1)})}r(T,p)},L=T=>{var p=l(),_=d(p);{var F=v=>{var h=l(),y=d(h);{var M=u=>{const k=N(()=>t(o).mediaComponent);var W=l(),dt=d(W);Z(dt,()=>t(k),($,R)=>{R($,{get url(){return t(i).content}})}),r(u,W)},x=u=>{var k=rt();I(()=>G(k,t(i).content)),r(u,k)};c(y,u=>{t(o).mediaComponent?u(M):u(x,!1)})}r(v,h)},g=v=>{var h=l(),y=d(h);{var M=u=>{var k=l(),W=d(k);{var dt=$=>{var R=ve();I(()=>{Mt(R,"src",t(i).data),Mt(R,"alt",`:${t(i).content??""}:`)}),r($,R)};c(W,$=>{typeof t(i).data=="string"&&$(dt)})}r(u,k)},x=u=>{var k=l(),W=d(k);{var dt=R=>{var ft=l(),Ct=d(ft);{var xt=tt=>{var ct=l(),wt=d(ct);{var Et=D=>{const nt=N(()=>t(o).mediaComponent);var at=l(),ut=d(at);Z(ut,()=>t(nt),(U,J)=>{J(U,{get url(){return t(i).data}})}),r(D,at)},vt=D=>{var nt=l(),at=d(nt);Tt(at,17,()=>t(i).data,Ft,(ut,U)=>{var J=ue();I(()=>Mt(J,"src",t(U))),r(ut,J)}),r(D,nt)};c(wt,D=>{t(o).mediaComponent?D(Et):D(vt,!1)})}r(tt,ct)};c(Ct,tt=>{t(i).data&&Array.isArray(t(i).data)&&tt(xt)})}r(R,ft)},$=R=>{var ft=l(),Ct=d(ft);{var xt=tt=>{var ct=l(),wt=d(ct);{var Et=vt=>{var D=l(),nt=d(D);{var at=U=>{const J=N(()=>t(o).linkComponent);var pt=l(),Pt=d(pt);Z(Pt,()=>t(J),(jt,gt)=>{gt(jt,{get url(){return t(i).data}})}),r(U,pt)},ut=U=>{var J=l(),pt=d(J);Tt(pt,17,()=>t(i).data,Ft,(Pt,jt)=>{Bt();var gt=rt();I(()=>G(gt,t(jt))),r(Pt,gt)}),r(U,J)};c(nt,U=>{t(o).linkComponent?U(at):U(ut,!1)})}r(vt,D)};c(wt,vt=>{t(i).data&&Array.isArray(t(i).data)&&vt(Et)})}r(tt,ct)};c(Ct,tt=>{t(i).type==="link-group"&&tt(xt)},!0)}r(R,ft)};c(W,R=>{t(i).type==="image-grid"?R(dt):R($,!1)},!0)}r(u,k)};c(y,u=>{t(i).type==="emoji"?u(M):u(x,!1)},!0)}r(v,h)};c(_,v=>{t(i).type==="media"?v(F):v(g,!1)},!0)}r(T,p)};c(H,T=>{t(i).type==="link"?T(Y):T(L,!1)},!0)}r(A,w)};c(K,A=>{t(i).type==="hashtag"?A(Q):A(j,!1)},!0)}r(S,P)};c(B,S=>{t(i).type==="event-ref"?S(lt):S(V,!1)},!0)}r(q,b)};c(ht,q=>{t(i).type==="npub"||t(i).type==="nprofile"?q(kt):q(bt,!1)},!0)}r(C,O)};c(ot,C=>{t(i).type==="text"?C(it):C(st,!1)})}r(E,z)}),mt(f),I(()=>Nt(f,1,`whitespace-pre-wrap wrap-break-words leading-relaxed ${n()??""}`)),r(a,f),St()}export{yt as C,xe as E,Ht as a,ce as b,Jt as c,Gt as d};
