import{d as Oe,f as g,a as l,c as je,s as I,j as We,i as Te,t as Ge}from"./CiPFrJr-.js";import{p as Qe,b as Z,x as Be,a as Fe,g as e,s as u,u as z,c as Ke,d as f,e as a,f as me,r as o,t as D,y as Ie,$ as tt,z as nt,a1 as st}from"./CSbKtK4P.js";import{p as ge,i as P,b as He,d as it}from"./87vUJtvC.js";import{n as T,r as Je,g as rt,e as Ae,f as De,d as Ue,h as Ye,i as Ve,t as lt,m as Ze,o as dt}from"./D0X4VYcq.js";import{a as ze,p as qe}from"./DzBAiUtV.js";import{t as Se}from"./B0fEDaa-.js";import{u as ct}from"./B6l-2YVB.js";import{c as ot}from"./a7XEC-kH.js";import{B as Ne,D as ut,a as vt,b as ft}from"./DFMKmhYe.js";import{s as pt}from"./Dt5ZKhe2.js";import{b as Xe}from"./DphWBL27.js";import{b as $e}from"./I2MJeYPS.js";import{N as mt,c as gt}from"./B_cmhmk_.js";import{n as ht}from"./BSsXfEb0.js";import{R as et}from"./1JgFLIq6.js";var xt=g('<span class="ml-auto text-xs bg-primary/20 text-primary rounded-full px-2 py-0.5"> </span>'),bt=g('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <span> </span> <!>',1),_t=g('<span class="absolute -top-1 -right-1 text-[10px] bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center"> </span>'),yt=We('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><!>',1),wt=(w,t)=>w.key==="Escape"&&t(),kt=w=>w.stopPropagation(),Pt=w=>w.stopPropagation(),Mt=(w,t,n)=>{w.key==="Enter"&&e(t)&&n()},St=g('<button type="button" class="absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-xs font-medium transition-colors">Add</button>'),Ct=g('<p class="text-xs text-muted-foreground mt-1.5">Search follows or paste npub/hex/NIP-05</p>'),Et=(w,t,n)=>t(n),jt=g('<button type="button" class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 hover:bg-primary/30 text-foreground rounded-full text-xs transition-colors"><!> <span class="max-w-[100px] truncate"> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Bt=g('<div class="px-3 py-2 border-b border-border bg-muted/30"><div class="text-xs font-medium text-muted-foreground mb-2"> </div> <div class="flex flex-wrap gap-1.5"></div></div>'),Rt=g('<div class="text-center py-8 px-3 text-muted-foreground text-sm"> </div>'),Ut=(w,t,n)=>t(n),Tt=g('<div class="text-xs text-muted-foreground truncate"> </div>'),At=We('<svg class="w-3 h-3 text-primary-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),Dt=g("<div><!></div>"),zt=g('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div> <!></button>'),Lt=g('<div class="p-2 space-y-1"></div>'),It=g('<div role="presentation" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"><div role="dialog" tabindex="-1" style="width: 380px;" class="bg-card border border-border rounded-lg shadow-xl overflow-hidden"><div class="flex flex-col max-h-[400px]"><div class="p-3 border-b border-border"><h3 class="font-semibold text-sm mb-2">Tag people</h3> <div class="relative"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search or paste npub/identifier..." class="w-full pl-8 pr-16 py-2 bg-muted border border-border rounded-lg text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <!></div> <!></div> <!> <div class="overflow-y-auto flex-1"><!></div></div></div></div>'),Nt=(w,t,n)=>{w.key==="Enter"&&e(t)&&n()},Ft=g('<button type="button" class="absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-xs font-medium transition-colors">Add</button>'),Wt=g('<p class="text-xs text-muted-foreground mt-1.5">Search follows or paste npub/hex/NIP-05</p>'),qt=(w,t,n)=>t(n),Ot=g('<button type="button" class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 hover:bg-primary/30 text-foreground rounded-full text-xs transition-colors"><!> <span class="max-w-[100px] truncate"> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Qt=g('<div class="px-3 py-2 border-b border-border bg-muted/30"><div class="text-xs font-medium text-muted-foreground mb-2"> </div> <div class="flex flex-wrap gap-1.5"></div></div>'),Kt=g('<div class="text-center py-8 px-3 text-muted-foreground text-sm"> </div>'),Ht=(w,t,n)=>t(n),Vt=g('<div class="text-xs text-muted-foreground truncate"> </div>'),Yt=We('<svg class="w-3 h-3 text-primary-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),Xt=g("<div><!></div>"),Gt=g('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div> <!></button>'),Jt=g('<div class="p-2 space-y-1"></div>'),Zt=g('<div class="bg-card border border-border rounded-lg shadow-xl z-50 overflow-hidden"><div class="flex flex-col max-h-[400px]"><div class="p-3 border-b border-border"><h3 class="font-semibold text-sm mb-2">Tag people</h3> <div class="relative"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search or paste npub/identifier..." class="w-full pl-8 pr-16 py-2 bg-muted border border-border rounded-lg text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <!></div> <!></div> <!> <div class="overflow-y-auto flex-1"><!></div></div></div>'),$t=g('<div class="relative"><!> <!></div>');function er(w,t){Qe(t,!0);let n=ge(t,"selectedPubkeys",31,()=>Be([])),A=ge(t,"multiple",3,!0),X=ge(t,"buttonClass",3,""),$=ge(t,"disabled",3,!1),k=ge(t,"iconOnly",3,!0),R=ge(t,"open",15,!1),C=Z(""),N=null,F=Z(Be({top:0,left:0,width:0}));const ae=T.$currentUser,he=T.$subscribe(()=>ae?.pubkey?{filters:[{kinds:[3],authors:[ae.pubkey],limit:1}],bufferMs:100}:void 0),b=z(()=>{const m=he.events[0];return m?new Set(m.tags.filter(x=>x[0]==="p").map(x=>x[1])):new Set});let M=Z(Be(new Map));const ee=z(()=>e(C)?Array.from(e(M).entries()).filter(([x])=>e(b).has(x)).map(([x])=>x).slice(0,50):Array.from(e(b)).slice(0,50));Fe(()=>{if(!e(C).trim()||!T.cacheAdapter?.getProfiles){u(M,new Map,!0);return}const m=e(C).toLowerCase();T.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:m}).then(x=>{u(M,x??new Map,!0)}).catch(x=>{console.error("Failed to search profiles:",x),u(M,new Map,!0)})});function G(){if(!R()&&N){const m=N.getBoundingClientRect();u(F,{top:m.bottom+4,left:m.left,width:Math.max(m.width,380)},!0)}R(!R())}const fe=z(()=>X().includes("hidden"));Fe(()=>{if(R()&&e(fe)){const m=window.innerWidth,x=window.innerHeight,se=380;u(F,{top:(x-400)/2,left:(m-se)/2,width:se},!0)}});function ke(m){A()?n().includes(m)?n(n().filter(x=>x!==m)):n([...n(),m]):(n([m]),R(!1)),t.onSelect?.(n())}function ne(m){n(n().filter(x=>x!==m)),t.onSelect?.(n())}async function Pe(){if(e(C).trim())try{const m=e(C).trim(),x=await T.fetchUser(m);x?.pubkey?(A()?n().includes(x.pubkey)||(n([...n(),x.pubkey]),t.onSelect?.(n()),Se.success("User added")):(n([x.pubkey]),t.onSelect?.(n()),R(!1)),u(C,"")):Se.error("User not found")}catch(m){console.error("Failed to fetch user:",m),Se.error("Failed to fetch user")}}function v(){R(!1)}const re=z(()=>{const m=e(C).trim();return m.length>0&&(m.startsWith("npub1")||m.startsWith("nprofile1")||m.includes("@")||m.length===64&&/^[0-9a-f]+$/i.test(m))});var H=$t(),be=a(H);{let m=z(()=>k()?"icon":"default"),x=z(()=>k()?"h-8 w-8":"w-full justify-start"),se=z(X),Ee=z(()=>t.buttonLabel||"Tag people");Ne(be,{type:"button",variant:"ghost",get size(){return e(m)},get class(){return`${e(x)??""} ${e(se)??""}`},get disabled(){return $()},onclick:G,get title(){return e(Ee)},get ref(){return N},set ref(ye){N=ye},children:(ye,te)=>{var W=je(),Q=me(W);{var q=V=>{var Y=bt(),oe=f(me(Y),2),we=a(oe,!0);o(oe);var le=f(oe,2);{var de=U=>{var L=xt(),r=a(L,!0);o(L),D(()=>I(r,n().length)),l(U,L)};P(le,U=>{n().length>0&&U(de)})}D(()=>I(we,t.buttonLabel)),l(V,Y)},ie=V=>{var Y=yt(),oe=f(me(Y));{var we=le=>{var de=_t(),U=a(de,!0);o(de),D(()=>I(U,n().length)),l(le,de)};P(oe,le=>{n().length>0&&le(we)})}l(V,Y)};P(Q,V=>{!k()&&t.buttonLabel?V(q):V(ie,!1)})}l(ye,W)},$$slots:{default:!0}})}var _e=f(be,2);{var Ce=m=>{var x=je(),se=me(x);{var Ee=te=>{var W=It();W.__click=v,W.__keydown=[wt,v];var Q=a(W);Q.__click=[kt],Q.__keydown=[Pt];var q=a(Q),ie=a(q),V=f(a(ie),2),Y=f(a(V),2);Je(Y),Y.__keydown=[Mt,re,Pe];var oe=f(Y,2);{var we=i=>{var p=St();p.__click=Pe,l(i,p)};P(oe,i=>{e(re)&&i(we)})}o(V);var le=f(V,2);{var de=i=>{var p=Ct();l(i,p)};P(le,i=>{e(C)||i(de)})}o(ie);var U=f(ie,2);{var L=i=>{var p=Bt(),_=a(p),j=a(_);o(_);var B=f(_,2);Ae(B,20,n,S=>S,(S,y)=>{const h=z(()=>T.$fetchProfile(()=>y));var E=jt();E.__click=[Et,ne,y];var O=a(E);De(O,{get ndk(){return T},get pubkey(){return y},size:14,class:"flex-shrink-0"});var J=f(O,2),ce=a(J,!0);o(J),Ie(2),o(E),D(xe=>I(ce,xe),[()=>e(h)?.displayName||e(h)?.name||`${y.slice(0,8)}...`]),l(S,E)}),o(B),o(p),D(()=>I(j,`Selected (${n().length??""})`)),l(i,p)};P(U,i=>{n().length>0&&i(L)})}var r=f(U,2),s=a(r);{var c=i=>{var p=Rt(),_=a(p,!0);o(p),D(()=>I(_,e(C)?"No matches found":"You don't follow anyone yet")),l(i,p)},d=i=>{var p=Lt();Ae(p,20,()=>e(ee),_=>_,(_,j)=>{const B=z(()=>T.$fetchProfile(()=>j)),S=z(()=>n().includes(j));var y=zt();y.__click=[Ut,ke,j];var h=a(y);De(h,{get ndk(){return T},get pubkey(){return j},size:32,class:"flex-shrink-0"});var E=f(h,2),O=a(E),J=a(O,!0);o(O);var ce=f(O,2);{var xe=K=>{var ue=Tt(),ve=a(ue,!0);o(ue),D(()=>I(ve,e(B).nip05)),l(K,ue)};P(ce,K=>{e(B)?.nip05&&K(xe)})}o(E);var Re=f(E,2);{var pe=K=>{var ue=Dt(),ve=a(ue);{var Me=Le=>{var at=At();l(Le,at)};P(ve,Le=>{e(S)&&Le(Me)})}o(ue),D(()=>Ue(ue,1,`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${e(S)?"bg-primary border-primary":"border-border"}`)),l(K,ue)};P(Re,K=>{A()&&K(pe)})}o(y),D(K=>{Ue(y,1,`w-full flex items-center gap-2 p-2 rounded-md transition-colors ${e(S)?"bg-primary/20":"hover:bg-muted"}`),I(J,K)},[()=>e(B)?.displayName||e(B)?.name||`${j.slice(0,8)}...`]),l(_,y)}),o(p),l(i,p)};P(s,i=>{e(ee).length===0?i(c):i(d,!1)})}o(r),o(q),o(Q),o(W),ze(W,i=>qe?.(i)),Xe(Y,()=>e(C),i=>u(C,i)),l(te,W)},ye=te=>{var W=Zt(),Q=a(W),q=a(Q),ie=f(a(q),2),V=f(a(ie),2);Je(V),V.__keydown=[Nt,re,Pe];var Y=f(V,2);{var oe=d=>{var i=Ft();i.__click=Pe,l(d,i)};P(Y,d=>{e(re)&&d(oe)})}o(ie);var we=f(ie,2);{var le=d=>{var i=Wt();l(d,i)};P(we,d=>{e(C)||d(le)})}o(q);var de=f(q,2);{var U=d=>{var i=Qt(),p=a(i),_=a(p);o(p);var j=f(p,2);Ae(j,20,n,B=>B,(B,S)=>{const y=z(()=>T.$fetchProfile(()=>S));var h=Ot();h.__click=[qt,ne,S];var E=a(h);De(E,{get ndk(){return T},get pubkey(){return S},size:14,class:"flex-shrink-0"});var O=f(E,2),J=a(O,!0);o(O),Ie(2),o(h),D(ce=>I(J,ce),[()=>e(y)?.displayName||e(y)?.name||`${S.slice(0,8)}...`]),l(B,h)}),o(j),o(i),D(()=>I(_,`Selected (${n().length??""})`)),l(d,i)};P(de,d=>{n().length>0&&d(U)})}var L=f(de,2),r=a(L);{var s=d=>{var i=Kt(),p=a(i,!0);o(i),D(()=>I(p,e(C)?"No matches found":"You don't follow anyone yet")),l(d,i)},c=d=>{var i=Jt();Ae(i,20,()=>e(ee),p=>p,(p,_)=>{const j=z(()=>T.$fetchProfile(()=>_)),B=z(()=>n().includes(_));var S=Gt();S.__click=[Ht,ke,_];var y=a(S);De(y,{get ndk(){return T},get pubkey(){return _},size:32,class:"flex-shrink-0"});var h=f(y,2),E=a(h),O=a(E,!0);o(E);var J=f(E,2);{var ce=pe=>{var K=Vt(),ue=a(K,!0);o(K),D(()=>I(ue,e(j).nip05)),l(pe,K)};P(J,pe=>{e(j)?.nip05&&pe(ce)})}o(h);var xe=f(h,2);{var Re=pe=>{var K=Xt(),ue=a(K);{var ve=Me=>{var Le=Yt();l(Me,Le)};P(ue,Me=>{e(B)&&Me(ve)})}o(K),D(()=>Ue(K,1,`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${e(B)?"bg-primary border-primary":"border-border"}`)),l(pe,K)};P(xe,pe=>{A()&&pe(Re)})}o(S),D(pe=>{Ue(S,1,`w-full flex items-center gap-2 p-2 rounded-md transition-colors ${e(B)?"bg-primary/20":"hover:bg-muted"}`),I(O,pe)},[()=>e(j)?.displayName||e(j)?.name||`${_.slice(0,8)}...`]),l(p,S)}),o(i),l(d,i)};P(r,d=>{e(ee).length===0?d(s):d(c,!1)})}o(L),o(Q),o(W),ze(W,d=>qe?.(d)),ze(W,(d,i)=>ot?.(d,i),()=>v),D(()=>rt(W,`position: fixed; top: ${e(F).top??""}px; left: ${e(F).left??""}px; width: 380px;`)),Xe(V,()=>e(C),d=>u(C,d)),l(te,W)};P(se,te=>{e(fe)?te(Ee):te(ye,!1)})}l(m,x)};P(_e,m=>{R()&&m(Ce)})}o(H),l(w,H),Ke()}Oe(["click","keydown"]);var tr=(w,t,n)=>t(n),rr=g('<div class="text-xs text-muted-foreground truncate"> </div>'),or=g('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div></button>'),ar=g('<div class="bg-card border border-border rounded-lg shadow-xl z-50 overflow-hidden"><div class="max-h-[300px] overflow-y-auto"></div></div>');function nr(w,t){Qe(t,!0);const n=T.$currentUser;let A=Z(0);const X=T.$subscribe(()=>n?.pubkey?{filters:[{kinds:[3],authors:[n.pubkey],limit:1}],bufferMs:100}:void 0),$=z(()=>{const b=X.events[0];return b?new Set(b.tags.filter(M=>M[0]==="p").map(M=>M[1])):new Set});let k=Z(Be(new Map));const R=z(()=>t.searchQuery?Array.from(e(k).entries()).filter(([M])=>e($).has(M)).map(([M])=>M).slice(0,10):Array.from(e($)).slice(0,10));Fe(()=>{if(!t.searchQuery.trim()||!T.cacheAdapter?.getProfiles){u(k,new Map,!0);return}const b=t.searchQuery.toLowerCase();T.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:b}).then(M=>{u(k,M??new Map,!0)}).catch(M=>{console.error("Failed to search profiles:",M),u(k,new Map,!0)})}),Fe(()=>{e(A)>=e(R).length&&u(A,Math.max(0,e(R).length-1),!0)});function C(b){const M=T.getUser({pubkey:b}),ee=Array.from(M.relayUrls||[]),G=ht.nprofileEncode({pubkey:b,relays:ee.slice(0,3)});t.onSelect(`nostr:${G}`)}function N(b){switch(b.key){case"ArrowDown":b.preventDefault(),u(A,(e(A)+1)%e(R).length);break;case"ArrowUp":b.preventDefault(),u(A,e(A)===0?e(R).length-1:e(A)-1,!0);break;case"Enter":b.preventDefault(),e(R).length>0&&C(e(R)[e(A)]);break;case"Escape":b.preventDefault(),t.onClose();break}}var F=je();Te("keydown",tt,N);var ae=me(F);{var he=b=>{var M=ar(),ee=a(M);Ae(ee,22,()=>e(R),G=>G,(G,fe,ke)=>{const ne=z(()=>T.$fetchProfile(()=>fe)),Pe=z(()=>e(ke)===e(A));var v=or();v.__click=[tr,C,fe];var re=a(v);De(re,{get ndk(){return T},get pubkey(){return fe},size:32,class:"flex-shrink-0"});var H=f(re,2),be=a(H),_e=a(be,!0);o(be);var Ce=f(be,2);{var m=x=>{var se=rr(),Ee=a(se,!0);o(se),D(()=>I(Ee,e(ne).nip05)),l(x,se)};P(Ce,x=>{e(ne)?.nip05&&x(m)})}o(H),o(v),D(()=>{Ue(v,1,`w-full flex items-center gap-2 p-2 transition-colors ${e(Pe)?"bg-primary/20":"hover:bg-muted"}`),I(_e,e(ne)?.displayName||e(ne)?.name||"Anonymous")}),Te("mouseenter",v,()=>u(A,e(ke),!0)),l(G,v)}),o(ee),o(M),ze(M,G=>qe?.(G)),D(()=>rt(M,`position: fixed; top: ${t.position.top??""}px; left: ${t.position.left??""}px; max-width: 320px;`)),l(b,M)};P(ae,b=>{e(R).length>0&&b(he)})}l(w,F),Ke()}Oe(["click"]);function sr(w,t,n,A,X,$){const k=w.target,R=k.selectionStart,C=k.value.substring(0,R),N=C.lastIndexOf("@");if(N!==-1){const F=C.substring(N+1),ae=N>0?C[N-1]:" ",he=F.includes(" ")||F.includes(`
`);if((ae===" "||ae===`
`||N===0)&&!he){u(t,N,!0),u(n,F,!0),u(A,X(),!0),u($,!0);return}}u($,!1)}function ir(w){w.key==="Enter"&&w.stopPropagation()}var lr=g('<div class="absolute inset-0 flex items-center justify-center"><div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div></div>'),dr=g('<button type="button" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),cr=g('<div class="relative group"><img alt="Upload preview"/> <!></div>'),ur=g('<div class="flex flex-wrap gap-2 mt-2"></div>'),vr=We('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),fr=g('<div><input type="file" accept="image/*" multiple class="hidden"/> <div><textarea class="w-full min-h-[120px] max-md:flex-1 max-md:min-h-0 bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none focus:ring-0 text-lg"></textarea> <!></div> <div class="flex items-center gap-2 mt-2 pt-2 border-t border-border"><!> <!> <!></div></div> <!>',1);function pr(w,t){Qe(t,!0);let n=ge(t,"value",15,""),A=ge(t,"placeholder",3,"What's on your mind?"),X=ge(t,"autofocus",3,!1),$=ge(t,"disabled",3,!1),k=ge(t,"class",3,""),R=ge(t,"selectedMentions",31,()=>Be([]));const C=new mt(T),N=gt(C);let F,ae,he=Z(!1),b=Z(Be([])),M=Z(!1),ee=Z(!1),G=Z(""),fe=Z(0),ke=Z(Be({top:0,left:0}));async function ne(r){if(!r.type.startsWith("image/")){Se.error("Please select an image file");return}const s=URL.createObjectURL(r),c=e(b).length;u(b,[...e(b),{url:"",preview:s}],!0),u(M,!0);try{await N.upload(r,{fallbackServer:"https://blossom.primal.net"}),N.result?.url&&(e(b)[c]={url:N.result.url,preview:s},Pe(N.result.url),Se.success("Image uploaded"))}catch(d){console.error("Upload failed:",d),Se.error("Failed to upload image"),u(b,e(b).filter((i,p)=>p!==c),!0)}finally{u(M,!1)}}function Pe(r){const s=F;if(!s)return;const c=s.selectionStart,d=s.selectionEnd,i=`
${r}
`;n(n().slice(0,c)+i+n().slice(d)),setTimeout(()=>{s.selectionStart=s.selectionEnd=c+i.length,s.focus()},0)}function v(r){const s=e(b)[r];s.url&&n(n().replace(`
${s.url}
`,"").replace(s.url,"")),URL.revokeObjectURL(s.preview),u(b,e(b).filter((c,d)=>d!==r),!0)}function re(r){const s=r.target,c=s.files?.[0];c&&ne(c),s.value=""}function H(r){r.preventDefault(),u(he,!0)}function be(r){r.preventDefault(),u(he,!1)}async function _e(r){r.preventDefault(),u(he,!1);const s=r.dataTransfer?.files;if(s&&s.length>0)for(const c of Array.from(s))c.type.startsWith("image/")&&await ne(c)}async function Ce(r){const s=r.clipboardData?.items;if(s){for(const c of Array.from(s))if(c.type.startsWith("image/")){r.preventDefault();const d=c.getAsFile();d&&await ne(d)}}}function m(){ae?.click()}function x(){if(!F)return{top:0,left:0};const r=F,s=r.selectionStart,c=document.createElement("div"),d=window.getComputedStyle(r);["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(S=>{c.style[S]=d[S]}),c.style.position="absolute",c.style.visibility="hidden",c.style.whiteSpace="pre-wrap",c.style.wordWrap="break-word",document.body.appendChild(c);const p=r.value.substring(0,s);c.textContent=p;const _=document.createElement("span");_.textContent=r.value.substring(s)||".",c.appendChild(_);const j=r.getBoundingClientRect(),B={top:j.top+_.offsetTop+parseInt(d.borderTopWidth)-r.scrollTop+20,left:j.left+_.offsetLeft+parseInt(d.borderLeftWidth)};return document.body.removeChild(c),B}function se(r){const s=F;if(!s)return;const c=s.selectionStart,d=n().substring(0,e(fe)),i=n().substring(c);n(d+r+" "+i);const p=e(fe)+r.length+1;setTimeout(()=>{s.selectionStart=s.selectionEnd=p,s.focus()},0),u(ee,!1),u(G,"")}function Ee(){u(ee,!1),u(G,"")}var ye=fr(),te=me(ye),W=a(te);W.__change=re,$e(W,r=>ae=r,()=>ae);var Q=f(W,2),q=a(Q);nt(q),st(q,X()),q.__input=[sr,fe,G,ke,x,ee],q.__keydown=[ir],$e(q,r=>F=r,()=>F);var ie=f(q,2);{var V=r=>{var s=ur();Ae(s,23,()=>e(b),c=>c.preview,(c,d,i)=>{var p=cr(),_=a(p),j=f(_,2);{var B=y=>{var h=lr();l(y,h)},S=y=>{var h=dr();h.__click=()=>v(e(i)),l(y,h)};P(j,y=>{e(d).url?y(S,!1):y(B)})}o(p),D(()=>{Ye(_,"src",e(d).preview),Ue(_,1,`w-20 h-20 object-cover rounded-lg border border ${e(d).url?"":"opacity-50 animate-pulse"}`)}),l(c,p)}),o(s),l(r,s)};P(ie,r=>{e(b).length>0&&r(V)})}o(Q);var Y=f(Q,2),oe=a(Y);{var we=r=>{var s=je(),c=me(s);pt(c,()=>t.relayButton),l(r,s)};P(oe,r=>{t.relayButton&&r(we)})}var le=f(oe,2);{let r=z(()=>$()||e(M));Ne(le,{type:"button",variant:"ghost",size:"icon",onclick:m,get disabled(){return e(r)},class:"h-8 w-8",title:"Add image",children:(s,c)=>{var d=vr();l(s,d)},$$slots:{default:!0}})}var de=f(le,2);er(de,{get onSelect(){return t.onMentionsChange},get disabled(){return $()},get selectedPubkeys(){return R()},set selectedPubkeys(r){R(r)}}),o(Y),o(te);var U=f(te,2);{var L=r=>{nr(r,{get position(){return e(ke)},get searchQuery(){return e(G)},onSelect:se,onClose:Ee})};P(U,r=>{e(ee)&&r(L)})}D(()=>{Ue(te,1,`relative flex-1 flex flex-col ${k()??""}`),Ue(Q,1,`flex-1 flex flex-col ${e(he)?"ring-2 ring-primary ring-offset-2 rounded-lg":""}`),Ye(q,"placeholder",A()),q.disabled=$()}),Te("dragover",Q,H),Te("dragleave",Q,be),Te("drop",Q,_e),Te("paste",q,Ce),Xe(q,n),l(w,ye),Ke()}Oe(["change","input","keydown","click"]);var mr=We('<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>'),gr=g('<div class="-mx-6 px-4 py-3 mb-4 border-b border-border bg-card/50"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),hr=g('<img alt="" class="w-5 h-5 rounded border border-background"/>'),xr=g('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),br=g('<div class="flex items-center -space-x-1"></div>'),_r=g('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),yr=g('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),wr=(w,t)=>w.key==="Escape"&&t(),kr=w=>w.stopPropagation(),Pr=w=>w.stopPropagation(),Mr=g('<div role="presentation" class="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity"><div role="dialog" tabindex="-1" class="bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto"><!></div></div>'),Sr=g('<div class="absolute top-full left-0 mt-2 bg-popover border border-border rounded-lg shadow-xl z-[100] w-80 max-h-[400px] overflow-y-auto transition-all duration-200"><!></div>'),Cr=g('<div class="relative"><!> <!></div>'),Er=g('<div class="-mx-6 px-4 py-3 mb-4 border-y border-border bg-muted/30"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="flex gap-3 border-l-2 border-primary/50 pl-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),jr=g('<div class="flex items-center justify-between -mx-6 -mt-6 px-4 py-3 mb-4 border-b border-border"><!> <!> <!></div> <!> <div class="relative mb-4 max-md:flex-1 max-md:flex max-md:flex-col max-md:overflow-hidden"><div class="max-md:flex-1 max-md:overflow-hidden"><!></div></div> <!> <div class="-mx-6 px-4 py-3 border-t border-border"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel, <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">⌘</kbd> + <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Enter</kbd> to post</p></div>',1);function Kr(w,t){Qe(t,!0);let n=ge(t,"open",15,!1),A=Z(""),X=Z(!1),$=Z(!1),k=Z(Be([])),R=Z(!1),C=Z(Be([]));const N=z(()=>t.replyTo?T.$fetchProfile(()=>t.replyTo.pubkey):null),F=z(()=>t.quotedEvent?T.$fetchProfile(()=>t.quotedEvent.pubkey):null),ae=z(()=>Ve.relays.filter(v=>v.enabled)),he=z(()=>it&&window.innerWidth<768);Fe(()=>{n()&&(Ve.selectedRelay?u(k,[Ve.selectedRelay],!0):e(k).length===0&&u(k,e(ae).filter(v=>v.write).map(v=>v.url),!0))});async function b(){if(!(!e(A).trim()||e(X)||e(k).length===0))try{u(X,!0);let v;t.replyTo?v=t.replyTo.reply():t.quotedEvent?(v=new Ze(T),v.kind=1,v.tags.push(["q",t.quotedEvent.id]),v.tags.push(["p",t.quotedEvent.pubkey])):(v=new Ze(T),v.kind=1),v.content=e(A),t.replyTo||(v.isProtected=e(R)),e(C).forEach(H=>{v.tags.push(["p",H])}),await v.sign();const re=dt.fromRelayUrls(e(k),T);if(await v.publish(re),v.publishStatus==="error"){const H=v.publishError;console.error("Publish error object:",H),console.error("Relay errors:",H?.relayErrors);const be=H?.relayErrors||{},_e=Object.entries(be);if(_e.length>0){const Ce=_e.map(([m,x])=>`• ${m.replace("wss://","")}: ${x}`).join(`
`);Se.error(`Failed to publish to relays:

${Ce}`)}else Se.error(`Failed to publish: ${H?.message||"Not enough relays received the event"}`);return}u(A,""),u(C,[],!0),n(!1),Se.success(t.replyTo?"Reply published":t.quotedEvent?"Quote published":"Note published"),t.onPublished?.(),t.onClose?.()}catch(v){console.error("Failed to publish note:",v),Se.error(`Failed to publish: ${v instanceof Error?v.message:"Unknown error"}`)}finally{u(X,!1)}}function M(v){e(k).includes(v)?u(k,e(k).filter(re=>re!==v),!0):u(k,[...e(k),v],!0)}function ee(v){u(k,[v],!0),u($,!1)}function G(){u($,!1)}function fe(){e(X)||(n(!1),u(A,""),u(C,[],!0),t.onClose?.())}function ke(v){(v.metaKey||v.ctrlKey)&&v.key==="Enter"&&b()}var ne=je();Te("keydown",tt,ke);var Pe=me(ne);He(Pe,()=>ft,(v,re)=>{re(v,{get open(){return n()},onOpenChange:H=>{H?n(!0):fe()},children:(H,be)=>{var _e=je(),Ce=me(_e);He(Ce,()=>ut,(m,x)=>{x(m,{class:"max-md:!max-w-none max-md:!w-full max-md:!h-[95vh] md:max-w-2xl max-md:!m-0 max-md:!rounded-b-none max-md:!fixed max-md:!bottom-0 max-md:!left-0 max-md:!right-0 max-md:!top-auto max-md:!translate-x-0 max-md:!translate-y-0 max-md:flex max-md:flex-col !overflow-visible",children:(se,Ee)=>{var ye=jr(),te=me(ye),W=a(te);Ne(W,{variant:"ghost",size:"icon",onclick:fe,get disabled(){return e(X)},class:"h-10 w-10",children:(U,L)=>{var r=mr();l(U,r)},$$slots:{default:!0}});var Q=f(W,2);He(Q,()=>vt,(U,L)=>{L(U,{class:"text-lg",children:(r,s)=>{Ie();var c=Ge();D(()=>I(c,t.replyTo?"Reply":t.quotedEvent?"Quote":"Compose")),l(r,c)},$$slots:{default:!0}})});var q=f(Q,2);{let U=z(()=>!e(A).trim()||e(X)||e(k).length===0);Ne(q,{onclick:b,get disabled(){return e(U)},class:"rounded-full",size:"sm",children:(L,r)=>{Ie();var s=Ge();D(()=>I(s,e(X)?"Publishing...":"Post")),l(L,s)},$$slots:{default:!0}})}o(te);var ie=f(te,2);{var V=U=>{var L=gr(),r=a(L),s=a(r);De(s,{get ndk(){return T},get pubkey(){return t.replyTo.pubkey},class:"w-10 h-10"});var c=f(s,2),d=a(c),i=a(d),p=a(i,!0);o(i);var _=f(i,2),j=a(_);o(_),o(d);var B=f(d,2),S=a(B,!0);o(B),o(c),o(r),o(L),D((y,h)=>{I(p,y),I(j,`@${h??""}`),I(S,t.replyTo.content)},[()=>e(N).displayName||e(N).name||`${t.replyTo.pubkey.slice(0,8)}...`,()=>e(N).name||t.replyTo.pubkey.slice(0,8)]),l(U,L)};P(ie,U=>{t.replyTo&&e(N)&&U(V)})}var Y=f(ie,2),oe=a(Y),we=a(oe);{const U=r=>{var s=Cr(),c=a(s);Ne(c,{type:"button",variant:"ghost",size:"icon",onclick:()=>u($,!e($)),get disabled(){return e(X)},class:"h-8 w-8",title:"Select relays",children:(p,_)=>{var j=je(),B=me(j);{var S=h=>{var E=br();Ae(E,21,()=>e(k),lt,(O,J)=>{const ce=z(()=>e(ae).find(ve=>ve.url===e(J))),xe=z(()=>e(ce)?ct(e(ce).url):null);var Re=je(),pe=me(Re);{var K=ve=>{var Me=hr();D(()=>Ye(Me,"src",e(xe).info.icon)),l(ve,Me)},ue=ve=>{var Me=xr();l(ve,Me)};P(pe,ve=>{e(xe)?.info?.icon?ve(K):ve(ue,!1)})}l(O,Re)}),o(E),l(h,E)},y=h=>{var E=yr(),O=f(a(E),2);{var J=ce=>{var xe=_r(),Re=a(xe,!0);o(xe),D(()=>I(Re,e(k).length)),l(ce,xe)};P(O,ce=>{e(k).length>2&&ce(J)})}o(E),l(h,E)};P(B,h=>{e(k).length<=2&&e(k).length>0?h(S):h(y,!1)})}l(p,j)},$$slots:{default:!0}});var d=f(c,2);{var i=p=>{var _=je(),j=me(_);{var B=y=>{var h=Mr();h.__click=G,h.__keydown=[wr,G];var E=a(h);E.__click=[kr],E.__keydown=[Pr];var O=a(E);et(O,{get selectedRelayUrls(){return e(k)},onToggleRelay:M,onSelectOnly:ee,get isProtected(){return e(R)},set isProtected(J){u(R,J,!0)}}),o(E),o(h),ze(h,J=>qe?.(J)),l(y,h)},S=y=>{var h=Sr(),E=a(h);et(E,{get selectedRelayUrls(){return e(k)},onToggleRelay:M,onSelectOnly:ee,get isProtected(){return e(R)},set isProtected(O){u(R,O,!0)}}),o(h),ze(h,(O,J)=>ot?.(O,J),()=>G),l(y,h)};P(j,y=>{e(he)?y(B):y(S,!1)})}l(p,_)};P(d,p=>{e($)&&p(i)})}o(s),l(r,s)};let L=z(()=>t.replyTo?"Write your reply...":t.quotedEvent?"Add your thoughts...":"What's on your mind?");pr(we,{get placeholder(){return e(L)},autofocus:!0,get disabled(){return e(X)},class:"max-md:flex-1 max-md:overflow-hidden",get value(){return e(A)},set value(r){u(A,r,!0)},get selectedMentions(){return e(C)},set selectedMentions(r){u(C,r,!0)},relayButton:U,$$slots:{relayButton:!0}})}o(oe),o(Y);var le=f(Y,2);{var de=U=>{var L=Er(),r=f(a(L),2),s=a(r);De(s,{get ndk(){return T},get pubkey(){return t.quotedEvent.pubkey},class:"w-8 h-8"});var c=f(s,2),d=a(c),i=a(d),p=a(i,!0);o(i);var _=f(i,2),j=a(_);o(_),o(d);var B=f(d,2),S=a(B,!0);o(B),o(c),o(r),o(L),D((y,h)=>{I(p,y),I(j,`@${h??""}`),I(S,t.quotedEvent.content)},[()=>e(F).displayName||e(F).name||`${t.quotedEvent.pubkey.slice(0,8)}...`,()=>e(F).name||t.quotedEvent.pubkey.slice(0,8)]),l(U,L)};P(le,U=>{t.quotedEvent&&e(F)&&U(de)})}Ie(2),l(se,ye)},$$slots:{default:!0}})}),l(H,_e)},$$slots:{default:!0}})}),l(w,ne),Ke()}Oe(["click","keydown"]);export{Kr as C,er as U,pr as a};
