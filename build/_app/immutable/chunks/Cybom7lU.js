import{c as me,a as n,f as S,s as R,j as de,t as le,i as fe,d as Pe}from"./CiPFrJr-.js";import{p as be,a as He,g as t,u as F,s as h,b as ie,f as $,c as xe,d as o,e as a,r,t as G,y as ce,x as Ze,$ as Se}from"./CSbKtK4P.js";import{i as j,p as he,b as ye}from"./87vUJtvC.js";import{u as De,a5 as Ie,n as ee,h as _e,f as Le,g as ze,S as Be,i as Ne,e as Fe,d as ve,t as Re,a6 as Ve}from"./D0X4VYcq.js";import{b as Ke}from"./I2MJeYPS.js";import{n as Oe}from"./BSsXfEb0.js";import{F as Qe}from"./DKw2pikm.js";import{T as Ue}from"./ChQzK9Kk.js";import{a as Me}from"./DzBAiUtV.js";import{t as ue}from"./B0fEDaa-.js";import{c as Ae}from"./a7XEC-kH.js";import{C as je}from"./CGbTV4zP.js";import{D as We,a as qe,B as Ce,L as Ge,b as Je}from"./DFMKmhYe.js";import{I as Xe,a as Ye}from"./C8b5RDJU.js";import{D as $e}from"./Do6nhxsB.js";import{E as et}from"./BvCfGrRH.js";async function tt(s,e,v,d){if(console.log("[zap] Starting zap flow",{target:e instanceof De?"event":"user",targetId:e.id||e.pubkey,amount:v,unit:"msat",comment:d?.comment}),!s.wallet)throw console.error("[zap] No wallet connected"),new Error("No wallet connected");if(!s.$currentPubkey)throw console.error("[zap] No active session"),new Error("No active session");const u=new Ie(e,v,"msat",{comment:d?.comment});s.$payments.addPending(u,s.$currentPubkey),console.log("[zap] Added pending payment to tracking"),console.log("[zap] Executing zap immediately");try{const m=await u.zap(),T=Array.from(m.values()).filter(b=>b instanceof Error);return T.length>0?console.warn("[zap] Zap completed with some failures",{total:m.size,failed:T.length,errors:T.map(b=>b.message)}):console.log("[zap] Zap completed successfully",m),m}catch(m){throw console.error("[zap] Zap failed completely",m),m}}var rt=S('<div class="flex items-center gap-1 mb-2 text-sm text-muted-foreground"><span>Replying to</span> <a class="font-medium hover:underline text-muted-foreground"> </a></div>'),at=S('<div class="flex items-center gap-1 mb-2 text-sm text-muted-foreground"><span>Replying to event</span></div>');function ot(s,e){be(e,!0);let v=ie(null),d=ie(null);const u=F(()=>{const B=e.event.tags.find(N=>N[0]==="e"&&N[3]==="reply");if(B)return B;const P=e.event.tags.find(N=>N[0]==="e"&&N[3]==="root");if(P)return P;const f=e.event.tags.filter(N=>N[0]==="e");if(f.length===1)return f[0]});He(()=>{t(u)&&ee.fetchEventFromTag(t(u),e.event).then(B=>{B&&(h(v,B,!0),B.author.fetchProfile().then(P=>{h(d,P,!0)}))})});const m=F(()=>t(v)?t(d)?.name?t(d).name:t(d)?.displayName?t(d).displayName:`${t(v).pubkey.slice(0,8)}...`:""),T=F(()=>t(v)?Oe.npubEncode(t(v).pubkey):"");var b=me(),V=$(b);{var w=B=>{var P=rt(),f=o(a(P),2),N=a(f);r(f),r(P),G(()=>{_e(f,"href",`/p/${t(T)??""}`),R(N,`@${t(m)??""}`)}),n(B,P)},te=B=>{var P=me(),f=$(P);{var N=U=>{var oe=at();n(U,oe)};j(f,U=>{t(u)&&!t(v)&&U(N)},!0)}n(B,P)};j(V,B=>{t(v)&&t(d)?B(w):B(te,!1)})}n(s,b),xe()}function nt(s){if(!s||s.length<8)return"linear-gradient(135deg, hsl(220, 70%, 50%), hsl(280, 70%, 50%))";const e=s.slice(0,4),v=s.slice(4,8),d=parseInt(e,16)%360,u=parseInt(v,16)%360,m=60+parseInt(s.slice(8,10)||"00",16)%20,T=60+parseInt(s.slice(10,12)||"00",16)%20,b=45+parseInt(s.slice(12,14)||"00",16)%10,V=45+parseInt(s.slice(14,16)||"00",16)%10;return`linear-gradient(135deg, hsl(${d}, ${m}%, ${b}%), hsl(${u}, ${T}%, ${V}%))`}var st=S('<img alt="Banner" class="w-full h-full object-cover opacity-80"/> <div class="absolute inset-0 bg-gradient-to-b from-transparent to-neutral-900"></div>',1),it=de('<svg class="w-3.5 h-3.5 text-blue-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),lt=S('<div class="mb-4"><div class="text-sm text-muted-foreground line-clamp-3 leading-relaxed svelte-5mo7x1"><!></div></div>'),vt=S('<div class="fixed z-50 pointer-events-none animate-in fade-in duration-200 svelte-5mo7x1"><div class="relative pointer-events-auto"><div class="relative w-80 bg-card border border-border rounded-xl shadow-2xl overflow-hidden"><div class="relative h-20"><!></div> <div class="relative px-5 pb-5 -mt-10"><div class="relative inline-block mb-3"><!></div> <div class="mb-3"><h3 class="text-base font-semibold text-foreground flex items-center gap-1.5 mb-0.5"><span class="truncate"> </span> <!></h3> <p class="text-sm text-muted-foreground truncate"><!></p></div> <!> <div class="flex items-center gap-4 mb-4 text-sm border-t border-border pt-3"><div class="flex items-center gap-1.5"><span class="font-medium text-foreground"> </span> <span class="text-muted-foreground">notes</span></div> <div class="flex items-center gap-1.5"><span class="font-medium text-foreground"> </span> <span class="text-muted-foreground">following</span></div></div> <!></div></div></div></div>');function dt(s,e){be(e,!0);const v=ee.$fetchProfile(()=>e.pubkey),d=ee.$currentUser,u=F(()=>d?.pubkey===e.pubkey),m=ee.$subscribe(()=>e.pubkey&&e.isVisible?{filters:[{kinds:[1],authors:[e.pubkey],limit:100}],bufferMs:100}:void 0),T=ee.$subscribe(()=>e.pubkey&&e.isVisible?{filters:[{kinds:[3],authors:[e.pubkey],limit:1}],bufferMs:100}:void 0),b=F(()=>m.events.filter(P=>!P.tags.some(f=>f[0]==="e")).length),V=F(()=>{const P=T.events[0];return P?P.tags.filter(f=>f[0]==="p").length:0});var w=me(),te=$(w);{var B=P=>{var f=vt(),N=a(f),U=a(N),oe=a(U),ne=a(oe);{var y=g=>{var L=st(),Q=$(L);ce(2),G(()=>_e(Q,"src",v.banner)),n(g,L)};j(ne,g=>{v?.banner&&g(y)})}r(oe);var W=o(oe,2),q=a(W),i=a(q);Le(i,{get ndk(){return ee},get pubkey(){return e.pubkey},class:"w-20 h-20 rounded-full border-4 border-foreground shadow-xl"}),r(q);var p=o(q,2),k=a(p),H=a(k),re=a(H,!0);r(H);var J=o(H,2);{var I=g=>{var L=it();n(g,L)};j(J,g=>{v?.nip05&&g(I)})}r(k);var se=o(k,2),D=a(se);{var x=g=>{var L=le();G(()=>R(L,v.nip05)),n(g,L)},c=g=>{var L=le();G(Q=>R(L,`${Q??""}...`),[()=>e.pubkey.slice(0,16)]),n(g,L)};j(D,g=>{v?.nip05?g(x):g(c,!1)})}r(se),r(p);var A=o(p,2);{var K=g=>{var L=lt(),Q=a(L),l=a(Q);Be(l,{get content(){return v.about},class:"text-muted-foreground"}),r(Q),r(L),n(g,L)};j(A,g=>{v?.about&&g(K)})}var E=o(A,2),C=a(E),z=a(C),Y=a(z,!0);r(z),ce(2),r(C);var M=o(C,2),Z=a(M),_=a(Z,!0);r(Z),ce(2),r(M),r(E);var O=o(E,2);{var ae=g=>{Qe(g,{get pubkey(){return e.pubkey}})};j(O,g=>{t(u)||g(ae)})}r(W),r(U),r(N),r(f),G(g=>{ze(f,`left: ${e.position.x??""}px; top: ${e.position.y??""}px;`),ze(oe,g),R(re,v?.displayName||v?.name||"Anonymous"),R(Y,t(b)),R(_,t(V))},[()=>`background: ${v?.banner?"transparent":nt(e.pubkey)}`]),n(P,f)};j(te,P=>{e.isVisible&&P(B)})}n(s,w),xe()}var ut=S('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),ct=S('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),ft=S('<span class="text-xl mr-2">‚ö°</span> ',1),pt=S("<!> <!>",1),mt=S('<div class="relative -mx-6 -mt-6 px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">‚ö°</span></div> <div><!> <!></div></div></div> <div class="space-y-6"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!> <!></div>',1);function gt(s,e){be(e,!0);let v=he(e,"open",15,!1);const d=[{value:10,label:"10",emoji:"‚òï"},{value:21,label:"21",emoji:"‚ö°"},{value:50,label:"50",emoji:"ü§ô"},{value:100,label:"100",emoji:"üíØ"},{value:500,label:"500",emoji:"üî•"},{value:1e3,label:"1K",emoji:"üíé"},{value:2100,label:"2.1K",emoji:"üöÄ"},{value:5e3,label:"5K",emoji:"üëë"}];let u=ie(Ze(Ne.zap.defaultAmount)),m=ie(""),T=ie(!1);function b(f){h(u,f,!0),h(T,!1),h(m,"")}function V(){h(T,!0);const f=Number.parseInt(t(m));!Number.isNaN(f)&&f>0&&h(u,f,!0)}function w(){t(u)>0&&e.onZap(t(u))}function te(f){f.key==="Enter"&&t(u)>0&&w()}var B=me();fe("keydown",Se,te);var P=$(B);ye(P,()=>Je,(f,N)=>{N(f,{get open(){return v()},onOpenChange:U=>{U?v(!0):e.onCancel()},children:(U,oe)=>{var ne=me(),y=$(ne);ye(y,()=>We,(W,q)=>{q(W,{class:"max-w-md bg-background border-2 border-primary/30 shadow-2xl shadow-primary/50",children:(i,p)=>{var k=mt(),H=$(k),re=o(a(H),2),J=o(a(re),2),I=a(J);ye(I,()=>qe,(M,Z)=>{Z(M,{class:"text-xl text-foreground",children:(_,O)=>{ce();var ae=le("Zap Amount");n(_,ae)},$$slots:{default:!0}})});var se=o(I,2);ye(se,()=>$e,(M,Z)=>{Z(M,{class:"text-sm text-muted-foreground",children:(_,O)=>{ce();var ae=le("Choose your zap amount");n(_,ae)},$$slots:{default:!0}})}),r(J),r(re),r(H);var D=o(H,2),x=a(D);Fe(x,21,()=>d,Re,(M,Z)=>{{let _=F(()=>t(u)===t(Z).value&&!t(T)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");Ce(M,{variant:"ghost",onclick:()=>b(t(Z).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${t(_)??""}`},children:(O,ae)=>{var g=ut(),L=o($(g),2),Q=a(L),l=a(Q,!0);r(Q);var X=o(Q,2),pe=a(X,!0);r(X),r(L),G(()=>{R(l,t(Z).emoji),ve(X,1,`text-xs font-bold ${t(u)===t(Z).value&&!t(T)?"text-primary-foreground":"text-foreground"}`),R(pe,t(Z).label)}),n(O,g)},$$slots:{default:!0}})}}),r(x);var c=o(x,2),A=a(c);Ge(A,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(M,Z)=>{ce();var _=le("Custom Amount");n(M,_)},$$slots:{default:!0}});var K=o(A,2),E=a(K);{let M=F(()=>t(T)?"border-primary":"border-border");Xe(E,{id:"custom-amount",type:"number",oninput:V,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${t(M)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return t(m)},set value(Z){h(m,Z,!0)}})}ce(2),r(K),r(c);var C=o(c,2);{var z=M=>{var Z=ct(),_=a(Z),O=o(a(_),2),ae=a(O);r(O),r(_),r(Z),G(g=>R(ae,`${g??""} sats`),[()=>t(u).toLocaleString()]),n(M,Z)};j(C,M=>{t(u)>0&&M(z)})}var Y=o(C,2);ye(Y,()=>Ye,(M,Z)=>{Z(M,{class:"flex gap-3 sm:space-x-0",children:(_,O)=>{var ae=pt(),g=$(ae);Ce(g,{variant:"outline",get onclick(){return e.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(Q,l)=>{ce();var X=le("Cancel");n(Q,X)},$$slots:{default:!0}});var L=o(g,2);{let Q=F(()=>t(u)<=0);Ce(L,{onclick:w,get disabled(){return t(Q)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(l,X)=>{var pe=ft(),ge=o($(pe));G(we=>R(ge,` Zap ${we??""}`),[()=>t(u)>0?t(u).toLocaleString():""]),n(l,pe)},$$slots:{default:!0}})}n(_,ae)},$$slots:{default:!0}})}),r(D),n(i,k)},$$slots:{default:!0}})}),n(U,ne)},$$slots:{default:!0}})}),n(s,B),xe()}var ht=de('<svg class="w-6 h-6 animate-spin text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),_t=de('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),bt=de('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),xt=de('<svg stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),wt=S('<button type="button"><div><!></div> <span class="text-xs font-semibold text-white"><!></span></button>'),yt=de('<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),kt=de('<svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>'),Ct=de('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),Pt=de('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),zt=de('<svg class="w-5 h-5" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Mt=S('<span class="text-xs opacity-70"> </span>'),At=S(" <!>",1),jt=S('<button type="button"><!> <span class="text-sm group-hover:underline"><!></span></button>'),Tt=S("<!> <!>",1);function Te(s,e){be(e,!0);const v=he(e,"variant",3,"default"),d=ee.$zaps(()=>({target:e.event,validated:!0})),u=F(()=>{const i=ee.$currentPubkey;return i?Ve(d.events,i):!1}),m=F(()=>{const i=d.totalAmount;return i>=1e6?`${(i/1e6).toFixed(1)}M`:i>=1e3?`${(i/1e3).toFixed(1)}K`:i.toString()});let T=ie(!1),b=ie(!1),V=ie(!1),w=null;async function te(i){if(!ee.signer){ue.error("Please login to zap");return}h(b,!0);try{await tt(ee,e.event,i*1e3),h(V,!0),setTimeout(()=>h(V,!1),2e3),ue.success(`Zapped ${i} sats!`)}catch(p){console.error("Failed to zap:",p),ue.error("Failed to send zap")}finally{h(b,!1)}}async function B(i){i.stopPropagation(),!(t(b)||!ee.signer)&&await te(Ne.zap.defaultAmount)}function P(i){h(T,!1),te(i)}function f(i){i.preventDefault(),i.stopPropagation(),w=setTimeout(()=>{h(T,!0),w=null},500)}function N(i){w&&(clearTimeout(w),w=null,(i.type==="mouseup"||i.type==="touchend")&&B(i))}function U(){w&&(clearTimeout(w),w=null)}var oe=Tt(),ne=$(oe);{var y=i=>{var p=wt();p.__mousedown=f,p.__mouseup=N,p.__touchstart=f,p.__touchend=N;var k=a(p),H=a(k);{var re=c=>{var A=ht();n(c,A)},J=c=>{var A=xt(),K=a(A);{var E=z=>{var Y=_t();n(z,Y)},C=z=>{var Y=bt();n(z,Y)};j(K,z=>{t(u)?z(E):z(C,!1)})}r(A),G(()=>{ve(A,0,`w-6 h-6 transition-colors ${t(u)?"text-yellow-400":"text-white"}`),_e(A,"fill",t(u)?"currentColor":"none")}),n(c,A)};j(H,c=>{t(b)?c(re):c(J,!1)})}r(k);var I=o(k,2),se=a(I);{var D=c=>{var A=le();G(()=>R(A,t(m))),n(c,A)},x=c=>{var A=le("Zap");n(c,A)};j(se,c=>{d.totalAmount>0?c(D):c(x,!1)})}r(I),r(p),G(()=>{p.disabled=t(b),ve(p,1,`flex flex-col items-center gap-1 hover:scale-110 transition-transform group ${t(b)?"opacity-50 cursor-wait":""}`),ve(k,1,`w-12 h-12 rounded-full backdrop-blur-sm flex items-center justify-center transition-colors ${t(V)?"bg-yellow-400/30":t(u)?"bg-yellow-400/20":"bg-white/20"}`)}),fe("mouseleave",p,U),fe("touchcancel",p,U),n(i,p)},W=i=>{var p=jt();p.__mousedown=f,p.__mouseup=N,p.__touchstart=f,p.__touchend=N;var k=a(p);{var H=x=>{var c=yt();n(x,c)},re=x=>{var c=me(),A=$(c);{var K=C=>{var z=kt();n(C,z)},E=C=>{var z=zt(),Y=a(z);{var M=_=>{var O=Ct();n(_,O)},Z=_=>{var O=Pt();n(_,O)};j(Y,_=>{t(u)?_(M):_(Z,!1)})}r(z),G(()=>_e(z,"fill",t(u)?"currentColor":"none")),n(C,z)};j(A,C=>{t(V)?C(K):C(E,!1)},!0)}n(x,c)};j(k,x=>{t(b)?x(H):x(re,!1)})}var J=o(k,2),I=a(J);{var se=x=>{var c=le("Zapped!");n(x,c)},D=x=>{var c=me(),A=$(c);{var K=C=>{var z=le("Zapping...");n(C,z)},E=C=>{var z=me(),Y=$(z);{var M=_=>{var O=At(),ae=$(O),g=o(ae);{var L=Q=>{var l=Mt(),X=a(l);r(l),G(()=>R(X,`(${d.count??""})`)),n(Q,l)};j(g,Q=>{d.count>0&&Q(L)})}G(()=>R(ae,`${t(m)??""} `)),n(_,O)},Z=_=>{var O=le("Zap");n(_,O)};j(Y,_=>{d.totalAmount>0?_(M):_(Z,!1)},!0)}n(C,z)};j(A,C=>{t(b)?C(K):C(E,!1)},!0)}n(x,c)};j(I,x=>{t(V)?x(se):x(D,!1)})}r(J),r(p),G(()=>{p.disabled=t(b),ve(p,1,`relative flex items-center gap-2 transition-colors group ${t(V)||t(u)?"text-yellow-400":"text-muted-foreground hover:text-yellow-400"} ${t(b)?"opacity-50 cursor-wait":""}`)}),fe("mouseleave",p,U),fe("touchcancel",p,U),n(i,p)};j(ne,i=>{v()==="tiktok"?i(y):i(W,!1)})}var q=o(ne,2);gt(q,{get event(){return e.event},onZap:P,onCancel:()=>h(T,!1),get open(){return t(T)},set open(i){h(T,i,!0)}}),n(s,oe),xe()}Pe(["mousedown","mouseup","touchstart","touchend"]);var Zt=(s,e)=>{s.stopPropagation(),h(e,!0)},Lt=(s,e)=>{s.stopPropagation(),h(e,!t(e))},Bt=s=>s.stopPropagation(),Nt=(s,e,v)=>{s.stopPropagation(),h(e,!1),v()},Et=(s,e,v)=>{s.stopPropagation(),h(e,!1),h(v,!0)},Ht=S('<div class="absolute bottom-full mb-2 right-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),St=(s,e)=>{s.stopPropagation(),e("‚ù§Ô∏è")},Dt=S('<div class="flex flex-col items-center gap-6 text-white"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></div> <span class="text-xs font-semibold"> </span></button> <div class="relative"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div> <span class="text-xs font-semibold"> </span></button> <!></div> <button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><svg class="w-6 h-6 text-red-400" fill="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></div> <span class="text-xs font-semibold"> </span></button> <!></div>'),It=(s,e)=>{s.stopPropagation(),h(e,!0)},Ft=(s,e)=>{s.stopPropagation(),h(e,!t(e))},Rt=s=>s.stopPropagation(),Vt=(s,e,v)=>{s.stopPropagation(),h(e,!1),v()},Kt=(s,e,v)=>{s.stopPropagation(),h(e,!1),h(v,!0)},Ot=S('<div class="absolute bottom-full mb-2 left-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),Qt=(s,e)=>{s.stopPropagation(),e("‚ù§Ô∏è")},Ut=S('<div><button type="button" class="flex items-center gap-2 hover:text-primary transition-colors group"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <span class="text-sm group-hover:underline"> </span></button> <div class="relative"><button type="button" class="flex items-center gap-2 hover:text-green-400 transition-colors group"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span class="text-sm group-hover:underline"> </span></button> <!></div> <button type="button" class="flex items-center gap-2 hover:text-red-400 transition-colors group"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg> <span class="text-sm group-hover:underline"> </span></button> <!></div>'),Wt=S("<!> <!> <!>",1);function qt(s,e){be(e,!0);const v=he(e,"variant",3,"default");let d=ie(!1),u=ie(!1),m=ie(!1);const T=ee.$subscribe(()=>({filters:[{kinds:[1,1111,6,16,7],...e.event.filter()}],subId:"interactions"})),b=F(()=>Array.from(T.events??[]).filter(y=>y.kind===1||y.kind===1111).length),V=F(()=>Array.from(T.events??[]).filter(y=>y.kind===6||y.kind===16).length),w=F(()=>Array.from(T.events??[]).filter(y=>y.kind===7).length);async function te(y){if(!ee.signer){ue.error("Please login to react");return}try{await e.event.react(y),ue.success("Reaction added")}catch(W){console.error("Failed to react:",W),ue.error("Failed to add reaction")}}async function B(){if(!ee.signer){ue.error("Please login to repost");return}try{await e.event.repost(),ue.success("Note reposted")}catch(y){console.error("Failed to repost:",y),ue.error("Failed to repost")}}var P=Wt(),f=$(P);{var N=y=>{var W=Dt(),q=a(W);q.__click=[Zt,d];var i=o(a(q),2),p=a(i,!0);r(i),r(q);var k=o(q,2),H=a(k);H.__click=[Lt,m];var re=o(a(H),2),J=a(re,!0);r(re),r(H);var I=o(H,2);{var se=K=>{var E=Ht();E.__click=[Bt];var C=a(E);C.__click=[Nt,m,B];var z=o(C,2);z.__click=[Et,m,u],r(E),Me(E,(Y,M)=>Ae?.(Y,M),()=>()=>h(m,!1)),n(K,E)};j(I,K=>{t(m)&&K(se)})}r(k);var D=o(k,2);D.__click=[St,te];var x=o(a(D),2),c=a(x,!0);r(x),r(D);var A=o(D,2);Te(A,{get event(){return e.event},variant:"tiktok"}),r(W),G(()=>{R(p,t(b)),R(J,t(V)),R(c,t(w))}),n(y,W)},U=y=>{var W=Ut(),q=a(W);q.__click=[It,d];var i=o(a(q),2),p=a(i,!0);r(i),r(q);var k=o(q,2),H=a(k);H.__click=[Ft,m];var re=o(a(H),2),J=a(re,!0);r(re),r(H);var I=o(H,2);{var se=K=>{var E=Ot();E.__click=[Rt];var C=a(E);C.__click=[Vt,m,B];var z=o(C,2);z.__click=[Kt,m,u],r(E),Me(E,(Y,M)=>Ae?.(Y,M),()=>()=>h(m,!1)),n(K,E)};j(I,K=>{t(m)&&K(se)})}r(k);var D=o(k,2);D.__click=[Qt,te];var x=o(a(D),2),c=a(x,!0);r(x),r(D);var A=o(D,2);Te(A,{get event(){return e.event}}),r(W),G(()=>{ve(W,1,`flex items-center gap-3 sm:gap-6 ${v()==="thread-main"?"border-t border-border pt-3":""} text-muted-foreground`),R(p,t(b)),R(J,t(V)),R(c,t(w))}),n(y,W)};j(f,y=>{v()==="tiktok"?y(N):y(U,!1)})}var oe=o(f,2);je(oe,{get replyTo(){return e.event},get open(){return t(d)},set open(y){h(d,y,!0)}});var ne=o(oe,2);je(ne,{get quotedEvent(){return e.event},get open(){return t(u)},set open(y){h(u,y,!0)}}),n(s,P),xe()}Pe(["click"]);var Gt=S('<div class="absolute left-[29px] -top-px h-[73px] w-0.5 bg-muted"></div> <div class="absolute left-[29px] top-[73px] bottom-0 w-0.5 bg-muted"></div>',1),Jt=(s,e)=>{s.stopPropagation(),e()},Xt=S('<span class="text-muted-foreground text-sm truncate min-w-0"> </span>'),Yt=S('<article><!> <div><button type="button" class="flex-shrink-0"><!></button> <div class="flex items-center gap-2 flex-1 min-w-0"><div class="flex items-center gap-2 min-w-0 flex-shrink"><span> </span> <!></div> <span class="text-muted-foreground text-sm flex-shrink-0">¬∑</span> <!></div> <!></div> <!> <div><!></div> <!></article> <div><!></div>',1);function mr(s,e){be(e,!0);const v=he(e,"showActions",3,!0),d=he(e,"variant",3,"default"),u=he(e,"showThreadLine",3,!1),m=ee.$fetchProfile(()=>e.event.pubkey),T=F(()=>e.event.author.npub);let b=ie(!1),V=ie(Ze({x:0,y:0})),w=null,te=ie(null);function B(){window.location.href=`/p/${t(T)}`}function P(){if(e.onNavigate){e.onNavigate();return}const l=e.event.encode();window.location.href=`/e/${l}`}const f=F(()=>d()==="thread-main"?"w-14 h-14":d()==="thread-reply"?"w-10 h-10":"w-9 h-9 sm:w-12 sm:h-12"),N=F(()=>d()==="thread-main"?"text-lg leading-relaxed":"text-base"),U=F(()=>d()==="thread-main"?"text-lg font-bold":"text-base font-semibold"),oe=F(()=>d()==="thread-main"?"bg-card/50":(d()==="default","hover:bg-card/30")),ne=F(()=>d()==="default"||e.onNavigate!==void 0);function y(l){w&&clearTimeout(w),w=setTimeout(()=>{if(t(te)){const X=t(te).getBoundingClientRect(),pe=window.innerWidth,ge=320,we=16;let ke=X.right+we;ke+ge>pe-we&&(ke=X.left-ge-we);const Ee=X.top;h(V,{x:ke,y:Ee},!0),h(b,!0)}},500)}function W(l){w&&(clearTimeout(w),w=null),w=setTimeout(()=>{h(b,!1)},100)}function q(){w&&(clearTimeout(w),w=null)}function i(){h(b,!1)}var p=Yt(),k=$(p);k.__click=function(...l){(t(ne)?P:void 0)?.apply(this,l)};var H=a(k);{var re=l=>{var X=Gt();ce(2),n(l,X)};j(H,l=>{u()&&l(re)})}var J=o(H,2),I=a(J);I.__click=[Jt,B];var se=a(I);{let l=F(()=>`${t(f)} cursor-pointer hover:opacity-80 transition-opacity`);Le(se,{get ndk(){return ee},get pubkey(){return e.event.pubkey},get class(){return t(l)}})}r(I),Ke(I,l=>h(te,l),()=>t(te));var D=o(I,2),x=a(D),c=a(x),A=a(c,!0);r(c);var K=o(c,2);{var E=l=>{var X=Xt(),pe=a(X);r(X),G(ge=>R(pe,`@${ge??""}`),[()=>m?.name||e.event.pubkey.slice(0,8)]),n(l,X)};j(K,l=>{(d()==="default"||d()==="thread-reply")&&l(E)})}r(x);var C=o(x,4);{var z=l=>{Ue(l,{get timestamp(){return e.event.created_at},class:"text-muted-foreground text-sm flex-shrink-0"})};j(C,l=>{e.event.created_at&&l(z)})}r(D);var Y=o(D,2);et(Y,{get event(){return e.event}}),r(J);var M=o(J,2);{var Z=l=>{ot(l,{get event(){return e.event}})};j(M,l=>{d()==="default"&&l(Z)})}var _=o(M,2),O=a(_);Be(O,{get ndk(){return ee},get event(){return e.event}}),r(_);var ae=o(_,2);{var g=l=>{qt(l,{get event(){return e.event},get variant(){return d()}})};j(ae,l=>{v()&&l(g)})}r(k);var L=o(k,2),Q=a(L);dt(Q,{get pubkey(){return e.event.pubkey},get isVisible(){return t(b)},get position(){return t(V)}}),r(L),G(l=>{ve(k,1,`p-3 sm:p-4 flex flex-col max-sm:max-w-screen ${t(oe)??""} transition-colors ${t(ne)?"cursor-pointer":""} border-b border-border relative min-w-0`),_e(k,"role",t(ne)?"button":void 0),_e(k,"tabindex",t(ne)?0:void 0),ve(J,1,`flex items-center gap-2 sm:gap-3 ${d()==="thread-main"?"mb-2":"mb-1.5"}`),ve(c,1,`${t(U)} text-foreground truncate min-w-0`),R(A,l),ve(_,1,`text-foreground whitespace-pre-wrap break-words ${t(N)??""} mb-2 overflow-hidden`)},[()=>m?.displayName||m?.name||`${e.event.pubkey.slice(0,8)}...`]),fe("mouseenter",I,y),fe("mouseleave",I,W),fe("mouseenter",L,q),fe("mouseleave",L,i),n(s,p),xe()}Pe(["click"]);export{qt as E,mr as N,nt as g};
