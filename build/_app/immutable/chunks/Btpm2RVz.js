import"./DsnmJJEf.js";import{u as Ze,s as l,b as ve,g as e,a as U,p as Ue,c as ge,f as q,e as a,h as Ne,N as _t,i as x,j as s,k as o,r,t as W,l as J,d as Ke,L as Ce,M as Ie,K as Fe,P as Be,aP as lt,O as Tt,b8 as jt,Q as ze,bd as Ut}from"./UP8uQ6W_.js";import{i as z}from"./_gFmmxLT.js";import{c as ke}from"./BjHSVvfl.js";import{a as Se,c as qe,r as Nt,b as yt,f as It,d as st}from"./BUa9uPHk.js";import{p as be}from"./B36lUvow.js";import{P as Lt,q as Bt,N as Dt,n as ce,b as Ft,s as Je,f as it,h as Zt,Q as Qt}from"./CnpwhG0Y.js";import{a as et}from"./COfxsEOE.js";import{g as Wt,A as $e}from"./BoWL87Fx.js";import{a as Ye}from"./BKitiiqs.js";import{S as dt}from"./CxavLbn8.js";import{t as Re}from"./BeJK5XQO.js";import{c as tt}from"./a7XEC-kH.js";import{e as Xe,i as rt}from"./DA17f6bB.js";import{b as at}from"./CEMA3FH2.js";import{u as ut}from"./BUklZbww.js";import{p as ot}from"./DffcqDm-.js";import{M as wt,b as kt,c as Pt,R as Ct,d as Rt,e as St,f as Mt}from"./5_jRFLjB.js";import{B as Ae,I as ct}from"./BgcVqX2P.js";import{b as zt}from"./B1i_fleE.js";import{N as Kt,c as qt}from"./DAJSYuaf.js";import{R as vt}from"./Bo_SZwZv.js";import{I as je}from"./CT5oYcwn.js";import{D as Ht,a as Ot}from"./8MhEYoCQ.js";import{D as Vt}from"./BOdE5gG2.js";import{L as ft}from"./DiRLJweC.js";import{D as Yt}from"./jJGSuslB.js";import{t as Xt}from"./D8EaCCWh.js";async function Gt(re,t,i,v){if(!re.wallet)throw new Error("No wallet connected");if(!re.$currentPubkey)throw new Error("No active session");const p=new Lt(t,i,"msat",{comment:v?.comment});return re.$payments.addPending(p,re.$currentPubkey),await p.zap()}function Et(re,t){const i=Bt(t);let v=ve(null);const p=new dt;Ze(()=>{const{event:g}=re();if(!g?.id){l(v,null);return}l(v,i.$subscribe(()=>({filters:[{kinds:[Dt.Reaction],...g.filter()}],subId:"reactions"})),!0)});const u=U(()=>{const M=e(v)?.events||[],m=new dt;for(const C of M){const f=C.content,d=m.get(f)||{count:0,hasReacted:!1,pubkeys:[]};d.count++,d.pubkeys.includes(C.pubkey)||d.pubkeys.push(C.pubkey),C.pubkey===i.$currentPubkey&&(d.hasReacted=!0,d.userReaction=C),m.set(f,d)}for(const[C,{event:f}]of p.entries()){const d=m.get(C)||{count:0,hasReacted:!1,pubkeys:[]};d.hasReacted||(d.count++,d.hasReacted=!0,d.pubkeys.includes(i.$currentPubkey)||d.pubkeys.push(i.$currentPubkey),d.userReaction=f),m.set(C,d)}return Array.from(m.entries()).map(([C,f])=>({emoji:C,...f})).sort((C,f)=>f.count-C.count)});async function b(g){const{event:M,delayed:m}=re();if(!M?.id)throw new Error("No event to react to");if(!i.$currentPubkey)throw new Error("User must be logged in to react");const C=typeof g=="string"?g:g.emoji,f=p.get(C);if(f){clearTimeout(f.timer),p.delete(C);return}const d=e(u).find(D=>D.emoji===C);if(d?.hasReacted&&d.userReaction){await d.userReaction.delete();return}const A=await M.react(C,!1);if(typeof g!="string"&&g.shortcode&&g.url&&A.tags.push(["emoji",g.shortcode,g.url]),m&&m>0){const D=setTimeout(async()=>{await A.publish(),p.delete(C)},m*1e3);p.set(C,{timer:D,event:A})}else await A.publish()}function k(g){return e(u).find(M=>M.emoji===g)}return{get all(){return e(u)},get:k,react:b}}var Jt=x('<div><span class="reply-indicator__text svelte-u3v8nr">Replying to</span> <a class="reply-indicator__link svelte-u3v8nr"> </a></div>'),$t=x('<div><span class="reply-indicator__text svelte-u3v8nr">Replying to event</span></div>');function er(re,t){Ue(t,!0);let i=be(t,"class",3,"");const v=Wt(t.ndk);let p=ve(null),u=ve(null),b=ve(!0);const k=U(()=>{const d=t.event.tags.find(P=>P[0]==="e"&&P[3]==="reply");if(d)return d;const A=t.event.tags.find(P=>P[0]==="e"&&P[3]==="root");if(A)return A;const D=t.event.tags.filter(P=>P[0]==="e");if(D.length===1)return D[0]});Ze(()=>{l(b,!0),l(p,null),l(u,null),e(k)?v.fetchEventFromTag(e(k),t.event).then(d=>{d?(l(p,d,!0),d.author.fetchProfile().then(A=>{l(u,A,!0),l(b,!1)}).catch(()=>{l(b,!1)})):l(b,!1)}).catch(()=>{l(b,!1)}):l(b,!1)});const g=U(()=>e(p)?e(u)?.name?e(u).name:e(u)?.displayName?e(u).displayName:`${e(p).pubkey.slice(0,8)}...`:""),M=U(()=>e(p)?e(p).author.npub:"");var m=ge(),C=q(m);{var f=d=>{var A=ge(),D=q(A);{var P=h=>{var H=ge(),$=q(H);_t($,()=>t.children,()=>({profile:e(u),event:e(p),loading:e(b)})),a(h,H)},_=h=>{var H=ge(),$=q(H);{var R=ee=>{var E=Jt(),L=s(o(E),2),w=o(L);r(L),r(E),W(()=>{Se(E,1,`reply-indicator ${i()??""}`,"svelte-u3v8nr"),qe(L,"href",`/p/${e(M)??""}`),J(w,`@${e(g)??""}`)}),a(ee,E)},N=ee=>{var E=ge(),L=q(E);{var w=S=>{var O=$t();W(()=>Se(O,1,`reply-indicator ${i()??""}`,"svelte-u3v8nr")),a(S,O)};z(L,S=>{e(b)||S(w)},!0)}a(ee,E)};z($,ee=>{e(p)&&e(u)?ee(R):ee(N,!1)},!0)}a(h,H)};z(D,h=>{t.children?h(P):h(_,!1)})}a(d,A)};z(C,d=>{e(k)&&d(f)})}a(re,m),Ne()}var tr=x('<button type="button" class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 hover:bg-primary/30 text-foreground rounded-full text-xs transition-colors"><!> <span class="max-w-[100px] truncate"> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>');function rr(re,t){Ue(t,!0);let i=ve(null);Ze(()=>{ce.fetchUser(t.pubkey).then(g=>{g?.fetchProfile().then(M=>{l(i,M,!0)})})});const v=U(()=>e(i)?.displayName||e(i)?.name||`${t.pubkey.slice(0,8)}...`);var p=tr();p.__click=()=>t.onRemove(t.pubkey);var u=o(p);$e(u,{get ndk(){return ce},get pubkey(){return t.pubkey},size:14,class:"flex-shrink-0"});var b=s(u,2),k=o(b,!0);r(b),Ce(2),r(p),W(()=>J(k,e(v))),a(re,p),Ne()}Ke(["click"]);var ar=x('<div class="text-xs text-muted-foreground truncate"> </div>'),or=Ie('<svg class="w-3 h-3 text-primary-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),nr=x("<div><!></div>"),sr=x('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div> <!></button>');function lr(re,t){Ue(t,!0);let i=ve(null);Ze(()=>{ce.fetchUser(t.pubkey).then(d=>{d?.fetchProfile().then(A=>{l(i,A,!0)})})});const v=U(()=>e(i)?.displayName||e(i)?.name||`${t.pubkey.slice(0,8)}...`);var p=sr();p.__click=()=>t.onToggle(t.pubkey);var u=o(p);$e(u,{get ndk(){return ce},get pubkey(){return t.pubkey},size:32,class:"flex-shrink-0"});var b=s(u,2),k=o(b),g=o(k,!0);r(k);var M=s(k,2);{var m=d=>{var A=ar(),D=o(A,!0);r(A),W(()=>J(D,e(i).nip05)),a(d,A)};z(M,d=>{e(i)?.nip05&&d(m)})}r(b);var C=s(b,2);{var f=d=>{var A=nr(),D=o(A);{var P=_=>{var h=or();a(_,h)};z(D,_=>{t.isSelected&&_(P)})}r(A),W(()=>Se(A,1,`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${t.isSelected?"bg-primary border-primary":"border-border"}`)),a(d,A)};z(C,d=>{t.showCheckbox&&d(f)})}r(p),W(()=>{Se(p,1,`w-full flex items-center gap-2 p-2 rounded-md transition-colors ${t.isSelected?"bg-primary/20":"hover:bg-muted"}`),J(g,e(v))}),a(re,p),Ne()}Ke(["click"]);var ir=x('<button type="button" class="absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-xs font-medium transition-colors">Add</button>'),dr=x('<p class="text-xs text-muted-foreground mt-1.5">Search follows or paste npub/hex/NIP-05</p>'),ur=x('<div class="px-3 py-2 border-b border-border bg-muted/30"><div class="text-xs font-medium text-muted-foreground mb-2"> </div> <div class="flex flex-wrap gap-1.5"></div></div>'),cr=x('<div class="text-center py-8 px-3 text-muted-foreground text-sm"> </div>'),vr=x('<div class="p-2 space-y-1"></div>'),fr=x('<div class="flex flex-col max-h-[400px]"><div class="p-3 border-b border-border"><h3 class="font-semibold text-sm mb-2">Tag people</h3> <div class="relative"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search or paste npub/identifier..." class="w-full pl-8 pr-16 py-2 bg-muted border border-border rounded-lg text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <!></div> <!></div> <!> <div class="overflow-y-auto flex-1"><!></div></div>');function pt(re,t){Ue(t,!0);let i=be(t,"searchQuery",15);var v=fr(),p=o(v),u=s(o(p),2),b=s(o(u),2);Nt(b),b.__keydown=_=>{_.key==="Enter"&&t.isIdentifierInput&&t.onAddByIdentifier()};var k=s(b,2);{var g=_=>{var h=ir();h.__click=function(...H){t.onAddByIdentifier?.apply(this,H)},a(_,h)};z(k,_=>{t.isIdentifierInput&&_(g)})}r(u);var M=s(u,2);{var m=_=>{var h=dr();a(_,h)};z(M,_=>{i()||_(m)})}r(p);var C=s(p,2);{var f=_=>{var h=ur(),H=o(h),$=o(H);r(H);var R=s(H,2);Xe(R,20,()=>t.selectedPubkeys,N=>N,(N,ee)=>{rr(N,{get pubkey(){return ee},get onRemove(){return t.onRemoveUser}})}),r(R),r(h),W(()=>J($,`Selected (${t.selectedPubkeys.length??""})`)),a(_,h)};z(C,_=>{t.selectedPubkeys.length>0&&_(f)})}var d=s(C,2),A=o(d);{var D=_=>{var h=cr(),H=o(h,!0);r(h),W(()=>J(H,i()?"No matches found":"You don't follow anyone yet")),a(_,h)},P=_=>{var h=vr();Xe(h,20,()=>t.filteredFollows,H=>H,(H,$)=>{{let R=U(()=>t.selectedPubkeys.includes($));lr(H,{get pubkey(){return $},get isSelected(){return e(R)},get showCheckbox(){return t.multiple},get onToggle(){return t.onToggleUser}})}}),r(h),a(_,h)};z(A,_=>{t.filteredFollows.length===0?_(D):_(P,!1)})}r(d),r(v),zt(b,i),a(re,v),Ne()}Ke(["keydown","click"]);var pr=x('<span class="ml-auto text-xs bg-primary/20 text-primary rounded-full px-2 py-0.5"> </span>'),gr=x('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <span> </span> <!>',1),mr=x('<span class="absolute -top-1 -right-1 text-[10px] bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center"> </span>'),hr=Ie('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><!>',1),br=x('<div role="presentation" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"><div role="dialog" tabindex="-1" style="width: 380px;" class="bg-card border border-border rounded-lg shadow-xl overflow-hidden"><!></div></div>'),xr=x('<div class="bg-card border border-border rounded-lg shadow-xl z-50 overflow-hidden"><!></div>'),_r=x('<div class="relative"><!> <!></div>');function yr(re,t){Ue(t,!0);let i=be(t,"selectedPubkeys",31,()=>Fe([])),v=be(t,"multiple",3,!0),p=be(t,"buttonClass",3,""),u=be(t,"disabled",3,!1),b=be(t,"iconOnly",3,!0),k=be(t,"open",15,!1),g=ve(""),M=null,m=ve(Fe({top:0,left:0,width:0}));const C=ce.$subscribe(()=>ce.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[ce.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),f=U(()=>{const w=C.events[0];return w?new Set(w.tags.filter(S=>S[0]==="p").map(S=>S[1])):new Set});let d=ve(Fe(new Map));const A=U(()=>e(g)?Array.from(e(d).entries()).filter(([S])=>e(f).has(S)).map(([S])=>S).slice(0,50):Array.from(e(f)).slice(0,50));Ze(()=>{if(!e(g).trim()||!ce.cacheAdapter?.getProfiles){l(d,new Map,!0);return}const w=e(g).toLowerCase();ce.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:w}).then(S=>{l(d,S??new Map,!0)}).catch(S=>{console.error("Failed to search profiles:",S),l(d,new Map,!0)})});function D(){if(!k()&&M){const w=M.getBoundingClientRect();l(m,{top:w.bottom+4,left:w.left,width:Math.max(w.width,380)},!0)}k(!k())}const P=U(()=>p().includes("hidden"));Ze(()=>{if(k()&&e(P)){const w=window.innerWidth,S=window.innerHeight,O=380;l(m,{top:(S-400)/2,left:(w-O)/2,width:O},!0)}});function _(w){v()?i().includes(w)?i(i().filter(S=>S!==w)):i([...i(),w]):(i([w]),k(!1)),t.onSelect?.(i())}function h(w){i(i().filter(S=>S!==w)),t.onSelect?.(i())}async function H(){if(e(g).trim())try{const w=e(g).trim(),S=await ce.fetchUser(w);S?.pubkey?(v()?i().includes(S.pubkey)||(i([...i(),S.pubkey]),t.onSelect?.(i()),Re.success("User added")):(i([S.pubkey]),t.onSelect?.(i()),k(!1)),l(g,"")):Re.error("User not found")}catch(w){console.error("Failed to fetch user:",w),Re.error("Failed to fetch user")}}function $(){k(!1)}const R=U(()=>{const w=e(g).trim();return w.length>0&&(w.startsWith("npub1")||w.startsWith("nprofile1")||w.includes("@")||w.length===64&&/^[0-9a-f]+$/i.test(w))});var N=_r(),ee=o(N);{let w=U(()=>b()?"icon":"default"),S=U(()=>b()?"h-8 w-8":"w-full justify-start"),O=U(p),ae=U(()=>t.buttonLabel||"Tag people");Ae(ee,{type:"button",variant:"ghost",get size(){return e(w)},get class(){return`${e(S)??""} ${e(O)??""}`},get disabled(){return u()},onclick:D,get title(){return e(ae)},get ref(){return M},set ref(G){M=G},children:(G,T)=>{var j=ge(),oe=q(j);{var ne=X=>{var ie=gr(),fe=s(q(ie),2),V=o(fe,!0);r(fe);var Q=s(fe,2);{var le=_e=>{var xe=pr(),F=o(xe,!0);r(xe),W(()=>J(F,i().length)),a(_e,xe)};z(Q,_e=>{i().length>0&&_e(le)})}W(()=>J(V,t.buttonLabel)),a(X,ie)},I=X=>{var ie=hr(),fe=s(q(ie));{var V=Q=>{var le=mr(),_e=o(le,!0);r(le),W(()=>J(_e,i().length)),a(Q,le)};z(fe,Q=>{i().length>0&&Q(V)})}a(X,ie)};z(oe,X=>{!b()&&t.buttonLabel?X(ne):X(I,!1)})}a(G,j)},$$slots:{default:!0}})}var E=s(ee,2);{var L=w=>{var S=ge(),O=q(S);{var ae=T=>{var j=br();j.__click=$,j.__keydown=I=>I.key==="Escape"&&$();var oe=o(j);oe.__click=I=>I.stopPropagation(),oe.__keydown=I=>I.stopPropagation();var ne=o(oe);pt(ne,{get isIdentifierInput(){return e(R)},get selectedPubkeys(){return i()},get filteredFollows(){return e(A)},get multiple(){return v()},onSearchQueryChange:I=>l(g,I,!0),onAddByIdentifier:H,onRemoveUser:h,onToggleUser:_,get searchQuery(){return e(g)},set searchQuery(I){l(g,I,!0)}}),r(oe),r(j),Ye(j,I=>ot?.(I)),a(T,j)},G=T=>{var j=xr(),oe=o(j);pt(oe,{get isIdentifierInput(){return e(R)},get selectedPubkeys(){return i()},get filteredFollows(){return e(A)},get multiple(){return v()},onSearchQueryChange:ne=>l(g,ne,!0),onAddByIdentifier:H,onRemoveUser:h,onToggleUser:_,get searchQuery(){return e(g)},set searchQuery(ne){l(g,ne,!0)}}),r(j),Ye(j,ne=>ot?.(ne)),Ye(j,(ne,I)=>tt?.(ne,I),()=>$),W(()=>yt(j,`position: fixed; top: ${e(m).top??""}px; left: ${e(m).left??""}px; width: 380px;`)),a(T,j)};z(O,T=>{e(P)?T(ae):T(G,!1)})}a(w,S)};z(E,w=>{k()&&w(L)})}r(N),a(re,N),Ne()}Ke(["click","keydown"]);var wr=x('<div class="text-xs text-muted-foreground truncate"> </div>'),kr=x('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div></button>');function Pr(re,t){Ue(t,!0);let i=ve(null);Ze(()=>{ce.fetchUser(t.pubkey).then(m=>{m?.fetchProfile().then(C=>{l(i,C,!0)})})});var v=kr();v.__click=m=>{m.preventDefault(),m.stopPropagation(),t.onSelect(t.pubkey)};var p=o(v);$e(p,{get ndk(){return ce},get pubkey(){return t.pubkey},size:32,class:"flex-shrink-0"});var u=s(p,2),b=o(u),k=o(b,!0);r(b);var g=s(b,2);{var M=m=>{var C=wr(),f=o(C,!0);r(C),W(()=>J(f,e(i).nip05)),a(m,C)};z(g,m=>{e(i)?.nip05&&m(M)})}r(u),r(v),W(()=>{Se(v,1,`w-full flex items-center gap-2 p-2 transition-colors ${t.isSelected?"bg-primary/20":"hover:bg-muted"}`),J(k,e(i)?.displayName||e(i)?.name||"Anonymous")}),Be("mouseenter",v,function(...m){t.onMouseEnter?.apply(this,m)}),a(re,v),Ne()}Ke(["click"]);var Cr=x('<div class="bg-card border border-border rounded-lg shadow-xl z-[1003] overflow-hidden"><div class="max-h-[300px] overflow-y-auto"></div></div>');function Rr(re,t){Ue(t,!0);let i=ve(0);const v=ce.$subscribe(()=>ce.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[ce.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),p=U(()=>{const f=v.events[0];return f?new Set(f.tags.filter(d=>d[0]==="p").map(d=>d[1])):new Set});let u=ve(Fe(new Map));const b=U(()=>t.searchQuery?Array.from(e(u).entries()).filter(([d])=>e(p).has(d)).map(([d])=>d).slice(0,10):Array.from(e(p)).slice(0,10));Ze(()=>{if(!t.searchQuery.trim()||!ce.cacheAdapter?.getProfiles){l(u,new Map,!0);return}const f=t.searchQuery.toLowerCase();ce.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:f}).then(d=>{l(u,d??new Map,!0)}).catch(d=>{console.error("Failed to search profiles:",d),l(u,new Map,!0)})}),Ze(()=>{e(i)>=e(b).length&&l(i,Math.max(0,e(b).length-1),!0)});function k(f){const d=ce.getUser({pubkey:f}),A=Array.from(d.relayUrls||[]),D=Ft.nprofileEncode({pubkey:f,relays:A.slice(0,3)});t.onSelect(`nostr:${D}`)}function g(f){switch(f.key){case"ArrowDown":f.preventDefault(),l(i,(e(i)+1)%e(b).length);break;case"ArrowUp":f.preventDefault(),l(i,e(i)===0?e(b).length-1:e(i)-1,!0);break;case"Enter":f.preventDefault(),e(b).length>0&&k(e(b)[e(i)]);break;case"Escape":f.preventDefault(),t.onClose();break}}var M=ge();Be("keydown",lt,g);var m=q(M);{var C=f=>{var d=Cr(),A=o(d);Xe(A,22,()=>e(b),D=>D,(D,P,_)=>{{let h=U(()=>e(_)===e(i));Pr(D,{get pubkey(){return P},get isSelected(){return e(h)},onSelect:k,onMouseEnter:()=>l(i,e(_),!0)})}}),r(A),r(d),Ye(d,D=>ot?.(D)),W(()=>yt(d,`position: fixed; top: ${t.position.top??""}px; left: ${t.position.left??""}px; max-width: 320px;`)),a(f,d)};z(m,f=>{e(b).length>0&&f(C)})}a(re,M),Ne()}var Sr=x('<div class="absolute inset-0 flex items-center justify-center"><div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div></div>'),Mr=x('<button type="button" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),zr=x('<div class="relative group"><img alt="Upload preview"/> <!></div>'),Er=x('<div class="flex flex-wrap gap-2 mt-2"></div>'),Ar=Ie('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Tr=x('<div><input type="file" accept="image/*" multiple class="hidden"/> <div><textarea class="w-full min-h-[120px] max-md:flex-1 max-md:min-h-0 bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none focus:ring-0 text-lg"></textarea> <!></div> <div class="flex items-center gap-2 mt-2 pt-2 border-t border-border"><!> <!> <!></div></div> <!>',1);function gt(re,t){Ue(t,!0);let i=be(t,"value",15,""),v=be(t,"placeholder",3,"What's on your mind?"),p=be(t,"autofocus",3,!1),u=be(t,"disabled",3,!1),b=be(t,"class",3,""),k=be(t,"selectedMentions",31,()=>Fe([]));const g=new Kt(ce),M=qt(g);let m,C,f=ve(!1),d=ve(Fe([])),A=ve(!1),D=ve(!1),P=ve(""),_=ve(0),h=ve(Fe({top:0,left:0})),H=Fe(new Map);async function $(n){if(!n.type.startsWith("image/")){Re.error("Please select an image file");return}const c=URL.createObjectURL(n),y=e(d).length;l(d,[...e(d),{url:"",preview:c}],!0),l(A,!0);try{await M.upload(n,{fallbackServer:"https://blossom.primal.net"}),M.result?.url&&(e(d)[y]={url:M.result.url,preview:c},R(M.result.url),Re.success("Image uploaded"))}catch(K){console.error("Upload failed:",K),Re.error("Failed to upload image"),l(d,e(d).filter((se,de)=>de!==y),!0)}finally{l(A,!1)}}function R(n){const c=m;if(!c)return;const y=c.selectionStart,K=c.selectionEnd,se=`
${n}
`;i(i().slice(0,y)+se+i().slice(K)),setTimeout(()=>{c.selectionStart=c.selectionEnd=y+se.length,c.focus()},0)}function N(n){const c=e(d)[n];c.url&&i(i().replace(`
${c.url}
`,"").replace(c.url,"")),URL.revokeObjectURL(c.preview),l(d,e(d).filter((y,K)=>K!==n),!0)}function ee(n){const c=n.target,y=c.files?.[0];y&&$(y),c.value=""}function E(n){n.preventDefault(),l(f,!0)}function L(n){n.preventDefault(),l(f,!1)}async function w(n){n.preventDefault(),l(f,!1);const c=n.dataTransfer?.files;if(c&&c.length>0)for(const y of Array.from(c))y.type.startsWith("image/")&&await $(y)}async function S(n){const c=n.clipboardData?.items;if(c){for(const y of Array.from(c))if(y.type.startsWith("image/")){n.preventDefault();const K=y.getAsFile();K&&await $(K)}}}function O(){C?.click()}function ae(){if(!m)return{top:0,left:0};const n=m,c=n.selectionStart,y=document.createElement("div"),K=window.getComputedStyle(n);["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(ye=>{y.style[ye]=K[ye]}),y.style.position="absolute",y.style.visibility="hidden",y.style.whiteSpace="pre-wrap",y.style.wordWrap="break-word",document.body.appendChild(y);const de=n.value.substring(0,c);y.textContent=de;const pe=document.createElement("span");pe.textContent=n.value.substring(c)||".",y.appendChild(pe);const me=n.getBoundingClientRect(),Me={top:me.top+pe.offsetTop+parseInt(K.borderTopWidth)-n.scrollTop+20,left:me.left+pe.offsetLeft+parseInt(K.borderLeftWidth)};return document.body.removeChild(y),Me}function G(n){const c=n.target,y=c.selectionStart,K=c.value.substring(0,y),se=K.lastIndexOf("@");if(se!==-1){const de=K.substring(se+1),pe=se>0?K[se-1]:" ",me=de.includes(" ")||de.includes(`
`);if((pe===" "||pe===`
`||se===0)&&!me){l(_,se,!0),l(P,de,!0),l(h,ae(),!0),l(D,!0);return}}l(D,!1)}async function T(n){const c=m;if(!c)return;const y=c.selectionStart;if(!n.match(/nostr:nprofile1([a-z0-9]+)/))return;const se=ce.getUser({nprofile:n.replace("nostr:","")});await se.fetchProfile();const de=se.profile?.nip05?`@${se.profile.nip05}`:`@${se.profile?.displayName||se.profile?.name||se.npub.slice(0,12)}`;H.set(de,n);const pe=i().substring(0,e(_)),me=i().substring(y);i(pe+de+" "+me);const Me=e(_)+de.length+1;setTimeout(()=>{c.selectionStart=c.selectionEnd=Me,c.focus()},0),l(D,!1),l(P,"")}function j(){l(D,!1),l(P,"")}function oe(){let n=i();for(const[c,y]of H)for(;n.includes(c);)n=n.replace(c,y);return n}function ne(){i(""),H.clear(),l(d,[],!0),l(D,!1),l(P,"")}function I(n){e(D)||n.key==="Enter"&&n.stopPropagation()}var X={getContentWithNostrEntities:oe,reset:ne},ie=Tr(),fe=q(ie),V=o(fe);V.__change=ee,at(V,n=>C=n,()=>C);var Q=s(V,2),le=o(Q);Tt(le),jt(le,p()),le.__input=G,le.__keydown=I,at(le,n=>m=n,()=>m);var _e=s(le,2);{var xe=n=>{var c=Er();Xe(c,23,()=>e(d),y=>y.preview,(y,K,se)=>{var de=zr(),pe=o(de),me=s(pe,2);{var Me=Pe=>{var we=Sr();a(Pe,we)},ye=Pe=>{var we=Mr();we.__click=()=>N(e(se)),a(Pe,we)};z(me,Pe=>{e(K).url?Pe(ye,!1):Pe(Me)})}r(de),W(()=>{qe(pe,"src",e(K).preview),Se(pe,1,`w-20 h-20 object-cover rounded-lg border border ${e(K).url?"":"opacity-50 animate-pulse"}`)}),a(y,de)}),r(c),a(n,c)};z(_e,n=>{e(d).length>0&&n(xe)})}r(Q);var F=s(Q,2),B=o(F);{var ue=n=>{var c=ge(),y=q(c);_t(y,()=>t.relayButton),a(n,c)};z(B,n=>{t.relayButton&&n(ue)})}var he=s(B,2);{let n=U(()=>u()||e(A));Ae(he,{type:"button",variant:"ghost",size:"icon",onclick:O,get disabled(){return e(n)},class:"h-8 w-8",title:"Add image",children:(c,y)=>{var K=Ar();a(c,K)},$$slots:{default:!0}})}var te=s(he,2);yr(te,{get onSelect(){return t.onMentionsChange},get disabled(){return u()},get selectedPubkeys(){return k()},set selectedPubkeys(n){k(n)}}),r(F),r(fe);var Z=s(fe,2);{var Y=n=>{Rr(n,{get position(){return e(h)},get searchQuery(){return e(P)},onSelect:T,onClose:j})};z(Z,n=>{e(D)&&n(Y)})}return W(()=>{Se(fe,1,`relative flex-1 flex flex-col ${b()??""}`),Se(Q,1,`flex-1 flex flex-col ${e(f)?"ring-2 ring-primary ring-offset-2 rounded-lg":""}`),qe(le,"placeholder",v()),le.disabled=u()}),Be("dragover",Q,E),Be("dragleave",Q,L),Be("drop",Q,w),Be("paste",le,S),zt(le,i),a(re,ie),Ne(X)}Ke(["change","input","keydown","click"]);function jr(re){const t=Fe({selectedRelayUrls:[]}),i=U(()=>Je.relays.filter(v=>v.enabled));return Ze(()=>{re()&&(Je.selectedRelay?t.selectedRelayUrls=[Je.selectedRelay]:t.selectedRelayUrls.length===0&&(t.selectedRelayUrls=e(i).filter(v=>v.write).map(v=>v.url)))}),{get selectedRelayUrls(){return t.selectedRelayUrls},set selectedRelayUrls(v){t.selectedRelayUrls=v},get allRelays(){return e(i)}}}var Ur=x('<div class="-mx-6 px-4 py-3 mb-4 border-b border-border bg-card/50"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),Nr=x('<img alt="" class="w-5 h-5 rounded border border-background"/>'),Ir=x('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><!></div>'),Lr=x('<div class="flex items-center -space-x-1"></div>'),Br=x('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Dr=x('<div class="relative"><!> <!></div>'),Fr=x('<div class="absolute top-full left-0 mt-2 bg-popover border border-border rounded-lg shadow-xl z-[100] w-80 max-h-[400px] overflow-y-auto transition-all duration-200"><!></div>'),Zr=x('<div class="relative"><!> <!></div>'),Qr=x('<div class="-mx-6 px-4 py-3 mb-4 border-y border-border bg-muted/30"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="border border-border rounded-lg overflow-hidden bg-card"><!></div></div>'),Wr=x('<div class="flex items-center justify-between -mx-6 -mt-6 px-4 py-3 mb-4 border-b border-border"><!> <!> <!></div> <!> <div class="relative mb-4"><!></div> <!> <div class="-mx-6 px-4 py-3 border-t border-border"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel, <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">âŒ˜</kbd> + <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Enter</kbd> to post</p></div>',1),Kr=x('<div class="px-4 py-3 mb-4 border-b border-border bg-card/50 shrink-0"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),qr=x('<img alt="" class="w-5 h-5 rounded border border-background"/>'),Hr=x('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><!></div>'),Or=x('<div class="flex items-center -space-x-1"></div>'),Vr=x('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Yr=x('<div class="relative"><!> <!></div>'),Xr=x('<div role="presentation" class="fixed inset-0 bg-black/50 z-[1002] flex items-center justify-center transition-opacity"><div role="dialog" tabindex="-1" class="bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto"><!></div></div>'),Gr=x('<div class="relative"><!> <!></div>'),Jr=x('<div class="px-4 py-3 mb-4 border-y border-border bg-muted/30 shrink-0"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="border border-border rounded-lg overflow-hidden bg-card"><!></div></div>'),$r=x('<div class="flex items-center justify-between px-4 py-3 mb-4 border-b border-border shrink-0"><!> <!> <!></div> <!> <div class="relative mb-4 flex-1 flex flex-col overflow-hidden px-4"><div class="flex-1 overflow-hidden"><!></div></div> <!> <div class="px-4 py-3 border-t border-border shrink-0"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel, <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">âŒ˜</kbd> + <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Enter</kbd> to post</p></div>',1);function mt(re,t){Ue(t,!0);const i=new wt("(min-width: 768px)");let v=be(t,"open",15,!1),p=ve(""),u=ve(!1),b=ve(!1),k=ve(!1),g=ve(Fe([])),M,m=ve(null);Ze(()=>{if(!t.replyTo){l(m,null);return}t.replyTo.author.fetchProfile().then(E=>{l(m,E,!0)})});const C=jr(()=>v()),f=U(()=>C.selectedRelayUrls),d=U(()=>C.allRelays);async function A(){if(!(!e(p).trim()||e(u)||e(f).length===0))try{l(u,!0);const E=M?.getContentWithNostrEntities()??e(p);let L;t.replyTo?L=t.replyTo.reply():t.quotedEvent?(L=new it(ce),L.kind=1,L.tag(t.quotedEvent,void 0,!1,"q")):(L=new it(ce),L.kind=1),L.content=t.quotedEvent?`${E}
nostr:${t.quotedEvent.encode()}`:E,t.replyTo||(L.isProtected=e(k)),e(g).forEach(S=>{L.tags.push(["p",S])}),await L.sign();const w=Zt.fromRelayUrls(e(f),ce);if(await L.publish(w),L.publishStatus==="error"){const S=L.publishError;console.error("Publish error object:",S),console.error("Relay errors:",S?.relayErrors);const O=S?.relayErrors||{},ae=Object.entries(O);if(ae.length>0){const G=ae.map(([T,j])=>`â€¢ ${T.replace("wss://","")}: ${j}`).join(`
`);Re.error(`Failed to publish to relays:

${G}`)}else Re.error(`Failed to publish: ${S?.message||"Not enough relays received the event"}`);return}M?.reset(),l(p,""),l(g,[],!0),v(!1),Re.success(t.replyTo?"Reply published":t.quotedEvent?"Quote published":"Note published"),t.onPublished?.(),t.onClose?.()}catch(E){console.error("Failed to publish note:",E),Re.error(`Failed to publish: ${E instanceof Error?E.message:"Unknown error"}`)}finally{l(u,!1)}}function D(E){C.selectedRelayUrls.includes(E)?C.selectedRelayUrls=C.selectedRelayUrls.filter(L=>L!==E):C.selectedRelayUrls=[...C.selectedRelayUrls,E]}function P(E){C.selectedRelayUrls=[E],l(b,!1)}function _(){l(b,!1)}function h(){e(u)||(v(!1),l(p,""),l(g,[],!0),t.onClose?.())}function H(E){(E.metaKey||E.ctrlKey)&&E.key==="Enter"&&A()}var $=ge();Be("keydown",lt,H);var R=q($);{var N=E=>{var L=ge(),w=q(L);ke(w,()=>Ct,(S,O)=>{O(S,{get open(){return v()},onOpenChange:ae=>{ae?v(!0):h()},children:(ae,G)=>{var T=ge(),j=q(T);ke(j,()=>kt,(oe,ne)=>{ne(oe,{class:"md:max-w-2xl !overflow-visible",children:(I,X)=>{var ie=Wr(),fe=q(ie),V=o(fe);Ae(V,{variant:"ghost",size:"icon",onclick:h,get disabled(){return e(u)},class:"h-10 w-10",children:(te,Z)=>{je(te,{name:"close",size:"lg"})},$$slots:{default:!0}});var Q=s(V,2);ke(Q,()=>Pt,(te,Z)=>{Z(te,{class:"text-lg",children:(Y,n)=>{Ce();var c=ze();W(()=>J(c,t.replyTo?"Reply":t.quotedEvent?"Quote":"Compose")),a(Y,c)},$$slots:{default:!0}})});var le=s(Q,2);{let te=U(()=>!e(p).trim()||e(u)||e(f).length===0);Ae(le,{onclick:A,get disabled(){return e(te)},class:"rounded-full",size:"sm",children:(Z,Y)=>{Ce();var n=ze();W(()=>J(n,e(u)?"Publishing...":"Post")),a(Z,n)},$$slots:{default:!0}})}r(fe);var _e=s(fe,2);{var xe=te=>{var Z=Ur(),Y=o(Z),n=o(Y);$e(n,{get ndk(){return ce},get pubkey(){return t.replyTo.pubkey},class:"w-10 h-10"});var c=s(n,2),y=o(c),K=o(y),se=o(K,!0);r(K);var de=s(K,2),pe=o(de);r(de),r(y);var me=s(y,2),Me=o(me,!0);r(me),r(c),r(Y),r(Z),W((ye,Pe)=>{J(se,ye),J(pe,`@${Pe??""}`),J(Me,t.replyTo.content)},[()=>e(m).displayName||e(m).name||`${t.replyTo.pubkey.slice(0,8)}...`,()=>e(m).name||t.replyTo.pubkey.slice(0,8)]),a(te,Z)};z(_e,te=>{t.replyTo&&e(m)&&te(xe)})}var F=s(_e,2),B=o(F);{const te=Y=>{var n=Zr(),c=o(n);Ae(c,{type:"button",variant:"ghost",size:"icon",onclick:()=>l(b,!e(b)),get disabled(){return e(u)},class:"h-8 w-8",title:"Select relays",children:(se,de)=>{var pe=ge(),me=q(pe);{var Me=Pe=>{var we=Lr();Xe(we,21,()=>e(f),rt,(Le,He)=>{const Oe=U(()=>e(d).find(We=>We.url===e(He))),De=U(()=>e(Oe)?ut(e(Oe).url):null);var Te=ge(),Qe=q(Te);{var Ge=We=>{var Ee=Nr();W(()=>qe(Ee,"src",e(De).info.icon)),a(We,Ee)},nt=We=>{var Ee=Ir(),Ve=o(Ee);je(Ve,{name:"relay",size:"xs",class:"text-muted-foreground"}),r(Ee),a(We,Ee)};z(Qe,We=>{e(De)?.info?.icon?We(Ge):We(nt,!1)})}a(Le,Te)}),r(we),a(Pe,we)},ye=Pe=>{var we=Dr(),Le=o(we);je(Le,{name:"relay",size:"md"});var He=s(Le,2);{var Oe=De=>{var Te=Br(),Qe=o(Te,!0);r(Te),W(()=>J(Qe,e(f).length)),a(De,Te)};z(He,De=>{e(f).length>2&&De(Oe)})}r(we),a(Pe,we)};z(me,Pe=>{e(f).length<=2&&e(f).length>0?Pe(Me):Pe(ye,!1)})}a(se,pe)},$$slots:{default:!0}});var y=s(c,2);{var K=se=>{var de=Fr(),pe=o(de);vt(pe,{get selectedRelayUrls(){return e(f)},onToggleRelay:D,onSelectOnly:P,get isProtected(){return e(k)},set isProtected(me){l(k,me,!0)}}),r(de),Ye(de,(me,Me)=>tt?.(me,Me),()=>_),a(se,de)};z(y,se=>{e(b)&&se(K)})}r(n),a(Y,n)};let Z=U(()=>t.replyTo?"Write your reply...":t.quotedEvent?"Add your thoughts...":"What's on your mind?");at(gt(B,{get placeholder(){return e(Z)},autofocus:!0,get disabled(){return e(u)},get value(){return e(p)},set value(Y){l(p,Y,!0)},get selectedMentions(){return e(g)},set selectedMentions(Y){l(g,Y,!0)},relayButton:te,$$slots:{relayButton:!0}}),Y=>M=Y,()=>M)}r(F);var ue=s(F,2);{var he=te=>{var Z=Qr(),Y=s(o(Z),2),n=o(Y);xt(n,{get event(){return t.quotedEvent},showActions:!1}),r(Y),r(Z),a(te,Z)};z(ue,te=>{t.quotedEvent&&te(he)})}Ce(2),a(I,ie)},$$slots:{default:!0}})}),a(ae,T)},$$slots:{default:!0}})}),a(E,L)},ee=E=>{var L=ge(),w=q(L);ke(w,()=>Mt,(S,O)=>{O(S,{get open(){return v()},onOpenChange:ae=>{ae?v(!0):h()},children:(ae,G)=>{var T=ge(),j=q(T);ke(j,()=>Rt,(oe,ne)=>{ne(oe,{class:"h-[95vh] flex flex-col !overflow-visible",children:(I,X)=>{var ie=$r(),fe=q(ie),V=o(fe);Ae(V,{variant:"ghost",size:"icon",onclick:h,get disabled(){return e(u)},class:"h-10 w-10",children:(Z,Y)=>{je(Z,{name:"close",size:"lg"})},$$slots:{default:!0}});var Q=s(V,2);ke(Q,()=>St,(Z,Y)=>{Y(Z,{class:"text-lg",children:(n,c)=>{Ce();var y=ze();W(()=>J(y,t.replyTo?"Reply":t.quotedEvent?"Quote":"Compose")),a(n,y)},$$slots:{default:!0}})});var le=s(Q,2);{let Z=U(()=>!e(p).trim()||e(u)||e(f).length===0);Ae(le,{onclick:A,get disabled(){return e(Z)},class:"rounded-full",size:"sm",children:(Y,n)=>{Ce();var c=ze();W(()=>J(c,e(u)?"Publishing...":"Post")),a(Y,c)},$$slots:{default:!0}})}r(fe);var _e=s(fe,2);{var xe=Z=>{var Y=Kr(),n=o(Y),c=o(n);$e(c,{get ndk(){return ce},get pubkey(){return t.replyTo.pubkey},class:"w-10 h-10"});var y=s(c,2),K=o(y),se=o(K),de=o(se,!0);r(se);var pe=s(se,2),me=o(pe);r(pe),r(K);var Me=s(K,2),ye=o(Me,!0);r(Me),r(y),r(n),r(Y),W((Pe,we)=>{J(de,Pe),J(me,`@${we??""}`),J(ye,t.replyTo.content)},[()=>e(m).displayName||e(m).name||`${t.replyTo.pubkey.slice(0,8)}...`,()=>e(m).name||t.replyTo.pubkey.slice(0,8)]),a(Z,Y)};z(_e,Z=>{t.replyTo&&e(m)&&Z(xe)})}var F=s(_e,2),B=o(F),ue=o(B);{const Z=n=>{var c=Gr(),y=o(c);Ae(y,{type:"button",variant:"ghost",size:"icon",onclick:()=>l(b,!e(b)),get disabled(){return e(u)},class:"h-8 w-8",title:"Select relays",children:(de,pe)=>{var me=ge(),Me=q(me);{var ye=we=>{var Le=Or();Xe(Le,21,()=>e(f),rt,(He,Oe)=>{const De=U(()=>e(d).find(Ee=>Ee.url===e(Oe))),Te=U(()=>e(De)?ut(e(De).url):null);var Qe=ge(),Ge=q(Qe);{var nt=Ee=>{var Ve=qr();W(()=>qe(Ve,"src",e(Te).info.icon)),a(Ee,Ve)},We=Ee=>{var Ve=Hr(),At=o(Ve);je(At,{name:"relay",size:"xs",class:"text-muted-foreground"}),r(Ve),a(Ee,Ve)};z(Ge,Ee=>{e(Te)?.info?.icon?Ee(nt):Ee(We,!1)})}a(He,Qe)}),r(Le),a(we,Le)},Pe=we=>{var Le=Yr(),He=o(Le);je(He,{name:"relay",size:"md"});var Oe=s(He,2);{var De=Te=>{var Qe=Vr(),Ge=o(Qe,!0);r(Qe),W(()=>J(Ge,e(f).length)),a(Te,Qe)};z(Oe,Te=>{e(f).length>2&&Te(De)})}r(Le),a(we,Le)};z(Me,we=>{e(f).length<=2&&e(f).length>0?we(ye):we(Pe,!1)})}a(de,me)},$$slots:{default:!0}});var K=s(y,2);{var se=de=>{var pe=Xr();pe.__click=_,pe.__keydown=ye=>ye.key==="Escape"&&_();var me=o(pe);me.__click=ye=>ye.stopPropagation(),me.__keydown=ye=>ye.stopPropagation();var Me=o(me);vt(Me,{get selectedRelayUrls(){return e(f)},onToggleRelay:D,onSelectOnly:P,get isProtected(){return e(k)},set isProtected(ye){l(k,ye,!0)}}),r(me),r(pe),Ye(pe,ye=>ot?.(ye)),a(de,pe)};z(K,de=>{e(b)&&de(se)})}r(c),a(n,c)};let Y=U(()=>t.replyTo?"Write your reply...":t.quotedEvent?"Add your thoughts...":"What's on your mind?");at(gt(ue,{get placeholder(){return e(Y)},autofocus:!0,get disabled(){return e(u)},class:"flex-1 overflow-hidden",get value(){return e(p)},set value(n){l(p,n,!0)},get selectedMentions(){return e(g)},set selectedMentions(n){l(g,n,!0)},relayButton:Z,$$slots:{relayButton:!0}}),n=>M=n,()=>M)}r(B),r(F);var he=s(F,2);{var te=Z=>{var Y=Jr(),n=s(o(Y),2),c=o(n);xt(c,{get event(){return t.quotedEvent},showActions:!1}),r(n),r(Y),a(Z,Y)};z(he,Z=>{t.quotedEvent&&Z(te)})}Ce(2),a(I,ie)},$$slots:{default:!0}})}),a(ae,T)},$$slots:{default:!0}})}),a(E,L)};z(R,E=>{i.current?E(N):E(ee,!1)})}a(re,$),Ne()}Ke(["click","keydown"]);var ea=x('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),ta=x('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),ra=x('<span class="text-xl mr-2">âš¡</span> ',1),aa=x("<!> <!>",1),oa=x('<div class="relative -mx-6 -mt-6 px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">âš¡</span></div> <div><!> <!></div></div></div> <div class="space-y-6"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!> <!></div>',1),na=x('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),sa=x('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),la=x('<span class="text-xl mr-2">âš¡</span> ',1),ia=x('<div class="flex gap-3"><!> <!></div>'),da=x('<div class="relative px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">âš¡</span></div> <div><!> <!></div></div></div> <div class="space-y-6 px-4"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!></div> <!>',1);function ua(re,t){Ue(t,!0);const i=new wt("(min-width: 768px)");let v=be(t,"open",15,!1);const p=[{value:10,label:"10",emoji:"â˜•"},{value:21,label:"21",emoji:"âš¡"},{value:50,label:"50",emoji:"ðŸ¤™"},{value:100,label:"100",emoji:"ðŸ’¯"},{value:500,label:"500",emoji:"ðŸ”¥"},{value:1e3,label:"1K",emoji:"ðŸ’Ž"},{value:2100,label:"2.1K",emoji:"ðŸš€"},{value:5e3,label:"5K",emoji:"ðŸ‘‘"}];let u=ve(Fe(Je.zap.defaultAmount)),b=ve(""),k=ve(!1);function g(P){l(u,P,!0),l(k,!1),l(b,"")}function M(){l(k,!0);const P=Number.parseInt(e(b));!Number.isNaN(P)&&P>0&&l(u,P,!0)}function m(){e(u)>0&&t.onZap(e(u))}function C(P){P.key==="Enter"&&e(u)>0&&m()}var f=ge();Be("keydown",lt,C);var d=q(f);{var A=P=>{var _=ge(),h=q(_);ke(h,()=>Ct,(H,$)=>{$(H,{get open(){return v()},onOpenChange:R=>{R?v(!0):t.onCancel()},children:(R,N)=>{var ee=ge(),E=q(ee);ke(E,()=>kt,(L,w)=>{w(L,{class:"max-w-md bg-background border-2 border-primary/30 shadow-2xl shadow-primary/50",children:(S,O)=>{var ae=oa(),G=q(ae),T=s(o(G),2),j=s(o(T),2),oe=o(j);ke(oe,()=>Pt,(F,B)=>{B(F,{class:"text-xl text-foreground",children:(ue,he)=>{Ce();var te=ze("Zap Amount");a(ue,te)},$$slots:{default:!0}})});var ne=s(oe,2);ke(ne,()=>Ht,(F,B)=>{B(F,{class:"text-sm text-muted-foreground",children:(ue,he)=>{Ce();var te=ze("Choose your zap amount");a(ue,te)},$$slots:{default:!0}})}),r(j),r(T),r(G);var I=s(G,2),X=o(I);Xe(X,21,()=>p,rt,(F,B)=>{{let ue=U(()=>e(u)===e(B).value&&!e(k)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");Ae(F,{variant:"ghost",onclick:()=>g(e(B).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${e(ue)??""}`},children:(he,te)=>{var Z=ea(),Y=s(q(Z),2),n=o(Y),c=o(n,!0);r(n);var y=s(n,2),K=o(y,!0);r(y),r(Y),W(()=>{J(c,e(B).emoji),Se(y,1,`text-xs font-bold ${e(u)===e(B).value&&!e(k)?"text-primary-foreground":"text-foreground"}`),J(K,e(B).label)}),a(he,Z)},$$slots:{default:!0}})}}),r(X);var ie=s(X,2),fe=o(ie);ft(fe,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(F,B)=>{Ce();var ue=ze("Custom Amount");a(F,ue)},$$slots:{default:!0}});var V=s(fe,2),Q=o(V);{let F=U(()=>e(k)?"border-primary":"border-border");ct(Q,{id:"custom-amount",type:"number",oninput:M,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${e(F)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return e(b)},set value(B){l(b,B,!0)}})}Ce(2),r(V),r(ie);var le=s(ie,2);{var _e=F=>{var B=ta(),ue=o(B),he=s(o(ue),2),te=o(he);r(he),r(ue),r(B),W(Z=>J(te,`${Z??""} sats`),[()=>e(u).toLocaleString()]),a(F,B)};z(le,F=>{e(u)>0&&F(_e)})}var xe=s(le,2);ke(xe,()=>Yt,(F,B)=>{B(F,{class:"flex gap-3 sm:space-x-0",children:(ue,he)=>{var te=aa(),Z=q(te);Ae(Z,{variant:"outline",get onclick(){return t.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(n,c)=>{Ce();var y=ze("Cancel");a(n,y)},$$slots:{default:!0}});var Y=s(Z,2);{let n=U(()=>e(u)<=0);Ae(Y,{onclick:m,get disabled(){return e(n)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(c,y)=>{var K=ra(),se=s(q(K));W(de=>J(se,` Zap ${de??""}`),[()=>e(u)>0?e(u).toLocaleString():""]),a(c,K)},$$slots:{default:!0}})}a(ue,te)},$$slots:{default:!0}})}),r(I),a(S,ae)},$$slots:{default:!0}})}),a(R,ee)},$$slots:{default:!0}})}),a(P,_)},D=P=>{var _=ge(),h=q(_);ke(h,()=>Mt,(H,$)=>{$(H,{get open(){return v()},onOpenChange:R=>{R?v(!0):t.onCancel()},children:(R,N)=>{var ee=ge(),E=q(ee);ke(E,()=>Rt,(L,w)=>{w(L,{children:(S,O)=>{var ae=da(),G=q(ae),T=s(o(G),2),j=s(o(T),2),oe=o(j);ke(oe,()=>St,(F,B)=>{B(F,{class:"text-xl text-foreground",children:(ue,he)=>{Ce();var te=ze("Zap Amount");a(ue,te)},$$slots:{default:!0}})});var ne=s(oe,2);ke(ne,()=>Ot,(F,B)=>{B(F,{class:"text-sm text-muted-foreground",children:(ue,he)=>{Ce();var te=ze("Choose your zap amount");a(ue,te)},$$slots:{default:!0}})}),r(j),r(T),r(G);var I=s(G,2),X=o(I);Xe(X,21,()=>p,rt,(F,B)=>{{let ue=U(()=>e(u)===e(B).value&&!e(k)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");Ae(F,{variant:"ghost",onclick:()=>g(e(B).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${e(ue)??""}`},children:(he,te)=>{var Z=na(),Y=s(q(Z),2),n=o(Y),c=o(n,!0);r(n);var y=s(n,2),K=o(y,!0);r(y),r(Y),W(()=>{J(c,e(B).emoji),Se(y,1,`text-xs font-bold ${e(u)===e(B).value&&!e(k)?"text-primary-foreground":"text-foreground"}`),J(K,e(B).label)}),a(he,Z)},$$slots:{default:!0}})}}),r(X);var ie=s(X,2),fe=o(ie);ft(fe,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(F,B)=>{Ce();var ue=ze("Custom Amount");a(F,ue)},$$slots:{default:!0}});var V=s(fe,2),Q=o(V);{let F=U(()=>e(k)?"border-primary":"border-border");ct(Q,{id:"custom-amount",type:"number",oninput:M,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${e(F)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return e(b)},set value(B){l(b,B,!0)}})}Ce(2),r(V),r(ie);var le=s(ie,2);{var _e=F=>{var B=sa(),ue=o(B),he=s(o(ue),2),te=o(he);r(he),r(ue),r(B),W(Z=>J(te,`${Z??""} sats`),[()=>e(u).toLocaleString()]),a(F,B)};z(le,F=>{e(u)>0&&F(_e)})}r(I);var xe=s(I,2);ke(xe,()=>Vt,(F,B)=>{B(F,{class:"pt-2",children:(ue,he)=>{var te=ia(),Z=o(te);Ae(Z,{variant:"outline",get onclick(){return t.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(n,c)=>{Ce();var y=ze("Cancel");a(n,y)},$$slots:{default:!0}});var Y=s(Z,2);{let n=U(()=>e(u)<=0);Ae(Y,{onclick:m,get disabled(){return e(n)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(c,y)=>{var K=la(),se=s(q(K));W(de=>J(se,` Zap ${de??""}`),[()=>e(u)>0?e(u).toLocaleString():""]),a(c,K)},$$slots:{default:!0}})}r(te),a(ue,te)},$$slots:{default:!0}})}),a(S,ae)},$$slots:{default:!0}})}),a(R,ee)},$$slots:{default:!0}})}),a(P,_)};z(d,P=>{i.current?P(A):P(D,!1)})}a(re,f),Ne()}var ca=Ie('<svg class="w-6 h-6 animate-spin text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),va=Ie('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),fa=Ie('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),pa=Ie('<svg stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),ga=x('<button type="button"><div><!></div> <span class="text-xs font-semibold text-white"><!></span></button>'),ma=Ie('<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),ha=Ie('<svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>'),ba=Ie('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),xa=Ie('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),_a=Ie('<svg class="w-5 h-5" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),ya=x('<span class="text-xs opacity-70"> </span>'),wa=x(" <!>",1),ka=x('<button type="button"><!> <span class="text-sm group-hover:underline"><!></span></button>'),Pa=x("<!> <!>",1);function ht(re,t){Ue(t,!0);const i=be(t,"variant",3,"default"),v=ce.$zaps(()=>({target:t.event,validated:!0})),p=U(()=>{const R=ce.$currentPubkey;return R?Qt(v.events,R):!1}),u=U(()=>{const R=v.totalAmount;return R>=1e6?`${(R/1e6).toFixed(1)}M`:R>=1e3?`${(R/1e3).toFixed(1)}K`:R.toString()});let b=ve(!1),k=ve(!1),g=ve(!1),M=null;async function m(R){if(!ce.signer){Re.error("Please login to zap");return}l(k,!0);try{await Gt(ce,t.event,R*1e3),l(g,!0),setTimeout(()=>l(g,!1),2e3),Re.success(`Zapped ${R} sats!`)}catch(N){console.error("Failed to zap:",N);const ee=N instanceof Error?N.message:"Failed to send zap";ee.includes("wallet")||ee.includes("NWC")?Re.error("Lightning wallet error. Please check your wallet connection in settings."):ee.includes("invoice")?Re.error("Failed to create invoice. The recipient may not have a Lightning address configured."):Re.error("Failed to send zap. Please try again.")}finally{l(k,!1)}}async function C(R){R.stopPropagation(),!(e(k)||!ce.signer)&&await m(Je.zap.defaultAmount)}function f(R){l(b,!1),m(R)}function d(R){R.preventDefault(),R.stopPropagation(),M=setTimeout(()=>{l(b,!0),M=null},500)}function A(R){M&&(clearTimeout(M),M=null,(R.type==="mouseup"||R.type==="touchend")&&C(R))}function D(){M&&(clearTimeout(M),M=null)}var P=Pa(),_=q(P);{var h=R=>{var N=ga();N.__mousedown=d,N.__mouseup=A,N.__touchstart=d,N.__touchend=A;var ee=o(N),E=o(ee);{var L=T=>{var j=ca();a(T,j)},w=T=>{var j=pa(),oe=o(j);{var ne=X=>{var ie=va();a(X,ie)},I=X=>{var ie=fa();a(X,ie)};z(oe,X=>{e(p)?X(ne):X(I,!1)})}r(j),W(()=>{Se(j,0,`w-6 h-6 transition-colors ${e(p)?"text-yellow-400":"text-white"}`),qe(j,"fill",e(p)?"currentColor":"none")}),a(T,j)};z(E,T=>{e(k)?T(L):T(w,!1)})}r(ee);var S=s(ee,2),O=o(S);{var ae=T=>{var j=ze();W(()=>J(j,e(u))),a(T,j)},G=T=>{var j=ze("Zap");a(T,j)};z(O,T=>{v.totalAmount>0?T(ae):T(G,!1)})}r(S),r(N),W(()=>{N.disabled=e(k),Se(N,1,`flex flex-col items-center gap-1 hover:scale-110 transition-transform group ${e(k)?"opacity-50 cursor-wait":""}`),Se(ee,1,`w-12 h-12 rounded-full backdrop-blur-sm flex items-center justify-center transition-colors ${e(g)?"bg-yellow-400/30":e(p)?"bg-yellow-400/20":"bg-white/20"}`)}),Be("mouseleave",N,D),Be("touchcancel",N,D),a(R,N)},H=R=>{var N=ka();N.__mousedown=d,N.__mouseup=A,N.__touchstart=d,N.__touchend=A;var ee=o(N);{var E=G=>{var T=ma();a(G,T)},L=G=>{var T=ge(),j=q(T);{var oe=I=>{var X=ha();a(I,X)},ne=I=>{var X=_a(),ie=o(X);{var fe=Q=>{var le=ba();a(Q,le)},V=Q=>{var le=xa();a(Q,le)};z(ie,Q=>{e(p)?Q(fe):Q(V,!1)})}r(X),W(()=>qe(X,"fill",e(p)?"currentColor":"none")),a(I,X)};z(j,I=>{e(g)?I(oe):I(ne,!1)},!0)}a(G,T)};z(ee,G=>{e(k)?G(E):G(L,!1)})}var w=s(ee,2),S=o(w);{var O=G=>{var T=ze("Zapped!");a(G,T)},ae=G=>{var T=ge(),j=q(T);{var oe=I=>{var X=ze("Zapping...");a(I,X)},ne=I=>{var X=ge(),ie=q(X);{var fe=Q=>{var le=wa(),_e=q(le),xe=s(_e);{var F=B=>{var ue=ya(),he=o(ue);r(ue),W(()=>J(he,`(${v.count??""})`)),a(B,ue)};z(xe,B=>{v.count>0&&B(F)})}W(()=>J(_e,`${e(u)??""} `)),a(Q,le)},V=Q=>{var le=ze("Zap");a(Q,le)};z(ie,Q=>{v.totalAmount>0?Q(fe):Q(V,!1)},!0)}a(I,X)};z(j,I=>{e(k)?I(oe):I(ne,!1)},!0)}a(G,T)};z(S,G=>{e(g)?G(O):G(ae,!1)})}r(w),r(N),W(()=>{N.disabled=e(k),Se(N,1,`relative flex items-center gap-2 transition-colors group ${e(g)||e(p)?"text-yellow-400":"text-muted-foreground hover:text-yellow-400"} ${e(k)?"opacity-50 cursor-wait":""}`)}),Be("mouseleave",N,D),Be("touchcancel",N,D),a(R,N)};z(_,R=>{i()==="tiktok"?R(h):R(H,!1)})}var $=s(_,2);ua($,{get event(){return t.event},onZap:f,onCancel:()=>l(b,!1),get open(){return e(b)},set open(R){l(b,R,!0)}}),a(re,P),Ne()}Ke(["mousedown","mouseup","touchstart","touchend"]);function bt(...re){return Xt(It(re))}var Ca=Ie('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" color="currentColor"><path d="M10.4107 19.9677C7.58942 17.858 2 13.0348 2 8.69444C2 5.82563 4.10526 3.5 7 3.5C8.5 3.5 10 4 12 6C14 4 15.5 3.5 17 3.5C19.8947 3.5 22 5.82563 22 8.69444C22 13.0348 16.4106 17.858 13.5893 19.9677C12.6399 20.6776 11.3601 20.6776 10.4107 19.9677Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="svelte-1sd6u65"></path></svg>'),Ra=x('<span class="text-lg leading-none flex-shrink-0 svelte-1sd6u65"> </span>'),Sa=x('<span class="text-sm font-medium svelte-1sd6u65"> </span>'),Ma=x("<button><!> <!></button>");function za(re,t){Ue(t,!0);let i=be(t,"emoji",3,"â¤ï¸"),v=be(t,"showCount",3,!0),p=be(t,"class",3,"");const u=Ut("ndk"),b=U(()=>t.ndk||u),k=U(()=>Et(()=>({event:t.event}),e(b))),g=U(()=>e(k).get(i())??{count:0,hasReacted:!1,pubkeys:[],emoji:i()});async function M(P){if(P.stopPropagation(),!!e(b)?.$currentPubkey)try{await e(k).react(i())}catch(_){console.error("Failed to react:",_)}}var m=Ma();m.__click=M;var C=o(m);{var f=P=>{var _=Ca();W(h=>{Se(_,0,h,"svelte-1sd6u65"),qe(_,"fill",e(g).hasReacted?"currentColor":"none")},[()=>st(bt("flex-shrink-0",e(g).hasReacted&&"animate-[heartbeat_0.3s_ease-in-out]"))]),a(P,_)},d=P=>{var _=Ra(),h=o(_,!0);r(_),W(()=>J(h,i())),a(P,_)};z(C,P=>{i()==="â¤ï¸"?P(f):P(d,!1)})}var A=s(C,2);{var D=P=>{var _=Sa(),h=o(_,!0);r(_),W(()=>J(h,e(g).count)),a(P,_)};z(A,P=>{v()&&e(g).count>0&&P(D)})}r(m),W(P=>{Se(m,1,P,"svelte-1sd6u65"),qe(m,"aria-label",`React with ${i()} (${e(g).count})`)},[()=>st(bt("inline-flex items-center gap-2 bg-transparent border-none cursor-pointer transition-colors",e(g).hasReacted&&"text-red-500",p()))]),a(re,m),Ne()}Ke(["click"]);var Ea=x('<div class="absolute bottom-full mb-2 right-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),Aa=x('<div class="flex flex-col items-center gap-6 text-white"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <div class="relative"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <!></div> <button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div><!></div> <span class="text-xs font-semibold"> </span></button> <!></div>'),Ta=x('<div class="absolute bottom-full mb-2 left-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><!> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><!> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),ja=x('<div><button type="button" class="flex items-center gap-2 hover:text-primary transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <div class="relative"><button type="button" class="flex items-center gap-2 hover:text-green-400 transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <!></div> <!> <!></div>'),Ua=x("<!> <!> <!>",1);function Na(re,t){Ue(t,!0);const i=be(t,"variant",3,"default");let v=ve(!1),p=ve(!1),u=ve(!1);const b=ce.$subscribe(()=>({filters:[{kinds:[1,1111,6,16],...t.event.filter()}],subId:"interactions"})),k=U(()=>Array.from(b.events??[]).filter(h=>h.kind===1||h.kind===1111).length),g=U(()=>Array.from(b.events??[]).filter(h=>h.kind===6||h.kind===16).length),M=U(()=>i()!=="tiktok"?null:Et(()=>({event:t.event}),ce)),m=U(()=>e(M)?e(M).get("â¤ï¸")??{count:0,hasReacted:!1,pubkeys:[],emoji:"â¤ï¸"}:{count:0,hasReacted:!1});async function C(){if(!ce.signer){Re.error("Please login to repost");return}try{await t.event.repost(),Re.success("Note reposted")}catch(h){console.error("Failed to repost:",h),Re.error("Failed to repost")}}var f=Ua(),d=q(f);{var A=h=>{var H=Aa(),$=o(H);$.__click=V=>{V.stopPropagation(),l(v,!0)};var R=o($),N=o(R);je(N,{name:"message",size:"lg"}),r(R);var ee=s(R,2),E=o(ee,!0);r(ee),r($);var L=s($,2),w=o(L);w.__click=V=>{V.stopPropagation(),l(u,!e(u))};var S=o(w),O=o(S);je(O,{name:"repost",size:"lg"}),r(S);var ae=s(S,2),G=o(ae,!0);r(ae),r(w);var T=s(w,2);{var j=V=>{var Q=Ea();Q.__click=xe=>xe.stopPropagation();var le=o(Q);le.__click=xe=>{xe.stopPropagation(),l(u,!1),C()};var _e=s(le,2);_e.__click=xe=>{xe.stopPropagation(),l(u,!1),l(p,!0)},r(Q),Ye(Q,(xe,F)=>tt?.(xe,F),()=>()=>l(u,!1)),a(V,Q)};z(T,V=>{e(u)&&V(j)})}r(L);var oe=s(L,2);oe.__click=V=>{V.stopPropagation(),e(M)&&e(M).react("â¤ï¸").catch(Q=>{console.error("Failed to react:",Q),Re.error("Failed to add reaction")})};var ne=o(oe),I=o(ne);{let V=U(()=>e(m).hasReacted?"animate-[heartbeat_0.3s_ease-in-out]":"");je(I,{name:"heart-filled",size:"lg",get class(){return e(V)}})}r(ne);var X=s(ne,2),ie=o(X,!0);r(X),r(oe);var fe=s(oe,2);ht(fe,{get event(){return t.event},variant:"tiktok"}),r(H),W(()=>{J(E,e(k)),J(G,e(g)),Se(ne,1,`w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-red-400 transition-colors ${e(m).hasReacted?"bg-red-400/30":""}`),J(ie,e(m).count)}),a(h,H)},D=h=>{var H=ja(),$=o(H);$.__click=oe=>{oe.stopPropagation(),l(v,!0)};var R=o($);je(R,{name:"message",size:"md"});var N=s(R,2),ee=o(N,!0);r(N),r($);var E=s($,2),L=o(E);L.__click=oe=>{oe.stopPropagation(),l(u,!e(u))};var w=o(L);je(w,{name:"repost",size:"md"});var S=s(w,2),O=o(S,!0);r(S),r(L);var ae=s(L,2);{var G=oe=>{var ne=Ta();ne.__click=V=>V.stopPropagation();var I=o(ne);I.__click=V=>{V.stopPropagation(),l(u,!1),C()};var X=o(I);je(X,{name:"repost",size:"md"}),Ce(2),r(I);var ie=s(I,2);ie.__click=V=>{V.stopPropagation(),l(u,!1),l(p,!0)};var fe=o(ie);je(fe,{name:"message",size:"md"}),Ce(2),r(ie),r(ne),Ye(ne,(V,Q)=>tt?.(V,Q),()=>()=>l(u,!1)),a(oe,ne)};z(ae,oe=>{e(u)&&oe(G)})}r(E);var T=s(E,2);za(T,{get event(){return t.event},emoji:"â¤ï¸",class:"hover:text-red-400 transition-colors group [&>span]:text-sm [&>span]:group-hover:underline"});var j=s(T,2);ht(j,{get event(){return t.event}}),r(H),W(()=>{Se(H,1,`flex items-center gap-3 sm:gap-6 ${i()==="thread-main"?"border-t border-border pt-3":""} text-muted-foreground`),J(ee,e(k)),J(O,e(g))}),a(h,H)};z(d,h=>{i()==="tiktok"?h(A):h(D,!1)})}var P=s(d,2);mt(P,{get replyTo(){return t.event},get open(){return e(v)},set open(h){l(v,h,!0)}});var _=s(P,2);mt(_,{get quotedEvent(){return t.event},get open(){return e(p)},set open(h){l(p,h,!0)}}),a(re,f),Ne()}Ke(["click"]);var Ia=x('<!> <div><!></div> <!> <div class="mb-2"><!></div> <!>',1);function xt(re,t){const i=be(t,"showActions",3,!0),v=be(t,"variant",3,"default"),p=be(t,"showThreadLine",3,!1),u=U(()=>v()==="thread-main"?"lg":v()==="thread-reply"?"md":"sm"),b=U(()=>v()==="thread-main"?"text-lg leading-relaxed":"text-base"),k=U(()=>v()==="thread-main"?"bg-card/50":(v()==="default","hover:bg-card/30")),g=U(()=>v()==="default"||t.onNavigate!==void 0),M=U(()=>v()==="thread-main"?"full":"compact"),m=U(()=>v()==="thread-main"?"mb-2":"mb-1.5");var C=ge(),f=q(C);ke(f,()=>et.Root,(d,A)=>{A(d,{get ndk(){return ce},get event(){return t.event},get interactive(){return e(g)},get onclick(){return t.onNavigate},get class(){return`p-3 sm:p-4 flex flex-col max-sm:max-w-screen ${e(k)??""} transition-colors min-w-0`},children:(D,P)=>{var _=Ia(),h=q(_);{var H=O=>{var ae=ge(),G=q(ae);ke(G,()=>et.ThreadLine,(T,j)=>{j(T,{forceShow:!0})}),a(O,ae)};z(h,O=>{p()&&O(H)})}var $=s(h,2),R=o($);ke(R,()=>et.Header,(O,ae)=>{ae(O,{get variant(){return e(M)},get avatarSize(){return e(u)}})}),r($);var N=s($,2);{var ee=O=>{er(O,{get ndk(){return ce},get event(){return t.event},class:"mb-2"})};z(N,O=>{v()==="default"&&O(ee)})}var E=s(N,2),L=o(E);ke(L,()=>et.Content,(O,ae)=>{ae(O,{get class(){return e(b)}})}),r(E);var w=s(E,2);{var S=O=>{Na(O,{get event(){return t.event},get variant(){return v()}})};z(w,O=>{i()&&O(S)})}W(()=>Se($,1,st(e(m)))),a(D,_)},$$slots:{default:!0}})}),a(re,C)}export{mt as C,Na as E,xt as N,yr as U,gt as a,jr as u};
