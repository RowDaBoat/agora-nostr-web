import{d as Ie,c as ue,a as i,f as q,s as d,j as L}from"./CiPFrJr-.js";import{p as Re,a as je,g as e,u as O,s as pe,b as Ce,f as Y,c as Ee,e as t,r,d as a,t as Z}from"./CSbKtK4P.js";import{p as Se,i as p}from"./87vUJtvC.js";import{n as ge,j as De,f as we,d as fe}from"./D0X4VYcq.js";import{T as ye}from"./ChQzK9Kk.js";import{E as ze}from"./Cybom7lU.js";import{g as Fe}from"./BgxlgyeA.js";const xe=new Map;async function Oe(c){if(xe.has(c))return xe.get(c)??null;try{const o=`https://api.allorigins.win/get?url=${encodeURIComponent(c)}`,D=await fetch(o);if(!D.ok)return xe.set(c,null),null;const K=(await D.json()).contents,y=qe(K);return xe.set(c,y),y}catch(o){return console.error("Failed to fetch URL metadata:",o),xe.set(c,null),null}}function qe(c){const o={},D=c.match(/<meta\s+property=["']og:title["']\s+content=["']([^"']+)["']/i),$=c.match(/<meta\s+property=["']og:description["']\s+content=["']([^"']+)["']/i),K=c.match(/<meta\s+property=["']og:image["']\s+content=["']([^"']+)["']/i),y=c.match(/<meta\s+property=["']og:site_name["']\s+content=["']([^"']+)["']/i),V=c.match(/<title[^>]*>([^<]+)<\/title>/i);return o.title=D?.[1]||V?.[1],o.description=$?.[1],o.image=K?.[1],o.siteName=y?.[1],o}var Ke=(c,o)=>{c.stopPropagation(),o()},Ge=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>'),Je=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>'),Qe=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>'),We=q('<div class="absolute bottom-3 right-3 flex items-center gap-2 px-3 py-1.5 bg-background/80 backdrop-blur-sm border border-border rounded text-xs text-muted-foreground"><!> <span class="max-w-[200px] truncate"> </span></div>'),Xe=q('<article class="p-3 sm:p-4 hover:bg-card/30 transition-colors border-b border-border"><div class="flex items-center gap-2 sm:gap-3 mb-3"><button type="button" class="flex-shrink-0"><!></button> <div class="flex items-center gap-2 flex-1 min-w-0"><div class="flex items-center gap-2 min-w-0 flex-shrink"><span class="text-base font-semibold text-foreground truncate min-w-0"> </span> <span class="text-muted-foreground text-sm truncate min-w-0"> </span></div> <span class="text-muted-foreground text-sm flex-shrink-0">路</span> <!></div></div> <div><div class="relative flex flex-col items-center justify-center py-12 sm:py-16 px-8 sm:px-12 min-h-[200px] max-h-[600px]"><div class="relative z-10"><p> <mark class="bg-primary/20 text-card-foreground font-medium"> </mark> </p></div></div> <!></div> <!></article>'),Ye=q("<span>路</span> <!>",1),Ze=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>'),$e=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>'),et=q('<span>路</span> <span class="flex items-center gap-1"><!> </span>',1),tt=q('<div class="block p-4 hover:bg-card/30 transition-colors rounded-lg group"><div class="relative"><div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-primary/60 to-primary rounded-full"></div> <div class="pl-4"><div class="mb-3 relative"><p class="relative text-foreground text-base leading-relaxed font-serif italic"> <mark class="bg-primary/20 text-foreground font-medium not-italic"> </mark> </p></div> <div class="flex items-center gap-2 text-xs text-muted-foreground"><span> </span> <!> <!></div></div></div></div>'),rt=L('<svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>'),at=L('<svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>'),ot=L('<svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>'),nt=q('<div class="absolute bottom-2 right-2 flex items-center gap-1.5 px-2 py-1 bg-background/80 backdrop-blur-sm border border-border rounded text-xs text-muted-foreground"><!> <span class="max-w-[100px] truncate text-[10px]"> </span></div>'),st=q('<article class="hover:bg-card/30 transition-colors w-full"><div><div class="relative flex flex-col items-center justify-center p-4 sm:p-6 min-h-[150px]"><div class="relative z-10"><p> <mark class="bg-primary/20 text-card-foreground font-medium"> </mark> </p></div></div> <div class="absolute bottom-2 left-2"><svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M18.5 1.15a2.25 2.25 0 00-3.18 0L3.78 12.69a2.25 2.25 0 000 3.18l4.35 4.35a2.25 2.25 0 003.18 0L22.85 8.68a2.25 2.25 0 000-3.18l-4.35-4.35zM9.93 18.84L5.16 14.07 15.3 3.93l4.77 4.77-10.14 10.14z"></path><path d="M2.5 22.5h10v1.5h-10z" opacity="0.5"></path></svg></div> <!></div> <div class="flex items-center gap-2 mt-2 px-1"><!> <span class="text-xs text-muted-foreground truncate"> </span></div></article>'),it=(c,o)=>{c.stopPropagation(),o()},lt=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>'),vt=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>'),dt=L('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>'),ct=q('<div class="absolute bottom-3 right-3 flex items-center gap-2 px-3 py-1.5 bg-background/80 backdrop-blur-sm border border-border rounded text-xs text-muted-foreground"><!> <span class="max-w-[200px] truncate"> </span></div>'),ut=q('<article class="p-3 sm:p-4 hover:bg-card/30 transition-colors border-b border-border"><div class="flex items-center gap-2 sm:gap-3 mb-3"><button type="button" class="flex-shrink-0"><!></button> <div class="flex items-center gap-2 flex-1 min-w-0"><div class="flex items-center gap-2 min-w-0 flex-shrink"><span class="text-base font-semibold text-foreground truncate min-w-0"> </span> <span class="text-muted-foreground text-sm truncate min-w-0"> </span></div> <span class="text-muted-foreground text-sm flex-shrink-0">路</span> <!></div></div> <div><div class="relative flex flex-col items-center justify-center py-12 sm:py-16 px-8 sm:px-12 min-h-[200px] max-h-[600px]"><div class="relative z-10"><p> <mark class="bg-primary/20 text-card-foreground font-medium"> </mark> </p></div></div> <!></div> <!></article>');function bt(c,o){Re(o,!0);let D=Se(o,"variant",3,"default");const $=ge.$fetchProfile(()=>o.event.pubkey),K=O(()=>$?.name||$?.displayName||"Anonymous"),y=O(()=>o.event.content),V=O(()=>{const s=o.event.tags.find(f=>f[0]==="a"),l=o.event.tags.find(f=>f[0]==="e"),k=o.event.tags.find(f=>f[0]==="r");return s||l||k}),Ve=O(()=>o.event.tags.find(s=>s[0]==="context")),ne=O(()=>e(Ve)?.[1]||e(y)),T=O(()=>{if(!e(ne)||e(ne)===e(y))return{before:"",highlight:e(y),after:""};const s=e(ne).indexOf(e(y));return s===-1?{before:"",highlight:e(y),after:""}:{before:e(ne).slice(0,s),highlight:e(y),after:e(ne).slice(s+e(y).length)}}),_e=O(()=>{const s=e(ne).length;return D()==="grid"?s<100?"text-base":s<200?"text-sm":"text-xs":s<100?"text-2xl sm:text-3xl md:text-4xl":s<200?"text-xl sm:text-2xl md:text-3xl":s<350?"text-lg sm:text-xl md:text-2xl":s<500?"text-base sm:text-lg md:text-xl":"text-sm sm:text-base md:text-lg"});let se=Ce(void 0),me=Ce(null);je(()=>{if(!e(V)||e(V)[0]!=="a"){pe(se,void 0);return}const l=e(V)[1].split(":");if(l.length!==3){pe(se,void 0);return}const[k,f,ee]=l;ge.guardrailOff("fetch-events-usage").fetchEvent({kinds:[parseInt(k)],authors:[f],"#d":[ee]}).then(M=>{M&&pe(se,De.from(M),!0)})}),je(()=>{if(!e(V)||e(V)[0]!=="r"){pe(me,null);return}const s=e(V)[1];Oe(s).then(l=>{pe(me,l,!0)}).catch(l=>{console.error("Failed to fetch URL metadata:",l),pe(me,null)})});const n=O(()=>{if(!e(V))return null;const s=e(V)[0],l=e(V)[1];if(s==="r"){const k=e(me)?.title||e(me)?.siteName;if(k)return{type:"web",displayText:k,url:l};try{return{type:"web",displayText:new URL(l).hostname.replace("www.",""),url:l}}catch{return{type:"web",displayText:l,url:l}}}else{if(s==="a")return{type:"article",displayText:e(se)?.tags.find(ee=>ee[0]==="title")?.[1]||"Article",value:l};if(s==="e")return{type:"event",displayText:"Note",value:l}}return null}),ie=O(()=>o.event.created_at);function Te(){window.location.href=`/p/${o.event.author.npub}`}function be(){if(e(n)?.type==="web"&&e(n).url)window.open(e(n).url,"_blank","noopener,noreferrer");else if(e(n)?.type==="article"&&e(se)){const s=Fe(e(se));window.location.href=s}}var Me=ue(),Be=Y(Me);{var Ae=s=>{var l=Xe(),k=t(l),f=t(k);f.__click=[Ke,Te];var ee=t(f);we(ee,{get ndk(){return ge},get pubkey(){return o.event.pubkey},class:"w-9 h-9 sm:w-12 sm:h-12 rounded-full hover:opacity-80 transition-opacity"}),r(f);var M=a(f,2),N=t(M),G=t(N),le=t(G,!0);r(G);var J=a(G,2),B=t(J);r(J),r(N);var j=a(N,4);{var x=v=>{ye(v,{get timestamp(){return e(ie)},class:"text-muted-foreground text-sm flex-shrink-0"})};p(j,v=>{e(ie)&&v(x)})}r(M),r(k);var m=a(k,2);m.__click=function(...v){(e(n)?.type==="web"||e(n)?.type==="article"?be:void 0)?.apply(this,v)};var P=t(m),C=t(P),h=t(C),z=t(h,!0),I=a(z),Q=t(I,!0);r(I);var te=a(I,1,!0);r(h),r(C),r(P);var re=a(P,2);{var _=v=>{var A=We(),b=t(A);{var R=H=>{var W=Ge();i(H,W)},E=H=>{var W=ue(),S=Y(W);{var u=U=>{var oe=Je();i(U,oe)},ae=U=>{var oe=Qe();i(U,oe)};p(S,U=>{e(n).type==="article"?U(u):U(ae,!1)},!0)}i(H,W)};p(b,H=>{e(n).type==="web"?H(R):H(E,!1)})}var w=a(b,2),F=t(w,!0);r(w),r(A),Z(()=>d(F,e(n).displayText)),i(v,A)};p(re,v=>{e(n)&&v(_)})}r(m);var g=a(m,2);ze(g,{get event(){return o.event}}),r(l),Z(v=>{d(le,e(K)),d(B,`@${v??""}`),fe(m,1,`relative rounded-lg overflow-hidden bg-card border border-border shadow-lg mb-2 ${e(n)?.type==="web"||e(n)?.type==="article"?"cursor-pointer":""}`),fe(h,1,`text-card-foreground ${e(_e)??""} font-serif leading-relaxed text-center`),d(z,e(T).before),d(Q,e(T).highlight),d(te,e(T).after)},[()=>$?.name||o.event.pubkey.slice(0,8)]),i(s,l)},He=s=>{var l=ue(),k=Y(l);{var f=M=>{var N=tt(),G=t(N),le=a(t(G),2),J=t(le),B=t(J),j=t(B),x=a(j),m=t(x,!0);r(x);var P=a(x);r(B),r(J);var C=a(J,2),h=t(C),z=t(h,!0);r(h);var I=a(h,2);{var Q=_=>{var g=Ye(),v=a(Y(g),2);ye(v,{get timestamp(){return e(ie)}}),i(_,g)};p(I,_=>{e(ie)&&_(Q)})}var te=a(I,2);{var re=_=>{var g=et(),v=a(Y(g),2),A=t(v);{var b=w=>{var F=Ze();i(w,F)},R=w=>{var F=$e();i(w,F)};p(A,w=>{e(n).type==="web"?w(b):w(R,!1)})}var E=a(A);r(v),Z(()=>d(E,` ${e(n).displayText??""}`)),i(_,g)};p(te,_=>{e(n)&&_(re)})}r(C),r(le),r(G),r(N),Z(()=>{d(j,`"${e(T).before??""}`),d(m,e(T).highlight),d(P,`${e(T).after??""}"`),d(z,e(K))}),i(M,N)},ee=M=>{var N=ue(),G=Y(N);{var le=B=>{var j=st(),x=t(j);x.__click=function(...b){(e(n)?.type==="web"||e(n)?.type==="article"?be:void 0)?.apply(this,b)};var m=t(x),P=t(m),C=t(P),h=t(C,!0),z=a(h),I=t(z,!0);r(z);var Q=a(z,1,!0);r(C),r(P),r(m);var te=a(m,4);{var re=b=>{var R=nt(),E=t(R);{var w=S=>{var u=rt();i(S,u)},F=S=>{var u=ue(),ae=Y(u);{var U=X=>{var ve=at();i(X,ve)},oe=X=>{var ve=ot();i(X,ve)};p(ae,X=>{e(n).type==="article"?X(U):X(oe,!1)},!0)}i(S,u)};p(E,S=>{e(n).type==="web"?S(w):S(F,!1)})}var H=a(E,2),W=t(H,!0);r(H),r(R),Z(()=>d(W,e(n).displayText)),i(b,R)};p(te,b=>{e(n)&&b(re)})}r(x);var _=a(x,2),g=t(_);we(g,{get ndk(){return ge},get pubkey(){return o.event.pubkey},class:"w-5 h-5 rounded-full"});var v=a(g,2),A=t(v,!0);r(v),r(_),r(j),Z(()=>{fe(x,1,`relative aspect-square rounded-lg overflow-hidden bg-card border border-border shadow-lg w-full ${e(n)?.type==="web"||e(n)?.type==="article"?"cursor-pointer":""}`),fe(C,1,`text-card-foreground ${e(_e)??""} font-serif leading-relaxed text-center line-clamp-6`),d(h,e(T).before),d(I,e(T).highlight),d(Q,e(T).after),d(A,e(K))}),i(B,j)},J=B=>{var j=ut(),x=t(j),m=t(x);m.__click=[it,Te];var P=t(m);we(P,{get ndk(){return ge},get pubkey(){return o.event.pubkey},class:"w-9 h-9 sm:w-12 sm:h-12 rounded-full hover:opacity-80 transition-opacity"}),r(m);var C=a(m,2),h=t(C),z=t(h),I=t(z,!0);r(z);var Q=a(z,2),te=t(Q);r(Q),r(h);var re=a(h,4);{var _=u=>{ye(u,{get timestamp(){return e(ie)},class:"text-muted-foreground text-sm flex-shrink-0"})};p(re,u=>{e(ie)&&u(_)})}r(C),r(x);var g=a(x,2);g.__click=function(...u){(e(n)?.type==="web"||e(n)?.type==="article"?be:void 0)?.apply(this,u)};var v=t(g),A=t(v),b=t(A),R=t(b,!0),E=a(R),w=t(E,!0);r(E);var F=a(E,1,!0);r(b),r(A),r(v);var H=a(v,2);{var W=u=>{var ae=ct(),U=t(ae);{var oe=de=>{var he=lt();i(de,he)},X=de=>{var he=ue(),Le=Y(he);{var Ne=ce=>{var ke=vt();i(ce,ke)},Pe=ce=>{var ke=dt();i(ce,ke)};p(Le,ce=>{e(n).type==="article"?ce(Ne):ce(Pe,!1)},!0)}i(de,he)};p(U,de=>{e(n).type==="web"?de(oe):de(X,!1)})}var ve=a(U,2),Ue=t(ve,!0);r(ve),r(ae),Z(()=>d(Ue,e(n).displayText)),i(u,ae)};p(H,u=>{e(n)&&u(W)})}r(g);var S=a(g,2);ze(S,{get event(){return o.event}}),r(j),Z(u=>{d(I,e(K)),d(te,`@${u??""}`),fe(g,1,`relative rounded-lg overflow-hidden bg-card border border-border shadow-lg mb-2 ${e(n)?.type==="web"||e(n)?.type==="article"?"cursor-pointer":""}`),fe(b,1,`text-card-foreground ${e(_e)??""} font-serif leading-relaxed text-center`),d(R,e(T).before),d(w,e(T).highlight),d(F,e(T).after)},[()=>$?.name||o.event.pubkey.slice(0,8)]),i(B,j)};p(G,B=>{D()==="grid"?B(le):B(J,!1)},!0)}i(M,N)};p(k,M=>{D()==="compact"?M(f):M(ee,!1)},!0)}i(s,l)};p(Be,s=>{D()==="feed"?s(Ae):s(He,!1)})}i(c,Me),Ee()}Ie(["click"]);export{bt as H};
