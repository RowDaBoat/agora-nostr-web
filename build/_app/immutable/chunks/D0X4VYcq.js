const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BQhZuWdo.js","./CSbKtK4P.js"])))=>i.map(i=>d[i]);
import{V as create_text,P as block$1,o as set_hydrate_node,h as hydrating,q as get_first_child,i as hydrate_next,g as get,ar as derived_safe_equal,ai as read_hydration_instruction,aj as HYDRATION_START_ELSE,ak as skip_nodes,W as set_hydrating,l as hydrate_node,C as COMMENT_NODE,a7 as HYDRATION_END,af as branch,ah as should_defer_append,M as current_batch,aD as internal_set,D as DEV,a5 as mutable_source,aA as source,b0 as array_from,aS as is_array,ba as EACH_ITEM_REACTIVE,bb as EACH_INDEX_REACTIVE,ac as resume_effect,ae as pause_effect,bc as EACH_ITEM_IMMUTABLE,bd as INERT,ad as destroy_effect,m as get_next_sibling,be as pause_children,aZ as clear_text_content,bf as run_out_transitions,j as active_effect,J as queue_micro_task,bg as EACH_IS_CONTROLLED,bh as EACH_IS_ANIMATED,E as effect,K as listen_to_event_and_reset_event,O as previous_batch,X as teardown,bi as select_multiple_invalid_value,bj as is,bk as LOADING_ATTR_SYMBOL,bl as NAMESPACE_HTML,bm as get_prototype_of,bn as get_descriptors,bo as hydration_attribute_changed,bp as flatten,b7 as ATTACHMENT_KEY,a1 as autofocus,bq as UNINITIALIZED,br as add_form_reset_listener,_ as __vitePreload,p as push,f as first_child,c as pop,u as user_derived,t as template_effect,e as child,r as reset$1,d as sibling,a as user_effect,s as set,b as state,x as proxy}from"./CSbKtK4P.js";import{v as is_capture_event,w as create_event,d as delegate,x as normalize_attribute,y as is_delegated,c as comment$1,a as append,f as from_html,s as set_text}from"./CiPFrJr-.js";import{e as to_class,t as to_style,c as clsx,p as prop,i as if_block,b as component,d as browser$3}from"./87vUJtvC.js";function index$1(r,t){return t}function pause_effects(r,t,n){for(var s=r.items,o=[],a=t.length,c=0;c<a;c++)pause_children(t[c].e,o,!0);var f=a>0&&o.length===0&&n!==null;if(f){var g=n.parentNode;clear_text_content(g),g.append(n),s.clear(),link$1(r,t[0].prev,t[a-1].next)}run_out_transitions(o,()=>{for(var b=0;b<a;b++){var _=t[b];f||(s.delete(_.k),link$1(r,_.prev,_.next)),destroy_effect(_.e,!f)}})}function each(r,t,n,s,o,a=null){var c=r,f={flags:t,items:new Map,first:null},g=(t&EACH_IS_CONTROLLED)!==0;if(g){var b=r;c=hydrating?set_hydrate_node(get_first_child(b)):b.appendChild(create_text())}hydrating&&hydrate_next();var _=null,L=!1,q=new Map,X=derived_safe_equal(()=>{var Le=n();return is_array(Le)?Le:Le==null?[]:array_from(Le)}),te,ne;function Ce(){reconcile(ne,te,f,q,c,o,t,s,n),a!==null&&(te.length===0?_?resume_effect(_):_=branch(()=>a(c)):_!==null&&pause_effect(_,()=>{_=null}))}block$1(()=>{ne??=active_effect,te=get(X);var Le=te.length;if(L&&Le===0)return;L=Le===0;let Ge=!1;if(hydrating){var ze=read_hydration_instruction(c)===HYDRATION_START_ELSE;ze!==(Le===0)&&(c=skip_nodes(),set_hydrate_node(c),set_hydrating(!1),Ge=!0)}if(hydrating){for(var Xe=null,He,Ve=0;Ve<Le;Ve++){if(hydrate_node.nodeType===COMMENT_NODE&&hydrate_node.data===HYDRATION_END){c=hydrate_node,Ge=!0,set_hydrating(!1);break}var We=te[Ve],rt=s(We,Ve);He=create_item(hydrate_node,f,Xe,null,We,rt,Ve,o,t,n),f.items.set(rt,He),Xe=He}Le>0&&set_hydrate_node(skip_nodes())}if(hydrating)Le===0&&a&&(_=branch(()=>a(c)));else if(should_defer_append()){var st=new Set,ht=current_batch;for(Ve=0;Ve<Le;Ve+=1){We=te[Ve],rt=s(We,Ve);var je=f.items.get(rt)??q.get(rt);je?(t&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0&&update_item(je,We,Ve,t):(He=create_item(null,f,null,null,We,rt,Ve,o,t,n,!0),q.set(rt,He)),st.add(rt)}for(const[se,m]of f.items)st.has(se)||ht.skipped_effects.add(m.e);ht.add_callback(Ce)}else Ce();Ge&&set_hydrating(!0),get(X)}),hydrating&&(c=hydrate_node)}function reconcile(r,t,n,s,o,a,c,f,g){var b=(c&EACH_IS_ANIMATED)!==0,_=(c&(EACH_ITEM_REACTIVE|EACH_INDEX_REACTIVE))!==0,L=t.length,q=n.items,X=n.first,te=X,ne,Ce=null,Le,Ge=[],ze=[],Xe,He,Ve,We;if(b)for(We=0;We<L;We+=1)Xe=t[We],He=f(Xe,We),Ve=q.get(He),Ve!==void 0&&(Ve.a?.measure(),(Le??=new Set).add(Ve));for(We=0;We<L;We+=1){if(Xe=t[We],He=f(Xe,We),Ve=q.get(He),Ve===void 0){var rt=s.get(He);if(rt!==void 0){s.delete(He),q.set(He,rt);var st=Ce?Ce.next:te;link$1(n,Ce,rt),link$1(n,rt,st),move(rt,st,o),Ce=rt}else{var ht=te?te.e.nodes_start:o;Ce=create_item(ht,n,Ce,Ce===null?n.first:Ce.next,Xe,He,We,a,c,g)}q.set(He,Ce),Ge=[],ze=[],te=Ce.next;continue}if(_&&update_item(Ve,Xe,We,c),(Ve.e.f&INERT)!==0&&(resume_effect(Ve.e),b&&(Ve.a?.unfix(),(Le??=new Set).delete(Ve))),Ve!==te){if(ne!==void 0&&ne.has(Ve)){if(Ge.length<ze.length){var je=ze[0],se;Ce=je.prev;var m=Ge[0],A=Ge[Ge.length-1];for(se=0;se<Ge.length;se+=1)move(Ge[se],je,o);for(se=0;se<ze.length;se+=1)ne.delete(ze[se]);link$1(n,m.prev,A.next),link$1(n,Ce,m),link$1(n,A,je),te=je,Ce=A,We-=1,Ge=[],ze=[]}else ne.delete(Ve),move(Ve,te,o),link$1(n,Ve.prev,Ve.next),link$1(n,Ve,Ce===null?n.first:Ce.next),link$1(n,Ce,Ve),Ce=Ve;continue}for(Ge=[],ze=[];te!==null&&te.k!==He;)(te.e.f&INERT)===0&&(ne??=new Set).add(te),ze.push(te),te=te.next;if(te===null)continue;Ve=te}Ge.push(Ve),Ce=Ve,te=Ve.next}if(te!==null||ne!==void 0){for(var k=ne===void 0?[]:array_from(ne);te!==null;)(te.e.f&INERT)===0&&k.push(te),te=te.next;var Y=k.length;if(Y>0){var Q=(c&EACH_IS_CONTROLLED)!==0&&L===0?o:null;if(b){for(We=0;We<Y;We+=1)k[We].a?.measure();for(We=0;We<Y;We+=1)k[We].a?.fix()}pause_effects(n,k,Q)}}b&&queue_micro_task(()=>{if(Le!==void 0)for(Ve of Le)Ve.a?.apply()}),r.first=n.first&&n.first.e,r.last=Ce&&Ce.e;for(var $e of s.values())destroy_effect($e.e);s.clear()}function update_item(r,t,n,s){(s&EACH_ITEM_REACTIVE)!==0&&internal_set(r.v,t),(s&EACH_INDEX_REACTIVE)!==0?internal_set(r.i,n):r.i=n}function create_item(r,t,n,s,o,a,c,f,g,b,_){var L=(g&EACH_ITEM_REACTIVE)!==0,q=(g&EACH_ITEM_IMMUTABLE)===0,X=L?q?mutable_source(o,!1,!1):source(o):o,te=(g&EACH_INDEX_REACTIVE)===0?c:source(c);DEV&&L&&(X.trace=()=>{var Le=typeof te=="number"?c:te.v;b()[Le]});var ne={i:te,v:X,k:a,a:null,e:null,prev:n,next:s};try{if(r===null){var Ce=document.createDocumentFragment();Ce.append(r=create_text())}return ne.e=branch(()=>f(r,X,te,b),hydrating),ne.e.prev=n&&n.e,ne.e.next=s&&s.e,n===null?_||(t.first=ne):(n.next=ne,n.e.next=ne.e),s!==null&&(s.prev=ne,s.e.prev=ne.e),ne}finally{}}function move(r,t,n){for(var s=r.next?r.next.e.nodes_start:n,o=t?t.e.nodes_start:n,a=r.e.nodes_start;a!==null&&a!==s;){var c=get_next_sibling(a);o.before(a),a=c}}function link$1(r,t,n){t===null?r.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function attach(r,t){var n=void 0,s;block$1(()=>{n!==(n=t())&&(s&&(destroy_effect(s),s=null),n&&(s=branch(()=>{effect(()=>n(r))})))})}function set_class(r,t,n,s,o,a){var c=r.__className;if(hydrating||c!==n||c===void 0){var f=to_class(n,s,a);(!hydrating||f!==r.getAttribute("class"))&&(f==null?r.removeAttribute("class"):t?r.className=f:r.setAttribute("class",f)),r.__className=n}else if(a&&o!==a)for(var g in a){var b=!!a[g];(o==null||b!==!!o[g])&&r.classList.toggle(g,b)}return a}function update_styles(r,t={},n,s){for(var o in n){var a=n[o];t[o]!==a&&(n[o]==null?r.style.removeProperty(o):r.style.setProperty(o,a,s))}}function set_style(r,t,n,s){var o=r.__style;if(hydrating||o!==t){var a=to_style(t,s);(!hydrating||a!==r.getAttribute("style"))&&(a==null?r.removeAttribute("style"):r.style.cssText=a),r.__style=t}else s&&(Array.isArray(s)?(update_styles(r,n?.[0],s[0]),update_styles(r,n?.[1],s[1],"important")):update_styles(r,n,s));return s}function select_option(r,t,n=!1){if(r.multiple){if(t==null)return;if(!is_array(t))return select_multiple_invalid_value();for(var s of r.options)s.selected=t.includes(get_option_value(s));return}for(s of r.options){var o=get_option_value(s);if(is(o,t)){s.selected=!0;return}}(!n||t!==void 0)&&(r.selectedIndex=-1)}function init_select(r){var t=new MutationObserver(()=>{select_option(r,r.__value)});t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),teardown(()=>{t.disconnect()})}function bind_select_value(r,t,n=t){var s=new WeakSet,o=!0;listen_to_event_and_reset_event(r,"change",a=>{var c=a?"[selected]":":checked",f;if(r.multiple)f=[].map.call(r.querySelectorAll(c),get_option_value);else{var g=r.querySelector(c)??r.querySelector("option:not([disabled])");f=g&&get_option_value(g)}n(f),current_batch!==null&&s.add(current_batch)}),effect(()=>{var a=t();if(r===document.activeElement){var c=previous_batch??current_batch;if(s.has(c))return}if(select_option(r,a,o),o&&a===void 0){var f=r.querySelector(":checked");f!==null&&(a=get_option_value(f),n(a))}r.__value=a,o=!1}),init_select(r)}function get_option_value(r){return"__value"in r?r.__value:r.value}const CLASS=Symbol("class"),STYLE=Symbol("style"),IS_CUSTOM_ELEMENT=Symbol("is custom element"),IS_HTML=Symbol("is html");function remove_input_defaults(r){if(hydrating){var t=!1,n=()=>{if(!t){if(t=!0,r.hasAttribute("value")){var s=r.value;set_attribute(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var o=r.checked;set_attribute(r,"checked",null),r.checked=o}}};r.__on_r=n,queue_micro_task(n),add_form_reset_listener()}}function set_value(r,t){var n=get_attributes(r);n.value===(n.value=t??void 0)||r.value===t&&(t!==0||r.nodeName!=="PROGRESS")||(r.value=t??"")}function set_checked(r,t){var n=get_attributes(r);n.checked!==(n.checked=t??void 0)&&(r.checked=t)}function set_selected(r,t){t?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function set_attribute(r,t,n,s){var o=get_attributes(r);if(hydrating&&(o[t]=r.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&r.nodeName==="LINK")){s||check_src_in_dev_hydration(r,t,n??"");return}o[t]!==(o[t]=n)&&(t==="loading"&&(r[LOADING_ATTR_SYMBOL]=n),n==null?r.removeAttribute(t):typeof n!="string"&&get_setters(r).includes(t)?r[t]=n:r.setAttribute(t,n))}function set_attributes(r,t,n,s,o=!1,a=!1){if(hydrating&&o&&r.tagName==="INPUT"){var c=r,f=c.type==="checkbox"?"defaultChecked":"defaultValue";f in n||remove_input_defaults(c)}var g=get_attributes(r),b=g[IS_CUSTOM_ELEMENT],_=!g[IS_HTML];let L=hydrating&&b;L&&set_hydrating(!1);var q=t||{},X=r.tagName==="OPTION";for(var te in t)te in n||(n[te]=null);n.class?n.class=clsx(n.class):n[CLASS]&&(n.class=null),n[STYLE]&&(n.style??=null);var ne=get_setters(r);for(const Ve in n){let We=n[Ve];if(X&&Ve==="value"&&We==null){r.value=r.__value="",q[Ve]=We;continue}if(Ve==="class"){var Ce=r.namespaceURI==="http://www.w3.org/1999/xhtml";set_class(r,Ce,We,s,t?.[CLASS],n[CLASS]),q[Ve]=We,q[CLASS]=n[CLASS];continue}if(Ve==="style"){set_style(r,We,t?.[STYLE],n[STYLE]),q[Ve]=We,q[STYLE]=n[STYLE];continue}var Le=q[Ve];if(!(We===Le&&!(We===void 0&&r.hasAttribute(Ve)))){q[Ve]=We;var Ge=Ve[0]+Ve[1];if(Ge!=="$$")if(Ge==="on"){const rt={},st="$$"+Ve;let ht=Ve.slice(2);var ze=is_delegated(ht);if(is_capture_event(ht)&&(ht=ht.slice(0,-7),rt.capture=!0),!ze&&Le){if(We!=null)continue;r.removeEventListener(ht,q[st],rt),q[st]=null}if(We!=null)if(ze)r[`__${ht}`]=We,delegate([ht]);else{let je=function(se){q[Ve].call(this,se)};q[st]=create_event(ht,r,je,rt)}else ze&&(r[`__${ht}`]=void 0)}else if(Ve==="style")set_attribute(r,Ve,We);else if(Ve==="autofocus")autofocus(r,!!We);else if(!b&&(Ve==="__value"||Ve==="value"&&We!=null))r.value=r.__value=We;else if(Ve==="selected"&&X)set_selected(r,We);else{var Xe=Ve;_||(Xe=normalize_attribute(Xe));var He=Xe==="defaultValue"||Xe==="defaultChecked";if(We==null&&!b&&!He)if(g[Ve]=null,Xe==="value"||Xe==="checked"){let rt=r;const st=t===void 0;if(Xe==="value"){let ht=rt.defaultValue;rt.removeAttribute(Xe),rt.defaultValue=ht,rt.value=rt.__value=st?ht:null}else{let ht=rt.defaultChecked;rt.removeAttribute(Xe),rt.defaultChecked=ht,rt.checked=st?ht:!1}}else r.removeAttribute(Ve);else He||ne.includes(Xe)&&(b||typeof We!="string")?(r[Xe]=We,Xe in g&&(g[Xe]=UNINITIALIZED)):typeof We!="function"&&set_attribute(r,Xe,We,a)}}}return L&&set_hydrating(!0),q}function attribute_effect(r,t,n=[],s=[],o,a=!1,c=!1){flatten(n,s,f=>{var g=void 0,b={},_=r.nodeName==="SELECT",L=!1;if(block$1(()=>{var X=t(...f.map(get)),te=set_attributes(r,g,X,o,a,c);L&&_&&"value"in X&&select_option(r,X.value);for(let Ce of Object.getOwnPropertySymbols(b))X[Ce]||destroy_effect(b[Ce]);for(let Ce of Object.getOwnPropertySymbols(X)){var ne=X[Ce];Ce.description===ATTACHMENT_KEY&&(!g||ne!==g[Ce])&&(b[Ce]&&destroy_effect(b[Ce]),b[Ce]=branch(()=>attach(r,()=>ne))),te[Ce]=ne}g=te}),_){var q=r;effect(()=>{select_option(q,g.value,!0),init_select(q)})}L=!0})}function get_attributes(r){return r.__attributes??={[IS_CUSTOM_ELEMENT]:r.nodeName.includes("-"),[IS_HTML]:r.namespaceURI===NAMESPACE_HTML}}var setters_cache=new Map;function get_setters(r){var t=r.getAttribute("is")||r.nodeName,n=setters_cache.get(t);if(n)return n;setters_cache.set(t,n=[]);for(var s,o=r,a=Element.prototype;a!==o;){s=get_descriptors(o);for(var c in s)s[c].set&&n.push(c);o=get_prototype_of(o)}return n}function check_src_in_dev_hydration(r,t,n){DEV&&(t==="srcset"&&srcset_url_equal(r,n)||src_url_equal(r.getAttribute(t)??"",n)||hydration_attribute_changed(t,r.outerHTML.replace(r.innerHTML,r.innerHTML&&"..."),String(n)))}function src_url_equal(r,t){return r===t?!0:new URL(r,document.baseURI).href===new URL(t,document.baseURI).href}function split_srcset(r){return r.split(",").map(t=>t.trim().split(" ").filter(Boolean))}function srcset_url_equal(r,t){var n=split_srcset(r.srcset),s=split_srcset(t);return s.length===n.length&&s.every(([o,a],c)=>a===n[c][1]&&(src_url_equal(n[c][0],o)||src_url_equal(o,n[c][0])))}var define_process_env_default={},__create=Object.create,__getProtoOf=Object.getPrototypeOf,__defProp$4=Object.defineProperty,__getOwnPropNames$2=Object.getOwnPropertyNames,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__hasOwnProp$2=Object.prototype.hasOwnProperty,__toESM=(r,t,n)=>{n=r!=null?__create(__getProtoOf(r)):{};const s=__defProp$4(n,"default",{value:r,enumerable:!0});for(let o of __getOwnPropNames$2(r))__hasOwnProp$2.call(s,o)||__defProp$4(s,o,{get:()=>r[o],enumerable:!0});return s},__moduleCache=new WeakMap,__toCommonJS=r=>{var t=__moduleCache.get(r),n;return t||(t=__defProp$4({},"__esModule",{value:!0}),(r&&typeof r=="object"||typeof r=="function")&&__getOwnPropNames$2(r).map(s=>!__hasOwnProp$2.call(t,s)&&__defProp$4(t,s,{get:()=>r[s],enumerable:!(n=__getOwnPropDesc$2(r,s))||n.enumerable})),__moduleCache.set(r,t),t)},__commonJS=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),__export$2=(r,t)=>{for(var n in t)__defProp$4(r,n,{get:t[n],enumerable:!0,configurable:!0,set:s=>t[n]=()=>s})},__esm=(r,t)=>()=>(r&&(t=r(r=0)),t),exports_path={};__export$2(exports_path,{sep:()=>sep,resolve:()=>resolve,relative:()=>relative,posix:()=>posix,parse:()=>parse$2,normalize:()=>normalize$5,join:()=>join$4,isAbsolute:()=>isAbsolute,format:()=>format$1,extname:()=>extname,dirname:()=>dirname,delimiter:()=>delimiter$1,default:()=>path_default,basename:()=>basename,_makeLong:()=>_makeLong});function assertPath(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function normalizeStringPosix(r,t){for(var n="",s=0,o=-1,a=0,c,f=0;f<=r.length;++f){if(f<r.length)c=r.charCodeAt(f);else{if(c===47)break;c=47}if(c===47){if(!(o===f-1||a===1))if(o!==f-1&&a===2){if(n.length<2||s!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var g=n.lastIndexOf("/");if(g!==n.length-1){g===-1?(n="",s=0):(n=n.slice(0,g),s=n.length-1-n.lastIndexOf("/")),o=f,a=0;continue}}else if(n.length===2||n.length===1){n="",s=0,o=f,a=0;continue}}t&&(n.length>0?n+="/..":n="..",s=2)}else n.length>0?n+="/"+r.slice(o+1,f):n=r.slice(o+1,f),s=f-o-1;o=f,a=0}else c===46&&a!==-1?++a:a=-1}return n}function _format(r,t){var n=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+s:n+r+s:s}function resolve(){for(var r="",t=!1,n,s=arguments.length-1;s>=-1&&!t;s--){var o;s>=0?o=arguments[s]:(n===void 0&&(n=process.cwd()),o=n),assertPath(o),o.length!==0&&(r=o+"/"+r,t=o.charCodeAt(0)===47)}return r=normalizeStringPosix(r,!t),t?r.length>0?"/"+r:"/":r.length>0?r:"."}function normalize$5(r){if(assertPath(r),r.length===0)return".";var t=r.charCodeAt(0)===47,n=r.charCodeAt(r.length-1)===47;return r=normalizeStringPosix(r,!t),r.length===0&&!t&&(r="."),r.length>0&&n&&(r+="/"),t?"/"+r:r}function isAbsolute(r){return assertPath(r),r.length>0&&r.charCodeAt(0)===47}function join$4(){if(arguments.length===0)return".";for(var r,t=0;t<arguments.length;++t){var n=arguments[t];assertPath(n),n.length>0&&(r===void 0?r=n:r+="/"+n)}return r===void 0?".":normalize$5(r)}function relative(r,t){if(assertPath(r),assertPath(t),r===t||(r=resolve(r),t=resolve(t),r===t))return"";for(var n=1;n<r.length&&r.charCodeAt(n)===47;++n);for(var s=r.length,o=s-n,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var c=t.length,f=c-a,g=o<f?o:f,b=-1,_=0;_<=g;++_){if(_===g){if(f>g){if(t.charCodeAt(a+_)===47)return t.slice(a+_+1);if(_===0)return t.slice(a+_)}else o>g&&(r.charCodeAt(n+_)===47?b=_:_===0&&(b=0));break}var L=r.charCodeAt(n+_),q=t.charCodeAt(a+_);if(L!==q)break;L===47&&(b=_)}var X="";for(_=n+b+1;_<=s;++_)(_===s||r.charCodeAt(_)===47)&&(X.length===0?X+="..":X+="/..");return X.length>0?X+t.slice(a+b):(a+=b,t.charCodeAt(a)===47&&++a,t.slice(a))}function _makeLong(r){return r}function dirname(r){if(assertPath(r),r.length===0)return".";for(var t=r.charCodeAt(0),n=t===47,s=-1,o=!0,a=r.length-1;a>=1;--a)if(t=r.charCodeAt(a),t===47){if(!o){s=a;break}}else o=!1;return s===-1?n?"/":".":n&&s===1?"//":r.slice(0,s)}function basename(r,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');assertPath(r);var n=0,s=-1,o=!0,a;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";var c=t.length-1,f=-1;for(a=r.length-1;a>=0;--a){var g=r.charCodeAt(a);if(g===47){if(!o){n=a+1;break}}else f===-1&&(o=!1,f=a+1),c>=0&&(g===t.charCodeAt(c)?--c===-1&&(s=a):(c=-1,s=f))}return n===s?s=f:s===-1&&(s=r.length),r.slice(n,s)}else{for(a=r.length-1;a>=0;--a)if(r.charCodeAt(a)===47){if(!o){n=a+1;break}}else s===-1&&(o=!1,s=a+1);return s===-1?"":r.slice(n,s)}}function extname(r){assertPath(r);for(var t=-1,n=0,s=-1,o=!0,a=0,c=r.length-1;c>=0;--c){var f=r.charCodeAt(c);if(f===47){if(!o){n=c+1;break}continue}s===-1&&(o=!1,s=c+1),f===46?t===-1?t=c:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||s===-1||a===0||a===1&&t===s-1&&t===n+1?"":r.slice(t,s)}function format$1(r){if(r===null||typeof r!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof r);return _format("/",r)}function parse$2(r){assertPath(r);var t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;var n=r.charCodeAt(0),s=n===47,o;s?(t.root="/",o=1):o=0;for(var a=-1,c=0,f=-1,g=!0,b=r.length-1,_=0;b>=o;--b){if(n=r.charCodeAt(b),n===47){if(!g){c=b+1;break}continue}f===-1&&(g=!1,f=b+1),n===46?a===-1?a=b:_!==1&&(_=1):a!==-1&&(_=-1)}return a===-1||f===-1||_===0||_===1&&a===f-1&&a===c+1?f!==-1&&(c===0&&s?t.base=t.name=r.slice(1,f):t.base=t.name=r.slice(c,f)):(c===0&&s?(t.name=r.slice(1,a),t.base=r.slice(1,f)):(t.name=r.slice(c,a),t.base=r.slice(c,f)),t.ext=r.slice(a,f)),c>0?t.dir=r.slice(0,c-1):s&&(t.dir="/"),t}var sep="/",delimiter$1=":",posix,path_default,init_path=__esm(()=>{posix=(r=>(r.posix=r,r))({resolve,normalize:normalize$5,isAbsolute,join:join$4,relative,_makeLong,dirname,basename,extname,format:format$1,parse:parse$2,sep,delimiter:delimiter$1,win32:null,posix:null}),path_default=posix}),exports_buffer={};__export$2(exports_buffer,{transcode:()=>transcode,resolveObjectURL:()=>resolveObjectURL,kStringMaxLength:()=>kStringMaxLength,kMaxLength:()=>kMaxLength,isUtf8:()=>isUtf8,isAscii:()=>isAscii,default:()=>buffer_default,constants:()=>constants,btoa:()=>btoa$1,atob:()=>atob$1,INSPECT_MAX_BYTES:()=>INSPECT_MAX_BYTES,File:()=>File,Buffer:()=>Buffer2,Blob:()=>Blob});function getLens(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=r.indexOf("=");n===-1&&(n=t);var s=n===t?0:4-n%4;return[n,s]}function _byteLength(r,t){return(r+t)*3/4-t}function toByteArray(r){var t,n=getLens(r),s=n[0],o=n[1],a=new Uint8Array(_byteLength(s,o)),c=0,f=o>0?s-4:s,g;for(g=0;g<f;g+=4)t=revLookup[r.charCodeAt(g)]<<18|revLookup[r.charCodeAt(g+1)]<<12|revLookup[r.charCodeAt(g+2)]<<6|revLookup[r.charCodeAt(g+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=t&255;return o===2&&(t=revLookup[r.charCodeAt(g)]<<2|revLookup[r.charCodeAt(g+1)]>>4,a[c++]=t&255),o===1&&(t=revLookup[r.charCodeAt(g)]<<10|revLookup[r.charCodeAt(g+1)]<<4|revLookup[r.charCodeAt(g+2)]>>2,a[c++]=t>>8&255,a[c++]=t&255),a}function tripletToBase64(r){return lookup[r>>18&63]+lookup[r>>12&63]+lookup[r>>6&63]+lookup[r&63]}function encodeChunk(r,t,n){for(var s,o=[],a=t;a<n;a+=3)s=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),o.push(tripletToBase64(s));return o.join("")}function fromByteArray(r){for(var t,n=r.length,s=n%3,o=[],a=16383,c=0,f=n-s;c<f;c+=a)o.push(encodeChunk(r,c,c+a>f?f:c+a));return s===1?(t=r[n-1],o.push(lookup[t>>2]+lookup[t<<4&63]+"==")):s===2&&(t=(r[n-2]<<8)+r[n-1],o.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),o.join("")}function read(r,t,n,s,o){var a,c,f=o*8-s-1,g=(1<<f)-1,b=g>>1,_=-7,L=n?o-1:0,q=n?-1:1,X=r[t+L];for(L+=q,a=X&(1<<-_)-1,X>>=-_,_+=f;_>0;a=a*256+r[t+L],L+=q,_-=8);for(c=a&(1<<-_)-1,a>>=-_,_+=s;_>0;c=c*256+r[t+L],L+=q,_-=8);if(a===0)a=1-b;else{if(a===g)return c?NaN:(X?-1:1)*(1/0);c=c+Math.pow(2,s),a=a-b}return(X?-1:1)*c*Math.pow(2,a-s)}function write(r,t,n,s,o,a){var c,f,g,b=a*8-o-1,_=(1<<b)-1,L=_>>1,q=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=s?0:a-1,te=s?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,c=_):(c=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-c))<1&&(c--,g*=2),c+L>=1?t+=q/g:t+=q*Math.pow(2,1-L),t*g>=2&&(c++,g/=2),c+L>=_?(f=0,c=_):c+L>=1?(f=(t*g-1)*Math.pow(2,o),c=c+L):(f=t*Math.pow(2,L-1)*Math.pow(2,o),c=0));o>=8;r[n+X]=f&255,X+=te,f/=256,o-=8);for(c=c<<o|f,b+=o;b>0;r[n+X]=c&255,X+=te,c/=256,b-=8);r[n+X-te]|=ne*128}function createBuffer(r){if(r>kMaxLength)throw new RangeError('The value "'+r+'" is invalid for option "size"');let t=new Uint8Array(r);return Object.setPrototypeOf(t,Buffer2.prototype),t}function E$1(r,t,n){return class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(o){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:o,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}function Buffer2(r,t,n){if(typeof r=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(r)}return from(r,t,n)}function from(r,t,n){if(typeof r=="string")return fromString(r,t);if(ArrayBuffer.isView(r))return fromArrayView(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(isInstance(r,ArrayBuffer)||r&&isInstance(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(isInstance(r,SharedArrayBuffer)||r&&isInstance(r.buffer,SharedArrayBuffer)))return fromArrayBuffer(r,t,n);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let s=r.valueOf&&r.valueOf();if(s!=null&&s!==r)return Buffer2.from(s,t,n);let o=fromObject(r);if(o)return o;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return Buffer2.from(r[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function assertSize(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function alloc(r,t,n){return assertSize(r),r<=0?createBuffer(r):t!==void 0?typeof n=="string"?createBuffer(r).fill(t,n):createBuffer(r).fill(t):createBuffer(r)}function allocUnsafe(r){return assertSize(r),createBuffer(r<0?0:checked(r)|0)}function fromString(r,t){if((typeof t!="string"||t==="")&&(t="utf8"),!Buffer2.isEncoding(t))throw new TypeError("Unknown encoding: "+t);let n=byteLength(r,t)|0,s=createBuffer(n),o=s.write(r,t);return o!==n&&(s=s.slice(0,o)),s}function fromArrayLike(r){let t=r.length<0?0:checked(r.length)|0,n=createBuffer(t);for(let s=0;s<t;s+=1)n[s]=r[s]&255;return n}function fromArrayView(r){if(isInstance(r,Uint8Array)){let t=new Uint8Array(r);return fromArrayBuffer(t.buffer,t.byteOffset,t.byteLength)}return fromArrayLike(r)}function fromArrayBuffer(r,t,n){if(t<0||r.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let s;return t===void 0&&n===void 0?s=new Uint8Array(r):n===void 0?s=new Uint8Array(r,t):s=new Uint8Array(r,t,n),Object.setPrototypeOf(s,Buffer2.prototype),s}function fromObject(r){if(Buffer2.isBuffer(r)){let t=checked(r.length)|0,n=createBuffer(t);return n.length===0||r.copy(n,0,0,t),n}if(r.length!==void 0)return typeof r.length!="number"||Number.isNaN(r.length)?createBuffer(0):fromArrayLike(r);if(r.type==="Buffer"&&Array.isArray(r.data))return fromArrayLike(r.data)}function checked(r){if(r>=kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength.toString(16)+" bytes");return r|0}function byteLength(r,t){if(Buffer2.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||isInstance(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let n=r.length,s=arguments.length>2&&arguments[2]===!0;if(!s&&n===0)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return utf8ToBytes$a(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return n*2;case"hex":return n>>>1;case"base64":return base64ToBytes(r).length;default:if(o)return s?-1:utf8ToBytes$a(r).length;t=(""+t).toLowerCase(),o=!0}}function slowToString(r,t,n){let s=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0,t>>>=0,n<=t))return"";for(r||(r="utf8");;)switch(r){case"hex":return hexSlice(this,t,n);case"utf8":case"utf-8":return utf8Slice(this,t,n);case"ascii":return asciiSlice(this,t,n);case"latin1":case"binary":return latin1Slice(this,t,n);case"base64":return base64Slice(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),s=!0}}function swap(r,t,n){let s=r[t];r[t]=r[n],r[n]=s}function bidirectionalIndexOf(r,t,n,s,o){if(r.length===0)return-1;if(typeof n=="string"?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,Number.isNaN(n)&&(n=o?0:r.length-1),n<0&&(n=r.length+n),n>=r.length){if(o)return-1;n=r.length-1}else if(n<0)if(o)n=0;else return-1;if(typeof t=="string"&&(t=Buffer2.from(t,s)),Buffer2.isBuffer(t))return t.length===0?-1:arrayIndexOf(r,t,n,s,o);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?o?Uint8Array.prototype.indexOf.call(r,t,n):Uint8Array.prototype.lastIndexOf.call(r,t,n):arrayIndexOf(r,[t],n,s,o);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(r,t,n,s,o){let a=1,c=r.length,f=t.length;if(s!==void 0&&(s=String(s).toLowerCase(),s==="ucs2"||s==="ucs-2"||s==="utf16le"||s==="utf-16le")){if(r.length<2||t.length<2)return-1;a=2,c/=2,f/=2,n/=2}function g(_,L){return a===1?_[L]:_.readUInt16BE(L*a)}let b;if(o){let _=-1;for(b=n;b<c;b++)if(g(r,b)===g(t,_===-1?0:b-_)){if(_===-1&&(_=b),b-_+1===f)return _*a}else _!==-1&&(b-=b-_),_=-1}else for(n+f>c&&(n=c-f),b=n;b>=0;b--){let _=!0;for(let L=0;L<f;L++)if(g(r,b+L)!==g(t,L)){_=!1;break}if(_)return b}return-1}function hexWrite(r,t,n,s){n=Number(n)||0;let o=r.length-n;s?(s=Number(s),s>o&&(s=o)):s=o;let a=t.length;s>a/2&&(s=a/2);let c;for(c=0;c<s;++c){let f=parseInt(t.substr(c*2,2),16);if(Number.isNaN(f))return c;r[n+c]=f}return c}function utf8Write(r,t,n,s){return blitBuffer(utf8ToBytes$a(t,r.length-n),r,n,s)}function asciiWrite(r,t,n,s){return blitBuffer(asciiToBytes(t),r,n,s)}function base64Write(r,t,n,s){return blitBuffer(base64ToBytes(t),r,n,s)}function ucs2Write(r,t,n,s){return blitBuffer(utf16leToBytes(t,r.length-n),r,n,s)}function base64Slice(r,t,n){return t===0&&n===r.length?fromByteArray(r):fromByteArray(r.slice(t,n))}function utf8Slice(r,t,n){n=Math.min(r.length,n);let s=[],o=t;for(;o<n;){let a=r[o],c=null,f=a>239?4:a>223?3:a>191?2:1;if(o+f<=n){let g,b,_,L;switch(f){case 1:a<128&&(c=a);break;case 2:g=r[o+1],(g&192)===128&&(L=(a&31)<<6|g&63,L>127&&(c=L));break;case 3:g=r[o+1],b=r[o+2],(g&192)===128&&(b&192)===128&&(L=(a&15)<<12|(g&63)<<6|b&63,L>2047&&(L<55296||L>57343)&&(c=L));break;case 4:g=r[o+1],b=r[o+2],_=r[o+3],(g&192)===128&&(b&192)===128&&(_&192)===128&&(L=(a&15)<<18|(g&63)<<12|(b&63)<<6|_&63,L>65535&&L<1114112&&(c=L))}}c===null?(c=65533,f=1):c>65535&&(c-=65536,s.push(c>>>10&1023|55296),c=56320|c&1023),s.push(c),o+=f}return decodeCodePointsArray(s)}function decodeCodePointsArray(r){let t=r.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,r);let n="",s=0;for(;s<t;)n+=String.fromCharCode.apply(String,r.slice(s,s+=MAX_ARGUMENTS_LENGTH));return n}function asciiSlice(r,t,n){let s="";n=Math.min(r.length,n);for(let o=t;o<n;++o)s+=String.fromCharCode(r[o]&127);return s}function latin1Slice(r,t,n){let s="";n=Math.min(r.length,n);for(let o=t;o<n;++o)s+=String.fromCharCode(r[o]);return s}function hexSlice(r,t,n){let s=r.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);let o="";for(let a=t;a<n;++a)o+=hexSliceLookupTable[r[a]];return o}function utf16leSlice(r,t,n){let s=r.slice(t,n),o="";for(let a=0;a<s.length-1;a+=2)o+=String.fromCharCode(s[a]+s[a+1]*256);return o}function checkOffset(r,t,n){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+t>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(r,t,n,s,o,a){if(!Buffer2.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(n+s>r.length)throw new RangeError("Index out of range")}function wrtBigUInt64LE(r,t,n,s,o){checkIntBI(t,s,o,r,n,7);let a=Number(t&BigInt(4294967295));r[n++]=a,a=a>>8,r[n++]=a,a=a>>8,r[n++]=a,a=a>>8,r[n++]=a;let c=Number(t>>BigInt(32)&BigInt(4294967295));return r[n++]=c,c=c>>8,r[n++]=c,c=c>>8,r[n++]=c,c=c>>8,r[n++]=c,n}function wrtBigUInt64BE(r,t,n,s,o){checkIntBI(t,s,o,r,n,7);let a=Number(t&BigInt(4294967295));r[n+7]=a,a=a>>8,r[n+6]=a,a=a>>8,r[n+5]=a,a=a>>8,r[n+4]=a;let c=Number(t>>BigInt(32)&BigInt(4294967295));return r[n+3]=c,c=c>>8,r[n+2]=c,c=c>>8,r[n+1]=c,c=c>>8,r[n]=c,n+8}function checkIEEE754(r,t,n,s,o,a){if(n+s>r.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(r,t,n,s,o){return t=+t,n=n>>>0,!o&&checkIEEE754(r,t,n,4),write(r,t,n,s,23,4),n+4}function writeDouble(r,t,n,s,o){return t=+t,n=n>>>0,!o&&checkIEEE754(r,t,n,8),write(r,t,n,s,52,8),n+8}function addNumericalSeparator(r){let t="",n=r.length,s=r[0]==="-"?1:0;for(;n>=s+4;n-=3)t=`_${r.slice(n-3,n)}${t}`;return`${r.slice(0,n)}${t}`}function checkBounds(r,t,n){validateNumber(t,"offset"),(r[t]===void 0||r[t+n]===void 0)&&boundsError(t,r.length-(n+1))}function checkIntBI(r,t,n,s,o,a){if(r>n||r<t){let c=typeof t=="bigint"?"n":"",f;throw t===0||t===BigInt(0)?f=`>= 0${c} and < 2${c} ** ${(a+1)*8}${c}`:f=`>= -(2${c} ** ${(a+1)*8-1}${c}) and < 2 ** ${(a+1)*8-1}${c}`,new ERR_OUT_OF_RANGE("value",f,r)}checkBounds(s,o,a)}function validateNumber(r,t){if(typeof r!="number")throw new ERR_INVALID_ARG_TYPE(t,"number",r)}function boundsError(r,t,n){throw Math.floor(r)!==r?(validateNumber(r,n),new ERR_OUT_OF_RANGE("offset","an integer",r)):t<0?new ERR_BUFFER_OUT_OF_BOUNDS:new ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,r)}function base64clean(r){if(r=r.split("=")[0],r=r.trim().replace(INVALID_BASE64_RE,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function utf8ToBytes$a(r,t){t=t||1/0;let n,s=r.length,o=null,a=[];for(let c=0;c<s;++c){if(n=r.charCodeAt(c),n>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}else if(c+1===s){(t-=3)>-1&&a.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),o=n;continue}n=(o-55296<<10|n-56320)+65536}else o&&(t-=3)>-1&&a.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,n&63|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,n&63|128)}else if(n<1114112){if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}else throw new Error("Invalid code point")}return a}function asciiToBytes(r){let t=[];for(let n=0;n<r.length;++n)t.push(r.charCodeAt(n)&255);return t}function utf16leToBytes(r,t){let n,s,o,a=[];for(let c=0;c<r.length&&!((t-=2)<0);++c)n=r.charCodeAt(c),s=n>>8,o=n%256,a.push(o),a.push(s);return a}function base64ToBytes(r){return toByteArray(base64clean(r))}function blitBuffer(r,t,n,s){let o;for(o=0;o<s&&!(o+n>=t.length||o>=r.length);++o)t[o+n]=r[o];return o}function isInstance(r,t){return r instanceof t||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===t.name}function defineBigIntMethod(r){return typeof BigInt>"u"?BufferBigIntNotDefined:r}function BufferBigIntNotDefined(){throw new Error("BigInt not supported")}function notimpl(r){return()=>{throw new Error(r+" is not implemented for node:buffer browser polyfill")}}var lookup,revLookup,code$2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i$4,len,customInspectSymbol,INSPECT_MAX_BYTES=50,kMaxLength=2147483647,kStringMaxLength=536870888,btoa$1,atob$1,File,Blob,constants,ERR_BUFFER_OUT_OF_BOUNDS,ERR_INVALID_ARG_TYPE,ERR_OUT_OF_RANGE,MAX_ARGUMENTS_LENGTH=4096,INVALID_BASE64_RE,hexSliceLookupTable,resolveObjectURL,isUtf8,isAscii=r=>{for(let t of r)if(t.charCodeAt(0)>127)return!1;return!0},transcode,buffer_default,init_buffer=__esm(()=>{for(lookup=[],revLookup=[],i$4=0,len=code$2.length;i$4<len;++i$4)lookup[i$4]=code$2[i$4],revLookup[code$2.charCodeAt(i$4)]=i$4;revLookup[45]=62,revLookup[95]=63,customInspectSymbol=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null,btoa$1=globalThis.btoa,atob$1=globalThis.atob,File=globalThis.File,Blob=globalThis.Blob,constants={MAX_LENGTH:kMaxLength,MAX_STRING_LENGTH:kStringMaxLength},ERR_BUFFER_OUT_OF_BOUNDS=E$1("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ERR_INVALID_ARG_TYPE=E$1("ERR_INVALID_ARG_TYPE",function(r,t){return`The "${r}" argument must be of type number. Received type ${typeof t}`},TypeError),ERR_OUT_OF_RANGE=E$1("ERR_OUT_OF_RANGE",function(r,t,n){let s=`The value of "${r}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>4294967296?o=addNumericalSeparator(String(n)):typeof n=="bigint"&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=addNumericalSeparator(o)),o+="n"),s+=` It must be ${t}. Received ${o}`,s},RangeError),Object.defineProperty(Buffer2.prototype,"parent",{enumerable:!0,get:function(){if(Buffer2.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer2.prototype,"offset",{enumerable:!0,get:function(){if(Buffer2.isBuffer(this))return this.byteOffset}}),Buffer2.poolSize=8192,Buffer2.from=function(r,t,n){return from(r,t,n)},Object.setPrototypeOf(Buffer2.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer2,Uint8Array),Buffer2.alloc=function(r,t,n){return alloc(r,t,n)},Buffer2.allocUnsafe=function(r){return allocUnsafe(r)},Buffer2.allocUnsafeSlow=function(r){return allocUnsafe(r)},Buffer2.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==Buffer2.prototype},Buffer2.compare=function(t,n){if(isInstance(t,Uint8Array)&&(t=Buffer2.from(t,t.offset,t.byteLength)),isInstance(n,Uint8Array)&&(n=Buffer2.from(n,n.offset,n.byteLength)),!Buffer2.isBuffer(t)||!Buffer2.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===n)return 0;let s=t.length,o=n.length;for(let a=0,c=Math.min(s,o);a<c;++a)if(t[a]!==n[a]){s=t[a],o=n[a];break}return s<o?-1:o<s?1:0},Buffer2.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer2.concat=function(t,n){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return Buffer2.alloc(0);let s;if(n===void 0)for(n=0,s=0;s<t.length;++s)n+=t[s].length;let o=Buffer2.allocUnsafe(n),a=0;for(s=0;s<t.length;++s){let c=t[s];if(isInstance(c,Uint8Array))a+c.length>o.length?(Buffer2.isBuffer(c)||(c=Buffer2.from(c)),c.copy(o,a)):Uint8Array.prototype.set.call(o,c,a);else if(Buffer2.isBuffer(c))c.copy(o,a);else throw new TypeError('"list" argument must be an Array of Buffers');a+=c.length}return o},Buffer2.byteLength=byteLength,Buffer2.prototype._isBuffer=!0,Buffer2.prototype.swap16=function(){let t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<t;n+=2)swap(this,n,n+1);return this},Buffer2.prototype.swap32=function(){let t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<t;n+=4)swap(this,n,n+3),swap(this,n+1,n+2);return this},Buffer2.prototype.swap64=function(){let t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<t;n+=8)swap(this,n,n+7),swap(this,n+1,n+6),swap(this,n+2,n+5),swap(this,n+3,n+4);return this},Buffer2.prototype.toString=function(){let t=this.length;return t===0?"":arguments.length===0?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer2.prototype.toLocaleString=Buffer2.prototype.toString,Buffer2.prototype.equals=function(t){if(!Buffer2.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:Buffer2.compare(this,t)===0},Buffer2.prototype.inspect=function(){let t="",n=INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},customInspectSymbol&&(Buffer2.prototype[customInspectSymbol]=Buffer2.prototype.inspect),Buffer2.prototype.compare=function(t,n,s,o,a){if(isInstance(t,Uint8Array)&&(t=Buffer2.from(t,t.offset,t.byteLength)),!Buffer2.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(n===void 0&&(n=0),s===void 0&&(s=t?t.length:0),o===void 0&&(o=0),a===void 0&&(a=this.length),n<0||s>t.length||o<0||a>this.length)throw new RangeError("out of range index");if(o>=a&&n>=s)return 0;if(o>=a)return-1;if(n>=s)return 1;if(n>>>=0,s>>>=0,o>>>=0,a>>>=0,this===t)return 0;let c=a-o,f=s-n,g=Math.min(c,f),b=this.slice(o,a),_=t.slice(n,s);for(let L=0;L<g;++L)if(b[L]!==_[L]){c=b[L],f=_[L];break}return c<f?-1:f<c?1:0},Buffer2.prototype.includes=function(t,n,s){return this.indexOf(t,n,s)!==-1},Buffer2.prototype.indexOf=function(t,n,s){return bidirectionalIndexOf(this,t,n,s,!0)},Buffer2.prototype.lastIndexOf=function(t,n,s){return bidirectionalIndexOf(this,t,n,s,!1)},Buffer2.prototype.write=function(t,n,s,o){if(n===void 0)o="utf8",s=this.length,n=0;else if(s===void 0&&typeof n=="string")o=n,s=this.length,n=0;else if(isFinite(n))n=n>>>0,isFinite(s)?(s=s>>>0,o===void 0&&(o="utf8")):(o=s,s=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let a=this.length-n;if((s===void 0||s>a)&&(s=a),t.length>0&&(s<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");let c=!1;for(;;)switch(o){case"hex":return hexWrite(this,t,n,s);case"utf8":case"utf-8":return utf8Write(this,t,n,s);case"ascii":case"latin1":case"binary":return asciiWrite(this,t,n,s);case"base64":return base64Write(this,t,n,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,n,s);default:if(c)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),c=!0}},Buffer2.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer2.prototype.slice=function(t,n){let s=this.length;t=~~t,n=n===void 0?s:~~n,t<0?(t+=s,t<0&&(t=0)):t>s&&(t=s),n<0?(n+=s,n<0&&(n=0)):n>s&&(n=s),n<t&&(n=t);let o=this.subarray(t,n);return Object.setPrototypeOf(o,Buffer2.prototype),o},Buffer2.prototype.readUintLE=Buffer2.prototype.readUIntLE=function(t,n,s){t=t>>>0,n=n>>>0,!s&&checkOffset(t,n,this.length);let o=this[t],a=1,c=0;for(;++c<n&&(a*=256);)o+=this[t+c]*a;return o},Buffer2.prototype.readUintBE=Buffer2.prototype.readUIntBE=function(t,n,s){t=t>>>0,n=n>>>0,!s&&checkOffset(t,n,this.length);let o=this[t+--n],a=1;for(;n>0&&(a*=256);)o+=this[t+--n]*a;return o},Buffer2.prototype.readUint8=Buffer2.prototype.readUInt8=function(t,n){return t=t>>>0,!n&&checkOffset(t,1,this.length),this[t]},Buffer2.prototype.readUint16LE=Buffer2.prototype.readUInt16LE=function(t,n){return t=t>>>0,!n&&checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer2.prototype.readUint16BE=Buffer2.prototype.readUInt16BE=function(t,n){return t=t>>>0,!n&&checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer2.prototype.readUint32LE=Buffer2.prototype.readUInt32LE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},Buffer2.prototype.readUint32BE=Buffer2.prototype.readUInt32BE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer2.prototype.readBigUInt64LE=defineBigIntMethod(function(t){t=t>>>0,validateNumber(t,"offset");let n=this[t],s=this[t+7];(n===void 0||s===void 0)&&boundsError(t,this.length-8);let o=n+this[++t]*256+this[++t]*65536+this[++t]*16777216,a=this[++t]+this[++t]*256+this[++t]*65536+s*16777216;return BigInt(o)+(BigInt(a)<<BigInt(32))}),Buffer2.prototype.readBigUInt64BE=defineBigIntMethod(function(t){t=t>>>0,validateNumber(t,"offset");let n=this[t],s=this[t+7];(n===void 0||s===void 0)&&boundsError(t,this.length-8);let o=n*16777216+this[++t]*65536+this[++t]*256+this[++t],a=this[++t]*16777216+this[++t]*65536+this[++t]*256+s;return(BigInt(o)<<BigInt(32))+BigInt(a)}),Buffer2.prototype.readIntLE=function(t,n,s){t=t>>>0,n=n>>>0,!s&&checkOffset(t,n,this.length);let o=this[t],a=1,c=0;for(;++c<n&&(a*=256);)o+=this[t+c]*a;return a*=128,o>=a&&(o-=Math.pow(2,8*n)),o},Buffer2.prototype.readIntBE=function(t,n,s){t=t>>>0,n=n>>>0,!s&&checkOffset(t,n,this.length);let o=n,a=1,c=this[t+--o];for(;o>0&&(a*=256);)c+=this[t+--o]*a;return a*=128,c>=a&&(c-=Math.pow(2,8*n)),c},Buffer2.prototype.readInt8=function(t,n){return t=t>>>0,!n&&checkOffset(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},Buffer2.prototype.readInt16LE=function(t,n){t=t>>>0,!n&&checkOffset(t,2,this.length);let s=this[t]|this[t+1]<<8;return s&32768?s|4294901760:s},Buffer2.prototype.readInt16BE=function(t,n){t=t>>>0,!n&&checkOffset(t,2,this.length);let s=this[t+1]|this[t]<<8;return s&32768?s|4294901760:s},Buffer2.prototype.readInt32LE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer2.prototype.readInt32BE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer2.prototype.readBigInt64LE=defineBigIntMethod(function(t){t=t>>>0,validateNumber(t,"offset");let n=this[t],s=this[t+7];(n===void 0||s===void 0)&&boundsError(t,this.length-8);let o=this[t+4]+this[t+5]*256+this[t+6]*65536+(s<<24);return(BigInt(o)<<BigInt(32))+BigInt(n+this[++t]*256+this[++t]*65536+this[++t]*16777216)}),Buffer2.prototype.readBigInt64BE=defineBigIntMethod(function(t){t=t>>>0,validateNumber(t,"offset");let n=this[t],s=this[t+7];(n===void 0||s===void 0)&&boundsError(t,this.length-8);let o=(n<<24)+this[++t]*65536+this[++t]*256+this[++t];return(BigInt(o)<<BigInt(32))+BigInt(this[++t]*16777216+this[++t]*65536+this[++t]*256+s)}),Buffer2.prototype.readFloatLE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),read(this,t,!0,23,4)},Buffer2.prototype.readFloatBE=function(t,n){return t=t>>>0,!n&&checkOffset(t,4,this.length),read(this,t,!1,23,4)},Buffer2.prototype.readDoubleLE=function(t,n){return t=t>>>0,!n&&checkOffset(t,8,this.length),read(this,t,!0,52,8)},Buffer2.prototype.readDoubleBE=function(t,n){return t=t>>>0,!n&&checkOffset(t,8,this.length),read(this,t,!1,52,8)},Buffer2.prototype.writeUintLE=Buffer2.prototype.writeUIntLE=function(t,n,s,o){if(t=+t,n=n>>>0,s=s>>>0,!o){let f=Math.pow(2,8*s)-1;checkInt(this,t,n,s,f,0)}let a=1,c=0;for(this[n]=t&255;++c<s&&(a*=256);)this[n+c]=t/a&255;return n+s},Buffer2.prototype.writeUintBE=Buffer2.prototype.writeUIntBE=function(t,n,s,o){if(t=+t,n=n>>>0,s=s>>>0,!o){let f=Math.pow(2,8*s)-1;checkInt(this,t,n,s,f,0)}let a=s-1,c=1;for(this[n+a]=t&255;--a>=0&&(c*=256);)this[n+a]=t/c&255;return n+s},Buffer2.prototype.writeUint8=Buffer2.prototype.writeUInt8=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,1,255,0),this[n]=t&255,n+1},Buffer2.prototype.writeUint16LE=Buffer2.prototype.writeUInt16LE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,2,65535,0),this[n]=t&255,this[n+1]=t>>>8,n+2},Buffer2.prototype.writeUint16BE=Buffer2.prototype.writeUInt16BE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,2,65535,0),this[n]=t>>>8,this[n+1]=t&255,n+2},Buffer2.prototype.writeUint32LE=Buffer2.prototype.writeUInt32LE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,4,4294967295,0),this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=t&255,n+4},Buffer2.prototype.writeUint32BE=Buffer2.prototype.writeUInt32BE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,4,4294967295,0),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4},Buffer2.prototype.writeBigUInt64LE=defineBigIntMethod(function(t,n=0){return wrtBigUInt64LE(this,t,n,BigInt(0),BigInt("0xffffffffffffffff"))}),Buffer2.prototype.writeBigUInt64BE=defineBigIntMethod(function(t,n=0){return wrtBigUInt64BE(this,t,n,BigInt(0),BigInt("0xffffffffffffffff"))}),Buffer2.prototype.writeIntLE=function(t,n,s,o){if(t=+t,n=n>>>0,!o){let g=Math.pow(2,8*s-1);checkInt(this,t,n,s,g-1,-g)}let a=0,c=1,f=0;for(this[n]=t&255;++a<s&&(c*=256);)t<0&&f===0&&this[n+a-1]!==0&&(f=1),this[n+a]=(t/c>>0)-f&255;return n+s},Buffer2.prototype.writeIntBE=function(t,n,s,o){if(t=+t,n=n>>>0,!o){let g=Math.pow(2,8*s-1);checkInt(this,t,n,s,g-1,-g)}let a=s-1,c=1,f=0;for(this[n+a]=t&255;--a>=0&&(c*=256);)t<0&&f===0&&this[n+a+1]!==0&&(f=1),this[n+a]=(t/c>>0)-f&255;return n+s},Buffer2.prototype.writeInt8=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,1,127,-128),t<0&&(t=255+t+1),this[n]=t&255,n+1},Buffer2.prototype.writeInt16LE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,2,32767,-32768),this[n]=t&255,this[n+1]=t>>>8,n+2},Buffer2.prototype.writeInt16BE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,2,32767,-32768),this[n]=t>>>8,this[n+1]=t&255,n+2},Buffer2.prototype.writeInt32LE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,4,2147483647,-2147483648),this[n]=t&255,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24,n+4},Buffer2.prototype.writeInt32BE=function(t,n,s){return t=+t,n=n>>>0,!s&&checkInt(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=t&255,n+4},Buffer2.prototype.writeBigInt64LE=defineBigIntMethod(function(t,n=0){return wrtBigUInt64LE(this,t,n,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Buffer2.prototype.writeBigInt64BE=defineBigIntMethod(function(t,n=0){return wrtBigUInt64BE(this,t,n,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Buffer2.prototype.writeFloatLE=function(t,n,s){return writeFloat(this,t,n,!0,s)},Buffer2.prototype.writeFloatBE=function(t,n,s){return writeFloat(this,t,n,!1,s)},Buffer2.prototype.writeDoubleLE=function(t,n,s){return writeDouble(this,t,n,!0,s)},Buffer2.prototype.writeDoubleBE=function(t,n,s){return writeDouble(this,t,n,!1,s)},Buffer2.prototype.copy=function(t,n,s,o){if(!Buffer2.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),!o&&o!==0&&(o=this.length),n>=t.length&&(n=t.length),n||(n=0),o>0&&o<s&&(o=s),o===s||t.length===0||this.length===0)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-n<o-s&&(o=t.length-n+s);let a=o-s;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(n,s,o):Uint8Array.prototype.set.call(t,this.subarray(s,o),n),a},Buffer2.prototype.fill=function(t,n,s,o){if(typeof t=="string"){if(typeof n=="string"?(o=n,n=0,s=this.length):typeof s=="string"&&(o=s,s=this.length),o!==void 0&&typeof o!="string")throw new TypeError("encoding must be a string");if(typeof o=="string"&&!Buffer2.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(t.length===1){let c=t.charCodeAt(0);(o==="utf8"&&c<128||o==="latin1")&&(t=c)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(n<0||this.length<n||this.length<s)throw new RangeError("Out of range index");if(s<=n)return this;n=n>>>0,s=s===void 0?this.length:s>>>0,!t&&(t=0);let a;if(typeof t=="number")for(a=n;a<s;++a)this[a]=t;else{let c=Buffer2.isBuffer(t)?t:Buffer2.from(t,o),f=c.length;if(f===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<s-n;++a)this[a+n]=c[a%f]}return this},INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g,hexSliceLookupTable=(function(){let r=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let s=0;s<16;++s)r[n+s]="0123456789abcdef"[t]+"0123456789abcdef"[s]}return r})(),resolveObjectURL=notimpl("resolveObjectURL"),isUtf8=notimpl("isUtf8"),transcode=notimpl("transcode"),buffer_default=Buffer2}),exports_util={};__export$2(exports_util,{types:()=>types$2,promisify:()=>promisify,log:()=>log,isUndefined:()=>isUndefined,isSymbol:()=>isSymbol,isString:()=>isString$2,isRegExp:()=>isRegExp$2,isPrimitive:()=>isPrimitive,isObject:()=>isObject$1,isNumber:()=>isNumber$1,isNullOrUndefined:()=>isNullOrUndefined,isNull:()=>isNull,isFunction:()=>isFunction$2,isError:()=>isError,isDate:()=>isDate,isBuffer:()=>isBuffer2,isBoolean:()=>isBoolean,isArray:()=>isArray,inspect:()=>inspect2,inherits:()=>inherits,format:()=>format2,deprecate:()=>deprecate,default:()=>util_default,debuglog:()=>debuglog,callbackifyOnRejected:()=>callbackifyOnRejected,callbackify:()=>callbackify,_extend:()=>_extend,TextEncoder:()=>TextEncoder2,TextDecoder:()=>TextDecoder2});function format2(r,...t){if(!isString$2(r)){for(var n=[r],s=0;s<t.length;s++)n.push(inspect2(t[s]));return n.join(" ")}for(var s=0,o=t.length,a=String(r).replace(formatRegExp,function(f){if(f==="%%")return"%";if(s>=o)return f;switch(f){case"%s":return String(t[s++]);case"%d":return Number(t[s++]);case"%j":try{return JSON.stringify(t[s++])}catch{return"[Circular]"}default:return f}}),c=t[s];s<o;c=t[++s])isNull(c)||!isObject$1(c)?a+=" "+c:a+=" "+inspect2(c);return a}function deprecate(r,t){if(typeof process>"u"||process?.noDeprecation===!0)return r;var n=!1;function s(...o){if(!n){if(process.throwDeprecation)throw new Error(t);process.traceDeprecation?console.trace(t):console.error(t),n=!0}return r.apply(this,...o)}return s}function stylizeWithColor(r,t){var n=inspect2.styles[t];return n?"\x1B["+inspect2.colors[n][0]+"m"+r+"\x1B["+inspect2.colors[n][1]+"m":r}function stylizeNoColor(r,t){return r}function arrayToHash(r){var t={};return r.forEach(function(n,s){t[n]=!0}),t}function formatValue(r,t,n){if(r.customInspect&&t&&isFunction$2(t.inspect)&&t.inspect!==inspect2&&!(t.constructor&&t.constructor.prototype===t)){var s=t.inspect(n,r);return isString$2(s)||(s=formatValue(r,s,n)),s}var o=formatPrimitive(r,t);if(o)return o;var a=Object.keys(t),c=arrayToHash(a);if(r.showHidden&&(a=Object.getOwnPropertyNames(t)),isError(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return formatError(t);if(a.length===0){if(isFunction$2(t)){var f=t.name?": "+t.name:"";return r.stylize("[Function"+f+"]","special")}if(isRegExp$2(t))return r.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return r.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError(t)}var g="",b=!1,_=["{","}"];if(isArray(t)&&(b=!0,_=["[","]"]),isFunction$2(t)){var L=t.name?": "+t.name:"";g=" [Function"+L+"]"}if(isRegExp$2(t)&&(g=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(g=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(g=" "+formatError(t)),a.length===0&&(!b||t.length==0))return _[0]+g+_[1];if(n<0)return isRegExp$2(t)?r.stylize(RegExp.prototype.toString.call(t),"regexp"):r.stylize("[Object]","special");r.seen.push(t);var q;return b?q=formatArray$2(r,t,n,c,a):q=a.map(function(X){return formatProperty(r,t,n,c,X,b)}),r.seen.pop(),reduceToSingleString(q,g,_)}function formatPrimitive(r,t){if(isUndefined(t))return r.stylize("undefined","undefined");if(isString$2(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r.stylize(n,"string")}if(isNumber$1(t))return r.stylize(""+t,"number");if(isBoolean(t))return r.stylize(""+t,"boolean");if(isNull(t))return r.stylize("null","null")}function formatError(r){return"["+Error.prototype.toString.call(r)+"]"}function formatArray$2(r,t,n,s,o){for(var a=[],c=0,f=t.length;c<f;++c)hasOwnProperty(t,String(c))?a.push(formatProperty(r,t,n,s,String(c),!0)):a.push("");return o.forEach(function(g){g.match(/^\d+$/)||a.push(formatProperty(r,t,n,s,g,!0))}),a}function formatProperty(r,t,n,s,o,a){var c,f,g;if(g=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},g.get?g.set?f=r.stylize("[Getter/Setter]","special"):f=r.stylize("[Getter]","special"):g.set&&(f=r.stylize("[Setter]","special")),hasOwnProperty(s,o)||(c="["+o+"]"),f||(r.seen.indexOf(g.value)<0?(isNull(n)?f=formatValue(r,g.value,null):f=formatValue(r,g.value,n-1),f.indexOf(`
`)>-1&&(a?f=f.split(`
`).map(function(b){return"  "+b}).join(`
`).slice(2):f=`
`+f.split(`
`).map(function(b){return"   "+b}).join(`
`))):f=r.stylize("[Circular]","special")),isUndefined(c)){if(a&&o.match(/^\d+$/))return f;c=JSON.stringify(""+o),c.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.slice(1,-1),c=r.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=r.stylize(c,"string"))}return c+": "+f}function reduceToSingleString(r,t,n){var s=r.reduce(function(o,a){return a.indexOf(`
`)>=0,o+a.replace(/\u001b\[\d\d?m/g,"").length+1},0);return s>60?n[0]+(t===""?"":t+`
 `)+" "+r.join(`,
  `)+" "+n[1]:n[0]+t+" "+r.join(", ")+" "+n[1]}function isArray(r){return Array.isArray(r)}function isBoolean(r){return typeof r=="boolean"}function isNull(r){return r===null}function isNullOrUndefined(r){return r==null}function isNumber$1(r){return typeof r=="number"}function isString$2(r){return typeof r=="string"}function isSymbol(r){return typeof r=="symbol"}function isUndefined(r){return r===void 0}function isRegExp$2(r){return isObject$1(r)&&objectToString(r)==="[object RegExp]"}function isObject$1(r){return typeof r=="object"&&r!==null}function isDate(r){return isObject$1(r)&&objectToString(r)==="[object Date]"}function isError(r){return isObject$1(r)&&(objectToString(r)==="[object Error]"||r instanceof Error)}function isFunction$2(r){return typeof r=="function"}function isPrimitive(r){return r===null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||typeof r=="symbol"||typeof r>"u"}function isBuffer2(r){return r instanceof Buffer}function objectToString(r){return Object.prototype.toString.call(r)}function pad$2(r){return r<10?"0"+r.toString(10):r.toString(10)}function timestamp(){var r=new Date,t=[pad$2(r.getHours()),pad$2(r.getMinutes()),pad$2(r.getSeconds())].join(":");return[r.getDate(),months[r.getMonth()],t].join(" ")}function log(...r){console.log("%s - %s",timestamp(),format2.apply(null,r))}function inherits(r,t){t&&(r.super_=t,r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}))}function _extend(r,t){if(!t||!isObject$1(t))return r;for(var n=Object.keys(t),s=n.length;s--;)r[n[s]]=t[n[s]];return r}function hasOwnProperty(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function callbackifyOnRejected(r,t){if(!r){var n=new Error("Promise was rejected with a falsy value");n.reason=r,r=n}return t(r)}function callbackify(r){if(typeof r!="function")throw new TypeError('The "original" argument must be of type Function');function t(...n){var s=n.pop();if(typeof s!="function")throw new TypeError("The last argument must be of type Function");var o=this,a=function(...c){return s.apply(o,...c)};r.apply(this,n).then(function(c){process.nextTick(a.bind(null,null,c))},function(c){process.nextTick(callbackifyOnRejected.bind(null,c,a))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(r)),Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)),t}var formatRegExp,debuglog,inspect2,types$2=()=>{},months,promisify,TextEncoder2,TextDecoder2,util_default,init_util=__esm(()=>{formatRegExp=/%[sdj%]/g,debuglog=((r={},t={},n)=>((n=typeof process<"u"&&!1)&&(n=n.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase()),t=new RegExp("^"+n+"$","i"),s=>(s=s.toUpperCase(),!r[s]&&(t.test(s)?r[s]=function(...o){console.error("%s: %s",s,pid,format2.apply(null,...o))}:r[s]=function(){}),r[s])))(),inspect2=(r=>(r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.custom=Symbol.for("nodejs.util.inspect.custom"),r))(function(t,n,...s){var o={seen:[],stylize:stylizeNoColor};return s.length>=1&&(o.depth=s[0]),s.length>=2&&(o.colors=s[1]),isBoolean(n)?o.showHidden=n:n&&_extend(o,n),isUndefined(o.showHidden)&&(o.showHidden=!1),isUndefined(o.depth)&&(o.depth=2),isUndefined(o.colors)&&(o.colors=!1),o.colors&&(o.stylize=stylizeWithColor),formatValue(o,t,o.depth)}),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],promisify=(r=>(r.custom=Symbol.for("nodejs.util.promisify.custom"),r))(function(t){if(typeof t!="function")throw new TypeError('The "original" argument must be of type Function');if(kCustomPromisifiedSymbol&&t[kCustomPromisifiedSymbol]){var n=t[kCustomPromisifiedSymbol];if(typeof n!="function")throw new TypeError('The "nodejs.util.promisify.custom" argument must be of type Function');return Object.defineProperty(n,kCustomPromisifiedSymbol,{value:n,enumerable:!1,writable:!1,configurable:!0}),n}function n(...s){var o,a,c=new Promise(function(f,g){o=f,a=g});s.push(function(f,g){f?a(f):o(g)});try{t.apply(this,s)}catch(f){a(f)}return c}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),kCustomPromisifiedSymbol&&Object.defineProperty(n,kCustomPromisifiedSymbol,{value:n,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(n,Object.getOwnPropertyDescriptors(t))}),{TextEncoder:TextEncoder2,TextDecoder:TextDecoder2}=globalThis,util_default={TextEncoder:TextEncoder2,TextDecoder:TextDecoder2,promisify,log,inherits,_extend,callbackifyOnRejected,callbackify}}),exports_events={};__export$2(exports_events,{setMaxListeners:()=>setMaxListeners2,once:()=>once2,listenerCount:()=>listenerCount2,init:()=>EventEmitter,getMaxListeners:()=>getMaxListeners2,getEventListeners:()=>getEventListeners,default:()=>events_default,captureRejectionSymbol:()=>captureRejectionSymbol,addAbortListener:()=>addAbortListener,EventEmitter:()=>EventEmitter});function emitError(r,t){var{_events:n}=r;if(t[0]??=new Error("Unhandled error."),!n)throw t[0];var s=n[kErrorMonitor];if(s)for(var o of ArrayPrototypeSlice.call(s))o.apply(r,t);var a=n.error;if(!a)throw t[0];for(var o of ArrayPrototypeSlice.call(a))o.apply(r,t);return!0}function addCatch(r,t,n,s){t.then(void 0,function(o){queueMicrotask(()=>emitUnhandledRejectionOrErr(r,o,n,s))})}function emitUnhandledRejectionOrErr(r,t,n,s){if(typeof r[kRejection]=="function")r[kRejection](t,n,...s);else try{r[kCapture]=!1,r.emit("error",t)}finally{r[kCapture]=!0}}function overflowWarning(r,t,n){n.warned=!0;let s=new Error(`Possible EventEmitter memory leak detected. ${n.length} ${String(t)} listeners added to [${r.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);s.name="MaxListenersExceededWarning",s.emitter=r,s.type=t,s.count=n.length,console.warn(s)}function onceWrapper(r,t,...n){this.removeListener(r,t),t.apply(this,n)}function once2(r,t,n){var s=n?.signal;if(validateAbortSignal(s,"options.signal"),s?.aborted)throw new AbortError(void 0,{cause:s?.reason});let{resolve:o,reject:a,promise:c}=$newPromiseCapability(Promise),f=_=>{r.removeListener(t,g),s!=null&&eventTargetAgnosticRemoveListener(s,"abort",b),a(_)},g=(..._)=>{typeof r.removeListener=="function"&&r.removeListener("error",f),s!=null&&eventTargetAgnosticRemoveListener(s,"abort",b),o(_)};eventTargetAgnosticAddListener(r,t,g,{once:!0}),t!=="error"&&typeof r.once=="function"&&r.once("error",f);function b(){eventTargetAgnosticRemoveListener(r,t,g),eventTargetAgnosticRemoveListener(r,"error",f),a(new AbortError(void 0,{cause:s?.reason}))}return s!=null&&eventTargetAgnosticAddListener(s,"abort",b,{once:!0}),c}function getEventListeners(r,t){return r.listeners(t)}function setMaxListeners2(r,...t){validateNumber2(r,"setMaxListeners",0);var n;if(t&&(n=t.length))for(let s=0;s<n;s++)t[s].setMaxListeners(r);else defaultMaxListeners=r}function listenerCount2(r,t){return r.listenerCount(t)}function eventTargetAgnosticRemoveListener(r,t,n,s){typeof r.removeListener=="function"?r.removeListener(t,n):r.removeEventListener(t,n,s)}function eventTargetAgnosticAddListener(r,t,n,s){typeof r.on=="function"?s.once?r.once(t,n):r.on(t,n):r.addEventListener(t,n,s)}function ERR_INVALID_ARG_TYPE2(r,t,n){let s=new TypeError(`The "${r}" argument must be of type ${t}. Received ${n}`);return s.code="ERR_INVALID_ARG_TYPE",s}function ERR_OUT_OF_RANGE2(r,t,n){let s=new RangeError(`The "${r}" argument is out of range. It must be ${t}. Received ${n}`);return s.code="ERR_OUT_OF_RANGE",s}function validateAbortSignal(r,t){if(r!==void 0&&(r===null||typeof r!="object"||!("aborted"in r)))throw ERR_INVALID_ARG_TYPE2(t,"AbortSignal",r)}function validateNumber2(r,t,n,s){if(typeof r!="number")throw ERR_INVALID_ARG_TYPE2(t,"number",r);if(r<n||s!=null||Number.isNaN(r))throw ERR_OUT_OF_RANGE2(t,`${`>= ${n}`}`,r)}function checkListener(r){if(typeof r!="function")throw new TypeError("The listener must be a function")}function validateBoolean(r,t){if(typeof r!="boolean")throw ERR_INVALID_ARG_TYPE2(t,"boolean",r)}function getMaxListeners2(r){return r?._maxListeners??defaultMaxListeners}function addAbortListener(r,t){if(r===void 0)throw ERR_INVALID_ARG_TYPE2("signal","AbortSignal",r);if(validateAbortSignal(r,"signal"),typeof t!="function")throw ERR_INVALID_ARG_TYPE2("listener","function",t);let n;return r.aborted?queueMicrotask(()=>t()):(r.addEventListener("abort",t,{__proto__:null,once:!0}),n=()=>{r.removeEventListener("abort",t)}),{__proto__:null,[Symbol.dispose](){n?.()}}}var SymbolFor,kCapture,kErrorMonitor,kMaxEventTargetListeners,kMaxEventTargetListenersWarned,kRejection,captureRejectionSymbol,ArrayPrototypeSlice,defaultMaxListeners=10,EventEmitter=function(t){(this._events===void 0||this._events===this.__proto__._events)&&(this._events={__proto__:null},this._eventsCount=0),this._maxListeners??=void 0,(this[kCapture]=t?.captureRejections?!!t?.captureRejections:EventEmitterPrototype[kCapture])&&(this.emit=emitWithRejectionCapture)},EventEmitterPrototype,emitWithoutRejectionCapture=function(t,...n){if(t==="error")return emitError(this,n);var{_events:s}=this;if(s===void 0)return!1;var o=s[t];if(o===void 0)return!1;let a=o.length>1?o.slice():o;for(let c=0,{length:f}=a;c<f;c++){let g=a[c];switch(n.length){case 0:g.call(this);break;case 1:g.call(this,n[0]);break;case 2:g.call(this,n[0],n[1]);break;case 3:g.call(this,n[0],n[1],n[2]);break;default:g.apply(this,n);break}}return!0},emitWithRejectionCapture=function(t,...n){if(t==="error")return emitError(this,n);var{_events:s}=this;if(s===void 0)return!1;var o=s[t];if(o===void 0)return!1;let a=o.length>1?o.slice():o;for(let c=0,{length:f}=a;c<f;c++){let g=a[c],b;switch(n.length){case 0:b=g.call(this);break;case 1:b=g.call(this,n[0]);break;case 2:b=g.call(this,n[0],n[1]);break;case 3:b=g.call(this,n[0],n[1],n[2]);break;default:b=g.apply(this,n);break}b!==void 0&&typeof b?.then=="function"&&b.then===Promise.prototype.then&&addCatch(this,b,t,n)}return!0},AbortError,events_default,init_events=__esm(()=>{SymbolFor=Symbol.for,kCapture=Symbol("kCapture"),kErrorMonitor=SymbolFor("events.errorMonitor"),kMaxEventTargetListeners=Symbol("events.maxEventTargetListeners"),kMaxEventTargetListenersWarned=Symbol("events.maxEventTargetListenersWarned"),kRejection=SymbolFor("nodejs.rejection"),captureRejectionSymbol=SymbolFor("nodejs.rejection"),ArrayPrototypeSlice=Array.prototype.slice,EventEmitterPrototype=EventEmitter.prototype={},EventEmitterPrototype._events=void 0,EventEmitterPrototype._eventsCount=0,EventEmitterPrototype._maxListeners=void 0,EventEmitterPrototype.setMaxListeners=function(t){return validateNumber2(t,"setMaxListeners",0),this._maxListeners=t,this},EventEmitterPrototype.constructor=EventEmitter,EventEmitterPrototype.getMaxListeners=function(){return this?._maxListeners??defaultMaxListeners},EventEmitterPrototype.emit=emitWithoutRejectionCapture,EventEmitterPrototype.addListener=function(t,n){checkListener(n);var s=this._events;s?s.newListener&&this.emit("newListener",t,n.listener??n):(s=this._events={__proto__:null},this._eventsCount=0);var o=s[t];if(!o)s[t]=[n],this._eventsCount++;else{o.push(n);var a=this._maxListeners??defaultMaxListeners;a>0&&o.length>a&&!o.warned&&overflowWarning(this,t,o)}return this},EventEmitterPrototype.on=EventEmitterPrototype.addListener,EventEmitterPrototype.prependListener=function(t,n){checkListener(n);var s=this._events;s?s.newListener&&this.emit("newListener",t,n.listener??n):(s=this._events={__proto__:null},this._eventsCount=0);var o=s[t];if(!o)s[t]=[n],this._eventsCount++;else{o.unshift(n);var a=this._maxListeners??defaultMaxListeners;a>0&&o.length>a&&!o.warned&&overflowWarning(this,t,o)}return this},EventEmitterPrototype.once=function(t,n){checkListener(n);let s=onceWrapper.bind(this,t,n);return s.listener=n,this.addListener(t,s),this},EventEmitterPrototype.prependOnceListener=function(t,n){checkListener(n);let s=onceWrapper.bind(this,t,n);return s.listener=n,this.prependListener(t,s),this},EventEmitterPrototype.removeListener=function(t,n){checkListener(n);var{_events:s}=this;if(!s)return this;var o=s[t];if(!o)return this;var a=o.length;let c=-1;for(let f=a-1;f>=0;f--)if(o[f]===n||o[f].listener===n){c=f;break}return c<0?this:(c===0?o.shift():o.splice(c,1),o.length===0&&(delete s[t],this._eventsCount--),this)},EventEmitterPrototype.off=EventEmitterPrototype.removeListener,EventEmitterPrototype.removeAllListeners=function(t){var{_events:n}=this;return t&&n?n[t]&&(delete n[t],this._eventsCount--):this._events={__proto__:null},this},EventEmitterPrototype.listeners=function(t){var{_events:n}=this;if(!n)return[];var s=n[t];return s?s.map(o=>o.listener??o):[]},EventEmitterPrototype.rawListeners=function(t){var{_events:n}=this;if(!n)return[];var s=n[t];return s?s.slice():[]},EventEmitterPrototype.listenerCount=function(t){var{_events:n}=this;return n?n[t]?.length??0:0},EventEmitterPrototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]},EventEmitterPrototype[kCapture]=!1,AbortError=class extends Error{constructor(t="The operation was aborted",n=void 0){if(n!==void 0&&typeof n!="object")throw ERR_INVALID_ARG_TYPE2("options","Object",n);super(t,n),this.code="ABORT_ERR",this.name="AbortError"}},Object.defineProperties(EventEmitter,{captureRejections:{get(){return EventEmitterPrototype[kCapture]},set(r){validateBoolean(r,"EventEmitter.captureRejections"),EventEmitterPrototype[kCapture]=r},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>defaultMaxListeners,set:r=>{validateNumber2(r,"defaultMaxListeners",0),defaultMaxListeners=r}},kMaxEventTargetListeners:{value:kMaxEventTargetListeners,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:kMaxEventTargetListenersWarned,enumerable:!1,configurable:!1,writable:!1}}),Object.assign(EventEmitter,{once:once2,getEventListeners,getMaxListeners:getMaxListeners2,setMaxListeners:setMaxListeners2,EventEmitter,usingDomains:!1,captureRejectionSymbol,errorMonitor:kErrorMonitor,addAbortListener,init:EventEmitter,listenerCount:listenerCount2}),events_default=EventEmitter}),require_stream=__commonJS((r,t)=>{var n=(Q,$e)=>()=>($e||Q(($e={exports:{}}).exports,$e),$e.exports),s=n((Q,$e)=>{class ve extends Error{constructor(B){if(!Array.isArray(B))throw new TypeError(`Expected input to be an Array, got ${typeof B}`);let oe="";for(let Ue=0;Ue<B.length;Ue++)oe+=`    ${B[Ue].stack}
`;super(oe),this.name="AggregateError",this.errors=B}}$e.exports={AggregateError:ve,ArrayIsArray(re){return Array.isArray(re)},ArrayPrototypeIncludes(re,B){return re.includes(B)},ArrayPrototypeIndexOf(re,B){return re.indexOf(B)},ArrayPrototypeJoin(re,B){return re.join(B)},ArrayPrototypeMap(re,B){return re.map(B)},ArrayPrototypePop(re,B){return re.pop(B)},ArrayPrototypePush(re,B){return re.push(B)},ArrayPrototypeSlice(re,B,oe){return re.slice(B,oe)},Error,FunctionPrototypeCall(re,B,...oe){return re.call(B,...oe)},FunctionPrototypeSymbolHasInstance(re,B){return Function.prototype[Symbol.hasInstance].call(re,B)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(re,B){return Object.defineProperties(re,B)},ObjectDefineProperty(re,B,oe){return Object.defineProperty(re,B,oe)},ObjectGetOwnPropertyDescriptor(re,B){return Object.getOwnPropertyDescriptor(re,B)},ObjectKeys(re){return Object.keys(re)},ObjectSetPrototypeOf(re,B){return Object.setPrototypeOf(re,B)},Promise,PromisePrototypeCatch(re,B){return re.catch(B)},PromisePrototypeThen(re,B,oe){return re.then(B,oe)},PromiseReject(re){return Promise.reject(re)},PromiseResolve(re){return Promise.resolve(re)},ReflectApply:Reflect.apply,RegExpPrototypeTest(re,B){return re.test(B)},SafeSet:Set,String,StringPrototypeSlice(re,B,oe){return re.slice(B,oe)},StringPrototypeToLowerCase(re){return re.toLowerCase()},StringPrototypeToUpperCase(re){return re.toUpperCase()},StringPrototypeTrim(re){return re.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(re,B,oe){return re.set(B,oe)},Boolean,Uint8Array}}),o=n((Q,$e)=>{$e.exports={format(ve,...re){return ve.replace(/%([sdifj])/g,function(...[B,oe]){let Ue=re.shift();return oe==="f"?Ue.toFixed(6):oe==="j"?JSON.stringify(Ue):oe==="s"&&typeof Ue=="object"?`${Ue.constructor!==Object?Ue.constructor.name:""} {}`.trim():Ue.toString()})},inspect(ve){switch(typeof ve){case"string":if(ve.includes("'"))if(ve.includes('"')){if(!ve.includes("`")&&!ve.includes("${"))return`\`${ve}\``}else return`"${ve}"`;return`'${ve}'`;case"number":return isNaN(ve)?"NaN":Object.is(ve,-0)?String(ve):ve;case"bigint":return`${String(ve)}n`;case"boolean":case"undefined":return String(ve);case"object":return"{}"}}}}),a=n((Q,$e)=>{var{format:ve,inspect:re}=o(),{AggregateError:B}=s(),oe=globalThis.AggregateError||B,Ue=Symbol("kIsNodeError"),Ze=["string","function","number","object","Function","Object","boolean","bigint","symbol"],lt=/^([A-Z][a-z0-9]*)+$/,St={};function Mt(sr,er){if(!sr)throw new St.ERR_INTERNAL_ASSERTION(er)}function Ft(sr){let er="",Xt=sr.length,nr=sr[0]==="-"?1:0;for(;Xt>=nr+4;Xt-=3)er=`_${sr.slice(Xt-3,Xt)}${er}`;return`${sr.slice(0,Xt)}${er}`}function Zt(sr,er,Xt){if(typeof er=="function")return Mt(er.length<=Xt.length,`Code: ${sr}; The provided arguments length (${Xt.length}) does not match the required ones (${er.length}).`),er(...Xt);let nr=(er.match(/%[dfijoOs]/g)||[]).length;return Mt(nr===Xt.length,`Code: ${sr}; The provided arguments length (${Xt.length}) does not match the required ones (${nr}).`),Xt.length===0?er:ve(er,...Xt)}function Ut(sr,er,Xt){Xt||(Xt=Error);class nr extends Xt{constructor(...Ar){super(Zt(sr,er,Ar))}toString(){return`${this.name} [${sr}]: ${this.message}`}}Object.defineProperties(nr.prototype,{name:{value:Xt.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${sr}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),nr.prototype.code=sr,nr.prototype[Ue]=!0,St[sr]=nr}function vr(sr){let er="__node_internal_"+sr.name;return Object.defineProperty(sr,"name",{value:er}),sr}function zr(sr,er){if(sr&&er&&sr!==er){if(Array.isArray(er.errors))return er.errors.push(sr),er;let Xt=new oe([er,sr],er.message);return Xt.code=er.code,Xt}return sr||er}class or extends Error{constructor(er="The operation was aborted",Xt=void 0){if(Xt!==void 0&&typeof Xt!="object")throw new St.ERR_INVALID_ARG_TYPE("options","Object",Xt);super(er,Xt),this.code="ABORT_ERR",this.name="AbortError"}}Ut("ERR_ASSERTION","%s",Error),Ut("ERR_INVALID_ARG_TYPE",(sr,er,Xt)=>{Mt(typeof sr=="string","'name' must be a string"),!Array.isArray(er)&&(er=[er]);let nr="The ";sr.endsWith(" argument")?nr+=`${sr} `:nr+=`"${sr}" ${sr.includes(".")?"property":"argument"} `,nr+="must be ";let Fr=[],Ar=[],qr=[];for(let Mr of er)Mt(typeof Mr=="string","All expected entries have to be of type string"),Ze.includes(Mr)?Fr.push(Mr.toLowerCase()):lt.test(Mr)?Ar.push(Mr):(Mt(Mr!=="object",'The value "object" should be written as "Object"'),qr.push(Mr));if(Ar.length>0){let Mr=Fr.indexOf("object");Mr!==-1&&(Fr.splice(Fr,Mr,1),Ar.push("Object"))}if(Fr.length>0){switch(Fr.length){case 1:nr+=`of type ${Fr[0]}`;break;case 2:nr+=`one of type ${Fr[0]} or ${Fr[1]}`;break;default:{let Mr=Fr.pop();nr+=`one of type ${Fr.join(", ")}, or ${Mr}`}}(Ar.length>0||qr.length>0)&&(nr+=" or ")}if(Ar.length>0){switch(Ar.length){case 1:nr+=`an instance of ${Ar[0]}`;break;case 2:nr+=`an instance of ${Ar[0]} or ${Ar[1]}`;break;default:{let Mr=Ar.pop();nr+=`an instance of ${Ar.join(", ")}, or ${Mr}`}}qr.length>0&&(nr+=" or ")}switch(qr.length){case 0:break;case 1:qr[0].toLowerCase()!==qr[0]&&(nr+="an "),nr+=`${qr[0]}`;break;case 2:nr+=`one of ${qr[0]} or ${qr[1]}`;break;default:{let Mr=qr.pop();nr+=`one of ${qr.join(", ")}, or ${Mr}`}}if(Xt==null)nr+=`. Received ${Xt}`;else if(typeof Xt=="function"&&Xt.name)nr+=`. Received function ${Xt.name}`;else if(typeof Xt=="object"){var dn;if((dn=Xt.constructor)!==null&&dn!==void 0&&dn.name)nr+=`. Received an instance of ${Xt.constructor.name}`;else{let Mr=re(Xt,{depth:-1});nr+=`. Received ${Mr}`}}else{let Mr=re(Xt,{colors:!1});Mr.length>25&&(Mr=`${Mr.slice(0,25)}...`),nr+=`. Received type ${typeof Xt} (${Mr})`}return nr},TypeError),Ut("ERR_INVALID_ARG_VALUE",(sr,er,Xt="is invalid")=>{let nr=re(er);return nr.length>128&&(nr=nr.slice(0,128)+"..."),`The ${sr.includes(".")?"property":"argument"} '${sr}' ${Xt}. Received ${nr}`},TypeError),Ut("ERR_INVALID_RETURN_VALUE",(sr,er,Xt)=>{var nr;let Fr=Xt!=null&&(nr=Xt.constructor)!==null&&nr!==void 0&&nr.name?`instance of ${Xt.constructor.name}`:`type ${typeof Xt}`;return`Expected ${sr} to be returned from the "${er}" function but got ${Fr}.`},TypeError),Ut("ERR_MISSING_ARGS",(...sr)=>{Mt(sr.length>0,"At least one arg needs to be specified");let er,Xt=sr.length;switch(sr=(Array.isArray(sr)?sr:[sr]).map(nr=>`"${nr}"`).join(" or "),Xt){case 1:er+=`The ${sr[0]} argument`;break;case 2:er+=`The ${sr[0]} and ${sr[1]} arguments`;break;default:{let nr=sr.pop();er+=`The ${sr.join(", ")}, and ${nr} arguments`}break}return`${er} must be specified`},TypeError),Ut("ERR_OUT_OF_RANGE",(sr,er,Xt)=>{Mt(er,'Missing "range" argument');let nr;if(Number.isInteger(Xt)&&Math.abs(Xt)>4294967296)nr=Ft(String(Xt));else if(typeof Xt=="bigint"){nr=String(Xt);let Fr=BigInt(2)**BigInt(32);(Xt>Fr||Xt<-Fr)&&(nr=Ft(nr)),nr+="n"}else nr=re(Xt);return`The value of "${sr}" is out of range. It must be ${er}. Received ${nr}`},RangeError),Ut("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),Ut("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),Ut("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),Ut("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),Ut("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),Ut("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),Ut("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),Ut("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),Ut("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),Ut("ERR_STREAM_WRITE_AFTER_END","write after end",Error),Ut("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),$e.exports={AbortError:or,aggregateTwoErrors:vr(zr),hideStackFrames:vr,codes:St}}),c=n((Q,$e)=>{Object.defineProperty(Q,"__esModule",{value:!0});var ve=new WeakMap,re=new WeakMap;function B(gr){let en=ve.get(gr);return console.assert(en!=null,"'this' is expected an Event object, but got",gr),en}function oe(gr){if(gr.passiveListener!=null){typeof console<"u"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",gr.passiveListener);return}gr.event.cancelable&&(gr.canceled=!0,typeof gr.event.preventDefault=="function"&&gr.event.preventDefault())}function Ue(gr,en){ve.set(this,{eventTarget:gr,event:en,eventPhase:2,currentTarget:gr,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:en.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let ur=Object.keys(en);for(let ar=0;ar<ur.length;++ar){let Nr=ur[ar];Nr in this||Object.defineProperty(this,Nr,Ze(Nr))}}Ue.prototype={get type(){return B(this).event.type},get target(){return B(this).eventTarget},get currentTarget(){return B(this).currentTarget},composedPath(){let gr=B(this).currentTarget;return gr==null?[]:[gr]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return B(this).eventPhase},stopPropagation(){let gr=B(this);gr.stopped=!0,typeof gr.event.stopPropagation=="function"&&gr.event.stopPropagation()},stopImmediatePropagation(){let gr=B(this);gr.stopped=!0,gr.immediateStopped=!0,typeof gr.event.stopImmediatePropagation=="function"&&gr.event.stopImmediatePropagation()},get bubbles(){return!!B(this).event.bubbles},get cancelable(){return!!B(this).event.cancelable},preventDefault(){oe(B(this))},get defaultPrevented(){return B(this).canceled},get composed(){return!!B(this).event.composed},get timeStamp(){return B(this).timeStamp},get srcElement(){return B(this).eventTarget},get cancelBubble(){return B(this).stopped},set cancelBubble(gr){if(!gr)return;let en=B(this);en.stopped=!0,typeof en.event.cancelBubble=="boolean"&&(en.event.cancelBubble=!0)},get returnValue(){return!B(this).canceled},set returnValue(gr){gr||oe(B(this))},initEvent(){}},Object.defineProperty(Ue.prototype,"constructor",{value:Ue,configurable:!0,writable:!0}),typeof window<"u"&&typeof window.Event<"u"&&(Object.setPrototypeOf(Ue.prototype,window.Event.prototype),re.set(window.Event.prototype,Ue));function Ze(gr){return{get(){return B(this).event[gr]},set(en){B(this).event[gr]=en},configurable:!0,enumerable:!0}}function lt(gr){return{value(){let en=B(this).event;return en[gr].apply(en,arguments)},configurable:!0,enumerable:!0}}function St(gr,en){let ur=Object.keys(en);if(ur.length===0)return gr;function ar(Nr,Yt){gr.call(this,Nr,Yt)}ar.prototype=Object.create(gr.prototype,{constructor:{value:ar,configurable:!0,writable:!0}});for(let Nr=0;Nr<ur.length;++Nr){let Yt=ur[Nr];if(!(Yt in gr.prototype)){let Ir=typeof Object.getOwnPropertyDescriptor(en,Yt).value=="function";Object.defineProperty(ar.prototype,Yt,Ir?lt(Yt):Ze(Yt))}}return ar}function Mt(gr){if(gr==null||gr===Object.prototype)return Ue;let en=re.get(gr);return en==null&&(en=St(Mt(Object.getPrototypeOf(gr)),gr),re.set(gr,en)),en}function Ft(gr,en){return new(Mt(Object.getPrototypeOf(en)))(gr,en)}function Zt(gr){return B(gr).immediateStopped}function Ut(gr,en){B(gr).eventPhase=en}function vr(gr,en){B(gr).currentTarget=en}function zr(gr,en){B(gr).passiveListener=en}var or=new WeakMap,sr=1,er=2,Xt=3;function nr(gr){return gr!==null&&typeof gr=="object"}function Fr(gr){let en=or.get(gr);if(en==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return en}function Ar(gr){return{get(){let en=Fr(this).get(gr);for(;en!=null;){if(en.listenerType===Xt)return en.listener;en=en.next}return null},set(en){typeof en!="function"&&!nr(en)&&(en=null);let ur=Fr(this),ar=null,Nr=ur.get(gr);for(;Nr!=null;)Nr.listenerType===Xt?ar!==null?ar.next=Nr.next:Nr.next!==null?ur.set(gr,Nr.next):ur.delete(gr):ar=Nr,Nr=Nr.next;if(en!==null){let Yt={listener:en,listenerType:Xt,passive:!1,once:!1,next:null};ar===null?ur.set(gr,Yt):ar.next=Yt}},configurable:!0,enumerable:!0}}function qr(gr,en){Object.defineProperty(gr,`on${en}`,Ar(en))}function dn(gr){function en(){Mr.call(this)}en.prototype=Object.create(Mr.prototype,{constructor:{value:en,configurable:!0,writable:!0}});for(let ur=0;ur<gr.length;++ur)qr(en.prototype,gr[ur]);return en}function Mr(){if(this instanceof Mr){or.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return dn(arguments[0]);if(arguments.length>0){let gr=new Array(arguments.length);for(let en=0;en<arguments.length;++en)gr[en]=arguments[en];return dn(gr)}throw new TypeError("Cannot call a class as a function")}Mr.prototype={addEventListener(gr,en,ur){if(en==null)return;if(typeof en!="function"&&!nr(en))throw new TypeError("'listener' should be a function or an object.");let ar=Fr(this),Nr=nr(ur),Yt=(Nr?ur.capture:ur)?sr:er,Ir={listener:en,listenerType:Yt,passive:Nr&&!!ur.passive,once:Nr&&!!ur.once,next:null},Qe=ar.get(gr);if(Qe===void 0){ar.set(gr,Ir);return}let nt=null;for(;Qe!=null;){if(Qe.listener===en&&Qe.listenerType===Yt)return;nt=Qe,Qe=Qe.next}nt.next=Ir},removeEventListener(gr,en,ur){if(en==null)return;let ar=Fr(this),Nr=(nr(ur)?ur.capture:ur)?sr:er,Yt=null,Ir=ar.get(gr);for(;Ir!=null;){if(Ir.listener===en&&Ir.listenerType===Nr){Yt!==null?Yt.next=Ir.next:Ir.next!==null?ar.set(gr,Ir.next):ar.delete(gr);return}Yt=Ir,Ir=Ir.next}},dispatchEvent(gr){if(gr==null||typeof gr.type!="string")throw new TypeError('"event.type" should be a string.');let en=Fr(this),ur=gr.type,ar=en.get(ur);if(ar==null)return!0;let Nr=Ft(this,gr),Yt=null;for(;ar!=null;){if(ar.once?Yt!==null?Yt.next=ar.next:ar.next!==null?en.set(ur,ar.next):en.delete(ur):Yt=ar,zr(Nr,ar.passive?ar.listener:null),typeof ar.listener=="function")try{ar.listener.call(this,Nr)}catch(Ir){typeof console<"u"&&typeof console.error=="function"&&console.error(Ir)}else ar.listenerType!==Xt&&typeof ar.listener.handleEvent=="function"&&ar.listener.handleEvent(Nr);if(Zt(Nr))break;ar=ar.next}return zr(Nr,null),Ut(Nr,0),vr(Nr,null),!Nr.defaultPrevented}},Object.defineProperty(Mr.prototype,"constructor",{value:Mr,configurable:!0,writable:!0}),typeof window<"u"&&typeof window.EventTarget<"u"&&Object.setPrototypeOf(Mr.prototype,window.EventTarget.prototype),Q.defineEventAttribute=qr,Q.EventTarget=Mr,Q.default=Mr,$e.exports=Mr,$e.exports.EventTarget=$e.exports.default=Mr,$e.exports.defineEventAttribute=qr}),f=n((Q,$e)=>{Object.defineProperty(Q,"__esModule",{value:!0});var ve=c();class re extends ve.EventTarget{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){let Ft=Ue.get(this);if(typeof Ft!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return Ft}}ve.defineEventAttribute(re.prototype,"abort");function B(){let Mt=Object.create(re.prototype);return ve.EventTarget.call(Mt),Ue.set(Mt,!1),Mt}function oe(Mt){Ue.get(Mt)===!1&&(Ue.set(Mt,!0),Mt.dispatchEvent({type:"abort"}))}var Ue=new WeakMap;Object.defineProperties(re.prototype,{aborted:{enumerable:!0}}),typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(re.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class Ze{constructor(){lt.set(this,B())}get signal(){return St(this)}abort(){oe(St(this))}}var lt=new WeakMap;function St(Mt){let Ft=lt.get(Mt);if(Ft==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${Mt===null?"null":typeof Mt}`);return Ft}Object.defineProperties(Ze.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ze.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),Q.AbortController=Ze,Q.AbortSignal=re,Q.default=Ze,$e.exports=Ze,$e.exports.AbortController=$e.exports.default=Ze,$e.exports.AbortSignal=re}),g=n((Q,$e)=>{var ve=(init_buffer(),__toCommonJS(exports_buffer)),{format:re,inspect:B}=o(),{codes:{ERR_INVALID_ARG_TYPE:oe}}=a(),{kResistStopPropagation:Ue,AggregateError:Ze,SymbolDispose:lt}=s(),St=globalThis.AbortSignal||f().AbortSignal,Mt=globalThis.AbortController||f().AbortController,Ft=Object.getPrototypeOf(async function(){}).constructor,Zt=globalThis.Blob||ve.Blob,Ut=typeof Zt<"u"?function(sr){return sr instanceof Zt}:function(sr){return!1},vr=(or,sr)=>{if(or!==void 0&&(or===null||typeof or!="object"||!("aborted"in or)))throw new oe(sr,"AbortSignal",or)},zr=(or,sr)=>{if(typeof or!="function")throw new oe(sr,"Function",or)};$e.exports={AggregateError:Ze,kEmptyObject:Object.freeze({}),once(or){let sr=!1;return function(...er){sr||(sr=!0,or.apply(this,er))}},createDeferredPromise:function(){let or,sr;return{promise:new Promise((er,Xt)=>{or=er,sr=Xt}),resolve:or,reject:sr}},promisify(or){return new Promise((sr,er)=>{or((Xt,...nr)=>Xt?er(Xt):sr(...nr))})},debuglog(){return function(){}},format:re,inspect:B,types:{isAsyncFunction(or){return or instanceof Ft},isArrayBufferView(or){return ArrayBuffer.isView(or)}},isBlob:Ut,deprecate(or,sr){return or},addAbortListener:(init_events(),__toCommonJS(exports_events)).addAbortListener||function(sr,er){if(sr===void 0)throw new oe("signal","AbortSignal",sr);vr(sr,"signal"),zr(er,"listener");let Xt;return sr.aborted?queueMicrotask(()=>er()):(sr.addEventListener("abort",er,{__proto__:null,once:!0,[Ue]:!0}),Xt=()=>{sr.removeEventListener("abort",er)}),{__proto__:null,[lt](){var nr;(nr=Xt)===null||nr===void 0||nr()}}},AbortSignalAny:St.any||function(sr){if(sr.length===1)return sr[0];let er=new Mt,Xt=()=>er.abort();return sr.forEach(nr=>{vr(nr,"signals"),nr.addEventListener("abort",Xt,{once:!0})}),er.signal.addEventListener("abort",()=>{sr.forEach(nr=>nr.removeEventListener("abort",Xt))},{once:!0}),er.signal}},$e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),b=n((Q,$e)=>{var{ArrayIsArray:ve,ArrayPrototypeIncludes:re,ArrayPrototypeJoin:B,ArrayPrototypeMap:oe,NumberIsInteger:Ue,NumberIsNaN:Ze,NumberMAX_SAFE_INTEGER:lt,NumberMIN_SAFE_INTEGER:St,NumberParseInt:Mt,ObjectPrototypeHasOwnProperty:Ft,RegExpPrototypeExec:Zt,String:Ut,StringPrototypeToUpperCase:vr,StringPrototypeTrim:zr}=s(),{hideStackFrames:or,codes:{ERR_SOCKET_BAD_PORT:sr,ERR_INVALID_ARG_TYPE:er,ERR_INVALID_ARG_VALUE:Xt,ERR_OUT_OF_RANGE:nr,ERR_UNKNOWN_SIGNAL:Fr}}=a(),{normalizeEncoding:Ar}=g(),{isAsyncFunction:qr,isArrayBufferView:dn}=g().types,Mr={};function gr(cr){return cr===(cr|0)}function en(cr){return cr===cr>>>0}var ur=/^[0-7]+$/,ar="must be a 32-bit unsigned integer or an octal string";function Nr(cr,Sr,Lr){if(typeof cr>"u"&&(cr=Lr),typeof cr=="string"){if(Zt(ur,cr)===null)throw new Xt(Sr,cr,ar);cr=Mt(cr,8)}return Qe(cr,Sr),cr}var Yt=or((cr,Sr,Lr=St,Qr=lt)=>{if(typeof cr!="number")throw new er(Sr,"number",cr);if(!Ue(cr))throw new nr(Sr,"an integer",cr);if(cr<Lr||cr>Qr)throw new nr(Sr,`>= ${Lr} && <= ${Qr}`,cr)}),Ir=or((cr,Sr,Lr=-2147483648,Qr=2147483647)=>{if(typeof cr!="number")throw new er(Sr,"number",cr);if(!Ue(cr))throw new nr(Sr,"an integer",cr);if(cr<Lr||cr>Qr)throw new nr(Sr,`>= ${Lr} && <= ${Qr}`,cr)}),Qe=or((cr,Sr,Lr=!1)=>{if(typeof cr!="number")throw new er(Sr,"number",cr);if(!Ue(cr))throw new nr(Sr,"an integer",cr);let Qr=Lr?1:0,tn=4294967295;if(cr<Qr||cr>tn)throw new nr(Sr,`>= ${Qr} && <= ${tn}`,cr)});function nt(cr,Sr){if(typeof cr!="string")throw new er(Sr,"string",cr)}function _t(cr,Sr,Lr=void 0,Qr){if(typeof cr!="number")throw new er(Sr,"number",cr);if(Lr!=null&&cr<Lr||Qr!=null&&cr>Qr||(Lr!=null||Qr!=null)&&Ze(cr))throw new nr(Sr,`${Lr!=null?`>= ${Lr}`:""}${Lr!=null&&Qr!=null?" && ":""}${Qr!=null?`<= ${Qr}`:""}`,cr)}var Bt=or((cr,Sr,Lr)=>{if(!re(Lr,cr)){let Qr="must be one of: "+B(oe(Lr,tn=>typeof tn=="string"?`'${tn}'`:Ut(tn)),", ");throw new Xt(Sr,cr,Qr)}});function Jt(cr,Sr){if(typeof cr!="boolean")throw new er(Sr,"boolean",cr)}function xt(cr,Sr,Lr){return cr==null||!Ft(cr,Sr)?Lr:cr[Sr]}var mr=or((cr,Sr,Lr=null)=>{let Qr=xt(Lr,"allowArray",!1),tn=xt(Lr,"allowFunction",!1);if(!xt(Lr,"nullable",!1)&&cr===null||!Qr&&ve(cr)||typeof cr!="object"&&(!tn||typeof cr!="function"))throw new er(Sr,"Object",cr)}),xr=or((cr,Sr)=>{if(cr!=null&&typeof cr!="object"&&typeof cr!="function")throw new er(Sr,"a dictionary",cr)}),wr=or((cr,Sr,Lr=0)=>{if(!ve(cr))throw new er(Sr,"Array",cr);if(cr.length<Lr){let Qr=`must be longer than ${Lr}`;throw new Xt(Sr,cr,Qr)}});function nn(cr,Sr){wr(cr,Sr);for(let Lr=0;Lr<cr.length;Lr++)nt(cr[Lr],`${Sr}[${Lr}]`)}function Cr(cr,Sr){wr(cr,Sr);for(let Lr=0;Lr<cr.length;Lr++)Jt(cr[Lr],`${Sr}[${Lr}]`)}function Zr(cr,Sr){wr(cr,Sr);for(let Lr=0;Lr<cr.length;Lr++){let Qr=cr[Lr],tn=`${Sr}[${Lr}]`;if(Qr==null)throw new er(tn,"AbortSignal",Qr);Jr(Qr,tn)}}function pn(cr,Sr="signal"){if(nt(cr,Sr),Mr[cr]===void 0)throw Mr[vr(cr)]!==void 0?new Fr(cr+" (signals must use all capital letters)"):new Fr(cr)}var yr=or((cr,Sr="buffer")=>{if(!dn(cr))throw new er(Sr,["Buffer","TypedArray","DataView"],cr)});function Tr(cr,Sr){let Lr=Ar(Sr),Qr=cr.length;if(Lr==="hex"&&Qr%2!==0)throw new Xt("encoding",Sr,`is invalid for data of length ${Qr}`)}function Br(cr,Sr="Port",Lr=!0){if(typeof cr!="number"&&typeof cr!="string"||typeof cr=="string"&&zr(cr).length===0||+cr!==+cr>>>0||cr>65535||cr===0&&!Lr)throw new sr(Sr,cr,Lr);return cr|0}var Jr=or((cr,Sr)=>{if(cr!==void 0&&(cr===null||typeof cr!="object"||!("aborted"in cr)))throw new er(Sr,"AbortSignal",cr)}),rn=or((cr,Sr)=>{if(typeof cr!="function")throw new er(Sr,"Function",cr)}),dr=or((cr,Sr)=>{if(typeof cr!="function"||qr(cr))throw new er(Sr,"Function",cr)}),ir=or((cr,Sr)=>{if(cr!==void 0)throw new er(Sr,"undefined",cr)});function Er(cr,Sr,Lr){if(!re(Lr,cr))throw new er(Sr,`('${B(Lr,"|")}')`,cr)}var an=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Rr(cr,Sr){if(typeof cr>"u"||!Zt(an,cr))throw new Xt(Sr,cr,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Ur(cr){if(typeof cr=="string")return Rr(cr,"hints"),cr;if(ve(cr)){let Sr=cr.length,Lr="";if(Sr===0)return Lr;for(let Qr=0;Qr<Sr;Qr++){let tn=cr[Qr];Rr(tn,"hints"),Lr+=tn,Qr!==Sr-1&&(Lr+=", ")}return Lr}throw new Xt("hints",cr,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}$e.exports={isInt32:gr,isUint32:en,parseFileMode:Nr,validateArray:wr,validateStringArray:nn,validateBooleanArray:Cr,validateAbortSignalArray:Zr,validateBoolean:Jt,validateBuffer:yr,validateDictionary:xr,validateEncoding:Tr,validateFunction:rn,validateInt32:Ir,validateInteger:Yt,validateNumber:_t,validateObject:mr,validateOneOf:Bt,validatePlainFunction:dr,validatePort:Br,validateSignalName:pn,validateString:nt,validateUint32:Qe,validateUndefined:ir,validateUnion:Er,validateAbortSignal:Jr,validateLinkHeaderValue:Ur}}),_=n((Q,$e)=>{$e.exports=globalThis.process}),L=n((Q,$e)=>{var{SymbolAsyncIterator:ve,SymbolIterator:re,SymbolFor:B}=s(),oe=B("nodejs.stream.destroyed"),Ue=B("nodejs.stream.errored"),Ze=B("nodejs.stream.readable"),lt=B("nodejs.stream.writable"),St=B("nodejs.stream.disturbed"),Mt=B("nodejs.webstream.isClosedPromise"),Ft=B("nodejs.webstream.controllerErrorFunction");function Zt(xt,mr=!1){var xr;return!!(xt&&typeof xt.pipe=="function"&&typeof xt.on=="function"&&(!mr||typeof xt.pause=="function"&&typeof xt.resume=="function")&&(!xt._writableState||((xr=xt._readableState)===null||xr===void 0?void 0:xr.readable)!==!1)&&(!xt._writableState||xt._readableState))}function Ut(xt){var mr;return!!(xt&&typeof xt.write=="function"&&typeof xt.on=="function"&&(!xt._readableState||((mr=xt._writableState)===null||mr===void 0?void 0:mr.writable)!==!1))}function vr(xt){return!!(xt&&typeof xt.pipe=="function"&&xt._readableState&&typeof xt.on=="function"&&typeof xt.write=="function")}function zr(xt){return xt&&(xt._readableState||xt._writableState||typeof xt.write=="function"&&typeof xt.on=="function"||typeof xt.pipe=="function"&&typeof xt.on=="function")}function or(xt){return!!(xt&&!zr(xt)&&typeof xt.pipeThrough=="function"&&typeof xt.getReader=="function"&&typeof xt.cancel=="function")}function sr(xt){return!!(xt&&!zr(xt)&&typeof xt.getWriter=="function"&&typeof xt.abort=="function")}function er(xt){return!!(xt&&!zr(xt)&&typeof xt.readable=="object"&&typeof xt.writable=="object")}function Xt(xt){return or(xt)||sr(xt)||er(xt)}function nr(xt,mr){return xt==null?!1:mr===!0?typeof xt[ve]=="function":mr===!1?typeof xt[re]=="function":typeof xt[ve]=="function"||typeof xt[re]=="function"}function Fr(xt){if(!zr(xt))return null;let{_writableState:mr,_readableState:xr}=xt,wr=mr||xr;return!!(xt.destroyed||xt[oe]||wr!=null&&wr.destroyed)}function Ar(xt){if(!Ut(xt))return null;if(xt.writableEnded===!0)return!0;let mr=xt._writableState;return mr!=null&&mr.errored?!1:typeof mr?.ended!="boolean"?null:mr.ended}function qr(xt,mr){if(!Ut(xt))return null;if(xt.writableFinished===!0)return!0;let xr=xt._writableState;return xr!=null&&xr.errored?!1:typeof xr?.finished!="boolean"?null:!!(xr.finished||mr===!1&&xr.ended===!0&&xr.length===0)}function dn(xt){if(!Zt(xt))return null;if(xt.readableEnded===!0)return!0;let mr=xt._readableState;return!mr||mr.errored?!1:typeof mr?.ended!="boolean"?null:mr.ended}function Mr(xt,mr){if(!Zt(xt))return null;let xr=xt._readableState;return xr!=null&&xr.errored?!1:typeof xr?.endEmitted!="boolean"?null:!!(xr.endEmitted||mr===!1&&xr.ended===!0&&xr.length===0)}function gr(xt){return xt&&xt[Ze]!=null?xt[Ze]:typeof xt?.readable!="boolean"?null:Fr(xt)?!1:Zt(xt)&&xt.readable&&!Mr(xt)}function en(xt){return xt&&xt[lt]!=null?xt[lt]:typeof xt?.writable!="boolean"?null:Fr(xt)?!1:Ut(xt)&&xt.writable&&!Ar(xt)}function ur(xt,mr){return zr(xt)?Fr(xt)?!0:!(mr?.readable!==!1&&gr(xt)||mr?.writable!==!1&&en(xt)):null}function ar(xt){var mr,xr;return zr(xt)?xt.writableErrored?xt.writableErrored:(mr=(xr=xt._writableState)===null||xr===void 0?void 0:xr.errored)!==null&&mr!==void 0?mr:null:null}function Nr(xt){var mr,xr;return zr(xt)?xt.readableErrored?xt.readableErrored:(mr=(xr=xt._readableState)===null||xr===void 0?void 0:xr.errored)!==null&&mr!==void 0?mr:null:null}function Yt(xt){if(!zr(xt))return null;if(typeof xt.closed=="boolean")return xt.closed;let{_writableState:mr,_readableState:xr}=xt;return typeof mr?.closed=="boolean"||typeof xr?.closed=="boolean"?mr?.closed||xr?.closed:typeof xt._closed=="boolean"&&Ir(xt)?xt._closed:null}function Ir(xt){return typeof xt._closed=="boolean"&&typeof xt._defaultKeepAlive=="boolean"&&typeof xt._removedConnection=="boolean"&&typeof xt._removedContLen=="boolean"}function Qe(xt){return typeof xt._sent100=="boolean"&&Ir(xt)}function nt(xt){var mr;return typeof xt._consuming=="boolean"&&typeof xt._dumped=="boolean"&&((mr=xt.req)===null||mr===void 0?void 0:mr.upgradeOrConnect)===void 0}function _t(xt){if(!zr(xt))return null;let{_writableState:mr,_readableState:xr}=xt,wr=mr||xr;return!wr&&Qe(xt)||!!(wr&&wr.autoDestroy&&wr.emitClose&&wr.closed===!1)}function Bt(xt){var mr;return!!(xt&&((mr=xt[St])!==null&&mr!==void 0?mr:xt.readableDidRead||xt.readableAborted))}function Jt(xt){var mr,xr,wr,nn,Cr,Zr,pn,yr,Tr,Br;return!!(xt&&((mr=(xr=(wr=(nn=(Cr=(Zr=xt[Ue])!==null&&Zr!==void 0?Zr:xt.readableErrored)!==null&&Cr!==void 0?Cr:xt.writableErrored)!==null&&nn!==void 0?nn:(pn=xt._readableState)===null||pn===void 0?void 0:pn.errorEmitted)!==null&&wr!==void 0?wr:(yr=xt._writableState)===null||yr===void 0?void 0:yr.errorEmitted)!==null&&xr!==void 0?xr:(Tr=xt._readableState)===null||Tr===void 0?void 0:Tr.errored)!==null&&mr!==void 0?mr:!((Br=xt._writableState)===null||Br===void 0)&&Br.errored))}$e.exports={isDestroyed:Fr,kIsDestroyed:oe,isDisturbed:Bt,kIsDisturbed:St,isErrored:Jt,kIsErrored:Ue,isReadable:gr,kIsReadable:Ze,kIsClosedPromise:Mt,kControllerErrorFunction:Ft,kIsWritable:lt,isClosed:Yt,isDuplexNodeStream:vr,isFinished:ur,isIterable:nr,isReadableNodeStream:Zt,isReadableStream:or,isReadableEnded:dn,isReadableFinished:Mr,isReadableErrored:Nr,isNodeStream:zr,isWebStream:Xt,isWritable:en,isWritableNodeStream:Ut,isWritableStream:sr,isWritableEnded:Ar,isWritableFinished:qr,isWritableErrored:ar,isServerRequest:nt,isServerResponse:Qe,willEmitClose:_t,isTransformStream:er}}),q=n((Q,$e)=>{var ve=_(),{AbortError:re,codes:B}=a(),{ERR_INVALID_ARG_TYPE:oe,ERR_STREAM_PREMATURE_CLOSE:Ue}=B,{kEmptyObject:Ze,once:lt}=g(),{validateAbortSignal:St,validateFunction:Mt,validateObject:Ft,validateBoolean:Zt}=b(),{Promise:Ut,PromisePrototypeThen:vr,SymbolDispose:zr}=s(),{isClosed:or,isReadable:sr,isReadableNodeStream:er,isReadableStream:Xt,isReadableFinished:nr,isReadableErrored:Fr,isWritable:Ar,isWritableNodeStream:qr,isWritableStream:dn,isWritableFinished:Mr,isWritableErrored:gr,isNodeStream:en,willEmitClose:ur,kIsClosedPromise:ar}=L(),Nr;function Yt(Bt){return Bt.setHeader&&typeof Bt.abort=="function"}var Ir=()=>{};function Qe(Bt,Jt,xt){var mr,xr;if(arguments.length===2?(xt=Jt,Jt=Ze):Jt==null?Jt=Ze:Ft(Jt,"options"),Mt(xt,"callback"),St(Jt.signal,"options.signal"),xt=lt(xt),Xt(Bt)||dn(Bt))return nt(Bt,Jt,xt);if(!en(Bt))throw new oe("stream",["ReadableStream","WritableStream","Stream"],Bt);let wr=(mr=Jt.readable)!==null&&mr!==void 0?mr:er(Bt),nn=(xr=Jt.writable)!==null&&xr!==void 0?xr:qr(Bt),Cr=Bt._writableState,Zr=Bt._readableState,pn=()=>{Bt.writable||Br()},yr=ur(Bt)&&er(Bt)===wr&&qr(Bt)===nn,Tr=Mr(Bt,!1),Br=()=>{Tr=!0,Bt.destroyed&&(yr=!1),!(yr&&(!Bt.readable||wr))&&(!wr||Jr)&&xt.call(Bt)},Jr=nr(Bt,!1),rn=()=>{Jr=!0,Bt.destroyed&&(yr=!1),!(yr&&(!Bt.writable||nn))&&(!nn||Tr)&&xt.call(Bt)},dr=cr=>{xt.call(Bt,cr)},ir=or(Bt),Er=()=>{ir=!0;let cr=gr(Bt)||Fr(Bt);if(cr&&typeof cr!="boolean")return xt.call(Bt,cr);if(wr&&!Jr&&er(Bt,!0)&&!nr(Bt,!1))return xt.call(Bt,new Ue);if(nn&&!Tr&&!Mr(Bt,!1))return xt.call(Bt,new Ue);xt.call(Bt)},an=()=>{ir=!0;let cr=gr(Bt)||Fr(Bt);if(cr&&typeof cr!="boolean")return xt.call(Bt,cr);xt.call(Bt)},Rr=()=>{Bt.req.on("finish",Br)};Yt(Bt)?(Bt.on("complete",Br),!yr&&Bt.on("abort",Er),Bt.req?Rr():Bt.on("request",Rr)):nn&&!Cr&&(Bt.on("end",pn),Bt.on("close",pn)),!yr&&typeof Bt.aborted=="boolean"&&Bt.on("aborted",Er),Bt.on("end",rn),Bt.on("finish",Br),Jt.error!==!1&&Bt.on("error",dr),Bt.on("close",Er),ir?ve.nextTick(Er):Cr!=null&&Cr.errorEmitted||Zr!=null&&Zr.errorEmitted?yr||ve.nextTick(an):(!wr&&(!yr||sr(Bt))&&(Tr||Ar(Bt)===!1)||!nn&&(!yr||Ar(Bt))&&(Jr||sr(Bt)===!1)||Zr&&Bt.req&&Bt.aborted)&&ve.nextTick(an);let Ur=()=>{xt=Ir,Bt.removeListener("aborted",Er),Bt.removeListener("complete",Br),Bt.removeListener("abort",Er),Bt.removeListener("request",Rr),Bt.req&&Bt.req.removeListener("finish",Br),Bt.removeListener("end",pn),Bt.removeListener("close",pn),Bt.removeListener("finish",Br),Bt.removeListener("end",rn),Bt.removeListener("error",dr),Bt.removeListener("close",Er)};if(Jt.signal&&!ir){let cr=()=>{let Sr=xt;Ur(),Sr.call(Bt,new re(void 0,{cause:Jt.signal.reason}))};if(Jt.signal.aborted)ve.nextTick(cr);else{Nr=Nr||g().addAbortListener;let Sr=Nr(Jt.signal,cr),Lr=xt;xt=lt((...Qr)=>{Sr[zr](),Lr.apply(Bt,Qr)})}}return Ur}function nt(Bt,Jt,xt){let mr=!1,xr=Ir;if(Jt.signal)if(xr=()=>{mr=!0,xt.call(Bt,new re(void 0,{cause:Jt.signal.reason}))},Jt.signal.aborted)ve.nextTick(xr);else{Nr=Nr||g().addAbortListener;let nn=Nr(Jt.signal,xr),Cr=xt;xt=lt((...Zr)=>{nn[zr](),Cr.apply(Bt,Zr)})}let wr=(...nn)=>{mr||ve.nextTick(()=>xt.apply(Bt,nn))};return vr(Bt[ar].promise,wr,wr),Ir}function _t(Bt,Jt){var xt;let mr=!1;return Jt===null&&(Jt=Ze),(xt=Jt)!==null&&xt!==void 0&&xt.cleanup&&(Zt(Jt.cleanup,"cleanup"),mr=Jt.cleanup),new Ut((xr,wr)=>{let nn=Qe(Bt,Jt,Cr=>{mr&&nn(),Cr?wr(Cr):xr()})})}$e.exports=Qe,$e.exports.finished=_t}),X=n((Q,$e)=>{var ve=_(),{aggregateTwoErrors:re,codes:{ERR_MULTIPLE_CALLBACK:B},AbortError:oe}=a(),{Symbol:Ue}=s(),{kIsDestroyed:Ze,isDestroyed:lt,isFinished:St,isServerRequest:Mt}=L(),Ft=Ue("kDestroy"),Zt=Ue("kConstruct");function Ut(ur,ar,Nr){ur&&(ur.stack,ar&&!ar.errored&&(ar.errored=ur),Nr&&!Nr.errored&&(Nr.errored=ur))}function vr(ur,ar){let Nr=this._readableState,Yt=this._writableState,Ir=Yt||Nr;return Yt!=null&&Yt.destroyed||Nr!=null&&Nr.destroyed?(typeof ar=="function"&&ar(),this):(Ut(ur,Yt,Nr),Yt&&(Yt.destroyed=!0),Nr&&(Nr.destroyed=!0),Ir.constructed?zr(this,ur,ar):this.once(Ft,function(Qe){zr(this,re(Qe,ur),ar)}),this)}function zr(ur,ar,Nr){let Yt=!1;function Ir(Qe){if(Yt)return;Yt=!0;let{_readableState:nt,_writableState:_t}=ur;Ut(Qe,_t,nt),_t&&(_t.closed=!0),nt&&(nt.closed=!0),typeof Nr=="function"&&Nr(Qe),Qe?ve.nextTick(or,ur,Qe):ve.nextTick(sr,ur)}try{ur._destroy(ar||null,Ir)}catch(Qe){Ir(Qe)}}function or(ur,ar){er(ur,ar),sr(ur)}function sr(ur){let{_readableState:ar,_writableState:Nr}=ur;Nr&&(Nr.closeEmitted=!0),ar&&(ar.closeEmitted=!0),(Nr!=null&&Nr.emitClose||ar!=null&&ar.emitClose)&&ur.emit("close")}function er(ur,ar){let{_readableState:Nr,_writableState:Yt}=ur;Yt!=null&&Yt.errorEmitted||Nr!=null&&Nr.errorEmitted||(Yt&&(Yt.errorEmitted=!0),Nr&&(Nr.errorEmitted=!0),ur.emit("error",ar))}function Xt(){let ur=this._readableState,ar=this._writableState;ur&&(ur.constructed=!0,ur.closed=!1,ur.closeEmitted=!1,ur.destroyed=!1,ur.errored=null,ur.errorEmitted=!1,ur.reading=!1,ur.ended=ur.readable===!1,ur.endEmitted=ur.readable===!1),ar&&(ar.constructed=!0,ar.destroyed=!1,ar.closed=!1,ar.closeEmitted=!1,ar.errored=null,ar.errorEmitted=!1,ar.finalCalled=!1,ar.prefinished=!1,ar.ended=ar.writable===!1,ar.ending=ar.writable===!1,ar.finished=ar.writable===!1)}function nr(ur,ar,Nr){let{_readableState:Yt,_writableState:Ir}=ur;if(Ir!=null&&Ir.destroyed||Yt!=null&&Yt.destroyed)return this;Yt!=null&&Yt.autoDestroy||Ir!=null&&Ir.autoDestroy?ur.destroy(ar):ar&&(ar.stack,Ir&&!Ir.errored&&(Ir.errored=ar),Yt&&!Yt.errored&&(Yt.errored=ar),Nr?ve.nextTick(er,ur,ar):er(ur,ar))}function Fr(ur,ar){if(typeof ur._construct!="function")return;let{_readableState:Nr,_writableState:Yt}=ur;Nr&&(Nr.constructed=!1),Yt&&(Yt.constructed=!1),ur.once(Zt,ar),!(ur.listenerCount(Zt)>1)&&ve.nextTick(Ar,ur)}function Ar(ur){let ar=!1;function Nr(Yt){if(ar){nr(ur,Yt??new B);return}ar=!0;let{_readableState:Ir,_writableState:Qe}=ur,nt=Qe||Ir;Ir&&(Ir.constructed=!0),Qe&&(Qe.constructed=!0),nt.destroyed?ur.emit(Ft,Yt):Yt?nr(ur,Yt,!0):ve.nextTick(qr,ur)}try{ur._construct(Yt=>{ve.nextTick(Nr,Yt)})}catch(Yt){ve.nextTick(Nr,Yt)}}function qr(ur){ur.emit(Zt)}function dn(ur){return ur?.setHeader&&typeof ur.abort=="function"}function Mr(ur){ur.emit("close")}function gr(ur,ar){ur.emit("error",ar),ve.nextTick(Mr,ur)}function en(ur,ar){!ur||lt(ur)||(!ar&&!St(ur)&&(ar=new oe),Mt(ur)?(ur.socket=null,ur.destroy(ar)):dn(ur)?ur.abort():dn(ur.req)?ur.req.abort():typeof ur.destroy=="function"?ur.destroy(ar):typeof ur.close=="function"?ur.close():ar?ve.nextTick(gr,ur,ar):ve.nextTick(Mr,ur),ur.destroyed||(ur[Ze]=!0))}$e.exports={construct:Fr,destroyer:en,destroy:vr,undestroy:Xt,errorOrDestroy:nr}}),te=n((Q,$e)=>{var{ArrayIsArray:ve,ObjectSetPrototypeOf:re}=s(),{EventEmitter:B}=(init_events(),__toCommonJS(exports_events));function oe(Ze){B.call(this,Ze)}re(oe.prototype,B.prototype),re(oe,B),oe.prototype.pipe=function(Ze,lt){let St=this;function Mt(sr){Ze.writable&&Ze.write(sr)===!1&&St.pause&&St.pause()}St.on("data",Mt);function Ft(){St.readable&&St.resume&&St.resume()}Ze.on("drain",Ft),!Ze._isStdio&&(!lt||lt.end!==!1)&&(St.on("end",Ut),St.on("close",vr));let Zt=!1;function Ut(){Zt||(Zt=!0,Ze.end())}function vr(){Zt||(Zt=!0,typeof Ze.destroy=="function"&&Ze.destroy())}function zr(sr){or(),B.listenerCount(this,"error")===0&&this.emit("error",sr)}Ue(St,"error",zr),Ue(Ze,"error",zr);function or(){St.removeListener("data",Mt),Ze.removeListener("drain",Ft),St.removeListener("end",Ut),St.removeListener("close",vr),St.removeListener("error",zr),Ze.removeListener("error",zr),St.removeListener("end",or),St.removeListener("close",or),Ze.removeListener("close",or)}return St.on("end",or),St.on("close",or),Ze.on("close",or),Ze.emit("pipe",St),Ze};function Ue(Ze,lt,St){if(typeof Ze.prependListener=="function")return Ze.prependListener(lt,St);!Ze._events||!Ze._events[lt]?Ze.on(lt,St):ve(Ze._events[lt])?Ze._events[lt].unshift(St):Ze._events[lt]=[St,Ze._events[lt]]}$e.exports={Stream:oe,prependListener:Ue}}),ne=n((Q,$e)=>{var{SymbolDispose:ve}=s(),{AbortError:re,codes:B}=a(),{isNodeStream:oe,isWebStream:Ue,kControllerErrorFunction:Ze}=L(),lt=q(),{ERR_INVALID_ARG_TYPE:St}=B,Mt,Ft=(Zt,Ut)=>{if(typeof Zt!="object"||!("aborted"in Zt))throw new St(Ut,"AbortSignal",Zt)};$e.exports.addAbortSignal=function(Ut,vr){if(Ft(Ut,"signal"),!oe(vr)&&!Ue(vr))throw new St("stream",["ReadableStream","WritableStream","Stream"],vr);return $e.exports.addAbortSignalNoValidate(Ut,vr)},$e.exports.addAbortSignalNoValidate=function(Zt,Ut){if(typeof Zt!="object"||!("aborted"in Zt))return Ut;let vr=oe(Ut)?()=>{Ut.destroy(new re(void 0,{cause:Zt.reason}))}:()=>{Ut[Ze](new re(void 0,{cause:Zt.reason}))};if(Zt.aborted)vr();else{Mt=Mt||g().addAbortListener;let zr=Mt(Zt,vr);lt(Ut,zr[ve])}return Ut}}),Ce=n((Q,$e)=>{var{StringPrototypeSlice:ve,SymbolIterator:re,TypedArrayPrototypeSet:B,Uint8Array:oe}=s(),{Buffer:Ue}=(init_buffer(),__toCommonJS(exports_buffer)),{inspect:Ze}=g();$e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(St){let Mt={data:St,next:null};this.length>0?this.tail.next=Mt:this.head=Mt,this.tail=Mt,++this.length}unshift(St){let Mt={data:St,next:this.head};this.length===0&&(this.tail=Mt),this.head=Mt,++this.length}shift(){if(this.length===0)return;let St=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,St}clear(){this.head=this.tail=null,this.length=0}join(St){if(this.length===0)return"";let Mt=this.head,Ft=""+Mt.data;for(;(Mt=Mt.next)!==null;)Ft+=St+Mt.data;return Ft}concat(St){if(this.length===0)return Ue.alloc(0);let Mt=Ue.allocUnsafe(St>>>0),Ft=this.head,Zt=0;for(;Ft;)B(Mt,Ft.data,Zt),Zt+=Ft.data.length,Ft=Ft.next;return Mt}consume(St,Mt){let Ft=this.head.data;if(St<Ft.length){let Zt=Ft.slice(0,St);return this.head.data=Ft.slice(St),Zt}return St===Ft.length?this.shift():Mt?this._getString(St):this._getBuffer(St)}first(){return this.head.data}*[re](){for(let St=this.head;St;St=St.next)yield St.data}_getString(St){let Mt="",Ft=this.head,Zt=0;do{let Ut=Ft.data;if(St>Ut.length)Mt+=Ut,St-=Ut.length;else{St===Ut.length?(Mt+=Ut,++Zt,Ft.next?this.head=Ft.next:this.head=this.tail=null):(Mt+=ve(Ut,0,St),this.head=Ft,Ft.data=ve(Ut,St));break}++Zt}while((Ft=Ft.next)!==null);return this.length-=Zt,Mt}_getBuffer(St){let Mt=Ue.allocUnsafe(St),Ft=St,Zt=this.head,Ut=0;do{let vr=Zt.data;if(St>vr.length)B(Mt,vr,Ft-St),St-=vr.length;else{St===vr.length?(B(Mt,vr,Ft-St),++Ut,Zt.next?this.head=Zt.next:this.head=this.tail=null):(B(Mt,new oe(vr.buffer,vr.byteOffset,St),Ft-St),this.head=Zt,Zt.data=vr.slice(St));break}++Ut}while((Zt=Zt.next)!==null);return this.length-=Ut,Mt}[Symbol.for("nodejs.util.inspect.custom")](St,Mt){return Ze(this,{...Mt,depth:0,customInspect:!1})}}}),Le=n((Q,$e)=>{var{MathFloor:ve,NumberIsInteger:re}=s(),{validateInteger:B}=b(),{ERR_INVALID_ARG_VALUE:oe}=a().codes,Ue=16384,Ze=16;function lt(Zt,Ut,vr){return Zt.highWaterMark!=null?Zt.highWaterMark:Ut?Zt[vr]:null}function St(Zt){return Zt?Ze:Ue}function Mt(Zt,Ut){B(Ut,"value",0),Zt?Ze=Ut:Ue=Ut}function Ft(Zt,Ut,vr,zr){let or=lt(Ut,zr,vr);if(or!=null){if(!re(or)||or<0){let sr=zr?`options.${vr}`:"options.highWaterMark";throw new oe(sr,or)}return ve(or)}return St(Zt.objectMode)}$e.exports={getHighWaterMark:Ft,getDefaultHighWaterMark:St,setDefaultHighWaterMark:Mt}}),Ge=n((Q,$e)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var ve=(init_buffer(),__toCommonJS(exports_buffer)),re=ve.Buffer;function B(Ue,Ze){for(var lt in Ue)Ze[lt]=Ue[lt]}re.from&&re.alloc&&re.allocUnsafe&&re.allocUnsafeSlow?$e.exports=ve:(B(ve,Q),Q.Buffer=oe);function oe(Ue,Ze,lt){return re(Ue,Ze,lt)}oe.prototype=Object.create(re.prototype),B(re,oe),oe.from=function(Ue,Ze,lt){if(typeof Ue=="number")throw new TypeError("Argument must not be a number");return re(Ue,Ze,lt)},oe.alloc=function(Ue,Ze,lt){if(typeof Ue!="number")throw new TypeError("Argument must be a number");var St=re(Ue);return Ze!==void 0?typeof lt=="string"?St.fill(Ze,lt):St.fill(Ze):St.fill(0),St},oe.allocUnsafe=function(Ue){if(typeof Ue!="number")throw new TypeError("Argument must be a number");return re(Ue)},oe.allocUnsafeSlow=function(Ue){if(typeof Ue!="number")throw new TypeError("Argument must be a number");return ve.SlowBuffer(Ue)}}),ze=n(Q=>{var $e=Ge().Buffer,ve=$e.isEncoding||function(er){switch(er=""+er,er&&er.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function re(er){if(!er)return"utf8";for(var Xt;;)switch(er){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return er;default:if(Xt)return;er=(""+er).toLowerCase(),Xt=!0}}function B(er){var Xt=re(er);if(typeof Xt!="string"&&($e.isEncoding===ve||!ve(er)))throw new Error("Unknown encoding: "+er);return Xt||er}Q.StringDecoder=oe;function oe(er){this.encoding=B(er);var Xt;switch(this.encoding){case"utf16le":this.text=Zt,this.end=Ut,Xt=4;break;case"utf8":this.fillLast=St,Xt=4;break;case"base64":this.text=vr,this.end=zr,Xt=3;break;default:this.write=or,this.end=sr;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=$e.allocUnsafe(Xt)}oe.prototype.write=function(er){if(er.length===0)return"";var Xt,nr;if(this.lastNeed){if(Xt=this.fillLast(er),Xt===void 0)return"";nr=this.lastNeed,this.lastNeed=0}else nr=0;return nr<er.length?Xt?Xt+this.text(er,nr):this.text(er,nr):Xt||""},oe.prototype.end=Ft,oe.prototype.text=Mt,oe.prototype.fillLast=function(er){if(this.lastNeed<=er.length)return er.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);er.copy(this.lastChar,this.lastTotal-this.lastNeed,0,er.length),this.lastNeed-=er.length};function Ue(er){return er<=127?0:er>>5===6?2:er>>4===14?3:er>>3===30?4:er>>6===2?-1:-2}function Ze(er,Xt,nr){var Fr=Xt.length-1;if(Fr<nr)return 0;var Ar=Ue(Xt[Fr]);return Ar>=0?(Ar>0&&(er.lastNeed=Ar-1),Ar):--Fr<nr||Ar===-2?0:(Ar=Ue(Xt[Fr]),Ar>=0?(Ar>0&&(er.lastNeed=Ar-2),Ar):--Fr<nr||Ar===-2?0:(Ar=Ue(Xt[Fr]),Ar>=0?(Ar>0&&(Ar===2?Ar=0:er.lastNeed=Ar-3),Ar):0))}function lt(er,Xt,nr){if((Xt[0]&192)!==128)return er.lastNeed=0,"";if(er.lastNeed>1&&Xt.length>1){if((Xt[1]&192)!==128)return er.lastNeed=1,"";if(er.lastNeed>2&&Xt.length>2&&(Xt[2]&192)!==128)return er.lastNeed=2,""}}function St(er){var Xt=this.lastTotal-this.lastNeed,nr=lt(this,er);if(nr!==void 0)return nr;if(this.lastNeed<=er.length)return er.copy(this.lastChar,Xt,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);er.copy(this.lastChar,Xt,0,er.length),this.lastNeed-=er.length}function Mt(er,Xt){var nr=Ze(this,er,Xt);if(!this.lastNeed)return er.toString("utf8",Xt);this.lastTotal=nr;var Fr=er.length-(nr-this.lastNeed);return er.copy(this.lastChar,0,Fr),er.toString("utf8",Xt,Fr)}function Ft(er){var Xt=er&&er.length?this.write(er):"";return this.lastNeed?Xt+"":Xt}function Zt(er,Xt){if((er.length-Xt)%2===0){var nr=er.toString("utf16le",Xt);if(nr){var Fr=nr.charCodeAt(nr.length-1);if(Fr>=55296&&Fr<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=er[er.length-2],this.lastChar[1]=er[er.length-1],nr.slice(0,-1)}return nr}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=er[er.length-1],er.toString("utf16le",Xt,er.length-1)}function Ut(er){var Xt=er&&er.length?this.write(er):"";if(this.lastNeed){var nr=this.lastTotal-this.lastNeed;return Xt+this.lastChar.toString("utf16le",0,nr)}return Xt}function vr(er,Xt){var nr=(er.length-Xt)%3;return nr===0?er.toString("base64",Xt):(this.lastNeed=3-nr,this.lastTotal=3,nr===1?this.lastChar[0]=er[er.length-1]:(this.lastChar[0]=er[er.length-2],this.lastChar[1]=er[er.length-1]),er.toString("base64",Xt,er.length-nr))}function zr(er){var Xt=er&&er.length?this.write(er):"";return this.lastNeed?Xt+this.lastChar.toString("base64",0,3-this.lastNeed):Xt}function or(er){return er.toString(this.encoding)}function sr(er){return er&&er.length?this.write(er):""}}),Xe=n((Q,$e)=>{var ve=_(),{PromisePrototypeThen:re,SymbolAsyncIterator:B,SymbolIterator:oe}=s(),{Buffer:Ue}=(init_buffer(),__toCommonJS(exports_buffer)),{ERR_INVALID_ARG_TYPE:Ze,ERR_STREAM_NULL_VALUES:lt}=a().codes;function St(Mt,Ft,Zt){let Ut;if(typeof Ft=="string"||Ft instanceof Ue)return new Mt({objectMode:!0,...Zt,read(){this.push(Ft),this.push(null)}});let vr;if(Ft&&Ft[B])vr=!0,Ut=Ft[B]();else if(Ft&&Ft[oe])vr=!1,Ut=Ft[oe]();else throw new Ze("iterable",["Iterable"],Ft);let zr=new Mt({objectMode:!0,highWaterMark:1,...Zt}),or=!1;zr._read=function(){or||(or=!0,er())},zr._destroy=function(Xt,nr){re(sr(Xt),()=>ve.nextTick(nr,Xt),Fr=>ve.nextTick(nr,Fr||Xt))};async function sr(Xt){let nr=Xt!=null,Fr=typeof Ut.throw=="function";if(nr&&Fr){let{value:Ar,done:qr}=await Ut.throw(Xt);if(await Ar,qr)return}if(typeof Ut.return=="function"){let{value:Ar}=await Ut.return();await Ar}}async function er(){for(;;){try{let{value:Xt,done:nr}=vr?await Ut.next():Ut.next();if(nr)zr.push(null);else{let Fr=Xt&&typeof Xt.then=="function"?await Xt:Xt;if(Fr===null)throw or=!1,new lt;if(zr.push(Fr))continue;or=!1}}catch(Xt){zr.destroy(Xt)}break}}return zr}$e.exports=St}),He=n((Q,$e)=>{var ve=_(),{ArrayPrototypeIndexOf:re,NumberIsInteger:B,NumberIsNaN:oe,NumberParseInt:Ue,ObjectDefineProperties:Ze,ObjectKeys:lt,ObjectSetPrototypeOf:St,Promise:Mt,SafeSet:Ft,SymbolAsyncDispose:Zt,SymbolAsyncIterator:Ut,Symbol:vr}=s();$e.exports=Qr,Qr.ReadableState=Lr;var{EventEmitter:zr}=(init_events(),__toCommonJS(exports_events)),{Stream:or,prependListener:sr}=te(),{Buffer:er}=(init_buffer(),__toCommonJS(exports_buffer)),{addAbortSignal:Xt}=ne(),nr=q(),Fr=g().debuglog("stream",rr=>{Fr=rr}),Ar=Ce(),qr=X(),{getHighWaterMark:dn,getDefaultHighWaterMark:Mr}=Le(),{aggregateTwoErrors:gr,codes:{ERR_INVALID_ARG_TYPE:en,ERR_METHOD_NOT_IMPLEMENTED:ur,ERR_OUT_OF_RANGE:ar,ERR_STREAM_PUSH_AFTER_EOF:Nr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Yt},AbortError:Ir}=a(),{validateObject:Qe}=b(),nt=vr("kPaused"),{StringDecoder:_t}=ze(),Bt=Xe();St(Qr.prototype,or.prototype),St(Qr,or);var Jt=()=>{},{errorOrDestroy:xt}=qr,mr=1,xr=2,wr=4,nn=8,Cr=16,Zr=32,pn=64,yr=128,Tr=256,Br=512,Jr=1024,rn=2048,dr=4096,ir=8192,Er=16384,an=32768,Rr=65536,Ur=131072,cr=262144;function Sr(rr){return{enumerable:!1,get(){return(this.state&rr)!==0},set(lr){lr?this.state|=rr:this.state&=~rr}}}Ze(Lr.prototype,{objectMode:Sr(mr),ended:Sr(xr),endEmitted:Sr(wr),reading:Sr(nn),constructed:Sr(Cr),sync:Sr(Zr),needReadable:Sr(pn),emittedReadable:Sr(yr),readableListening:Sr(Tr),resumeScheduled:Sr(Br),errorEmitted:Sr(Jr),emitClose:Sr(rn),autoDestroy:Sr(dr),destroyed:Sr(ir),closed:Sr(Er),closeEmitted:Sr(an),multiAwaitDrain:Sr(Rr),readingMore:Sr(Ur),dataEmitted:Sr(cr)});function Lr(rr,lr,fn){typeof fn!="boolean"&&(fn=lr instanceof rt()),this.state=rn|dr|Cr|Zr,rr&&rr.objectMode&&(this.state|=mr),fn&&rr&&rr.readableObjectMode&&(this.state|=mr),this.highWaterMark=rr?dn(this,rr,"readableHighWaterMark",fn):Mr(!1),this.buffer=new Ar,this.length=0,this.pipes=[],this.flowing=null,this[nt]=null,rr&&rr.emitClose===!1&&(this.state&=~rn),rr&&rr.autoDestroy===!1&&(this.state&=~dr),this.errored=null,this.defaultEncoding=rr&&rr.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,rr&&rr.encoding&&(this.decoder=new _t(rr.encoding),this.encoding=rr.encoding)}function Qr(rr){if(!(this instanceof Qr))return new Qr(rr);let lr=this instanceof rt();this._readableState=new Lr(rr,this,lr),rr&&(typeof rr.read=="function"&&(this._read=rr.read),typeof rr.destroy=="function"&&(this._destroy=rr.destroy),typeof rr.construct=="function"&&(this._construct=rr.construct),rr.signal&&!lr&&Xt(rr.signal,this)),or.call(this,rr),qr.construct(this,()=>{this._readableState.needReadable&&xn(this,this._readableState)})}Qr.prototype.destroy=qr.destroy,Qr.prototype._undestroy=qr.undestroy,Qr.prototype._destroy=function(rr,lr){lr(rr)},Qr.prototype[zr.captureRejectionSymbol]=function(rr){this.destroy(rr)},Qr.prototype[Zt]=function(){let rr;return this.destroyed||(rr=this.readableEnded?null:new Ir,this.destroy(rr)),new Mt((lr,fn)=>nr(this,un=>un&&un!==rr?fn(un):lr(null)))},Qr.prototype.push=function(rr,lr){return tn(this,rr,lr,!1)},Qr.prototype.unshift=function(rr,lr){return tn(this,rr,lr,!0)};function tn(rr,lr,fn,un){Fr("readableAddChunk",lr);let yn=rr._readableState,Wn;if((yn.state&mr)===0&&(typeof lr=="string"?(fn=fn||yn.defaultEncoding,yn.encoding!==fn&&(un&&yn.encoding?lr=er.from(lr,fn).toString(yn.encoding):(lr=er.from(lr,fn),fn=""))):lr instanceof er?fn="":or._isUint8Array(lr)?(lr=or._uint8ArrayToBuffer(lr),fn=""):lr!=null&&(Wn=new en("chunk",["string","Buffer","Uint8Array"],lr))),Wn)xt(rr,Wn);else if(lr===null)yn.state&=~nn,vn(rr,yn);else if((yn.state&mr)!==0||lr&&lr.length>0)if(un)if((yn.state&wr)!==0)xt(rr,new Yt);else{if(yn.destroyed||yn.errored)return!1;hn(rr,yn,lr,!0)}else if(yn.ended)xt(rr,new Nr);else{if(yn.destroyed||yn.errored)return!1;yn.state&=~nn,yn.decoder&&!fn?(lr=yn.decoder.write(lr),yn.objectMode||lr.length!==0?hn(rr,yn,lr,!1):xn(rr,yn)):hn(rr,yn,lr,!1)}else un||(yn.state&=~nn,xn(rr,yn));return!yn.ended&&(yn.length<yn.highWaterMark||yn.length===0)}function hn(rr,lr,fn,un){lr.flowing&&lr.length===0&&!lr.sync&&rr.listenerCount("data")>0?((lr.state&Rr)!==0?lr.awaitDrainWriters.clear():lr.awaitDrainWriters=null,lr.dataEmitted=!0,rr.emit("data",fn)):(lr.length+=lr.objectMode?1:fn.length,un?lr.buffer.unshift(fn):lr.buffer.push(fn),(lr.state&pn)!==0&&_n(rr)),xn(rr,lr)}Qr.prototype.isPaused=function(){let rr=this._readableState;return rr[nt]===!0||rr.flowing===!1},Qr.prototype.setEncoding=function(rr){let lr=new _t(rr);this._readableState.decoder=lr,this._readableState.encoding=this._readableState.decoder.encoding;let fn=this._readableState.buffer,un="";for(let yn of fn)un+=lr.write(yn);return fn.clear(),un!==""&&fn.push(un),this._readableState.length=un.length,this};var gn=1073741824;function on(rr){if(rr>gn)throw new ar("size","<= 1GiB",rr);return rr--,rr|=rr>>>1,rr|=rr>>>2,rr|=rr>>>4,rr|=rr>>>8,rr|=rr>>>16,rr++,rr}function cn(rr,lr){return rr<=0||lr.length===0&&lr.ended?0:(lr.state&mr)!==0?1:oe(rr)?lr.flowing&&lr.length?lr.buffer.first().length:lr.length:rr<=lr.length?rr:lr.ended?lr.length:0}Qr.prototype.read=function(rr){Fr("read",rr),rr===void 0?rr=NaN:B(rr)||(rr=Ue(rr,10));let lr=this._readableState,fn=rr;if(rr>lr.highWaterMark&&(lr.highWaterMark=on(rr)),rr!==0&&(lr.state&=~yr),rr===0&&lr.needReadable&&((lr.highWaterMark!==0?lr.length>=lr.highWaterMark:lr.length>0)||lr.ended))return Fr("read: emitReadable",lr.length,lr.ended),lr.length===0&&lr.ended?Pn(this):_n(this),null;if(rr=cn(rr,lr),rr===0&&lr.ended)return lr.length===0&&Pn(this),null;let un=(lr.state&pn)!==0;if(Fr("need readable",un),(lr.length===0||lr.length-rr<lr.highWaterMark)&&(un=!0,Fr("length less than watermark",un)),lr.ended||lr.reading||lr.destroyed||lr.errored||!lr.constructed)un=!1,Fr("reading, ended or constructing",un);else if(un){Fr("do read"),lr.state|=nn|Zr,lr.length===0&&(lr.state|=pn);try{this._read(lr.highWaterMark)}catch(Wn){xt(this,Wn)}lr.state&=~Zr,!lr.reading&&(rr=cn(fn,lr))}let yn;return rr>0?yn=In(rr,lr):yn=null,yn===null?(lr.needReadable=lr.length<=lr.highWaterMark,rr=0):(lr.length-=rr,lr.multiAwaitDrain?lr.awaitDrainWriters.clear():lr.awaitDrainWriters=null),lr.length===0&&(lr.ended||(lr.needReadable=!0),fn!==rr&&lr.ended&&Pn(this)),yn!==null&&!lr.errorEmitted&&!lr.closeEmitted&&(lr.dataEmitted=!0,this.emit("data",yn)),yn};function vn(rr,lr){if(Fr("onEofChunk"),!lr.ended){if(lr.decoder){let fn=lr.decoder.end();fn&&fn.length&&(lr.buffer.push(fn),lr.length+=lr.objectMode?1:fn.length)}lr.ended=!0,lr.sync?_n(rr):(lr.needReadable=!1,lr.emittedReadable=!0,Mn(rr))}}function _n(rr){let lr=rr._readableState;Fr("emitReadable",lr.needReadable,lr.emittedReadable),lr.needReadable=!1,!lr.emittedReadable&&(Fr("emitReadable",lr.flowing),lr.emittedReadable=!0,ve.nextTick(Mn,rr))}function Mn(rr){let lr=rr._readableState;Fr("emitReadable_",lr.destroyed,lr.length,lr.ended),!lr.destroyed&&!lr.errored&&(lr.length||lr.ended)&&(rr.emit("readable"),lr.emittedReadable=!1),lr.needReadable=!lr.flowing&&!lr.ended&&lr.length<=lr.highWaterMark,On(rr)}function xn(rr,lr){!lr.readingMore&&lr.constructed&&(lr.readingMore=!0,ve.nextTick(Nn,rr,lr))}function Nn(rr,lr){for(;!lr.reading&&!lr.ended&&(lr.length<lr.highWaterMark||lr.flowing&&lr.length===0);){let fn=lr.length;if(Fr("maybeReadMore read 0"),rr.read(0),fn===lr.length)break}lr.readingMore=!1}Qr.prototype._read=function(rr){throw new ur("_read()")},Qr.prototype.pipe=function(rr,lr){let fn=this,un=this._readableState;un.pipes.length===1&&(un.multiAwaitDrain||(un.multiAwaitDrain=!0,un.awaitDrainWriters=new Ft(un.awaitDrainWriters?[un.awaitDrainWriters]:[]))),un.pipes.push(rr),Fr("pipe count=%d opts=%j",un.pipes.length,lr);let yn=(!lr||lr.end!==!1)&&rr!==ve.stdout&&rr!==ve.stderr?jn:ni;un.endEmitted?ve.nextTick(yn):fn.once("end",yn),rr.on("unpipe",Wn);function Wn(Xn,Gn){Fr("onunpipe"),Xn===fn&&Gn&&Gn.hasUnpiped===!1&&(Gn.hasUnpiped=!0,Mi())}function jn(){Fr("onend"),rr.end()}let Zn,fi=!1;function Mi(){Fr("cleanup"),rr.removeListener("close",pi),rr.removeListener("finish",oi),Zn&&rr.removeListener("drain",Zn),rr.removeListener("error",di),rr.removeListener("unpipe",Wn),fn.removeListener("end",jn),fn.removeListener("end",ni),fn.removeListener("data",ri),fi=!0,Zn&&un.awaitDrainWriters&&(!rr._writableState||rr._writableState.needDrain)&&Zn()}function bi(){fi||(un.pipes.length===1&&un.pipes[0]===rr?(Fr("false write response, pause",0),un.awaitDrainWriters=rr,un.multiAwaitDrain=!1):un.pipes.length>1&&un.pipes.includes(rr)&&(Fr("false write response, pause",un.awaitDrainWriters.size),un.awaitDrainWriters.add(rr)),fn.pause()),Zn||(Zn=zn(fn,rr),rr.on("drain",Zn))}fn.on("data",ri);function ri(Xn){Fr("ondata");let Gn=rr.write(Xn);Fr("dest.write",Gn),Gn===!1&&bi()}function di(Xn){if(Fr("onerror",Xn),ni(),rr.removeListener("error",di),rr.listenerCount("error")===0){let Gn=rr._writableState||rr._readableState;Gn&&!Gn.errorEmitted?xt(rr,Xn):rr.emit("error",Xn)}}sr(rr,"error",di);function pi(){rr.removeListener("finish",oi),ni()}rr.once("close",pi);function oi(){Fr("onfinish"),rr.removeListener("close",pi),ni()}rr.once("finish",oi);function ni(){Fr("unpipe"),fn.unpipe(rr)}return rr.emit("pipe",fn),rr.writableNeedDrain===!0?bi():un.flowing||(Fr("pipe resume"),fn.resume()),rr};function zn(rr,lr){return function(){let un=rr._readableState;un.awaitDrainWriters===lr?(Fr("pipeOnDrain",1),un.awaitDrainWriters=null):un.multiAwaitDrain&&(Fr("pipeOnDrain",un.awaitDrainWriters.size),un.awaitDrainWriters.delete(lr)),(!un.awaitDrainWriters||un.awaitDrainWriters.size===0)&&rr.listenerCount("data")&&rr.resume()}}Qr.prototype.unpipe=function(rr){let lr=this._readableState,fn={hasUnpiped:!1};if(lr.pipes.length===0)return this;if(!rr){let yn=lr.pipes;lr.pipes=[],this.pause();for(let Wn=0;Wn<yn.length;Wn++)yn[Wn].emit("unpipe",this,{hasUnpiped:!1});return this}let un=re(lr.pipes,rr);return un===-1?this:(lr.pipes.splice(un,1),lr.pipes.length===0&&this.pause(),rr.emit("unpipe",this,fn),this)},Qr.prototype.on=function(rr,lr){let fn=or.prototype.on.call(this,rr,lr),un=this._readableState;return rr==="data"?(un.readableListening=this.listenerCount("readable")>0,un.flowing!==!1&&this.resume()):rr==="readable"&&!un.endEmitted&&!un.readableListening&&(un.readableListening=un.needReadable=!0,un.flowing=!1,un.emittedReadable=!1,Fr("on readable",un.length,un.reading),un.length?_n(this):un.reading||ve.nextTick(Bn,this)),fn},Qr.prototype.addListener=Qr.prototype.on,Qr.prototype.removeListener=function(rr,lr){let fn=or.prototype.removeListener.call(this,rr,lr);return rr==="readable"&&ve.nextTick(An,this),fn},Qr.prototype.off=Qr.prototype.removeListener,Qr.prototype.removeAllListeners=function(rr){let lr=or.prototype.removeAllListeners.apply(this,arguments);return(rr==="readable"||rr===void 0)&&ve.nextTick(An,this),lr};function An(rr){let lr=rr._readableState;lr.readableListening=rr.listenerCount("readable")>0,lr.resumeScheduled&&lr[nt]===!1?lr.flowing=!0:rr.listenerCount("data")>0?rr.resume():lr.readableListening||(lr.flowing=null)}function Bn(rr){Fr("readable nexttick read 0"),rr.read(0)}Qr.prototype.resume=function(){let rr=this._readableState;return rr.flowing||(Fr("resume"),rr.flowing=!rr.readableListening,Dn(this,rr)),rr[nt]=!1,this};function Dn(rr,lr){lr.resumeScheduled||(lr.resumeScheduled=!0,ve.nextTick(Hn,rr,lr))}function Hn(rr,lr){Fr("resume",lr.reading),!lr.reading&&rr.read(0),lr.resumeScheduled=!1,rr.emit("resume"),On(rr),lr.flowing&&!lr.reading&&rr.read(0)}Qr.prototype.pause=function(){return Fr("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Fr("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[nt]=!0,this};function On(rr){let lr=rr._readableState;for(Fr("flow",lr.flowing);lr.flowing&&rr.read()!==null;);}Qr.prototype.wrap=function(rr){let lr=!1;rr.on("data",un=>{!this.push(un)&&rr.pause&&(lr=!0,rr.pause())}),rr.on("end",()=>{this.push(null)}),rr.on("error",un=>{xt(this,un)}),rr.on("close",()=>{this.destroy()}),rr.on("destroy",()=>{this.destroy()}),this._read=()=>{lr&&rr.resume&&(lr=!1,rr.resume())};let fn=lt(rr);for(let un=1;un<fn.length;un++){let yn=fn[un];this[yn]===void 0&&typeof rr[yn]=="function"&&(this[yn]=rr[yn].bind(rr))}return this},Qr.prototype[Ut]=function(){return Rn(this)},Qr.prototype.iterator=function(rr){return rr!==void 0&&Qe(rr,"options"),Rn(this,rr)};function Rn(rr,lr){typeof rr.read!="function"&&(rr=Qr.wrap(rr,{objectMode:!0}));let fn=qn(rr,lr);return fn.stream=rr,fn}async function*qn(rr,lr){let fn=Jt;function un(jn){this===rr?(fn(),fn=Jt):fn=jn}rr.on("readable",un);let yn,Wn=nr(rr,{writable:!1},jn=>{yn=jn?gr(yn,jn):null,fn(),fn=Jt});try{for(;;){let jn=rr.destroyed?null:rr.read();if(jn!==null)yield jn;else{if(yn)throw yn;if(yn===null)return;await new Mt(un)}}}catch(jn){throw yn=gr(yn,jn),yn}finally{(yn||lr?.destroyOnReturn!==!1)&&(yn===void 0||rr._readableState.autoDestroy)?qr.destroyer(rr,null):(rr.off("readable",un),Wn())}}Ze(Qr.prototype,{readable:{__proto__:null,get(){let rr=this._readableState;return!!rr&&rr.readable!==!1&&!rr.destroyed&&!rr.errorEmitted&&!rr.endEmitted},set(rr){this._readableState&&(this._readableState.readable=!!rr)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(rr){this._readableState&&(this._readableState.flowing=rr)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(rr){this._readableState&&(this._readableState.destroyed=rr)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),Ze(Lr.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[nt]!==!1},set(rr){this[nt]=!!rr}}}),Qr._fromList=In;function In(rr,lr){if(lr.length===0)return null;let fn;return lr.objectMode?fn=lr.buffer.shift():!rr||rr>=lr.length?(lr.decoder?fn=lr.buffer.join(""):lr.buffer.length===1?fn=lr.buffer.first():fn=lr.buffer.concat(lr.length),lr.buffer.clear()):fn=lr.buffer.consume(rr,lr.decoder),fn}function Pn(rr){let lr=rr._readableState;Fr("endReadable",lr.endEmitted),!lr.endEmitted&&(lr.ended=!0,ve.nextTick(Cn,lr,rr))}function Cn(rr,lr){if(Fr("endReadableNT",rr.endEmitted,rr.length),!rr.errored&&!rr.closeEmitted&&!rr.endEmitted&&rr.length===0){if(rr.endEmitted=!0,lr.emit("end"),lr.writable&&lr.allowHalfOpen===!1)ve.nextTick(Fn,lr);else if(rr.autoDestroy){let fn=lr._writableState;(!fn||fn.autoDestroy&&(fn.finished||fn.writable===!1))&&lr.destroy()}}}function Fn(rr){rr.writable&&!rr.writableEnded&&!rr.destroyed&&rr.end()}Qr.from=function(rr,lr){return Bt(Qr,rr,lr)};var Ln;function Un(){return Ln===void 0&&(Ln={}),Ln}Qr.fromWeb=function(rr,lr){return Un().newStreamReadableFromReadableStream(rr,lr)},Qr.toWeb=function(rr,lr){return Un().newReadableStreamFromStreamReadable(rr,lr)},Qr.wrap=function(rr,lr){var fn,un;return new Qr({objectMode:(fn=(un=rr.readableObjectMode)!==null&&un!==void 0?un:rr.objectMode)!==null&&fn!==void 0?fn:!0,...lr,destroy(yn,Wn){qr.destroyer(rr,yn),Wn(yn)}}).wrap(rr)}}),Ve=n((Q,$e)=>{var ve=_(),{ArrayPrototypeSlice:re,Error:B,FunctionPrototypeSymbolHasInstance:oe,ObjectDefineProperty:Ue,ObjectDefineProperties:Ze,ObjectSetPrototypeOf:lt,StringPrototypeToLowerCase:St,Symbol:Mt,SymbolHasInstance:Ft}=s();$e.exports=Qe,Qe.WritableState=Yt;var{EventEmitter:Zt}=(init_events(),__toCommonJS(exports_events)),Ut=te().Stream,{Buffer:vr}=(init_buffer(),__toCommonJS(exports_buffer)),zr=X(),{addAbortSignal:or}=ne(),{getHighWaterMark:sr,getDefaultHighWaterMark:er}=Le(),{ERR_INVALID_ARG_TYPE:Xt,ERR_METHOD_NOT_IMPLEMENTED:nr,ERR_MULTIPLE_CALLBACK:Fr,ERR_STREAM_CANNOT_PIPE:Ar,ERR_STREAM_DESTROYED:qr,ERR_STREAM_ALREADY_FINISHED:dn,ERR_STREAM_NULL_VALUES:Mr,ERR_STREAM_WRITE_AFTER_END:gr,ERR_UNKNOWN_ENCODING:en}=a().codes,{errorOrDestroy:ur}=zr;lt(Qe.prototype,Ut.prototype),lt(Qe,Ut);function ar(){}var Nr=Mt("kOnFinished");function Yt(dr,ir,Er){typeof Er!="boolean"&&(Er=ir instanceof rt()),this.objectMode=!!(dr&&dr.objectMode),Er&&(this.objectMode=this.objectMode||!!(dr&&dr.writableObjectMode)),this.highWaterMark=dr?sr(this,dr,"writableHighWaterMark",Er):er(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let an=!!(dr&&dr.decodeStrings===!1);this.decodeStrings=!an,this.defaultEncoding=dr&&dr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=xt.bind(void 0,ir),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,Ir(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!dr||dr.emitClose!==!1,this.autoDestroy=!dr||dr.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Nr]=[]}function Ir(dr){dr.buffered=[],dr.bufferedIndex=0,dr.allBuffers=!0,dr.allNoop=!0}Yt.prototype.getBuffer=function(){return re(this.buffered,this.bufferedIndex)},Ue(Yt.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function Qe(dr){let ir=this instanceof rt();if(!ir&&!oe(Qe,this))return new Qe(dr);this._writableState=new Yt(dr,this,ir),dr&&(typeof dr.write=="function"&&(this._write=dr.write),typeof dr.writev=="function"&&(this._writev=dr.writev),typeof dr.destroy=="function"&&(this._destroy=dr.destroy),typeof dr.final=="function"&&(this._final=dr.final),typeof dr.construct=="function"&&(this._construct=dr.construct),dr.signal&&or(dr.signal,this)),Ut.call(this,dr),zr.construct(this,()=>{let Er=this._writableState;Er.writing||nn(this,Er),yr(this,Er)})}Ue(Qe,Ft,{__proto__:null,value:function(dr){return oe(this,dr)?!0:this!==Qe?!1:dr&&dr._writableState instanceof Yt}}),Qe.prototype.pipe=function(){ur(this,new Ar)};function nt(dr,ir,Er,an){let Rr=dr._writableState;if(typeof Er=="function")an=Er,Er=Rr.defaultEncoding;else{if(!Er)Er=Rr.defaultEncoding;else if(Er!=="buffer"&&!vr.isEncoding(Er))throw new en(Er);typeof an!="function"&&(an=ar)}if(ir===null)throw new Mr;if(!Rr.objectMode)if(typeof ir=="string")Rr.decodeStrings!==!1&&(ir=vr.from(ir,Er),Er="buffer");else if(ir instanceof vr)Er="buffer";else if(Ut._isUint8Array(ir))ir=Ut._uint8ArrayToBuffer(ir),Er="buffer";else throw new Xt("chunk",["string","Buffer","Uint8Array"],ir);let Ur;return Rr.ending?Ur=new gr:Rr.destroyed&&(Ur=new qr("write")),Ur?(ve.nextTick(an,Ur),ur(dr,Ur,!0),Ur):(Rr.pendingcb++,_t(dr,Rr,ir,Er,an))}Qe.prototype.write=function(dr,ir,Er){return nt(this,dr,ir,Er)===!0},Qe.prototype.cork=function(){this._writableState.corked++},Qe.prototype.uncork=function(){let dr=this._writableState;dr.corked&&(dr.corked--,!dr.writing&&nn(this,dr))},Qe.prototype.setDefaultEncoding=function(ir){if(typeof ir=="string"&&(ir=St(ir)),!vr.isEncoding(ir))throw new en(ir);return this._writableState.defaultEncoding=ir,this};function _t(dr,ir,Er,an,Rr){let Ur=ir.objectMode?1:Er.length;ir.length+=Ur;let cr=ir.length<ir.highWaterMark;return cr||(ir.needDrain=!0),ir.writing||ir.corked||ir.errored||!ir.constructed?(ir.buffered.push({chunk:Er,encoding:an,callback:Rr}),ir.allBuffers&&an!=="buffer"&&(ir.allBuffers=!1),ir.allNoop&&Rr!==ar&&(ir.allNoop=!1)):(ir.writelen=Ur,ir.writecb=Rr,ir.writing=!0,ir.sync=!0,dr._write(Er,an,ir.onwrite),ir.sync=!1),cr&&!ir.errored&&!ir.destroyed}function Bt(dr,ir,Er,an,Rr,Ur,cr){ir.writelen=an,ir.writecb=cr,ir.writing=!0,ir.sync=!0,ir.destroyed?ir.onwrite(new qr("write")):Er?dr._writev(Rr,ir.onwrite):dr._write(Rr,Ur,ir.onwrite),ir.sync=!1}function Jt(dr,ir,Er,an){--ir.pendingcb,an(Er),wr(ir),ur(dr,Er)}function xt(dr,ir){let Er=dr._writableState,an=Er.sync,Rr=Er.writecb;if(typeof Rr!="function"){ur(dr,new Fr);return}Er.writing=!1,Er.writecb=null,Er.length-=Er.writelen,Er.writelen=0,ir?(ir.stack,!Er.errored&&(Er.errored=ir),dr._readableState&&!dr._readableState.errored&&(dr._readableState.errored=ir),an?ve.nextTick(Jt,dr,Er,ir,Rr):Jt(dr,Er,ir,Rr)):(Er.buffered.length>Er.bufferedIndex&&nn(dr,Er),an?Er.afterWriteTickInfo!==null&&Er.afterWriteTickInfo.cb===Rr?Er.afterWriteTickInfo.count++:(Er.afterWriteTickInfo={count:1,cb:Rr,stream:dr,state:Er},ve.nextTick(mr,Er.afterWriteTickInfo)):xr(dr,Er,1,Rr))}function mr({stream:dr,state:ir,count:Er,cb:an}){return ir.afterWriteTickInfo=null,xr(dr,ir,Er,an)}function xr(dr,ir,Er,an){for(!ir.ending&&!dr.destroyed&&ir.length===0&&ir.needDrain&&(ir.needDrain=!1,dr.emit("drain"));Er-- >0;)ir.pendingcb--,an();ir.destroyed&&wr(ir),yr(dr,ir)}function wr(dr){if(dr.writing)return;for(let Rr=dr.bufferedIndex;Rr<dr.buffered.length;++Rr){var ir;let{chunk:Ur,callback:cr}=dr.buffered[Rr],Sr=dr.objectMode?1:Ur.length;dr.length-=Sr,cr((ir=dr.errored)!==null&&ir!==void 0?ir:new qr("write"))}let Er=dr[Nr].splice(0);for(let Rr=0;Rr<Er.length;Rr++){var an;Er[Rr]((an=dr.errored)!==null&&an!==void 0?an:new qr("end"))}Ir(dr)}function nn(dr,ir){if(ir.corked||ir.bufferProcessing||ir.destroyed||!ir.constructed)return;let{buffered:Er,bufferedIndex:an,objectMode:Rr}=ir,Ur=Er.length-an;if(!Ur)return;let cr=an;if(ir.bufferProcessing=!0,Ur>1&&dr._writev){ir.pendingcb-=Ur-1;let Sr=ir.allNoop?ar:Qr=>{for(let tn=cr;tn<Er.length;++tn)Er[tn].callback(Qr)},Lr=ir.allNoop&&cr===0?Er:re(Er,cr);Lr.allBuffers=ir.allBuffers,Bt(dr,ir,!0,ir.length,Lr,"",Sr),Ir(ir)}else{do{let{chunk:Sr,encoding:Lr,callback:Qr}=Er[cr];Er[cr++]=null;let tn=Rr?1:Sr.length;Bt(dr,ir,!1,tn,Sr,Lr,Qr)}while(cr<Er.length&&!ir.writing);cr===Er.length?Ir(ir):cr>256?(Er.splice(0,cr),ir.bufferedIndex=0):ir.bufferedIndex=cr}ir.bufferProcessing=!1}Qe.prototype._write=function(dr,ir,Er){if(this._writev)this._writev([{chunk:dr,encoding:ir}],Er);else throw new nr("_write()")},Qe.prototype._writev=null,Qe.prototype.end=function(dr,ir,Er){let an=this._writableState;typeof dr=="function"?(Er=dr,dr=null,ir=null):typeof ir=="function"&&(Er=ir,ir=null);let Rr;if(dr!=null){let Ur=nt(this,dr,ir);Ur instanceof B&&(Rr=Ur)}return an.corked&&(an.corked=1,this.uncork()),Rr||(!an.errored&&!an.ending?(an.ending=!0,yr(this,an,!0),an.ended=!0):an.finished?Rr=new dn("end"):an.destroyed&&(Rr=new qr("end"))),typeof Er=="function"&&(Rr||an.finished?ve.nextTick(Er,Rr):an[Nr].push(Er)),this};function Cr(dr){return dr.ending&&!dr.destroyed&&dr.constructed&&dr.length===0&&!dr.errored&&dr.buffered.length===0&&!dr.finished&&!dr.writing&&!dr.errorEmitted&&!dr.closeEmitted}function Zr(dr,ir){let Er=!1;function an(Rr){if(Er){ur(dr,Rr??Fr());return}if(Er=!0,ir.pendingcb--,Rr){let Ur=ir[Nr].splice(0);for(let cr=0;cr<Ur.length;cr++)Ur[cr](Rr);ur(dr,Rr,ir.sync)}else Cr(ir)&&(ir.prefinished=!0,dr.emit("prefinish"),ir.pendingcb++,ve.nextTick(Tr,dr,ir))}ir.sync=!0,ir.pendingcb++;try{dr._final(an)}catch(Rr){an(Rr)}ir.sync=!1}function pn(dr,ir){!ir.prefinished&&!ir.finalCalled&&(typeof dr._final=="function"&&!ir.destroyed?(ir.finalCalled=!0,Zr(dr,ir)):(ir.prefinished=!0,dr.emit("prefinish")))}function yr(dr,ir,Er){Cr(ir)&&(pn(dr,ir),ir.pendingcb===0&&(Er?(ir.pendingcb++,ve.nextTick((an,Rr)=>{Cr(Rr)?Tr(an,Rr):Rr.pendingcb--},dr,ir)):Cr(ir)&&(ir.pendingcb++,Tr(dr,ir))))}function Tr(dr,ir){ir.pendingcb--,ir.finished=!0;let Er=ir[Nr].splice(0);for(let an=0;an<Er.length;an++)Er[an]();if(dr.emit("finish"),ir.autoDestroy){let an=dr._readableState;(!an||an.autoDestroy&&(an.endEmitted||an.readable===!1))&&dr.destroy()}}Ze(Qe.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(dr){this._writableState&&(this._writableState.destroyed=dr)}},writable:{__proto__:null,get(){let dr=this._writableState;return!!dr&&dr.writable!==!1&&!dr.destroyed&&!dr.errored&&!dr.ending&&!dr.ended},set(dr){this._writableState&&(this._writableState.writable=!!dr)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let dr=this._writableState;return dr?!dr.destroyed&&!dr.ending&&dr.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var Br=zr.destroy;Qe.prototype.destroy=function(dr,ir){let Er=this._writableState;return!Er.destroyed&&(Er.bufferedIndex<Er.buffered.length||Er[Nr].length)&&ve.nextTick(wr,Er),Br.call(this,dr,ir),this},Qe.prototype._undestroy=zr.undestroy,Qe.prototype._destroy=function(dr,ir){ir(dr)},Qe.prototype[Zt.captureRejectionSymbol]=function(dr){this.destroy(dr)};var Jr;function rn(){return Jr===void 0&&(Jr={}),Jr}Qe.fromWeb=function(dr,ir){return rn().newStreamWritableFromWritableStream(dr,ir)},Qe.toWeb=function(dr){return rn().newWritableStreamFromStreamWritable(dr)}}),We=n((Q,$e)=>{var ve=_(),re=(init_buffer(),__toCommonJS(exports_buffer)),{isReadable:B,isWritable:oe,isIterable:Ue,isNodeStream:Ze,isReadableNodeStream:lt,isWritableNodeStream:St,isDuplexNodeStream:Mt,isReadableStream:Ft,isWritableStream:Zt}=L(),Ut=q(),{AbortError:vr,codes:{ERR_INVALID_ARG_TYPE:zr,ERR_INVALID_RETURN_VALUE:or}}=a(),{destroyer:sr}=X(),er=rt(),Xt=He(),nr=Ve(),{createDeferredPromise:Fr}=g(),Ar=Xe(),qr=globalThis.Blob||re.Blob,dn=typeof qr<"u"?function(Yt){return Yt instanceof qr}:function(Yt){return!1},Mr=globalThis.AbortController||f().AbortController,{FunctionPrototypeCall:gr}=s();class en extends er{constructor(Yt){super(Yt),Yt?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),Yt?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}$e.exports=function Nr(Yt,Ir){if(Mt(Yt))return Yt;if(lt(Yt))return ar({readable:Yt});if(St(Yt))return ar({writable:Yt});if(Ze(Yt))return ar({writable:!1,readable:!1});if(Ft(Yt))return ar({readable:Xt.fromWeb(Yt)});if(Zt(Yt))return ar({writable:nr.fromWeb(Yt)});if(typeof Yt=="function"){let{value:nt,write:_t,final:Bt,destroy:Jt}=ur(Yt);if(Ue(nt))return Ar(en,nt,{objectMode:!0,write:_t,final:Bt,destroy:Jt});let xt=nt?.then;if(typeof xt=="function"){let mr,xr=gr(xt,nt,wr=>{if(wr!=null)throw new or("nully","body",wr)},wr=>{sr(mr,wr)});return mr=new en({objectMode:!0,readable:!1,write:_t,final(wr){Bt(async()=>{try{await xr,ve.nextTick(wr,null)}catch(nn){ve.nextTick(wr,nn)}})},destroy:Jt})}throw new or("Iterable, AsyncIterable or AsyncFunction",Ir,nt)}if(dn(Yt))return Nr(Yt.arrayBuffer());if(Ue(Yt))return Ar(en,Yt,{objectMode:!0,writable:!1});if(Ft(Yt?.readable)&&Zt(Yt?.writable))return en.fromWeb(Yt);if(typeof Yt?.writable=="object"||typeof Yt?.readable=="object"){let nt=Yt!=null&&Yt.readable?lt(Yt?.readable)?Yt?.readable:Nr(Yt.readable):void 0,_t=Yt!=null&&Yt.writable?St(Yt?.writable)?Yt?.writable:Nr(Yt.writable):void 0;return ar({readable:nt,writable:_t})}let Qe=Yt?.then;if(typeof Qe=="function"){let nt;return gr(Qe,Yt,_t=>{_t!=null&&nt.push(_t),nt.push(null)},_t=>{sr(nt,_t)}),nt=new en({objectMode:!0,writable:!1,read(){}})}throw new zr(Ir,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],Yt)};function ur(Nr){let{promise:Yt,resolve:Ir}=Fr(),Qe=new Mr,nt=Qe.signal;return{value:Nr((async function*(){for(;;){let _t=Yt;Yt=null;let{chunk:Bt,done:Jt,cb:xt}=await _t;if(ve.nextTick(xt),Jt)return;if(nt.aborted)throw new vr(void 0,{cause:nt.reason});({promise:Yt,resolve:Ir}=Fr()),yield Bt}})(),{signal:nt}),write(_t,Bt,Jt){let xt=Ir;Ir=null,xt({chunk:_t,done:!1,cb:Jt})},final(_t){let Bt=Ir;Ir=null,Bt({done:!0,cb:_t})},destroy(_t,Bt){Qe.abort(),Bt(_t)}}}function ar(Nr){let Yt=Nr.readable&&typeof Nr.readable.read!="function"?Xt.wrap(Nr.readable):Nr.readable,Ir=Nr.writable,Qe=!!B(Yt),nt=!!oe(Ir),_t,Bt,Jt,xt,mr;function xr(wr){let nn=xt;xt=null,nn?nn(wr):wr&&mr.destroy(wr)}return mr=new en({readableObjectMode:!!(Yt!=null&&Yt.readableObjectMode),writableObjectMode:!!(Ir!=null&&Ir.writableObjectMode),readable:Qe,writable:nt}),nt&&(Ut(Ir,wr=>{nt=!1,wr&&sr(Yt,wr),xr(wr)}),mr._write=function(wr,nn,Cr){Ir.write(wr,nn)?Cr():_t=Cr},mr._final=function(wr){Ir.end(),Bt=wr},Ir.on("drain",function(){if(_t){let wr=_t;_t=null,wr()}}),Ir.on("finish",function(){if(Bt){let wr=Bt;Bt=null,wr()}})),Qe&&(Ut(Yt,wr=>{Qe=!1,wr&&sr(Yt,wr),xr(wr)}),Yt.on("readable",function(){if(Jt){let wr=Jt;Jt=null,wr()}}),Yt.on("end",function(){mr.push(null)}),mr._read=function(){for(;;){let wr=Yt.read();if(wr===null){Jt=mr._read;return}if(!mr.push(wr))return}}),mr._destroy=function(wr,nn){!wr&&xt!==null&&(wr=new vr),Jt=null,_t=null,Bt=null,xt===null?nn(wr):(xt=nn,sr(Ir,wr),sr(Yt,wr))},mr}}),rt=n((Q,$e)=>{var{ObjectDefineProperties:ve,ObjectGetOwnPropertyDescriptor:re,ObjectKeys:B,ObjectSetPrototypeOf:oe}=s();$e.exports=lt;var Ue=He(),Ze=Ve();oe(lt.prototype,Ue.prototype),oe(lt,Ue);{let Zt=B(Ze.prototype);for(let Ut=0;Ut<Zt.length;Ut++){let vr=Zt[Ut];lt.prototype[vr]||(lt.prototype[vr]=Ze.prototype[vr])}}function lt(Zt){if(!(this instanceof lt))return new lt(Zt);Ue.call(this,Zt),Ze.call(this,Zt),Zt?(this.allowHalfOpen=Zt.allowHalfOpen!==!1,Zt.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),Zt.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}ve(lt.prototype,{writable:{__proto__:null,...re(Ze.prototype,"writable")},writableHighWaterMark:{__proto__:null,...re(Ze.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...re(Ze.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...re(Ze.prototype,"writableBuffer")},writableLength:{__proto__:null,...re(Ze.prototype,"writableLength")},writableFinished:{__proto__:null,...re(Ze.prototype,"writableFinished")},writableCorked:{__proto__:null,...re(Ze.prototype,"writableCorked")},writableEnded:{__proto__:null,...re(Ze.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...re(Ze.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(Zt){this._readableState&&this._writableState&&(this._readableState.destroyed=Zt,this._writableState.destroyed=Zt)}}});var St;function Mt(){return St===void 0&&(St={}),St}lt.fromWeb=function(Zt,Ut){return Mt().newStreamDuplexFromReadableWritablePair(Zt,Ut)},lt.toWeb=function(Zt){return Mt().newReadableWritablePairFromDuplex(Zt)};var Ft;lt.from=function(Zt){return Ft||(Ft=We()),Ft(Zt,"body")}}),st=n((Q,$e)=>{var{ObjectSetPrototypeOf:ve,Symbol:re}=s();$e.exports=lt;var{ERR_METHOD_NOT_IMPLEMENTED:B}=a().codes,oe=rt(),{getHighWaterMark:Ue}=Le();ve(lt.prototype,oe.prototype),ve(lt,oe);var Ze=re("kCallback");function lt(Ft){if(!(this instanceof lt))return new lt(Ft);let Zt=Ft?Ue(this,Ft,"readableHighWaterMark",!0):null;Zt===0&&(Ft={...Ft,highWaterMark:null,readableHighWaterMark:Zt,writableHighWaterMark:Ft.writableHighWaterMark||0}),oe.call(this,Ft),this._readableState.sync=!1,this[Ze]=null,Ft&&(typeof Ft.transform=="function"&&(this._transform=Ft.transform),typeof Ft.flush=="function"&&(this._flush=Ft.flush)),this.on("prefinish",Mt)}function St(Ft){typeof this._flush=="function"&&!this.destroyed?this._flush((Zt,Ut)=>{if(Zt){Ft?Ft(Zt):this.destroy(Zt);return}Ut!=null&&this.push(Ut),this.push(null),Ft&&Ft()}):(this.push(null),Ft&&Ft())}function Mt(){this._final!==St&&St.call(this)}lt.prototype._final=St,lt.prototype._transform=function(Ft,Zt,Ut){throw new B("_transform()")},lt.prototype._write=function(Ft,Zt,Ut){let vr=this._readableState,zr=this._writableState,or=vr.length;this._transform(Ft,Zt,(sr,er)=>{if(sr){Ut(sr);return}er!=null&&this.push(er),zr.ended||or===vr.length||vr.length<vr.highWaterMark?Ut():this[Ze]=Ut})},lt.prototype._read=function(){if(this[Ze]){let Ft=this[Ze];this[Ze]=null,Ft()}}}),ht=n((Q,$e)=>{var{ObjectSetPrototypeOf:ve}=s();$e.exports=B;var re=st();ve(B.prototype,re.prototype),ve(B,re);function B(oe){if(!(this instanceof B))return new B(oe);re.call(this,oe)}B.prototype._transform=function(oe,Ue,Ze){Ze(null,oe)}}),je=n((Q,$e)=>{var ve=_(),{ArrayIsArray:re,Promise:B,SymbolAsyncIterator:oe,SymbolDispose:Ue}=s(),Ze=q(),{once:lt}=g(),St=X(),Mt=rt(),{aggregateTwoErrors:Ft,codes:{ERR_INVALID_ARG_TYPE:Zt,ERR_INVALID_RETURN_VALUE:Ut,ERR_MISSING_ARGS:vr,ERR_STREAM_DESTROYED:zr,ERR_STREAM_PREMATURE_CLOSE:or},AbortError:sr}=a(),{validateFunction:er,validateAbortSignal:Xt}=b(),{isIterable:nr,isReadable:Fr,isReadableNodeStream:Ar,isNodeStream:qr,isTransformStream:dn,isWebStream:Mr,isReadableStream:gr,isReadableFinished:en}=L(),ur=globalThis.AbortController||f().AbortController,ar,Nr,Yt;function Ir(wr,nn,Cr){let Zr=!1;wr.on("close",()=>{Zr=!0});let pn=Ze(wr,{readable:nn,writable:Cr},yr=>{Zr=!yr});return{destroy:yr=>{Zr||(Zr=!0,St.destroyer(wr,yr||new zr("pipe")))},cleanup:pn}}function Qe(wr){return er(wr[wr.length-1],"streams[stream.length - 1]"),wr.pop()}function nt(wr){if(nr(wr))return wr;if(Ar(wr))return _t(wr);throw new Zt("val",["Readable","Iterable","AsyncIterable"],wr)}async function*_t(wr){Nr||(Nr=He()),yield*Nr.prototype[oe].call(wr)}async function Bt(wr,nn,Cr,{end:Zr}){let pn,yr=null,Tr=rn=>{if(rn&&(pn=rn),yr){let dr=yr;yr=null,dr()}},Br=()=>new B((rn,dr)=>{pn?dr(pn):yr=()=>{pn?dr(pn):rn()}});nn.on("drain",Tr);let Jr=Ze(nn,{readable:!1},Tr);try{nn.writableNeedDrain&&await Br();for await(let rn of wr)nn.write(rn)||await Br();Zr&&(nn.end(),await Br()),Cr()}catch(rn){Cr(pn!==rn?Ft(pn,rn):rn)}finally{Jr(),nn.off("drain",Tr)}}async function Jt(wr,nn,Cr,{end:Zr}){dn(nn)&&(nn=nn.writable);let pn=nn.getWriter();try{for await(let yr of wr)await pn.ready,pn.write(yr).catch(()=>{});await pn.ready,Zr&&await pn.close(),Cr()}catch(yr){try{await pn.abort(yr),Cr(yr)}catch(Tr){Cr(Tr)}}}function xt(...wr){return mr(wr,lt(Qe(wr)))}function mr(wr,nn,Cr){if(wr.length===1&&re(wr[0])&&(wr=wr[0]),wr.length<2)throw new vr("streams");let Zr=new ur,pn=Zr.signal,yr=Cr?.signal,Tr=[];Xt(yr,"options.signal");function Br(){Rr(new sr)}Yt=Yt||g().addAbortListener;let Jr;yr&&(Jr=Yt(yr,Br));let rn,dr,ir=[],Er=0;function an(Lr){Rr(Lr,--Er===0)}function Rr(Lr,Qr){var tn;if(Lr&&(!rn||rn.code==="ERR_STREAM_PREMATURE_CLOSE")&&(rn=Lr),!(!rn&&!Qr)){for(;ir.length;)ir.shift()(rn);(tn=Jr)===null||tn===void 0||tn[Ue](),Zr.abort(),Qr&&(rn||Tr.forEach(hn=>hn()),ve.nextTick(nn,rn,dr))}}let Ur;for(let Lr=0;Lr<wr.length;Lr++){let Qr=wr[Lr],tn=Lr<wr.length-1,hn=Lr>0,gn=tn||Cr?.end!==!1,on=Lr===wr.length-1;if(qr(Qr)){let cn=function(vn){vn&&vn.name!=="AbortError"&&vn.code!=="ERR_STREAM_PREMATURE_CLOSE"&&an(vn)};if(gn){let{destroy:vn,cleanup:_n}=Ir(Qr,tn,hn);ir.push(vn),Fr(Qr)&&on&&Tr.push(_n)}Qr.on("error",cn),Fr(Qr)&&on&&Tr.push(()=>{Qr.removeListener("error",cn)})}if(Lr===0)if(typeof Qr=="function"){if(Ur=Qr({signal:pn}),!nr(Ur))throw new Ut("Iterable, AsyncIterable or Stream","source",Ur)}else nr(Qr)||Ar(Qr)||dn(Qr)?Ur=Qr:Ur=Mt.from(Qr);else if(typeof Qr=="function"){if(dn(Ur)){var cr;Ur=nt((cr=Ur)===null||cr===void 0?void 0:cr.readable)}else Ur=nt(Ur);if(Ur=Qr(Ur,{signal:pn}),tn){if(!nr(Ur,!0))throw new Ut("AsyncIterable",`transform[${Lr-1}]`,Ur)}else{var Sr;ar||(ar=ht());let cn=new ar({objectMode:!0}),vn=(Sr=Ur)===null||Sr===void 0?void 0:Sr.then;if(typeof vn=="function")Er++,vn.call(Ur,xn=>{dr=xn,xn!=null&&cn.write(xn),gn&&cn.end(),ve.nextTick(an)},xn=>{cn.destroy(xn),ve.nextTick(an,xn)});else if(nr(Ur,!0))Er++,Bt(Ur,cn,an,{end:gn});else if(gr(Ur)||dn(Ur)){let xn=Ur.readable||Ur;Er++,Bt(xn,cn,an,{end:gn})}else throw new Ut("AsyncIterable or Promise","destination",Ur);Ur=cn;let{destroy:_n,cleanup:Mn}=Ir(Ur,!1,!0);ir.push(_n),on&&Tr.push(Mn)}}else if(qr(Qr)){if(Ar(Ur)){Er+=2;let cn=xr(Ur,Qr,an,{end:gn});Fr(Qr)&&on&&Tr.push(cn)}else if(dn(Ur)||gr(Ur)){let cn=Ur.readable||Ur;Er++,Bt(cn,Qr,an,{end:gn})}else if(nr(Ur))Er++,Bt(Ur,Qr,an,{end:gn});else throw new Zt("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ur);Ur=Qr}else if(Mr(Qr)){if(Ar(Ur))Er++,Jt(nt(Ur),Qr,an,{end:gn});else if(gr(Ur)||nr(Ur))Er++,Jt(Ur,Qr,an,{end:gn});else if(dn(Ur))Er++,Jt(Ur.readable,Qr,an,{end:gn});else throw new Zt("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Ur);Ur=Qr}else Ur=Mt.from(Qr)}return(pn!=null&&pn.aborted||yr!=null&&yr.aborted)&&ve.nextTick(Br),Ur}function xr(wr,nn,Cr,{end:Zr}){let pn=!1;if(nn.on("close",()=>{pn||Cr(new or)}),wr.pipe(nn,{end:!1}),Zr){let yr=function(){pn=!0,nn.end()};en(wr)?ve.nextTick(yr):wr.once("end",yr)}else Cr();return Ze(wr,{readable:!0,writable:!1},yr=>{let Tr=wr._readableState;yr&&yr.code==="ERR_STREAM_PREMATURE_CLOSE"&&Tr&&Tr.ended&&!Tr.errored&&!Tr.errorEmitted?wr.once("end",Cr).once("error",Cr):Cr(yr)}),Ze(nn,{readable:!1,writable:!0},Cr)}$e.exports={pipelineImpl:mr,pipeline:xt}}),se=n((Q,$e)=>{var{pipeline:ve}=je(),re=rt(),{destroyer:B}=X(),{isNodeStream:oe,isReadable:Ue,isWritable:Ze,isWebStream:lt,isTransformStream:St,isWritableStream:Mt,isReadableStream:Ft}=L(),{AbortError:Zt,codes:{ERR_INVALID_ARG_VALUE:Ut,ERR_MISSING_ARGS:vr}}=a(),zr=q();$e.exports=function(...sr){if(sr.length===0)throw new vr("streams");if(sr.length===1)return re.from(sr[0]);let er=[...sr];if(typeof sr[0]=="function"&&(sr[0]=re.from(sr[0])),typeof sr[sr.length-1]=="function"){let ar=sr.length-1;sr[ar]=re.from(sr[ar])}for(let ar=0;ar<sr.length;++ar)if(!(!oe(sr[ar])&&!lt(sr[ar]))){if(ar<sr.length-1&&!(Ue(sr[ar])||Ft(sr[ar])||St(sr[ar])))throw new Ut(`streams[${ar}]`,er[ar],"must be readable");if(ar>0&&!(Ze(sr[ar])||Mt(sr[ar])||St(sr[ar])))throw new Ut(`streams[${ar}]`,er[ar],"must be writable")}let Xt,nr,Fr,Ar,qr;function dn(ar){let Nr=Ar;Ar=null,Nr?Nr(ar):ar?qr.destroy(ar):!ur&&!en&&qr.destroy()}let Mr=sr[0],gr=ve(sr,dn),en=!!(Ze(Mr)||Mt(Mr)||St(Mr)),ur=!!(Ue(gr)||Ft(gr)||St(gr));if(qr=new re({writableObjectMode:!!(Mr!=null&&Mr.writableObjectMode),readableObjectMode:!!(gr!=null&&gr.readableObjectMode),writable:en,readable:ur}),en){if(oe(Mr))qr._write=function(Nr,Yt,Ir){Mr.write(Nr,Yt)?Ir():Xt=Ir},qr._final=function(Nr){Mr.end(),nr=Nr},Mr.on("drain",function(){if(Xt){let Nr=Xt;Xt=null,Nr()}});else if(lt(Mr)){let Nr=(St(Mr)?Mr.writable:Mr).getWriter();qr._write=async function(Yt,Ir,Qe){try{await Nr.ready,Nr.write(Yt).catch(()=>{}),Qe()}catch(nt){Qe(nt)}},qr._final=async function(Yt){try{await Nr.ready,Nr.close().catch(()=>{}),nr=Yt}catch(Ir){Yt(Ir)}}}let ar=St(gr)?gr.readable:gr;zr(ar,()=>{if(nr){let Nr=nr;nr=null,Nr()}})}if(ur){if(oe(gr))gr.on("readable",function(){if(Fr){let ar=Fr;Fr=null,ar()}}),gr.on("end",function(){qr.push(null)}),qr._read=function(){for(;;){let ar=gr.read();if(ar===null){Fr=qr._read;return}if(!qr.push(ar))return}};else if(lt(gr)){let ar=(St(gr)?gr.readable:gr).getReader();qr._read=async function(){for(;;)try{let{value:Nr,done:Yt}=await ar.read();if(!qr.push(Nr))return;if(Yt){qr.push(null);return}}catch{return}}}}return qr._destroy=function(ar,Nr){!ar&&Ar!==null&&(ar=new Zt),Fr=null,Xt=null,nr=null,Ar===null?Nr(ar):(Ar=Nr,oe(gr)&&B(gr,ar))},qr}}),m=n((Q,$e)=>{var ve=globalThis.AbortController||f().AbortController,{codes:{ERR_INVALID_ARG_VALUE:re,ERR_INVALID_ARG_TYPE:B,ERR_MISSING_ARGS:oe,ERR_OUT_OF_RANGE:Ue},AbortError:Ze}=a(),{validateAbortSignal:lt,validateInteger:St,validateObject:Mt}=b(),Ft=s().Symbol("kWeak"),Zt=s().Symbol("kResistStopPropagation"),{finished:Ut}=q(),vr=se(),{addAbortSignalNoValidate:zr}=ne(),{isWritable:or,isNodeStream:sr}=L(),{deprecate:er}=g(),{ArrayPrototypePush:Xt,Boolean:nr,MathFloor:Fr,Number:Ar,NumberIsNaN:qr,Promise:dn,PromiseReject:Mr,PromiseResolve:gr,PromisePrototypeThen:en,Symbol:ur}=s(),ar=ur("kEmpty"),Nr=ur("kEof");function Yt(yr,Tr){if(Tr!=null&&Mt(Tr,"options"),Tr?.signal!=null&&lt(Tr.signal,"options.signal"),sr(yr)&&!or(yr))throw new re("stream",yr,"must be writable");let Br=vr(this,yr);return Tr!=null&&Tr.signal&&zr(Tr.signal,Br),Br}function Ir(yr,Tr){if(typeof yr!="function")throw new B("fn",["Function","AsyncFunction"],yr);Tr!=null&&Mt(Tr,"options"),Tr?.signal!=null&&lt(Tr.signal,"options.signal");let Br=1;Tr?.concurrency!=null&&(Br=Fr(Tr.concurrency));let Jr=Br-1;return Tr?.highWaterMark!=null&&(Jr=Fr(Tr.highWaterMark)),St(Br,"options.concurrency",1),St(Jr,"options.highWaterMark",0),Jr+=Br,(async function*(){let dr=g().AbortSignalAny([Tr?.signal].filter(nr)),ir=this,Er=[],an={signal:dr},Rr,Ur,cr=!1,Sr=0;function Lr(){cr=!0,Qr()}function Qr(){Sr-=1,tn()}function tn(){Ur&&!cr&&Sr<Br&&Er.length<Jr&&(Ur(),Ur=null)}async function hn(){try{for await(let gn of ir){if(cr)return;if(dr.aborted)throw new Ze;try{if(gn=yr(gn,an),gn===ar)continue;gn=gr(gn)}catch(on){gn=Mr(on)}Sr+=1,en(gn,Qr,Lr),Er.push(gn),Rr&&(Rr(),Rr=null),!cr&&(Er.length>=Jr||Sr>=Br)&&await new dn(on=>{Ur=on})}Er.push(Nr)}catch(gn){let on=Mr(gn);en(on,Qr,Lr),Er.push(on)}finally{cr=!0,Rr&&(Rr(),Rr=null)}}hn();try{for(;;){for(;Er.length>0;){let gn=await Er[0];if(gn===Nr)return;if(dr.aborted)throw new Ze;gn!==ar&&(yield gn),Er.shift(),tn()}await new dn(gn=>{Rr=gn})}}finally{cr=!0,Ur&&(Ur(),Ur=null)}}).call(this)}function Qe(yr=void 0){return yr!=null&&Mt(yr,"options"),yr?.signal!=null&&lt(yr.signal,"options.signal"),(async function*(){let Br=0;for await(let rn of this){var Jr;if(yr!=null&&(Jr=yr.signal)!==null&&Jr!==void 0&&Jr.aborted)throw new Ze({cause:yr.signal.reason});yield[Br++,rn]}}).call(this)}async function nt(yr,Tr=void 0){for await(let Br of xt.call(this,yr,Tr))return!0;return!1}async function _t(yr,Tr=void 0){if(typeof yr!="function")throw new B("fn",["Function","AsyncFunction"],yr);return!await nt.call(this,async(...Br)=>!await yr(...Br),Tr)}async function Bt(yr,Tr){for await(let Br of xt.call(this,yr,Tr))return Br}async function Jt(yr,Tr){if(typeof yr!="function")throw new B("fn",["Function","AsyncFunction"],yr);async function Br(Jr,rn){return await yr(Jr,rn),ar}for await(let Jr of Ir.call(this,Br,Tr));}function xt(yr,Tr){if(typeof yr!="function")throw new B("fn",["Function","AsyncFunction"],yr);async function Br(Jr,rn){return await yr(Jr,rn)?Jr:ar}return Ir.call(this,Br,Tr)}class mr extends oe{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function xr(yr,Tr,Br){var Jr;if(typeof yr!="function")throw new B("reducer",["Function","AsyncFunction"],yr);Br!=null&&Mt(Br,"options"),Br?.signal!=null&&lt(Br.signal,"options.signal");let rn=arguments.length>1;if(Br!=null&&(Jr=Br.signal)!==null&&Jr!==void 0&&Jr.aborted){let Rr=new Ze(void 0,{cause:Br.signal.reason});throw this.once("error",()=>{}),await Ut(this.destroy(Rr)),Rr}let dr=new ve,ir=dr.signal;if(Br!=null&&Br.signal){let Rr={once:!0,[Ft]:this,[Zt]:!0};Br.signal.addEventListener("abort",()=>dr.abort(),Rr)}let Er=!1;try{for await(let Rr of this){var an;if(Er=!0,Br!=null&&(an=Br.signal)!==null&&an!==void 0&&an.aborted)throw new Ze;rn?Tr=await yr(Tr,Rr,{signal:ir}):(Tr=Rr,rn=!0)}if(!Er&&!rn)throw new mr}finally{dr.abort()}return Tr}async function wr(yr){yr!=null&&Mt(yr,"options"),yr?.signal!=null&&lt(yr.signal,"options.signal");let Tr=[];for await(let Jr of this){var Br;if(yr!=null&&(Br=yr.signal)!==null&&Br!==void 0&&Br.aborted)throw new Ze(void 0,{cause:yr.signal.reason});Xt(Tr,Jr)}return Tr}function nn(yr,Tr){let Br=Ir.call(this,yr,Tr);return(async function*(){for await(let rn of Br)yield*rn}).call(this)}function Cr(yr){if(yr=Ar(yr),qr(yr))return 0;if(yr<0)throw new Ue("number",">= 0",yr);return yr}function Zr(yr,Tr=void 0){return Tr!=null&&Mt(Tr,"options"),Tr?.signal!=null&&lt(Tr.signal,"options.signal"),yr=Cr(yr),(async function*(){var Jr;if(Tr!=null&&(Jr=Tr.signal)!==null&&Jr!==void 0&&Jr.aborted)throw new Ze;for await(let dr of this){var rn;if(Tr!=null&&(rn=Tr.signal)!==null&&rn!==void 0&&rn.aborted)throw new Ze;yr--<=0&&(yield dr)}}).call(this)}function pn(yr,Tr=void 0){return Tr!=null&&Mt(Tr,"options"),Tr?.signal!=null&&lt(Tr.signal,"options.signal"),yr=Cr(yr),(async function*(){var Jr;if(Tr!=null&&(Jr=Tr.signal)!==null&&Jr!==void 0&&Jr.aborted)throw new Ze;for await(let dr of this){var rn;if(Tr!=null&&(rn=Tr.signal)!==null&&rn!==void 0&&rn.aborted)throw new Ze;if(yr-- >0&&(yield dr),yr<=0)return}}).call(this)}$e.exports.streamReturningOperators={asIndexedPairs:er(Qe,"readable.asIndexedPairs will be removed in a future version."),drop:Zr,filter:xt,flatMap:nn,map:Ir,take:pn,compose:Yt},$e.exports.promiseReturningOperators={every:_t,forEach:Jt,reduce:xr,toArray:wr,some:nt,find:Bt}}),A=n((Q,$e)=>{var{ArrayPrototypePop:ve,Promise:re}=s(),{isIterable:B,isNodeStream:oe,isWebStream:Ue}=L(),{pipelineImpl:Ze}=je(),{finished:lt}=q();k();function St(...Mt){return new re((Ft,Zt)=>{let Ut,vr,zr=Mt[Mt.length-1];if(zr&&typeof zr=="object"&&!oe(zr)&&!B(zr)&&!Ue(zr)){let or=ve(Mt);Ut=or.signal,vr=or.end}Ze(Mt,(or,sr)=>{or?Zt(or):Ft(sr)},{signal:Ut,end:vr})})}$e.exports={finished:lt,pipeline:St}}),k=n((Q,$e)=>{var{Buffer:ve}=(init_buffer(),__toCommonJS(exports_buffer)),{ObjectDefineProperty:re,ObjectKeys:B,ReflectApply:oe}=s(),{promisify:{custom:Ue}}=g(),{streamReturningOperators:Ze,promiseReturningOperators:lt}=m(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:St}}=a(),Mt=se(),{setDefaultHighWaterMark:Ft,getDefaultHighWaterMark:Zt}=Le(),{pipeline:Ut}=je(),{destroyer:vr}=X(),zr=q(),or=A(),sr=L(),er=$e.exports=te().Stream;er.isDestroyed=sr.isDestroyed,er.isDisturbed=sr.isDisturbed,er.isErrored=sr.isErrored,er.isReadable=sr.isReadable,er.isWritable=sr.isWritable,er.Readable=He();for(let nr of B(Ze)){let Fr=function(...qr){if(new.target)throw St();return er.Readable.from(oe(Ar,this,qr))},Ar=Ze[nr];re(Fr,"name",{__proto__:null,value:Ar.name}),re(Fr,"length",{__proto__:null,value:Ar.length}),re(er.Readable.prototype,nr,{__proto__:null,value:Fr,enumerable:!1,configurable:!0,writable:!0})}for(let nr of B(lt)){let Fr=function(...qr){if(new.target)throw St();return oe(Ar,this,qr)},Ar=lt[nr];re(Fr,"name",{__proto__:null,value:Ar.name}),re(Fr,"length",{__proto__:null,value:Ar.length}),re(er.Readable.prototype,nr,{__proto__:null,value:Fr,enumerable:!1,configurable:!0,writable:!0})}er.Writable=Ve(),er.Duplex=rt(),er.Transform=st(),er.PassThrough=ht(),er.pipeline=Ut;var{addAbortSignal:Xt}=ne();er.addAbortSignal=Xt,er.finished=zr,er.destroy=vr,er.compose=Mt,er.setDefaultHighWaterMark=Ft,er.getDefaultHighWaterMark=Zt,re(er,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return or}}),re(Ut,Ue,{__proto__:null,enumerable:!0,get(){return or.pipeline}}),re(zr,Ue,{__proto__:null,enumerable:!0,get(){return or.finished}}),er.Stream=er,er._isUint8Array=function(Fr){return Fr instanceof Uint8Array},er._uint8ArrayToBuffer=function(Fr){return ve.from(Fr.buffer,Fr.byteOffset,Fr.byteLength)}}),Y=n((Q,$e)=>{require_stream();{let ve=k(),re=A(),B=ve.Readable.destroy;$e.exports=ve.Readable,$e.exports._uint8ArrayToBuffer=ve._uint8ArrayToBuffer,$e.exports._isUint8Array=ve._isUint8Array,$e.exports.isDisturbed=ve.isDisturbed,$e.exports.isErrored=ve.isErrored,$e.exports.isReadable=ve.isReadable,$e.exports.Readable=ve.Readable,$e.exports.Writable=ve.Writable,$e.exports.Duplex=ve.Duplex,$e.exports.Transform=ve.Transform,$e.exports.PassThrough=ve.PassThrough,$e.exports.addAbortSignal=ve.addAbortSignal,$e.exports.finished=ve.finished,$e.exports.destroy=ve.destroy,$e.exports.destroy=B,$e.exports.pipeline=ve.pipeline,$e.exports.compose=ve.compose,Object.defineProperty(ve,"promises",{configurable:!0,enumerable:!0,get(){return re}}),$e.exports.Stream=ve.Stream}$e.exports.default=$e.exports});t.exports=Y()}),exports_crypto={};__export$2(exports_crypto,{webcrypto:()=>webcrypto,rng:()=>rng2,randomUUID:()=>randomUUID,randomFillSync:()=>randomFillSync2,randomFill:()=>randomFill2,randomBytes:()=>randomBytes2,publicEncrypt:()=>publicEncrypt2,publicDecrypt:()=>publicDecrypt2,pseudoRandomBytes:()=>pseudoRandomBytes2,prng:()=>prng2,privateEncrypt:()=>privateEncrypt2,privateDecrypt:()=>privateDecrypt2,pbkdf2Sync:()=>pbkdf2Sync2,pbkdf2:()=>pbkdf22,listCiphers:()=>listCiphers2,getRandomValues:()=>getRandomValues,getHashes:()=>getHashes2,getDiffieHellman:()=>getDiffieHellman2,getCurves:()=>getCurves,getCiphers:()=>getCiphers2,default:()=>crypto_default,createVerify:()=>createVerify2,createSign:()=>createSign2,createHmac:()=>createHmac2,createHash:()=>createHash2,createECDH:()=>createECDH2,createDiffieHellmanGroup:()=>createDiffieHellmanGroup2,createDiffieHellman:()=>createDiffieHellman2,createDecipheriv:()=>createDecipheriv2,createDecipher:()=>createDecipher2,createCredentials:()=>createCredentials2,createCipheriv:()=>createCipheriv2,createCipher:()=>createCipher2,constants:()=>constants2,Verify:()=>Verify2,Sign:()=>Sign2,Hmac:()=>Hmac2,Hash:()=>Hash2,DiffieHellmanGroup:()=>DiffieHellmanGroup2,DiffieHellman:()=>DiffieHellman2,Decipheriv:()=>Decipheriv2,Decipher:()=>Decipher2,DEFAULT_ENCODING:()=>DEFAULT_ENCODING,Cipheriv:()=>Cipheriv2,Cipher:()=>Cipher2});function getCurves(){return hardcoded_curves}var __create2,__getProtoOf2,__defProp2,__getOwnPropNames2,__hasOwnProp2,__toESM2=(r,t,n)=>{n=r!=null?__create2(__getProtoOf2(r)):{};let s=t||!r||!r.__esModule?__defProp2(n,"default",{value:r,enumerable:!0}):n;for(let o of __getOwnPropNames2(r))__hasOwnProp2.call(s,o)||__defProp2(s,o,{get:()=>r[o],enumerable:!0});return s},__commonJS2=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),require_randombytes,require_create_hash,require_create_hmac,require_algorithms,require_precondition,require_default_encoding,require_safe_buffer,require_to_buffer,require_sync,require_async,require_pbkdf2,require_browserify_cipher,require_diffie_hellman,require_browserify_sign,require_package,require_bn,require_minimalistic_assert,require_utils,require_utils2,require_brorand,require_base,require_inherits_browser,require_inherits,require_short,require_mont,require_edwards,require_curve,require_utils3,require_common,require_common2,require_1,require_256,require_224,require_512,require_384,require_sha,require_ripemd,require_hmac,require_hash,require_secp256k1,require_curves,require_hmac_drbg,require_key,require_signature,require_ec,require_key2,require_signature2,require_eddsa,require_elliptic,require_bn2,require_browser,require_create_ecdh,require_bn3,require_api,require_reporter,require_buffer,require_node,require_base2,require_der,require_constants,require_der2,require_pem,require_decoders,require_der3,require_pem2,require_encoders,require_asn1,require_certificate,require_asn12,require_aesid,require_hash_base,require_md5,require_evp_bytestokey,require_browserify_aes,require_fixProc,require_parse_asn1,require_mgf,require_xor,require_bn4,require_withPublic,require_bn5,require_browserify_rsa,require_publicEncrypt,require_privateDecrypt,require_browser2,require_public_encrypt,require_browser3,require_randomfill,require_crypto_browserify,cryptoBrowserify,prng2,pseudoRandomBytes2,rng2,randomBytes2,Hash2,createHash2,Hmac2,createHmac2,getHashes2,pbkdf22,pbkdf2Sync2,Cipher2,createCipher2,Cipheriv2,createCipheriv2,Decipher2,createDecipher2,Decipheriv2,createDecipheriv2,getCiphers2,listCiphers2,DiffieHellmanGroup2,createDiffieHellmanGroup2,getDiffieHellman2,createDiffieHellman2,DiffieHellman2,createSign2,Sign2,createVerify2,Verify2,createECDH2,publicEncrypt2,privateEncrypt2,publicDecrypt2,privateDecrypt2,randomFill2,randomFillSync2,createCredentials2,constants2,DEFAULT_ENCODING="buffer",getRandomValues=r=>crypto.getRandomValues(r),randomUUID=()=>crypto.randomUUID(),hardcoded_curves,webcrypto,crypto_default,init_crypto=__esm(()=>{__create2=Object.create,{getPrototypeOf:__getProtoOf2,defineProperty:__defProp2,getOwnPropertyNames:__getOwnPropNames2}=Object,__hasOwnProp2=Object.prototype.hasOwnProperty,require_randombytes=__commonJS2((r,t)=>{t.exports=(init_crypto(),__toCommonJS(exports_crypto)).randomBytes}),require_create_hash=__commonJS2((r,t)=>{t.exports=(init_crypto(),__toCommonJS(exports_crypto)).createHash}),require_create_hmac=__commonJS2((r,t)=>{t.exports=(init_crypto(),__toCommonJS(exports_crypto)).createHmac}),require_algorithms=__commonJS2((r,t)=>{t.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}}),require_precondition=__commonJS2((r,t)=>{var n=Math.pow(2,30)-1;t.exports=function(s,o){if(typeof s!="number")throw new TypeError("Iterations not a number");if(s<0)throw new TypeError("Bad iterations");if(typeof o!="number")throw new TypeError("Key length not a number");if(o<0||o>n||o!==o)throw new TypeError("Bad key length")}}),require_default_encoding=__commonJS2((r,t)=>{var n;globalThis.process&&globalThis.process.browser?n="utf-8":globalThis.process&&globalThis.process.version?(s=parseInt(process.version.split(".")[0].slice(1),10),n=s>=6?"utf-8":"binary"):n="utf-8";var s;t.exports=n}),require_safe_buffer=__commonJS2((r,t)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var n=(init_buffer(),__toCommonJS(exports_buffer)),s=n.Buffer;function o(c,f){for(var g in c)f[g]=c[g]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?t.exports=n:(o(n,r),r.Buffer=a);function a(c,f,g){return s(c,f,g)}a.prototype=Object.create(s.prototype),o(s,a),a.from=function(c,f,g){if(typeof c=="number")throw new TypeError("Argument must not be a number");return s(c,f,g)},a.alloc=function(c,f,g){if(typeof c!="number")throw new TypeError("Argument must be a number");var b=s(c);return f!==void 0?typeof g=="string"?b.fill(f,g):b.fill(f):b.fill(0),b},a.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return s(c)},a.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(c)}}),require_to_buffer=__commonJS2((r,t)=>{var n=require_safe_buffer().Buffer;t.exports=function(s,o,a){if(n.isBuffer(s))return s;if(typeof s=="string")return n.from(s,o);if(ArrayBuffer.isView(s))return n.from(s.buffer);throw new TypeError(a+" must be a string, a Buffer, a typed array or a DataView")}}),require_sync=__commonJS2((r,t)=>{var n={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20},s=require_create_hmac(),o=require_safe_buffer().Buffer,a=require_precondition(),c=require_default_encoding(),f=require_to_buffer();function g(b,_,L,q,X){a(L,q),b=f(b,c,"Password"),_=f(_,c,"Salt"),X=X||"sha1";var te=o.allocUnsafe(q),ne=o.allocUnsafe(_.length+4);_.copy(ne,0,0,_.length);for(var Ce=0,Le=n[X],Ge=Math.ceil(q/Le),ze=1;ze<=Ge;ze++){ne.writeUInt32BE(ze,_.length);for(var Xe=s(X,b).update(ne).digest(),He=Xe,Ve=1;Ve<L;Ve++){He=s(X,b).update(He).digest();for(var We=0;We<Le;We++)Xe[We]^=He[We]}Xe.copy(te,Ce),Ce+=Le}return te}t.exports=g}),require_async=__commonJS2((r,t)=>{var n=require_safe_buffer().Buffer,s=require_precondition(),o=require_default_encoding(),a=require_sync(),c=require_to_buffer(),f,g=globalThis.crypto&&globalThis.crypto.subtle,b={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},_=[];function L(Ce){if(globalThis.process&&!globalThis.process.browser||!g||!g.importKey||!g.deriveBits)return Promise.resolve(!1);if(_[Ce]!==void 0)return _[Ce];f=f||n.alloc(8);var Le=te(f,f,10,128,Ce).then(function(){return!0}).catch(function(){return!1});return _[Ce]=Le,Le}var q;function X(){return q||(globalThis.process&&globalThis.process.nextTick?q=globalThis.process.nextTick:globalThis.queueMicrotask?q=globalThis.queueMicrotask:globalThis.setImmediate?q=globalThis.setImmediate:q=globalThis.setTimeout,q)}function te(Ce,Le,Ge,ze,Xe){return g.importKey("raw",Ce,{name:"PBKDF2"},!1,["deriveBits"]).then(function(He){return g.deriveBits({name:"PBKDF2",salt:Le,iterations:Ge,hash:{name:Xe}},He,ze<<3)}).then(function(He){return n.from(He)})}function ne(Ce,Le){Ce.then(function(Ge){X()(function(){Le(null,Ge)})},function(Ge){X()(function(){Le(Ge)})})}t.exports=function(Ce,Le,Ge,ze,Xe,He){typeof Xe=="function"&&(He=Xe,Xe=void 0),Xe=Xe||"sha1";var Ve=b[Xe.toLowerCase()];if(!Ve||typeof globalThis.Promise!="function"){X()(function(){var We;try{We=a(Ce,Le,Ge,ze,Xe)}catch(rt){return He(rt)}He(null,We)});return}if(s(Ge,ze),Ce=c(Ce,o,"Password"),Le=c(Le,o,"Salt"),typeof He!="function")throw new Error("No callback provided to pbkdf2");ne(L(Ve).then(function(We){return We?te(Ce,Le,Ge,ze,Ve):a(Ce,Le,Ge,ze,Xe)}),He)}}),require_pbkdf2=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto)),n=require_precondition(),s=require_default_encoding(),o=require_to_buffer();function a(f,g,b,_,L,q){if(n(b,_),f=o(f,s,"Password"),g=o(g,s,"Salt"),typeof L=="function"&&(q=L,L="sha1"),typeof q!="function")throw new Error("No callback provided to pbkdf2");return t.pbkdf2(f,g,b,_,L,q)}function c(f,g,b,_,L){return n(b,_),f=o(f,s,"Password"),g=o(g,s,"Salt"),L=L||"sha1",t.pbkdf2Sync(f,g,b,_,L)}!t.pbkdf2Sync||t.pbkdf2Sync.toString().indexOf("keylen, digest")===-1?(r.pbkdf2Sync=require_sync(),r.pbkdf2=require_async()):(r.pbkdf2Sync=c,r.pbkdf2=a)}),require_browserify_cipher=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto));r.createCipher=r.Cipher=t.createCipher,r.createCipheriv=r.Cipheriv=t.createCipheriv,r.createDecipher=r.Decipher=t.createDecipher,r.createDecipheriv=r.Decipheriv=t.createDecipheriv,r.listCiphers=r.getCiphers=t.getCiphers}),require_diffie_hellman=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto));r.DiffieHellmanGroup=t.DiffieHellmanGroup,r.createDiffieHellmanGroup=t.createDiffieHellmanGroup,r.getDiffieHellman=t.getDiffieHellman,r.createDiffieHellman=t.createDiffieHellman,r.DiffieHellman=t.DiffieHellman}),require_browserify_sign=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto));r.createSign=t.createSign,r.Sign=t.Sign,r.createVerify=t.createVerify,r.Verify=t.Verify}),require_package=__commonJS2((r,t)=>{t.exports={name:"elliptic",version:"6.6.1",description:"EC cryptography",main:"lib/elliptic.js",files:["lib"],scripts:{lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository:{type:"git",url:"git@github.com:indutny/elliptic"},keywords:["EC","Elliptic","curve","Cryptography"],author:"Fedor Indutny <fedor@indutny.com>",license:"MIT",bugs:{url:"https://github.com/indutny/elliptic/issues"},homepage:"https://github.com/indutny/elliptic",devDependencies:{brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies:{"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"}}}),require_bn=__commonJS2((r,t)=>{(function(n,s){function o(se,m){if(!se)throw new Error(m||"Assertion failed")}function a(se,m){se.super_=m;var A=function(){};A.prototype=m.prototype,se.prototype=new A,se.prototype.constructor=se}function c(se,m,A){if(c.isBN(se))return se;this.negative=0,this.words=null,this.length=0,this.red=null,se!==null&&((m==="le"||m==="be")&&(A=m,m=10),this._init(se||0,m||10,A||"be"))}typeof n=="object"?n.exports=c:s.BN=c,c.BN=c,c.wordSize=26;var f;try{typeof window<"u"&&typeof window.Buffer<"u"?f=window.Buffer:f=(init_buffer(),__toCommonJS(exports_buffer)).Buffer}catch{}c.isBN=function(m){return m instanceof c?!0:m!==null&&typeof m=="object"&&m.constructor.wordSize===c.wordSize&&Array.isArray(m.words)},c.max=function(m,A){return m.cmp(A)>0?m:A},c.min=function(m,A){return m.cmp(A)<0?m:A},c.prototype._init=function(m,A,k){if(typeof m=="number")return this._initNumber(m,A,k);if(typeof m=="object")return this._initArray(m,A,k);A==="hex"&&(A=16),o(A===(A|0)&&A>=2&&A<=36),m=m.toString().replace(/\s+/g,"");var Y=0;m[0]==="-"&&(Y++,this.negative=1),Y<m.length&&(A===16?this._parseHex(m,Y,k):(this._parseBase(m,A,Y),k==="le"&&this._initArray(this.toArray(),A,k)))},c.prototype._initNumber=function(m,A,k){m<0&&(this.negative=1,m=-m),m<67108864?(this.words=[m&67108863],this.length=1):m<4503599627370496?(this.words=[m&67108863,m/67108864&67108863],this.length=2):(o(m<9007199254740992),this.words=[m&67108863,m/67108864&67108863,1],this.length=3),k==="le"&&this._initArray(this.toArray(),A,k)},c.prototype._initArray=function(m,A,k){if(o(typeof m.length=="number"),m.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(m.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q,$e,ve=0;if(k==="be")for(Y=m.length-1,Q=0;Y>=0;Y-=3)$e=m[Y]|m[Y-1]<<8|m[Y-2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);else if(k==="le")for(Y=0,Q=0;Y<m.length;Y+=3)$e=m[Y]|m[Y+1]<<8|m[Y+2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);return this.strip()};function g(se,m){var A=se.charCodeAt(m);return A>=65&&A<=70?A-55:A>=97&&A<=102?A-87:A-48&15}function b(se,m,A){var k=g(se,A);return A-1>=m&&(k|=g(se,A-1)<<4),k}c.prototype._parseHex=function(m,A,k){this.length=Math.ceil((m.length-A)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q=0,$e=0,ve;if(k==="be")for(Y=m.length-1;Y>=A;Y-=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8;else{var re=m.length-A;for(Y=re%2===0?A+1:A;Y<m.length;Y+=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8}this.strip()};function _(se,m,A,k){for(var Y=0,Q=Math.min(se.length,A),$e=m;$e<Q;$e++){var ve=se.charCodeAt($e)-48;Y*=k,ve>=49?Y+=ve-49+10:ve>=17?Y+=ve-17+10:Y+=ve}return Y}c.prototype._parseBase=function(m,A,k){this.words=[0],this.length=1;for(var Y=0,Q=1;Q<=67108863;Q*=A)Y++;Y--,Q=Q/A|0;for(var $e=m.length-k,ve=$e%Y,re=Math.min($e,$e-ve)+k,B=0,oe=k;oe<re;oe+=Y)B=_(m,oe,oe+Y,A),this.imuln(Q),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B);if(ve!==0){var Ue=1;for(B=_(m,oe,m.length,A),oe=0;oe<ve;oe++)Ue*=A;this.imuln(Ue),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B)}this.strip()},c.prototype.copy=function(m){m.words=new Array(this.length);for(var A=0;A<this.length;A++)m.words[A]=this.words[A];m.length=this.length,m.negative=this.negative,m.red=this.red},c.prototype.clone=function(){var m=new c(null);return this.copy(m),m},c.prototype._expand=function(m){for(;this.length<m;)this.words[this.length++]=0;return this},c.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},c.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var L=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],q=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],X=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(m,A){m=m||10,A=A|0||1;var k;if(m===16||m==="hex"){k="";for(var Y=0,Q=0,$e=0;$e<this.length;$e++){var ve=this.words[$e],re=((ve<<Y|Q)&16777215).toString(16);Q=ve>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,$e--),Q!==0||$e!==this.length-1?k=L[6-re.length]+re+k:k=re+k}for(Q!==0&&(k=Q.toString(16)+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}if(m===(m|0)&&m>=2&&m<=36){var B=q[m],oe=X[m];k="";var Ue=this.clone();for(Ue.negative=0;!Ue.isZero();){var Ze=Ue.modn(oe).toString(m);Ue=Ue.idivn(oe),Ue.isZero()?k=Ze+k:k=L[B-Ze.length]+Ze+k}for(this.isZero()&&(k="0"+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}o(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var m=this.words[0];return this.length===2?m+=this.words[1]*67108864:this.length===3&&this.words[2]===1?m+=4503599627370496+this.words[1]*67108864:this.length>2&&o(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-m:m},c.prototype.toJSON=function(){return this.toString(16)},c.prototype.toBuffer=function(m,A){return o(typeof f<"u"),this.toArrayLike(f,m,A)},c.prototype.toArray=function(m,A){return this.toArrayLike(Array,m,A)},c.prototype.toArrayLike=function(m,A,k){var Y=this.byteLength(),Q=k||Math.max(1,Y);o(Y<=Q,"byte array longer than desired length"),o(Q>0,"Requested array length <= 0"),this.strip();var $e=A==="le",ve=new m(Q),re,B,oe=this.clone();if($e){for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[B]=re;for(;B<Q;B++)ve[B]=0}else{for(B=0;B<Q-Y;B++)ve[B]=0;for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[Q-B-1]=re}return ve},Math.clz32?c.prototype._countBits=function(m){return 32-Math.clz32(m)}:c.prototype._countBits=function(m){var A=m,k=0;return A>=4096&&(k+=13,A>>>=13),A>=64&&(k+=7,A>>>=7),A>=8&&(k+=4,A>>>=4),A>=2&&(k+=2,A>>>=2),k+A},c.prototype._zeroBits=function(m){if(m===0)return 26;var A=m,k=0;return(A&8191)===0&&(k+=13,A>>>=13),(A&127)===0&&(k+=7,A>>>=7),(A&15)===0&&(k+=4,A>>>=4),(A&3)===0&&(k+=2,A>>>=2),(A&1)===0&&k++,k},c.prototype.bitLength=function(){var m=this.words[this.length-1],A=this._countBits(m);return(this.length-1)*26+A};function te(se){for(var m=new Array(se.bitLength()),A=0;A<m.length;A++){var k=A/26|0,Y=A%26;m[A]=(se.words[k]&1<<Y)>>>Y}return m}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var m=0,A=0;A<this.length;A++){var k=this._zeroBits(this.words[A]);if(m+=k,k!==26)break}return m},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(m){return this.negative!==0?this.abs().inotn(m).iaddn(1):this.clone()},c.prototype.fromTwos=function(m){return this.testn(m-1)?this.notn(m).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(m){for(;this.length<m.length;)this.words[this.length++]=0;for(var A=0;A<m.length;A++)this.words[A]=this.words[A]|m.words[A];return this.strip()},c.prototype.ior=function(m){return o((this.negative|m.negative)===0),this.iuor(m)},c.prototype.or=function(m){return this.length>m.length?this.clone().ior(m):m.clone().ior(this)},c.prototype.uor=function(m){return this.length>m.length?this.clone().iuor(m):m.clone().iuor(this)},c.prototype.iuand=function(m){var A;this.length>m.length?A=m:A=this;for(var k=0;k<A.length;k++)this.words[k]=this.words[k]&m.words[k];return this.length=A.length,this.strip()},c.prototype.iand=function(m){return o((this.negative|m.negative)===0),this.iuand(m)},c.prototype.and=function(m){return this.length>m.length?this.clone().iand(m):m.clone().iand(this)},c.prototype.uand=function(m){return this.length>m.length?this.clone().iuand(m):m.clone().iuand(this)},c.prototype.iuxor=function(m){var A,k;this.length>m.length?(A=this,k=m):(A=m,k=this);for(var Y=0;Y<k.length;Y++)this.words[Y]=A.words[Y]^k.words[Y];if(this!==A)for(;Y<A.length;Y++)this.words[Y]=A.words[Y];return this.length=A.length,this.strip()},c.prototype.ixor=function(m){return o((this.negative|m.negative)===0),this.iuxor(m)},c.prototype.xor=function(m){return this.length>m.length?this.clone().ixor(m):m.clone().ixor(this)},c.prototype.uxor=function(m){return this.length>m.length?this.clone().iuxor(m):m.clone().iuxor(this)},c.prototype.inotn=function(m){o(typeof m=="number"&&m>=0);var A=Math.ceil(m/26)|0,k=m%26;this._expand(A),k>0&&A--;for(var Y=0;Y<A;Y++)this.words[Y]=~this.words[Y]&67108863;return k>0&&(this.words[Y]=~this.words[Y]&67108863>>26-k),this.strip()},c.prototype.notn=function(m){return this.clone().inotn(m)},c.prototype.setn=function(m,A){o(typeof m=="number"&&m>=0);var k=m/26|0,Y=m%26;return this._expand(k+1),A?this.words[k]=this.words[k]|1<<Y:this.words[k]=this.words[k]&~(1<<Y),this.strip()},c.prototype.iadd=function(m){var A;if(this.negative!==0&&m.negative===0)return this.negative=0,A=this.isub(m),this.negative^=1,this._normSign();if(this.negative===0&&m.negative!==0)return m.negative=0,A=this.isub(m),m.negative=1,A._normSign();var k,Y;this.length>m.length?(k=this,Y=m):(k=m,Y=this);for(var Q=0,$e=0;$e<Y.length;$e++)A=(k.words[$e]|0)+(Y.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;for(;Q!==0&&$e<k.length;$e++)A=(k.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;if(this.length=k.length,Q!==0)this.words[this.length]=Q,this.length++;else if(k!==this)for(;$e<k.length;$e++)this.words[$e]=k.words[$e];return this},c.prototype.add=function(m){var A;return m.negative!==0&&this.negative===0?(m.negative=0,A=this.sub(m),m.negative^=1,A):m.negative===0&&this.negative!==0?(this.negative=0,A=m.sub(this),this.negative=1,A):this.length>m.length?this.clone().iadd(m):m.clone().iadd(this)},c.prototype.isub=function(m){if(m.negative!==0){m.negative=0;var A=this.iadd(m);return m.negative=1,A._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(m),this.negative=1,this._normSign();var k=this.cmp(m);if(k===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,Q;k>0?(Y=this,Q=m):(Y=m,Q=this);for(var $e=0,ve=0;ve<Q.length;ve++)A=(Y.words[ve]|0)-(Q.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;for(;$e!==0&&ve<Y.length;ve++)A=(Y.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;if($e===0&&ve<Y.length&&Y!==this)for(;ve<Y.length;ve++)this.words[ve]=Y.words[ve];return this.length=Math.max(this.length,ve),Y!==this&&(this.negative=1),this.strip()},c.prototype.sub=function(m){return this.clone().isub(m)};function ne(se,m,A){A.negative=m.negative^se.negative;var k=se.length+m.length|0;A.length=k,k=k-1|0;var Y=se.words[0]|0,Q=m.words[0]|0,$e=Y*Q,ve=$e&67108863,re=$e/67108864|0;A.words[0]=ve;for(var B=1;B<k;B++){for(var oe=re>>>26,Ue=re&67108863,Ze=Math.min(B,m.length-1),lt=Math.max(0,B-se.length+1);lt<=Ze;lt++){var St=B-lt|0;Y=se.words[St]|0,Q=m.words[lt]|0,$e=Y*Q+Ue,oe+=$e/67108864|0,Ue=$e&67108863}A.words[B]=Ue|0,re=oe|0}return re!==0?A.words[B]=re|0:A.length--,A.strip()}var Ce=function(m,A,k){var Y=m.words,Q=A.words,$e=k.words,ve=0,re,B,oe,Ue=Y[0]|0,Ze=Ue&8191,lt=Ue>>>13,St=Y[1]|0,Mt=St&8191,Ft=St>>>13,Zt=Y[2]|0,Ut=Zt&8191,vr=Zt>>>13,zr=Y[3]|0,or=zr&8191,sr=zr>>>13,er=Y[4]|0,Xt=er&8191,nr=er>>>13,Fr=Y[5]|0,Ar=Fr&8191,qr=Fr>>>13,dn=Y[6]|0,Mr=dn&8191,gr=dn>>>13,en=Y[7]|0,ur=en&8191,ar=en>>>13,Nr=Y[8]|0,Yt=Nr&8191,Ir=Nr>>>13,Qe=Y[9]|0,nt=Qe&8191,_t=Qe>>>13,Bt=Q[0]|0,Jt=Bt&8191,xt=Bt>>>13,mr=Q[1]|0,xr=mr&8191,wr=mr>>>13,nn=Q[2]|0,Cr=nn&8191,Zr=nn>>>13,pn=Q[3]|0,yr=pn&8191,Tr=pn>>>13,Br=Q[4]|0,Jr=Br&8191,rn=Br>>>13,dr=Q[5]|0,ir=dr&8191,Er=dr>>>13,an=Q[6]|0,Rr=an&8191,Ur=an>>>13,cr=Q[7]|0,Sr=cr&8191,Lr=cr>>>13,Qr=Q[8]|0,tn=Qr&8191,hn=Qr>>>13,gn=Q[9]|0,on=gn&8191,cn=gn>>>13;k.negative=m.negative^A.negative,k.length=19,re=Math.imul(Ze,Jt),B=Math.imul(Ze,xt),B=B+Math.imul(lt,Jt)|0,oe=Math.imul(lt,xt);var vn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(vn>>>26)|0,vn&=67108863,re=Math.imul(Mt,Jt),B=Math.imul(Mt,xt),B=B+Math.imul(Ft,Jt)|0,oe=Math.imul(Ft,xt),re=re+Math.imul(Ze,xr)|0,B=B+Math.imul(Ze,wr)|0,B=B+Math.imul(lt,xr)|0,oe=oe+Math.imul(lt,wr)|0;var _n=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(_n>>>26)|0,_n&=67108863,re=Math.imul(Ut,Jt),B=Math.imul(Ut,xt),B=B+Math.imul(vr,Jt)|0,oe=Math.imul(vr,xt),re=re+Math.imul(Mt,xr)|0,B=B+Math.imul(Mt,wr)|0,B=B+Math.imul(Ft,xr)|0,oe=oe+Math.imul(Ft,wr)|0,re=re+Math.imul(Ze,Cr)|0,B=B+Math.imul(Ze,Zr)|0,B=B+Math.imul(lt,Cr)|0,oe=oe+Math.imul(lt,Zr)|0;var Mn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Mn>>>26)|0,Mn&=67108863,re=Math.imul(or,Jt),B=Math.imul(or,xt),B=B+Math.imul(sr,Jt)|0,oe=Math.imul(sr,xt),re=re+Math.imul(Ut,xr)|0,B=B+Math.imul(Ut,wr)|0,B=B+Math.imul(vr,xr)|0,oe=oe+Math.imul(vr,wr)|0,re=re+Math.imul(Mt,Cr)|0,B=B+Math.imul(Mt,Zr)|0,B=B+Math.imul(Ft,Cr)|0,oe=oe+Math.imul(Ft,Zr)|0,re=re+Math.imul(Ze,yr)|0,B=B+Math.imul(Ze,Tr)|0,B=B+Math.imul(lt,yr)|0,oe=oe+Math.imul(lt,Tr)|0;var xn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(xn>>>26)|0,xn&=67108863,re=Math.imul(Xt,Jt),B=Math.imul(Xt,xt),B=B+Math.imul(nr,Jt)|0,oe=Math.imul(nr,xt),re=re+Math.imul(or,xr)|0,B=B+Math.imul(or,wr)|0,B=B+Math.imul(sr,xr)|0,oe=oe+Math.imul(sr,wr)|0,re=re+Math.imul(Ut,Cr)|0,B=B+Math.imul(Ut,Zr)|0,B=B+Math.imul(vr,Cr)|0,oe=oe+Math.imul(vr,Zr)|0,re=re+Math.imul(Mt,yr)|0,B=B+Math.imul(Mt,Tr)|0,B=B+Math.imul(Ft,yr)|0,oe=oe+Math.imul(Ft,Tr)|0,re=re+Math.imul(Ze,Jr)|0,B=B+Math.imul(Ze,rn)|0,B=B+Math.imul(lt,Jr)|0,oe=oe+Math.imul(lt,rn)|0;var Nn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,re=Math.imul(Ar,Jt),B=Math.imul(Ar,xt),B=B+Math.imul(qr,Jt)|0,oe=Math.imul(qr,xt),re=re+Math.imul(Xt,xr)|0,B=B+Math.imul(Xt,wr)|0,B=B+Math.imul(nr,xr)|0,oe=oe+Math.imul(nr,wr)|0,re=re+Math.imul(or,Cr)|0,B=B+Math.imul(or,Zr)|0,B=B+Math.imul(sr,Cr)|0,oe=oe+Math.imul(sr,Zr)|0,re=re+Math.imul(Ut,yr)|0,B=B+Math.imul(Ut,Tr)|0,B=B+Math.imul(vr,yr)|0,oe=oe+Math.imul(vr,Tr)|0,re=re+Math.imul(Mt,Jr)|0,B=B+Math.imul(Mt,rn)|0,B=B+Math.imul(Ft,Jr)|0,oe=oe+Math.imul(Ft,rn)|0,re=re+Math.imul(Ze,ir)|0,B=B+Math.imul(Ze,Er)|0,B=B+Math.imul(lt,ir)|0,oe=oe+Math.imul(lt,Er)|0;var zn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(zn>>>26)|0,zn&=67108863,re=Math.imul(Mr,Jt),B=Math.imul(Mr,xt),B=B+Math.imul(gr,Jt)|0,oe=Math.imul(gr,xt),re=re+Math.imul(Ar,xr)|0,B=B+Math.imul(Ar,wr)|0,B=B+Math.imul(qr,xr)|0,oe=oe+Math.imul(qr,wr)|0,re=re+Math.imul(Xt,Cr)|0,B=B+Math.imul(Xt,Zr)|0,B=B+Math.imul(nr,Cr)|0,oe=oe+Math.imul(nr,Zr)|0,re=re+Math.imul(or,yr)|0,B=B+Math.imul(or,Tr)|0,B=B+Math.imul(sr,yr)|0,oe=oe+Math.imul(sr,Tr)|0,re=re+Math.imul(Ut,Jr)|0,B=B+Math.imul(Ut,rn)|0,B=B+Math.imul(vr,Jr)|0,oe=oe+Math.imul(vr,rn)|0,re=re+Math.imul(Mt,ir)|0,B=B+Math.imul(Mt,Er)|0,B=B+Math.imul(Ft,ir)|0,oe=oe+Math.imul(Ft,Er)|0,re=re+Math.imul(Ze,Rr)|0,B=B+Math.imul(Ze,Ur)|0,B=B+Math.imul(lt,Rr)|0,oe=oe+Math.imul(lt,Ur)|0;var An=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(An>>>26)|0,An&=67108863,re=Math.imul(ur,Jt),B=Math.imul(ur,xt),B=B+Math.imul(ar,Jt)|0,oe=Math.imul(ar,xt),re=re+Math.imul(Mr,xr)|0,B=B+Math.imul(Mr,wr)|0,B=B+Math.imul(gr,xr)|0,oe=oe+Math.imul(gr,wr)|0,re=re+Math.imul(Ar,Cr)|0,B=B+Math.imul(Ar,Zr)|0,B=B+Math.imul(qr,Cr)|0,oe=oe+Math.imul(qr,Zr)|0,re=re+Math.imul(Xt,yr)|0,B=B+Math.imul(Xt,Tr)|0,B=B+Math.imul(nr,yr)|0,oe=oe+Math.imul(nr,Tr)|0,re=re+Math.imul(or,Jr)|0,B=B+Math.imul(or,rn)|0,B=B+Math.imul(sr,Jr)|0,oe=oe+Math.imul(sr,rn)|0,re=re+Math.imul(Ut,ir)|0,B=B+Math.imul(Ut,Er)|0,B=B+Math.imul(vr,ir)|0,oe=oe+Math.imul(vr,Er)|0,re=re+Math.imul(Mt,Rr)|0,B=B+Math.imul(Mt,Ur)|0,B=B+Math.imul(Ft,Rr)|0,oe=oe+Math.imul(Ft,Ur)|0,re=re+Math.imul(Ze,Sr)|0,B=B+Math.imul(Ze,Lr)|0,B=B+Math.imul(lt,Sr)|0,oe=oe+Math.imul(lt,Lr)|0;var Bn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,re=Math.imul(Yt,Jt),B=Math.imul(Yt,xt),B=B+Math.imul(Ir,Jt)|0,oe=Math.imul(Ir,xt),re=re+Math.imul(ur,xr)|0,B=B+Math.imul(ur,wr)|0,B=B+Math.imul(ar,xr)|0,oe=oe+Math.imul(ar,wr)|0,re=re+Math.imul(Mr,Cr)|0,B=B+Math.imul(Mr,Zr)|0,B=B+Math.imul(gr,Cr)|0,oe=oe+Math.imul(gr,Zr)|0,re=re+Math.imul(Ar,yr)|0,B=B+Math.imul(Ar,Tr)|0,B=B+Math.imul(qr,yr)|0,oe=oe+Math.imul(qr,Tr)|0,re=re+Math.imul(Xt,Jr)|0,B=B+Math.imul(Xt,rn)|0,B=B+Math.imul(nr,Jr)|0,oe=oe+Math.imul(nr,rn)|0,re=re+Math.imul(or,ir)|0,B=B+Math.imul(or,Er)|0,B=B+Math.imul(sr,ir)|0,oe=oe+Math.imul(sr,Er)|0,re=re+Math.imul(Ut,Rr)|0,B=B+Math.imul(Ut,Ur)|0,B=B+Math.imul(vr,Rr)|0,oe=oe+Math.imul(vr,Ur)|0,re=re+Math.imul(Mt,Sr)|0,B=B+Math.imul(Mt,Lr)|0,B=B+Math.imul(Ft,Sr)|0,oe=oe+Math.imul(Ft,Lr)|0,re=re+Math.imul(Ze,tn)|0,B=B+Math.imul(Ze,hn)|0,B=B+Math.imul(lt,tn)|0,oe=oe+Math.imul(lt,hn)|0;var Dn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,re=Math.imul(nt,Jt),B=Math.imul(nt,xt),B=B+Math.imul(_t,Jt)|0,oe=Math.imul(_t,xt),re=re+Math.imul(Yt,xr)|0,B=B+Math.imul(Yt,wr)|0,B=B+Math.imul(Ir,xr)|0,oe=oe+Math.imul(Ir,wr)|0,re=re+Math.imul(ur,Cr)|0,B=B+Math.imul(ur,Zr)|0,B=B+Math.imul(ar,Cr)|0,oe=oe+Math.imul(ar,Zr)|0,re=re+Math.imul(Mr,yr)|0,B=B+Math.imul(Mr,Tr)|0,B=B+Math.imul(gr,yr)|0,oe=oe+Math.imul(gr,Tr)|0,re=re+Math.imul(Ar,Jr)|0,B=B+Math.imul(Ar,rn)|0,B=B+Math.imul(qr,Jr)|0,oe=oe+Math.imul(qr,rn)|0,re=re+Math.imul(Xt,ir)|0,B=B+Math.imul(Xt,Er)|0,B=B+Math.imul(nr,ir)|0,oe=oe+Math.imul(nr,Er)|0,re=re+Math.imul(or,Rr)|0,B=B+Math.imul(or,Ur)|0,B=B+Math.imul(sr,Rr)|0,oe=oe+Math.imul(sr,Ur)|0,re=re+Math.imul(Ut,Sr)|0,B=B+Math.imul(Ut,Lr)|0,B=B+Math.imul(vr,Sr)|0,oe=oe+Math.imul(vr,Lr)|0,re=re+Math.imul(Mt,tn)|0,B=B+Math.imul(Mt,hn)|0,B=B+Math.imul(Ft,tn)|0,oe=oe+Math.imul(Ft,hn)|0,re=re+Math.imul(Ze,on)|0,B=B+Math.imul(Ze,cn)|0,B=B+Math.imul(lt,on)|0,oe=oe+Math.imul(lt,cn)|0;var Hn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Hn>>>26)|0,Hn&=67108863,re=Math.imul(nt,xr),B=Math.imul(nt,wr),B=B+Math.imul(_t,xr)|0,oe=Math.imul(_t,wr),re=re+Math.imul(Yt,Cr)|0,B=B+Math.imul(Yt,Zr)|0,B=B+Math.imul(Ir,Cr)|0,oe=oe+Math.imul(Ir,Zr)|0,re=re+Math.imul(ur,yr)|0,B=B+Math.imul(ur,Tr)|0,B=B+Math.imul(ar,yr)|0,oe=oe+Math.imul(ar,Tr)|0,re=re+Math.imul(Mr,Jr)|0,B=B+Math.imul(Mr,rn)|0,B=B+Math.imul(gr,Jr)|0,oe=oe+Math.imul(gr,rn)|0,re=re+Math.imul(Ar,ir)|0,B=B+Math.imul(Ar,Er)|0,B=B+Math.imul(qr,ir)|0,oe=oe+Math.imul(qr,Er)|0,re=re+Math.imul(Xt,Rr)|0,B=B+Math.imul(Xt,Ur)|0,B=B+Math.imul(nr,Rr)|0,oe=oe+Math.imul(nr,Ur)|0,re=re+Math.imul(or,Sr)|0,B=B+Math.imul(or,Lr)|0,B=B+Math.imul(sr,Sr)|0,oe=oe+Math.imul(sr,Lr)|0,re=re+Math.imul(Ut,tn)|0,B=B+Math.imul(Ut,hn)|0,B=B+Math.imul(vr,tn)|0,oe=oe+Math.imul(vr,hn)|0,re=re+Math.imul(Mt,on)|0,B=B+Math.imul(Mt,cn)|0,B=B+Math.imul(Ft,on)|0,oe=oe+Math.imul(Ft,cn)|0;var On=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(On>>>26)|0,On&=67108863,re=Math.imul(nt,Cr),B=Math.imul(nt,Zr),B=B+Math.imul(_t,Cr)|0,oe=Math.imul(_t,Zr),re=re+Math.imul(Yt,yr)|0,B=B+Math.imul(Yt,Tr)|0,B=B+Math.imul(Ir,yr)|0,oe=oe+Math.imul(Ir,Tr)|0,re=re+Math.imul(ur,Jr)|0,B=B+Math.imul(ur,rn)|0,B=B+Math.imul(ar,Jr)|0,oe=oe+Math.imul(ar,rn)|0,re=re+Math.imul(Mr,ir)|0,B=B+Math.imul(Mr,Er)|0,B=B+Math.imul(gr,ir)|0,oe=oe+Math.imul(gr,Er)|0,re=re+Math.imul(Ar,Rr)|0,B=B+Math.imul(Ar,Ur)|0,B=B+Math.imul(qr,Rr)|0,oe=oe+Math.imul(qr,Ur)|0,re=re+Math.imul(Xt,Sr)|0,B=B+Math.imul(Xt,Lr)|0,B=B+Math.imul(nr,Sr)|0,oe=oe+Math.imul(nr,Lr)|0,re=re+Math.imul(or,tn)|0,B=B+Math.imul(or,hn)|0,B=B+Math.imul(sr,tn)|0,oe=oe+Math.imul(sr,hn)|0,re=re+Math.imul(Ut,on)|0,B=B+Math.imul(Ut,cn)|0,B=B+Math.imul(vr,on)|0,oe=oe+Math.imul(vr,cn)|0;var Rn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,re=Math.imul(nt,yr),B=Math.imul(nt,Tr),B=B+Math.imul(_t,yr)|0,oe=Math.imul(_t,Tr),re=re+Math.imul(Yt,Jr)|0,B=B+Math.imul(Yt,rn)|0,B=B+Math.imul(Ir,Jr)|0,oe=oe+Math.imul(Ir,rn)|0,re=re+Math.imul(ur,ir)|0,B=B+Math.imul(ur,Er)|0,B=B+Math.imul(ar,ir)|0,oe=oe+Math.imul(ar,Er)|0,re=re+Math.imul(Mr,Rr)|0,B=B+Math.imul(Mr,Ur)|0,B=B+Math.imul(gr,Rr)|0,oe=oe+Math.imul(gr,Ur)|0,re=re+Math.imul(Ar,Sr)|0,B=B+Math.imul(Ar,Lr)|0,B=B+Math.imul(qr,Sr)|0,oe=oe+Math.imul(qr,Lr)|0,re=re+Math.imul(Xt,tn)|0,B=B+Math.imul(Xt,hn)|0,B=B+Math.imul(nr,tn)|0,oe=oe+Math.imul(nr,hn)|0,re=re+Math.imul(or,on)|0,B=B+Math.imul(or,cn)|0,B=B+Math.imul(sr,on)|0,oe=oe+Math.imul(sr,cn)|0;var qn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(qn>>>26)|0,qn&=67108863,re=Math.imul(nt,Jr),B=Math.imul(nt,rn),B=B+Math.imul(_t,Jr)|0,oe=Math.imul(_t,rn),re=re+Math.imul(Yt,ir)|0,B=B+Math.imul(Yt,Er)|0,B=B+Math.imul(Ir,ir)|0,oe=oe+Math.imul(Ir,Er)|0,re=re+Math.imul(ur,Rr)|0,B=B+Math.imul(ur,Ur)|0,B=B+Math.imul(ar,Rr)|0,oe=oe+Math.imul(ar,Ur)|0,re=re+Math.imul(Mr,Sr)|0,B=B+Math.imul(Mr,Lr)|0,B=B+Math.imul(gr,Sr)|0,oe=oe+Math.imul(gr,Lr)|0,re=re+Math.imul(Ar,tn)|0,B=B+Math.imul(Ar,hn)|0,B=B+Math.imul(qr,tn)|0,oe=oe+Math.imul(qr,hn)|0,re=re+Math.imul(Xt,on)|0,B=B+Math.imul(Xt,cn)|0,B=B+Math.imul(nr,on)|0,oe=oe+Math.imul(nr,cn)|0;var In=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(In>>>26)|0,In&=67108863,re=Math.imul(nt,ir),B=Math.imul(nt,Er),B=B+Math.imul(_t,ir)|0,oe=Math.imul(_t,Er),re=re+Math.imul(Yt,Rr)|0,B=B+Math.imul(Yt,Ur)|0,B=B+Math.imul(Ir,Rr)|0,oe=oe+Math.imul(Ir,Ur)|0,re=re+Math.imul(ur,Sr)|0,B=B+Math.imul(ur,Lr)|0,B=B+Math.imul(ar,Sr)|0,oe=oe+Math.imul(ar,Lr)|0,re=re+Math.imul(Mr,tn)|0,B=B+Math.imul(Mr,hn)|0,B=B+Math.imul(gr,tn)|0,oe=oe+Math.imul(gr,hn)|0,re=re+Math.imul(Ar,on)|0,B=B+Math.imul(Ar,cn)|0,B=B+Math.imul(qr,on)|0,oe=oe+Math.imul(qr,cn)|0;var Pn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Pn>>>26)|0,Pn&=67108863,re=Math.imul(nt,Rr),B=Math.imul(nt,Ur),B=B+Math.imul(_t,Rr)|0,oe=Math.imul(_t,Ur),re=re+Math.imul(Yt,Sr)|0,B=B+Math.imul(Yt,Lr)|0,B=B+Math.imul(Ir,Sr)|0,oe=oe+Math.imul(Ir,Lr)|0,re=re+Math.imul(ur,tn)|0,B=B+Math.imul(ur,hn)|0,B=B+Math.imul(ar,tn)|0,oe=oe+Math.imul(ar,hn)|0,re=re+Math.imul(Mr,on)|0,B=B+Math.imul(Mr,cn)|0,B=B+Math.imul(gr,on)|0,oe=oe+Math.imul(gr,cn)|0;var Cn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Cn>>>26)|0,Cn&=67108863,re=Math.imul(nt,Sr),B=Math.imul(nt,Lr),B=B+Math.imul(_t,Sr)|0,oe=Math.imul(_t,Lr),re=re+Math.imul(Yt,tn)|0,B=B+Math.imul(Yt,hn)|0,B=B+Math.imul(Ir,tn)|0,oe=oe+Math.imul(Ir,hn)|0,re=re+Math.imul(ur,on)|0,B=B+Math.imul(ur,cn)|0,B=B+Math.imul(ar,on)|0,oe=oe+Math.imul(ar,cn)|0;var Fn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,re=Math.imul(nt,tn),B=Math.imul(nt,hn),B=B+Math.imul(_t,tn)|0,oe=Math.imul(_t,hn),re=re+Math.imul(Yt,on)|0,B=B+Math.imul(Yt,cn)|0,B=B+Math.imul(Ir,on)|0,oe=oe+Math.imul(Ir,cn)|0;var Ln=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,re=Math.imul(nt,on),B=Math.imul(nt,cn),B=B+Math.imul(_t,on)|0,oe=Math.imul(_t,cn);var Un=(ve+re|0)+((B&8191)<<13)|0;return ve=(oe+(B>>>13)|0)+(Un>>>26)|0,Un&=67108863,$e[0]=vn,$e[1]=_n,$e[2]=Mn,$e[3]=xn,$e[4]=Nn,$e[5]=zn,$e[6]=An,$e[7]=Bn,$e[8]=Dn,$e[9]=Hn,$e[10]=On,$e[11]=Rn,$e[12]=qn,$e[13]=In,$e[14]=Pn,$e[15]=Cn,$e[16]=Fn,$e[17]=Ln,$e[18]=Un,ve!==0&&($e[19]=ve,k.length++),k};Math.imul||(Ce=ne);function Le(se,m,A){A.negative=m.negative^se.negative,A.length=se.length+m.length;for(var k=0,Y=0,Q=0;Q<A.length-1;Q++){var $e=Y;Y=0;for(var ve=k&67108863,re=Math.min(Q,m.length-1),B=Math.max(0,Q-se.length+1);B<=re;B++){var oe=Q-B,Ue=se.words[oe]|0,Ze=m.words[B]|0,lt=Ue*Ze,St=lt&67108863;$e=$e+(lt/67108864|0)|0,St=St+ve|0,ve=St&67108863,$e=$e+(St>>>26)|0,Y+=$e>>>26,$e&=67108863}A.words[Q]=ve,k=$e,$e=Y}return k!==0?A.words[Q]=k:A.length--,A.strip()}function Ge(se,m,A){var k=new ze;return k.mulp(se,m,A)}c.prototype.mulTo=function(m,A){var k,Y=this.length+m.length;return this.length===10&&m.length===10?k=Ce(this,m,A):Y<63?k=ne(this,m,A):Y<1024?k=Le(this,m,A):k=Ge(this,m,A),k};function ze(se,m){this.x=se,this.y=m}ze.prototype.makeRBT=function(m){for(var A=new Array(m),k=c.prototype._countBits(m)-1,Y=0;Y<m;Y++)A[Y]=this.revBin(Y,k,m);return A},ze.prototype.revBin=function(m,A,k){if(m===0||m===k-1)return m;for(var Y=0,Q=0;Q<A;Q++)Y|=(m&1)<<A-Q-1,m>>=1;return Y},ze.prototype.permute=function(m,A,k,Y,Q,$e){for(var ve=0;ve<$e;ve++)Y[ve]=A[m[ve]],Q[ve]=k[m[ve]]},ze.prototype.transform=function(m,A,k,Y,Q,$e){this.permute($e,m,A,k,Y,Q);for(var ve=1;ve<Q;ve<<=1)for(var re=ve<<1,B=Math.cos(2*Math.PI/re),oe=Math.sin(2*Math.PI/re),Ue=0;Ue<Q;Ue+=re)for(var Ze=B,lt=oe,St=0;St<ve;St++){var Mt=k[Ue+St],Ft=Y[Ue+St],Zt=k[Ue+St+ve],Ut=Y[Ue+St+ve],vr=Ze*Zt-lt*Ut;Ut=Ze*Ut+lt*Zt,Zt=vr,k[Ue+St]=Mt+Zt,Y[Ue+St]=Ft+Ut,k[Ue+St+ve]=Mt-Zt,Y[Ue+St+ve]=Ft-Ut,St!==re&&(vr=B*Ze-oe*lt,lt=B*lt+oe*Ze,Ze=vr)}},ze.prototype.guessLen13b=function(m,A){var k=Math.max(A,m)|1,Y=k&1,Q=0;for(k=k/2|0;k;k=k>>>1)Q++;return 1<<Q+1+Y},ze.prototype.conjugate=function(m,A,k){if(!(k<=1))for(var Y=0;Y<k/2;Y++){var Q=m[Y];m[Y]=m[k-Y-1],m[k-Y-1]=Q,Q=A[Y],A[Y]=-A[k-Y-1],A[k-Y-1]=-Q}},ze.prototype.normalize13b=function(m,A){for(var k=0,Y=0;Y<A/2;Y++){var Q=Math.round(m[2*Y+1]/A)*8192+Math.round(m[2*Y]/A)+k;m[Y]=Q&67108863,Q<67108864?k=0:k=Q/67108864|0}return m},ze.prototype.convert13b=function(m,A,k,Y){for(var Q=0,$e=0;$e<A;$e++)Q=Q+(m[$e]|0),k[2*$e]=Q&8191,Q=Q>>>13,k[2*$e+1]=Q&8191,Q=Q>>>13;for($e=2*A;$e<Y;++$e)k[$e]=0;o(Q===0),o((Q&-8192)===0)},ze.prototype.stub=function(m){for(var A=new Array(m),k=0;k<m;k++)A[k]=0;return A},ze.prototype.mulp=function(m,A,k){var Y=2*this.guessLen13b(m.length,A.length),Q=this.makeRBT(Y),$e=this.stub(Y),ve=new Array(Y),re=new Array(Y),B=new Array(Y),oe=new Array(Y),Ue=new Array(Y),Ze=new Array(Y),lt=k.words;lt.length=Y,this.convert13b(m.words,m.length,ve,Y),this.convert13b(A.words,A.length,oe,Y),this.transform(ve,$e,re,B,Y,Q),this.transform(oe,$e,Ue,Ze,Y,Q);for(var St=0;St<Y;St++){var Mt=re[St]*Ue[St]-B[St]*Ze[St];B[St]=re[St]*Ze[St]+B[St]*Ue[St],re[St]=Mt}return this.conjugate(re,B,Y),this.transform(re,B,lt,$e,Y,Q),this.conjugate(lt,$e,Y),this.normalize13b(lt,Y),k.negative=m.negative^A.negative,k.length=m.length+A.length,k.strip()},c.prototype.mul=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),this.mulTo(m,A)},c.prototype.mulf=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),Ge(this,m,A)},c.prototype.imul=function(m){return this.clone().mulTo(m,this)},c.prototype.imuln=function(m){o(typeof m=="number"),o(m<67108864);for(var A=0,k=0;k<this.length;k++){var Y=(this.words[k]|0)*m,Q=(Y&67108863)+(A&67108863);A>>=26,A+=Y/67108864|0,A+=Q>>>26,this.words[k]=Q&67108863}return A!==0&&(this.words[k]=A,this.length++),this.length=m===0?1:this.length,this},c.prototype.muln=function(m){return this.clone().imuln(m)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(m){var A=te(m);if(A.length===0)return new c(1);for(var k=this,Y=0;Y<A.length&&A[Y]===0;Y++,k=k.sqr());if(++Y<A.length)for(var Q=k.sqr();Y<A.length;Y++,Q=Q.sqr())A[Y]!==0&&(k=k.mul(Q));return k},c.prototype.iushln=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=67108863>>>26-A<<26-A,Q;if(A!==0){var $e=0;for(Q=0;Q<this.length;Q++){var ve=this.words[Q]&Y,re=(this.words[Q]|0)-ve<<A;this.words[Q]=re|$e,$e=ve>>>26-A}$e&&(this.words[Q]=$e,this.length++)}if(k!==0){for(Q=this.length-1;Q>=0;Q--)this.words[Q+k]=this.words[Q];for(Q=0;Q<k;Q++)this.words[Q]=0;this.length+=k}return this.strip()},c.prototype.ishln=function(m){return o(this.negative===0),this.iushln(m)},c.prototype.iushrn=function(m,A,k){o(typeof m=="number"&&m>=0);var Y;A?Y=(A-A%26)/26:Y=0;var Q=m%26,$e=Math.min((m-Q)/26,this.length),ve=67108863^67108863>>>Q<<Q,re=k;if(Y-=$e,Y=Math.max(0,Y),re){for(var B=0;B<$e;B++)re.words[B]=this.words[B];re.length=$e}if($e!==0)if(this.length>$e)for(this.length-=$e,B=0;B<this.length;B++)this.words[B]=this.words[B+$e];else this.words[0]=0,this.length=1;var oe=0;for(B=this.length-1;B>=0&&(oe!==0||B>=Y);B--){var Ue=this.words[B]|0;this.words[B]=oe<<26-Q|Ue>>>Q,oe=Ue&ve}return re&&oe!==0&&(re.words[re.length++]=oe),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},c.prototype.ishrn=function(m,A,k){return o(this.negative===0),this.iushrn(m,A,k)},c.prototype.shln=function(m){return this.clone().ishln(m)},c.prototype.ushln=function(m){return this.clone().iushln(m)},c.prototype.shrn=function(m){return this.clone().ishrn(m)},c.prototype.ushrn=function(m){return this.clone().iushrn(m)},c.prototype.testn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return!1;var Q=this.words[k];return!!(Q&Y)},c.prototype.imaskn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26;if(o(this.negative===0,"imaskn works only with positive numbers"),this.length<=k)return this;if(A!==0&&k++,this.length=Math.min(k,this.length),A!==0){var Y=67108863^67108863>>>A<<A;this.words[this.length-1]&=Y}return this.strip()},c.prototype.maskn=function(m){return this.clone().imaskn(m)},c.prototype.iaddn=function(m){return o(typeof m=="number"),o(m<67108864),m<0?this.isubn(-m):this.negative!==0?this.length===1&&(this.words[0]|0)<m?(this.words[0]=m-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(m),this.negative=1,this):this._iaddn(m)},c.prototype._iaddn=function(m){this.words[0]+=m;for(var A=0;A<this.length&&this.words[A]>=67108864;A++)this.words[A]-=67108864,A===this.length-1?this.words[A+1]=1:this.words[A+1]++;return this.length=Math.max(this.length,A+1),this},c.prototype.isubn=function(m){if(o(typeof m=="number"),o(m<67108864),m<0)return this.iaddn(-m);if(this.negative!==0)return this.negative=0,this.iaddn(m),this.negative=1,this;if(this.words[0]-=m,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var A=0;A<this.length&&this.words[A]<0;A++)this.words[A]+=67108864,this.words[A+1]-=1;return this.strip()},c.prototype.addn=function(m){return this.clone().iaddn(m)},c.prototype.subn=function(m){return this.clone().isubn(m)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(m,A,k){var Y=m.length+k,Q;this._expand(Y);var $e,ve=0;for(Q=0;Q<m.length;Q++){$e=(this.words[Q+k]|0)+ve;var re=(m.words[Q]|0)*A;$e-=re&67108863,ve=($e>>26)-(re/67108864|0),this.words[Q+k]=$e&67108863}for(;Q<this.length-k;Q++)$e=(this.words[Q+k]|0)+ve,ve=$e>>26,this.words[Q+k]=$e&67108863;if(ve===0)return this.strip();for(o(ve===-1),ve=0,Q=0;Q<this.length;Q++)$e=-(this.words[Q]|0)+ve,ve=$e>>26,this.words[Q]=$e&67108863;return this.negative=1,this.strip()},c.prototype._wordDiv=function(m,A){var k=this.length-m.length,Y=this.clone(),Q=m,$e=Q.words[Q.length-1]|0,ve=this._countBits($e);k=26-ve,k!==0&&(Q=Q.ushln(k),Y.iushln(k),$e=Q.words[Q.length-1]|0);var re=Y.length-Q.length,B;if(A!=="mod"){B=new c(null),B.length=re+1,B.words=new Array(B.length);for(var oe=0;oe<B.length;oe++)B.words[oe]=0}var Ue=Y.clone()._ishlnsubmul(Q,1,re);Ue.negative===0&&(Y=Ue,B&&(B.words[re]=1));for(var Ze=re-1;Ze>=0;Ze--){var lt=(Y.words[Q.length+Ze]|0)*67108864+(Y.words[Q.length+Ze-1]|0);for(lt=Math.min(lt/$e|0,67108863),Y._ishlnsubmul(Q,lt,Ze);Y.negative!==0;)lt--,Y.negative=0,Y._ishlnsubmul(Q,1,Ze),!Y.isZero()&&(Y.negative^=1);B&&(B.words[Ze]=lt)}return B&&B.strip(),Y.strip(),A!=="div"&&k!==0&&Y.iushrn(k),{div:B||null,mod:Y}},c.prototype.divmod=function(m,A,k){if(o(!m.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var Y,Q,$e;return this.negative!==0&&m.negative===0?($e=this.neg().divmod(m,A),A!=="mod"&&(Y=$e.div.neg()),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.iadd(m)),{div:Y,mod:Q}):this.negative===0&&m.negative!==0?($e=this.divmod(m.neg(),A),A!=="mod"&&(Y=$e.div.neg()),{div:Y,mod:$e.mod}):(this.negative&m.negative)!==0?($e=this.neg().divmod(m.neg(),A),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.isub(m)),{div:$e.div,mod:Q}):m.length>this.length||this.cmp(m)<0?{div:new c(0),mod:this}:m.length===1?A==="div"?{div:this.divn(m.words[0]),mod:null}:A==="mod"?{div:null,mod:new c(this.modn(m.words[0]))}:{div:this.divn(m.words[0]),mod:new c(this.modn(m.words[0]))}:this._wordDiv(m,A)},c.prototype.div=function(m){return this.divmod(m,"div",!1).div},c.prototype.mod=function(m){return this.divmod(m,"mod",!1).mod},c.prototype.umod=function(m){return this.divmod(m,"mod",!0).mod},c.prototype.divRound=function(m){var A=this.divmod(m);if(A.mod.isZero())return A.div;var k=A.div.negative!==0?A.mod.isub(m):A.mod,Y=m.ushrn(1),Q=m.andln(1),$e=k.cmp(Y);return $e<0||Q===1&&$e===0?A.div:A.div.negative!==0?A.div.isubn(1):A.div.iaddn(1)},c.prototype.modn=function(m){o(m<=67108863);for(var A=67108864%m,k=0,Y=this.length-1;Y>=0;Y--)k=(A*k+(this.words[Y]|0))%m;return k},c.prototype.idivn=function(m){o(m<=67108863);for(var A=0,k=this.length-1;k>=0;k--){var Y=(this.words[k]|0)+A*67108864;this.words[k]=Y/m|0,A=Y%m}return this.strip()},c.prototype.divn=function(m){return this.clone().idivn(m)},c.prototype.egcd=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=new c(0),ve=new c(1),re=0;A.isEven()&&k.isEven();)A.iushrn(1),k.iushrn(1),++re;for(var B=k.clone(),oe=A.clone();!A.isZero();){for(var Ue=0,Ze=1;(A.words[0]&Ze)===0&&Ue<26;++Ue,Ze<<=1);if(Ue>0)for(A.iushrn(Ue);Ue-- >0;)(Y.isOdd()||Q.isOdd())&&(Y.iadd(B),Q.isub(oe)),Y.iushrn(1),Q.iushrn(1);for(var lt=0,St=1;(k.words[0]&St)===0&&lt<26;++lt,St<<=1);if(lt>0)for(k.iushrn(lt);lt-- >0;)($e.isOdd()||ve.isOdd())&&($e.iadd(B),ve.isub(oe)),$e.iushrn(1),ve.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub($e),Q.isub(ve)):(k.isub(A),$e.isub(Y),ve.isub(Q))}return{a:$e,b:ve,gcd:k.iushln(re)}},c.prototype._invmp=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=k.clone();A.cmpn(1)>0&&k.cmpn(1)>0;){for(var ve=0,re=1;(A.words[0]&re)===0&&ve<26;++ve,re<<=1);if(ve>0)for(A.iushrn(ve);ve-- >0;)Y.isOdd()&&Y.iadd($e),Y.iushrn(1);for(var B=0,oe=1;(k.words[0]&oe)===0&&B<26;++B,oe<<=1);if(B>0)for(k.iushrn(B);B-- >0;)Q.isOdd()&&Q.iadd($e),Q.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub(Q)):(k.isub(A),Q.isub(Y))}var Ue;return A.cmpn(1)===0?Ue=Y:Ue=Q,Ue.cmpn(0)<0&&Ue.iadd(m),Ue},c.prototype.gcd=function(m){if(this.isZero())return m.abs();if(m.isZero())return this.abs();var A=this.clone(),k=m.clone();A.negative=0,k.negative=0;for(var Y=0;A.isEven()&&k.isEven();Y++)A.iushrn(1),k.iushrn(1);do{for(;A.isEven();)A.iushrn(1);for(;k.isEven();)k.iushrn(1);var Q=A.cmp(k);if(Q<0){var $e=A;A=k,k=$e}else if(Q===0||k.cmpn(1)===0)break;A.isub(k)}while(!0);return k.iushln(Y)},c.prototype.invm=function(m){return this.egcd(m).a.umod(m)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(m){return this.words[0]&m},c.prototype.bincn=function(m){o(typeof m=="number");var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return this._expand(k+1),this.words[k]|=Y,this;for(var Q=Y,$e=k;Q!==0&&$e<this.length;$e++){var ve=this.words[$e]|0;ve+=Q,Q=ve>>>26,ve&=67108863,this.words[$e]=ve}return Q!==0&&(this.words[$e]=Q,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(m){var A=m<0;if(this.negative!==0&&!A)return-1;if(this.negative===0&&A)return 1;this.strip();var k;if(this.length>1)k=1;else{A&&(m=-m),o(m<=67108863,"Number is too big");var Y=this.words[0]|0;k=Y===m?0:Y<m?-1:1}return this.negative!==0?-k|0:k},c.prototype.cmp=function(m){if(this.negative!==0&&m.negative===0)return-1;if(this.negative===0&&m.negative!==0)return 1;var A=this.ucmp(m);return this.negative!==0?-A|0:A},c.prototype.ucmp=function(m){if(this.length>m.length)return 1;if(this.length<m.length)return-1;for(var A=0,k=this.length-1;k>=0;k--){var Y=this.words[k]|0,Q=m.words[k]|0;if(Y!==Q){Y<Q?A=-1:Y>Q&&(A=1);break}}return A},c.prototype.gtn=function(m){return this.cmpn(m)===1},c.prototype.gt=function(m){return this.cmp(m)===1},c.prototype.gten=function(m){return this.cmpn(m)>=0},c.prototype.gte=function(m){return this.cmp(m)>=0},c.prototype.ltn=function(m){return this.cmpn(m)===-1},c.prototype.lt=function(m){return this.cmp(m)===-1},c.prototype.lten=function(m){return this.cmpn(m)<=0},c.prototype.lte=function(m){return this.cmp(m)<=0},c.prototype.eqn=function(m){return this.cmpn(m)===0},c.prototype.eq=function(m){return this.cmp(m)===0},c.red=function(m){return new ht(m)},c.prototype.toRed=function(m){return o(!this.red,"Already a number in reduction context"),o(this.negative===0,"red works only with positives"),m.convertTo(this)._forceRed(m)},c.prototype.fromRed=function(){return o(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(m){return this.red=m,this},c.prototype.forceRed=function(m){return o(!this.red,"Already a number in reduction context"),this._forceRed(m)},c.prototype.redAdd=function(m){return o(this.red,"redAdd works only with red numbers"),this.red.add(this,m)},c.prototype.redIAdd=function(m){return o(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,m)},c.prototype.redSub=function(m){return o(this.red,"redSub works only with red numbers"),this.red.sub(this,m)},c.prototype.redISub=function(m){return o(this.red,"redISub works only with red numbers"),this.red.isub(this,m)},c.prototype.redShl=function(m){return o(this.red,"redShl works only with red numbers"),this.red.shl(this,m)},c.prototype.redMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.mul(this,m)},c.prototype.redIMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.imul(this,m)},c.prototype.redSqr=function(){return o(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return o(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return o(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return o(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return o(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(m){return o(this.red&&!m.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,m)};var Xe={k256:null,p224:null,p192:null,p25519:null};function He(se,m){this.name=se,this.p=new c(m,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}He.prototype._tmp=function(){var m=new c(null);return m.words=new Array(Math.ceil(this.n/13)),m},He.prototype.ireduce=function(m){var A=m,k;do this.split(A,this.tmp),A=this.imulK(A),A=A.iadd(this.tmp),k=A.bitLength();while(k>this.n);var Y=k<this.n?-1:A.ucmp(this.p);return Y===0?(A.words[0]=0,A.length=1):Y>0?A.isub(this.p):A.strip!==void 0?A.strip():A._strip(),A},He.prototype.split=function(m,A){m.iushrn(this.n,0,A)},He.prototype.imulK=function(m){return m.imul(this.k)};function Ve(){He.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(Ve,He),Ve.prototype.split=function(m,A){for(var k=4194303,Y=Math.min(m.length,9),Q=0;Q<Y;Q++)A.words[Q]=m.words[Q];if(A.length=Y,m.length<=9){m.words[0]=0,m.length=1;return}var $e=m.words[9];for(A.words[A.length++]=$e&k,Q=10;Q<m.length;Q++){var ve=m.words[Q]|0;m.words[Q-10]=(ve&k)<<4|$e>>>22,$e=ve}$e>>>=22,m.words[Q-10]=$e,$e===0&&m.length>10?m.length-=10:m.length-=9},Ve.prototype.imulK=function(m){m.words[m.length]=0,m.words[m.length+1]=0,m.length+=2;for(var A=0,k=0;k<m.length;k++){var Y=m.words[k]|0;A+=Y*977,m.words[k]=A&67108863,A=Y*64+(A/67108864|0)}return m.words[m.length-1]===0&&(m.length--,m.words[m.length-1]===0&&m.length--),m};function We(){He.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(We,He);function rt(){He.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(rt,He);function st(){He.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(st,He),st.prototype.imulK=function(m){for(var A=0,k=0;k<m.length;k++){var Y=(m.words[k]|0)*19+A,Q=Y&67108863;Y>>>=26,m.words[k]=Q,A=Y}return A!==0&&(m.words[m.length++]=A),m},c._prime=function(m){if(Xe[m])return Xe[m];var A;if(m==="k256")A=new Ve;else if(m==="p224")A=new We;else if(m==="p192")A=new rt;else if(m==="p25519")A=new st;else throw new Error("Unknown prime "+m);return Xe[m]=A,A};function ht(se){if(typeof se=="string"){var m=c._prime(se);this.m=m.p,this.prime=m}else o(se.gtn(1),"modulus must be greater than 1"),this.m=se,this.prime=null}ht.prototype._verify1=function(m){o(m.negative===0,"red works only with positives"),o(m.red,"red works only with red numbers")},ht.prototype._verify2=function(m,A){o((m.negative|A.negative)===0,"red works only with positives"),o(m.red&&m.red===A.red,"red works only with red numbers")},ht.prototype.imod=function(m){return this.prime?this.prime.ireduce(m)._forceRed(this):m.umod(this.m)._forceRed(this)},ht.prototype.neg=function(m){return m.isZero()?m.clone():this.m.sub(m)._forceRed(this)},ht.prototype.add=function(m,A){this._verify2(m,A);var k=m.add(A);return k.cmp(this.m)>=0&&k.isub(this.m),k._forceRed(this)},ht.prototype.iadd=function(m,A){this._verify2(m,A);var k=m.iadd(A);return k.cmp(this.m)>=0&&k.isub(this.m),k},ht.prototype.sub=function(m,A){this._verify2(m,A);var k=m.sub(A);return k.cmpn(0)<0&&k.iadd(this.m),k._forceRed(this)},ht.prototype.isub=function(m,A){this._verify2(m,A);var k=m.isub(A);return k.cmpn(0)<0&&k.iadd(this.m),k},ht.prototype.shl=function(m,A){return this._verify1(m),this.imod(m.ushln(A))},ht.prototype.imul=function(m,A){return this._verify2(m,A),this.imod(m.imul(A))},ht.prototype.mul=function(m,A){return this._verify2(m,A),this.imod(m.mul(A))},ht.prototype.isqr=function(m){return this.imul(m,m.clone())},ht.prototype.sqr=function(m){return this.mul(m,m)},ht.prototype.sqrt=function(m){if(m.isZero())return m.clone();var A=this.m.andln(3);if(o(A%2===1),A===3){var k=this.m.add(new c(1)).iushrn(2);return this.pow(m,k)}for(var Y=this.m.subn(1),Q=0;!Y.isZero()&&Y.andln(1)===0;)Q++,Y.iushrn(1);o(!Y.isZero());var $e=new c(1).toRed(this),ve=$e.redNeg(),re=this.m.subn(1).iushrn(1),B=this.m.bitLength();for(B=new c(2*B*B).toRed(this);this.pow(B,re).cmp(ve)!==0;)B.redIAdd(ve);for(var oe=this.pow(B,Y),Ue=this.pow(m,Y.addn(1).iushrn(1)),Ze=this.pow(m,Y),lt=Q;Ze.cmp($e)!==0;){for(var St=Ze,Mt=0;St.cmp($e)!==0;Mt++)St=St.redSqr();o(Mt<lt);var Ft=this.pow(oe,new c(1).iushln(lt-Mt-1));Ue=Ue.redMul(Ft),oe=Ft.redSqr(),Ze=Ze.redMul(oe),lt=Mt}return Ue},ht.prototype.invm=function(m){var A=m._invmp(this.m);return A.negative!==0?(A.negative=0,this.imod(A).redNeg()):this.imod(A)},ht.prototype.pow=function(m,A){if(A.isZero())return new c(1).toRed(this);if(A.cmpn(1)===0)return m.clone();var k=4,Y=new Array(1<<k);Y[0]=new c(1).toRed(this),Y[1]=m;for(var Q=2;Q<Y.length;Q++)Y[Q]=this.mul(Y[Q-1],m);var $e=Y[0],ve=0,re=0,B=A.bitLength()%26;for(B===0&&(B=26),Q=A.length-1;Q>=0;Q--){for(var oe=A.words[Q],Ue=B-1;Ue>=0;Ue--){var Ze=oe>>Ue&1;if($e!==Y[0]&&($e=this.sqr($e)),Ze===0&&ve===0){re=0;continue}ve<<=1,ve|=Ze,re++,!(re!==k&&(Q!==0||Ue!==0))&&($e=this.mul($e,Y[ve]),re=0,ve=0)}B=26}return $e},ht.prototype.convertTo=function(m){var A=m.umod(this.m);return A===m?A.clone():A},ht.prototype.convertFrom=function(m){var A=m.clone();return A.red=null,A},c.mont=function(m){return new je(m)};function je(se){ht.call(this,se),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(je,ht),je.prototype.convertTo=function(m){return this.imod(m.ushln(this.shift))},je.prototype.convertFrom=function(m){var A=this.imod(m.mul(this.rinv));return A.red=null,A},je.prototype.imul=function(m,A){if(m.isZero()||A.isZero())return m.words[0]=0,m.length=1,m;var k=m.imul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.mul=function(m,A){if(m.isZero()||A.isZero())return new c(0)._forceRed(this);var k=m.mul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.invm=function(m){var A=this.imod(m._invmp(this.m).mul(this.r2));return A._forceRed(this)}})(typeof t>"u"||t,r)}),require_minimalistic_assert=__commonJS2((r,t)=>{t.exports=n;function n(s,o){if(!s)throw new Error(o||"Assertion failed")}n.equal=function(o,a,c){if(o!=a)throw new Error(c||"Assertion failed: "+o+" != "+a)}}),require_utils=__commonJS2(r=>{var t=r;function n(a,c){if(Array.isArray(a))return a.slice();if(!a)return[];var f=[];if(typeof a!="string"){for(var g=0;g<a.length;g++)f[g]=a[g]|0;return f}if(c==="hex"){a=a.replace(/[^a-z0-9]+/ig,""),a.length%2!==0&&(a="0"+a);for(var g=0;g<a.length;g+=2)f.push(parseInt(a[g]+a[g+1],16))}else for(var g=0;g<a.length;g++){var b=a.charCodeAt(g),_=b>>8,L=b&255;_?f.push(_,L):f.push(L)}return f}t.toArray=n;function s(a){return a.length===1?"0"+a:a}t.zero2=s;function o(a){for(var c="",f=0;f<a.length;f++)c+=s(a[f].toString(16));return c}t.toHex=o,t.encode=function(c,f){return f==="hex"?o(c):c}}),require_utils2=__commonJS2(r=>{var t=r,n=require_bn(),s=require_minimalistic_assert(),o=require_utils();t.assert=s,t.toArray=o.toArray,t.zero2=o.zero2,t.toHex=o.toHex,t.encode=o.encode;function a(_,L,q){var X=new Array(Math.max(_.bitLength(),q)+1),te;for(te=0;te<X.length;te+=1)X[te]=0;var ne=1<<L+1,Ce=_.clone();for(te=0;te<X.length;te++){var Le,Ge=Ce.andln(ne-1);Ce.isOdd()?(Ge>(ne>>1)-1?Le=(ne>>1)-Ge:Le=Ge,Ce.isubn(Le)):Le=0,X[te]=Le,Ce.iushrn(1)}return X}t.getNAF=a;function c(_,L){var q=[[],[]];_=_.clone(),L=L.clone();for(var X=0,te=0,ne;_.cmpn(-X)>0||L.cmpn(-te)>0;){var Ce=_.andln(3)+X&3,Le=L.andln(3)+te&3;Ce===3&&(Ce=-1),Le===3&&(Le=-1);var Ge;(Ce&1)===0?Ge=0:(ne=_.andln(7)+X&7,(ne===3||ne===5)&&Le===2?Ge=-Ce:Ge=Ce),q[0].push(Ge);var ze;(Le&1)===0?ze=0:(ne=L.andln(7)+te&7,(ne===3||ne===5)&&Ce===2?ze=-Le:ze=Le),q[1].push(ze),2*X===Ge+1&&(X=1-X),2*te===ze+1&&(te=1-te),_.iushrn(1),L.iushrn(1)}return q}t.getJSF=c;function f(_,L,q){var X="_"+L;_.prototype[L]=function(){return this[X]!==void 0?this[X]:this[X]=q.call(this)}}t.cachedProperty=f;function g(_){return typeof _=="string"?t.toArray(_,"hex"):_}t.parseBytes=g;function b(_){return new n(_,"hex","le")}t.intFromLE=b}),require_brorand=__commonJS2((r,t)=>{var n;t.exports=function(c){return n||(n=new s(null)),n.generate(c)};function s(a){this.rand=a}if(t.exports.Rand=s,s.prototype.generate=function(c){return this._rand(c)},s.prototype._rand=function(c){if(this.rand.getBytes)return this.rand.getBytes(c);for(var f=new Uint8Array(c),g=0;g<f.length;g++)f[g]=this.rand.getByte();return f},typeof self=="object")self.crypto&&self.crypto.getRandomValues?s.prototype._rand=function(c){var f=new Uint8Array(c);return self.crypto.getRandomValues(f),f}:self.msCrypto&&self.msCrypto.getRandomValues?s.prototype._rand=function(c){var f=new Uint8Array(c);return self.msCrypto.getRandomValues(f),f}:typeof window=="object"&&(s.prototype._rand=function(){throw new Error("Not implemented yet")});else try{if(o=(init_crypto(),__toCommonJS(exports_crypto)),typeof o.randomBytes!="function")throw new Error("Not supported");s.prototype._rand=function(c){return o.randomBytes(c)}}catch{}var o}),require_base=__commonJS2((r,t)=>{var n=require_bn(),s=require_utils2(),o=s.getNAF,a=s.getJSF,c=s.assert;function f(b,_){this.type=b,this.p=new n(_.p,16),this.red=_.prime?n.red(_.prime):n.mont(this.p),this.zero=new n(0).toRed(this.red),this.one=new n(1).toRed(this.red),this.two=new n(2).toRed(this.red),this.n=_.n&&new n(_.n,16),this.g=_.g&&this.pointFromJSON(_.g,_.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var L=this.n&&this.p.div(this.n);!L||L.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}t.exports=f,f.prototype.point=function(){throw new Error("Not implemented")},f.prototype.validate=function(){throw new Error("Not implemented")},f.prototype._fixedNafMul=function(_,L){c(_.precomputed);var q=_._getDoubles(),X=o(L,1,this._bitLength),te=(1<<q.step+1)-(q.step%2===0?2:1);te/=3;var ne=[],Ce,Le;for(Ce=0;Ce<X.length;Ce+=q.step){Le=0;for(var Ge=Ce+q.step-1;Ge>=Ce;Ge--)Le=(Le<<1)+X[Ge];ne.push(Le)}for(var ze=this.jpoint(null,null,null),Xe=this.jpoint(null,null,null),He=te;He>0;He--){for(Ce=0;Ce<ne.length;Ce++)Le=ne[Ce],Le===He?Xe=Xe.mixedAdd(q.points[Ce]):Le===-He&&(Xe=Xe.mixedAdd(q.points[Ce].neg()));ze=ze.add(Xe)}return ze.toP()},f.prototype._wnafMul=function(_,L){var q=4,X=_._getNAFPoints(q);q=X.wnd;for(var te=X.points,ne=o(L,q,this._bitLength),Ce=this.jpoint(null,null,null),Le=ne.length-1;Le>=0;Le--){for(var Ge=0;Le>=0&&ne[Le]===0;Le--)Ge++;if(Le>=0&&Ge++,Ce=Ce.dblp(Ge),Le<0)break;var ze=ne[Le];c(ze!==0),_.type==="affine"?ze>0?Ce=Ce.mixedAdd(te[ze-1>>1]):Ce=Ce.mixedAdd(te[-ze-1>>1].neg()):ze>0?Ce=Ce.add(te[ze-1>>1]):Ce=Ce.add(te[-ze-1>>1].neg())}return _.type==="affine"?Ce.toP():Ce},f.prototype._wnafMulAdd=function(_,L,q,X,te){var ne=this._wnafT1,Ce=this._wnafT2,Le=this._wnafT3,Ge=0,ze,Xe,He;for(ze=0;ze<X;ze++){He=L[ze];var Ve=He._getNAFPoints(_);ne[ze]=Ve.wnd,Ce[ze]=Ve.points}for(ze=X-1;ze>=1;ze-=2){var We=ze-1,rt=ze;if(ne[We]!==1||ne[rt]!==1){Le[We]=o(q[We],ne[We],this._bitLength),Le[rt]=o(q[rt],ne[rt],this._bitLength),Ge=Math.max(Le[We].length,Ge),Ge=Math.max(Le[rt].length,Ge);continue}var st=[L[We],null,null,L[rt]];L[We].y.cmp(L[rt].y)===0?(st[1]=L[We].add(L[rt]),st[2]=L[We].toJ().mixedAdd(L[rt].neg())):L[We].y.cmp(L[rt].y.redNeg())===0?(st[1]=L[We].toJ().mixedAdd(L[rt]),st[2]=L[We].add(L[rt].neg())):(st[1]=L[We].toJ().mixedAdd(L[rt]),st[2]=L[We].toJ().mixedAdd(L[rt].neg()));var ht=[-3,-1,-5,-7,0,7,5,1,3],je=a(q[We],q[rt]);for(Ge=Math.max(je[0].length,Ge),Le[We]=new Array(Ge),Le[rt]=new Array(Ge),Xe=0;Xe<Ge;Xe++){var se=je[0][Xe]|0,m=je[1][Xe]|0;Le[We][Xe]=ht[(se+1)*3+(m+1)],Le[rt][Xe]=0,Ce[We]=st}}var A=this.jpoint(null,null,null),k=this._wnafT4;for(ze=Ge;ze>=0;ze--){for(var Y=0;ze>=0;){var Q=!0;for(Xe=0;Xe<X;Xe++)k[Xe]=Le[Xe][ze]|0,k[Xe]!==0&&(Q=!1);if(!Q)break;Y++,ze--}if(ze>=0&&Y++,A=A.dblp(Y),ze<0)break;for(Xe=0;Xe<X;Xe++){var $e=k[Xe];$e!==0&&($e>0?He=Ce[Xe][$e-1>>1]:$e<0&&(He=Ce[Xe][-$e-1>>1].neg()),He.type==="affine"?A=A.mixedAdd(He):A=A.add(He))}}for(ze=0;ze<X;ze++)Ce[ze]=null;return te?A:A.toP()};function g(b,_){this.curve=b,this.type=_,this.precomputed=null}f.BasePoint=g,g.prototype.eq=function(){throw new Error("Not implemented")},g.prototype.validate=function(){return this.curve.validate(this)},f.prototype.decodePoint=function(_,L){_=s.toArray(_,L);var q=this.p.byteLength();if((_[0]===4||_[0]===6||_[0]===7)&&_.length-1===2*q){_[0]===6?c(_[_.length-1]%2===0):_[0]===7&&c(_[_.length-1]%2===1);var X=this.point(_.slice(1,1+q),_.slice(1+q,1+2*q));return X}else if((_[0]===2||_[0]===3)&&_.length-1===q)return this.pointFromX(_.slice(1,1+q),_[0]===3);throw new Error("Unknown point format")},g.prototype.encodeCompressed=function(_){return this.encode(_,!0)},g.prototype._encode=function(_){var L=this.curve.p.byteLength(),q=this.getX().toArray("be",L);return _?[this.getY().isEven()?2:3].concat(q):[4].concat(q,this.getY().toArray("be",L))},g.prototype.encode=function(_,L){return s.encode(this._encode(L),_)},g.prototype.precompute=function(_){if(this.precomputed)return this;var L={doubles:null,naf:null,beta:null};return L.naf=this._getNAFPoints(8),L.doubles=this._getDoubles(4,_),L.beta=this._getBeta(),this.precomputed=L,this},g.prototype._hasDoubles=function(_){if(!this.precomputed)return!1;var L=this.precomputed.doubles;return L?L.points.length>=Math.ceil((_.bitLength()+1)/L.step):!1},g.prototype._getDoubles=function(_,L){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var q=[this],X=this,te=0;te<L;te+=_){for(var ne=0;ne<_;ne++)X=X.dbl();q.push(X)}return{step:_,points:q}},g.prototype._getNAFPoints=function(_){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var L=[this],q=(1<<_)-1,X=q===1?null:this.dbl(),te=1;te<q;te++)L[te]=L[te-1].add(X);return{wnd:_,points:L}},g.prototype._getBeta=function(){return null},g.prototype.dblp=function(_){for(var L=this,q=0;q<_;q++)L=L.dbl();return L}}),require_inherits_browser=__commonJS2((r,t)=>{typeof Object.create=="function"?t.exports=function(s,o){o&&(s.super_=o,s.prototype=Object.create(o.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(s,o){if(o){s.super_=o;var a=function(){};a.prototype=o.prototype,s.prototype=new a,s.prototype.constructor=s}}}),require_inherits=__commonJS2((r,t)=>{try{if(n=(init_util(),__toCommonJS(exports_util)),typeof n.inherits!="function")throw"";t.exports=n.inherits}catch{t.exports=require_inherits_browser()}var n}),require_short=__commonJS2((r,t)=>{var n=require_utils2(),s=require_bn(),o=require_inherits(),a=require_base(),c=n.assert;function f(_){a.call(this,"short",_),this.a=new s(_.a,16).toRed(this.red),this.b=new s(_.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(_),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}o(f,a),t.exports=f,f.prototype._getEndomorphism=function(L){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var q,X;if(L.beta)q=new s(L.beta,16).toRed(this.red);else{var te=this._getEndoRoots(this.p);q=te[0].cmp(te[1])<0?te[0]:te[1],q=q.toRed(this.red)}if(L.lambda)X=new s(L.lambda,16);else{var ne=this._getEndoRoots(this.n);this.g.mul(ne[0]).x.cmp(this.g.x.redMul(q))===0?X=ne[0]:(X=ne[1],c(this.g.mul(X).x.cmp(this.g.x.redMul(q))===0))}var Ce;return L.basis?Ce=L.basis.map(function(Le){return{a:new s(Le.a,16),b:new s(Le.b,16)}}):Ce=this._getEndoBasis(X),{beta:q,lambda:X,basis:Ce}}},f.prototype._getEndoRoots=function(L){var q=L===this.p?this.red:s.mont(L),X=new s(2).toRed(q).redInvm(),te=X.redNeg(),ne=new s(3).toRed(q).redNeg().redSqrt().redMul(X),Ce=te.redAdd(ne).fromRed(),Le=te.redSub(ne).fromRed();return[Ce,Le]},f.prototype._getEndoBasis=function(L){for(var q=this.n.ushrn(Math.floor(this.n.bitLength()/2)),X=L,te=this.n.clone(),ne=new s(1),Ce=new s(0),Le=new s(0),Ge=new s(1),ze,Xe,He,Ve,We,rt,st,ht=0,je,se;X.cmpn(0)!==0;){var m=te.div(X);je=te.sub(m.mul(X)),se=Le.sub(m.mul(ne));var A=Ge.sub(m.mul(Ce));if(!He&&je.cmp(q)<0)ze=st.neg(),Xe=ne,He=je.neg(),Ve=se;else if(He&&++ht===2)break;st=je,te=X,X=je,Le=ne,ne=se,Ge=Ce,Ce=A}We=je.neg(),rt=se;var k=He.sqr().add(Ve.sqr()),Y=We.sqr().add(rt.sqr());return Y.cmp(k)>=0&&(We=ze,rt=Xe),He.negative&&(He=He.neg(),Ve=Ve.neg()),We.negative&&(We=We.neg(),rt=rt.neg()),[{a:He,b:Ve},{a:We,b:rt}]},f.prototype._endoSplit=function(L){var q=this.endo.basis,X=q[0],te=q[1],ne=te.b.mul(L).divRound(this.n),Ce=X.b.neg().mul(L).divRound(this.n),Le=ne.mul(X.a),Ge=Ce.mul(te.a),ze=ne.mul(X.b),Xe=Ce.mul(te.b),He=L.sub(Le).sub(Ge),Ve=ze.add(Xe).neg();return{k1:He,k2:Ve}},f.prototype.pointFromX=function(L,q){L=new s(L,16),!L.red&&(L=L.toRed(this.red));var X=L.redSqr().redMul(L).redIAdd(L.redMul(this.a)).redIAdd(this.b),te=X.redSqrt();if(te.redSqr().redSub(X).cmp(this.zero)!==0)throw new Error("invalid point");var ne=te.fromRed().isOdd();return(q&&!ne||!q&&ne)&&(te=te.redNeg()),this.point(L,te)},f.prototype.validate=function(L){if(L.inf)return!0;var{x:q,y:X}=L,te=this.a.redMul(q),ne=q.redSqr().redMul(q).redIAdd(te).redIAdd(this.b);return X.redSqr().redISub(ne).cmpn(0)===0},f.prototype._endoWnafMulAdd=function(L,q,X){for(var te=this._endoWnafT1,ne=this._endoWnafT2,Ce=0;Ce<L.length;Ce++){var Le=this._endoSplit(q[Ce]),Ge=L[Ce],ze=Ge._getBeta();Le.k1.negative&&(Le.k1.ineg(),Ge=Ge.neg(!0)),Le.k2.negative&&(Le.k2.ineg(),ze=ze.neg(!0)),te[Ce*2]=Ge,te[Ce*2+1]=ze,ne[Ce*2]=Le.k1,ne[Ce*2+1]=Le.k2}for(var Xe=this._wnafMulAdd(1,te,ne,Ce*2,X),He=0;He<Ce*2;He++)te[He]=null,ne[He]=null;return Xe};function g(_,L,q,X){a.BasePoint.call(this,_,"affine"),L===null&&q===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new s(L,16),this.y=new s(q,16),X&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}o(g,a.BasePoint),f.prototype.point=function(L,q,X){return new g(this,L,q,X)},f.prototype.pointFromJSON=function(L,q){return g.fromJSON(this,L,q)},g.prototype._getBeta=function(){if(this.curve.endo){var L=this.precomputed;if(L&&L.beta)return L.beta;var q=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(L){var X=this.curve,te=function(ne){return X.point(ne.x.redMul(X.endo.beta),ne.y)};L.beta=q,q.precomputed={beta:null,naf:L.naf&&{wnd:L.naf.wnd,points:L.naf.points.map(te)},doubles:L.doubles&&{step:L.doubles.step,points:L.doubles.points.map(te)}}}return q}},g.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},g.fromJSON=function(L,q,X){typeof q=="string"&&(q=JSON.parse(q));var te=L.point(q[0],q[1],X);if(!q[2])return te;function ne(Le){return L.point(Le[0],Le[1],X)}var Ce=q[2];return te.precomputed={beta:null,doubles:Ce.doubles&&{step:Ce.doubles.step,points:[te].concat(Ce.doubles.points.map(ne))},naf:Ce.naf&&{wnd:Ce.naf.wnd,points:[te].concat(Ce.naf.points.map(ne))}},te},g.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},g.prototype.isInfinity=function(){return this.inf},g.prototype.add=function(L){if(this.inf)return L;if(L.inf)return this;if(this.eq(L))return this.dbl();if(this.neg().eq(L))return this.curve.point(null,null);if(this.x.cmp(L.x)===0)return this.curve.point(null,null);var q=this.y.redSub(L.y);q.cmpn(0)!==0&&(q=q.redMul(this.x.redSub(L.x).redInvm()));var X=q.redSqr().redISub(this.x).redISub(L.x),te=q.redMul(this.x.redSub(X)).redISub(this.y);return this.curve.point(X,te)},g.prototype.dbl=function(){if(this.inf)return this;var L=this.y.redAdd(this.y);if(L.cmpn(0)===0)return this.curve.point(null,null);var q=this.curve.a,X=this.x.redSqr(),te=L.redInvm(),ne=X.redAdd(X).redIAdd(X).redIAdd(q).redMul(te),Ce=ne.redSqr().redISub(this.x.redAdd(this.x)),Le=ne.redMul(this.x.redSub(Ce)).redISub(this.y);return this.curve.point(Ce,Le)},g.prototype.getX=function(){return this.x.fromRed()},g.prototype.getY=function(){return this.y.fromRed()},g.prototype.mul=function(L){return L=new s(L,16),this.isInfinity()?this:this._hasDoubles(L)?this.curve._fixedNafMul(this,L):this.curve.endo?this.curve._endoWnafMulAdd([this],[L]):this.curve._wnafMul(this,L)},g.prototype.mulAdd=function(L,q,X){var te=[this,q],ne=[L,X];return this.curve.endo?this.curve._endoWnafMulAdd(te,ne):this.curve._wnafMulAdd(1,te,ne,2)},g.prototype.jmulAdd=function(L,q,X){var te=[this,q],ne=[L,X];return this.curve.endo?this.curve._endoWnafMulAdd(te,ne,!0):this.curve._wnafMulAdd(1,te,ne,2,!0)},g.prototype.eq=function(L){return this===L||this.inf===L.inf&&(this.inf||this.x.cmp(L.x)===0&&this.y.cmp(L.y)===0)},g.prototype.neg=function(L){if(this.inf)return this;var q=this.curve.point(this.x,this.y.redNeg());if(L&&this.precomputed){var X=this.precomputed,te=function(ne){return ne.neg()};q.precomputed={naf:X.naf&&{wnd:X.naf.wnd,points:X.naf.points.map(te)},doubles:X.doubles&&{step:X.doubles.step,points:X.doubles.points.map(te)}}}return q},g.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var L=this.curve.jpoint(this.x,this.y,this.curve.one);return L};function b(_,L,q,X){a.BasePoint.call(this,_,"jacobian"),L===null&&q===null&&X===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new s(0)):(this.x=new s(L,16),this.y=new s(q,16),this.z=new s(X,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}o(b,a.BasePoint),f.prototype.jpoint=function(L,q,X){return new b(this,L,q,X)},b.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var L=this.z.redInvm(),q=L.redSqr(),X=this.x.redMul(q),te=this.y.redMul(q).redMul(L);return this.curve.point(X,te)},b.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},b.prototype.add=function(L){if(this.isInfinity())return L;if(L.isInfinity())return this;var q=L.z.redSqr(),X=this.z.redSqr(),te=this.x.redMul(q),ne=L.x.redMul(X),Ce=this.y.redMul(q.redMul(L.z)),Le=L.y.redMul(X.redMul(this.z)),Ge=te.redSub(ne),ze=Ce.redSub(Le);if(Ge.cmpn(0)===0)return ze.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var Xe=Ge.redSqr(),He=Xe.redMul(Ge),Ve=te.redMul(Xe),We=ze.redSqr().redIAdd(He).redISub(Ve).redISub(Ve),rt=ze.redMul(Ve.redISub(We)).redISub(Ce.redMul(He)),st=this.z.redMul(L.z).redMul(Ge);return this.curve.jpoint(We,rt,st)},b.prototype.mixedAdd=function(L){if(this.isInfinity())return L.toJ();if(L.isInfinity())return this;var q=this.z.redSqr(),X=this.x,te=L.x.redMul(q),ne=this.y,Ce=L.y.redMul(q).redMul(this.z),Le=X.redSub(te),Ge=ne.redSub(Ce);if(Le.cmpn(0)===0)return Ge.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var ze=Le.redSqr(),Xe=ze.redMul(Le),He=X.redMul(ze),Ve=Ge.redSqr().redIAdd(Xe).redISub(He).redISub(He),We=Ge.redMul(He.redISub(Ve)).redISub(ne.redMul(Xe)),rt=this.z.redMul(Le);return this.curve.jpoint(Ve,We,rt)},b.prototype.dblp=function(L){if(L===0)return this;if(this.isInfinity())return this;if(!L)return this.dbl();var q;if(this.curve.zeroA||this.curve.threeA){var X=this;for(q=0;q<L;q++)X=X.dbl();return X}var te=this.curve.a,ne=this.curve.tinv,Ce=this.x,Le=this.y,Ge=this.z,ze=Ge.redSqr().redSqr(),Xe=Le.redAdd(Le);for(q=0;q<L;q++){var He=Ce.redSqr(),Ve=Xe.redSqr(),We=Ve.redSqr(),rt=He.redAdd(He).redIAdd(He).redIAdd(te.redMul(ze)),st=Ce.redMul(Ve),ht=rt.redSqr().redISub(st.redAdd(st)),je=st.redISub(ht),se=rt.redMul(je);se=se.redIAdd(se).redISub(We);var m=Xe.redMul(Ge);q+1<L&&(ze=ze.redMul(We)),Ce=ht,Ge=m,Xe=se}return this.curve.jpoint(Ce,Xe.redMul(ne),Ge)},b.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},b.prototype._zeroDbl=function(){var L,q,X;if(this.zOne){var te=this.x.redSqr(),ne=this.y.redSqr(),Ce=ne.redSqr(),Le=this.x.redAdd(ne).redSqr().redISub(te).redISub(Ce);Le=Le.redIAdd(Le);var Ge=te.redAdd(te).redIAdd(te),ze=Ge.redSqr().redISub(Le).redISub(Le),Xe=Ce.redIAdd(Ce);Xe=Xe.redIAdd(Xe),Xe=Xe.redIAdd(Xe),L=ze,q=Ge.redMul(Le.redISub(ze)).redISub(Xe),X=this.y.redAdd(this.y)}else{var He=this.x.redSqr(),Ve=this.y.redSqr(),We=Ve.redSqr(),rt=this.x.redAdd(Ve).redSqr().redISub(He).redISub(We);rt=rt.redIAdd(rt);var st=He.redAdd(He).redIAdd(He),ht=st.redSqr(),je=We.redIAdd(We);je=je.redIAdd(je),je=je.redIAdd(je),L=ht.redISub(rt).redISub(rt),q=st.redMul(rt.redISub(L)).redISub(je),X=this.y.redMul(this.z),X=X.redIAdd(X)}return this.curve.jpoint(L,q,X)},b.prototype._threeDbl=function(){var L,q,X;if(this.zOne){var te=this.x.redSqr(),ne=this.y.redSqr(),Ce=ne.redSqr(),Le=this.x.redAdd(ne).redSqr().redISub(te).redISub(Ce);Le=Le.redIAdd(Le);var Ge=te.redAdd(te).redIAdd(te).redIAdd(this.curve.a),ze=Ge.redSqr().redISub(Le).redISub(Le);L=ze;var Xe=Ce.redIAdd(Ce);Xe=Xe.redIAdd(Xe),Xe=Xe.redIAdd(Xe),q=Ge.redMul(Le.redISub(ze)).redISub(Xe),X=this.y.redAdd(this.y)}else{var He=this.z.redSqr(),Ve=this.y.redSqr(),We=this.x.redMul(Ve),rt=this.x.redSub(He).redMul(this.x.redAdd(He));rt=rt.redAdd(rt).redIAdd(rt);var st=We.redIAdd(We);st=st.redIAdd(st);var ht=st.redAdd(st);L=rt.redSqr().redISub(ht),X=this.y.redAdd(this.z).redSqr().redISub(Ve).redISub(He);var je=Ve.redSqr();je=je.redIAdd(je),je=je.redIAdd(je),je=je.redIAdd(je),q=rt.redMul(st.redISub(L)).redISub(je)}return this.curve.jpoint(L,q,X)},b.prototype._dbl=function(){var L=this.curve.a,q=this.x,X=this.y,te=this.z,ne=te.redSqr().redSqr(),Ce=q.redSqr(),Le=X.redSqr(),Ge=Ce.redAdd(Ce).redIAdd(Ce).redIAdd(L.redMul(ne)),ze=q.redAdd(q);ze=ze.redIAdd(ze);var Xe=ze.redMul(Le),He=Ge.redSqr().redISub(Xe.redAdd(Xe)),Ve=Xe.redISub(He),We=Le.redSqr();We=We.redIAdd(We),We=We.redIAdd(We),We=We.redIAdd(We);var rt=Ge.redMul(Ve).redISub(We),st=X.redAdd(X).redMul(te);return this.curve.jpoint(He,rt,st)},b.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var L=this.x.redSqr(),q=this.y.redSqr(),X=this.z.redSqr(),te=q.redSqr(),ne=L.redAdd(L).redIAdd(L),Ce=ne.redSqr(),Le=this.x.redAdd(q).redSqr().redISub(L).redISub(te);Le=Le.redIAdd(Le),Le=Le.redAdd(Le).redIAdd(Le),Le=Le.redISub(Ce);var Ge=Le.redSqr(),ze=te.redIAdd(te);ze=ze.redIAdd(ze),ze=ze.redIAdd(ze),ze=ze.redIAdd(ze);var Xe=ne.redIAdd(Le).redSqr().redISub(Ce).redISub(Ge).redISub(ze),He=q.redMul(Xe);He=He.redIAdd(He),He=He.redIAdd(He);var Ve=this.x.redMul(Ge).redISub(He);Ve=Ve.redIAdd(Ve),Ve=Ve.redIAdd(Ve);var We=this.y.redMul(Xe.redMul(ze.redISub(Xe)).redISub(Le.redMul(Ge)));We=We.redIAdd(We),We=We.redIAdd(We),We=We.redIAdd(We);var rt=this.z.redAdd(Le).redSqr().redISub(X).redISub(Ge);return this.curve.jpoint(Ve,We,rt)},b.prototype.mul=function(L,q){return L=new s(L,q),this.curve._wnafMul(this,L)},b.prototype.eq=function(L){if(L.type==="affine")return this.eq(L.toJ());if(this===L)return!0;var q=this.z.redSqr(),X=L.z.redSqr();if(this.x.redMul(X).redISub(L.x.redMul(q)).cmpn(0)!==0)return!1;var te=q.redMul(this.z),ne=X.redMul(L.z);return this.y.redMul(ne).redISub(L.y.redMul(te)).cmpn(0)===0},b.prototype.eqXToP=function(L){var q=this.z.redSqr(),X=L.toRed(this.curve.red).redMul(q);if(this.x.cmp(X)===0)return!0;for(var te=L.clone(),ne=this.curve.redN.redMul(q);;){if(te.iadd(this.curve.n),te.cmp(this.curve.p)>=0)return!1;if(X.redIAdd(ne),this.x.cmp(X)===0)return!0}},b.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},b.prototype.isInfinity=function(){return this.z.cmpn(0)===0}}),require_mont=__commonJS2((r,t)=>{var n=require_bn(),s=require_inherits(),o=require_base(),a=require_utils2();function c(g){o.call(this,"mont",g),this.a=new n(g.a,16).toRed(this.red),this.b=new n(g.b,16).toRed(this.red),this.i4=new n(4).toRed(this.red).redInvm(),this.two=new n(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}s(c,o),t.exports=c,c.prototype.validate=function(b){var _=b.normalize().x,L=_.redSqr(),q=L.redMul(_).redAdd(L.redMul(this.a)).redAdd(_),X=q.redSqrt();return X.redSqr().cmp(q)===0};function f(g,b,_){o.BasePoint.call(this,g,"projective"),b===null&&_===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new n(b,16),this.z=new n(_,16),!this.x.red&&(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}s(f,o.BasePoint),c.prototype.decodePoint=function(b,_){return this.point(a.toArray(b,_),1)},c.prototype.point=function(b,_){return new f(this,b,_)},c.prototype.pointFromJSON=function(b){return f.fromJSON(this,b)},f.prototype.precompute=function(){},f.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},f.fromJSON=function(b,_){return new f(b,_[0],_[1]||b.one)},f.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},f.prototype.isInfinity=function(){return this.z.cmpn(0)===0},f.prototype.dbl=function(){var b=this.x.redAdd(this.z),_=b.redSqr(),L=this.x.redSub(this.z),q=L.redSqr(),X=_.redSub(q),te=_.redMul(q),ne=X.redMul(q.redAdd(this.curve.a24.redMul(X)));return this.curve.point(te,ne)},f.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},f.prototype.diffAdd=function(b,_){var L=this.x.redAdd(this.z),q=this.x.redSub(this.z),X=b.x.redAdd(b.z),te=b.x.redSub(b.z),ne=te.redMul(L),Ce=X.redMul(q),Le=_.z.redMul(ne.redAdd(Ce).redSqr()),Ge=_.x.redMul(ne.redISub(Ce).redSqr());return this.curve.point(Le,Ge)},f.prototype.mul=function(b){for(var _=b.clone(),L=this,q=this.curve.point(null,null),X=this,te=[];_.cmpn(0)!==0;_.iushrn(1))te.push(_.andln(1));for(var ne=te.length-1;ne>=0;ne--)te[ne]===0?(L=L.diffAdd(q,X),q=q.dbl()):(q=L.diffAdd(q,X),L=L.dbl());return q},f.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},f.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},f.prototype.eq=function(b){return this.getX().cmp(b.getX())===0},f.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},f.prototype.getX=function(){return this.normalize(),this.x.fromRed()}}),require_edwards=__commonJS2((r,t)=>{var n=require_utils2(),s=require_bn(),o=require_inherits(),a=require_base(),c=n.assert;function f(b){this.twisted=(b.a|0)!==1,this.mOneA=this.twisted&&(b.a|0)===-1,this.extended=this.mOneA,a.call(this,"edwards",b),this.a=new s(b.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new s(b.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new s(b.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),c(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(b.c|0)===1}o(f,a),t.exports=f,f.prototype._mulA=function(_){return this.mOneA?_.redNeg():this.a.redMul(_)},f.prototype._mulC=function(_){return this.oneC?_:this.c.redMul(_)},f.prototype.jpoint=function(_,L,q,X){return this.point(_,L,q,X)},f.prototype.pointFromX=function(_,L){_=new s(_,16),!_.red&&(_=_.toRed(this.red));var q=_.redSqr(),X=this.c2.redSub(this.a.redMul(q)),te=this.one.redSub(this.c2.redMul(this.d).redMul(q)),ne=X.redMul(te.redInvm()),Ce=ne.redSqrt();if(Ce.redSqr().redSub(ne).cmp(this.zero)!==0)throw new Error("invalid point");var Le=Ce.fromRed().isOdd();return(L&&!Le||!L&&Le)&&(Ce=Ce.redNeg()),this.point(_,Ce)},f.prototype.pointFromY=function(_,L){_=new s(_,16),!_.red&&(_=_.toRed(this.red));var q=_.redSqr(),X=q.redSub(this.c2),te=q.redMul(this.d).redMul(this.c2).redSub(this.a),ne=X.redMul(te.redInvm());if(ne.cmp(this.zero)===0){if(L)throw new Error("invalid point");return this.point(this.zero,_)}var Ce=ne.redSqrt();if(Ce.redSqr().redSub(ne).cmp(this.zero)!==0)throw new Error("invalid point");return Ce.fromRed().isOdd()!==L&&(Ce=Ce.redNeg()),this.point(Ce,_)},f.prototype.validate=function(_){if(_.isInfinity())return!0;_.normalize();var L=_.x.redSqr(),q=_.y.redSqr(),X=L.redMul(this.a).redAdd(q),te=this.c2.redMul(this.one.redAdd(this.d.redMul(L).redMul(q)));return X.cmp(te)===0};function g(b,_,L,q,X){a.BasePoint.call(this,b,"projective"),_===null&&L===null&&q===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new s(_,16),this.y=new s(L,16),this.z=q?new s(q,16):this.curve.one,this.t=X&&new s(X,16),!this.x.red&&(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),!this.zOne&&(this.t=this.t.redMul(this.z.redInvm()))))}o(g,a.BasePoint),f.prototype.pointFromJSON=function(_){return g.fromJSON(this,_)},f.prototype.point=function(_,L,q,X){return new g(this,_,L,q,X)},g.fromJSON=function(_,L){return new g(_,L[0],L[1],L[2])},g.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},g.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},g.prototype._extDbl=function(){var _=this.x.redSqr(),L=this.y.redSqr(),q=this.z.redSqr();q=q.redIAdd(q);var X=this.curve._mulA(_),te=this.x.redAdd(this.y).redSqr().redISub(_).redISub(L),ne=X.redAdd(L),Ce=ne.redSub(q),Le=X.redSub(L),Ge=te.redMul(Ce),ze=ne.redMul(Le),Xe=te.redMul(Le),He=Ce.redMul(ne);return this.curve.point(Ge,ze,He,Xe)},g.prototype._projDbl=function(){var _=this.x.redAdd(this.y).redSqr(),L=this.x.redSqr(),q=this.y.redSqr(),X,te,ne,Ce,Le,Ge;if(this.curve.twisted){Ce=this.curve._mulA(L);var ze=Ce.redAdd(q);this.zOne?(X=_.redSub(L).redSub(q).redMul(ze.redSub(this.curve.two)),te=ze.redMul(Ce.redSub(q)),ne=ze.redSqr().redSub(ze).redSub(ze)):(Le=this.z.redSqr(),Ge=ze.redSub(Le).redISub(Le),X=_.redSub(L).redISub(q).redMul(Ge),te=ze.redMul(Ce.redSub(q)),ne=ze.redMul(Ge))}else Ce=L.redAdd(q),Le=this.curve._mulC(this.z).redSqr(),Ge=Ce.redSub(Le).redSub(Le),X=this.curve._mulC(_.redISub(Ce)).redMul(Ge),te=this.curve._mulC(Ce).redMul(L.redISub(q)),ne=Ce.redMul(Ge);return this.curve.point(X,te,ne)},g.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},g.prototype._extAdd=function(_){var L=this.y.redSub(this.x).redMul(_.y.redSub(_.x)),q=this.y.redAdd(this.x).redMul(_.y.redAdd(_.x)),X=this.t.redMul(this.curve.dd).redMul(_.t),te=this.z.redMul(_.z.redAdd(_.z)),ne=q.redSub(L),Ce=te.redSub(X),Le=te.redAdd(X),Ge=q.redAdd(L),ze=ne.redMul(Ce),Xe=Le.redMul(Ge),He=ne.redMul(Ge),Ve=Ce.redMul(Le);return this.curve.point(ze,Xe,Ve,He)},g.prototype._projAdd=function(_){var L=this.z.redMul(_.z),q=L.redSqr(),X=this.x.redMul(_.x),te=this.y.redMul(_.y),ne=this.curve.d.redMul(X).redMul(te),Ce=q.redSub(ne),Le=q.redAdd(ne),Ge=this.x.redAdd(this.y).redMul(_.x.redAdd(_.y)).redISub(X).redISub(te),ze=L.redMul(Ce).redMul(Ge),Xe,He;return this.curve.twisted?(Xe=L.redMul(Le).redMul(te.redSub(this.curve._mulA(X))),He=Ce.redMul(Le)):(Xe=L.redMul(Le).redMul(te.redSub(X)),He=this.curve._mulC(Ce).redMul(Le)),this.curve.point(ze,Xe,He)},g.prototype.add=function(_){return this.isInfinity()?_:_.isInfinity()?this:this.curve.extended?this._extAdd(_):this._projAdd(_)},g.prototype.mul=function(_){return this._hasDoubles(_)?this.curve._fixedNafMul(this,_):this.curve._wnafMul(this,_)},g.prototype.mulAdd=function(_,L,q){return this.curve._wnafMulAdd(1,[this,L],[_,q],2,!1)},g.prototype.jmulAdd=function(_,L,q){return this.curve._wnafMulAdd(1,[this,L],[_,q],2,!0)},g.prototype.normalize=function(){if(this.zOne)return this;var _=this.z.redInvm();return this.x=this.x.redMul(_),this.y=this.y.redMul(_),this.t&&(this.t=this.t.redMul(_)),this.z=this.curve.one,this.zOne=!0,this},g.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},g.prototype.getX=function(){return this.normalize(),this.x.fromRed()},g.prototype.getY=function(){return this.normalize(),this.y.fromRed()},g.prototype.eq=function(_){return this===_||this.getX().cmp(_.getX())===0&&this.getY().cmp(_.getY())===0},g.prototype.eqXToP=function(_){var L=_.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(L)===0)return!0;for(var q=_.clone(),X=this.curve.redN.redMul(this.z);;){if(q.iadd(this.curve.n),q.cmp(this.curve.p)>=0)return!1;if(L.redIAdd(X),this.x.cmp(L)===0)return!0}},g.prototype.toP=g.prototype.normalize,g.prototype.mixedAdd=g.prototype.add}),require_curve=__commonJS2(r=>{var t=r;t.base=require_base(),t.short=require_short(),t.mont=require_mont(),t.edwards=require_edwards()}),require_utils3=__commonJS2(r=>{var t=require_minimalistic_assert(),n=require_inherits();r.inherits=n;function s(m,A){return(m.charCodeAt(A)&64512)!==55296||A<0||A+1>=m.length?!1:(m.charCodeAt(A+1)&64512)===56320}function o(m,A){if(Array.isArray(m))return m.slice();if(!m)return[];var k=[];if(typeof m=="string")if(A){if(A==="hex")for(m=m.replace(/[^a-z0-9]+/ig,""),m.length%2!==0&&(m="0"+m),Q=0;Q<m.length;Q+=2)k.push(parseInt(m[Q]+m[Q+1],16))}else for(var Y=0,Q=0;Q<m.length;Q++){var $e=m.charCodeAt(Q);$e<128?k[Y++]=$e:$e<2048?(k[Y++]=$e>>6|192,k[Y++]=$e&63|128):s(m,Q)?($e=65536+(($e&1023)<<10)+(m.charCodeAt(++Q)&1023),k[Y++]=$e>>18|240,k[Y++]=$e>>12&63|128,k[Y++]=$e>>6&63|128,k[Y++]=$e&63|128):(k[Y++]=$e>>12|224,k[Y++]=$e>>6&63|128,k[Y++]=$e&63|128)}else for(Q=0;Q<m.length;Q++)k[Q]=m[Q]|0;return k}r.toArray=o;function a(m){for(var A="",k=0;k<m.length;k++)A+=g(m[k].toString(16));return A}r.toHex=a;function c(m){var A=m>>>24|m>>>8&65280|m<<8&16711680|(m&255)<<24;return A>>>0}r.htonl=c;function f(m,A){for(var k="",Y=0;Y<m.length;Y++){var Q=m[Y];A==="little"&&(Q=c(Q)),k+=b(Q.toString(16))}return k}r.toHex32=f;function g(m){return m.length===1?"0"+m:m}r.zero2=g;function b(m){return m.length===7?"0"+m:m.length===6?"00"+m:m.length===5?"000"+m:m.length===4?"0000"+m:m.length===3?"00000"+m:m.length===2?"000000"+m:m.length===1?"0000000"+m:m}r.zero8=b;function _(m,A,k,Y){var Q=k-A;t(Q%4===0);for(var $e=new Array(Q/4),ve=0,re=A;ve<$e.length;ve++,re+=4){var B;Y==="big"?B=m[re]<<24|m[re+1]<<16|m[re+2]<<8|m[re+3]:B=m[re+3]<<24|m[re+2]<<16|m[re+1]<<8|m[re],$e[ve]=B>>>0}return $e}r.join32=_;function L(m,A){for(var k=new Array(m.length*4),Y=0,Q=0;Y<m.length;Y++,Q+=4){var $e=m[Y];A==="big"?(k[Q]=$e>>>24,k[Q+1]=$e>>>16&255,k[Q+2]=$e>>>8&255,k[Q+3]=$e&255):(k[Q+3]=$e>>>24,k[Q+2]=$e>>>16&255,k[Q+1]=$e>>>8&255,k[Q]=$e&255)}return k}r.split32=L;function q(m,A){return m>>>A|m<<32-A}r.rotr32=q;function X(m,A){return m<<A|m>>>32-A}r.rotl32=X;function te(m,A){return m+A>>>0}r.sum32=te;function ne(m,A,k){return m+A+k>>>0}r.sum32_3=ne;function Ce(m,A,k,Y){return m+A+k+Y>>>0}r.sum32_4=Ce;function Le(m,A,k,Y,Q){return m+A+k+Y+Q>>>0}r.sum32_5=Le;function Ge(m,A,k,Y){var Q=m[A],$e=m[A+1],ve=Y+$e>>>0,re=(ve<Y?1:0)+k+Q;m[A]=re>>>0,m[A+1]=ve}r.sum64=Ge;function ze(m,A,k,Y){var Q=A+Y>>>0,$e=(Q<A?1:0)+m+k;return $e>>>0}r.sum64_hi=ze;function Xe(m,A,k,Y){var Q=A+Y;return Q>>>0}r.sum64_lo=Xe;function He(m,A,k,Y,Q,$e,ve,re){var B=0,oe=A;oe=oe+Y>>>0,B+=oe<A?1:0,oe=oe+$e>>>0,B+=oe<$e?1:0,oe=oe+re>>>0,B+=oe<re?1:0;var Ue=m+k+Q+ve+B;return Ue>>>0}r.sum64_4_hi=He;function Ve(m,A,k,Y,Q,$e,ve,re){var B=A+Y+$e+re;return B>>>0}r.sum64_4_lo=Ve;function We(m,A,k,Y,Q,$e,ve,re,B,oe){var Ue=0,Ze=A;Ze=Ze+Y>>>0,Ue+=Ze<A?1:0,Ze=Ze+$e>>>0,Ue+=Ze<$e?1:0,Ze=Ze+re>>>0,Ue+=Ze<re?1:0,Ze=Ze+oe>>>0,Ue+=Ze<oe?1:0;var lt=m+k+Q+ve+B+Ue;return lt>>>0}r.sum64_5_hi=We;function rt(m,A,k,Y,Q,$e,ve,re,B,oe){var Ue=A+Y+$e+re+oe;return Ue>>>0}r.sum64_5_lo=rt;function st(m,A,k){var Y=A<<32-k|m>>>k;return Y>>>0}r.rotr64_hi=st;function ht(m,A,k){var Y=m<<32-k|A>>>k;return Y>>>0}r.rotr64_lo=ht;function je(m,A,k){return m>>>k}r.shr64_hi=je;function se(m,A,k){var Y=m<<32-k|A>>>k;return Y>>>0}r.shr64_lo=se}),require_common=__commonJS2(r=>{var t=require_utils3(),n=require_minimalistic_assert();function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}r.BlockHash=s,s.prototype.update=function(a,c){if(a=t.toArray(a,c),this.pending?this.pending=this.pending.concat(a):this.pending=a,this.pendingTotal+=a.length,this.pending.length>=this._delta8){a=this.pending;var f=a.length%this._delta8;this.pending=a.slice(a.length-f,a.length),this.pending.length===0&&(this.pending=null),a=t.join32(a,0,a.length-f,this.endian);for(var g=0;g<a.length;g+=this._delta32)this._update(a,g,g+this._delta32)}return this},s.prototype.digest=function(a){return this.update(this._pad()),n(this.pending===null),this._digest(a)},s.prototype._pad=function(){var a=this.pendingTotal,c=this._delta8,f=c-(a+this.padLength)%c,g=new Array(f+this.padLength);g[0]=128;for(var b=1;b<f;b++)g[b]=0;if(a<<=3,this.endian==="big"){for(var _=8;_<this.padLength;_++)g[b++]=0;g[b++]=0,g[b++]=0,g[b++]=0,g[b++]=0,g[b++]=a>>>24&255,g[b++]=a>>>16&255,g[b++]=a>>>8&255,g[b++]=a&255}else for(g[b++]=a&255,g[b++]=a>>>8&255,g[b++]=a>>>16&255,g[b++]=a>>>24&255,g[b++]=0,g[b++]=0,g[b++]=0,g[b++]=0,_=8;_<this.padLength;_++)g[b++]=0;return g}}),require_common2=__commonJS2(r=>{var t=require_utils3(),n=t.rotr32;function s(L,q,X,te){if(L===0)return o(q,X,te);if(L===1||L===3)return c(q,X,te);if(L===2)return a(q,X,te)}r.ft_1=s;function o(L,q,X){return L&q^~L&X}r.ch32=o;function a(L,q,X){return L&q^L&X^q&X}r.maj32=a;function c(L,q,X){return L^q^X}r.p32=c;function f(L){return n(L,2)^n(L,13)^n(L,22)}r.s0_256=f;function g(L){return n(L,6)^n(L,11)^n(L,25)}r.s1_256=g;function b(L){return n(L,7)^n(L,18)^L>>>3}r.g0_256=b;function _(L){return n(L,17)^n(L,19)^L>>>10}r.g1_256=_}),require_1=__commonJS2((r,t)=>{var n=require_utils3(),s=require_common(),o=require_common2(),a=n.rotl32,c=n.sum32,f=n.sum32_5,g=o.ft_1,b=s.BlockHash,_=[1518500249,1859775393,2400959708,3395469782];function L(){if(!(this instanceof L))return new L;b.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}n.inherits(L,b),t.exports=L,L.blockSize=512,L.outSize=160,L.hmacStrength=80,L.padLength=64,L.prototype._update=function(X,te){for(var ne=this.W,Ce=0;Ce<16;Ce++)ne[Ce]=X[te+Ce];for(;Ce<ne.length;Ce++)ne[Ce]=a(ne[Ce-3]^ne[Ce-8]^ne[Ce-14]^ne[Ce-16],1);var Le=this.h[0],Ge=this.h[1],ze=this.h[2],Xe=this.h[3],He=this.h[4];for(Ce=0;Ce<ne.length;Ce++){var Ve=~~(Ce/20),We=f(a(Le,5),g(Ve,Ge,ze,Xe),He,ne[Ce],_[Ve]);He=Xe,Xe=ze,ze=a(Ge,30),Ge=Le,Le=We}this.h[0]=c(this.h[0],Le),this.h[1]=c(this.h[1],Ge),this.h[2]=c(this.h[2],ze),this.h[3]=c(this.h[3],Xe),this.h[4]=c(this.h[4],He)},L.prototype._digest=function(X){return X==="hex"?n.toHex32(this.h,"big"):n.split32(this.h,"big")}}),require_256=__commonJS2((r,t)=>{var n=require_utils3(),s=require_common(),o=require_common2(),a=require_minimalistic_assert(),c=n.sum32,f=n.sum32_4,g=n.sum32_5,b=o.ch32,_=o.maj32,L=o.s0_256,q=o.s1_256,X=o.g0_256,te=o.g1_256,ne=s.BlockHash,Ce=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Le(){if(!(this instanceof Le))return new Le;ne.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=Ce,this.W=new Array(64)}n.inherits(Le,ne),t.exports=Le,Le.blockSize=512,Le.outSize=256,Le.hmacStrength=192,Le.padLength=64,Le.prototype._update=function(ze,Xe){for(var He=this.W,Ve=0;Ve<16;Ve++)He[Ve]=ze[Xe+Ve];for(;Ve<He.length;Ve++)He[Ve]=f(te(He[Ve-2]),He[Ve-7],X(He[Ve-15]),He[Ve-16]);var We=this.h[0],rt=this.h[1],st=this.h[2],ht=this.h[3],je=this.h[4],se=this.h[5],m=this.h[6],A=this.h[7];for(a(this.k.length===He.length),Ve=0;Ve<He.length;Ve++){var k=g(A,q(je),b(je,se,m),this.k[Ve],He[Ve]),Y=c(L(We),_(We,rt,st));A=m,m=se,se=je,je=c(ht,k),ht=st,st=rt,rt=We,We=c(k,Y)}this.h[0]=c(this.h[0],We),this.h[1]=c(this.h[1],rt),this.h[2]=c(this.h[2],st),this.h[3]=c(this.h[3],ht),this.h[4]=c(this.h[4],je),this.h[5]=c(this.h[5],se),this.h[6]=c(this.h[6],m),this.h[7]=c(this.h[7],A)},Le.prototype._digest=function(ze){return ze==="hex"?n.toHex32(this.h,"big"):n.split32(this.h,"big")}}),require_224=__commonJS2((r,t)=>{var n=require_utils3(),s=require_256();function o(){if(!(this instanceof o))return new o;s.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}n.inherits(o,s),t.exports=o,o.blockSize=512,o.outSize=224,o.hmacStrength=192,o.padLength=64,o.prototype._digest=function(c){return c==="hex"?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}}),require_512=__commonJS2((r,t)=>{var n=require_utils3(),s=require_common(),o=require_minimalistic_assert(),a=n.rotr64_hi,c=n.rotr64_lo,f=n.shr64_hi,g=n.shr64_lo,b=n.sum64,_=n.sum64_hi,L=n.sum64_lo,q=n.sum64_4_hi,X=n.sum64_4_lo,te=n.sum64_5_hi,ne=n.sum64_5_lo,Ce=s.BlockHash,Le=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Ge(){if(!(this instanceof Ge))return new Ge;Ce.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=Le,this.W=new Array(160)}n.inherits(Ge,Ce),t.exports=Ge,Ge.blockSize=1024,Ge.outSize=512,Ge.hmacStrength=192,Ge.padLength=128,Ge.prototype._prepareBlock=function(Y,Q){for(var $e=this.W,ve=0;ve<32;ve++)$e[ve]=Y[Q+ve];for(;ve<$e.length;ve+=2){var re=m($e[ve-4],$e[ve-3]),B=A($e[ve-4],$e[ve-3]),oe=$e[ve-14],Ue=$e[ve-13],Ze=je($e[ve-30],$e[ve-29]),lt=se($e[ve-30],$e[ve-29]),St=$e[ve-32],Mt=$e[ve-31];$e[ve]=q(re,B,oe,Ue,Ze,lt,St,Mt),$e[ve+1]=X(re,B,oe,Ue,Ze,lt,St,Mt)}},Ge.prototype._update=function(Y,Q){this._prepareBlock(Y,Q);var $e=this.W,ve=this.h[0],re=this.h[1],B=this.h[2],oe=this.h[3],Ue=this.h[4],Ze=this.h[5],lt=this.h[6],St=this.h[7],Mt=this.h[8],Ft=this.h[9],Zt=this.h[10],Ut=this.h[11],vr=this.h[12],zr=this.h[13],or=this.h[14],sr=this.h[15];o(this.k.length===$e.length);for(var er=0;er<$e.length;er+=2){var Xt=or,nr=sr,Fr=st(Mt,Ft),Ar=ht(Mt,Ft),qr=ze(Mt,Ft,Zt,Ut,vr),dn=Xe(Mt,Ft,Zt,Ut,vr,zr),Mr=this.k[er],gr=this.k[er+1],en=$e[er],ur=$e[er+1],ar=te(Xt,nr,Fr,Ar,qr,dn,Mr,gr,en,ur),Nr=ne(Xt,nr,Fr,Ar,qr,dn,Mr,gr,en,ur);Xt=We(ve,re),nr=rt(ve,re),Fr=He(ve,re,B,oe,Ue),Ar=Ve(ve,re,B,oe,Ue,Ze);var Yt=_(Xt,nr,Fr,Ar),Ir=L(Xt,nr,Fr,Ar);or=vr,sr=zr,vr=Zt,zr=Ut,Zt=Mt,Ut=Ft,Mt=_(lt,St,ar,Nr),Ft=L(St,St,ar,Nr),lt=Ue,St=Ze,Ue=B,Ze=oe,B=ve,oe=re,ve=_(ar,Nr,Yt,Ir),re=L(ar,Nr,Yt,Ir)}b(this.h,0,ve,re),b(this.h,2,B,oe),b(this.h,4,Ue,Ze),b(this.h,6,lt,St),b(this.h,8,Mt,Ft),b(this.h,10,Zt,Ut),b(this.h,12,vr,zr),b(this.h,14,or,sr)},Ge.prototype._digest=function(Y){return Y==="hex"?n.toHex32(this.h,"big"):n.split32(this.h,"big")};function ze(k,Y,Q,$e,ve){var re=k&Q^~k&ve;return re<0&&(re+=4294967296),re}function Xe(k,Y,Q,$e,ve,re){var B=Y&$e^~Y&re;return B<0&&(B+=4294967296),B}function He(k,Y,Q,$e,ve){var re=k&Q^k&ve^Q&ve;return re<0&&(re+=4294967296),re}function Ve(k,Y,Q,$e,ve,re){var B=Y&$e^Y&re^$e&re;return B<0&&(B+=4294967296),B}function We(k,Y){var Q=a(k,Y,28),$e=a(Y,k,2),ve=a(Y,k,7),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function rt(k,Y){var Q=c(k,Y,28),$e=c(Y,k,2),ve=c(Y,k,7),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function st(k,Y){var Q=a(k,Y,14),$e=a(k,Y,18),ve=a(Y,k,9),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function ht(k,Y){var Q=c(k,Y,14),$e=c(k,Y,18),ve=c(Y,k,9),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function je(k,Y){var Q=a(k,Y,1),$e=a(k,Y,8),ve=f(k,Y,7),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function se(k,Y){var Q=c(k,Y,1),$e=c(k,Y,8),ve=g(k,Y,7),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function m(k,Y){var Q=a(k,Y,19),$e=a(Y,k,29),ve=f(k,Y,6),re=Q^$e^ve;return re<0&&(re+=4294967296),re}function A(k,Y){var Q=c(k,Y,19),$e=c(Y,k,29),ve=g(k,Y,6),re=Q^$e^ve;return re<0&&(re+=4294967296),re}}),require_384=__commonJS2((r,t)=>{var n=require_utils3(),s=require_512();function o(){if(!(this instanceof o))return new o;s.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}n.inherits(o,s),t.exports=o,o.blockSize=1024,o.outSize=384,o.hmacStrength=192,o.padLength=128,o.prototype._digest=function(c){return c==="hex"?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}}),require_sha=__commonJS2(r=>{r.sha1=require_1(),r.sha224=require_224(),r.sha256=require_256(),r.sha384=require_384(),r.sha512=require_512()}),require_ripemd=__commonJS2(r=>{var t=require_utils3(),n=require_common(),s=t.rotl32,o=t.sum32,a=t.sum32_3,c=t.sum32_4,f=n.BlockHash;function g(){if(!(this instanceof g))return new g;f.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}t.inherits(g,f),r.ripemd160=g,g.blockSize=512,g.outSize=160,g.hmacStrength=192,g.padLength=64,g.prototype._update=function(Le,Ge){for(var ze=this.h[0],Xe=this.h[1],He=this.h[2],Ve=this.h[3],We=this.h[4],rt=ze,st=Xe,ht=He,je=Ve,se=We,m=0;m<80;m++){var A=o(s(c(ze,b(m,Xe,He,Ve),Le[q[m]+Ge],_(m)),te[m]),We);ze=We,We=Ve,Ve=s(He,10),He=Xe,Xe=A,A=o(s(c(rt,b(79-m,st,ht,je),Le[X[m]+Ge],L(m)),ne[m]),se),rt=se,se=je,je=s(ht,10),ht=st,st=A}A=a(this.h[1],He,je),this.h[1]=a(this.h[2],Ve,se),this.h[2]=a(this.h[3],We,rt),this.h[3]=a(this.h[4],ze,st),this.h[4]=a(this.h[0],Xe,ht),this.h[0]=A},g.prototype._digest=function(Le){return Le==="hex"?t.toHex32(this.h,"little"):t.split32(this.h,"little")};function b(Ce,Le,Ge,ze){return Ce<=15?Le^Ge^ze:Ce<=31?Le&Ge|~Le&ze:Ce<=47?(Le|~Ge)^ze:Ce<=63?Le&ze|Ge&~ze:Le^(Ge|~ze)}function _(Ce){return Ce<=15?0:Ce<=31?1518500249:Ce<=47?1859775393:Ce<=63?2400959708:2840853838}function L(Ce){return Ce<=15?1352829926:Ce<=31?1548603684:Ce<=47?1836072691:Ce<=63?2053994217:0}var q=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],X=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],te=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],ne=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]}),require_hmac=__commonJS2((r,t)=>{var n=require_utils3(),s=require_minimalistic_assert();function o(a,c,f){if(!(this instanceof o))return new o(a,c,f);this.Hash=a,this.blockSize=a.blockSize/8,this.outSize=a.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(c,f))}t.exports=o,o.prototype._init=function(c){c.length>this.blockSize&&(c=new this.Hash().update(c).digest()),s(c.length<=this.blockSize);for(var f=c.length;f<this.blockSize;f++)c.push(0);for(f=0;f<c.length;f++)c[f]^=54;for(this.inner=new this.Hash().update(c),f=0;f<c.length;f++)c[f]^=106;this.outer=new this.Hash().update(c)},o.prototype.update=function(c,f){return this.inner.update(c,f),this},o.prototype.digest=function(c){return this.outer.update(this.inner.digest()),this.outer.digest(c)}}),require_hash=__commonJS2(r=>{var t=r;t.utils=require_utils3(),t.common=require_common(),t.sha=require_sha(),t.ripemd=require_ripemd(),t.hmac=require_hmac(),t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160}),require_secp256k1=__commonJS2((r,t)=>{t.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}}),require_curves=__commonJS2(r=>{var t=r,n=require_hash(),s=require_curve(),o=require_utils2(),a=o.assert;function c(b){b.type==="short"?this.curve=new s.short(b):b.type==="edwards"?this.curve=new s.edwards(b):this.curve=new s.mont(b),this.g=this.curve.g,this.n=this.curve.n,this.hash=b.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}t.PresetCurve=c;function f(b,_){Object.defineProperty(t,b,{configurable:!0,enumerable:!0,get:function(){var L=new c(_);return Object.defineProperty(t,b,{configurable:!0,enumerable:!0,value:L}),L}})}f("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:n.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),f("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:n.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),f("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:n.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),f("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:n.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),f("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:n.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),f("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["9"]}),f("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var g;try{g=require_secp256k1()}catch{g=void 0}f("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:n.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",g]})}),require_hmac_drbg=__commonJS2((r,t)=>{var n=require_hash(),s=require_utils(),o=require_minimalistic_assert();function a(c){if(!(this instanceof a))return new a(c);this.hash=c.hash,this.predResist=!!c.predResist,this.outLen=this.hash.outSize,this.minEntropy=c.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var f=s.toArray(c.entropy,c.entropyEnc||"hex"),g=s.toArray(c.nonce,c.nonceEnc||"hex"),b=s.toArray(c.pers,c.persEnc||"hex");o(f.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(f,g,b)}t.exports=a,a.prototype._init=function(f,g,b){var _=f.concat(g).concat(b);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var L=0;L<this.V.length;L++)this.K[L]=0,this.V[L]=1;this._update(_),this._reseed=1,this.reseedInterval=281474976710656},a.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},a.prototype._update=function(f){var g=this._hmac().update(this.V).update([0]);f&&(g=g.update(f)),this.K=g.digest(),this.V=this._hmac().update(this.V).digest(),f&&(this.K=this._hmac().update(this.V).update([1]).update(f).digest(),this.V=this._hmac().update(this.V).digest())},a.prototype.reseed=function(f,g,b,_){typeof g!="string"&&(_=b,b=g,g=null),f=s.toArray(f,g),b=s.toArray(b,_),o(f.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(f.concat(b||[])),this._reseed=1},a.prototype.generate=function(f,g,b,_){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof g!="string"&&(_=b,b=g,g=null),b&&(b=s.toArray(b,_||"hex"),this._update(b));for(var L=[];L.length<f;)this.V=this._hmac().update(this.V).digest(),L=L.concat(this.V);var q=L.slice(0,f);return this._update(b),this._reseed++,s.encode(q,g)}}),require_key=__commonJS2((r,t)=>{var n=require_bn(),s=require_utils2(),o=s.assert;function a(c,f){this.ec=c,this.priv=null,this.pub=null,f.priv&&this._importPrivate(f.priv,f.privEnc),f.pub&&this._importPublic(f.pub,f.pubEnc)}t.exports=a,a.fromPublic=function(f,g,b){return g instanceof a?g:new a(f,{pub:g,pubEnc:b})},a.fromPrivate=function(f,g,b){return g instanceof a?g:new a(f,{priv:g,privEnc:b})},a.prototype.validate=function(){var f=this.getPublic();return f.isInfinity()?{result:!1,reason:"Invalid public key"}:f.validate()?f.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},a.prototype.getPublic=function(f,g){return typeof f=="string"&&(g=f,f=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),g?this.pub.encode(g,f):this.pub},a.prototype.getPrivate=function(f){return f==="hex"?this.priv.toString(16,2):this.priv},a.prototype._importPrivate=function(f,g){this.priv=new n(f,g||16),this.priv=this.priv.umod(this.ec.curve.n)},a.prototype._importPublic=function(f,g){if(f.x||f.y){this.ec.curve.type==="mont"?o(f.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&o(f.x&&f.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(f.x,f.y);return}this.pub=this.ec.curve.decodePoint(f,g)},a.prototype.derive=function(f){return f.validate()||o(f.validate(),"public point not validated"),f.mul(this.priv).getX()},a.prototype.sign=function(f,g,b){return this.ec.sign(f,this,g,b)},a.prototype.verify=function(f,g,b){return this.ec.verify(f,g,this,void 0,b)},a.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}}),require_signature=__commonJS2((r,t)=>{var n=require_bn(),s=require_utils2(),o=s.assert;function a(_,L){if(_ instanceof a)return _;this._importDER(_,L)||(o(_.r&&_.s,"Signature without r or s"),this.r=new n(_.r,16),this.s=new n(_.s,16),_.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=_.recoveryParam)}t.exports=a;function c(){this.place=0}function f(_,L){var q=_[L.place++];if(!(q&128))return q;var X=q&15;if(X===0||X>4||_[L.place]===0)return!1;for(var te=0,ne=0,Ce=L.place;ne<X;ne++,Ce++)te<<=8,te|=_[Ce],te>>>=0;return te<=127?!1:(L.place=Ce,te)}function g(_){for(var L=0,q=_.length-1;!_[L]&&!(_[L+1]&128)&&L<q;)L++;return L===0?_:_.slice(L)}a.prototype._importDER=function(L,q){L=s.toArray(L,q);var X=new c;if(L[X.place++]!==48)return!1;var te=f(L,X);if(te===!1||te+X.place!==L.length||L[X.place++]!==2)return!1;var ne=f(L,X);if(ne===!1||(L[X.place]&128)!==0)return!1;var Ce=L.slice(X.place,ne+X.place);if(X.place+=ne,L[X.place++]!==2)return!1;var Le=f(L,X);if(Le===!1||L.length!==Le+X.place||(L[X.place]&128)!==0)return!1;var Ge=L.slice(X.place,Le+X.place);if(Ce[0]===0)if(Ce[1]&128)Ce=Ce.slice(1);else return!1;if(Ge[0]===0)if(Ge[1]&128)Ge=Ge.slice(1);else return!1;return this.r=new n(Ce),this.s=new n(Ge),this.recoveryParam=null,!0};function b(_,L){if(L<128){_.push(L);return}var q=1+(Math.log(L)/Math.LN2>>>3);for(_.push(q|128);--q;)_.push(L>>>(q<<3)&255);_.push(L)}a.prototype.toDER=function(L){var q=this.r.toArray(),X=this.s.toArray();for(q[0]&128&&(q=[0].concat(q)),X[0]&128&&(X=[0].concat(X)),q=g(q),X=g(X);!X[0]&&!(X[1]&128);)X=X.slice(1);var te=[2];b(te,q.length),te=te.concat(q),te.push(2),b(te,X.length);var ne=te.concat(X),Ce=[48];return b(Ce,ne.length),Ce=Ce.concat(ne),s.encode(Ce,L)}}),require_ec=__commonJS2((r,t)=>{var n=require_bn(),s=require_hmac_drbg(),o=require_utils2(),a=require_curves(),c=require_brorand(),f=o.assert,g=require_key(),b=require_signature();function _(L){if(!(this instanceof _))return new _(L);typeof L=="string"&&(f(Object.prototype.hasOwnProperty.call(a,L),"Unknown curve "+L),L=a[L]),L instanceof a.PresetCurve&&(L={curve:L}),this.curve=L.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=L.curve.g,this.g.precompute(L.curve.n.bitLength()+1),this.hash=L.hash||L.curve.hash}t.exports=_,_.prototype.keyPair=function(q){return new g(this,q)},_.prototype.keyFromPrivate=function(q,X){return g.fromPrivate(this,q,X)},_.prototype.keyFromPublic=function(q,X){return g.fromPublic(this,q,X)},_.prototype.genKeyPair=function(q){q||(q={});for(var X=new s({hash:this.hash,pers:q.pers,persEnc:q.persEnc||"utf8",entropy:q.entropy||c(this.hash.hmacStrength),entropyEnc:q.entropy&&q.entropyEnc||"utf8",nonce:this.n.toArray()}),te=this.n.byteLength(),ne=this.n.sub(new n(2));;){var Ce=new n(X.generate(te));if(!(Ce.cmp(ne)>0))return Ce.iaddn(1),this.keyFromPrivate(Ce)}},_.prototype._truncateToN=function(q,X,te){var ne;if(n.isBN(q)||typeof q=="number")q=new n(q,16),ne=q.byteLength();else if(typeof q=="object")ne=q.length,q=new n(q,16);else{var Ce=q.toString();ne=Ce.length+1>>>1,q=new n(Ce,16)}typeof te!="number"&&(te=ne*8);var Le=te-this.n.bitLength();return Le>0&&(q=q.ushrn(Le)),!X&&q.cmp(this.n)>=0?q.sub(this.n):q},_.prototype.sign=function(q,X,te,ne){if(typeof te=="object"&&(ne=te,te=null),ne||(ne={}),typeof q!="string"&&typeof q!="number"&&!n.isBN(q)){f(typeof q=="object"&&q&&typeof q.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),f(q.length>>>0===q.length);for(var Ce=0;Ce<q.length;Ce++)f((q[Ce]&255)===q[Ce])}X=this.keyFromPrivate(X,te),q=this._truncateToN(q,!1,ne.msgBitLength),f(!q.isNeg(),"Can not sign a negative message");var Le=this.n.byteLength(),Ge=X.getPrivate().toArray("be",Le),ze=q.toArray("be",Le);f(new n(ze).eq(q),"Can not sign message");for(var Xe=new s({hash:this.hash,entropy:Ge,nonce:ze,pers:ne.pers,persEnc:ne.persEnc||"utf8"}),He=this.n.sub(new n(1)),Ve=0;;Ve++){var We=ne.k?ne.k(Ve):new n(Xe.generate(this.n.byteLength()));if(We=this._truncateToN(We,!0),!(We.cmpn(1)<=0||We.cmp(He)>=0)){var rt=this.g.mul(We);if(!rt.isInfinity()){var st=rt.getX(),ht=st.umod(this.n);if(ht.cmpn(0)!==0){var je=We.invm(this.n).mul(ht.mul(X.getPrivate()).iadd(q));if(je=je.umod(this.n),je.cmpn(0)!==0){var se=(rt.getY().isOdd()?1:0)|(st.cmp(ht)!==0?2:0);return ne.canonical&&je.cmp(this.nh)>0&&(je=this.n.sub(je),se^=1),new b({r:ht,s:je,recoveryParam:se})}}}}}},_.prototype.verify=function(q,X,te,ne,Ce){Ce||(Ce={}),q=this._truncateToN(q,!1,Ce.msgBitLength),te=this.keyFromPublic(te,ne),X=new b(X,"hex");var{r:Le,s:Ge}=X;if(Le.cmpn(1)<0||Le.cmp(this.n)>=0||Ge.cmpn(1)<0||Ge.cmp(this.n)>=0)return!1;var ze=Ge.invm(this.n),Xe=ze.mul(q).umod(this.n),He=ze.mul(Le).umod(this.n),Ve;return this.curve._maxwellTrick?(Ve=this.g.jmulAdd(Xe,te.getPublic(),He),Ve.isInfinity()?!1:Ve.eqXToP(Le)):(Ve=this.g.mulAdd(Xe,te.getPublic(),He),Ve.isInfinity()?!1:Ve.getX().umod(this.n).cmp(Le)===0)},_.prototype.recoverPubKey=function(L,q,X,te){f((3&X)===X,"The recovery param is more than two bits"),q=new b(q,te);var ne=this.n,Ce=new n(L),Le=q.r,Ge=q.s,ze=X&1,Xe=X>>1;if(Le.cmp(this.curve.p.umod(this.curve.n))>=0&&Xe)throw new Error("Unable to find sencond key candinate");Xe?Le=this.curve.pointFromX(Le.add(this.curve.n),ze):Le=this.curve.pointFromX(Le,ze);var He=q.r.invm(ne),Ve=ne.sub(Ce).mul(He).umod(ne),We=Ge.mul(He).umod(ne);return this.g.mulAdd(Ve,Le,We)},_.prototype.getKeyRecoveryParam=function(L,q,X,te){if(q=new b(q,te),q.recoveryParam!==null)return q.recoveryParam;for(var ne=0;ne<4;ne++){var Ce;try{Ce=this.recoverPubKey(L,q,ne)}catch{continue}if(Ce.eq(X))return ne}throw new Error("Unable to find valid recovery factor")}}),require_key2=__commonJS2((r,t)=>{var n=require_utils2(),s=n.assert,o=n.parseBytes,a=n.cachedProperty;function c(f,g){this.eddsa=f,this._secret=o(g.secret),f.isPoint(g.pub)?this._pub=g.pub:this._pubBytes=o(g.pub)}c.fromPublic=function(g,b){return b instanceof c?b:new c(g,{pub:b})},c.fromSecret=function(g,b){return b instanceof c?b:new c(g,{secret:b})},c.prototype.secret=function(){return this._secret},a(c,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),a(c,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),a(c,"privBytes",function(){var g=this.eddsa,b=this.hash(),_=g.encodingLength-1,L=b.slice(0,g.encodingLength);return L[0]&=248,L[_]&=127,L[_]|=64,L}),a(c,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),a(c,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),a(c,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),c.prototype.sign=function(g){return s(this._secret,"KeyPair can only verify"),this.eddsa.sign(g,this)},c.prototype.verify=function(g,b){return this.eddsa.verify(g,b,this)},c.prototype.getSecret=function(g){return s(this._secret,"KeyPair is public only"),n.encode(this.secret(),g)},c.prototype.getPublic=function(g){return n.encode(this.pubBytes(),g)},t.exports=c}),require_signature2=__commonJS2((r,t)=>{var n=require_bn(),s=require_utils2(),o=s.assert,a=s.cachedProperty,c=s.parseBytes;function f(g,b){this.eddsa=g,typeof b!="object"&&(b=c(b)),Array.isArray(b)&&(o(b.length===g.encodingLength*2,"Signature has invalid size"),b={R:b.slice(0,g.encodingLength),S:b.slice(g.encodingLength)}),o(b.R&&b.S,"Signature without R or S"),g.isPoint(b.R)&&(this._R=b.R),b.S instanceof n&&(this._S=b.S),this._Rencoded=Array.isArray(b.R)?b.R:b.Rencoded,this._Sencoded=Array.isArray(b.S)?b.S:b.Sencoded}a(f,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),a(f,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),a(f,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),a(f,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),f.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},f.prototype.toHex=function(){return s.encode(this.toBytes(),"hex").toUpperCase()},t.exports=f}),require_eddsa=__commonJS2((r,t)=>{var n=require_hash(),s=require_curves(),o=require_utils2(),a=o.assert,c=o.parseBytes,f=require_key2(),g=require_signature2();function b(_){if(a(_==="ed25519","only tested with ed25519 so far"),!(this instanceof b))return new b(_);_=s[_].curve,this.curve=_,this.g=_.g,this.g.precompute(_.n.bitLength()+1),this.pointClass=_.point().constructor,this.encodingLength=Math.ceil(_.n.bitLength()/8),this.hash=n.sha512}t.exports=b,b.prototype.sign=function(L,q){L=c(L);var X=this.keyFromSecret(q),te=this.hashInt(X.messagePrefix(),L),ne=this.g.mul(te),Ce=this.encodePoint(ne),Le=this.hashInt(Ce,X.pubBytes(),L).mul(X.priv()),Ge=te.add(Le).umod(this.curve.n);return this.makeSignature({R:ne,S:Ge,Rencoded:Ce})},b.prototype.verify=function(L,q,X){if(L=c(L),q=this.makeSignature(q),q.S().gte(q.eddsa.curve.n)||q.S().isNeg())return!1;var te=this.keyFromPublic(X),ne=this.hashInt(q.Rencoded(),te.pubBytes(),L),Ce=this.g.mul(q.S()),Le=q.R().add(te.pub().mul(ne));return Le.eq(Ce)},b.prototype.hashInt=function(){for(var L=this.hash(),q=0;q<arguments.length;q++)L.update(arguments[q]);return o.intFromLE(L.digest()).umod(this.curve.n)},b.prototype.keyFromPublic=function(L){return f.fromPublic(this,L)},b.prototype.keyFromSecret=function(L){return f.fromSecret(this,L)},b.prototype.makeSignature=function(L){return L instanceof g?L:new g(this,L)},b.prototype.encodePoint=function(L){var q=L.getY().toArray("le",this.encodingLength);return q[this.encodingLength-1]|=L.getX().isOdd()?128:0,q},b.prototype.decodePoint=function(L){L=o.parseBytes(L);var q=L.length-1,X=L.slice(0,q).concat(L[q]&-129),te=(L[q]&128)!==0,ne=o.intFromLE(X);return this.curve.pointFromY(ne,te)},b.prototype.encodeInt=function(L){return L.toArray("le",this.encodingLength)},b.prototype.decodeInt=function(L){return o.intFromLE(L)},b.prototype.isPoint=function(L){return L instanceof this.pointClass}}),require_elliptic=__commonJS2(r=>{var t=r;t.version=require_package().version,t.utils=require_utils2(),t.rand=require_brorand(),t.curve=require_curve(),t.curves=require_curves(),t.ec=require_ec(),t.eddsa=require_eddsa()}),require_bn2=__commonJS2((r,t)=>{(function(n,s){function o(se,m){if(!se)throw new Error(m||"Assertion failed")}function a(se,m){se.super_=m;var A=function(){};A.prototype=m.prototype,se.prototype=new A,se.prototype.constructor=se}function c(se,m,A){if(c.isBN(se))return se;this.negative=0,this.words=null,this.length=0,this.red=null,se!==null&&((m==="le"||m==="be")&&(A=m,m=10),this._init(se||0,m||10,A||"be"))}typeof n=="object"?n.exports=c:s.BN=c,c.BN=c,c.wordSize=26;var f;try{typeof window<"u"&&typeof window.Buffer<"u"?f=window.Buffer:f=(init_buffer(),__toCommonJS(exports_buffer)).Buffer}catch{}c.isBN=function(m){return m instanceof c?!0:m!==null&&typeof m=="object"&&m.constructor.wordSize===c.wordSize&&Array.isArray(m.words)},c.max=function(m,A){return m.cmp(A)>0?m:A},c.min=function(m,A){return m.cmp(A)<0?m:A},c.prototype._init=function(m,A,k){if(typeof m=="number")return this._initNumber(m,A,k);if(typeof m=="object")return this._initArray(m,A,k);A==="hex"&&(A=16),o(A===(A|0)&&A>=2&&A<=36),m=m.toString().replace(/\s+/g,"");var Y=0;m[0]==="-"&&(Y++,this.negative=1),Y<m.length&&(A===16?this._parseHex(m,Y,k):(this._parseBase(m,A,Y),k==="le"&&this._initArray(this.toArray(),A,k)))},c.prototype._initNumber=function(m,A,k){m<0&&(this.negative=1,m=-m),m<67108864?(this.words=[m&67108863],this.length=1):m<4503599627370496?(this.words=[m&67108863,m/67108864&67108863],this.length=2):(o(m<9007199254740992),this.words=[m&67108863,m/67108864&67108863,1],this.length=3),k==="le"&&this._initArray(this.toArray(),A,k)},c.prototype._initArray=function(m,A,k){if(o(typeof m.length=="number"),m.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(m.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q,$e,ve=0;if(k==="be")for(Y=m.length-1,Q=0;Y>=0;Y-=3)$e=m[Y]|m[Y-1]<<8|m[Y-2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);else if(k==="le")for(Y=0,Q=0;Y<m.length;Y+=3)$e=m[Y]|m[Y+1]<<8|m[Y+2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);return this.strip()};function g(se,m){var A=se.charCodeAt(m);return A>=65&&A<=70?A-55:A>=97&&A<=102?A-87:A-48&15}function b(se,m,A){var k=g(se,A);return A-1>=m&&(k|=g(se,A-1)<<4),k}c.prototype._parseHex=function(m,A,k){this.length=Math.ceil((m.length-A)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q=0,$e=0,ve;if(k==="be")for(Y=m.length-1;Y>=A;Y-=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8;else{var re=m.length-A;for(Y=re%2===0?A+1:A;Y<m.length;Y+=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8}this.strip()};function _(se,m,A,k){for(var Y=0,Q=Math.min(se.length,A),$e=m;$e<Q;$e++){var ve=se.charCodeAt($e)-48;Y*=k,ve>=49?Y+=ve-49+10:ve>=17?Y+=ve-17+10:Y+=ve}return Y}c.prototype._parseBase=function(m,A,k){this.words=[0],this.length=1;for(var Y=0,Q=1;Q<=67108863;Q*=A)Y++;Y--,Q=Q/A|0;for(var $e=m.length-k,ve=$e%Y,re=Math.min($e,$e-ve)+k,B=0,oe=k;oe<re;oe+=Y)B=_(m,oe,oe+Y,A),this.imuln(Q),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B);if(ve!==0){var Ue=1;for(B=_(m,oe,m.length,A),oe=0;oe<ve;oe++)Ue*=A;this.imuln(Ue),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B)}this.strip()},c.prototype.copy=function(m){m.words=new Array(this.length);for(var A=0;A<this.length;A++)m.words[A]=this.words[A];m.length=this.length,m.negative=this.negative,m.red=this.red},c.prototype.clone=function(){var m=new c(null);return this.copy(m),m},c.prototype._expand=function(m){for(;this.length<m;)this.words[this.length++]=0;return this},c.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},c.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var L=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],q=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],X=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(m,A){m=m||10,A=A|0||1;var k;if(m===16||m==="hex"){k="";for(var Y=0,Q=0,$e=0;$e<this.length;$e++){var ve=this.words[$e],re=((ve<<Y|Q)&16777215).toString(16);Q=ve>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,$e--),Q!==0||$e!==this.length-1?k=L[6-re.length]+re+k:k=re+k}for(Q!==0&&(k=Q.toString(16)+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}if(m===(m|0)&&m>=2&&m<=36){var B=q[m],oe=X[m];k="";var Ue=this.clone();for(Ue.negative=0;!Ue.isZero();){var Ze=Ue.modn(oe).toString(m);Ue=Ue.idivn(oe),Ue.isZero()?k=Ze+k:k=L[B-Ze.length]+Ze+k}for(this.isZero()&&(k="0"+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}o(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var m=this.words[0];return this.length===2?m+=this.words[1]*67108864:this.length===3&&this.words[2]===1?m+=4503599627370496+this.words[1]*67108864:this.length>2&&o(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-m:m},c.prototype.toJSON=function(){return this.toString(16)},c.prototype.toBuffer=function(m,A){return o(typeof f<"u"),this.toArrayLike(f,m,A)},c.prototype.toArray=function(m,A){return this.toArrayLike(Array,m,A)},c.prototype.toArrayLike=function(m,A,k){var Y=this.byteLength(),Q=k||Math.max(1,Y);o(Y<=Q,"byte array longer than desired length"),o(Q>0,"Requested array length <= 0"),this.strip();var $e=A==="le",ve=new m(Q),re,B,oe=this.clone();if($e){for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[B]=re;for(;B<Q;B++)ve[B]=0}else{for(B=0;B<Q-Y;B++)ve[B]=0;for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[Q-B-1]=re}return ve},Math.clz32?c.prototype._countBits=function(m){return 32-Math.clz32(m)}:c.prototype._countBits=function(m){var A=m,k=0;return A>=4096&&(k+=13,A>>>=13),A>=64&&(k+=7,A>>>=7),A>=8&&(k+=4,A>>>=4),A>=2&&(k+=2,A>>>=2),k+A},c.prototype._zeroBits=function(m){if(m===0)return 26;var A=m,k=0;return(A&8191)===0&&(k+=13,A>>>=13),(A&127)===0&&(k+=7,A>>>=7),(A&15)===0&&(k+=4,A>>>=4),(A&3)===0&&(k+=2,A>>>=2),(A&1)===0&&k++,k},c.prototype.bitLength=function(){var m=this.words[this.length-1],A=this._countBits(m);return(this.length-1)*26+A};function te(se){for(var m=new Array(se.bitLength()),A=0;A<m.length;A++){var k=A/26|0,Y=A%26;m[A]=(se.words[k]&1<<Y)>>>Y}return m}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var m=0,A=0;A<this.length;A++){var k=this._zeroBits(this.words[A]);if(m+=k,k!==26)break}return m},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(m){return this.negative!==0?this.abs().inotn(m).iaddn(1):this.clone()},c.prototype.fromTwos=function(m){return this.testn(m-1)?this.notn(m).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(m){for(;this.length<m.length;)this.words[this.length++]=0;for(var A=0;A<m.length;A++)this.words[A]=this.words[A]|m.words[A];return this.strip()},c.prototype.ior=function(m){return o((this.negative|m.negative)===0),this.iuor(m)},c.prototype.or=function(m){return this.length>m.length?this.clone().ior(m):m.clone().ior(this)},c.prototype.uor=function(m){return this.length>m.length?this.clone().iuor(m):m.clone().iuor(this)},c.prototype.iuand=function(m){var A;this.length>m.length?A=m:A=this;for(var k=0;k<A.length;k++)this.words[k]=this.words[k]&m.words[k];return this.length=A.length,this.strip()},c.prototype.iand=function(m){return o((this.negative|m.negative)===0),this.iuand(m)},c.prototype.and=function(m){return this.length>m.length?this.clone().iand(m):m.clone().iand(this)},c.prototype.uand=function(m){return this.length>m.length?this.clone().iuand(m):m.clone().iuand(this)},c.prototype.iuxor=function(m){var A,k;this.length>m.length?(A=this,k=m):(A=m,k=this);for(var Y=0;Y<k.length;Y++)this.words[Y]=A.words[Y]^k.words[Y];if(this!==A)for(;Y<A.length;Y++)this.words[Y]=A.words[Y];return this.length=A.length,this.strip()},c.prototype.ixor=function(m){return o((this.negative|m.negative)===0),this.iuxor(m)},c.prototype.xor=function(m){return this.length>m.length?this.clone().ixor(m):m.clone().ixor(this)},c.prototype.uxor=function(m){return this.length>m.length?this.clone().iuxor(m):m.clone().iuxor(this)},c.prototype.inotn=function(m){o(typeof m=="number"&&m>=0);var A=Math.ceil(m/26)|0,k=m%26;this._expand(A),k>0&&A--;for(var Y=0;Y<A;Y++)this.words[Y]=~this.words[Y]&67108863;return k>0&&(this.words[Y]=~this.words[Y]&67108863>>26-k),this.strip()},c.prototype.notn=function(m){return this.clone().inotn(m)},c.prototype.setn=function(m,A){o(typeof m=="number"&&m>=0);var k=m/26|0,Y=m%26;return this._expand(k+1),A?this.words[k]=this.words[k]|1<<Y:this.words[k]=this.words[k]&~(1<<Y),this.strip()},c.prototype.iadd=function(m){var A;if(this.negative!==0&&m.negative===0)return this.negative=0,A=this.isub(m),this.negative^=1,this._normSign();if(this.negative===0&&m.negative!==0)return m.negative=0,A=this.isub(m),m.negative=1,A._normSign();var k,Y;this.length>m.length?(k=this,Y=m):(k=m,Y=this);for(var Q=0,$e=0;$e<Y.length;$e++)A=(k.words[$e]|0)+(Y.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;for(;Q!==0&&$e<k.length;$e++)A=(k.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;if(this.length=k.length,Q!==0)this.words[this.length]=Q,this.length++;else if(k!==this)for(;$e<k.length;$e++)this.words[$e]=k.words[$e];return this},c.prototype.add=function(m){var A;return m.negative!==0&&this.negative===0?(m.negative=0,A=this.sub(m),m.negative^=1,A):m.negative===0&&this.negative!==0?(this.negative=0,A=m.sub(this),this.negative=1,A):this.length>m.length?this.clone().iadd(m):m.clone().iadd(this)},c.prototype.isub=function(m){if(m.negative!==0){m.negative=0;var A=this.iadd(m);return m.negative=1,A._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(m),this.negative=1,this._normSign();var k=this.cmp(m);if(k===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,Q;k>0?(Y=this,Q=m):(Y=m,Q=this);for(var $e=0,ve=0;ve<Q.length;ve++)A=(Y.words[ve]|0)-(Q.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;for(;$e!==0&&ve<Y.length;ve++)A=(Y.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;if($e===0&&ve<Y.length&&Y!==this)for(;ve<Y.length;ve++)this.words[ve]=Y.words[ve];return this.length=Math.max(this.length,ve),Y!==this&&(this.negative=1),this.strip()},c.prototype.sub=function(m){return this.clone().isub(m)};function ne(se,m,A){A.negative=m.negative^se.negative;var k=se.length+m.length|0;A.length=k,k=k-1|0;var Y=se.words[0]|0,Q=m.words[0]|0,$e=Y*Q,ve=$e&67108863,re=$e/67108864|0;A.words[0]=ve;for(var B=1;B<k;B++){for(var oe=re>>>26,Ue=re&67108863,Ze=Math.min(B,m.length-1),lt=Math.max(0,B-se.length+1);lt<=Ze;lt++){var St=B-lt|0;Y=se.words[St]|0,Q=m.words[lt]|0,$e=Y*Q+Ue,oe+=$e/67108864|0,Ue=$e&67108863}A.words[B]=Ue|0,re=oe|0}return re!==0?A.words[B]=re|0:A.length--,A.strip()}var Ce=function(m,A,k){var Y=m.words,Q=A.words,$e=k.words,ve=0,re,B,oe,Ue=Y[0]|0,Ze=Ue&8191,lt=Ue>>>13,St=Y[1]|0,Mt=St&8191,Ft=St>>>13,Zt=Y[2]|0,Ut=Zt&8191,vr=Zt>>>13,zr=Y[3]|0,or=zr&8191,sr=zr>>>13,er=Y[4]|0,Xt=er&8191,nr=er>>>13,Fr=Y[5]|0,Ar=Fr&8191,qr=Fr>>>13,dn=Y[6]|0,Mr=dn&8191,gr=dn>>>13,en=Y[7]|0,ur=en&8191,ar=en>>>13,Nr=Y[8]|0,Yt=Nr&8191,Ir=Nr>>>13,Qe=Y[9]|0,nt=Qe&8191,_t=Qe>>>13,Bt=Q[0]|0,Jt=Bt&8191,xt=Bt>>>13,mr=Q[1]|0,xr=mr&8191,wr=mr>>>13,nn=Q[2]|0,Cr=nn&8191,Zr=nn>>>13,pn=Q[3]|0,yr=pn&8191,Tr=pn>>>13,Br=Q[4]|0,Jr=Br&8191,rn=Br>>>13,dr=Q[5]|0,ir=dr&8191,Er=dr>>>13,an=Q[6]|0,Rr=an&8191,Ur=an>>>13,cr=Q[7]|0,Sr=cr&8191,Lr=cr>>>13,Qr=Q[8]|0,tn=Qr&8191,hn=Qr>>>13,gn=Q[9]|0,on=gn&8191,cn=gn>>>13;k.negative=m.negative^A.negative,k.length=19,re=Math.imul(Ze,Jt),B=Math.imul(Ze,xt),B=B+Math.imul(lt,Jt)|0,oe=Math.imul(lt,xt);var vn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(vn>>>26)|0,vn&=67108863,re=Math.imul(Mt,Jt),B=Math.imul(Mt,xt),B=B+Math.imul(Ft,Jt)|0,oe=Math.imul(Ft,xt),re=re+Math.imul(Ze,xr)|0,B=B+Math.imul(Ze,wr)|0,B=B+Math.imul(lt,xr)|0,oe=oe+Math.imul(lt,wr)|0;var _n=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(_n>>>26)|0,_n&=67108863,re=Math.imul(Ut,Jt),B=Math.imul(Ut,xt),B=B+Math.imul(vr,Jt)|0,oe=Math.imul(vr,xt),re=re+Math.imul(Mt,xr)|0,B=B+Math.imul(Mt,wr)|0,B=B+Math.imul(Ft,xr)|0,oe=oe+Math.imul(Ft,wr)|0,re=re+Math.imul(Ze,Cr)|0,B=B+Math.imul(Ze,Zr)|0,B=B+Math.imul(lt,Cr)|0,oe=oe+Math.imul(lt,Zr)|0;var Mn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Mn>>>26)|0,Mn&=67108863,re=Math.imul(or,Jt),B=Math.imul(or,xt),B=B+Math.imul(sr,Jt)|0,oe=Math.imul(sr,xt),re=re+Math.imul(Ut,xr)|0,B=B+Math.imul(Ut,wr)|0,B=B+Math.imul(vr,xr)|0,oe=oe+Math.imul(vr,wr)|0,re=re+Math.imul(Mt,Cr)|0,B=B+Math.imul(Mt,Zr)|0,B=B+Math.imul(Ft,Cr)|0,oe=oe+Math.imul(Ft,Zr)|0,re=re+Math.imul(Ze,yr)|0,B=B+Math.imul(Ze,Tr)|0,B=B+Math.imul(lt,yr)|0,oe=oe+Math.imul(lt,Tr)|0;var xn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(xn>>>26)|0,xn&=67108863,re=Math.imul(Xt,Jt),B=Math.imul(Xt,xt),B=B+Math.imul(nr,Jt)|0,oe=Math.imul(nr,xt),re=re+Math.imul(or,xr)|0,B=B+Math.imul(or,wr)|0,B=B+Math.imul(sr,xr)|0,oe=oe+Math.imul(sr,wr)|0,re=re+Math.imul(Ut,Cr)|0,B=B+Math.imul(Ut,Zr)|0,B=B+Math.imul(vr,Cr)|0,oe=oe+Math.imul(vr,Zr)|0,re=re+Math.imul(Mt,yr)|0,B=B+Math.imul(Mt,Tr)|0,B=B+Math.imul(Ft,yr)|0,oe=oe+Math.imul(Ft,Tr)|0,re=re+Math.imul(Ze,Jr)|0,B=B+Math.imul(Ze,rn)|0,B=B+Math.imul(lt,Jr)|0,oe=oe+Math.imul(lt,rn)|0;var Nn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,re=Math.imul(Ar,Jt),B=Math.imul(Ar,xt),B=B+Math.imul(qr,Jt)|0,oe=Math.imul(qr,xt),re=re+Math.imul(Xt,xr)|0,B=B+Math.imul(Xt,wr)|0,B=B+Math.imul(nr,xr)|0,oe=oe+Math.imul(nr,wr)|0,re=re+Math.imul(or,Cr)|0,B=B+Math.imul(or,Zr)|0,B=B+Math.imul(sr,Cr)|0,oe=oe+Math.imul(sr,Zr)|0,re=re+Math.imul(Ut,yr)|0,B=B+Math.imul(Ut,Tr)|0,B=B+Math.imul(vr,yr)|0,oe=oe+Math.imul(vr,Tr)|0,re=re+Math.imul(Mt,Jr)|0,B=B+Math.imul(Mt,rn)|0,B=B+Math.imul(Ft,Jr)|0,oe=oe+Math.imul(Ft,rn)|0,re=re+Math.imul(Ze,ir)|0,B=B+Math.imul(Ze,Er)|0,B=B+Math.imul(lt,ir)|0,oe=oe+Math.imul(lt,Er)|0;var zn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(zn>>>26)|0,zn&=67108863,re=Math.imul(Mr,Jt),B=Math.imul(Mr,xt),B=B+Math.imul(gr,Jt)|0,oe=Math.imul(gr,xt),re=re+Math.imul(Ar,xr)|0,B=B+Math.imul(Ar,wr)|0,B=B+Math.imul(qr,xr)|0,oe=oe+Math.imul(qr,wr)|0,re=re+Math.imul(Xt,Cr)|0,B=B+Math.imul(Xt,Zr)|0,B=B+Math.imul(nr,Cr)|0,oe=oe+Math.imul(nr,Zr)|0,re=re+Math.imul(or,yr)|0,B=B+Math.imul(or,Tr)|0,B=B+Math.imul(sr,yr)|0,oe=oe+Math.imul(sr,Tr)|0,re=re+Math.imul(Ut,Jr)|0,B=B+Math.imul(Ut,rn)|0,B=B+Math.imul(vr,Jr)|0,oe=oe+Math.imul(vr,rn)|0,re=re+Math.imul(Mt,ir)|0,B=B+Math.imul(Mt,Er)|0,B=B+Math.imul(Ft,ir)|0,oe=oe+Math.imul(Ft,Er)|0,re=re+Math.imul(Ze,Rr)|0,B=B+Math.imul(Ze,Ur)|0,B=B+Math.imul(lt,Rr)|0,oe=oe+Math.imul(lt,Ur)|0;var An=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(An>>>26)|0,An&=67108863,re=Math.imul(ur,Jt),B=Math.imul(ur,xt),B=B+Math.imul(ar,Jt)|0,oe=Math.imul(ar,xt),re=re+Math.imul(Mr,xr)|0,B=B+Math.imul(Mr,wr)|0,B=B+Math.imul(gr,xr)|0,oe=oe+Math.imul(gr,wr)|0,re=re+Math.imul(Ar,Cr)|0,B=B+Math.imul(Ar,Zr)|0,B=B+Math.imul(qr,Cr)|0,oe=oe+Math.imul(qr,Zr)|0,re=re+Math.imul(Xt,yr)|0,B=B+Math.imul(Xt,Tr)|0,B=B+Math.imul(nr,yr)|0,oe=oe+Math.imul(nr,Tr)|0,re=re+Math.imul(or,Jr)|0,B=B+Math.imul(or,rn)|0,B=B+Math.imul(sr,Jr)|0,oe=oe+Math.imul(sr,rn)|0,re=re+Math.imul(Ut,ir)|0,B=B+Math.imul(Ut,Er)|0,B=B+Math.imul(vr,ir)|0,oe=oe+Math.imul(vr,Er)|0,re=re+Math.imul(Mt,Rr)|0,B=B+Math.imul(Mt,Ur)|0,B=B+Math.imul(Ft,Rr)|0,oe=oe+Math.imul(Ft,Ur)|0,re=re+Math.imul(Ze,Sr)|0,B=B+Math.imul(Ze,Lr)|0,B=B+Math.imul(lt,Sr)|0,oe=oe+Math.imul(lt,Lr)|0;var Bn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,re=Math.imul(Yt,Jt),B=Math.imul(Yt,xt),B=B+Math.imul(Ir,Jt)|0,oe=Math.imul(Ir,xt),re=re+Math.imul(ur,xr)|0,B=B+Math.imul(ur,wr)|0,B=B+Math.imul(ar,xr)|0,oe=oe+Math.imul(ar,wr)|0,re=re+Math.imul(Mr,Cr)|0,B=B+Math.imul(Mr,Zr)|0,B=B+Math.imul(gr,Cr)|0,oe=oe+Math.imul(gr,Zr)|0,re=re+Math.imul(Ar,yr)|0,B=B+Math.imul(Ar,Tr)|0,B=B+Math.imul(qr,yr)|0,oe=oe+Math.imul(qr,Tr)|0,re=re+Math.imul(Xt,Jr)|0,B=B+Math.imul(Xt,rn)|0,B=B+Math.imul(nr,Jr)|0,oe=oe+Math.imul(nr,rn)|0,re=re+Math.imul(or,ir)|0,B=B+Math.imul(or,Er)|0,B=B+Math.imul(sr,ir)|0,oe=oe+Math.imul(sr,Er)|0,re=re+Math.imul(Ut,Rr)|0,B=B+Math.imul(Ut,Ur)|0,B=B+Math.imul(vr,Rr)|0,oe=oe+Math.imul(vr,Ur)|0,re=re+Math.imul(Mt,Sr)|0,B=B+Math.imul(Mt,Lr)|0,B=B+Math.imul(Ft,Sr)|0,oe=oe+Math.imul(Ft,Lr)|0,re=re+Math.imul(Ze,tn)|0,B=B+Math.imul(Ze,hn)|0,B=B+Math.imul(lt,tn)|0,oe=oe+Math.imul(lt,hn)|0;var Dn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,re=Math.imul(nt,Jt),B=Math.imul(nt,xt),B=B+Math.imul(_t,Jt)|0,oe=Math.imul(_t,xt),re=re+Math.imul(Yt,xr)|0,B=B+Math.imul(Yt,wr)|0,B=B+Math.imul(Ir,xr)|0,oe=oe+Math.imul(Ir,wr)|0,re=re+Math.imul(ur,Cr)|0,B=B+Math.imul(ur,Zr)|0,B=B+Math.imul(ar,Cr)|0,oe=oe+Math.imul(ar,Zr)|0,re=re+Math.imul(Mr,yr)|0,B=B+Math.imul(Mr,Tr)|0,B=B+Math.imul(gr,yr)|0,oe=oe+Math.imul(gr,Tr)|0,re=re+Math.imul(Ar,Jr)|0,B=B+Math.imul(Ar,rn)|0,B=B+Math.imul(qr,Jr)|0,oe=oe+Math.imul(qr,rn)|0,re=re+Math.imul(Xt,ir)|0,B=B+Math.imul(Xt,Er)|0,B=B+Math.imul(nr,ir)|0,oe=oe+Math.imul(nr,Er)|0,re=re+Math.imul(or,Rr)|0,B=B+Math.imul(or,Ur)|0,B=B+Math.imul(sr,Rr)|0,oe=oe+Math.imul(sr,Ur)|0,re=re+Math.imul(Ut,Sr)|0,B=B+Math.imul(Ut,Lr)|0,B=B+Math.imul(vr,Sr)|0,oe=oe+Math.imul(vr,Lr)|0,re=re+Math.imul(Mt,tn)|0,B=B+Math.imul(Mt,hn)|0,B=B+Math.imul(Ft,tn)|0,oe=oe+Math.imul(Ft,hn)|0,re=re+Math.imul(Ze,on)|0,B=B+Math.imul(Ze,cn)|0,B=B+Math.imul(lt,on)|0,oe=oe+Math.imul(lt,cn)|0;var Hn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Hn>>>26)|0,Hn&=67108863,re=Math.imul(nt,xr),B=Math.imul(nt,wr),B=B+Math.imul(_t,xr)|0,oe=Math.imul(_t,wr),re=re+Math.imul(Yt,Cr)|0,B=B+Math.imul(Yt,Zr)|0,B=B+Math.imul(Ir,Cr)|0,oe=oe+Math.imul(Ir,Zr)|0,re=re+Math.imul(ur,yr)|0,B=B+Math.imul(ur,Tr)|0,B=B+Math.imul(ar,yr)|0,oe=oe+Math.imul(ar,Tr)|0,re=re+Math.imul(Mr,Jr)|0,B=B+Math.imul(Mr,rn)|0,B=B+Math.imul(gr,Jr)|0,oe=oe+Math.imul(gr,rn)|0,re=re+Math.imul(Ar,ir)|0,B=B+Math.imul(Ar,Er)|0,B=B+Math.imul(qr,ir)|0,oe=oe+Math.imul(qr,Er)|0,re=re+Math.imul(Xt,Rr)|0,B=B+Math.imul(Xt,Ur)|0,B=B+Math.imul(nr,Rr)|0,oe=oe+Math.imul(nr,Ur)|0,re=re+Math.imul(or,Sr)|0,B=B+Math.imul(or,Lr)|0,B=B+Math.imul(sr,Sr)|0,oe=oe+Math.imul(sr,Lr)|0,re=re+Math.imul(Ut,tn)|0,B=B+Math.imul(Ut,hn)|0,B=B+Math.imul(vr,tn)|0,oe=oe+Math.imul(vr,hn)|0,re=re+Math.imul(Mt,on)|0,B=B+Math.imul(Mt,cn)|0,B=B+Math.imul(Ft,on)|0,oe=oe+Math.imul(Ft,cn)|0;var On=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(On>>>26)|0,On&=67108863,re=Math.imul(nt,Cr),B=Math.imul(nt,Zr),B=B+Math.imul(_t,Cr)|0,oe=Math.imul(_t,Zr),re=re+Math.imul(Yt,yr)|0,B=B+Math.imul(Yt,Tr)|0,B=B+Math.imul(Ir,yr)|0,oe=oe+Math.imul(Ir,Tr)|0,re=re+Math.imul(ur,Jr)|0,B=B+Math.imul(ur,rn)|0,B=B+Math.imul(ar,Jr)|0,oe=oe+Math.imul(ar,rn)|0,re=re+Math.imul(Mr,ir)|0,B=B+Math.imul(Mr,Er)|0,B=B+Math.imul(gr,ir)|0,oe=oe+Math.imul(gr,Er)|0,re=re+Math.imul(Ar,Rr)|0,B=B+Math.imul(Ar,Ur)|0,B=B+Math.imul(qr,Rr)|0,oe=oe+Math.imul(qr,Ur)|0,re=re+Math.imul(Xt,Sr)|0,B=B+Math.imul(Xt,Lr)|0,B=B+Math.imul(nr,Sr)|0,oe=oe+Math.imul(nr,Lr)|0,re=re+Math.imul(or,tn)|0,B=B+Math.imul(or,hn)|0,B=B+Math.imul(sr,tn)|0,oe=oe+Math.imul(sr,hn)|0,re=re+Math.imul(Ut,on)|0,B=B+Math.imul(Ut,cn)|0,B=B+Math.imul(vr,on)|0,oe=oe+Math.imul(vr,cn)|0;var Rn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,re=Math.imul(nt,yr),B=Math.imul(nt,Tr),B=B+Math.imul(_t,yr)|0,oe=Math.imul(_t,Tr),re=re+Math.imul(Yt,Jr)|0,B=B+Math.imul(Yt,rn)|0,B=B+Math.imul(Ir,Jr)|0,oe=oe+Math.imul(Ir,rn)|0,re=re+Math.imul(ur,ir)|0,B=B+Math.imul(ur,Er)|0,B=B+Math.imul(ar,ir)|0,oe=oe+Math.imul(ar,Er)|0,re=re+Math.imul(Mr,Rr)|0,B=B+Math.imul(Mr,Ur)|0,B=B+Math.imul(gr,Rr)|0,oe=oe+Math.imul(gr,Ur)|0,re=re+Math.imul(Ar,Sr)|0,B=B+Math.imul(Ar,Lr)|0,B=B+Math.imul(qr,Sr)|0,oe=oe+Math.imul(qr,Lr)|0,re=re+Math.imul(Xt,tn)|0,B=B+Math.imul(Xt,hn)|0,B=B+Math.imul(nr,tn)|0,oe=oe+Math.imul(nr,hn)|0,re=re+Math.imul(or,on)|0,B=B+Math.imul(or,cn)|0,B=B+Math.imul(sr,on)|0,oe=oe+Math.imul(sr,cn)|0;var qn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(qn>>>26)|0,qn&=67108863,re=Math.imul(nt,Jr),B=Math.imul(nt,rn),B=B+Math.imul(_t,Jr)|0,oe=Math.imul(_t,rn),re=re+Math.imul(Yt,ir)|0,B=B+Math.imul(Yt,Er)|0,B=B+Math.imul(Ir,ir)|0,oe=oe+Math.imul(Ir,Er)|0,re=re+Math.imul(ur,Rr)|0,B=B+Math.imul(ur,Ur)|0,B=B+Math.imul(ar,Rr)|0,oe=oe+Math.imul(ar,Ur)|0,re=re+Math.imul(Mr,Sr)|0,B=B+Math.imul(Mr,Lr)|0,B=B+Math.imul(gr,Sr)|0,oe=oe+Math.imul(gr,Lr)|0,re=re+Math.imul(Ar,tn)|0,B=B+Math.imul(Ar,hn)|0,B=B+Math.imul(qr,tn)|0,oe=oe+Math.imul(qr,hn)|0,re=re+Math.imul(Xt,on)|0,B=B+Math.imul(Xt,cn)|0,B=B+Math.imul(nr,on)|0,oe=oe+Math.imul(nr,cn)|0;var In=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(In>>>26)|0,In&=67108863,re=Math.imul(nt,ir),B=Math.imul(nt,Er),B=B+Math.imul(_t,ir)|0,oe=Math.imul(_t,Er),re=re+Math.imul(Yt,Rr)|0,B=B+Math.imul(Yt,Ur)|0,B=B+Math.imul(Ir,Rr)|0,oe=oe+Math.imul(Ir,Ur)|0,re=re+Math.imul(ur,Sr)|0,B=B+Math.imul(ur,Lr)|0,B=B+Math.imul(ar,Sr)|0,oe=oe+Math.imul(ar,Lr)|0,re=re+Math.imul(Mr,tn)|0,B=B+Math.imul(Mr,hn)|0,B=B+Math.imul(gr,tn)|0,oe=oe+Math.imul(gr,hn)|0,re=re+Math.imul(Ar,on)|0,B=B+Math.imul(Ar,cn)|0,B=B+Math.imul(qr,on)|0,oe=oe+Math.imul(qr,cn)|0;var Pn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Pn>>>26)|0,Pn&=67108863,re=Math.imul(nt,Rr),B=Math.imul(nt,Ur),B=B+Math.imul(_t,Rr)|0,oe=Math.imul(_t,Ur),re=re+Math.imul(Yt,Sr)|0,B=B+Math.imul(Yt,Lr)|0,B=B+Math.imul(Ir,Sr)|0,oe=oe+Math.imul(Ir,Lr)|0,re=re+Math.imul(ur,tn)|0,B=B+Math.imul(ur,hn)|0,B=B+Math.imul(ar,tn)|0,oe=oe+Math.imul(ar,hn)|0,re=re+Math.imul(Mr,on)|0,B=B+Math.imul(Mr,cn)|0,B=B+Math.imul(gr,on)|0,oe=oe+Math.imul(gr,cn)|0;var Cn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Cn>>>26)|0,Cn&=67108863,re=Math.imul(nt,Sr),B=Math.imul(nt,Lr),B=B+Math.imul(_t,Sr)|0,oe=Math.imul(_t,Lr),re=re+Math.imul(Yt,tn)|0,B=B+Math.imul(Yt,hn)|0,B=B+Math.imul(Ir,tn)|0,oe=oe+Math.imul(Ir,hn)|0,re=re+Math.imul(ur,on)|0,B=B+Math.imul(ur,cn)|0,B=B+Math.imul(ar,on)|0,oe=oe+Math.imul(ar,cn)|0;var Fn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,re=Math.imul(nt,tn),B=Math.imul(nt,hn),B=B+Math.imul(_t,tn)|0,oe=Math.imul(_t,hn),re=re+Math.imul(Yt,on)|0,B=B+Math.imul(Yt,cn)|0,B=B+Math.imul(Ir,on)|0,oe=oe+Math.imul(Ir,cn)|0;var Ln=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,re=Math.imul(nt,on),B=Math.imul(nt,cn),B=B+Math.imul(_t,on)|0,oe=Math.imul(_t,cn);var Un=(ve+re|0)+((B&8191)<<13)|0;return ve=(oe+(B>>>13)|0)+(Un>>>26)|0,Un&=67108863,$e[0]=vn,$e[1]=_n,$e[2]=Mn,$e[3]=xn,$e[4]=Nn,$e[5]=zn,$e[6]=An,$e[7]=Bn,$e[8]=Dn,$e[9]=Hn,$e[10]=On,$e[11]=Rn,$e[12]=qn,$e[13]=In,$e[14]=Pn,$e[15]=Cn,$e[16]=Fn,$e[17]=Ln,$e[18]=Un,ve!==0&&($e[19]=ve,k.length++),k};Math.imul||(Ce=ne);function Le(se,m,A){A.negative=m.negative^se.negative,A.length=se.length+m.length;for(var k=0,Y=0,Q=0;Q<A.length-1;Q++){var $e=Y;Y=0;for(var ve=k&67108863,re=Math.min(Q,m.length-1),B=Math.max(0,Q-se.length+1);B<=re;B++){var oe=Q-B,Ue=se.words[oe]|0,Ze=m.words[B]|0,lt=Ue*Ze,St=lt&67108863;$e=$e+(lt/67108864|0)|0,St=St+ve|0,ve=St&67108863,$e=$e+(St>>>26)|0,Y+=$e>>>26,$e&=67108863}A.words[Q]=ve,k=$e,$e=Y}return k!==0?A.words[Q]=k:A.length--,A.strip()}function Ge(se,m,A){var k=new ze;return k.mulp(se,m,A)}c.prototype.mulTo=function(m,A){var k,Y=this.length+m.length;return this.length===10&&m.length===10?k=Ce(this,m,A):Y<63?k=ne(this,m,A):Y<1024?k=Le(this,m,A):k=Ge(this,m,A),k};function ze(se,m){this.x=se,this.y=m}ze.prototype.makeRBT=function(m){for(var A=new Array(m),k=c.prototype._countBits(m)-1,Y=0;Y<m;Y++)A[Y]=this.revBin(Y,k,m);return A},ze.prototype.revBin=function(m,A,k){if(m===0||m===k-1)return m;for(var Y=0,Q=0;Q<A;Q++)Y|=(m&1)<<A-Q-1,m>>=1;return Y},ze.prototype.permute=function(m,A,k,Y,Q,$e){for(var ve=0;ve<$e;ve++)Y[ve]=A[m[ve]],Q[ve]=k[m[ve]]},ze.prototype.transform=function(m,A,k,Y,Q,$e){this.permute($e,m,A,k,Y,Q);for(var ve=1;ve<Q;ve<<=1)for(var re=ve<<1,B=Math.cos(2*Math.PI/re),oe=Math.sin(2*Math.PI/re),Ue=0;Ue<Q;Ue+=re)for(var Ze=B,lt=oe,St=0;St<ve;St++){var Mt=k[Ue+St],Ft=Y[Ue+St],Zt=k[Ue+St+ve],Ut=Y[Ue+St+ve],vr=Ze*Zt-lt*Ut;Ut=Ze*Ut+lt*Zt,Zt=vr,k[Ue+St]=Mt+Zt,Y[Ue+St]=Ft+Ut,k[Ue+St+ve]=Mt-Zt,Y[Ue+St+ve]=Ft-Ut,St!==re&&(vr=B*Ze-oe*lt,lt=B*lt+oe*Ze,Ze=vr)}},ze.prototype.guessLen13b=function(m,A){var k=Math.max(A,m)|1,Y=k&1,Q=0;for(k=k/2|0;k;k=k>>>1)Q++;return 1<<Q+1+Y},ze.prototype.conjugate=function(m,A,k){if(!(k<=1))for(var Y=0;Y<k/2;Y++){var Q=m[Y];m[Y]=m[k-Y-1],m[k-Y-1]=Q,Q=A[Y],A[Y]=-A[k-Y-1],A[k-Y-1]=-Q}},ze.prototype.normalize13b=function(m,A){for(var k=0,Y=0;Y<A/2;Y++){var Q=Math.round(m[2*Y+1]/A)*8192+Math.round(m[2*Y]/A)+k;m[Y]=Q&67108863,Q<67108864?k=0:k=Q/67108864|0}return m},ze.prototype.convert13b=function(m,A,k,Y){for(var Q=0,$e=0;$e<A;$e++)Q=Q+(m[$e]|0),k[2*$e]=Q&8191,Q=Q>>>13,k[2*$e+1]=Q&8191,Q=Q>>>13;for($e=2*A;$e<Y;++$e)k[$e]=0;o(Q===0),o((Q&-8192)===0)},ze.prototype.stub=function(m){for(var A=new Array(m),k=0;k<m;k++)A[k]=0;return A},ze.prototype.mulp=function(m,A,k){var Y=2*this.guessLen13b(m.length,A.length),Q=this.makeRBT(Y),$e=this.stub(Y),ve=new Array(Y),re=new Array(Y),B=new Array(Y),oe=new Array(Y),Ue=new Array(Y),Ze=new Array(Y),lt=k.words;lt.length=Y,this.convert13b(m.words,m.length,ve,Y),this.convert13b(A.words,A.length,oe,Y),this.transform(ve,$e,re,B,Y,Q),this.transform(oe,$e,Ue,Ze,Y,Q);for(var St=0;St<Y;St++){var Mt=re[St]*Ue[St]-B[St]*Ze[St];B[St]=re[St]*Ze[St]+B[St]*Ue[St],re[St]=Mt}return this.conjugate(re,B,Y),this.transform(re,B,lt,$e,Y,Q),this.conjugate(lt,$e,Y),this.normalize13b(lt,Y),k.negative=m.negative^A.negative,k.length=m.length+A.length,k.strip()},c.prototype.mul=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),this.mulTo(m,A)},c.prototype.mulf=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),Ge(this,m,A)},c.prototype.imul=function(m){return this.clone().mulTo(m,this)},c.prototype.imuln=function(m){o(typeof m=="number"),o(m<67108864);for(var A=0,k=0;k<this.length;k++){var Y=(this.words[k]|0)*m,Q=(Y&67108863)+(A&67108863);A>>=26,A+=Y/67108864|0,A+=Q>>>26,this.words[k]=Q&67108863}return A!==0&&(this.words[k]=A,this.length++),this.length=m===0?1:this.length,this},c.prototype.muln=function(m){return this.clone().imuln(m)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(m){var A=te(m);if(A.length===0)return new c(1);for(var k=this,Y=0;Y<A.length&&A[Y]===0;Y++,k=k.sqr());if(++Y<A.length)for(var Q=k.sqr();Y<A.length;Y++,Q=Q.sqr())A[Y]!==0&&(k=k.mul(Q));return k},c.prototype.iushln=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=67108863>>>26-A<<26-A,Q;if(A!==0){var $e=0;for(Q=0;Q<this.length;Q++){var ve=this.words[Q]&Y,re=(this.words[Q]|0)-ve<<A;this.words[Q]=re|$e,$e=ve>>>26-A}$e&&(this.words[Q]=$e,this.length++)}if(k!==0){for(Q=this.length-1;Q>=0;Q--)this.words[Q+k]=this.words[Q];for(Q=0;Q<k;Q++)this.words[Q]=0;this.length+=k}return this.strip()},c.prototype.ishln=function(m){return o(this.negative===0),this.iushln(m)},c.prototype.iushrn=function(m,A,k){o(typeof m=="number"&&m>=0);var Y;A?Y=(A-A%26)/26:Y=0;var Q=m%26,$e=Math.min((m-Q)/26,this.length),ve=67108863^67108863>>>Q<<Q,re=k;if(Y-=$e,Y=Math.max(0,Y),re){for(var B=0;B<$e;B++)re.words[B]=this.words[B];re.length=$e}if($e!==0)if(this.length>$e)for(this.length-=$e,B=0;B<this.length;B++)this.words[B]=this.words[B+$e];else this.words[0]=0,this.length=1;var oe=0;for(B=this.length-1;B>=0&&(oe!==0||B>=Y);B--){var Ue=this.words[B]|0;this.words[B]=oe<<26-Q|Ue>>>Q,oe=Ue&ve}return re&&oe!==0&&(re.words[re.length++]=oe),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},c.prototype.ishrn=function(m,A,k){return o(this.negative===0),this.iushrn(m,A,k)},c.prototype.shln=function(m){return this.clone().ishln(m)},c.prototype.ushln=function(m){return this.clone().iushln(m)},c.prototype.shrn=function(m){return this.clone().ishrn(m)},c.prototype.ushrn=function(m){return this.clone().iushrn(m)},c.prototype.testn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return!1;var Q=this.words[k];return!!(Q&Y)},c.prototype.imaskn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26;if(o(this.negative===0,"imaskn works only with positive numbers"),this.length<=k)return this;if(A!==0&&k++,this.length=Math.min(k,this.length),A!==0){var Y=67108863^67108863>>>A<<A;this.words[this.length-1]&=Y}return this.strip()},c.prototype.maskn=function(m){return this.clone().imaskn(m)},c.prototype.iaddn=function(m){return o(typeof m=="number"),o(m<67108864),m<0?this.isubn(-m):this.negative!==0?this.length===1&&(this.words[0]|0)<m?(this.words[0]=m-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(m),this.negative=1,this):this._iaddn(m)},c.prototype._iaddn=function(m){this.words[0]+=m;for(var A=0;A<this.length&&this.words[A]>=67108864;A++)this.words[A]-=67108864,A===this.length-1?this.words[A+1]=1:this.words[A+1]++;return this.length=Math.max(this.length,A+1),this},c.prototype.isubn=function(m){if(o(typeof m=="number"),o(m<67108864),m<0)return this.iaddn(-m);if(this.negative!==0)return this.negative=0,this.iaddn(m),this.negative=1,this;if(this.words[0]-=m,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var A=0;A<this.length&&this.words[A]<0;A++)this.words[A]+=67108864,this.words[A+1]-=1;return this.strip()},c.prototype.addn=function(m){return this.clone().iaddn(m)},c.prototype.subn=function(m){return this.clone().isubn(m)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(m,A,k){var Y=m.length+k,Q;this._expand(Y);var $e,ve=0;for(Q=0;Q<m.length;Q++){$e=(this.words[Q+k]|0)+ve;var re=(m.words[Q]|0)*A;$e-=re&67108863,ve=($e>>26)-(re/67108864|0),this.words[Q+k]=$e&67108863}for(;Q<this.length-k;Q++)$e=(this.words[Q+k]|0)+ve,ve=$e>>26,this.words[Q+k]=$e&67108863;if(ve===0)return this.strip();for(o(ve===-1),ve=0,Q=0;Q<this.length;Q++)$e=-(this.words[Q]|0)+ve,ve=$e>>26,this.words[Q]=$e&67108863;return this.negative=1,this.strip()},c.prototype._wordDiv=function(m,A){var k=this.length-m.length,Y=this.clone(),Q=m,$e=Q.words[Q.length-1]|0,ve=this._countBits($e);k=26-ve,k!==0&&(Q=Q.ushln(k),Y.iushln(k),$e=Q.words[Q.length-1]|0);var re=Y.length-Q.length,B;if(A!=="mod"){B=new c(null),B.length=re+1,B.words=new Array(B.length);for(var oe=0;oe<B.length;oe++)B.words[oe]=0}var Ue=Y.clone()._ishlnsubmul(Q,1,re);Ue.negative===0&&(Y=Ue,B&&(B.words[re]=1));for(var Ze=re-1;Ze>=0;Ze--){var lt=(Y.words[Q.length+Ze]|0)*67108864+(Y.words[Q.length+Ze-1]|0);for(lt=Math.min(lt/$e|0,67108863),Y._ishlnsubmul(Q,lt,Ze);Y.negative!==0;)lt--,Y.negative=0,Y._ishlnsubmul(Q,1,Ze),!Y.isZero()&&(Y.negative^=1);B&&(B.words[Ze]=lt)}return B&&B.strip(),Y.strip(),A!=="div"&&k!==0&&Y.iushrn(k),{div:B||null,mod:Y}},c.prototype.divmod=function(m,A,k){if(o(!m.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var Y,Q,$e;return this.negative!==0&&m.negative===0?($e=this.neg().divmod(m,A),A!=="mod"&&(Y=$e.div.neg()),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.iadd(m)),{div:Y,mod:Q}):this.negative===0&&m.negative!==0?($e=this.divmod(m.neg(),A),A!=="mod"&&(Y=$e.div.neg()),{div:Y,mod:$e.mod}):(this.negative&m.negative)!==0?($e=this.neg().divmod(m.neg(),A),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.isub(m)),{div:$e.div,mod:Q}):m.length>this.length||this.cmp(m)<0?{div:new c(0),mod:this}:m.length===1?A==="div"?{div:this.divn(m.words[0]),mod:null}:A==="mod"?{div:null,mod:new c(this.modn(m.words[0]))}:{div:this.divn(m.words[0]),mod:new c(this.modn(m.words[0]))}:this._wordDiv(m,A)},c.prototype.div=function(m){return this.divmod(m,"div",!1).div},c.prototype.mod=function(m){return this.divmod(m,"mod",!1).mod},c.prototype.umod=function(m){return this.divmod(m,"mod",!0).mod},c.prototype.divRound=function(m){var A=this.divmod(m);if(A.mod.isZero())return A.div;var k=A.div.negative!==0?A.mod.isub(m):A.mod,Y=m.ushrn(1),Q=m.andln(1),$e=k.cmp(Y);return $e<0||Q===1&&$e===0?A.div:A.div.negative!==0?A.div.isubn(1):A.div.iaddn(1)},c.prototype.modn=function(m){o(m<=67108863);for(var A=67108864%m,k=0,Y=this.length-1;Y>=0;Y--)k=(A*k+(this.words[Y]|0))%m;return k},c.prototype.idivn=function(m){o(m<=67108863);for(var A=0,k=this.length-1;k>=0;k--){var Y=(this.words[k]|0)+A*67108864;this.words[k]=Y/m|0,A=Y%m}return this.strip()},c.prototype.divn=function(m){return this.clone().idivn(m)},c.prototype.egcd=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=new c(0),ve=new c(1),re=0;A.isEven()&&k.isEven();)A.iushrn(1),k.iushrn(1),++re;for(var B=k.clone(),oe=A.clone();!A.isZero();){for(var Ue=0,Ze=1;(A.words[0]&Ze)===0&&Ue<26;++Ue,Ze<<=1);if(Ue>0)for(A.iushrn(Ue);Ue-- >0;)(Y.isOdd()||Q.isOdd())&&(Y.iadd(B),Q.isub(oe)),Y.iushrn(1),Q.iushrn(1);for(var lt=0,St=1;(k.words[0]&St)===0&&lt<26;++lt,St<<=1);if(lt>0)for(k.iushrn(lt);lt-- >0;)($e.isOdd()||ve.isOdd())&&($e.iadd(B),ve.isub(oe)),$e.iushrn(1),ve.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub($e),Q.isub(ve)):(k.isub(A),$e.isub(Y),ve.isub(Q))}return{a:$e,b:ve,gcd:k.iushln(re)}},c.prototype._invmp=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=k.clone();A.cmpn(1)>0&&k.cmpn(1)>0;){for(var ve=0,re=1;(A.words[0]&re)===0&&ve<26;++ve,re<<=1);if(ve>0)for(A.iushrn(ve);ve-- >0;)Y.isOdd()&&Y.iadd($e),Y.iushrn(1);for(var B=0,oe=1;(k.words[0]&oe)===0&&B<26;++B,oe<<=1);if(B>0)for(k.iushrn(B);B-- >0;)Q.isOdd()&&Q.iadd($e),Q.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub(Q)):(k.isub(A),Q.isub(Y))}var Ue;return A.cmpn(1)===0?Ue=Y:Ue=Q,Ue.cmpn(0)<0&&Ue.iadd(m),Ue},c.prototype.gcd=function(m){if(this.isZero())return m.abs();if(m.isZero())return this.abs();var A=this.clone(),k=m.clone();A.negative=0,k.negative=0;for(var Y=0;A.isEven()&&k.isEven();Y++)A.iushrn(1),k.iushrn(1);do{for(;A.isEven();)A.iushrn(1);for(;k.isEven();)k.iushrn(1);var Q=A.cmp(k);if(Q<0){var $e=A;A=k,k=$e}else if(Q===0||k.cmpn(1)===0)break;A.isub(k)}while(!0);return k.iushln(Y)},c.prototype.invm=function(m){return this.egcd(m).a.umod(m)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(m){return this.words[0]&m},c.prototype.bincn=function(m){o(typeof m=="number");var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return this._expand(k+1),this.words[k]|=Y,this;for(var Q=Y,$e=k;Q!==0&&$e<this.length;$e++){var ve=this.words[$e]|0;ve+=Q,Q=ve>>>26,ve&=67108863,this.words[$e]=ve}return Q!==0&&(this.words[$e]=Q,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(m){var A=m<0;if(this.negative!==0&&!A)return-1;if(this.negative===0&&A)return 1;this.strip();var k;if(this.length>1)k=1;else{A&&(m=-m),o(m<=67108863,"Number is too big");var Y=this.words[0]|0;k=Y===m?0:Y<m?-1:1}return this.negative!==0?-k|0:k},c.prototype.cmp=function(m){if(this.negative!==0&&m.negative===0)return-1;if(this.negative===0&&m.negative!==0)return 1;var A=this.ucmp(m);return this.negative!==0?-A|0:A},c.prototype.ucmp=function(m){if(this.length>m.length)return 1;if(this.length<m.length)return-1;for(var A=0,k=this.length-1;k>=0;k--){var Y=this.words[k]|0,Q=m.words[k]|0;if(Y!==Q){Y<Q?A=-1:Y>Q&&(A=1);break}}return A},c.prototype.gtn=function(m){return this.cmpn(m)===1},c.prototype.gt=function(m){return this.cmp(m)===1},c.prototype.gten=function(m){return this.cmpn(m)>=0},c.prototype.gte=function(m){return this.cmp(m)>=0},c.prototype.ltn=function(m){return this.cmpn(m)===-1},c.prototype.lt=function(m){return this.cmp(m)===-1},c.prototype.lten=function(m){return this.cmpn(m)<=0},c.prototype.lte=function(m){return this.cmp(m)<=0},c.prototype.eqn=function(m){return this.cmpn(m)===0},c.prototype.eq=function(m){return this.cmp(m)===0},c.red=function(m){return new ht(m)},c.prototype.toRed=function(m){return o(!this.red,"Already a number in reduction context"),o(this.negative===0,"red works only with positives"),m.convertTo(this)._forceRed(m)},c.prototype.fromRed=function(){return o(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(m){return this.red=m,this},c.prototype.forceRed=function(m){return o(!this.red,"Already a number in reduction context"),this._forceRed(m)},c.prototype.redAdd=function(m){return o(this.red,"redAdd works only with red numbers"),this.red.add(this,m)},c.prototype.redIAdd=function(m){return o(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,m)},c.prototype.redSub=function(m){return o(this.red,"redSub works only with red numbers"),this.red.sub(this,m)},c.prototype.redISub=function(m){return o(this.red,"redISub works only with red numbers"),this.red.isub(this,m)},c.prototype.redShl=function(m){return o(this.red,"redShl works only with red numbers"),this.red.shl(this,m)},c.prototype.redMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.mul(this,m)},c.prototype.redIMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.imul(this,m)},c.prototype.redSqr=function(){return o(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return o(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return o(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return o(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return o(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(m){return o(this.red&&!m.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,m)};var Xe={k256:null,p224:null,p192:null,p25519:null};function He(se,m){this.name=se,this.p=new c(m,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}He.prototype._tmp=function(){var m=new c(null);return m.words=new Array(Math.ceil(this.n/13)),m},He.prototype.ireduce=function(m){var A=m,k;do this.split(A,this.tmp),A=this.imulK(A),A=A.iadd(this.tmp),k=A.bitLength();while(k>this.n);var Y=k<this.n?-1:A.ucmp(this.p);return Y===0?(A.words[0]=0,A.length=1):Y>0?A.isub(this.p):A.strip!==void 0?A.strip():A._strip(),A},He.prototype.split=function(m,A){m.iushrn(this.n,0,A)},He.prototype.imulK=function(m){return m.imul(this.k)};function Ve(){He.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(Ve,He),Ve.prototype.split=function(m,A){for(var k=4194303,Y=Math.min(m.length,9),Q=0;Q<Y;Q++)A.words[Q]=m.words[Q];if(A.length=Y,m.length<=9){m.words[0]=0,m.length=1;return}var $e=m.words[9];for(A.words[A.length++]=$e&k,Q=10;Q<m.length;Q++){var ve=m.words[Q]|0;m.words[Q-10]=(ve&k)<<4|$e>>>22,$e=ve}$e>>>=22,m.words[Q-10]=$e,$e===0&&m.length>10?m.length-=10:m.length-=9},Ve.prototype.imulK=function(m){m.words[m.length]=0,m.words[m.length+1]=0,m.length+=2;for(var A=0,k=0;k<m.length;k++){var Y=m.words[k]|0;A+=Y*977,m.words[k]=A&67108863,A=Y*64+(A/67108864|0)}return m.words[m.length-1]===0&&(m.length--,m.words[m.length-1]===0&&m.length--),m};function We(){He.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(We,He);function rt(){He.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(rt,He);function st(){He.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(st,He),st.prototype.imulK=function(m){for(var A=0,k=0;k<m.length;k++){var Y=(m.words[k]|0)*19+A,Q=Y&67108863;Y>>>=26,m.words[k]=Q,A=Y}return A!==0&&(m.words[m.length++]=A),m},c._prime=function(m){if(Xe[m])return Xe[m];var A;if(m==="k256")A=new Ve;else if(m==="p224")A=new We;else if(m==="p192")A=new rt;else if(m==="p25519")A=new st;else throw new Error("Unknown prime "+m);return Xe[m]=A,A};function ht(se){if(typeof se=="string"){var m=c._prime(se);this.m=m.p,this.prime=m}else o(se.gtn(1),"modulus must be greater than 1"),this.m=se,this.prime=null}ht.prototype._verify1=function(m){o(m.negative===0,"red works only with positives"),o(m.red,"red works only with red numbers")},ht.prototype._verify2=function(m,A){o((m.negative|A.negative)===0,"red works only with positives"),o(m.red&&m.red===A.red,"red works only with red numbers")},ht.prototype.imod=function(m){return this.prime?this.prime.ireduce(m)._forceRed(this):m.umod(this.m)._forceRed(this)},ht.prototype.neg=function(m){return m.isZero()?m.clone():this.m.sub(m)._forceRed(this)},ht.prototype.add=function(m,A){this._verify2(m,A);var k=m.add(A);return k.cmp(this.m)>=0&&k.isub(this.m),k._forceRed(this)},ht.prototype.iadd=function(m,A){this._verify2(m,A);var k=m.iadd(A);return k.cmp(this.m)>=0&&k.isub(this.m),k},ht.prototype.sub=function(m,A){this._verify2(m,A);var k=m.sub(A);return k.cmpn(0)<0&&k.iadd(this.m),k._forceRed(this)},ht.prototype.isub=function(m,A){this._verify2(m,A);var k=m.isub(A);return k.cmpn(0)<0&&k.iadd(this.m),k},ht.prototype.shl=function(m,A){return this._verify1(m),this.imod(m.ushln(A))},ht.prototype.imul=function(m,A){return this._verify2(m,A),this.imod(m.imul(A))},ht.prototype.mul=function(m,A){return this._verify2(m,A),this.imod(m.mul(A))},ht.prototype.isqr=function(m){return this.imul(m,m.clone())},ht.prototype.sqr=function(m){return this.mul(m,m)},ht.prototype.sqrt=function(m){if(m.isZero())return m.clone();var A=this.m.andln(3);if(o(A%2===1),A===3){var k=this.m.add(new c(1)).iushrn(2);return this.pow(m,k)}for(var Y=this.m.subn(1),Q=0;!Y.isZero()&&Y.andln(1)===0;)Q++,Y.iushrn(1);o(!Y.isZero());var $e=new c(1).toRed(this),ve=$e.redNeg(),re=this.m.subn(1).iushrn(1),B=this.m.bitLength();for(B=new c(2*B*B).toRed(this);this.pow(B,re).cmp(ve)!==0;)B.redIAdd(ve);for(var oe=this.pow(B,Y),Ue=this.pow(m,Y.addn(1).iushrn(1)),Ze=this.pow(m,Y),lt=Q;Ze.cmp($e)!==0;){for(var St=Ze,Mt=0;St.cmp($e)!==0;Mt++)St=St.redSqr();o(Mt<lt);var Ft=this.pow(oe,new c(1).iushln(lt-Mt-1));Ue=Ue.redMul(Ft),oe=Ft.redSqr(),Ze=Ze.redMul(oe),lt=Mt}return Ue},ht.prototype.invm=function(m){var A=m._invmp(this.m);return A.negative!==0?(A.negative=0,this.imod(A).redNeg()):this.imod(A)},ht.prototype.pow=function(m,A){if(A.isZero())return new c(1).toRed(this);if(A.cmpn(1)===0)return m.clone();var k=4,Y=new Array(1<<k);Y[0]=new c(1).toRed(this),Y[1]=m;for(var Q=2;Q<Y.length;Q++)Y[Q]=this.mul(Y[Q-1],m);var $e=Y[0],ve=0,re=0,B=A.bitLength()%26;for(B===0&&(B=26),Q=A.length-1;Q>=0;Q--){for(var oe=A.words[Q],Ue=B-1;Ue>=0;Ue--){var Ze=oe>>Ue&1;if($e!==Y[0]&&($e=this.sqr($e)),Ze===0&&ve===0){re=0;continue}ve<<=1,ve|=Ze,re++,!(re!==k&&(Q!==0||Ue!==0))&&($e=this.mul($e,Y[ve]),re=0,ve=0)}B=26}return $e},ht.prototype.convertTo=function(m){var A=m.umod(this.m);return A===m?A.clone():A},ht.prototype.convertFrom=function(m){var A=m.clone();return A.red=null,A},c.mont=function(m){return new je(m)};function je(se){ht.call(this,se),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(je,ht),je.prototype.convertTo=function(m){return this.imod(m.ushln(this.shift))},je.prototype.convertFrom=function(m){var A=this.imod(m.mul(this.rinv));return A.red=null,A},je.prototype.imul=function(m,A){if(m.isZero()||A.isZero())return m.words[0]=0,m.length=1,m;var k=m.imul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.mul=function(m,A){if(m.isZero()||A.isZero())return new c(0)._forceRed(this);var k=m.mul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.invm=function(m){var A=this.imod(m._invmp(this.m).mul(this.r2));return A._forceRed(this)}})(typeof t>"u"||t,r)}),require_browser=__commonJS2((r,t)=>{var n=require_elliptic(),s=require_bn2();t.exports=function(g){return new a(g)};var o={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};o.p224=o.secp224r1,o.p256=o.secp256r1=o.prime256v1,o.p192=o.secp192r1=o.prime192v1,o.p384=o.secp384r1,o.p521=o.secp521r1;function a(f){this.curveType=o[f],!this.curveType&&(this.curveType={name:f}),this.curve=new n.ec(this.curveType.name),this.keys=void 0}a.prototype.generateKeys=function(f,g){return this.keys=this.curve.genKeyPair(),this.getPublicKey(f,g)},a.prototype.computeSecret=function(f,g,b){g=g||"utf8",!Buffer.isBuffer(f)&&(f=new Buffer(f,g));var _=this.curve.keyFromPublic(f).getPublic(),L=_.mul(this.keys.getPrivate()).getX();return c(L,b,this.curveType.byteLength)},a.prototype.getPublicKey=function(f,g){var b=this.keys.getPublic(g==="compressed",!0);return g==="hybrid"&&(b[b.length-1]%2?b[0]=7:b[0]=6),c(b,f)},a.prototype.getPrivateKey=function(f){return c(this.keys.getPrivate(),f)},a.prototype.setPublicKey=function(f,g){return g=g||"utf8",!Buffer.isBuffer(f)&&(f=new Buffer(f,g)),this.keys._importPublic(f),this},a.prototype.setPrivateKey=function(f,g){g=g||"utf8",!Buffer.isBuffer(f)&&(f=new Buffer(f,g));var b=new s(f);return b=b.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(b),this};function c(f,g,b){Array.isArray(f)||(f=f.toArray());var _=new Buffer(f);if(b&&_.length<b){var L=new Buffer(b-_.length);L.fill(0),_=Buffer.concat([L,_])}return g?_.toString(g):_}}),require_create_ecdh=__commonJS2((r,t)=>{var n=(init_crypto(),__toCommonJS(exports_crypto)).createECDH;t.exports=n||require_browser()}),require_bn3=__commonJS2((r,t)=>{(function(n,s){function o(se,m){if(!se)throw new Error(m||"Assertion failed")}function a(se,m){se.super_=m;var A=function(){};A.prototype=m.prototype,se.prototype=new A,se.prototype.constructor=se}function c(se,m,A){if(c.isBN(se))return se;this.negative=0,this.words=null,this.length=0,this.red=null,se!==null&&((m==="le"||m==="be")&&(A=m,m=10),this._init(se||0,m||10,A||"be"))}typeof n=="object"?n.exports=c:s.BN=c,c.BN=c,c.wordSize=26;var f;try{typeof window<"u"&&typeof window.Buffer<"u"?f=window.Buffer:f=(init_buffer(),__toCommonJS(exports_buffer)).Buffer}catch{}c.isBN=function(m){return m instanceof c?!0:m!==null&&typeof m=="object"&&m.constructor.wordSize===c.wordSize&&Array.isArray(m.words)},c.max=function(m,A){return m.cmp(A)>0?m:A},c.min=function(m,A){return m.cmp(A)<0?m:A},c.prototype._init=function(m,A,k){if(typeof m=="number")return this._initNumber(m,A,k);if(typeof m=="object")return this._initArray(m,A,k);A==="hex"&&(A=16),o(A===(A|0)&&A>=2&&A<=36),m=m.toString().replace(/\s+/g,"");var Y=0;m[0]==="-"&&(Y++,this.negative=1),Y<m.length&&(A===16?this._parseHex(m,Y,k):(this._parseBase(m,A,Y),k==="le"&&this._initArray(this.toArray(),A,k)))},c.prototype._initNumber=function(m,A,k){m<0&&(this.negative=1,m=-m),m<67108864?(this.words=[m&67108863],this.length=1):m<4503599627370496?(this.words=[m&67108863,m/67108864&67108863],this.length=2):(o(m<9007199254740992),this.words=[m&67108863,m/67108864&67108863,1],this.length=3),k==="le"&&this._initArray(this.toArray(),A,k)},c.prototype._initArray=function(m,A,k){if(o(typeof m.length=="number"),m.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(m.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q,$e,ve=0;if(k==="be")for(Y=m.length-1,Q=0;Y>=0;Y-=3)$e=m[Y]|m[Y-1]<<8|m[Y-2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);else if(k==="le")for(Y=0,Q=0;Y<m.length;Y+=3)$e=m[Y]|m[Y+1]<<8|m[Y+2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);return this.strip()};function g(se,m){var A=se.charCodeAt(m);return A>=65&&A<=70?A-55:A>=97&&A<=102?A-87:A-48&15}function b(se,m,A){var k=g(se,A);return A-1>=m&&(k|=g(se,A-1)<<4),k}c.prototype._parseHex=function(m,A,k){this.length=Math.ceil((m.length-A)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q=0,$e=0,ve;if(k==="be")for(Y=m.length-1;Y>=A;Y-=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8;else{var re=m.length-A;for(Y=re%2===0?A+1:A;Y<m.length;Y+=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8}this.strip()};function _(se,m,A,k){for(var Y=0,Q=Math.min(se.length,A),$e=m;$e<Q;$e++){var ve=se.charCodeAt($e)-48;Y*=k,ve>=49?Y+=ve-49+10:ve>=17?Y+=ve-17+10:Y+=ve}return Y}c.prototype._parseBase=function(m,A,k){this.words=[0],this.length=1;for(var Y=0,Q=1;Q<=67108863;Q*=A)Y++;Y--,Q=Q/A|0;for(var $e=m.length-k,ve=$e%Y,re=Math.min($e,$e-ve)+k,B=0,oe=k;oe<re;oe+=Y)B=_(m,oe,oe+Y,A),this.imuln(Q),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B);if(ve!==0){var Ue=1;for(B=_(m,oe,m.length,A),oe=0;oe<ve;oe++)Ue*=A;this.imuln(Ue),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B)}this.strip()},c.prototype.copy=function(m){m.words=new Array(this.length);for(var A=0;A<this.length;A++)m.words[A]=this.words[A];m.length=this.length,m.negative=this.negative,m.red=this.red},c.prototype.clone=function(){var m=new c(null);return this.copy(m),m},c.prototype._expand=function(m){for(;this.length<m;)this.words[this.length++]=0;return this},c.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},c.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var L=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],q=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],X=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(m,A){m=m||10,A=A|0||1;var k;if(m===16||m==="hex"){k="";for(var Y=0,Q=0,$e=0;$e<this.length;$e++){var ve=this.words[$e],re=((ve<<Y|Q)&16777215).toString(16);Q=ve>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,$e--),Q!==0||$e!==this.length-1?k=L[6-re.length]+re+k:k=re+k}for(Q!==0&&(k=Q.toString(16)+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}if(m===(m|0)&&m>=2&&m<=36){var B=q[m],oe=X[m];k="";var Ue=this.clone();for(Ue.negative=0;!Ue.isZero();){var Ze=Ue.modn(oe).toString(m);Ue=Ue.idivn(oe),Ue.isZero()?k=Ze+k:k=L[B-Ze.length]+Ze+k}for(this.isZero()&&(k="0"+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}o(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var m=this.words[0];return this.length===2?m+=this.words[1]*67108864:this.length===3&&this.words[2]===1?m+=4503599627370496+this.words[1]*67108864:this.length>2&&o(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-m:m},c.prototype.toJSON=function(){return this.toString(16)},c.prototype.toBuffer=function(m,A){return o(typeof f<"u"),this.toArrayLike(f,m,A)},c.prototype.toArray=function(m,A){return this.toArrayLike(Array,m,A)},c.prototype.toArrayLike=function(m,A,k){var Y=this.byteLength(),Q=k||Math.max(1,Y);o(Y<=Q,"byte array longer than desired length"),o(Q>0,"Requested array length <= 0"),this.strip();var $e=A==="le",ve=new m(Q),re,B,oe=this.clone();if($e){for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[B]=re;for(;B<Q;B++)ve[B]=0}else{for(B=0;B<Q-Y;B++)ve[B]=0;for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[Q-B-1]=re}return ve},Math.clz32?c.prototype._countBits=function(m){return 32-Math.clz32(m)}:c.prototype._countBits=function(m){var A=m,k=0;return A>=4096&&(k+=13,A>>>=13),A>=64&&(k+=7,A>>>=7),A>=8&&(k+=4,A>>>=4),A>=2&&(k+=2,A>>>=2),k+A},c.prototype._zeroBits=function(m){if(m===0)return 26;var A=m,k=0;return(A&8191)===0&&(k+=13,A>>>=13),(A&127)===0&&(k+=7,A>>>=7),(A&15)===0&&(k+=4,A>>>=4),(A&3)===0&&(k+=2,A>>>=2),(A&1)===0&&k++,k},c.prototype.bitLength=function(){var m=this.words[this.length-1],A=this._countBits(m);return(this.length-1)*26+A};function te(se){for(var m=new Array(se.bitLength()),A=0;A<m.length;A++){var k=A/26|0,Y=A%26;m[A]=(se.words[k]&1<<Y)>>>Y}return m}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var m=0,A=0;A<this.length;A++){var k=this._zeroBits(this.words[A]);if(m+=k,k!==26)break}return m},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(m){return this.negative!==0?this.abs().inotn(m).iaddn(1):this.clone()},c.prototype.fromTwos=function(m){return this.testn(m-1)?this.notn(m).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(m){for(;this.length<m.length;)this.words[this.length++]=0;for(var A=0;A<m.length;A++)this.words[A]=this.words[A]|m.words[A];return this.strip()},c.prototype.ior=function(m){return o((this.negative|m.negative)===0),this.iuor(m)},c.prototype.or=function(m){return this.length>m.length?this.clone().ior(m):m.clone().ior(this)},c.prototype.uor=function(m){return this.length>m.length?this.clone().iuor(m):m.clone().iuor(this)},c.prototype.iuand=function(m){var A;this.length>m.length?A=m:A=this;for(var k=0;k<A.length;k++)this.words[k]=this.words[k]&m.words[k];return this.length=A.length,this.strip()},c.prototype.iand=function(m){return o((this.negative|m.negative)===0),this.iuand(m)},c.prototype.and=function(m){return this.length>m.length?this.clone().iand(m):m.clone().iand(this)},c.prototype.uand=function(m){return this.length>m.length?this.clone().iuand(m):m.clone().iuand(this)},c.prototype.iuxor=function(m){var A,k;this.length>m.length?(A=this,k=m):(A=m,k=this);for(var Y=0;Y<k.length;Y++)this.words[Y]=A.words[Y]^k.words[Y];if(this!==A)for(;Y<A.length;Y++)this.words[Y]=A.words[Y];return this.length=A.length,this.strip()},c.prototype.ixor=function(m){return o((this.negative|m.negative)===0),this.iuxor(m)},c.prototype.xor=function(m){return this.length>m.length?this.clone().ixor(m):m.clone().ixor(this)},c.prototype.uxor=function(m){return this.length>m.length?this.clone().iuxor(m):m.clone().iuxor(this)},c.prototype.inotn=function(m){o(typeof m=="number"&&m>=0);var A=Math.ceil(m/26)|0,k=m%26;this._expand(A),k>0&&A--;for(var Y=0;Y<A;Y++)this.words[Y]=~this.words[Y]&67108863;return k>0&&(this.words[Y]=~this.words[Y]&67108863>>26-k),this.strip()},c.prototype.notn=function(m){return this.clone().inotn(m)},c.prototype.setn=function(m,A){o(typeof m=="number"&&m>=0);var k=m/26|0,Y=m%26;return this._expand(k+1),A?this.words[k]=this.words[k]|1<<Y:this.words[k]=this.words[k]&~(1<<Y),this.strip()},c.prototype.iadd=function(m){var A;if(this.negative!==0&&m.negative===0)return this.negative=0,A=this.isub(m),this.negative^=1,this._normSign();if(this.negative===0&&m.negative!==0)return m.negative=0,A=this.isub(m),m.negative=1,A._normSign();var k,Y;this.length>m.length?(k=this,Y=m):(k=m,Y=this);for(var Q=0,$e=0;$e<Y.length;$e++)A=(k.words[$e]|0)+(Y.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;for(;Q!==0&&$e<k.length;$e++)A=(k.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;if(this.length=k.length,Q!==0)this.words[this.length]=Q,this.length++;else if(k!==this)for(;$e<k.length;$e++)this.words[$e]=k.words[$e];return this},c.prototype.add=function(m){var A;return m.negative!==0&&this.negative===0?(m.negative=0,A=this.sub(m),m.negative^=1,A):m.negative===0&&this.negative!==0?(this.negative=0,A=m.sub(this),this.negative=1,A):this.length>m.length?this.clone().iadd(m):m.clone().iadd(this)},c.prototype.isub=function(m){if(m.negative!==0){m.negative=0;var A=this.iadd(m);return m.negative=1,A._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(m),this.negative=1,this._normSign();var k=this.cmp(m);if(k===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,Q;k>0?(Y=this,Q=m):(Y=m,Q=this);for(var $e=0,ve=0;ve<Q.length;ve++)A=(Y.words[ve]|0)-(Q.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;for(;$e!==0&&ve<Y.length;ve++)A=(Y.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;if($e===0&&ve<Y.length&&Y!==this)for(;ve<Y.length;ve++)this.words[ve]=Y.words[ve];return this.length=Math.max(this.length,ve),Y!==this&&(this.negative=1),this.strip()},c.prototype.sub=function(m){return this.clone().isub(m)};function ne(se,m,A){A.negative=m.negative^se.negative;var k=se.length+m.length|0;A.length=k,k=k-1|0;var Y=se.words[0]|0,Q=m.words[0]|0,$e=Y*Q,ve=$e&67108863,re=$e/67108864|0;A.words[0]=ve;for(var B=1;B<k;B++){for(var oe=re>>>26,Ue=re&67108863,Ze=Math.min(B,m.length-1),lt=Math.max(0,B-se.length+1);lt<=Ze;lt++){var St=B-lt|0;Y=se.words[St]|0,Q=m.words[lt]|0,$e=Y*Q+Ue,oe+=$e/67108864|0,Ue=$e&67108863}A.words[B]=Ue|0,re=oe|0}return re!==0?A.words[B]=re|0:A.length--,A.strip()}var Ce=function(m,A,k){var Y=m.words,Q=A.words,$e=k.words,ve=0,re,B,oe,Ue=Y[0]|0,Ze=Ue&8191,lt=Ue>>>13,St=Y[1]|0,Mt=St&8191,Ft=St>>>13,Zt=Y[2]|0,Ut=Zt&8191,vr=Zt>>>13,zr=Y[3]|0,or=zr&8191,sr=zr>>>13,er=Y[4]|0,Xt=er&8191,nr=er>>>13,Fr=Y[5]|0,Ar=Fr&8191,qr=Fr>>>13,dn=Y[6]|0,Mr=dn&8191,gr=dn>>>13,en=Y[7]|0,ur=en&8191,ar=en>>>13,Nr=Y[8]|0,Yt=Nr&8191,Ir=Nr>>>13,Qe=Y[9]|0,nt=Qe&8191,_t=Qe>>>13,Bt=Q[0]|0,Jt=Bt&8191,xt=Bt>>>13,mr=Q[1]|0,xr=mr&8191,wr=mr>>>13,nn=Q[2]|0,Cr=nn&8191,Zr=nn>>>13,pn=Q[3]|0,yr=pn&8191,Tr=pn>>>13,Br=Q[4]|0,Jr=Br&8191,rn=Br>>>13,dr=Q[5]|0,ir=dr&8191,Er=dr>>>13,an=Q[6]|0,Rr=an&8191,Ur=an>>>13,cr=Q[7]|0,Sr=cr&8191,Lr=cr>>>13,Qr=Q[8]|0,tn=Qr&8191,hn=Qr>>>13,gn=Q[9]|0,on=gn&8191,cn=gn>>>13;k.negative=m.negative^A.negative,k.length=19,re=Math.imul(Ze,Jt),B=Math.imul(Ze,xt),B=B+Math.imul(lt,Jt)|0,oe=Math.imul(lt,xt);var vn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(vn>>>26)|0,vn&=67108863,re=Math.imul(Mt,Jt),B=Math.imul(Mt,xt),B=B+Math.imul(Ft,Jt)|0,oe=Math.imul(Ft,xt),re=re+Math.imul(Ze,xr)|0,B=B+Math.imul(Ze,wr)|0,B=B+Math.imul(lt,xr)|0,oe=oe+Math.imul(lt,wr)|0;var _n=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(_n>>>26)|0,_n&=67108863,re=Math.imul(Ut,Jt),B=Math.imul(Ut,xt),B=B+Math.imul(vr,Jt)|0,oe=Math.imul(vr,xt),re=re+Math.imul(Mt,xr)|0,B=B+Math.imul(Mt,wr)|0,B=B+Math.imul(Ft,xr)|0,oe=oe+Math.imul(Ft,wr)|0,re=re+Math.imul(Ze,Cr)|0,B=B+Math.imul(Ze,Zr)|0,B=B+Math.imul(lt,Cr)|0,oe=oe+Math.imul(lt,Zr)|0;var Mn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Mn>>>26)|0,Mn&=67108863,re=Math.imul(or,Jt),B=Math.imul(or,xt),B=B+Math.imul(sr,Jt)|0,oe=Math.imul(sr,xt),re=re+Math.imul(Ut,xr)|0,B=B+Math.imul(Ut,wr)|0,B=B+Math.imul(vr,xr)|0,oe=oe+Math.imul(vr,wr)|0,re=re+Math.imul(Mt,Cr)|0,B=B+Math.imul(Mt,Zr)|0,B=B+Math.imul(Ft,Cr)|0,oe=oe+Math.imul(Ft,Zr)|0,re=re+Math.imul(Ze,yr)|0,B=B+Math.imul(Ze,Tr)|0,B=B+Math.imul(lt,yr)|0,oe=oe+Math.imul(lt,Tr)|0;var xn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(xn>>>26)|0,xn&=67108863,re=Math.imul(Xt,Jt),B=Math.imul(Xt,xt),B=B+Math.imul(nr,Jt)|0,oe=Math.imul(nr,xt),re=re+Math.imul(or,xr)|0,B=B+Math.imul(or,wr)|0,B=B+Math.imul(sr,xr)|0,oe=oe+Math.imul(sr,wr)|0,re=re+Math.imul(Ut,Cr)|0,B=B+Math.imul(Ut,Zr)|0,B=B+Math.imul(vr,Cr)|0,oe=oe+Math.imul(vr,Zr)|0,re=re+Math.imul(Mt,yr)|0,B=B+Math.imul(Mt,Tr)|0,B=B+Math.imul(Ft,yr)|0,oe=oe+Math.imul(Ft,Tr)|0,re=re+Math.imul(Ze,Jr)|0,B=B+Math.imul(Ze,rn)|0,B=B+Math.imul(lt,Jr)|0,oe=oe+Math.imul(lt,rn)|0;var Nn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,re=Math.imul(Ar,Jt),B=Math.imul(Ar,xt),B=B+Math.imul(qr,Jt)|0,oe=Math.imul(qr,xt),re=re+Math.imul(Xt,xr)|0,B=B+Math.imul(Xt,wr)|0,B=B+Math.imul(nr,xr)|0,oe=oe+Math.imul(nr,wr)|0,re=re+Math.imul(or,Cr)|0,B=B+Math.imul(or,Zr)|0,B=B+Math.imul(sr,Cr)|0,oe=oe+Math.imul(sr,Zr)|0,re=re+Math.imul(Ut,yr)|0,B=B+Math.imul(Ut,Tr)|0,B=B+Math.imul(vr,yr)|0,oe=oe+Math.imul(vr,Tr)|0,re=re+Math.imul(Mt,Jr)|0,B=B+Math.imul(Mt,rn)|0,B=B+Math.imul(Ft,Jr)|0,oe=oe+Math.imul(Ft,rn)|0,re=re+Math.imul(Ze,ir)|0,B=B+Math.imul(Ze,Er)|0,B=B+Math.imul(lt,ir)|0,oe=oe+Math.imul(lt,Er)|0;var zn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(zn>>>26)|0,zn&=67108863,re=Math.imul(Mr,Jt),B=Math.imul(Mr,xt),B=B+Math.imul(gr,Jt)|0,oe=Math.imul(gr,xt),re=re+Math.imul(Ar,xr)|0,B=B+Math.imul(Ar,wr)|0,B=B+Math.imul(qr,xr)|0,oe=oe+Math.imul(qr,wr)|0,re=re+Math.imul(Xt,Cr)|0,B=B+Math.imul(Xt,Zr)|0,B=B+Math.imul(nr,Cr)|0,oe=oe+Math.imul(nr,Zr)|0,re=re+Math.imul(or,yr)|0,B=B+Math.imul(or,Tr)|0,B=B+Math.imul(sr,yr)|0,oe=oe+Math.imul(sr,Tr)|0,re=re+Math.imul(Ut,Jr)|0,B=B+Math.imul(Ut,rn)|0,B=B+Math.imul(vr,Jr)|0,oe=oe+Math.imul(vr,rn)|0,re=re+Math.imul(Mt,ir)|0,B=B+Math.imul(Mt,Er)|0,B=B+Math.imul(Ft,ir)|0,oe=oe+Math.imul(Ft,Er)|0,re=re+Math.imul(Ze,Rr)|0,B=B+Math.imul(Ze,Ur)|0,B=B+Math.imul(lt,Rr)|0,oe=oe+Math.imul(lt,Ur)|0;var An=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(An>>>26)|0,An&=67108863,re=Math.imul(ur,Jt),B=Math.imul(ur,xt),B=B+Math.imul(ar,Jt)|0,oe=Math.imul(ar,xt),re=re+Math.imul(Mr,xr)|0,B=B+Math.imul(Mr,wr)|0,B=B+Math.imul(gr,xr)|0,oe=oe+Math.imul(gr,wr)|0,re=re+Math.imul(Ar,Cr)|0,B=B+Math.imul(Ar,Zr)|0,B=B+Math.imul(qr,Cr)|0,oe=oe+Math.imul(qr,Zr)|0,re=re+Math.imul(Xt,yr)|0,B=B+Math.imul(Xt,Tr)|0,B=B+Math.imul(nr,yr)|0,oe=oe+Math.imul(nr,Tr)|0,re=re+Math.imul(or,Jr)|0,B=B+Math.imul(or,rn)|0,B=B+Math.imul(sr,Jr)|0,oe=oe+Math.imul(sr,rn)|0,re=re+Math.imul(Ut,ir)|0,B=B+Math.imul(Ut,Er)|0,B=B+Math.imul(vr,ir)|0,oe=oe+Math.imul(vr,Er)|0,re=re+Math.imul(Mt,Rr)|0,B=B+Math.imul(Mt,Ur)|0,B=B+Math.imul(Ft,Rr)|0,oe=oe+Math.imul(Ft,Ur)|0,re=re+Math.imul(Ze,Sr)|0,B=B+Math.imul(Ze,Lr)|0,B=B+Math.imul(lt,Sr)|0,oe=oe+Math.imul(lt,Lr)|0;var Bn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,re=Math.imul(Yt,Jt),B=Math.imul(Yt,xt),B=B+Math.imul(Ir,Jt)|0,oe=Math.imul(Ir,xt),re=re+Math.imul(ur,xr)|0,B=B+Math.imul(ur,wr)|0,B=B+Math.imul(ar,xr)|0,oe=oe+Math.imul(ar,wr)|0,re=re+Math.imul(Mr,Cr)|0,B=B+Math.imul(Mr,Zr)|0,B=B+Math.imul(gr,Cr)|0,oe=oe+Math.imul(gr,Zr)|0,re=re+Math.imul(Ar,yr)|0,B=B+Math.imul(Ar,Tr)|0,B=B+Math.imul(qr,yr)|0,oe=oe+Math.imul(qr,Tr)|0,re=re+Math.imul(Xt,Jr)|0,B=B+Math.imul(Xt,rn)|0,B=B+Math.imul(nr,Jr)|0,oe=oe+Math.imul(nr,rn)|0,re=re+Math.imul(or,ir)|0,B=B+Math.imul(or,Er)|0,B=B+Math.imul(sr,ir)|0,oe=oe+Math.imul(sr,Er)|0,re=re+Math.imul(Ut,Rr)|0,B=B+Math.imul(Ut,Ur)|0,B=B+Math.imul(vr,Rr)|0,oe=oe+Math.imul(vr,Ur)|0,re=re+Math.imul(Mt,Sr)|0,B=B+Math.imul(Mt,Lr)|0,B=B+Math.imul(Ft,Sr)|0,oe=oe+Math.imul(Ft,Lr)|0,re=re+Math.imul(Ze,tn)|0,B=B+Math.imul(Ze,hn)|0,B=B+Math.imul(lt,tn)|0,oe=oe+Math.imul(lt,hn)|0;var Dn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,re=Math.imul(nt,Jt),B=Math.imul(nt,xt),B=B+Math.imul(_t,Jt)|0,oe=Math.imul(_t,xt),re=re+Math.imul(Yt,xr)|0,B=B+Math.imul(Yt,wr)|0,B=B+Math.imul(Ir,xr)|0,oe=oe+Math.imul(Ir,wr)|0,re=re+Math.imul(ur,Cr)|0,B=B+Math.imul(ur,Zr)|0,B=B+Math.imul(ar,Cr)|0,oe=oe+Math.imul(ar,Zr)|0,re=re+Math.imul(Mr,yr)|0,B=B+Math.imul(Mr,Tr)|0,B=B+Math.imul(gr,yr)|0,oe=oe+Math.imul(gr,Tr)|0,re=re+Math.imul(Ar,Jr)|0,B=B+Math.imul(Ar,rn)|0,B=B+Math.imul(qr,Jr)|0,oe=oe+Math.imul(qr,rn)|0,re=re+Math.imul(Xt,ir)|0,B=B+Math.imul(Xt,Er)|0,B=B+Math.imul(nr,ir)|0,oe=oe+Math.imul(nr,Er)|0,re=re+Math.imul(or,Rr)|0,B=B+Math.imul(or,Ur)|0,B=B+Math.imul(sr,Rr)|0,oe=oe+Math.imul(sr,Ur)|0,re=re+Math.imul(Ut,Sr)|0,B=B+Math.imul(Ut,Lr)|0,B=B+Math.imul(vr,Sr)|0,oe=oe+Math.imul(vr,Lr)|0,re=re+Math.imul(Mt,tn)|0,B=B+Math.imul(Mt,hn)|0,B=B+Math.imul(Ft,tn)|0,oe=oe+Math.imul(Ft,hn)|0,re=re+Math.imul(Ze,on)|0,B=B+Math.imul(Ze,cn)|0,B=B+Math.imul(lt,on)|0,oe=oe+Math.imul(lt,cn)|0;var Hn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Hn>>>26)|0,Hn&=67108863,re=Math.imul(nt,xr),B=Math.imul(nt,wr),B=B+Math.imul(_t,xr)|0,oe=Math.imul(_t,wr),re=re+Math.imul(Yt,Cr)|0,B=B+Math.imul(Yt,Zr)|0,B=B+Math.imul(Ir,Cr)|0,oe=oe+Math.imul(Ir,Zr)|0,re=re+Math.imul(ur,yr)|0,B=B+Math.imul(ur,Tr)|0,B=B+Math.imul(ar,yr)|0,oe=oe+Math.imul(ar,Tr)|0,re=re+Math.imul(Mr,Jr)|0,B=B+Math.imul(Mr,rn)|0,B=B+Math.imul(gr,Jr)|0,oe=oe+Math.imul(gr,rn)|0,re=re+Math.imul(Ar,ir)|0,B=B+Math.imul(Ar,Er)|0,B=B+Math.imul(qr,ir)|0,oe=oe+Math.imul(qr,Er)|0,re=re+Math.imul(Xt,Rr)|0,B=B+Math.imul(Xt,Ur)|0,B=B+Math.imul(nr,Rr)|0,oe=oe+Math.imul(nr,Ur)|0,re=re+Math.imul(or,Sr)|0,B=B+Math.imul(or,Lr)|0,B=B+Math.imul(sr,Sr)|0,oe=oe+Math.imul(sr,Lr)|0,re=re+Math.imul(Ut,tn)|0,B=B+Math.imul(Ut,hn)|0,B=B+Math.imul(vr,tn)|0,oe=oe+Math.imul(vr,hn)|0,re=re+Math.imul(Mt,on)|0,B=B+Math.imul(Mt,cn)|0,B=B+Math.imul(Ft,on)|0,oe=oe+Math.imul(Ft,cn)|0;var On=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(On>>>26)|0,On&=67108863,re=Math.imul(nt,Cr),B=Math.imul(nt,Zr),B=B+Math.imul(_t,Cr)|0,oe=Math.imul(_t,Zr),re=re+Math.imul(Yt,yr)|0,B=B+Math.imul(Yt,Tr)|0,B=B+Math.imul(Ir,yr)|0,oe=oe+Math.imul(Ir,Tr)|0,re=re+Math.imul(ur,Jr)|0,B=B+Math.imul(ur,rn)|0,B=B+Math.imul(ar,Jr)|0,oe=oe+Math.imul(ar,rn)|0,re=re+Math.imul(Mr,ir)|0,B=B+Math.imul(Mr,Er)|0,B=B+Math.imul(gr,ir)|0,oe=oe+Math.imul(gr,Er)|0,re=re+Math.imul(Ar,Rr)|0,B=B+Math.imul(Ar,Ur)|0,B=B+Math.imul(qr,Rr)|0,oe=oe+Math.imul(qr,Ur)|0,re=re+Math.imul(Xt,Sr)|0,B=B+Math.imul(Xt,Lr)|0,B=B+Math.imul(nr,Sr)|0,oe=oe+Math.imul(nr,Lr)|0,re=re+Math.imul(or,tn)|0,B=B+Math.imul(or,hn)|0,B=B+Math.imul(sr,tn)|0,oe=oe+Math.imul(sr,hn)|0,re=re+Math.imul(Ut,on)|0,B=B+Math.imul(Ut,cn)|0,B=B+Math.imul(vr,on)|0,oe=oe+Math.imul(vr,cn)|0;var Rn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,re=Math.imul(nt,yr),B=Math.imul(nt,Tr),B=B+Math.imul(_t,yr)|0,oe=Math.imul(_t,Tr),re=re+Math.imul(Yt,Jr)|0,B=B+Math.imul(Yt,rn)|0,B=B+Math.imul(Ir,Jr)|0,oe=oe+Math.imul(Ir,rn)|0,re=re+Math.imul(ur,ir)|0,B=B+Math.imul(ur,Er)|0,B=B+Math.imul(ar,ir)|0,oe=oe+Math.imul(ar,Er)|0,re=re+Math.imul(Mr,Rr)|0,B=B+Math.imul(Mr,Ur)|0,B=B+Math.imul(gr,Rr)|0,oe=oe+Math.imul(gr,Ur)|0,re=re+Math.imul(Ar,Sr)|0,B=B+Math.imul(Ar,Lr)|0,B=B+Math.imul(qr,Sr)|0,oe=oe+Math.imul(qr,Lr)|0,re=re+Math.imul(Xt,tn)|0,B=B+Math.imul(Xt,hn)|0,B=B+Math.imul(nr,tn)|0,oe=oe+Math.imul(nr,hn)|0,re=re+Math.imul(or,on)|0,B=B+Math.imul(or,cn)|0,B=B+Math.imul(sr,on)|0,oe=oe+Math.imul(sr,cn)|0;var qn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(qn>>>26)|0,qn&=67108863,re=Math.imul(nt,Jr),B=Math.imul(nt,rn),B=B+Math.imul(_t,Jr)|0,oe=Math.imul(_t,rn),re=re+Math.imul(Yt,ir)|0,B=B+Math.imul(Yt,Er)|0,B=B+Math.imul(Ir,ir)|0,oe=oe+Math.imul(Ir,Er)|0,re=re+Math.imul(ur,Rr)|0,B=B+Math.imul(ur,Ur)|0,B=B+Math.imul(ar,Rr)|0,oe=oe+Math.imul(ar,Ur)|0,re=re+Math.imul(Mr,Sr)|0,B=B+Math.imul(Mr,Lr)|0,B=B+Math.imul(gr,Sr)|0,oe=oe+Math.imul(gr,Lr)|0,re=re+Math.imul(Ar,tn)|0,B=B+Math.imul(Ar,hn)|0,B=B+Math.imul(qr,tn)|0,oe=oe+Math.imul(qr,hn)|0,re=re+Math.imul(Xt,on)|0,B=B+Math.imul(Xt,cn)|0,B=B+Math.imul(nr,on)|0,oe=oe+Math.imul(nr,cn)|0;var In=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(In>>>26)|0,In&=67108863,re=Math.imul(nt,ir),B=Math.imul(nt,Er),B=B+Math.imul(_t,ir)|0,oe=Math.imul(_t,Er),re=re+Math.imul(Yt,Rr)|0,B=B+Math.imul(Yt,Ur)|0,B=B+Math.imul(Ir,Rr)|0,oe=oe+Math.imul(Ir,Ur)|0,re=re+Math.imul(ur,Sr)|0,B=B+Math.imul(ur,Lr)|0,B=B+Math.imul(ar,Sr)|0,oe=oe+Math.imul(ar,Lr)|0,re=re+Math.imul(Mr,tn)|0,B=B+Math.imul(Mr,hn)|0,B=B+Math.imul(gr,tn)|0,oe=oe+Math.imul(gr,hn)|0,re=re+Math.imul(Ar,on)|0,B=B+Math.imul(Ar,cn)|0,B=B+Math.imul(qr,on)|0,oe=oe+Math.imul(qr,cn)|0;var Pn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Pn>>>26)|0,Pn&=67108863,re=Math.imul(nt,Rr),B=Math.imul(nt,Ur),B=B+Math.imul(_t,Rr)|0,oe=Math.imul(_t,Ur),re=re+Math.imul(Yt,Sr)|0,B=B+Math.imul(Yt,Lr)|0,B=B+Math.imul(Ir,Sr)|0,oe=oe+Math.imul(Ir,Lr)|0,re=re+Math.imul(ur,tn)|0,B=B+Math.imul(ur,hn)|0,B=B+Math.imul(ar,tn)|0,oe=oe+Math.imul(ar,hn)|0,re=re+Math.imul(Mr,on)|0,B=B+Math.imul(Mr,cn)|0,B=B+Math.imul(gr,on)|0,oe=oe+Math.imul(gr,cn)|0;var Cn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Cn>>>26)|0,Cn&=67108863,re=Math.imul(nt,Sr),B=Math.imul(nt,Lr),B=B+Math.imul(_t,Sr)|0,oe=Math.imul(_t,Lr),re=re+Math.imul(Yt,tn)|0,B=B+Math.imul(Yt,hn)|0,B=B+Math.imul(Ir,tn)|0,oe=oe+Math.imul(Ir,hn)|0,re=re+Math.imul(ur,on)|0,B=B+Math.imul(ur,cn)|0,B=B+Math.imul(ar,on)|0,oe=oe+Math.imul(ar,cn)|0;var Fn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,re=Math.imul(nt,tn),B=Math.imul(nt,hn),B=B+Math.imul(_t,tn)|0,oe=Math.imul(_t,hn),re=re+Math.imul(Yt,on)|0,B=B+Math.imul(Yt,cn)|0,B=B+Math.imul(Ir,on)|0,oe=oe+Math.imul(Ir,cn)|0;var Ln=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,re=Math.imul(nt,on),B=Math.imul(nt,cn),B=B+Math.imul(_t,on)|0,oe=Math.imul(_t,cn);var Un=(ve+re|0)+((B&8191)<<13)|0;return ve=(oe+(B>>>13)|0)+(Un>>>26)|0,Un&=67108863,$e[0]=vn,$e[1]=_n,$e[2]=Mn,$e[3]=xn,$e[4]=Nn,$e[5]=zn,$e[6]=An,$e[7]=Bn,$e[8]=Dn,$e[9]=Hn,$e[10]=On,$e[11]=Rn,$e[12]=qn,$e[13]=In,$e[14]=Pn,$e[15]=Cn,$e[16]=Fn,$e[17]=Ln,$e[18]=Un,ve!==0&&($e[19]=ve,k.length++),k};Math.imul||(Ce=ne);function Le(se,m,A){A.negative=m.negative^se.negative,A.length=se.length+m.length;for(var k=0,Y=0,Q=0;Q<A.length-1;Q++){var $e=Y;Y=0;for(var ve=k&67108863,re=Math.min(Q,m.length-1),B=Math.max(0,Q-se.length+1);B<=re;B++){var oe=Q-B,Ue=se.words[oe]|0,Ze=m.words[B]|0,lt=Ue*Ze,St=lt&67108863;$e=$e+(lt/67108864|0)|0,St=St+ve|0,ve=St&67108863,$e=$e+(St>>>26)|0,Y+=$e>>>26,$e&=67108863}A.words[Q]=ve,k=$e,$e=Y}return k!==0?A.words[Q]=k:A.length--,A.strip()}function Ge(se,m,A){var k=new ze;return k.mulp(se,m,A)}c.prototype.mulTo=function(m,A){var k,Y=this.length+m.length;return this.length===10&&m.length===10?k=Ce(this,m,A):Y<63?k=ne(this,m,A):Y<1024?k=Le(this,m,A):k=Ge(this,m,A),k};function ze(se,m){this.x=se,this.y=m}ze.prototype.makeRBT=function(m){for(var A=new Array(m),k=c.prototype._countBits(m)-1,Y=0;Y<m;Y++)A[Y]=this.revBin(Y,k,m);return A},ze.prototype.revBin=function(m,A,k){if(m===0||m===k-1)return m;for(var Y=0,Q=0;Q<A;Q++)Y|=(m&1)<<A-Q-1,m>>=1;return Y},ze.prototype.permute=function(m,A,k,Y,Q,$e){for(var ve=0;ve<$e;ve++)Y[ve]=A[m[ve]],Q[ve]=k[m[ve]]},ze.prototype.transform=function(m,A,k,Y,Q,$e){this.permute($e,m,A,k,Y,Q);for(var ve=1;ve<Q;ve<<=1)for(var re=ve<<1,B=Math.cos(2*Math.PI/re),oe=Math.sin(2*Math.PI/re),Ue=0;Ue<Q;Ue+=re)for(var Ze=B,lt=oe,St=0;St<ve;St++){var Mt=k[Ue+St],Ft=Y[Ue+St],Zt=k[Ue+St+ve],Ut=Y[Ue+St+ve],vr=Ze*Zt-lt*Ut;Ut=Ze*Ut+lt*Zt,Zt=vr,k[Ue+St]=Mt+Zt,Y[Ue+St]=Ft+Ut,k[Ue+St+ve]=Mt-Zt,Y[Ue+St+ve]=Ft-Ut,St!==re&&(vr=B*Ze-oe*lt,lt=B*lt+oe*Ze,Ze=vr)}},ze.prototype.guessLen13b=function(m,A){var k=Math.max(A,m)|1,Y=k&1,Q=0;for(k=k/2|0;k;k=k>>>1)Q++;return 1<<Q+1+Y},ze.prototype.conjugate=function(m,A,k){if(!(k<=1))for(var Y=0;Y<k/2;Y++){var Q=m[Y];m[Y]=m[k-Y-1],m[k-Y-1]=Q,Q=A[Y],A[Y]=-A[k-Y-1],A[k-Y-1]=-Q}},ze.prototype.normalize13b=function(m,A){for(var k=0,Y=0;Y<A/2;Y++){var Q=Math.round(m[2*Y+1]/A)*8192+Math.round(m[2*Y]/A)+k;m[Y]=Q&67108863,Q<67108864?k=0:k=Q/67108864|0}return m},ze.prototype.convert13b=function(m,A,k,Y){for(var Q=0,$e=0;$e<A;$e++)Q=Q+(m[$e]|0),k[2*$e]=Q&8191,Q=Q>>>13,k[2*$e+1]=Q&8191,Q=Q>>>13;for($e=2*A;$e<Y;++$e)k[$e]=0;o(Q===0),o((Q&-8192)===0)},ze.prototype.stub=function(m){for(var A=new Array(m),k=0;k<m;k++)A[k]=0;return A},ze.prototype.mulp=function(m,A,k){var Y=2*this.guessLen13b(m.length,A.length),Q=this.makeRBT(Y),$e=this.stub(Y),ve=new Array(Y),re=new Array(Y),B=new Array(Y),oe=new Array(Y),Ue=new Array(Y),Ze=new Array(Y),lt=k.words;lt.length=Y,this.convert13b(m.words,m.length,ve,Y),this.convert13b(A.words,A.length,oe,Y),this.transform(ve,$e,re,B,Y,Q),this.transform(oe,$e,Ue,Ze,Y,Q);for(var St=0;St<Y;St++){var Mt=re[St]*Ue[St]-B[St]*Ze[St];B[St]=re[St]*Ze[St]+B[St]*Ue[St],re[St]=Mt}return this.conjugate(re,B,Y),this.transform(re,B,lt,$e,Y,Q),this.conjugate(lt,$e,Y),this.normalize13b(lt,Y),k.negative=m.negative^A.negative,k.length=m.length+A.length,k.strip()},c.prototype.mul=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),this.mulTo(m,A)},c.prototype.mulf=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),Ge(this,m,A)},c.prototype.imul=function(m){return this.clone().mulTo(m,this)},c.prototype.imuln=function(m){o(typeof m=="number"),o(m<67108864);for(var A=0,k=0;k<this.length;k++){var Y=(this.words[k]|0)*m,Q=(Y&67108863)+(A&67108863);A>>=26,A+=Y/67108864|0,A+=Q>>>26,this.words[k]=Q&67108863}return A!==0&&(this.words[k]=A,this.length++),this.length=m===0?1:this.length,this},c.prototype.muln=function(m){return this.clone().imuln(m)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(m){var A=te(m);if(A.length===0)return new c(1);for(var k=this,Y=0;Y<A.length&&A[Y]===0;Y++,k=k.sqr());if(++Y<A.length)for(var Q=k.sqr();Y<A.length;Y++,Q=Q.sqr())A[Y]!==0&&(k=k.mul(Q));return k},c.prototype.iushln=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=67108863>>>26-A<<26-A,Q;if(A!==0){var $e=0;for(Q=0;Q<this.length;Q++){var ve=this.words[Q]&Y,re=(this.words[Q]|0)-ve<<A;this.words[Q]=re|$e,$e=ve>>>26-A}$e&&(this.words[Q]=$e,this.length++)}if(k!==0){for(Q=this.length-1;Q>=0;Q--)this.words[Q+k]=this.words[Q];for(Q=0;Q<k;Q++)this.words[Q]=0;this.length+=k}return this.strip()},c.prototype.ishln=function(m){return o(this.negative===0),this.iushln(m)},c.prototype.iushrn=function(m,A,k){o(typeof m=="number"&&m>=0);var Y;A?Y=(A-A%26)/26:Y=0;var Q=m%26,$e=Math.min((m-Q)/26,this.length),ve=67108863^67108863>>>Q<<Q,re=k;if(Y-=$e,Y=Math.max(0,Y),re){for(var B=0;B<$e;B++)re.words[B]=this.words[B];re.length=$e}if($e!==0)if(this.length>$e)for(this.length-=$e,B=0;B<this.length;B++)this.words[B]=this.words[B+$e];else this.words[0]=0,this.length=1;var oe=0;for(B=this.length-1;B>=0&&(oe!==0||B>=Y);B--){var Ue=this.words[B]|0;this.words[B]=oe<<26-Q|Ue>>>Q,oe=Ue&ve}return re&&oe!==0&&(re.words[re.length++]=oe),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},c.prototype.ishrn=function(m,A,k){return o(this.negative===0),this.iushrn(m,A,k)},c.prototype.shln=function(m){return this.clone().ishln(m)},c.prototype.ushln=function(m){return this.clone().iushln(m)},c.prototype.shrn=function(m){return this.clone().ishrn(m)},c.prototype.ushrn=function(m){return this.clone().iushrn(m)},c.prototype.testn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return!1;var Q=this.words[k];return!!(Q&Y)},c.prototype.imaskn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26;if(o(this.negative===0,"imaskn works only with positive numbers"),this.length<=k)return this;if(A!==0&&k++,this.length=Math.min(k,this.length),A!==0){var Y=67108863^67108863>>>A<<A;this.words[this.length-1]&=Y}return this.strip()},c.prototype.maskn=function(m){return this.clone().imaskn(m)},c.prototype.iaddn=function(m){return o(typeof m=="number"),o(m<67108864),m<0?this.isubn(-m):this.negative!==0?this.length===1&&(this.words[0]|0)<m?(this.words[0]=m-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(m),this.negative=1,this):this._iaddn(m)},c.prototype._iaddn=function(m){this.words[0]+=m;for(var A=0;A<this.length&&this.words[A]>=67108864;A++)this.words[A]-=67108864,A===this.length-1?this.words[A+1]=1:this.words[A+1]++;return this.length=Math.max(this.length,A+1),this},c.prototype.isubn=function(m){if(o(typeof m=="number"),o(m<67108864),m<0)return this.iaddn(-m);if(this.negative!==0)return this.negative=0,this.iaddn(m),this.negative=1,this;if(this.words[0]-=m,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var A=0;A<this.length&&this.words[A]<0;A++)this.words[A]+=67108864,this.words[A+1]-=1;return this.strip()},c.prototype.addn=function(m){return this.clone().iaddn(m)},c.prototype.subn=function(m){return this.clone().isubn(m)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(m,A,k){var Y=m.length+k,Q;this._expand(Y);var $e,ve=0;for(Q=0;Q<m.length;Q++){$e=(this.words[Q+k]|0)+ve;var re=(m.words[Q]|0)*A;$e-=re&67108863,ve=($e>>26)-(re/67108864|0),this.words[Q+k]=$e&67108863}for(;Q<this.length-k;Q++)$e=(this.words[Q+k]|0)+ve,ve=$e>>26,this.words[Q+k]=$e&67108863;if(ve===0)return this.strip();for(o(ve===-1),ve=0,Q=0;Q<this.length;Q++)$e=-(this.words[Q]|0)+ve,ve=$e>>26,this.words[Q]=$e&67108863;return this.negative=1,this.strip()},c.prototype._wordDiv=function(m,A){var k=this.length-m.length,Y=this.clone(),Q=m,$e=Q.words[Q.length-1]|0,ve=this._countBits($e);k=26-ve,k!==0&&(Q=Q.ushln(k),Y.iushln(k),$e=Q.words[Q.length-1]|0);var re=Y.length-Q.length,B;if(A!=="mod"){B=new c(null),B.length=re+1,B.words=new Array(B.length);for(var oe=0;oe<B.length;oe++)B.words[oe]=0}var Ue=Y.clone()._ishlnsubmul(Q,1,re);Ue.negative===0&&(Y=Ue,B&&(B.words[re]=1));for(var Ze=re-1;Ze>=0;Ze--){var lt=(Y.words[Q.length+Ze]|0)*67108864+(Y.words[Q.length+Ze-1]|0);for(lt=Math.min(lt/$e|0,67108863),Y._ishlnsubmul(Q,lt,Ze);Y.negative!==0;)lt--,Y.negative=0,Y._ishlnsubmul(Q,1,Ze),!Y.isZero()&&(Y.negative^=1);B&&(B.words[Ze]=lt)}return B&&B.strip(),Y.strip(),A!=="div"&&k!==0&&Y.iushrn(k),{div:B||null,mod:Y}},c.prototype.divmod=function(m,A,k){if(o(!m.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var Y,Q,$e;return this.negative!==0&&m.negative===0?($e=this.neg().divmod(m,A),A!=="mod"&&(Y=$e.div.neg()),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.iadd(m)),{div:Y,mod:Q}):this.negative===0&&m.negative!==0?($e=this.divmod(m.neg(),A),A!=="mod"&&(Y=$e.div.neg()),{div:Y,mod:$e.mod}):(this.negative&m.negative)!==0?($e=this.neg().divmod(m.neg(),A),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.isub(m)),{div:$e.div,mod:Q}):m.length>this.length||this.cmp(m)<0?{div:new c(0),mod:this}:m.length===1?A==="div"?{div:this.divn(m.words[0]),mod:null}:A==="mod"?{div:null,mod:new c(this.modn(m.words[0]))}:{div:this.divn(m.words[0]),mod:new c(this.modn(m.words[0]))}:this._wordDiv(m,A)},c.prototype.div=function(m){return this.divmod(m,"div",!1).div},c.prototype.mod=function(m){return this.divmod(m,"mod",!1).mod},c.prototype.umod=function(m){return this.divmod(m,"mod",!0).mod},c.prototype.divRound=function(m){var A=this.divmod(m);if(A.mod.isZero())return A.div;var k=A.div.negative!==0?A.mod.isub(m):A.mod,Y=m.ushrn(1),Q=m.andln(1),$e=k.cmp(Y);return $e<0||Q===1&&$e===0?A.div:A.div.negative!==0?A.div.isubn(1):A.div.iaddn(1)},c.prototype.modn=function(m){o(m<=67108863);for(var A=67108864%m,k=0,Y=this.length-1;Y>=0;Y--)k=(A*k+(this.words[Y]|0))%m;return k},c.prototype.idivn=function(m){o(m<=67108863);for(var A=0,k=this.length-1;k>=0;k--){var Y=(this.words[k]|0)+A*67108864;this.words[k]=Y/m|0,A=Y%m}return this.strip()},c.prototype.divn=function(m){return this.clone().idivn(m)},c.prototype.egcd=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=new c(0),ve=new c(1),re=0;A.isEven()&&k.isEven();)A.iushrn(1),k.iushrn(1),++re;for(var B=k.clone(),oe=A.clone();!A.isZero();){for(var Ue=0,Ze=1;(A.words[0]&Ze)===0&&Ue<26;++Ue,Ze<<=1);if(Ue>0)for(A.iushrn(Ue);Ue-- >0;)(Y.isOdd()||Q.isOdd())&&(Y.iadd(B),Q.isub(oe)),Y.iushrn(1),Q.iushrn(1);for(var lt=0,St=1;(k.words[0]&St)===0&&lt<26;++lt,St<<=1);if(lt>0)for(k.iushrn(lt);lt-- >0;)($e.isOdd()||ve.isOdd())&&($e.iadd(B),ve.isub(oe)),$e.iushrn(1),ve.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub($e),Q.isub(ve)):(k.isub(A),$e.isub(Y),ve.isub(Q))}return{a:$e,b:ve,gcd:k.iushln(re)}},c.prototype._invmp=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=k.clone();A.cmpn(1)>0&&k.cmpn(1)>0;){for(var ve=0,re=1;(A.words[0]&re)===0&&ve<26;++ve,re<<=1);if(ve>0)for(A.iushrn(ve);ve-- >0;)Y.isOdd()&&Y.iadd($e),Y.iushrn(1);for(var B=0,oe=1;(k.words[0]&oe)===0&&B<26;++B,oe<<=1);if(B>0)for(k.iushrn(B);B-- >0;)Q.isOdd()&&Q.iadd($e),Q.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub(Q)):(k.isub(A),Q.isub(Y))}var Ue;return A.cmpn(1)===0?Ue=Y:Ue=Q,Ue.cmpn(0)<0&&Ue.iadd(m),Ue},c.prototype.gcd=function(m){if(this.isZero())return m.abs();if(m.isZero())return this.abs();var A=this.clone(),k=m.clone();A.negative=0,k.negative=0;for(var Y=0;A.isEven()&&k.isEven();Y++)A.iushrn(1),k.iushrn(1);do{for(;A.isEven();)A.iushrn(1);for(;k.isEven();)k.iushrn(1);var Q=A.cmp(k);if(Q<0){var $e=A;A=k,k=$e}else if(Q===0||k.cmpn(1)===0)break;A.isub(k)}while(!0);return k.iushln(Y)},c.prototype.invm=function(m){return this.egcd(m).a.umod(m)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(m){return this.words[0]&m},c.prototype.bincn=function(m){o(typeof m=="number");var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return this._expand(k+1),this.words[k]|=Y,this;for(var Q=Y,$e=k;Q!==0&&$e<this.length;$e++){var ve=this.words[$e]|0;ve+=Q,Q=ve>>>26,ve&=67108863,this.words[$e]=ve}return Q!==0&&(this.words[$e]=Q,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(m){var A=m<0;if(this.negative!==0&&!A)return-1;if(this.negative===0&&A)return 1;this.strip();var k;if(this.length>1)k=1;else{A&&(m=-m),o(m<=67108863,"Number is too big");var Y=this.words[0]|0;k=Y===m?0:Y<m?-1:1}return this.negative!==0?-k|0:k},c.prototype.cmp=function(m){if(this.negative!==0&&m.negative===0)return-1;if(this.negative===0&&m.negative!==0)return 1;var A=this.ucmp(m);return this.negative!==0?-A|0:A},c.prototype.ucmp=function(m){if(this.length>m.length)return 1;if(this.length<m.length)return-1;for(var A=0,k=this.length-1;k>=0;k--){var Y=this.words[k]|0,Q=m.words[k]|0;if(Y!==Q){Y<Q?A=-1:Y>Q&&(A=1);break}}return A},c.prototype.gtn=function(m){return this.cmpn(m)===1},c.prototype.gt=function(m){return this.cmp(m)===1},c.prototype.gten=function(m){return this.cmpn(m)>=0},c.prototype.gte=function(m){return this.cmp(m)>=0},c.prototype.ltn=function(m){return this.cmpn(m)===-1},c.prototype.lt=function(m){return this.cmp(m)===-1},c.prototype.lten=function(m){return this.cmpn(m)<=0},c.prototype.lte=function(m){return this.cmp(m)<=0},c.prototype.eqn=function(m){return this.cmpn(m)===0},c.prototype.eq=function(m){return this.cmp(m)===0},c.red=function(m){return new ht(m)},c.prototype.toRed=function(m){return o(!this.red,"Already a number in reduction context"),o(this.negative===0,"red works only with positives"),m.convertTo(this)._forceRed(m)},c.prototype.fromRed=function(){return o(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(m){return this.red=m,this},c.prototype.forceRed=function(m){return o(!this.red,"Already a number in reduction context"),this._forceRed(m)},c.prototype.redAdd=function(m){return o(this.red,"redAdd works only with red numbers"),this.red.add(this,m)},c.prototype.redIAdd=function(m){return o(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,m)},c.prototype.redSub=function(m){return o(this.red,"redSub works only with red numbers"),this.red.sub(this,m)},c.prototype.redISub=function(m){return o(this.red,"redISub works only with red numbers"),this.red.isub(this,m)},c.prototype.redShl=function(m){return o(this.red,"redShl works only with red numbers"),this.red.shl(this,m)},c.prototype.redMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.mul(this,m)},c.prototype.redIMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.imul(this,m)},c.prototype.redSqr=function(){return o(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return o(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return o(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return o(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return o(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(m){return o(this.red&&!m.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,m)};var Xe={k256:null,p224:null,p192:null,p25519:null};function He(se,m){this.name=se,this.p=new c(m,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}He.prototype._tmp=function(){var m=new c(null);return m.words=new Array(Math.ceil(this.n/13)),m},He.prototype.ireduce=function(m){var A=m,k;do this.split(A,this.tmp),A=this.imulK(A),A=A.iadd(this.tmp),k=A.bitLength();while(k>this.n);var Y=k<this.n?-1:A.ucmp(this.p);return Y===0?(A.words[0]=0,A.length=1):Y>0?A.isub(this.p):A.strip!==void 0?A.strip():A._strip(),A},He.prototype.split=function(m,A){m.iushrn(this.n,0,A)},He.prototype.imulK=function(m){return m.imul(this.k)};function Ve(){He.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(Ve,He),Ve.prototype.split=function(m,A){for(var k=4194303,Y=Math.min(m.length,9),Q=0;Q<Y;Q++)A.words[Q]=m.words[Q];if(A.length=Y,m.length<=9){m.words[0]=0,m.length=1;return}var $e=m.words[9];for(A.words[A.length++]=$e&k,Q=10;Q<m.length;Q++){var ve=m.words[Q]|0;m.words[Q-10]=(ve&k)<<4|$e>>>22,$e=ve}$e>>>=22,m.words[Q-10]=$e,$e===0&&m.length>10?m.length-=10:m.length-=9},Ve.prototype.imulK=function(m){m.words[m.length]=0,m.words[m.length+1]=0,m.length+=2;for(var A=0,k=0;k<m.length;k++){var Y=m.words[k]|0;A+=Y*977,m.words[k]=A&67108863,A=Y*64+(A/67108864|0)}return m.words[m.length-1]===0&&(m.length--,m.words[m.length-1]===0&&m.length--),m};function We(){He.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(We,He);function rt(){He.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(rt,He);function st(){He.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(st,He),st.prototype.imulK=function(m){for(var A=0,k=0;k<m.length;k++){var Y=(m.words[k]|0)*19+A,Q=Y&67108863;Y>>>=26,m.words[k]=Q,A=Y}return A!==0&&(m.words[m.length++]=A),m},c._prime=function(m){if(Xe[m])return Xe[m];var A;if(m==="k256")A=new Ve;else if(m==="p224")A=new We;else if(m==="p192")A=new rt;else if(m==="p25519")A=new st;else throw new Error("Unknown prime "+m);return Xe[m]=A,A};function ht(se){if(typeof se=="string"){var m=c._prime(se);this.m=m.p,this.prime=m}else o(se.gtn(1),"modulus must be greater than 1"),this.m=se,this.prime=null}ht.prototype._verify1=function(m){o(m.negative===0,"red works only with positives"),o(m.red,"red works only with red numbers")},ht.prototype._verify2=function(m,A){o((m.negative|A.negative)===0,"red works only with positives"),o(m.red&&m.red===A.red,"red works only with red numbers")},ht.prototype.imod=function(m){return this.prime?this.prime.ireduce(m)._forceRed(this):m.umod(this.m)._forceRed(this)},ht.prototype.neg=function(m){return m.isZero()?m.clone():this.m.sub(m)._forceRed(this)},ht.prototype.add=function(m,A){this._verify2(m,A);var k=m.add(A);return k.cmp(this.m)>=0&&k.isub(this.m),k._forceRed(this)},ht.prototype.iadd=function(m,A){this._verify2(m,A);var k=m.iadd(A);return k.cmp(this.m)>=0&&k.isub(this.m),k},ht.prototype.sub=function(m,A){this._verify2(m,A);var k=m.sub(A);return k.cmpn(0)<0&&k.iadd(this.m),k._forceRed(this)},ht.prototype.isub=function(m,A){this._verify2(m,A);var k=m.isub(A);return k.cmpn(0)<0&&k.iadd(this.m),k},ht.prototype.shl=function(m,A){return this._verify1(m),this.imod(m.ushln(A))},ht.prototype.imul=function(m,A){return this._verify2(m,A),this.imod(m.imul(A))},ht.prototype.mul=function(m,A){return this._verify2(m,A),this.imod(m.mul(A))},ht.prototype.isqr=function(m){return this.imul(m,m.clone())},ht.prototype.sqr=function(m){return this.mul(m,m)},ht.prototype.sqrt=function(m){if(m.isZero())return m.clone();var A=this.m.andln(3);if(o(A%2===1),A===3){var k=this.m.add(new c(1)).iushrn(2);return this.pow(m,k)}for(var Y=this.m.subn(1),Q=0;!Y.isZero()&&Y.andln(1)===0;)Q++,Y.iushrn(1);o(!Y.isZero());var $e=new c(1).toRed(this),ve=$e.redNeg(),re=this.m.subn(1).iushrn(1),B=this.m.bitLength();for(B=new c(2*B*B).toRed(this);this.pow(B,re).cmp(ve)!==0;)B.redIAdd(ve);for(var oe=this.pow(B,Y),Ue=this.pow(m,Y.addn(1).iushrn(1)),Ze=this.pow(m,Y),lt=Q;Ze.cmp($e)!==0;){for(var St=Ze,Mt=0;St.cmp($e)!==0;Mt++)St=St.redSqr();o(Mt<lt);var Ft=this.pow(oe,new c(1).iushln(lt-Mt-1));Ue=Ue.redMul(Ft),oe=Ft.redSqr(),Ze=Ze.redMul(oe),lt=Mt}return Ue},ht.prototype.invm=function(m){var A=m._invmp(this.m);return A.negative!==0?(A.negative=0,this.imod(A).redNeg()):this.imod(A)},ht.prototype.pow=function(m,A){if(A.isZero())return new c(1).toRed(this);if(A.cmpn(1)===0)return m.clone();var k=4,Y=new Array(1<<k);Y[0]=new c(1).toRed(this),Y[1]=m;for(var Q=2;Q<Y.length;Q++)Y[Q]=this.mul(Y[Q-1],m);var $e=Y[0],ve=0,re=0,B=A.bitLength()%26;for(B===0&&(B=26),Q=A.length-1;Q>=0;Q--){for(var oe=A.words[Q],Ue=B-1;Ue>=0;Ue--){var Ze=oe>>Ue&1;if($e!==Y[0]&&($e=this.sqr($e)),Ze===0&&ve===0){re=0;continue}ve<<=1,ve|=Ze,re++,!(re!==k&&(Q!==0||Ue!==0))&&($e=this.mul($e,Y[ve]),re=0,ve=0)}B=26}return $e},ht.prototype.convertTo=function(m){var A=m.umod(this.m);return A===m?A.clone():A},ht.prototype.convertFrom=function(m){var A=m.clone();return A.red=null,A},c.mont=function(m){return new je(m)};function je(se){ht.call(this,se),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(je,ht),je.prototype.convertTo=function(m){return this.imod(m.ushln(this.shift))},je.prototype.convertFrom=function(m){var A=this.imod(m.mul(this.rinv));return A.red=null,A},je.prototype.imul=function(m,A){if(m.isZero()||A.isZero())return m.words[0]=0,m.length=1,m;var k=m.imul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.mul=function(m,A){if(m.isZero()||A.isZero())return new c(0)._forceRed(this);var k=m.mul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.invm=function(m){var A=this.imod(m._invmp(this.m).mul(this.r2));return A._forceRed(this)}})(typeof t>"u"||t,r)}),require_api=__commonJS2(r=>{var t=require_asn1(),n=require_inherits(),s=r;s.define=function(c,f){return new o(c,f)};function o(a,c){this.name=a,this.body=c,this.decoders={},this.encoders={}}o.prototype._createNamed=function(c){var f;try{f=(()=>{throw new Error("Cannot require module vm")})().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{f=function(b){this._initNamed(b)}}return n(f,c),f.prototype._initNamed=function(b){c.call(this,b)},new f(this)},o.prototype._getDecoder=function(c){return c=c||"der",!this.decoders.hasOwnProperty(c)&&(this.decoders[c]=this._createNamed(t.decoders[c])),this.decoders[c]},o.prototype.decode=function(c,f,g){return this._getDecoder(f).decode(c,g)},o.prototype._getEncoder=function(c){return c=c||"der",!this.encoders.hasOwnProperty(c)&&(this.encoders[c]=this._createNamed(t.encoders[c])),this.encoders[c]},o.prototype.encode=function(c,f,g){return this._getEncoder(f).encode(c,g)}}),require_reporter=__commonJS2(r=>{var t=require_inherits();function n(o){this._reporterState={obj:null,path:[],options:o||{},errors:[]}}r.Reporter=n,n.prototype.isError=function(a){return a instanceof s},n.prototype.save=function(){var a=this._reporterState;return{obj:a.obj,pathLen:a.path.length}},n.prototype.restore=function(a){var c=this._reporterState;c.obj=a.obj,c.path=c.path.slice(0,a.pathLen)},n.prototype.enterKey=function(a){return this._reporterState.path.push(a)},n.prototype.exitKey=function(a){var c=this._reporterState;c.path=c.path.slice(0,a-1)},n.prototype.leaveKey=function(a,c,f){var g=this._reporterState;this.exitKey(a),g.obj!==null&&(g.obj[c]=f)},n.prototype.path=function(){return this._reporterState.path.join("/")},n.prototype.enterObject=function(){var a=this._reporterState,c=a.obj;return a.obj={},c},n.prototype.leaveObject=function(a){var c=this._reporterState,f=c.obj;return c.obj=a,f},n.prototype.error=function(a){var c,f=this._reporterState,g=a instanceof s;if(g?c=a:c=new s(f.path.map(function(b){return"["+JSON.stringify(b)+"]"}).join(""),a.message||a,a.stack),!f.options.partial)throw c;return g||f.errors.push(c),c},n.prototype.wrapResult=function(a){var c=this._reporterState;return c.options.partial?{result:this.isError(a)?null:a,errors:c.errors}:a};function s(o,a){this.path=o,this.rethrow(a)}t(s,Error),s.prototype.rethrow=function(a){if(this.message=a+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,s),!this.stack)try{throw new Error(this.message)}catch(c){this.stack=c.stack}return this}}),require_buffer=__commonJS2(r=>{var t=require_inherits(),n=require_base2().Reporter,s=(init_buffer(),__toCommonJS(exports_buffer)).Buffer;function o(c,f){if(n.call(this,f),!s.isBuffer(c)){this.error("Input not Buffer");return}this.base=c,this.offset=0,this.length=c.length}t(o,n),r.DecoderBuffer=o,o.prototype.save=function(){return{offset:this.offset,reporter:n.prototype.save.call(this)}},o.prototype.restore=function(f){var g=new o(this.base);return g.offset=f.offset,g.length=this.offset,this.offset=f.offset,n.prototype.restore.call(this,f.reporter),g},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(f){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(f||"DecoderBuffer overrun")},o.prototype.skip=function(f,g){if(!(this.offset+f<=this.length))return this.error(g||"DecoderBuffer overrun");var b=new o(this.base);return b._reporterState=this._reporterState,b.offset=this.offset,b.length=this.offset+f,this.offset+=f,b},o.prototype.raw=function(f){return this.base.slice(f?f.offset:this.offset,this.length)};function a(c,f){if(Array.isArray(c))this.length=0,this.value=c.map(function(g){return g instanceof a||(g=new a(g,f)),this.length+=g.length,g},this);else if(typeof c=="number"){if(!(0<=c&&c<=255))return f.error("non-byte EncoderBuffer value");this.value=c,this.length=1}else if(typeof c=="string")this.value=c,this.length=s.byteLength(c);else if(s.isBuffer(c))this.value=c,this.length=c.length;else return f.error("Unsupported type: "+typeof c)}r.EncoderBuffer=a,a.prototype.join=function(f,g){return f||(f=new s(this.length)),g||(g=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(b){b.join(f,g),g+=b.length}):(typeof this.value=="number"?f[g]=this.value:typeof this.value=="string"?f.write(this.value,g):s.isBuffer(this.value)&&this.value.copy(f,g),g+=this.length)),f}}),require_node=__commonJS2((r,t)=>{var n=require_base2().Reporter,s=require_base2().EncoderBuffer,o=require_base2().DecoderBuffer,a=require_minimalistic_assert(),c=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],f=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(c),g=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function b(L,q){var X={};this._baseState=X,X.enc=L,X.parent=q||null,X.children=null,X.tag=null,X.args=null,X.reverseArgs=null,X.choice=null,X.optional=!1,X.any=!1,X.obj=!1,X.use=null,X.useDecoder=null,X.key=null,X.default=null,X.explicit=null,X.implicit=null,X.contains=null,!X.parent&&(X.children=[],this._wrap())}t.exports=b;var _=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];b.prototype.clone=function(){var q=this._baseState,X={};_.forEach(function(ne){X[ne]=q[ne]});var te=new this.constructor(X.parent);return te._baseState=X,te},b.prototype._wrap=function(){var q=this._baseState;f.forEach(function(X){this[X]=function(){var ne=new this.constructor(this);return q.children.push(ne),ne[X].apply(ne,arguments)}},this)},b.prototype._init=function(q){var X=this._baseState;a(X.parent===null),q.call(this),X.children=X.children.filter(function(te){return te._baseState.parent===this},this),a.equal(X.children.length,1,"Root node can have only one child")},b.prototype._useArgs=function(q){var X=this._baseState,te=q.filter(function(ne){return ne instanceof this.constructor},this);q=q.filter(function(ne){return!(ne instanceof this.constructor)},this),te.length!==0&&(a(X.children===null),X.children=te,te.forEach(function(ne){ne._baseState.parent=this},this)),q.length!==0&&(a(X.args===null),X.args=q,X.reverseArgs=q.map(function(ne){if(typeof ne!="object"||ne.constructor!==Object)return ne;var Ce={};return Object.keys(ne).forEach(function(Le){Le==(Le|0)&&(Le|=0);var Ge=ne[Le];Ce[Ge]=Le}),Ce}))},g.forEach(function(L){b.prototype[L]=function(){var X=this._baseState;throw new Error(L+" not implemented for encoding: "+X.enc)}}),c.forEach(function(L){b.prototype[L]=function(){var X=this._baseState,te=Array.prototype.slice.call(arguments);return a(X.tag===null),X.tag=L,this._useArgs(te),this}}),b.prototype.use=function(q){a(q);var X=this._baseState;return a(X.use===null),X.use=q,this},b.prototype.optional=function(){var q=this._baseState;return q.optional=!0,this},b.prototype.def=function(q){var X=this._baseState;return a(X.default===null),X.default=q,X.optional=!0,this},b.prototype.explicit=function(q){var X=this._baseState;return a(X.explicit===null&&X.implicit===null),X.explicit=q,this},b.prototype.implicit=function(q){var X=this._baseState;return a(X.explicit===null&&X.implicit===null),X.implicit=q,this},b.prototype.obj=function(){var q=this._baseState,X=Array.prototype.slice.call(arguments);return q.obj=!0,X.length!==0&&this._useArgs(X),this},b.prototype.key=function(q){var X=this._baseState;return a(X.key===null),X.key=q,this},b.prototype.any=function(){var q=this._baseState;return q.any=!0,this},b.prototype.choice=function(q){var X=this._baseState;return a(X.choice===null),X.choice=q,this._useArgs(Object.keys(q).map(function(te){return q[te]})),this},b.prototype.contains=function(q){var X=this._baseState;return a(X.use===null),X.contains=q,this},b.prototype._decode=function(q,X){var te=this._baseState;if(te.parent===null)return q.wrapResult(te.children[0]._decode(q,X));var ne=te.default,Ce=!0,Le=null;if(te.key!==null&&(Le=q.enterKey(te.key)),te.optional){var Ge=null;if(te.explicit!==null?Ge=te.explicit:te.implicit!==null?Ge=te.implicit:te.tag!==null&&(Ge=te.tag),Ge===null&&!te.any){var ze=q.save();try{te.choice===null?this._decodeGeneric(te.tag,q,X):this._decodeChoice(q,X),Ce=!0}catch{Ce=!1}q.restore(ze)}else if(Ce=this._peekTag(q,Ge,te.any),q.isError(Ce))return Ce}var Xe;if(te.obj&&Ce&&(Xe=q.enterObject()),Ce){if(te.explicit!==null){var He=this._decodeTag(q,te.explicit);if(q.isError(He))return He;q=He}var Ve=q.offset;if(te.use===null&&te.choice===null){if(te.any)var ze=q.save();var We=this._decodeTag(q,te.implicit!==null?te.implicit:te.tag,te.any);if(q.isError(We))return We;te.any?ne=q.raw(ze):q=We}if(X&&X.track&&te.tag!==null&&X.track(q.path(),Ve,q.length,"tagged"),X&&X.track&&te.tag!==null&&X.track(q.path(),q.offset,q.length,"content"),te.any?ne=ne:te.choice===null?ne=this._decodeGeneric(te.tag,q,X):ne=this._decodeChoice(q,X),q.isError(ne))return ne;if(!te.any&&te.choice===null&&te.children!==null&&te.children.forEach(function(ht){ht._decode(q,X)}),te.contains&&(te.tag==="octstr"||te.tag==="bitstr")){var rt=new o(ne);ne=this._getUse(te.contains,q._reporterState.obj)._decode(rt,X)}}return te.obj&&Ce&&(ne=q.leaveObject(Xe)),te.key!==null&&(ne!==null||Ce===!0)?q.leaveKey(Le,te.key,ne):Le!==null&&q.exitKey(Le),ne},b.prototype._decodeGeneric=function(q,X,te){var ne=this._baseState;return q==="seq"||q==="set"?null:q==="seqof"||q==="setof"?this._decodeList(X,q,ne.args[0],te):/str$/.test(q)?this._decodeStr(X,q,te):q==="objid"&&ne.args?this._decodeObjid(X,ne.args[0],ne.args[1],te):q==="objid"?this._decodeObjid(X,null,null,te):q==="gentime"||q==="utctime"?this._decodeTime(X,q,te):q==="null_"?this._decodeNull(X,te):q==="bool"?this._decodeBool(X,te):q==="objDesc"?this._decodeStr(X,q,te):q==="int"||q==="enum"?this._decodeInt(X,ne.args&&ne.args[0],te):ne.use!==null?this._getUse(ne.use,X._reporterState.obj)._decode(X,te):X.error("unknown tag: "+q)},b.prototype._getUse=function(q,X){var te=this._baseState;return te.useDecoder=this._use(q,X),a(te.useDecoder._baseState.parent===null),te.useDecoder=te.useDecoder._baseState.children[0],te.implicit!==te.useDecoder._baseState.implicit&&(te.useDecoder=te.useDecoder.clone(),te.useDecoder._baseState.implicit=te.implicit),te.useDecoder},b.prototype._decodeChoice=function(q,X){var te=this._baseState,ne=null,Ce=!1;return Object.keys(te.choice).some(function(Le){var Ge=q.save(),ze=te.choice[Le];try{var Xe=ze._decode(q,X);if(q.isError(Xe))return!1;ne={type:Le,value:Xe},Ce=!0}catch{return q.restore(Ge),!1}return!0},this),Ce?ne:q.error("Choice not matched")},b.prototype._createEncoderBuffer=function(q){return new s(q,this.reporter)},b.prototype._encode=function(q,X,te){var ne=this._baseState;if(!(ne.default!==null&&ne.default===q)){var Ce=this._encodeValue(q,X,te);if(Ce!==void 0&&!this._skipDefault(Ce,X,te))return Ce}},b.prototype._encodeValue=function(q,X,te){var ne=this._baseState;if(ne.parent===null)return ne.children[0]._encode(q,X||new n);var ze=null;if(this.reporter=X,ne.optional&&q===void 0)if(ne.default!==null)q=ne.default;else return;var Ce=null,Le=!1;if(ne.any)ze=this._createEncoderBuffer(q);else if(ne.choice)ze=this._encodeChoice(q,X);else if(ne.contains)Ce=this._getUse(ne.contains,te)._encode(q,X),Le=!0;else if(ne.children)Ce=ne.children.map(function(Ve){if(Ve._baseState.tag==="null_")return Ve._encode(null,X,q);if(Ve._baseState.key===null)return X.error("Child should have a key");var We=X.enterKey(Ve._baseState.key);if(typeof q!="object")return X.error("Child expected, but input is not object");var rt=Ve._encode(q[Ve._baseState.key],X,q);return X.leaveKey(We),rt},this).filter(function(Ve){return Ve}),Ce=this._createEncoderBuffer(Ce);else if(ne.tag==="seqof"||ne.tag==="setof"){if(!(ne.args&&ne.args.length===1))return X.error("Too many args for : "+ne.tag);if(!Array.isArray(q))return X.error("seqof/setof, but data is not Array");var Ge=this.clone();Ge._baseState.implicit=null,Ce=this._createEncoderBuffer(q.map(function(Ve){var We=this._baseState;return this._getUse(We.args[0],q)._encode(Ve,X)},Ge))}else ne.use!==null?ze=this._getUse(ne.use,te)._encode(q,X):(Ce=this._encodePrimitive(ne.tag,q),Le=!0);var ze;if(!ne.any&&ne.choice===null){var Xe=ne.implicit!==null?ne.implicit:ne.tag,He=ne.implicit===null?"universal":"context";Xe===null?ne.use===null&&X.error("Tag could be omitted only for .use()"):ne.use===null&&(ze=this._encodeComposite(Xe,Le,He,Ce))}return ne.explicit!==null&&(ze=this._encodeComposite(ne.explicit,!1,"context",ze)),ze},b.prototype._encodeChoice=function(q,X){var te=this._baseState,ne=te.choice[q.type];return ne||a(!1,q.type+" not found in "+JSON.stringify(Object.keys(te.choice))),ne._encode(q.value,X)},b.prototype._encodePrimitive=function(q,X){var te=this._baseState;if(/str$/.test(q))return this._encodeStr(X,q);if(q==="objid"&&te.args)return this._encodeObjid(X,te.reverseArgs[0],te.args[1]);if(q==="objid")return this._encodeObjid(X,null,null);if(q==="gentime"||q==="utctime")return this._encodeTime(X,q);if(q==="null_")return this._encodeNull();if(q==="int"||q==="enum")return this._encodeInt(X,te.args&&te.reverseArgs[0]);if(q==="bool")return this._encodeBool(X);if(q==="objDesc")return this._encodeStr(X,q);throw new Error("Unsupported tag: "+q)},b.prototype._isNumstr=function(q){return/^[0-9 ]*$/.test(q)},b.prototype._isPrintstr=function(q){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(q)}}),require_base2=__commonJS2(r=>{var t=r;t.Reporter=require_reporter().Reporter,t.DecoderBuffer=require_buffer().DecoderBuffer,t.EncoderBuffer=require_buffer().EncoderBuffer,t.Node=require_node()}),require_der=__commonJS2(r=>{var t=require_constants();r.tagClass={0:"universal",1:"application",2:"context",3:"private"},r.tagClassByName=t._reverse(r.tagClass),r.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},r.tagByName=t._reverse(r.tag)}),require_constants=__commonJS2(r=>{var t=r;t._reverse=function(s){var o={};return Object.keys(s).forEach(function(a){(a|0)==a&&(a=a|0);var c=s[a];o[c]=a}),o},t.der=require_der()}),require_der2=__commonJS2((r,t)=>{var n=require_inherits(),s=require_asn1(),o=s.base,a=s.bignum,c=s.constants.der;function f(L){this.enc="der",this.name=L.name,this.entity=L,this.tree=new g,this.tree._init(L.body)}t.exports=f,f.prototype.decode=function(q,X){return q instanceof o.DecoderBuffer||(q=new o.DecoderBuffer(q,X)),this.tree._decode(q,X)};function g(L){o.Node.call(this,"der",L)}n(g,o.Node),g.prototype._peekTag=function(q,X,te){if(q.isEmpty())return!1;var ne=q.save(),Ce=b(q,'Failed to peek tag: "'+X+'"');return q.isError(Ce)?Ce:(q.restore(ne),Ce.tag===X||Ce.tagStr===X||Ce.tagStr+"of"===X||te)},g.prototype._decodeTag=function(q,X,te){var ne=b(q,'Failed to decode tag of "'+X+'"');if(q.isError(ne))return ne;var Ce=_(q,ne.primitive,'Failed to get length of "'+X+'"');if(q.isError(Ce))return Ce;if(!te&&ne.tag!==X&&ne.tagStr!==X&&ne.tagStr+"of"!==X)return q.error('Failed to match tag: "'+X+'"');if(ne.primitive||Ce!==null)return q.skip(Ce,'Failed to match body of: "'+X+'"');var Le=q.save(),Ge=this._skipUntilEnd(q,'Failed to skip indefinite length body: "'+this.tag+'"');return q.isError(Ge)?Ge:(Ce=q.offset-Le.offset,q.restore(Le),q.skip(Ce,'Failed to match body of: "'+X+'"'))},g.prototype._skipUntilEnd=function(q,X){for(;;){var te=b(q,X);if(q.isError(te))return te;var ne=_(q,te.primitive,X);if(q.isError(ne))return ne;var Ce;if(te.primitive||ne!==null?Ce=q.skip(ne):Ce=this._skipUntilEnd(q,X),q.isError(Ce))return Ce;if(te.tagStr==="end")break}},g.prototype._decodeList=function(q,X,te,ne){for(var Ce=[];!q.isEmpty();){var Le=this._peekTag(q,"end");if(q.isError(Le))return Le;var Ge=te.decode(q,"der",ne);if(q.isError(Ge)&&Le)break;Ce.push(Ge)}return Ce},g.prototype._decodeStr=function(q,X){if(X==="bitstr"){var te=q.readUInt8();return q.isError(te)?te:{unused:te,data:q.raw()}}else if(X==="bmpstr"){var ne=q.raw();if(ne.length%2===1)return q.error("Decoding of string type: bmpstr length mismatch");for(var Ce="",Le=0;Le<ne.length/2;Le++)Ce+=String.fromCharCode(ne.readUInt16BE(Le*2));return Ce}else if(X==="numstr"){var Ge=q.raw().toString("ascii");return this._isNumstr(Ge)?Ge:q.error("Decoding of string type: numstr unsupported characters")}else{if(X==="octstr")return q.raw();if(X==="objDesc")return q.raw();if(X==="printstr"){var ze=q.raw().toString("ascii");return this._isPrintstr(ze)?ze:q.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(X)?q.raw().toString():q.error("Decoding of string type: "+X+" unsupported")}},g.prototype._decodeObjid=function(q,X,te){for(var ne,Ce=[],Le=0;!q.isEmpty();){var Ge=q.readUInt8();Le<<=7,Le|=Ge&127,(Ge&128)===0&&(Ce.push(Le),Le=0)}Ge&128&&Ce.push(Le);var ze=Ce[0]/40|0,Xe=Ce[0]%40;if(te?ne=Ce:ne=[ze,Xe].concat(Ce.slice(1)),X){var He=X[ne.join(" ")];He===void 0&&(He=X[ne.join(".")]),He!==void 0&&(ne=He)}return ne},g.prototype._decodeTime=function(q,X){var te=q.raw().toString();if(X==="gentime")var ne=te.slice(0,4)|0,Ce=te.slice(4,6)|0,Le=te.slice(6,8)|0,Ge=te.slice(8,10)|0,ze=te.slice(10,12)|0,Xe=te.slice(12,14)|0;else if(X==="utctime"){var ne=te.slice(0,2)|0,Ce=te.slice(2,4)|0,Le=te.slice(4,6)|0,Ge=te.slice(6,8)|0,ze=te.slice(8,10)|0,Xe=te.slice(10,12)|0;ne<70?ne=2e3+ne:ne=1900+ne}else return q.error("Decoding "+X+" time is not supported yet");return Date.UTC(ne,Ce-1,Le,Ge,ze,Xe,0)},g.prototype._decodeNull=function(q){return null},g.prototype._decodeBool=function(q){var X=q.readUInt8();return q.isError(X)?X:X!==0},g.prototype._decodeInt=function(q,X){var te=q.raw(),ne=new a(te);return X&&(ne=X[ne.toString(10)]||ne),ne},g.prototype._use=function(q,X){return typeof q=="function"&&(q=q(X)),q._getDecoder("der").tree};function b(L,q){var X=L.readUInt8(q);if(L.isError(X))return X;var te=c.tagClass[X>>6],ne=(X&32)===0;if((X&31)===31){var Ce=X;for(X=0;(Ce&128)===128;){if(Ce=L.readUInt8(q),L.isError(Ce))return Ce;X<<=7,X|=Ce&127}}else X&=31;var Le=c.tag[X];return{cls:te,primitive:ne,tag:X,tagStr:Le}}function _(L,q,X){var te=L.readUInt8(X);if(L.isError(te))return te;if(!q&&te===128)return null;if((te&128)===0)return te;var ne=te&127;if(ne>4)return L.error("length octect is too long");te=0;for(var Ce=0;Ce<ne;Ce++){te<<=8;var Le=L.readUInt8(X);if(L.isError(Le))return Le;te|=Le}return te}}),require_pem=__commonJS2((r,t)=>{var n=require_inherits(),s=(init_buffer(),__toCommonJS(exports_buffer)).Buffer,o=require_der2();function a(c){o.call(this,c),this.enc="pem"}n(a,o),t.exports=a,a.prototype.decode=function(f,g){for(var b=f.toString().split(/[\r\n]+/g),_=g.label.toUpperCase(),L=/^-----(BEGIN|END) ([^-]+)-----$/,q=-1,X=-1,te=0;te<b.length;te++){var ne=b[te].match(L);if(ne!==null&&ne[2]===_)if(q===-1){if(ne[1]!=="BEGIN")break;q=te}else{if(ne[1]!=="END")break;X=te;break}}if(q===-1||X===-1)throw new Error("PEM section not found for: "+_);var Ce=b.slice(q+1,X).join("");Ce.replace(/[^a-z0-9\+\/=]+/gi,"");var Le=new s(Ce,"base64");return o.prototype.decode.call(this,Le,g)}}),require_decoders=__commonJS2(r=>{var t=r;t.der=require_der2(),t.pem=require_pem()}),require_der3=__commonJS2((r,t)=>{var n=require_inherits(),s=(init_buffer(),__toCommonJS(exports_buffer)).Buffer,o=require_asn1(),a=o.base,c=o.constants.der;function f(L){this.enc="der",this.name=L.name,this.entity=L,this.tree=new g,this.tree._init(L.body)}t.exports=f,f.prototype.encode=function(q,X){return this.tree._encode(q,X).join()};function g(L){a.Node.call(this,"der",L)}n(g,a.Node),g.prototype._encodeComposite=function(q,X,te,ne){var Ce=_(q,X,te,this.reporter);if(ne.length<128){var ze=new s(2);return ze[0]=Ce,ze[1]=ne.length,this._createEncoderBuffer([ze,ne])}for(var Le=1,Ge=ne.length;Ge>=256;Ge>>=8)Le++;var ze=new s(2+Le);ze[0]=Ce,ze[1]=128|Le;for(var Ge=1+Le,Xe=ne.length;Xe>0;Ge--,Xe>>=8)ze[Ge]=Xe&255;return this._createEncoderBuffer([ze,ne])},g.prototype._encodeStr=function(q,X){if(X==="bitstr")return this._createEncoderBuffer([q.unused|0,q.data]);if(X==="bmpstr"){for(var te=new s(q.length*2),ne=0;ne<q.length;ne++)te.writeUInt16BE(q.charCodeAt(ne),ne*2);return this._createEncoderBuffer(te)}else return X==="numstr"?this._isNumstr(q)?this._createEncoderBuffer(q):this.reporter.error("Encoding of string type: numstr supports only digits and space"):X==="printstr"?this._isPrintstr(q)?this._createEncoderBuffer(q):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(X)?this._createEncoderBuffer(q):X==="objDesc"?this._createEncoderBuffer(q):this.reporter.error("Encoding of string type: "+X+" unsupported")},g.prototype._encodeObjid=function(q,X,te){if(typeof q=="string"){if(!X)return this.reporter.error("string objid given, but no values map found");if(!X.hasOwnProperty(q))return this.reporter.error("objid not found in values map");q=X[q].split(/[\s\.]+/g);for(var ne=0;ne<q.length;ne++)q[ne]|=0}else if(Array.isArray(q)){q=q.slice();for(var ne=0;ne<q.length;ne++)q[ne]|=0}if(!Array.isArray(q))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(q));if(!te){if(q[1]>=40)return this.reporter.error("Second objid identifier OOB");q.splice(0,2,q[0]*40+q[1])}for(var Ce=0,ne=0;ne<q.length;ne++){var Le=q[ne];for(Ce++;Le>=128;Le>>=7)Ce++}for(var Ge=new s(Ce),ze=Ge.length-1,ne=q.length-1;ne>=0;ne--){var Le=q[ne];for(Ge[ze--]=Le&127;(Le>>=7)>0;)Ge[ze--]=128|Le&127}return this._createEncoderBuffer(Ge)};function b(L){return L<10?"0"+L:L}g.prototype._encodeTime=function(q,X){var te,ne=new Date(q);return X==="gentime"?te=[b(ne.getFullYear()),b(ne.getUTCMonth()+1),b(ne.getUTCDate()),b(ne.getUTCHours()),b(ne.getUTCMinutes()),b(ne.getUTCSeconds()),"Z"].join(""):X==="utctime"?te=[b(ne.getFullYear()%100),b(ne.getUTCMonth()+1),b(ne.getUTCDate()),b(ne.getUTCHours()),b(ne.getUTCMinutes()),b(ne.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+X+" time is not supported yet"),this._encodeStr(te,"octstr")},g.prototype._encodeNull=function(){return this._createEncoderBuffer("")},g.prototype._encodeInt=function(q,X){if(typeof q=="string"){if(!X)return this.reporter.error("String int or enum given, but no values map");if(!X.hasOwnProperty(q))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(q));q=X[q]}if(typeof q!="number"&&!s.isBuffer(q)){var te=q.toArray();!q.sign&&te[0]&128&&te.unshift(0),q=new s(te)}if(s.isBuffer(q)){var ne=q.length;q.length===0&&ne++;var Le=new s(ne);return q.copy(Le),q.length===0&&(Le[0]=0),this._createEncoderBuffer(Le)}if(q<128)return this._createEncoderBuffer(q);if(q<256)return this._createEncoderBuffer([0,q]);for(var ne=1,Ce=q;Ce>=256;Ce>>=8)ne++;for(var Le=new Array(ne),Ce=Le.length-1;Ce>=0;Ce--)Le[Ce]=q&255,q>>=8;return Le[0]&128&&Le.unshift(0),this._createEncoderBuffer(new s(Le))},g.prototype._encodeBool=function(q){return this._createEncoderBuffer(q?255:0)},g.prototype._use=function(q,X){return typeof q=="function"&&(q=q(X)),q._getEncoder("der").tree},g.prototype._skipDefault=function(q,X,te){var ne=this._baseState,Ce;if(ne.default===null)return!1;var Le=q.join();if(ne.defaultBuffer===void 0&&(ne.defaultBuffer=this._encodeValue(ne.default,X,te).join()),Le.length!==ne.defaultBuffer.length)return!1;for(Ce=0;Ce<Le.length;Ce++)if(Le[Ce]!==ne.defaultBuffer[Ce])return!1;return!0};function _(L,q,X,te){var ne;if(L==="seqof"?L="seq":L==="setof"&&(L="set"),c.tagByName.hasOwnProperty(L))ne=c.tagByName[L];else if(typeof L=="number"&&(L|0)===L)ne=L;else return te.error("Unknown tag: "+L);return ne>=31?te.error("Multi-octet tag encoding unsupported"):(q||(ne|=32),ne|=c.tagClassByName[X||"universal"]<<6,ne)}}),require_pem2=__commonJS2((r,t)=>{var n=require_inherits(),s=require_der3();function o(a){s.call(this,a),this.enc="pem"}n(o,s),t.exports=o,o.prototype.encode=function(c,f){for(var g=s.prototype.encode.call(this,c),b=g.toString("base64"),_=["-----BEGIN "+f.label+"-----"],L=0;L<b.length;L+=64)_.push(b.slice(L,L+64));return _.push("-----END "+f.label+"-----"),_.join(`
`)}}),require_encoders=__commonJS2(r=>{var t=r;t.der=require_der3(),t.pem=require_pem2()}),require_asn1=__commonJS2(r=>{var t=r;t.bignum=require_bn3(),t.define=require_api().define,t.base=require_base2(),t.constants=require_constants(),t.decoders=require_decoders(),t.encoders=require_encoders()}),require_certificate=__commonJS2((r,t)=>{var n=require_asn1(),s=n.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),o=n.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),a=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),c=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(a),this.key("subjectPublicKey").bitstr())}),f=n.define("RelativeDistinguishedName",function(){this.setof(o)}),g=n.define("RDNSequence",function(){this.seqof(f)}),b=n.define("Name",function(){this.choice({rdnSequence:this.use(g)})}),_=n.define("Validity",function(){this.seq().obj(this.key("notBefore").use(s),this.key("notAfter").use(s))}),L=n.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),q=n.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(a),this.key("issuer").use(b),this.key("validity").use(_),this.key("subject").use(b),this.key("subjectPublicKeyInfo").use(c),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(L).optional())}),X=n.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(q),this.key("signatureAlgorithm").use(a),this.key("signatureValue").bitstr())});t.exports=X}),require_asn12=__commonJS2(r=>{var t=require_asn1();r.certificate=require_certificate();var n=t.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});r.RSAPrivateKey=n;var s=t.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});r.RSAPublicKey=s;var o=t.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),a=t.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())});r.PublicKey=a;var c=t.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(o),this.key("subjectPrivateKey").octstr())});r.PrivateKey=c;var f=t.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});r.EncryptedPrivateKey=f;var g=t.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});r.DSAPrivateKey=g,r.DSAparam=t.define("DSAparam",function(){this.int()});var b=t.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),_=t.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(b),this.key("publicKey").optional().explicit(1).bitstr())});r.ECPrivateKey=_,r.signature=t.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})}),require_aesid=__commonJS2((r,t)=>{t.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}}),require_hash_base=__commonJS2((r,t)=>{var n=require_safe_buffer().Buffer,s=require_stream().Transform,o=require_inherits();function a(b){s.call(this),this._block=n.allocUnsafe(b),this._blockSize=b,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}o(a,s),a.prototype._transform=function(b,_,L){var q=null;try{this.update(b,_)}catch(X){q=X}L(q)},a.prototype._flush=function(b){var _=null;try{this.push(this.digest())}catch(L){_=L}b(_)};var c=typeof Uint8Array<"u",f=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&ArrayBuffer.isView&&(n.prototype instanceof Uint8Array||n.TYPED_ARRAY_SUPPORT);function g(b,_){if(b instanceof n)return b;if(typeof b=="string")return n.from(b,_);if(f&&ArrayBuffer.isView(b)){if(b.byteLength===0)return n.alloc(0);var L=n.from(b.buffer,b.byteOffset,b.byteLength);if(L.byteLength===b.byteLength)return L}if(c&&b instanceof Uint8Array||n.isBuffer(b)&&b.constructor&&typeof b.constructor.isBuffer=="function"&&b.constructor.isBuffer(b))return n.from(b);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}a.prototype.update=function(b,_){if(this._finalized)throw new Error("Digest already called");b=g(b,_);for(var L=this._block,q=0;this._blockOffset+b.length-q>=this._blockSize;){for(var X=this._blockOffset;X<this._blockSize;)L[X++]=b[q++];this._update(),this._blockOffset=0}for(;q<b.length;)L[this._blockOffset++]=b[q++];for(var te=0,ne=b.length*8;ne>0;++te)this._length[te]+=ne,ne=this._length[te]/4294967296|0,ne>0&&(this._length[te]-=4294967296*ne);return this},a.prototype._update=function(){throw new Error("_update is not implemented")},a.prototype.digest=function(b){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var _=this._digest();b!==void 0&&(_=_.toString(b)),this._block.fill(0),this._blockOffset=0;for(var L=0;L<4;++L)this._length[L]=0;return _},a.prototype._digest=function(){throw new Error("_digest is not implemented")},t.exports=a}),require_md5=__commonJS2((r,t)=>{var n=require_inherits(),s=require_hash_base(),o=require_safe_buffer().Buffer,a=new Array(16);function c(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}n(c,s),c.prototype._update=function(){for(var q=a,X=0;X<16;++X)q[X]=this._block.readInt32LE(X*4);var te=this._a,ne=this._b,Ce=this._c,Le=this._d;te=g(te,ne,Ce,Le,q[0],3614090360,7),Le=g(Le,te,ne,Ce,q[1],3905402710,12),Ce=g(Ce,Le,te,ne,q[2],606105819,17),ne=g(ne,Ce,Le,te,q[3],3250441966,22),te=g(te,ne,Ce,Le,q[4],4118548399,7),Le=g(Le,te,ne,Ce,q[5],1200080426,12),Ce=g(Ce,Le,te,ne,q[6],2821735955,17),ne=g(ne,Ce,Le,te,q[7],4249261313,22),te=g(te,ne,Ce,Le,q[8],1770035416,7),Le=g(Le,te,ne,Ce,q[9],2336552879,12),Ce=g(Ce,Le,te,ne,q[10],4294925233,17),ne=g(ne,Ce,Le,te,q[11],2304563134,22),te=g(te,ne,Ce,Le,q[12],1804603682,7),Le=g(Le,te,ne,Ce,q[13],4254626195,12),Ce=g(Ce,Le,te,ne,q[14],2792965006,17),ne=g(ne,Ce,Le,te,q[15],1236535329,22),te=b(te,ne,Ce,Le,q[1],4129170786,5),Le=b(Le,te,ne,Ce,q[6],3225465664,9),Ce=b(Ce,Le,te,ne,q[11],643717713,14),ne=b(ne,Ce,Le,te,q[0],3921069994,20),te=b(te,ne,Ce,Le,q[5],3593408605,5),Le=b(Le,te,ne,Ce,q[10],38016083,9),Ce=b(Ce,Le,te,ne,q[15],3634488961,14),ne=b(ne,Ce,Le,te,q[4],3889429448,20),te=b(te,ne,Ce,Le,q[9],568446438,5),Le=b(Le,te,ne,Ce,q[14],3275163606,9),Ce=b(Ce,Le,te,ne,q[3],4107603335,14),ne=b(ne,Ce,Le,te,q[8],1163531501,20),te=b(te,ne,Ce,Le,q[13],2850285829,5),Le=b(Le,te,ne,Ce,q[2],4243563512,9),Ce=b(Ce,Le,te,ne,q[7],1735328473,14),ne=b(ne,Ce,Le,te,q[12],2368359562,20),te=_(te,ne,Ce,Le,q[5],4294588738,4),Le=_(Le,te,ne,Ce,q[8],2272392833,11),Ce=_(Ce,Le,te,ne,q[11],1839030562,16),ne=_(ne,Ce,Le,te,q[14],4259657740,23),te=_(te,ne,Ce,Le,q[1],2763975236,4),Le=_(Le,te,ne,Ce,q[4],1272893353,11),Ce=_(Ce,Le,te,ne,q[7],4139469664,16),ne=_(ne,Ce,Le,te,q[10],3200236656,23),te=_(te,ne,Ce,Le,q[13],681279174,4),Le=_(Le,te,ne,Ce,q[0],3936430074,11),Ce=_(Ce,Le,te,ne,q[3],3572445317,16),ne=_(ne,Ce,Le,te,q[6],76029189,23),te=_(te,ne,Ce,Le,q[9],3654602809,4),Le=_(Le,te,ne,Ce,q[12],3873151461,11),Ce=_(Ce,Le,te,ne,q[15],530742520,16),ne=_(ne,Ce,Le,te,q[2],3299628645,23),te=L(te,ne,Ce,Le,q[0],4096336452,6),Le=L(Le,te,ne,Ce,q[7],1126891415,10),Ce=L(Ce,Le,te,ne,q[14],2878612391,15),ne=L(ne,Ce,Le,te,q[5],4237533241,21),te=L(te,ne,Ce,Le,q[12],1700485571,6),Le=L(Le,te,ne,Ce,q[3],2399980690,10),Ce=L(Ce,Le,te,ne,q[10],4293915773,15),ne=L(ne,Ce,Le,te,q[1],2240044497,21),te=L(te,ne,Ce,Le,q[8],1873313359,6),Le=L(Le,te,ne,Ce,q[15],4264355552,10),Ce=L(Ce,Le,te,ne,q[6],2734768916,15),ne=L(ne,Ce,Le,te,q[13],1309151649,21),te=L(te,ne,Ce,Le,q[4],4149444226,6),Le=L(Le,te,ne,Ce,q[11],3174756917,10),Ce=L(Ce,Le,te,ne,q[2],718787259,15),ne=L(ne,Ce,Le,te,q[9],3951481745,21),this._a=this._a+te|0,this._b=this._b+ne|0,this._c=this._c+Ce|0,this._d=this._d+Le|0},c.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var q=o.allocUnsafe(16);return q.writeInt32LE(this._a,0),q.writeInt32LE(this._b,4),q.writeInt32LE(this._c,8),q.writeInt32LE(this._d,12),q};function f(q,X){return q<<X|q>>>32-X}function g(q,X,te,ne,Ce,Le,Ge){return f(q+(X&te|~X&ne)+Ce+Le|0,Ge)+X|0}function b(q,X,te,ne,Ce,Le,Ge){return f(q+(X&ne|te&~ne)+Ce+Le|0,Ge)+X|0}function _(q,X,te,ne,Ce,Le,Ge){return f(q+(X^te^ne)+Ce+Le|0,Ge)+X|0}function L(q,X,te,ne,Ce,Le,Ge){return f(q+(te^(X|~ne))+Ce+Le|0,Ge)+X|0}t.exports=c}),require_evp_bytestokey=__commonJS2((r,t)=>{var n=require_safe_buffer().Buffer,s=require_md5();function o(a,c,f,g){if(n.isBuffer(a)||(a=n.from(a,"binary")),c&&(n.isBuffer(c)||(c=n.from(c,"binary")),c.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var b=f/8,_=n.alloc(b),L=n.alloc(g||0),q=n.alloc(0);b>0||g>0;){var X=new s;X.update(q),X.update(a),c&&X.update(c),q=X.digest();var te=0;if(b>0){var ne=_.length-b;te=Math.min(b,q.length),q.copy(_,ne,0,te),b-=te}if(te<q.length&&g>0){var Ce=L.length-g,Le=Math.min(g,q.length-te);q.copy(L,Ce,te,te+Le),g-=Le}}return q.fill(0),{key:_,iv:L}}t.exports=o}),require_browserify_aes=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto));r.createCipher=r.Cipher=t.createCipher,r.createCipheriv=r.Cipheriv=t.createCipheriv,r.createDecipher=r.Decipher=t.createDecipher,r.createDecipheriv=r.Decipheriv=t.createDecipheriv,r.listCiphers=r.getCiphers=t.getCiphers}),require_fixProc=__commonJS2((r,t)=>{var n=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,s=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,o=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,a=require_evp_bytestokey(),c=require_browserify_aes(),f=require_safe_buffer().Buffer;t.exports=function(g,b){var _=g.toString(),L=_.match(n),q;if(L){var te="aes"+L[1],ne=f.from(L[2],"hex"),Ce=f.from(L[3].replace(/[\r\n]/g,""),"base64"),Le=a(b,ne.slice(0,8),parseInt(L[1],10)).key,Ge=[],ze=c.createDecipheriv(te,Le,ne);Ge.push(ze.update(Ce)),Ge.push(ze.final()),q=f.concat(Ge)}else{var X=_.match(o);q=f.from(X[2].replace(/[\r\n]/g,""),"base64")}var Xe=_.match(s)[1];return{tag:Xe,data:q}}}),require_parse_asn1=__commonJS2((r,t)=>{var n=require_asn12(),s=require_aesid(),o=require_fixProc(),a=require_browserify_aes(),c=require_pbkdf2(),f=require_safe_buffer().Buffer;function g(_,L){var q=_.algorithm.decrypt.kde.kdeparams.salt,X=parseInt(_.algorithm.decrypt.kde.kdeparams.iters.toString(),10),te=s[_.algorithm.decrypt.cipher.algo.join(".")],ne=_.algorithm.decrypt.cipher.iv,Ce=_.subjectPrivateKey,Le=parseInt(te.split("-")[1],10)/8,Ge=c.pbkdf2Sync(L,q,X,Le,"sha1"),ze=a.createDecipheriv(te,Ge,ne),Xe=[];return Xe.push(ze.update(Ce)),Xe.push(ze.final()),f.concat(Xe)}function b(_){var L;typeof _=="object"&&!f.isBuffer(_)&&(L=_.passphrase,_=_.key),typeof _=="string"&&(_=f.from(_));var q=o(_,L),X=q.tag,te=q.data,ne,Ce;switch(X){case"CERTIFICATE":Ce=n.certificate.decode(te,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(Ce||(Ce=n.PublicKey.decode(te,"der")),ne=Ce.algorithm.algorithm.join("."),ne){case"1.2.840.113549.1.1.1":return n.RSAPublicKey.decode(Ce.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return Ce.subjectPrivateKey=Ce.subjectPublicKey,{type:"ec",data:Ce};case"1.2.840.10040.4.1":return Ce.algorithm.params.pub_key=n.DSAparam.decode(Ce.subjectPublicKey.data,"der"),{type:"dsa",data:Ce.algorithm.params};default:throw new Error("unknown key id "+ne)}case"ENCRYPTED PRIVATE KEY":te=n.EncryptedPrivateKey.decode(te,"der"),te=g(te,L);case"PRIVATE KEY":switch(Ce=n.PrivateKey.decode(te,"der"),ne=Ce.algorithm.algorithm.join("."),ne){case"1.2.840.113549.1.1.1":return n.RSAPrivateKey.decode(Ce.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:Ce.algorithm.curve,privateKey:n.ECPrivateKey.decode(Ce.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return Ce.algorithm.params.priv_key=n.DSAparam.decode(Ce.subjectPrivateKey,"der"),{type:"dsa",params:Ce.algorithm.params};default:throw new Error("unknown key id "+ne)}case"RSA PUBLIC KEY":return n.RSAPublicKey.decode(te,"der");case"RSA PRIVATE KEY":return n.RSAPrivateKey.decode(te,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:n.DSAPrivateKey.decode(te,"der")};case"EC PRIVATE KEY":return te=n.ECPrivateKey.decode(te,"der"),{curve:te.parameters.value,privateKey:te.privateKey};default:throw new Error("unknown key type "+X)}}b.signature=n.signature,t.exports=b}),require_mgf=__commonJS2((r,t)=>{var n=require_create_hash(),s=require_safe_buffer().Buffer;t.exports=function(a,c){for(var f=s.alloc(0),g=0,b;f.length<c;)b=o(g++),f=s.concat([f,n("sha1").update(a).update(b).digest()]);return f.slice(0,c)};function o(a){var c=s.allocUnsafe(4);return c.writeUInt32BE(a,0),c}}),require_xor=__commonJS2((r,t)=>{t.exports=function(s,o){for(var a=s.length,c=-1;++c<a;)s[c]^=o[c];return s}}),require_bn4=__commonJS2((r,t)=>{(function(n,s){function o(se,m){if(!se)throw new Error(m||"Assertion failed")}function a(se,m){se.super_=m;var A=function(){};A.prototype=m.prototype,se.prototype=new A,se.prototype.constructor=se}function c(se,m,A){if(c.isBN(se))return se;this.negative=0,this.words=null,this.length=0,this.red=null,se!==null&&((m==="le"||m==="be")&&(A=m,m=10),this._init(se||0,m||10,A||"be"))}typeof n=="object"?n.exports=c:s.BN=c,c.BN=c,c.wordSize=26;var f;try{typeof window<"u"&&typeof window.Buffer<"u"?f=window.Buffer:f=(init_buffer(),__toCommonJS(exports_buffer)).Buffer}catch{}c.isBN=function(m){return m instanceof c?!0:m!==null&&typeof m=="object"&&m.constructor.wordSize===c.wordSize&&Array.isArray(m.words)},c.max=function(m,A){return m.cmp(A)>0?m:A},c.min=function(m,A){return m.cmp(A)<0?m:A},c.prototype._init=function(m,A,k){if(typeof m=="number")return this._initNumber(m,A,k);if(typeof m=="object")return this._initArray(m,A,k);A==="hex"&&(A=16),o(A===(A|0)&&A>=2&&A<=36),m=m.toString().replace(/\s+/g,"");var Y=0;m[0]==="-"&&(Y++,this.negative=1),Y<m.length&&(A===16?this._parseHex(m,Y,k):(this._parseBase(m,A,Y),k==="le"&&this._initArray(this.toArray(),A,k)))},c.prototype._initNumber=function(m,A,k){m<0&&(this.negative=1,m=-m),m<67108864?(this.words=[m&67108863],this.length=1):m<4503599627370496?(this.words=[m&67108863,m/67108864&67108863],this.length=2):(o(m<9007199254740992),this.words=[m&67108863,m/67108864&67108863,1],this.length=3),k==="le"&&this._initArray(this.toArray(),A,k)},c.prototype._initArray=function(m,A,k){if(o(typeof m.length=="number"),m.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(m.length/3),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q,$e,ve=0;if(k==="be")for(Y=m.length-1,Q=0;Y>=0;Y-=3)$e=m[Y]|m[Y-1]<<8|m[Y-2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);else if(k==="le")for(Y=0,Q=0;Y<m.length;Y+=3)$e=m[Y]|m[Y+1]<<8|m[Y+2]<<16,this.words[Q]|=$e<<ve&67108863,this.words[Q+1]=$e>>>26-ve&67108863,ve+=24,ve>=26&&(ve-=26,Q++);return this.strip()};function g(se,m){var A=se.charCodeAt(m);return A>=65&&A<=70?A-55:A>=97&&A<=102?A-87:A-48&15}function b(se,m,A){var k=g(se,A);return A-1>=m&&(k|=g(se,A-1)<<4),k}c.prototype._parseHex=function(m,A,k){this.length=Math.ceil((m.length-A)/6),this.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)this.words[Y]=0;var Q=0,$e=0,ve;if(k==="be")for(Y=m.length-1;Y>=A;Y-=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8;else{var re=m.length-A;for(Y=re%2===0?A+1:A;Y<m.length;Y+=2)ve=b(m,A,Y)<<Q,this.words[$e]|=ve&67108863,Q>=18?(Q-=18,$e+=1,this.words[$e]|=ve>>>26):Q+=8}this.strip()};function _(se,m,A,k){for(var Y=0,Q=Math.min(se.length,A),$e=m;$e<Q;$e++){var ve=se.charCodeAt($e)-48;Y*=k,ve>=49?Y+=ve-49+10:ve>=17?Y+=ve-17+10:Y+=ve}return Y}c.prototype._parseBase=function(m,A,k){this.words=[0],this.length=1;for(var Y=0,Q=1;Q<=67108863;Q*=A)Y++;Y--,Q=Q/A|0;for(var $e=m.length-k,ve=$e%Y,re=Math.min($e,$e-ve)+k,B=0,oe=k;oe<re;oe+=Y)B=_(m,oe,oe+Y,A),this.imuln(Q),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B);if(ve!==0){var Ue=1;for(B=_(m,oe,m.length,A),oe=0;oe<ve;oe++)Ue*=A;this.imuln(Ue),this.words[0]+B<67108864?this.words[0]+=B:this._iaddn(B)}this.strip()},c.prototype.copy=function(m){m.words=new Array(this.length);for(var A=0;A<this.length;A++)m.words[A]=this.words[A];m.length=this.length,m.negative=this.negative,m.red=this.red},c.prototype.clone=function(){var m=new c(null);return this.copy(m),m},c.prototype._expand=function(m){for(;this.length<m;)this.words[this.length++]=0;return this},c.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},c.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var L=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],q=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],X=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(m,A){m=m||10,A=A|0||1;var k;if(m===16||m==="hex"){k="";for(var Y=0,Q=0,$e=0;$e<this.length;$e++){var ve=this.words[$e],re=((ve<<Y|Q)&16777215).toString(16);Q=ve>>>24-Y&16777215,Y+=2,Y>=26&&(Y-=26,$e--),Q!==0||$e!==this.length-1?k=L[6-re.length]+re+k:k=re+k}for(Q!==0&&(k=Q.toString(16)+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}if(m===(m|0)&&m>=2&&m<=36){var B=q[m],oe=X[m];k="";var Ue=this.clone();for(Ue.negative=0;!Ue.isZero();){var Ze=Ue.modn(oe).toString(m);Ue=Ue.idivn(oe),Ue.isZero()?k=Ze+k:k=L[B-Ze.length]+Ze+k}for(this.isZero()&&(k="0"+k);k.length%A!==0;)k="0"+k;return this.negative!==0&&(k="-"+k),k}o(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var m=this.words[0];return this.length===2?m+=this.words[1]*67108864:this.length===3&&this.words[2]===1?m+=4503599627370496+this.words[1]*67108864:this.length>2&&o(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-m:m},c.prototype.toJSON=function(){return this.toString(16)},c.prototype.toBuffer=function(m,A){return o(typeof f<"u"),this.toArrayLike(f,m,A)},c.prototype.toArray=function(m,A){return this.toArrayLike(Array,m,A)},c.prototype.toArrayLike=function(m,A,k){var Y=this.byteLength(),Q=k||Math.max(1,Y);o(Y<=Q,"byte array longer than desired length"),o(Q>0,"Requested array length <= 0"),this.strip();var $e=A==="le",ve=new m(Q),re,B,oe=this.clone();if($e){for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[B]=re;for(;B<Q;B++)ve[B]=0}else{for(B=0;B<Q-Y;B++)ve[B]=0;for(B=0;!oe.isZero();B++)re=oe.andln(255),oe.iushrn(8),ve[Q-B-1]=re}return ve},Math.clz32?c.prototype._countBits=function(m){return 32-Math.clz32(m)}:c.prototype._countBits=function(m){var A=m,k=0;return A>=4096&&(k+=13,A>>>=13),A>=64&&(k+=7,A>>>=7),A>=8&&(k+=4,A>>>=4),A>=2&&(k+=2,A>>>=2),k+A},c.prototype._zeroBits=function(m){if(m===0)return 26;var A=m,k=0;return(A&8191)===0&&(k+=13,A>>>=13),(A&127)===0&&(k+=7,A>>>=7),(A&15)===0&&(k+=4,A>>>=4),(A&3)===0&&(k+=2,A>>>=2),(A&1)===0&&k++,k},c.prototype.bitLength=function(){var m=this.words[this.length-1],A=this._countBits(m);return(this.length-1)*26+A};function te(se){for(var m=new Array(se.bitLength()),A=0;A<m.length;A++){var k=A/26|0,Y=A%26;m[A]=(se.words[k]&1<<Y)>>>Y}return m}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var m=0,A=0;A<this.length;A++){var k=this._zeroBits(this.words[A]);if(m+=k,k!==26)break}return m},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(m){return this.negative!==0?this.abs().inotn(m).iaddn(1):this.clone()},c.prototype.fromTwos=function(m){return this.testn(m-1)?this.notn(m).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(m){for(;this.length<m.length;)this.words[this.length++]=0;for(var A=0;A<m.length;A++)this.words[A]=this.words[A]|m.words[A];return this.strip()},c.prototype.ior=function(m){return o((this.negative|m.negative)===0),this.iuor(m)},c.prototype.or=function(m){return this.length>m.length?this.clone().ior(m):m.clone().ior(this)},c.prototype.uor=function(m){return this.length>m.length?this.clone().iuor(m):m.clone().iuor(this)},c.prototype.iuand=function(m){var A;this.length>m.length?A=m:A=this;for(var k=0;k<A.length;k++)this.words[k]=this.words[k]&m.words[k];return this.length=A.length,this.strip()},c.prototype.iand=function(m){return o((this.negative|m.negative)===0),this.iuand(m)},c.prototype.and=function(m){return this.length>m.length?this.clone().iand(m):m.clone().iand(this)},c.prototype.uand=function(m){return this.length>m.length?this.clone().iuand(m):m.clone().iuand(this)},c.prototype.iuxor=function(m){var A,k;this.length>m.length?(A=this,k=m):(A=m,k=this);for(var Y=0;Y<k.length;Y++)this.words[Y]=A.words[Y]^k.words[Y];if(this!==A)for(;Y<A.length;Y++)this.words[Y]=A.words[Y];return this.length=A.length,this.strip()},c.prototype.ixor=function(m){return o((this.negative|m.negative)===0),this.iuxor(m)},c.prototype.xor=function(m){return this.length>m.length?this.clone().ixor(m):m.clone().ixor(this)},c.prototype.uxor=function(m){return this.length>m.length?this.clone().iuxor(m):m.clone().iuxor(this)},c.prototype.inotn=function(m){o(typeof m=="number"&&m>=0);var A=Math.ceil(m/26)|0,k=m%26;this._expand(A),k>0&&A--;for(var Y=0;Y<A;Y++)this.words[Y]=~this.words[Y]&67108863;return k>0&&(this.words[Y]=~this.words[Y]&67108863>>26-k),this.strip()},c.prototype.notn=function(m){return this.clone().inotn(m)},c.prototype.setn=function(m,A){o(typeof m=="number"&&m>=0);var k=m/26|0,Y=m%26;return this._expand(k+1),A?this.words[k]=this.words[k]|1<<Y:this.words[k]=this.words[k]&~(1<<Y),this.strip()},c.prototype.iadd=function(m){var A;if(this.negative!==0&&m.negative===0)return this.negative=0,A=this.isub(m),this.negative^=1,this._normSign();if(this.negative===0&&m.negative!==0)return m.negative=0,A=this.isub(m),m.negative=1,A._normSign();var k,Y;this.length>m.length?(k=this,Y=m):(k=m,Y=this);for(var Q=0,$e=0;$e<Y.length;$e++)A=(k.words[$e]|0)+(Y.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;for(;Q!==0&&$e<k.length;$e++)A=(k.words[$e]|0)+Q,this.words[$e]=A&67108863,Q=A>>>26;if(this.length=k.length,Q!==0)this.words[this.length]=Q,this.length++;else if(k!==this)for(;$e<k.length;$e++)this.words[$e]=k.words[$e];return this},c.prototype.add=function(m){var A;return m.negative!==0&&this.negative===0?(m.negative=0,A=this.sub(m),m.negative^=1,A):m.negative===0&&this.negative!==0?(this.negative=0,A=m.sub(this),this.negative=1,A):this.length>m.length?this.clone().iadd(m):m.clone().iadd(this)},c.prototype.isub=function(m){if(m.negative!==0){m.negative=0;var A=this.iadd(m);return m.negative=1,A._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(m),this.negative=1,this._normSign();var k=this.cmp(m);if(k===0)return this.negative=0,this.length=1,this.words[0]=0,this;var Y,Q;k>0?(Y=this,Q=m):(Y=m,Q=this);for(var $e=0,ve=0;ve<Q.length;ve++)A=(Y.words[ve]|0)-(Q.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;for(;$e!==0&&ve<Y.length;ve++)A=(Y.words[ve]|0)+$e,$e=A>>26,this.words[ve]=A&67108863;if($e===0&&ve<Y.length&&Y!==this)for(;ve<Y.length;ve++)this.words[ve]=Y.words[ve];return this.length=Math.max(this.length,ve),Y!==this&&(this.negative=1),this.strip()},c.prototype.sub=function(m){return this.clone().isub(m)};function ne(se,m,A){A.negative=m.negative^se.negative;var k=se.length+m.length|0;A.length=k,k=k-1|0;var Y=se.words[0]|0,Q=m.words[0]|0,$e=Y*Q,ve=$e&67108863,re=$e/67108864|0;A.words[0]=ve;for(var B=1;B<k;B++){for(var oe=re>>>26,Ue=re&67108863,Ze=Math.min(B,m.length-1),lt=Math.max(0,B-se.length+1);lt<=Ze;lt++){var St=B-lt|0;Y=se.words[St]|0,Q=m.words[lt]|0,$e=Y*Q+Ue,oe+=$e/67108864|0,Ue=$e&67108863}A.words[B]=Ue|0,re=oe|0}return re!==0?A.words[B]=re|0:A.length--,A.strip()}var Ce=function(m,A,k){var Y=m.words,Q=A.words,$e=k.words,ve=0,re,B,oe,Ue=Y[0]|0,Ze=Ue&8191,lt=Ue>>>13,St=Y[1]|0,Mt=St&8191,Ft=St>>>13,Zt=Y[2]|0,Ut=Zt&8191,vr=Zt>>>13,zr=Y[3]|0,or=zr&8191,sr=zr>>>13,er=Y[4]|0,Xt=er&8191,nr=er>>>13,Fr=Y[5]|0,Ar=Fr&8191,qr=Fr>>>13,dn=Y[6]|0,Mr=dn&8191,gr=dn>>>13,en=Y[7]|0,ur=en&8191,ar=en>>>13,Nr=Y[8]|0,Yt=Nr&8191,Ir=Nr>>>13,Qe=Y[9]|0,nt=Qe&8191,_t=Qe>>>13,Bt=Q[0]|0,Jt=Bt&8191,xt=Bt>>>13,mr=Q[1]|0,xr=mr&8191,wr=mr>>>13,nn=Q[2]|0,Cr=nn&8191,Zr=nn>>>13,pn=Q[3]|0,yr=pn&8191,Tr=pn>>>13,Br=Q[4]|0,Jr=Br&8191,rn=Br>>>13,dr=Q[5]|0,ir=dr&8191,Er=dr>>>13,an=Q[6]|0,Rr=an&8191,Ur=an>>>13,cr=Q[7]|0,Sr=cr&8191,Lr=cr>>>13,Qr=Q[8]|0,tn=Qr&8191,hn=Qr>>>13,gn=Q[9]|0,on=gn&8191,cn=gn>>>13;k.negative=m.negative^A.negative,k.length=19,re=Math.imul(Ze,Jt),B=Math.imul(Ze,xt),B=B+Math.imul(lt,Jt)|0,oe=Math.imul(lt,xt);var vn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(vn>>>26)|0,vn&=67108863,re=Math.imul(Mt,Jt),B=Math.imul(Mt,xt),B=B+Math.imul(Ft,Jt)|0,oe=Math.imul(Ft,xt),re=re+Math.imul(Ze,xr)|0,B=B+Math.imul(Ze,wr)|0,B=B+Math.imul(lt,xr)|0,oe=oe+Math.imul(lt,wr)|0;var _n=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(_n>>>26)|0,_n&=67108863,re=Math.imul(Ut,Jt),B=Math.imul(Ut,xt),B=B+Math.imul(vr,Jt)|0,oe=Math.imul(vr,xt),re=re+Math.imul(Mt,xr)|0,B=B+Math.imul(Mt,wr)|0,B=B+Math.imul(Ft,xr)|0,oe=oe+Math.imul(Ft,wr)|0,re=re+Math.imul(Ze,Cr)|0,B=B+Math.imul(Ze,Zr)|0,B=B+Math.imul(lt,Cr)|0,oe=oe+Math.imul(lt,Zr)|0;var Mn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Mn>>>26)|0,Mn&=67108863,re=Math.imul(or,Jt),B=Math.imul(or,xt),B=B+Math.imul(sr,Jt)|0,oe=Math.imul(sr,xt),re=re+Math.imul(Ut,xr)|0,B=B+Math.imul(Ut,wr)|0,B=B+Math.imul(vr,xr)|0,oe=oe+Math.imul(vr,wr)|0,re=re+Math.imul(Mt,Cr)|0,B=B+Math.imul(Mt,Zr)|0,B=B+Math.imul(Ft,Cr)|0,oe=oe+Math.imul(Ft,Zr)|0,re=re+Math.imul(Ze,yr)|0,B=B+Math.imul(Ze,Tr)|0,B=B+Math.imul(lt,yr)|0,oe=oe+Math.imul(lt,Tr)|0;var xn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(xn>>>26)|0,xn&=67108863,re=Math.imul(Xt,Jt),B=Math.imul(Xt,xt),B=B+Math.imul(nr,Jt)|0,oe=Math.imul(nr,xt),re=re+Math.imul(or,xr)|0,B=B+Math.imul(or,wr)|0,B=B+Math.imul(sr,xr)|0,oe=oe+Math.imul(sr,wr)|0,re=re+Math.imul(Ut,Cr)|0,B=B+Math.imul(Ut,Zr)|0,B=B+Math.imul(vr,Cr)|0,oe=oe+Math.imul(vr,Zr)|0,re=re+Math.imul(Mt,yr)|0,B=B+Math.imul(Mt,Tr)|0,B=B+Math.imul(Ft,yr)|0,oe=oe+Math.imul(Ft,Tr)|0,re=re+Math.imul(Ze,Jr)|0,B=B+Math.imul(Ze,rn)|0,B=B+Math.imul(lt,Jr)|0,oe=oe+Math.imul(lt,rn)|0;var Nn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,re=Math.imul(Ar,Jt),B=Math.imul(Ar,xt),B=B+Math.imul(qr,Jt)|0,oe=Math.imul(qr,xt),re=re+Math.imul(Xt,xr)|0,B=B+Math.imul(Xt,wr)|0,B=B+Math.imul(nr,xr)|0,oe=oe+Math.imul(nr,wr)|0,re=re+Math.imul(or,Cr)|0,B=B+Math.imul(or,Zr)|0,B=B+Math.imul(sr,Cr)|0,oe=oe+Math.imul(sr,Zr)|0,re=re+Math.imul(Ut,yr)|0,B=B+Math.imul(Ut,Tr)|0,B=B+Math.imul(vr,yr)|0,oe=oe+Math.imul(vr,Tr)|0,re=re+Math.imul(Mt,Jr)|0,B=B+Math.imul(Mt,rn)|0,B=B+Math.imul(Ft,Jr)|0,oe=oe+Math.imul(Ft,rn)|0,re=re+Math.imul(Ze,ir)|0,B=B+Math.imul(Ze,Er)|0,B=B+Math.imul(lt,ir)|0,oe=oe+Math.imul(lt,Er)|0;var zn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(zn>>>26)|0,zn&=67108863,re=Math.imul(Mr,Jt),B=Math.imul(Mr,xt),B=B+Math.imul(gr,Jt)|0,oe=Math.imul(gr,xt),re=re+Math.imul(Ar,xr)|0,B=B+Math.imul(Ar,wr)|0,B=B+Math.imul(qr,xr)|0,oe=oe+Math.imul(qr,wr)|0,re=re+Math.imul(Xt,Cr)|0,B=B+Math.imul(Xt,Zr)|0,B=B+Math.imul(nr,Cr)|0,oe=oe+Math.imul(nr,Zr)|0,re=re+Math.imul(or,yr)|0,B=B+Math.imul(or,Tr)|0,B=B+Math.imul(sr,yr)|0,oe=oe+Math.imul(sr,Tr)|0,re=re+Math.imul(Ut,Jr)|0,B=B+Math.imul(Ut,rn)|0,B=B+Math.imul(vr,Jr)|0,oe=oe+Math.imul(vr,rn)|0,re=re+Math.imul(Mt,ir)|0,B=B+Math.imul(Mt,Er)|0,B=B+Math.imul(Ft,ir)|0,oe=oe+Math.imul(Ft,Er)|0,re=re+Math.imul(Ze,Rr)|0,B=B+Math.imul(Ze,Ur)|0,B=B+Math.imul(lt,Rr)|0,oe=oe+Math.imul(lt,Ur)|0;var An=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(An>>>26)|0,An&=67108863,re=Math.imul(ur,Jt),B=Math.imul(ur,xt),B=B+Math.imul(ar,Jt)|0,oe=Math.imul(ar,xt),re=re+Math.imul(Mr,xr)|0,B=B+Math.imul(Mr,wr)|0,B=B+Math.imul(gr,xr)|0,oe=oe+Math.imul(gr,wr)|0,re=re+Math.imul(Ar,Cr)|0,B=B+Math.imul(Ar,Zr)|0,B=B+Math.imul(qr,Cr)|0,oe=oe+Math.imul(qr,Zr)|0,re=re+Math.imul(Xt,yr)|0,B=B+Math.imul(Xt,Tr)|0,B=B+Math.imul(nr,yr)|0,oe=oe+Math.imul(nr,Tr)|0,re=re+Math.imul(or,Jr)|0,B=B+Math.imul(or,rn)|0,B=B+Math.imul(sr,Jr)|0,oe=oe+Math.imul(sr,rn)|0,re=re+Math.imul(Ut,ir)|0,B=B+Math.imul(Ut,Er)|0,B=B+Math.imul(vr,ir)|0,oe=oe+Math.imul(vr,Er)|0,re=re+Math.imul(Mt,Rr)|0,B=B+Math.imul(Mt,Ur)|0,B=B+Math.imul(Ft,Rr)|0,oe=oe+Math.imul(Ft,Ur)|0,re=re+Math.imul(Ze,Sr)|0,B=B+Math.imul(Ze,Lr)|0,B=B+Math.imul(lt,Sr)|0,oe=oe+Math.imul(lt,Lr)|0;var Bn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,re=Math.imul(Yt,Jt),B=Math.imul(Yt,xt),B=B+Math.imul(Ir,Jt)|0,oe=Math.imul(Ir,xt),re=re+Math.imul(ur,xr)|0,B=B+Math.imul(ur,wr)|0,B=B+Math.imul(ar,xr)|0,oe=oe+Math.imul(ar,wr)|0,re=re+Math.imul(Mr,Cr)|0,B=B+Math.imul(Mr,Zr)|0,B=B+Math.imul(gr,Cr)|0,oe=oe+Math.imul(gr,Zr)|0,re=re+Math.imul(Ar,yr)|0,B=B+Math.imul(Ar,Tr)|0,B=B+Math.imul(qr,yr)|0,oe=oe+Math.imul(qr,Tr)|0,re=re+Math.imul(Xt,Jr)|0,B=B+Math.imul(Xt,rn)|0,B=B+Math.imul(nr,Jr)|0,oe=oe+Math.imul(nr,rn)|0,re=re+Math.imul(or,ir)|0,B=B+Math.imul(or,Er)|0,B=B+Math.imul(sr,ir)|0,oe=oe+Math.imul(sr,Er)|0,re=re+Math.imul(Ut,Rr)|0,B=B+Math.imul(Ut,Ur)|0,B=B+Math.imul(vr,Rr)|0,oe=oe+Math.imul(vr,Ur)|0,re=re+Math.imul(Mt,Sr)|0,B=B+Math.imul(Mt,Lr)|0,B=B+Math.imul(Ft,Sr)|0,oe=oe+Math.imul(Ft,Lr)|0,re=re+Math.imul(Ze,tn)|0,B=B+Math.imul(Ze,hn)|0,B=B+Math.imul(lt,tn)|0,oe=oe+Math.imul(lt,hn)|0;var Dn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,re=Math.imul(nt,Jt),B=Math.imul(nt,xt),B=B+Math.imul(_t,Jt)|0,oe=Math.imul(_t,xt),re=re+Math.imul(Yt,xr)|0,B=B+Math.imul(Yt,wr)|0,B=B+Math.imul(Ir,xr)|0,oe=oe+Math.imul(Ir,wr)|0,re=re+Math.imul(ur,Cr)|0,B=B+Math.imul(ur,Zr)|0,B=B+Math.imul(ar,Cr)|0,oe=oe+Math.imul(ar,Zr)|0,re=re+Math.imul(Mr,yr)|0,B=B+Math.imul(Mr,Tr)|0,B=B+Math.imul(gr,yr)|0,oe=oe+Math.imul(gr,Tr)|0,re=re+Math.imul(Ar,Jr)|0,B=B+Math.imul(Ar,rn)|0,B=B+Math.imul(qr,Jr)|0,oe=oe+Math.imul(qr,rn)|0,re=re+Math.imul(Xt,ir)|0,B=B+Math.imul(Xt,Er)|0,B=B+Math.imul(nr,ir)|0,oe=oe+Math.imul(nr,Er)|0,re=re+Math.imul(or,Rr)|0,B=B+Math.imul(or,Ur)|0,B=B+Math.imul(sr,Rr)|0,oe=oe+Math.imul(sr,Ur)|0,re=re+Math.imul(Ut,Sr)|0,B=B+Math.imul(Ut,Lr)|0,B=B+Math.imul(vr,Sr)|0,oe=oe+Math.imul(vr,Lr)|0,re=re+Math.imul(Mt,tn)|0,B=B+Math.imul(Mt,hn)|0,B=B+Math.imul(Ft,tn)|0,oe=oe+Math.imul(Ft,hn)|0,re=re+Math.imul(Ze,on)|0,B=B+Math.imul(Ze,cn)|0,B=B+Math.imul(lt,on)|0,oe=oe+Math.imul(lt,cn)|0;var Hn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Hn>>>26)|0,Hn&=67108863,re=Math.imul(nt,xr),B=Math.imul(nt,wr),B=B+Math.imul(_t,xr)|0,oe=Math.imul(_t,wr),re=re+Math.imul(Yt,Cr)|0,B=B+Math.imul(Yt,Zr)|0,B=B+Math.imul(Ir,Cr)|0,oe=oe+Math.imul(Ir,Zr)|0,re=re+Math.imul(ur,yr)|0,B=B+Math.imul(ur,Tr)|0,B=B+Math.imul(ar,yr)|0,oe=oe+Math.imul(ar,Tr)|0,re=re+Math.imul(Mr,Jr)|0,B=B+Math.imul(Mr,rn)|0,B=B+Math.imul(gr,Jr)|0,oe=oe+Math.imul(gr,rn)|0,re=re+Math.imul(Ar,ir)|0,B=B+Math.imul(Ar,Er)|0,B=B+Math.imul(qr,ir)|0,oe=oe+Math.imul(qr,Er)|0,re=re+Math.imul(Xt,Rr)|0,B=B+Math.imul(Xt,Ur)|0,B=B+Math.imul(nr,Rr)|0,oe=oe+Math.imul(nr,Ur)|0,re=re+Math.imul(or,Sr)|0,B=B+Math.imul(or,Lr)|0,B=B+Math.imul(sr,Sr)|0,oe=oe+Math.imul(sr,Lr)|0,re=re+Math.imul(Ut,tn)|0,B=B+Math.imul(Ut,hn)|0,B=B+Math.imul(vr,tn)|0,oe=oe+Math.imul(vr,hn)|0,re=re+Math.imul(Mt,on)|0,B=B+Math.imul(Mt,cn)|0,B=B+Math.imul(Ft,on)|0,oe=oe+Math.imul(Ft,cn)|0;var On=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(On>>>26)|0,On&=67108863,re=Math.imul(nt,Cr),B=Math.imul(nt,Zr),B=B+Math.imul(_t,Cr)|0,oe=Math.imul(_t,Zr),re=re+Math.imul(Yt,yr)|0,B=B+Math.imul(Yt,Tr)|0,B=B+Math.imul(Ir,yr)|0,oe=oe+Math.imul(Ir,Tr)|0,re=re+Math.imul(ur,Jr)|0,B=B+Math.imul(ur,rn)|0,B=B+Math.imul(ar,Jr)|0,oe=oe+Math.imul(ar,rn)|0,re=re+Math.imul(Mr,ir)|0,B=B+Math.imul(Mr,Er)|0,B=B+Math.imul(gr,ir)|0,oe=oe+Math.imul(gr,Er)|0,re=re+Math.imul(Ar,Rr)|0,B=B+Math.imul(Ar,Ur)|0,B=B+Math.imul(qr,Rr)|0,oe=oe+Math.imul(qr,Ur)|0,re=re+Math.imul(Xt,Sr)|0,B=B+Math.imul(Xt,Lr)|0,B=B+Math.imul(nr,Sr)|0,oe=oe+Math.imul(nr,Lr)|0,re=re+Math.imul(or,tn)|0,B=B+Math.imul(or,hn)|0,B=B+Math.imul(sr,tn)|0,oe=oe+Math.imul(sr,hn)|0,re=re+Math.imul(Ut,on)|0,B=B+Math.imul(Ut,cn)|0,B=B+Math.imul(vr,on)|0,oe=oe+Math.imul(vr,cn)|0;var Rn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,re=Math.imul(nt,yr),B=Math.imul(nt,Tr),B=B+Math.imul(_t,yr)|0,oe=Math.imul(_t,Tr),re=re+Math.imul(Yt,Jr)|0,B=B+Math.imul(Yt,rn)|0,B=B+Math.imul(Ir,Jr)|0,oe=oe+Math.imul(Ir,rn)|0,re=re+Math.imul(ur,ir)|0,B=B+Math.imul(ur,Er)|0,B=B+Math.imul(ar,ir)|0,oe=oe+Math.imul(ar,Er)|0,re=re+Math.imul(Mr,Rr)|0,B=B+Math.imul(Mr,Ur)|0,B=B+Math.imul(gr,Rr)|0,oe=oe+Math.imul(gr,Ur)|0,re=re+Math.imul(Ar,Sr)|0,B=B+Math.imul(Ar,Lr)|0,B=B+Math.imul(qr,Sr)|0,oe=oe+Math.imul(qr,Lr)|0,re=re+Math.imul(Xt,tn)|0,B=B+Math.imul(Xt,hn)|0,B=B+Math.imul(nr,tn)|0,oe=oe+Math.imul(nr,hn)|0,re=re+Math.imul(or,on)|0,B=B+Math.imul(or,cn)|0,B=B+Math.imul(sr,on)|0,oe=oe+Math.imul(sr,cn)|0;var qn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(qn>>>26)|0,qn&=67108863,re=Math.imul(nt,Jr),B=Math.imul(nt,rn),B=B+Math.imul(_t,Jr)|0,oe=Math.imul(_t,rn),re=re+Math.imul(Yt,ir)|0,B=B+Math.imul(Yt,Er)|0,B=B+Math.imul(Ir,ir)|0,oe=oe+Math.imul(Ir,Er)|0,re=re+Math.imul(ur,Rr)|0,B=B+Math.imul(ur,Ur)|0,B=B+Math.imul(ar,Rr)|0,oe=oe+Math.imul(ar,Ur)|0,re=re+Math.imul(Mr,Sr)|0,B=B+Math.imul(Mr,Lr)|0,B=B+Math.imul(gr,Sr)|0,oe=oe+Math.imul(gr,Lr)|0,re=re+Math.imul(Ar,tn)|0,B=B+Math.imul(Ar,hn)|0,B=B+Math.imul(qr,tn)|0,oe=oe+Math.imul(qr,hn)|0,re=re+Math.imul(Xt,on)|0,B=B+Math.imul(Xt,cn)|0,B=B+Math.imul(nr,on)|0,oe=oe+Math.imul(nr,cn)|0;var In=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(In>>>26)|0,In&=67108863,re=Math.imul(nt,ir),B=Math.imul(nt,Er),B=B+Math.imul(_t,ir)|0,oe=Math.imul(_t,Er),re=re+Math.imul(Yt,Rr)|0,B=B+Math.imul(Yt,Ur)|0,B=B+Math.imul(Ir,Rr)|0,oe=oe+Math.imul(Ir,Ur)|0,re=re+Math.imul(ur,Sr)|0,B=B+Math.imul(ur,Lr)|0,B=B+Math.imul(ar,Sr)|0,oe=oe+Math.imul(ar,Lr)|0,re=re+Math.imul(Mr,tn)|0,B=B+Math.imul(Mr,hn)|0,B=B+Math.imul(gr,tn)|0,oe=oe+Math.imul(gr,hn)|0,re=re+Math.imul(Ar,on)|0,B=B+Math.imul(Ar,cn)|0,B=B+Math.imul(qr,on)|0,oe=oe+Math.imul(qr,cn)|0;var Pn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Pn>>>26)|0,Pn&=67108863,re=Math.imul(nt,Rr),B=Math.imul(nt,Ur),B=B+Math.imul(_t,Rr)|0,oe=Math.imul(_t,Ur),re=re+Math.imul(Yt,Sr)|0,B=B+Math.imul(Yt,Lr)|0,B=B+Math.imul(Ir,Sr)|0,oe=oe+Math.imul(Ir,Lr)|0,re=re+Math.imul(ur,tn)|0,B=B+Math.imul(ur,hn)|0,B=B+Math.imul(ar,tn)|0,oe=oe+Math.imul(ar,hn)|0,re=re+Math.imul(Mr,on)|0,B=B+Math.imul(Mr,cn)|0,B=B+Math.imul(gr,on)|0,oe=oe+Math.imul(gr,cn)|0;var Cn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Cn>>>26)|0,Cn&=67108863,re=Math.imul(nt,Sr),B=Math.imul(nt,Lr),B=B+Math.imul(_t,Sr)|0,oe=Math.imul(_t,Lr),re=re+Math.imul(Yt,tn)|0,B=B+Math.imul(Yt,hn)|0,B=B+Math.imul(Ir,tn)|0,oe=oe+Math.imul(Ir,hn)|0,re=re+Math.imul(ur,on)|0,B=B+Math.imul(ur,cn)|0,B=B+Math.imul(ar,on)|0,oe=oe+Math.imul(ar,cn)|0;var Fn=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,re=Math.imul(nt,tn),B=Math.imul(nt,hn),B=B+Math.imul(_t,tn)|0,oe=Math.imul(_t,hn),re=re+Math.imul(Yt,on)|0,B=B+Math.imul(Yt,cn)|0,B=B+Math.imul(Ir,on)|0,oe=oe+Math.imul(Ir,cn)|0;var Ln=(ve+re|0)+((B&8191)<<13)|0;ve=(oe+(B>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,re=Math.imul(nt,on),B=Math.imul(nt,cn),B=B+Math.imul(_t,on)|0,oe=Math.imul(_t,cn);var Un=(ve+re|0)+((B&8191)<<13)|0;return ve=(oe+(B>>>13)|0)+(Un>>>26)|0,Un&=67108863,$e[0]=vn,$e[1]=_n,$e[2]=Mn,$e[3]=xn,$e[4]=Nn,$e[5]=zn,$e[6]=An,$e[7]=Bn,$e[8]=Dn,$e[9]=Hn,$e[10]=On,$e[11]=Rn,$e[12]=qn,$e[13]=In,$e[14]=Pn,$e[15]=Cn,$e[16]=Fn,$e[17]=Ln,$e[18]=Un,ve!==0&&($e[19]=ve,k.length++),k};Math.imul||(Ce=ne);function Le(se,m,A){A.negative=m.negative^se.negative,A.length=se.length+m.length;for(var k=0,Y=0,Q=0;Q<A.length-1;Q++){var $e=Y;Y=0;for(var ve=k&67108863,re=Math.min(Q,m.length-1),B=Math.max(0,Q-se.length+1);B<=re;B++){var oe=Q-B,Ue=se.words[oe]|0,Ze=m.words[B]|0,lt=Ue*Ze,St=lt&67108863;$e=$e+(lt/67108864|0)|0,St=St+ve|0,ve=St&67108863,$e=$e+(St>>>26)|0,Y+=$e>>>26,$e&=67108863}A.words[Q]=ve,k=$e,$e=Y}return k!==0?A.words[Q]=k:A.length--,A.strip()}function Ge(se,m,A){var k=new ze;return k.mulp(se,m,A)}c.prototype.mulTo=function(m,A){var k,Y=this.length+m.length;return this.length===10&&m.length===10?k=Ce(this,m,A):Y<63?k=ne(this,m,A):Y<1024?k=Le(this,m,A):k=Ge(this,m,A),k};function ze(se,m){this.x=se,this.y=m}ze.prototype.makeRBT=function(m){for(var A=new Array(m),k=c.prototype._countBits(m)-1,Y=0;Y<m;Y++)A[Y]=this.revBin(Y,k,m);return A},ze.prototype.revBin=function(m,A,k){if(m===0||m===k-1)return m;for(var Y=0,Q=0;Q<A;Q++)Y|=(m&1)<<A-Q-1,m>>=1;return Y},ze.prototype.permute=function(m,A,k,Y,Q,$e){for(var ve=0;ve<$e;ve++)Y[ve]=A[m[ve]],Q[ve]=k[m[ve]]},ze.prototype.transform=function(m,A,k,Y,Q,$e){this.permute($e,m,A,k,Y,Q);for(var ve=1;ve<Q;ve<<=1)for(var re=ve<<1,B=Math.cos(2*Math.PI/re),oe=Math.sin(2*Math.PI/re),Ue=0;Ue<Q;Ue+=re)for(var Ze=B,lt=oe,St=0;St<ve;St++){var Mt=k[Ue+St],Ft=Y[Ue+St],Zt=k[Ue+St+ve],Ut=Y[Ue+St+ve],vr=Ze*Zt-lt*Ut;Ut=Ze*Ut+lt*Zt,Zt=vr,k[Ue+St]=Mt+Zt,Y[Ue+St]=Ft+Ut,k[Ue+St+ve]=Mt-Zt,Y[Ue+St+ve]=Ft-Ut,St!==re&&(vr=B*Ze-oe*lt,lt=B*lt+oe*Ze,Ze=vr)}},ze.prototype.guessLen13b=function(m,A){var k=Math.max(A,m)|1,Y=k&1,Q=0;for(k=k/2|0;k;k=k>>>1)Q++;return 1<<Q+1+Y},ze.prototype.conjugate=function(m,A,k){if(!(k<=1))for(var Y=0;Y<k/2;Y++){var Q=m[Y];m[Y]=m[k-Y-1],m[k-Y-1]=Q,Q=A[Y],A[Y]=-A[k-Y-1],A[k-Y-1]=-Q}},ze.prototype.normalize13b=function(m,A){for(var k=0,Y=0;Y<A/2;Y++){var Q=Math.round(m[2*Y+1]/A)*8192+Math.round(m[2*Y]/A)+k;m[Y]=Q&67108863,Q<67108864?k=0:k=Q/67108864|0}return m},ze.prototype.convert13b=function(m,A,k,Y){for(var Q=0,$e=0;$e<A;$e++)Q=Q+(m[$e]|0),k[2*$e]=Q&8191,Q=Q>>>13,k[2*$e+1]=Q&8191,Q=Q>>>13;for($e=2*A;$e<Y;++$e)k[$e]=0;o(Q===0),o((Q&-8192)===0)},ze.prototype.stub=function(m){for(var A=new Array(m),k=0;k<m;k++)A[k]=0;return A},ze.prototype.mulp=function(m,A,k){var Y=2*this.guessLen13b(m.length,A.length),Q=this.makeRBT(Y),$e=this.stub(Y),ve=new Array(Y),re=new Array(Y),B=new Array(Y),oe=new Array(Y),Ue=new Array(Y),Ze=new Array(Y),lt=k.words;lt.length=Y,this.convert13b(m.words,m.length,ve,Y),this.convert13b(A.words,A.length,oe,Y),this.transform(ve,$e,re,B,Y,Q),this.transform(oe,$e,Ue,Ze,Y,Q);for(var St=0;St<Y;St++){var Mt=re[St]*Ue[St]-B[St]*Ze[St];B[St]=re[St]*Ze[St]+B[St]*Ue[St],re[St]=Mt}return this.conjugate(re,B,Y),this.transform(re,B,lt,$e,Y,Q),this.conjugate(lt,$e,Y),this.normalize13b(lt,Y),k.negative=m.negative^A.negative,k.length=m.length+A.length,k.strip()},c.prototype.mul=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),this.mulTo(m,A)},c.prototype.mulf=function(m){var A=new c(null);return A.words=new Array(this.length+m.length),Ge(this,m,A)},c.prototype.imul=function(m){return this.clone().mulTo(m,this)},c.prototype.imuln=function(m){o(typeof m=="number"),o(m<67108864);for(var A=0,k=0;k<this.length;k++){var Y=(this.words[k]|0)*m,Q=(Y&67108863)+(A&67108863);A>>=26,A+=Y/67108864|0,A+=Q>>>26,this.words[k]=Q&67108863}return A!==0&&(this.words[k]=A,this.length++),this.length=m===0?1:this.length,this},c.prototype.muln=function(m){return this.clone().imuln(m)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(m){var A=te(m);if(A.length===0)return new c(1);for(var k=this,Y=0;Y<A.length&&A[Y]===0;Y++,k=k.sqr());if(++Y<A.length)for(var Q=k.sqr();Y<A.length;Y++,Q=Q.sqr())A[Y]!==0&&(k=k.mul(Q));return k},c.prototype.iushln=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=67108863>>>26-A<<26-A,Q;if(A!==0){var $e=0;for(Q=0;Q<this.length;Q++){var ve=this.words[Q]&Y,re=(this.words[Q]|0)-ve<<A;this.words[Q]=re|$e,$e=ve>>>26-A}$e&&(this.words[Q]=$e,this.length++)}if(k!==0){for(Q=this.length-1;Q>=0;Q--)this.words[Q+k]=this.words[Q];for(Q=0;Q<k;Q++)this.words[Q]=0;this.length+=k}return this.strip()},c.prototype.ishln=function(m){return o(this.negative===0),this.iushln(m)},c.prototype.iushrn=function(m,A,k){o(typeof m=="number"&&m>=0);var Y;A?Y=(A-A%26)/26:Y=0;var Q=m%26,$e=Math.min((m-Q)/26,this.length),ve=67108863^67108863>>>Q<<Q,re=k;if(Y-=$e,Y=Math.max(0,Y),re){for(var B=0;B<$e;B++)re.words[B]=this.words[B];re.length=$e}if($e!==0)if(this.length>$e)for(this.length-=$e,B=0;B<this.length;B++)this.words[B]=this.words[B+$e];else this.words[0]=0,this.length=1;var oe=0;for(B=this.length-1;B>=0&&(oe!==0||B>=Y);B--){var Ue=this.words[B]|0;this.words[B]=oe<<26-Q|Ue>>>Q,oe=Ue&ve}return re&&oe!==0&&(re.words[re.length++]=oe),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},c.prototype.ishrn=function(m,A,k){return o(this.negative===0),this.iushrn(m,A,k)},c.prototype.shln=function(m){return this.clone().ishln(m)},c.prototype.ushln=function(m){return this.clone().iushln(m)},c.prototype.shrn=function(m){return this.clone().ishrn(m)},c.prototype.ushrn=function(m){return this.clone().iushrn(m)},c.prototype.testn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return!1;var Q=this.words[k];return!!(Q&Y)},c.prototype.imaskn=function(m){o(typeof m=="number"&&m>=0);var A=m%26,k=(m-A)/26;if(o(this.negative===0,"imaskn works only with positive numbers"),this.length<=k)return this;if(A!==0&&k++,this.length=Math.min(k,this.length),A!==0){var Y=67108863^67108863>>>A<<A;this.words[this.length-1]&=Y}return this.strip()},c.prototype.maskn=function(m){return this.clone().imaskn(m)},c.prototype.iaddn=function(m){return o(typeof m=="number"),o(m<67108864),m<0?this.isubn(-m):this.negative!==0?this.length===1&&(this.words[0]|0)<m?(this.words[0]=m-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(m),this.negative=1,this):this._iaddn(m)},c.prototype._iaddn=function(m){this.words[0]+=m;for(var A=0;A<this.length&&this.words[A]>=67108864;A++)this.words[A]-=67108864,A===this.length-1?this.words[A+1]=1:this.words[A+1]++;return this.length=Math.max(this.length,A+1),this},c.prototype.isubn=function(m){if(o(typeof m=="number"),o(m<67108864),m<0)return this.iaddn(-m);if(this.negative!==0)return this.negative=0,this.iaddn(m),this.negative=1,this;if(this.words[0]-=m,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var A=0;A<this.length&&this.words[A]<0;A++)this.words[A]+=67108864,this.words[A+1]-=1;return this.strip()},c.prototype.addn=function(m){return this.clone().iaddn(m)},c.prototype.subn=function(m){return this.clone().isubn(m)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(m,A,k){var Y=m.length+k,Q;this._expand(Y);var $e,ve=0;for(Q=0;Q<m.length;Q++){$e=(this.words[Q+k]|0)+ve;var re=(m.words[Q]|0)*A;$e-=re&67108863,ve=($e>>26)-(re/67108864|0),this.words[Q+k]=$e&67108863}for(;Q<this.length-k;Q++)$e=(this.words[Q+k]|0)+ve,ve=$e>>26,this.words[Q+k]=$e&67108863;if(ve===0)return this.strip();for(o(ve===-1),ve=0,Q=0;Q<this.length;Q++)$e=-(this.words[Q]|0)+ve,ve=$e>>26,this.words[Q]=$e&67108863;return this.negative=1,this.strip()},c.prototype._wordDiv=function(m,A){var k=this.length-m.length,Y=this.clone(),Q=m,$e=Q.words[Q.length-1]|0,ve=this._countBits($e);k=26-ve,k!==0&&(Q=Q.ushln(k),Y.iushln(k),$e=Q.words[Q.length-1]|0);var re=Y.length-Q.length,B;if(A!=="mod"){B=new c(null),B.length=re+1,B.words=new Array(B.length);for(var oe=0;oe<B.length;oe++)B.words[oe]=0}var Ue=Y.clone()._ishlnsubmul(Q,1,re);Ue.negative===0&&(Y=Ue,B&&(B.words[re]=1));for(var Ze=re-1;Ze>=0;Ze--){var lt=(Y.words[Q.length+Ze]|0)*67108864+(Y.words[Q.length+Ze-1]|0);for(lt=Math.min(lt/$e|0,67108863),Y._ishlnsubmul(Q,lt,Ze);Y.negative!==0;)lt--,Y.negative=0,Y._ishlnsubmul(Q,1,Ze),!Y.isZero()&&(Y.negative^=1);B&&(B.words[Ze]=lt)}return B&&B.strip(),Y.strip(),A!=="div"&&k!==0&&Y.iushrn(k),{div:B||null,mod:Y}},c.prototype.divmod=function(m,A,k){if(o(!m.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var Y,Q,$e;return this.negative!==0&&m.negative===0?($e=this.neg().divmod(m,A),A!=="mod"&&(Y=$e.div.neg()),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.iadd(m)),{div:Y,mod:Q}):this.negative===0&&m.negative!==0?($e=this.divmod(m.neg(),A),A!=="mod"&&(Y=$e.div.neg()),{div:Y,mod:$e.mod}):(this.negative&m.negative)!==0?($e=this.neg().divmod(m.neg(),A),A!=="div"&&(Q=$e.mod.neg(),k&&Q.negative!==0&&Q.isub(m)),{div:$e.div,mod:Q}):m.length>this.length||this.cmp(m)<0?{div:new c(0),mod:this}:m.length===1?A==="div"?{div:this.divn(m.words[0]),mod:null}:A==="mod"?{div:null,mod:new c(this.modn(m.words[0]))}:{div:this.divn(m.words[0]),mod:new c(this.modn(m.words[0]))}:this._wordDiv(m,A)},c.prototype.div=function(m){return this.divmod(m,"div",!1).div},c.prototype.mod=function(m){return this.divmod(m,"mod",!1).mod},c.prototype.umod=function(m){return this.divmod(m,"mod",!0).mod},c.prototype.divRound=function(m){var A=this.divmod(m);if(A.mod.isZero())return A.div;var k=A.div.negative!==0?A.mod.isub(m):A.mod,Y=m.ushrn(1),Q=m.andln(1),$e=k.cmp(Y);return $e<0||Q===1&&$e===0?A.div:A.div.negative!==0?A.div.isubn(1):A.div.iaddn(1)},c.prototype.modn=function(m){o(m<=67108863);for(var A=67108864%m,k=0,Y=this.length-1;Y>=0;Y--)k=(A*k+(this.words[Y]|0))%m;return k},c.prototype.idivn=function(m){o(m<=67108863);for(var A=0,k=this.length-1;k>=0;k--){var Y=(this.words[k]|0)+A*67108864;this.words[k]=Y/m|0,A=Y%m}return this.strip()},c.prototype.divn=function(m){return this.clone().idivn(m)},c.prototype.egcd=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=new c(0),ve=new c(1),re=0;A.isEven()&&k.isEven();)A.iushrn(1),k.iushrn(1),++re;for(var B=k.clone(),oe=A.clone();!A.isZero();){for(var Ue=0,Ze=1;(A.words[0]&Ze)===0&&Ue<26;++Ue,Ze<<=1);if(Ue>0)for(A.iushrn(Ue);Ue-- >0;)(Y.isOdd()||Q.isOdd())&&(Y.iadd(B),Q.isub(oe)),Y.iushrn(1),Q.iushrn(1);for(var lt=0,St=1;(k.words[0]&St)===0&&lt<26;++lt,St<<=1);if(lt>0)for(k.iushrn(lt);lt-- >0;)($e.isOdd()||ve.isOdd())&&($e.iadd(B),ve.isub(oe)),$e.iushrn(1),ve.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub($e),Q.isub(ve)):(k.isub(A),$e.isub(Y),ve.isub(Q))}return{a:$e,b:ve,gcd:k.iushln(re)}},c.prototype._invmp=function(m){o(m.negative===0),o(!m.isZero());var A=this,k=m.clone();A.negative!==0?A=A.umod(m):A=A.clone();for(var Y=new c(1),Q=new c(0),$e=k.clone();A.cmpn(1)>0&&k.cmpn(1)>0;){for(var ve=0,re=1;(A.words[0]&re)===0&&ve<26;++ve,re<<=1);if(ve>0)for(A.iushrn(ve);ve-- >0;)Y.isOdd()&&Y.iadd($e),Y.iushrn(1);for(var B=0,oe=1;(k.words[0]&oe)===0&&B<26;++B,oe<<=1);if(B>0)for(k.iushrn(B);B-- >0;)Q.isOdd()&&Q.iadd($e),Q.iushrn(1);A.cmp(k)>=0?(A.isub(k),Y.isub(Q)):(k.isub(A),Q.isub(Y))}var Ue;return A.cmpn(1)===0?Ue=Y:Ue=Q,Ue.cmpn(0)<0&&Ue.iadd(m),Ue},c.prototype.gcd=function(m){if(this.isZero())return m.abs();if(m.isZero())return this.abs();var A=this.clone(),k=m.clone();A.negative=0,k.negative=0;for(var Y=0;A.isEven()&&k.isEven();Y++)A.iushrn(1),k.iushrn(1);do{for(;A.isEven();)A.iushrn(1);for(;k.isEven();)k.iushrn(1);var Q=A.cmp(k);if(Q<0){var $e=A;A=k,k=$e}else if(Q===0||k.cmpn(1)===0)break;A.isub(k)}while(!0);return k.iushln(Y)},c.prototype.invm=function(m){return this.egcd(m).a.umod(m)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(m){return this.words[0]&m},c.prototype.bincn=function(m){o(typeof m=="number");var A=m%26,k=(m-A)/26,Y=1<<A;if(this.length<=k)return this._expand(k+1),this.words[k]|=Y,this;for(var Q=Y,$e=k;Q!==0&&$e<this.length;$e++){var ve=this.words[$e]|0;ve+=Q,Q=ve>>>26,ve&=67108863,this.words[$e]=ve}return Q!==0&&(this.words[$e]=Q,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(m){var A=m<0;if(this.negative!==0&&!A)return-1;if(this.negative===0&&A)return 1;this.strip();var k;if(this.length>1)k=1;else{A&&(m=-m),o(m<=67108863,"Number is too big");var Y=this.words[0]|0;k=Y===m?0:Y<m?-1:1}return this.negative!==0?-k|0:k},c.prototype.cmp=function(m){if(this.negative!==0&&m.negative===0)return-1;if(this.negative===0&&m.negative!==0)return 1;var A=this.ucmp(m);return this.negative!==0?-A|0:A},c.prototype.ucmp=function(m){if(this.length>m.length)return 1;if(this.length<m.length)return-1;for(var A=0,k=this.length-1;k>=0;k--){var Y=this.words[k]|0,Q=m.words[k]|0;if(Y!==Q){Y<Q?A=-1:Y>Q&&(A=1);break}}return A},c.prototype.gtn=function(m){return this.cmpn(m)===1},c.prototype.gt=function(m){return this.cmp(m)===1},c.prototype.gten=function(m){return this.cmpn(m)>=0},c.prototype.gte=function(m){return this.cmp(m)>=0},c.prototype.ltn=function(m){return this.cmpn(m)===-1},c.prototype.lt=function(m){return this.cmp(m)===-1},c.prototype.lten=function(m){return this.cmpn(m)<=0},c.prototype.lte=function(m){return this.cmp(m)<=0},c.prototype.eqn=function(m){return this.cmpn(m)===0},c.prototype.eq=function(m){return this.cmp(m)===0},c.red=function(m){return new ht(m)},c.prototype.toRed=function(m){return o(!this.red,"Already a number in reduction context"),o(this.negative===0,"red works only with positives"),m.convertTo(this)._forceRed(m)},c.prototype.fromRed=function(){return o(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(m){return this.red=m,this},c.prototype.forceRed=function(m){return o(!this.red,"Already a number in reduction context"),this._forceRed(m)},c.prototype.redAdd=function(m){return o(this.red,"redAdd works only with red numbers"),this.red.add(this,m)},c.prototype.redIAdd=function(m){return o(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,m)},c.prototype.redSub=function(m){return o(this.red,"redSub works only with red numbers"),this.red.sub(this,m)},c.prototype.redISub=function(m){return o(this.red,"redISub works only with red numbers"),this.red.isub(this,m)},c.prototype.redShl=function(m){return o(this.red,"redShl works only with red numbers"),this.red.shl(this,m)},c.prototype.redMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.mul(this,m)},c.prototype.redIMul=function(m){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,m),this.red.imul(this,m)},c.prototype.redSqr=function(){return o(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return o(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return o(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return o(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return o(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(m){return o(this.red&&!m.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,m)};var Xe={k256:null,p224:null,p192:null,p25519:null};function He(se,m){this.name=se,this.p=new c(m,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}He.prototype._tmp=function(){var m=new c(null);return m.words=new Array(Math.ceil(this.n/13)),m},He.prototype.ireduce=function(m){var A=m,k;do this.split(A,this.tmp),A=this.imulK(A),A=A.iadd(this.tmp),k=A.bitLength();while(k>this.n);var Y=k<this.n?-1:A.ucmp(this.p);return Y===0?(A.words[0]=0,A.length=1):Y>0?A.isub(this.p):A.strip!==void 0?A.strip():A._strip(),A},He.prototype.split=function(m,A){m.iushrn(this.n,0,A)},He.prototype.imulK=function(m){return m.imul(this.k)};function Ve(){He.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(Ve,He),Ve.prototype.split=function(m,A){for(var k=4194303,Y=Math.min(m.length,9),Q=0;Q<Y;Q++)A.words[Q]=m.words[Q];if(A.length=Y,m.length<=9){m.words[0]=0,m.length=1;return}var $e=m.words[9];for(A.words[A.length++]=$e&k,Q=10;Q<m.length;Q++){var ve=m.words[Q]|0;m.words[Q-10]=(ve&k)<<4|$e>>>22,$e=ve}$e>>>=22,m.words[Q-10]=$e,$e===0&&m.length>10?m.length-=10:m.length-=9},Ve.prototype.imulK=function(m){m.words[m.length]=0,m.words[m.length+1]=0,m.length+=2;for(var A=0,k=0;k<m.length;k++){var Y=m.words[k]|0;A+=Y*977,m.words[k]=A&67108863,A=Y*64+(A/67108864|0)}return m.words[m.length-1]===0&&(m.length--,m.words[m.length-1]===0&&m.length--),m};function We(){He.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(We,He);function rt(){He.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(rt,He);function st(){He.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(st,He),st.prototype.imulK=function(m){for(var A=0,k=0;k<m.length;k++){var Y=(m.words[k]|0)*19+A,Q=Y&67108863;Y>>>=26,m.words[k]=Q,A=Y}return A!==0&&(m.words[m.length++]=A),m},c._prime=function(m){if(Xe[m])return Xe[m];var A;if(m==="k256")A=new Ve;else if(m==="p224")A=new We;else if(m==="p192")A=new rt;else if(m==="p25519")A=new st;else throw new Error("Unknown prime "+m);return Xe[m]=A,A};function ht(se){if(typeof se=="string"){var m=c._prime(se);this.m=m.p,this.prime=m}else o(se.gtn(1),"modulus must be greater than 1"),this.m=se,this.prime=null}ht.prototype._verify1=function(m){o(m.negative===0,"red works only with positives"),o(m.red,"red works only with red numbers")},ht.prototype._verify2=function(m,A){o((m.negative|A.negative)===0,"red works only with positives"),o(m.red&&m.red===A.red,"red works only with red numbers")},ht.prototype.imod=function(m){return this.prime?this.prime.ireduce(m)._forceRed(this):m.umod(this.m)._forceRed(this)},ht.prototype.neg=function(m){return m.isZero()?m.clone():this.m.sub(m)._forceRed(this)},ht.prototype.add=function(m,A){this._verify2(m,A);var k=m.add(A);return k.cmp(this.m)>=0&&k.isub(this.m),k._forceRed(this)},ht.prototype.iadd=function(m,A){this._verify2(m,A);var k=m.iadd(A);return k.cmp(this.m)>=0&&k.isub(this.m),k},ht.prototype.sub=function(m,A){this._verify2(m,A);var k=m.sub(A);return k.cmpn(0)<0&&k.iadd(this.m),k._forceRed(this)},ht.prototype.isub=function(m,A){this._verify2(m,A);var k=m.isub(A);return k.cmpn(0)<0&&k.iadd(this.m),k},ht.prototype.shl=function(m,A){return this._verify1(m),this.imod(m.ushln(A))},ht.prototype.imul=function(m,A){return this._verify2(m,A),this.imod(m.imul(A))},ht.prototype.mul=function(m,A){return this._verify2(m,A),this.imod(m.mul(A))},ht.prototype.isqr=function(m){return this.imul(m,m.clone())},ht.prototype.sqr=function(m){return this.mul(m,m)},ht.prototype.sqrt=function(m){if(m.isZero())return m.clone();var A=this.m.andln(3);if(o(A%2===1),A===3){var k=this.m.add(new c(1)).iushrn(2);return this.pow(m,k)}for(var Y=this.m.subn(1),Q=0;!Y.isZero()&&Y.andln(1)===0;)Q++,Y.iushrn(1);o(!Y.isZero());var $e=new c(1).toRed(this),ve=$e.redNeg(),re=this.m.subn(1).iushrn(1),B=this.m.bitLength();for(B=new c(2*B*B).toRed(this);this.pow(B,re).cmp(ve)!==0;)B.redIAdd(ve);for(var oe=this.pow(B,Y),Ue=this.pow(m,Y.addn(1).iushrn(1)),Ze=this.pow(m,Y),lt=Q;Ze.cmp($e)!==0;){for(var St=Ze,Mt=0;St.cmp($e)!==0;Mt++)St=St.redSqr();o(Mt<lt);var Ft=this.pow(oe,new c(1).iushln(lt-Mt-1));Ue=Ue.redMul(Ft),oe=Ft.redSqr(),Ze=Ze.redMul(oe),lt=Mt}return Ue},ht.prototype.invm=function(m){var A=m._invmp(this.m);return A.negative!==0?(A.negative=0,this.imod(A).redNeg()):this.imod(A)},ht.prototype.pow=function(m,A){if(A.isZero())return new c(1).toRed(this);if(A.cmpn(1)===0)return m.clone();var k=4,Y=new Array(1<<k);Y[0]=new c(1).toRed(this),Y[1]=m;for(var Q=2;Q<Y.length;Q++)Y[Q]=this.mul(Y[Q-1],m);var $e=Y[0],ve=0,re=0,B=A.bitLength()%26;for(B===0&&(B=26),Q=A.length-1;Q>=0;Q--){for(var oe=A.words[Q],Ue=B-1;Ue>=0;Ue--){var Ze=oe>>Ue&1;if($e!==Y[0]&&($e=this.sqr($e)),Ze===0&&ve===0){re=0;continue}ve<<=1,ve|=Ze,re++,!(re!==k&&(Q!==0||Ue!==0))&&($e=this.mul($e,Y[ve]),re=0,ve=0)}B=26}return $e},ht.prototype.convertTo=function(m){var A=m.umod(this.m);return A===m?A.clone():A},ht.prototype.convertFrom=function(m){var A=m.clone();return A.red=null,A},c.mont=function(m){return new je(m)};function je(se){ht.call(this,se),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(je,ht),je.prototype.convertTo=function(m){return this.imod(m.ushln(this.shift))},je.prototype.convertFrom=function(m){var A=this.imod(m.mul(this.rinv));return A.red=null,A},je.prototype.imul=function(m,A){if(m.isZero()||A.isZero())return m.words[0]=0,m.length=1,m;var k=m.imul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.mul=function(m,A){if(m.isZero()||A.isZero())return new c(0)._forceRed(this);var k=m.mul(A),Y=k.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Q=k.isub(Y).iushrn(this.shift),$e=Q;return Q.cmp(this.m)>=0?$e=Q.isub(this.m):Q.cmpn(0)<0&&($e=Q.iadd(this.m)),$e._forceRed(this)},je.prototype.invm=function(m){var A=this.imod(m._invmp(this.m).mul(this.r2));return A._forceRed(this)}})(typeof t>"u"||t,r)}),require_withPublic=__commonJS2((r,t)=>{var n=require_bn4(),s=require_safe_buffer().Buffer;function o(a,c){return s.from(a.toRed(n.mont(c.modulus)).redPow(new n(c.publicExponent)).fromRed().toArray())}t.exports=o}),require_bn5=__commonJS2((r,t)=>{(function(n,s){function o(A,k){if(!A)throw new Error(k||"Assertion failed")}function a(A,k){A.super_=k;var Y=function(){};Y.prototype=k.prototype,A.prototype=new Y,A.prototype.constructor=A}function c(A,k,Y){if(c.isBN(A))return A;this.negative=0,this.words=null,this.length=0,this.red=null,A!==null&&((k==="le"||k==="be")&&(Y=k,k=10),this._init(A||0,k||10,Y||"be"))}typeof n=="object"?n.exports=c:s.BN=c,c.BN=c,c.wordSize=26;var f;try{typeof window<"u"&&typeof window.Buffer<"u"?f=window.Buffer:f=(init_buffer(),__toCommonJS(exports_buffer)).Buffer}catch{}c.isBN=function(k){return k instanceof c?!0:k!==null&&typeof k=="object"&&k.constructor.wordSize===c.wordSize&&Array.isArray(k.words)},c.max=function(k,Y){return k.cmp(Y)>0?k:Y},c.min=function(k,Y){return k.cmp(Y)<0?k:Y},c.prototype._init=function(k,Y,Q){if(typeof k=="number")return this._initNumber(k,Y,Q);if(typeof k=="object")return this._initArray(k,Y,Q);Y==="hex"&&(Y=16),o(Y===(Y|0)&&Y>=2&&Y<=36),k=k.toString().replace(/\s+/g,"");var $e=0;k[0]==="-"&&($e++,this.negative=1),$e<k.length&&(Y===16?this._parseHex(k,$e,Q):(this._parseBase(k,Y,$e),Q==="le"&&this._initArray(this.toArray(),Y,Q)))},c.prototype._initNumber=function(k,Y,Q){k<0&&(this.negative=1,k=-k),k<67108864?(this.words=[k&67108863],this.length=1):k<4503599627370496?(this.words=[k&67108863,k/67108864&67108863],this.length=2):(o(k<9007199254740992),this.words=[k&67108863,k/67108864&67108863,1],this.length=3),Q==="le"&&this._initArray(this.toArray(),Y,Q)},c.prototype._initArray=function(k,Y,Q){if(o(typeof k.length=="number"),k.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(k.length/3),this.words=new Array(this.length);for(var $e=0;$e<this.length;$e++)this.words[$e]=0;var ve,re,B=0;if(Q==="be")for($e=k.length-1,ve=0;$e>=0;$e-=3)re=k[$e]|k[$e-1]<<8|k[$e-2]<<16,this.words[ve]|=re<<B&67108863,this.words[ve+1]=re>>>26-B&67108863,B+=24,B>=26&&(B-=26,ve++);else if(Q==="le")for($e=0,ve=0;$e<k.length;$e+=3)re=k[$e]|k[$e+1]<<8|k[$e+2]<<16,this.words[ve]|=re<<B&67108863,this.words[ve+1]=re>>>26-B&67108863,B+=24,B>=26&&(B-=26,ve++);return this._strip()};function g(A,k){var Y=A.charCodeAt(k);if(Y>=48&&Y<=57)return Y-48;if(Y>=65&&Y<=70)return Y-55;if(Y>=97&&Y<=102)return Y-87;o(!1,"Invalid character in "+A)}function b(A,k,Y){var Q=g(A,Y);return Y-1>=k&&(Q|=g(A,Y-1)<<4),Q}c.prototype._parseHex=function(k,Y,Q){this.length=Math.ceil((k.length-Y)/6),this.words=new Array(this.length);for(var $e=0;$e<this.length;$e++)this.words[$e]=0;var ve=0,re=0,B;if(Q==="be")for($e=k.length-1;$e>=Y;$e-=2)B=b(k,Y,$e)<<ve,this.words[re]|=B&67108863,ve>=18?(ve-=18,re+=1,this.words[re]|=B>>>26):ve+=8;else{var oe=k.length-Y;for($e=oe%2===0?Y+1:Y;$e<k.length;$e+=2)B=b(k,Y,$e)<<ve,this.words[re]|=B&67108863,ve>=18?(ve-=18,re+=1,this.words[re]|=B>>>26):ve+=8}this._strip()};function _(A,k,Y,Q){for(var $e=0,ve=0,re=Math.min(A.length,Y),B=k;B<re;B++){var oe=A.charCodeAt(B)-48;$e*=Q,oe>=49?ve=oe-49+10:oe>=17?ve=oe-17+10:ve=oe,o(oe>=0&&ve<Q,"Invalid character"),$e+=ve}return $e}c.prototype._parseBase=function(k,Y,Q){this.words=[0],this.length=1;for(var $e=0,ve=1;ve<=67108863;ve*=Y)$e++;$e--,ve=ve/Y|0;for(var re=k.length-Q,B=re%$e,oe=Math.min(re,re-B)+Q,Ue=0,Ze=Q;Ze<oe;Ze+=$e)Ue=_(k,Ze,Ze+$e,Y),this.imuln(ve),this.words[0]+Ue<67108864?this.words[0]+=Ue:this._iaddn(Ue);if(B!==0){var lt=1;for(Ue=_(k,Ze,k.length,Y),Ze=0;Ze<B;Ze++)lt*=Y;this.imuln(lt),this.words[0]+Ue<67108864?this.words[0]+=Ue:this._iaddn(Ue)}this._strip()},c.prototype.copy=function(k){k.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)k.words[Y]=this.words[Y];k.length=this.length,k.negative=this.negative,k.red=this.red};function L(A,k){A.words=k.words,A.length=k.length,A.negative=k.negative,A.red=k.red}if(c.prototype._move=function(k){L(k,this)},c.prototype.clone=function(){var k=new c(null);return this.copy(k),k},c.prototype._expand=function(k){for(;this.length<k;)this.words[this.length++]=0;return this},c.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},c.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{c.prototype[Symbol.for("nodejs.util.inspect.custom")]=q}catch{c.prototype.inspect=q}else c.prototype.inspect=q;function q(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var X=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],te=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],ne=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];c.prototype.toString=function(k,Y){k=k||10,Y=Y|0||1;var Q;if(k===16||k==="hex"){Q="";for(var $e=0,ve=0,re=0;re<this.length;re++){var B=this.words[re],oe=((B<<$e|ve)&16777215).toString(16);ve=B>>>24-$e&16777215,$e+=2,$e>=26&&($e-=26,re--),ve!==0||re!==this.length-1?Q=X[6-oe.length]+oe+Q:Q=oe+Q}for(ve!==0&&(Q=ve.toString(16)+Q);Q.length%Y!==0;)Q="0"+Q;return this.negative!==0&&(Q="-"+Q),Q}if(k===(k|0)&&k>=2&&k<=36){var Ue=te[k],Ze=ne[k];Q="";var lt=this.clone();for(lt.negative=0;!lt.isZero();){var St=lt.modrn(Ze).toString(k);lt=lt.idivn(Ze),lt.isZero()?Q=St+Q:Q=X[Ue-St.length]+St+Q}for(this.isZero()&&(Q="0"+Q);Q.length%Y!==0;)Q="0"+Q;return this.negative!==0&&(Q="-"+Q),Q}o(!1,"Base should be between 2 and 36")},c.prototype.toNumber=function(){var k=this.words[0];return this.length===2?k+=this.words[1]*67108864:this.length===3&&this.words[2]===1?k+=4503599627370496+this.words[1]*67108864:this.length>2&&o(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-k:k},c.prototype.toJSON=function(){return this.toString(16,2)},f&&(c.prototype.toBuffer=function(k,Y){return this.toArrayLike(f,k,Y)}),c.prototype.toArray=function(k,Y){return this.toArrayLike(Array,k,Y)};var Ce=function(k,Y){return k.allocUnsafe?k.allocUnsafe(Y):new k(Y)};c.prototype.toArrayLike=function(k,Y,Q){this._strip();var $e=this.byteLength(),ve=Q||Math.max(1,$e);o($e<=ve,"byte array longer than desired length"),o(ve>0,"Requested array length <= 0");var re=Ce(k,ve),B=Y==="le"?"LE":"BE";return this["_toArrayLike"+B](re,$e),re},c.prototype._toArrayLikeLE=function(k,Y){for(var Q=0,$e=0,ve=0,re=0;ve<this.length;ve++){var B=this.words[ve]<<re|$e;k[Q++]=B&255,Q<k.length&&(k[Q++]=B>>8&255),Q<k.length&&(k[Q++]=B>>16&255),re===6?(Q<k.length&&(k[Q++]=B>>24&255),$e=0,re=0):($e=B>>>24,re+=2)}if(Q<k.length)for(k[Q++]=$e;Q<k.length;)k[Q++]=0},c.prototype._toArrayLikeBE=function(k,Y){for(var Q=k.length-1,$e=0,ve=0,re=0;ve<this.length;ve++){var B=this.words[ve]<<re|$e;k[Q--]=B&255,Q>=0&&(k[Q--]=B>>8&255),Q>=0&&(k[Q--]=B>>16&255),re===6?(Q>=0&&(k[Q--]=B>>24&255),$e=0,re=0):($e=B>>>24,re+=2)}if(Q>=0)for(k[Q--]=$e;Q>=0;)k[Q--]=0},Math.clz32?c.prototype._countBits=function(k){return 32-Math.clz32(k)}:c.prototype._countBits=function(k){var Y=k,Q=0;return Y>=4096&&(Q+=13,Y>>>=13),Y>=64&&(Q+=7,Y>>>=7),Y>=8&&(Q+=4,Y>>>=4),Y>=2&&(Q+=2,Y>>>=2),Q+Y},c.prototype._zeroBits=function(k){if(k===0)return 26;var Y=k,Q=0;return(Y&8191)===0&&(Q+=13,Y>>>=13),(Y&127)===0&&(Q+=7,Y>>>=7),(Y&15)===0&&(Q+=4,Y>>>=4),(Y&3)===0&&(Q+=2,Y>>>=2),(Y&1)===0&&Q++,Q},c.prototype.bitLength=function(){var k=this.words[this.length-1],Y=this._countBits(k);return(this.length-1)*26+Y};function Le(A){for(var k=new Array(A.bitLength()),Y=0;Y<k.length;Y++){var Q=Y/26|0,$e=Y%26;k[Y]=A.words[Q]>>>$e&1}return k}c.prototype.zeroBits=function(){if(this.isZero())return 0;for(var k=0,Y=0;Y<this.length;Y++){var Q=this._zeroBits(this.words[Y]);if(k+=Q,Q!==26)break}return k},c.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},c.prototype.toTwos=function(k){return this.negative!==0?this.abs().inotn(k).iaddn(1):this.clone()},c.prototype.fromTwos=function(k){return this.testn(k-1)?this.notn(k).iaddn(1).ineg():this.clone()},c.prototype.isNeg=function(){return this.negative!==0},c.prototype.neg=function(){return this.clone().ineg()},c.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},c.prototype.iuor=function(k){for(;this.length<k.length;)this.words[this.length++]=0;for(var Y=0;Y<k.length;Y++)this.words[Y]=this.words[Y]|k.words[Y];return this._strip()},c.prototype.ior=function(k){return o((this.negative|k.negative)===0),this.iuor(k)},c.prototype.or=function(k){return this.length>k.length?this.clone().ior(k):k.clone().ior(this)},c.prototype.uor=function(k){return this.length>k.length?this.clone().iuor(k):k.clone().iuor(this)},c.prototype.iuand=function(k){var Y;this.length>k.length?Y=k:Y=this;for(var Q=0;Q<Y.length;Q++)this.words[Q]=this.words[Q]&k.words[Q];return this.length=Y.length,this._strip()},c.prototype.iand=function(k){return o((this.negative|k.negative)===0),this.iuand(k)},c.prototype.and=function(k){return this.length>k.length?this.clone().iand(k):k.clone().iand(this)},c.prototype.uand=function(k){return this.length>k.length?this.clone().iuand(k):k.clone().iuand(this)},c.prototype.iuxor=function(k){var Y,Q;this.length>k.length?(Y=this,Q=k):(Y=k,Q=this);for(var $e=0;$e<Q.length;$e++)this.words[$e]=Y.words[$e]^Q.words[$e];if(this!==Y)for(;$e<Y.length;$e++)this.words[$e]=Y.words[$e];return this.length=Y.length,this._strip()},c.prototype.ixor=function(k){return o((this.negative|k.negative)===0),this.iuxor(k)},c.prototype.xor=function(k){return this.length>k.length?this.clone().ixor(k):k.clone().ixor(this)},c.prototype.uxor=function(k){return this.length>k.length?this.clone().iuxor(k):k.clone().iuxor(this)},c.prototype.inotn=function(k){o(typeof k=="number"&&k>=0);var Y=Math.ceil(k/26)|0,Q=k%26;this._expand(Y),Q>0&&Y--;for(var $e=0;$e<Y;$e++)this.words[$e]=~this.words[$e]&67108863;return Q>0&&(this.words[$e]=~this.words[$e]&67108863>>26-Q),this._strip()},c.prototype.notn=function(k){return this.clone().inotn(k)},c.prototype.setn=function(k,Y){o(typeof k=="number"&&k>=0);var Q=k/26|0,$e=k%26;return this._expand(Q+1),Y?this.words[Q]=this.words[Q]|1<<$e:this.words[Q]=this.words[Q]&~(1<<$e),this._strip()},c.prototype.iadd=function(k){var Y;if(this.negative!==0&&k.negative===0)return this.negative=0,Y=this.isub(k),this.negative^=1,this._normSign();if(this.negative===0&&k.negative!==0)return k.negative=0,Y=this.isub(k),k.negative=1,Y._normSign();var Q,$e;this.length>k.length?(Q=this,$e=k):(Q=k,$e=this);for(var ve=0,re=0;re<$e.length;re++)Y=(Q.words[re]|0)+($e.words[re]|0)+ve,this.words[re]=Y&67108863,ve=Y>>>26;for(;ve!==0&&re<Q.length;re++)Y=(Q.words[re]|0)+ve,this.words[re]=Y&67108863,ve=Y>>>26;if(this.length=Q.length,ve!==0)this.words[this.length]=ve,this.length++;else if(Q!==this)for(;re<Q.length;re++)this.words[re]=Q.words[re];return this},c.prototype.add=function(k){var Y;return k.negative!==0&&this.negative===0?(k.negative=0,Y=this.sub(k),k.negative^=1,Y):k.negative===0&&this.negative!==0?(this.negative=0,Y=k.sub(this),this.negative=1,Y):this.length>k.length?this.clone().iadd(k):k.clone().iadd(this)},c.prototype.isub=function(k){if(k.negative!==0){k.negative=0;var Y=this.iadd(k);return k.negative=1,Y._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(k),this.negative=1,this._normSign();var Q=this.cmp(k);if(Q===0)return this.negative=0,this.length=1,this.words[0]=0,this;var $e,ve;Q>0?($e=this,ve=k):($e=k,ve=this);for(var re=0,B=0;B<ve.length;B++)Y=($e.words[B]|0)-(ve.words[B]|0)+re,re=Y>>26,this.words[B]=Y&67108863;for(;re!==0&&B<$e.length;B++)Y=($e.words[B]|0)+re,re=Y>>26,this.words[B]=Y&67108863;if(re===0&&B<$e.length&&$e!==this)for(;B<$e.length;B++)this.words[B]=$e.words[B];return this.length=Math.max(this.length,B),$e!==this&&(this.negative=1),this._strip()},c.prototype.sub=function(k){return this.clone().isub(k)};function Ge(A,k,Y){Y.negative=k.negative^A.negative;var Q=A.length+k.length|0;Y.length=Q,Q=Q-1|0;var $e=A.words[0]|0,ve=k.words[0]|0,re=$e*ve,B=re&67108863,oe=re/67108864|0;Y.words[0]=B;for(var Ue=1;Ue<Q;Ue++){for(var Ze=oe>>>26,lt=oe&67108863,St=Math.min(Ue,k.length-1),Mt=Math.max(0,Ue-A.length+1);Mt<=St;Mt++){var Ft=Ue-Mt|0;$e=A.words[Ft]|0,ve=k.words[Mt]|0,re=$e*ve+lt,Ze+=re/67108864|0,lt=re&67108863}Y.words[Ue]=lt|0,oe=Ze|0}return oe!==0?Y.words[Ue]=oe|0:Y.length--,Y._strip()}var ze=function(k,Y,Q){var $e=k.words,ve=Y.words,re=Q.words,B=0,oe,Ue,Ze,lt=$e[0]|0,St=lt&8191,Mt=lt>>>13,Ft=$e[1]|0,Zt=Ft&8191,Ut=Ft>>>13,vr=$e[2]|0,zr=vr&8191,or=vr>>>13,sr=$e[3]|0,er=sr&8191,Xt=sr>>>13,nr=$e[4]|0,Fr=nr&8191,Ar=nr>>>13,qr=$e[5]|0,dn=qr&8191,Mr=qr>>>13,gr=$e[6]|0,en=gr&8191,ur=gr>>>13,ar=$e[7]|0,Nr=ar&8191,Yt=ar>>>13,Ir=$e[8]|0,Qe=Ir&8191,nt=Ir>>>13,_t=$e[9]|0,Bt=_t&8191,Jt=_t>>>13,xt=ve[0]|0,mr=xt&8191,xr=xt>>>13,wr=ve[1]|0,nn=wr&8191,Cr=wr>>>13,Zr=ve[2]|0,pn=Zr&8191,yr=Zr>>>13,Tr=ve[3]|0,Br=Tr&8191,Jr=Tr>>>13,rn=ve[4]|0,dr=rn&8191,ir=rn>>>13,Er=ve[5]|0,an=Er&8191,Rr=Er>>>13,Ur=ve[6]|0,cr=Ur&8191,Sr=Ur>>>13,Lr=ve[7]|0,Qr=Lr&8191,tn=Lr>>>13,hn=ve[8]|0,gn=hn&8191,on=hn>>>13,cn=ve[9]|0,vn=cn&8191,_n=cn>>>13;Q.negative=k.negative^Y.negative,Q.length=19,oe=Math.imul(St,mr),Ue=Math.imul(St,xr),Ue=Ue+Math.imul(Mt,mr)|0,Ze=Math.imul(Mt,xr);var Mn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Mn>>>26)|0,Mn&=67108863,oe=Math.imul(Zt,mr),Ue=Math.imul(Zt,xr),Ue=Ue+Math.imul(Ut,mr)|0,Ze=Math.imul(Ut,xr),oe=oe+Math.imul(St,nn)|0,Ue=Ue+Math.imul(St,Cr)|0,Ue=Ue+Math.imul(Mt,nn)|0,Ze=Ze+Math.imul(Mt,Cr)|0;var xn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(xn>>>26)|0,xn&=67108863,oe=Math.imul(zr,mr),Ue=Math.imul(zr,xr),Ue=Ue+Math.imul(or,mr)|0,Ze=Math.imul(or,xr),oe=oe+Math.imul(Zt,nn)|0,Ue=Ue+Math.imul(Zt,Cr)|0,Ue=Ue+Math.imul(Ut,nn)|0,Ze=Ze+Math.imul(Ut,Cr)|0,oe=oe+Math.imul(St,pn)|0,Ue=Ue+Math.imul(St,yr)|0,Ue=Ue+Math.imul(Mt,pn)|0,Ze=Ze+Math.imul(Mt,yr)|0;var Nn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,oe=Math.imul(er,mr),Ue=Math.imul(er,xr),Ue=Ue+Math.imul(Xt,mr)|0,Ze=Math.imul(Xt,xr),oe=oe+Math.imul(zr,nn)|0,Ue=Ue+Math.imul(zr,Cr)|0,Ue=Ue+Math.imul(or,nn)|0,Ze=Ze+Math.imul(or,Cr)|0,oe=oe+Math.imul(Zt,pn)|0,Ue=Ue+Math.imul(Zt,yr)|0,Ue=Ue+Math.imul(Ut,pn)|0,Ze=Ze+Math.imul(Ut,yr)|0,oe=oe+Math.imul(St,Br)|0,Ue=Ue+Math.imul(St,Jr)|0,Ue=Ue+Math.imul(Mt,Br)|0,Ze=Ze+Math.imul(Mt,Jr)|0;var zn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(zn>>>26)|0,zn&=67108863,oe=Math.imul(Fr,mr),Ue=Math.imul(Fr,xr),Ue=Ue+Math.imul(Ar,mr)|0,Ze=Math.imul(Ar,xr),oe=oe+Math.imul(er,nn)|0,Ue=Ue+Math.imul(er,Cr)|0,Ue=Ue+Math.imul(Xt,nn)|0,Ze=Ze+Math.imul(Xt,Cr)|0,oe=oe+Math.imul(zr,pn)|0,Ue=Ue+Math.imul(zr,yr)|0,Ue=Ue+Math.imul(or,pn)|0,Ze=Ze+Math.imul(or,yr)|0,oe=oe+Math.imul(Zt,Br)|0,Ue=Ue+Math.imul(Zt,Jr)|0,Ue=Ue+Math.imul(Ut,Br)|0,Ze=Ze+Math.imul(Ut,Jr)|0,oe=oe+Math.imul(St,dr)|0,Ue=Ue+Math.imul(St,ir)|0,Ue=Ue+Math.imul(Mt,dr)|0,Ze=Ze+Math.imul(Mt,ir)|0;var An=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(An>>>26)|0,An&=67108863,oe=Math.imul(dn,mr),Ue=Math.imul(dn,xr),Ue=Ue+Math.imul(Mr,mr)|0,Ze=Math.imul(Mr,xr),oe=oe+Math.imul(Fr,nn)|0,Ue=Ue+Math.imul(Fr,Cr)|0,Ue=Ue+Math.imul(Ar,nn)|0,Ze=Ze+Math.imul(Ar,Cr)|0,oe=oe+Math.imul(er,pn)|0,Ue=Ue+Math.imul(er,yr)|0,Ue=Ue+Math.imul(Xt,pn)|0,Ze=Ze+Math.imul(Xt,yr)|0,oe=oe+Math.imul(zr,Br)|0,Ue=Ue+Math.imul(zr,Jr)|0,Ue=Ue+Math.imul(or,Br)|0,Ze=Ze+Math.imul(or,Jr)|0,oe=oe+Math.imul(Zt,dr)|0,Ue=Ue+Math.imul(Zt,ir)|0,Ue=Ue+Math.imul(Ut,dr)|0,Ze=Ze+Math.imul(Ut,ir)|0,oe=oe+Math.imul(St,an)|0,Ue=Ue+Math.imul(St,Rr)|0,Ue=Ue+Math.imul(Mt,an)|0,Ze=Ze+Math.imul(Mt,Rr)|0;var Bn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Bn>>>26)|0,Bn&=67108863,oe=Math.imul(en,mr),Ue=Math.imul(en,xr),Ue=Ue+Math.imul(ur,mr)|0,Ze=Math.imul(ur,xr),oe=oe+Math.imul(dn,nn)|0,Ue=Ue+Math.imul(dn,Cr)|0,Ue=Ue+Math.imul(Mr,nn)|0,Ze=Ze+Math.imul(Mr,Cr)|0,oe=oe+Math.imul(Fr,pn)|0,Ue=Ue+Math.imul(Fr,yr)|0,Ue=Ue+Math.imul(Ar,pn)|0,Ze=Ze+Math.imul(Ar,yr)|0,oe=oe+Math.imul(er,Br)|0,Ue=Ue+Math.imul(er,Jr)|0,Ue=Ue+Math.imul(Xt,Br)|0,Ze=Ze+Math.imul(Xt,Jr)|0,oe=oe+Math.imul(zr,dr)|0,Ue=Ue+Math.imul(zr,ir)|0,Ue=Ue+Math.imul(or,dr)|0,Ze=Ze+Math.imul(or,ir)|0,oe=oe+Math.imul(Zt,an)|0,Ue=Ue+Math.imul(Zt,Rr)|0,Ue=Ue+Math.imul(Ut,an)|0,Ze=Ze+Math.imul(Ut,Rr)|0,oe=oe+Math.imul(St,cr)|0,Ue=Ue+Math.imul(St,Sr)|0,Ue=Ue+Math.imul(Mt,cr)|0,Ze=Ze+Math.imul(Mt,Sr)|0;var Dn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,oe=Math.imul(Nr,mr),Ue=Math.imul(Nr,xr),Ue=Ue+Math.imul(Yt,mr)|0,Ze=Math.imul(Yt,xr),oe=oe+Math.imul(en,nn)|0,Ue=Ue+Math.imul(en,Cr)|0,Ue=Ue+Math.imul(ur,nn)|0,Ze=Ze+Math.imul(ur,Cr)|0,oe=oe+Math.imul(dn,pn)|0,Ue=Ue+Math.imul(dn,yr)|0,Ue=Ue+Math.imul(Mr,pn)|0,Ze=Ze+Math.imul(Mr,yr)|0,oe=oe+Math.imul(Fr,Br)|0,Ue=Ue+Math.imul(Fr,Jr)|0,Ue=Ue+Math.imul(Ar,Br)|0,Ze=Ze+Math.imul(Ar,Jr)|0,oe=oe+Math.imul(er,dr)|0,Ue=Ue+Math.imul(er,ir)|0,Ue=Ue+Math.imul(Xt,dr)|0,Ze=Ze+Math.imul(Xt,ir)|0,oe=oe+Math.imul(zr,an)|0,Ue=Ue+Math.imul(zr,Rr)|0,Ue=Ue+Math.imul(or,an)|0,Ze=Ze+Math.imul(or,Rr)|0,oe=oe+Math.imul(Zt,cr)|0,Ue=Ue+Math.imul(Zt,Sr)|0,Ue=Ue+Math.imul(Ut,cr)|0,Ze=Ze+Math.imul(Ut,Sr)|0,oe=oe+Math.imul(St,Qr)|0,Ue=Ue+Math.imul(St,tn)|0,Ue=Ue+Math.imul(Mt,Qr)|0,Ze=Ze+Math.imul(Mt,tn)|0;var Hn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Hn>>>26)|0,Hn&=67108863,oe=Math.imul(Qe,mr),Ue=Math.imul(Qe,xr),Ue=Ue+Math.imul(nt,mr)|0,Ze=Math.imul(nt,xr),oe=oe+Math.imul(Nr,nn)|0,Ue=Ue+Math.imul(Nr,Cr)|0,Ue=Ue+Math.imul(Yt,nn)|0,Ze=Ze+Math.imul(Yt,Cr)|0,oe=oe+Math.imul(en,pn)|0,Ue=Ue+Math.imul(en,yr)|0,Ue=Ue+Math.imul(ur,pn)|0,Ze=Ze+Math.imul(ur,yr)|0,oe=oe+Math.imul(dn,Br)|0,Ue=Ue+Math.imul(dn,Jr)|0,Ue=Ue+Math.imul(Mr,Br)|0,Ze=Ze+Math.imul(Mr,Jr)|0,oe=oe+Math.imul(Fr,dr)|0,Ue=Ue+Math.imul(Fr,ir)|0,Ue=Ue+Math.imul(Ar,dr)|0,Ze=Ze+Math.imul(Ar,ir)|0,oe=oe+Math.imul(er,an)|0,Ue=Ue+Math.imul(er,Rr)|0,Ue=Ue+Math.imul(Xt,an)|0,Ze=Ze+Math.imul(Xt,Rr)|0,oe=oe+Math.imul(zr,cr)|0,Ue=Ue+Math.imul(zr,Sr)|0,Ue=Ue+Math.imul(or,cr)|0,Ze=Ze+Math.imul(or,Sr)|0,oe=oe+Math.imul(Zt,Qr)|0,Ue=Ue+Math.imul(Zt,tn)|0,Ue=Ue+Math.imul(Ut,Qr)|0,Ze=Ze+Math.imul(Ut,tn)|0,oe=oe+Math.imul(St,gn)|0,Ue=Ue+Math.imul(St,on)|0,Ue=Ue+Math.imul(Mt,gn)|0,Ze=Ze+Math.imul(Mt,on)|0;var On=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(On>>>26)|0,On&=67108863,oe=Math.imul(Bt,mr),Ue=Math.imul(Bt,xr),Ue=Ue+Math.imul(Jt,mr)|0,Ze=Math.imul(Jt,xr),oe=oe+Math.imul(Qe,nn)|0,Ue=Ue+Math.imul(Qe,Cr)|0,Ue=Ue+Math.imul(nt,nn)|0,Ze=Ze+Math.imul(nt,Cr)|0,oe=oe+Math.imul(Nr,pn)|0,Ue=Ue+Math.imul(Nr,yr)|0,Ue=Ue+Math.imul(Yt,pn)|0,Ze=Ze+Math.imul(Yt,yr)|0,oe=oe+Math.imul(en,Br)|0,Ue=Ue+Math.imul(en,Jr)|0,Ue=Ue+Math.imul(ur,Br)|0,Ze=Ze+Math.imul(ur,Jr)|0,oe=oe+Math.imul(dn,dr)|0,Ue=Ue+Math.imul(dn,ir)|0,Ue=Ue+Math.imul(Mr,dr)|0,Ze=Ze+Math.imul(Mr,ir)|0,oe=oe+Math.imul(Fr,an)|0,Ue=Ue+Math.imul(Fr,Rr)|0,Ue=Ue+Math.imul(Ar,an)|0,Ze=Ze+Math.imul(Ar,Rr)|0,oe=oe+Math.imul(er,cr)|0,Ue=Ue+Math.imul(er,Sr)|0,Ue=Ue+Math.imul(Xt,cr)|0,Ze=Ze+Math.imul(Xt,Sr)|0,oe=oe+Math.imul(zr,Qr)|0,Ue=Ue+Math.imul(zr,tn)|0,Ue=Ue+Math.imul(or,Qr)|0,Ze=Ze+Math.imul(or,tn)|0,oe=oe+Math.imul(Zt,gn)|0,Ue=Ue+Math.imul(Zt,on)|0,Ue=Ue+Math.imul(Ut,gn)|0,Ze=Ze+Math.imul(Ut,on)|0,oe=oe+Math.imul(St,vn)|0,Ue=Ue+Math.imul(St,_n)|0,Ue=Ue+Math.imul(Mt,vn)|0,Ze=Ze+Math.imul(Mt,_n)|0;var Rn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Rn>>>26)|0,Rn&=67108863,oe=Math.imul(Bt,nn),Ue=Math.imul(Bt,Cr),Ue=Ue+Math.imul(Jt,nn)|0,Ze=Math.imul(Jt,Cr),oe=oe+Math.imul(Qe,pn)|0,Ue=Ue+Math.imul(Qe,yr)|0,Ue=Ue+Math.imul(nt,pn)|0,Ze=Ze+Math.imul(nt,yr)|0,oe=oe+Math.imul(Nr,Br)|0,Ue=Ue+Math.imul(Nr,Jr)|0,Ue=Ue+Math.imul(Yt,Br)|0,Ze=Ze+Math.imul(Yt,Jr)|0,oe=oe+Math.imul(en,dr)|0,Ue=Ue+Math.imul(en,ir)|0,Ue=Ue+Math.imul(ur,dr)|0,Ze=Ze+Math.imul(ur,ir)|0,oe=oe+Math.imul(dn,an)|0,Ue=Ue+Math.imul(dn,Rr)|0,Ue=Ue+Math.imul(Mr,an)|0,Ze=Ze+Math.imul(Mr,Rr)|0,oe=oe+Math.imul(Fr,cr)|0,Ue=Ue+Math.imul(Fr,Sr)|0,Ue=Ue+Math.imul(Ar,cr)|0,Ze=Ze+Math.imul(Ar,Sr)|0,oe=oe+Math.imul(er,Qr)|0,Ue=Ue+Math.imul(er,tn)|0,Ue=Ue+Math.imul(Xt,Qr)|0,Ze=Ze+Math.imul(Xt,tn)|0,oe=oe+Math.imul(zr,gn)|0,Ue=Ue+Math.imul(zr,on)|0,Ue=Ue+Math.imul(or,gn)|0,Ze=Ze+Math.imul(or,on)|0,oe=oe+Math.imul(Zt,vn)|0,Ue=Ue+Math.imul(Zt,_n)|0,Ue=Ue+Math.imul(Ut,vn)|0,Ze=Ze+Math.imul(Ut,_n)|0;var qn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(qn>>>26)|0,qn&=67108863,oe=Math.imul(Bt,pn),Ue=Math.imul(Bt,yr),Ue=Ue+Math.imul(Jt,pn)|0,Ze=Math.imul(Jt,yr),oe=oe+Math.imul(Qe,Br)|0,Ue=Ue+Math.imul(Qe,Jr)|0,Ue=Ue+Math.imul(nt,Br)|0,Ze=Ze+Math.imul(nt,Jr)|0,oe=oe+Math.imul(Nr,dr)|0,Ue=Ue+Math.imul(Nr,ir)|0,Ue=Ue+Math.imul(Yt,dr)|0,Ze=Ze+Math.imul(Yt,ir)|0,oe=oe+Math.imul(en,an)|0,Ue=Ue+Math.imul(en,Rr)|0,Ue=Ue+Math.imul(ur,an)|0,Ze=Ze+Math.imul(ur,Rr)|0,oe=oe+Math.imul(dn,cr)|0,Ue=Ue+Math.imul(dn,Sr)|0,Ue=Ue+Math.imul(Mr,cr)|0,Ze=Ze+Math.imul(Mr,Sr)|0,oe=oe+Math.imul(Fr,Qr)|0,Ue=Ue+Math.imul(Fr,tn)|0,Ue=Ue+Math.imul(Ar,Qr)|0,Ze=Ze+Math.imul(Ar,tn)|0,oe=oe+Math.imul(er,gn)|0,Ue=Ue+Math.imul(er,on)|0,Ue=Ue+Math.imul(Xt,gn)|0,Ze=Ze+Math.imul(Xt,on)|0,oe=oe+Math.imul(zr,vn)|0,Ue=Ue+Math.imul(zr,_n)|0,Ue=Ue+Math.imul(or,vn)|0,Ze=Ze+Math.imul(or,_n)|0;var In=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(In>>>26)|0,In&=67108863,oe=Math.imul(Bt,Br),Ue=Math.imul(Bt,Jr),Ue=Ue+Math.imul(Jt,Br)|0,Ze=Math.imul(Jt,Jr),oe=oe+Math.imul(Qe,dr)|0,Ue=Ue+Math.imul(Qe,ir)|0,Ue=Ue+Math.imul(nt,dr)|0,Ze=Ze+Math.imul(nt,ir)|0,oe=oe+Math.imul(Nr,an)|0,Ue=Ue+Math.imul(Nr,Rr)|0,Ue=Ue+Math.imul(Yt,an)|0,Ze=Ze+Math.imul(Yt,Rr)|0,oe=oe+Math.imul(en,cr)|0,Ue=Ue+Math.imul(en,Sr)|0,Ue=Ue+Math.imul(ur,cr)|0,Ze=Ze+Math.imul(ur,Sr)|0,oe=oe+Math.imul(dn,Qr)|0,Ue=Ue+Math.imul(dn,tn)|0,Ue=Ue+Math.imul(Mr,Qr)|0,Ze=Ze+Math.imul(Mr,tn)|0,oe=oe+Math.imul(Fr,gn)|0,Ue=Ue+Math.imul(Fr,on)|0,Ue=Ue+Math.imul(Ar,gn)|0,Ze=Ze+Math.imul(Ar,on)|0,oe=oe+Math.imul(er,vn)|0,Ue=Ue+Math.imul(er,_n)|0,Ue=Ue+Math.imul(Xt,vn)|0,Ze=Ze+Math.imul(Xt,_n)|0;var Pn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Pn>>>26)|0,Pn&=67108863,oe=Math.imul(Bt,dr),Ue=Math.imul(Bt,ir),Ue=Ue+Math.imul(Jt,dr)|0,Ze=Math.imul(Jt,ir),oe=oe+Math.imul(Qe,an)|0,Ue=Ue+Math.imul(Qe,Rr)|0,Ue=Ue+Math.imul(nt,an)|0,Ze=Ze+Math.imul(nt,Rr)|0,oe=oe+Math.imul(Nr,cr)|0,Ue=Ue+Math.imul(Nr,Sr)|0,Ue=Ue+Math.imul(Yt,cr)|0,Ze=Ze+Math.imul(Yt,Sr)|0,oe=oe+Math.imul(en,Qr)|0,Ue=Ue+Math.imul(en,tn)|0,Ue=Ue+Math.imul(ur,Qr)|0,Ze=Ze+Math.imul(ur,tn)|0,oe=oe+Math.imul(dn,gn)|0,Ue=Ue+Math.imul(dn,on)|0,Ue=Ue+Math.imul(Mr,gn)|0,Ze=Ze+Math.imul(Mr,on)|0,oe=oe+Math.imul(Fr,vn)|0,Ue=Ue+Math.imul(Fr,_n)|0,Ue=Ue+Math.imul(Ar,vn)|0,Ze=Ze+Math.imul(Ar,_n)|0;var Cn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Cn>>>26)|0,Cn&=67108863,oe=Math.imul(Bt,an),Ue=Math.imul(Bt,Rr),Ue=Ue+Math.imul(Jt,an)|0,Ze=Math.imul(Jt,Rr),oe=oe+Math.imul(Qe,cr)|0,Ue=Ue+Math.imul(Qe,Sr)|0,Ue=Ue+Math.imul(nt,cr)|0,Ze=Ze+Math.imul(nt,Sr)|0,oe=oe+Math.imul(Nr,Qr)|0,Ue=Ue+Math.imul(Nr,tn)|0,Ue=Ue+Math.imul(Yt,Qr)|0,Ze=Ze+Math.imul(Yt,tn)|0,oe=oe+Math.imul(en,gn)|0,Ue=Ue+Math.imul(en,on)|0,Ue=Ue+Math.imul(ur,gn)|0,Ze=Ze+Math.imul(ur,on)|0,oe=oe+Math.imul(dn,vn)|0,Ue=Ue+Math.imul(dn,_n)|0,Ue=Ue+Math.imul(Mr,vn)|0,Ze=Ze+Math.imul(Mr,_n)|0;var Fn=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,oe=Math.imul(Bt,cr),Ue=Math.imul(Bt,Sr),Ue=Ue+Math.imul(Jt,cr)|0,Ze=Math.imul(Jt,Sr),oe=oe+Math.imul(Qe,Qr)|0,Ue=Ue+Math.imul(Qe,tn)|0,Ue=Ue+Math.imul(nt,Qr)|0,Ze=Ze+Math.imul(nt,tn)|0,oe=oe+Math.imul(Nr,gn)|0,Ue=Ue+Math.imul(Nr,on)|0,Ue=Ue+Math.imul(Yt,gn)|0,Ze=Ze+Math.imul(Yt,on)|0,oe=oe+Math.imul(en,vn)|0,Ue=Ue+Math.imul(en,_n)|0,Ue=Ue+Math.imul(ur,vn)|0,Ze=Ze+Math.imul(ur,_n)|0;var Ln=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,oe=Math.imul(Bt,Qr),Ue=Math.imul(Bt,tn),Ue=Ue+Math.imul(Jt,Qr)|0,Ze=Math.imul(Jt,tn),oe=oe+Math.imul(Qe,gn)|0,Ue=Ue+Math.imul(Qe,on)|0,Ue=Ue+Math.imul(nt,gn)|0,Ze=Ze+Math.imul(nt,on)|0,oe=oe+Math.imul(Nr,vn)|0,Ue=Ue+Math.imul(Nr,_n)|0,Ue=Ue+Math.imul(Yt,vn)|0,Ze=Ze+Math.imul(Yt,_n)|0;var Un=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(Un>>>26)|0,Un&=67108863,oe=Math.imul(Bt,gn),Ue=Math.imul(Bt,on),Ue=Ue+Math.imul(Jt,gn)|0,Ze=Math.imul(Jt,on),oe=oe+Math.imul(Qe,vn)|0,Ue=Ue+Math.imul(Qe,_n)|0,Ue=Ue+Math.imul(nt,vn)|0,Ze=Ze+Math.imul(nt,_n)|0;var rr=(B+oe|0)+((Ue&8191)<<13)|0;B=(Ze+(Ue>>>13)|0)+(rr>>>26)|0,rr&=67108863,oe=Math.imul(Bt,vn),Ue=Math.imul(Bt,_n),Ue=Ue+Math.imul(Jt,vn)|0,Ze=Math.imul(Jt,_n);var lr=(B+oe|0)+((Ue&8191)<<13)|0;return B=(Ze+(Ue>>>13)|0)+(lr>>>26)|0,lr&=67108863,re[0]=Mn,re[1]=xn,re[2]=Nn,re[3]=zn,re[4]=An,re[5]=Bn,re[6]=Dn,re[7]=Hn,re[8]=On,re[9]=Rn,re[10]=qn,re[11]=In,re[12]=Pn,re[13]=Cn,re[14]=Fn,re[15]=Ln,re[16]=Un,re[17]=rr,re[18]=lr,B!==0&&(re[19]=B,Q.length++),Q};Math.imul||(ze=Ge);function Xe(A,k,Y){Y.negative=k.negative^A.negative,Y.length=A.length+k.length;for(var Q=0,$e=0,ve=0;ve<Y.length-1;ve++){var re=$e;$e=0;for(var B=Q&67108863,oe=Math.min(ve,k.length-1),Ue=Math.max(0,ve-A.length+1);Ue<=oe;Ue++){var Ze=ve-Ue,lt=A.words[Ze]|0,St=k.words[Ue]|0,Mt=lt*St,Ft=Mt&67108863;re=re+(Mt/67108864|0)|0,Ft=Ft+B|0,B=Ft&67108863,re=re+(Ft>>>26)|0,$e+=re>>>26,re&=67108863}Y.words[ve]=B,Q=re,re=$e}return Q!==0?Y.words[ve]=Q:Y.length--,Y._strip()}function He(A,k,Y){return Xe(A,k,Y)}c.prototype.mulTo=function(k,Y){var Q,$e=this.length+k.length;return this.length===10&&k.length===10?Q=ze(this,k,Y):$e<63?Q=Ge(this,k,Y):$e<1024?Q=Xe(this,k,Y):Q=He(this,k,Y),Q},c.prototype.mul=function(k){var Y=new c(null);return Y.words=new Array(this.length+k.length),this.mulTo(k,Y)},c.prototype.mulf=function(k){var Y=new c(null);return Y.words=new Array(this.length+k.length),He(this,k,Y)},c.prototype.imul=function(k){return this.clone().mulTo(k,this)},c.prototype.imuln=function(k){var Y=k<0;Y&&(k=-k),o(typeof k=="number"),o(k<67108864);for(var Q=0,$e=0;$e<this.length;$e++){var ve=(this.words[$e]|0)*k,re=(ve&67108863)+(Q&67108863);Q>>=26,Q+=ve/67108864|0,Q+=re>>>26,this.words[$e]=re&67108863}return Q!==0&&(this.words[$e]=Q,this.length++),this.length=k===0?1:this.length,Y?this.ineg():this},c.prototype.muln=function(k){return this.clone().imuln(k)},c.prototype.sqr=function(){return this.mul(this)},c.prototype.isqr=function(){return this.imul(this.clone())},c.prototype.pow=function(k){var Y=Le(k);if(Y.length===0)return new c(1);for(var Q=this,$e=0;$e<Y.length&&Y[$e]===0;$e++,Q=Q.sqr());if(++$e<Y.length)for(var ve=Q.sqr();$e<Y.length;$e++,ve=ve.sqr())Y[$e]!==0&&(Q=Q.mul(ve));return Q},c.prototype.iushln=function(k){o(typeof k=="number"&&k>=0);var Y=k%26,Q=(k-Y)/26,$e=67108863>>>26-Y<<26-Y,ve;if(Y!==0){var re=0;for(ve=0;ve<this.length;ve++){var B=this.words[ve]&$e,oe=(this.words[ve]|0)-B<<Y;this.words[ve]=oe|re,re=B>>>26-Y}re&&(this.words[ve]=re,this.length++)}if(Q!==0){for(ve=this.length-1;ve>=0;ve--)this.words[ve+Q]=this.words[ve];for(ve=0;ve<Q;ve++)this.words[ve]=0;this.length+=Q}return this._strip()},c.prototype.ishln=function(k){return o(this.negative===0),this.iushln(k)},c.prototype.iushrn=function(k,Y,Q){o(typeof k=="number"&&k>=0);var $e;Y?$e=(Y-Y%26)/26:$e=0;var ve=k%26,re=Math.min((k-ve)/26,this.length),B=67108863^67108863>>>ve<<ve,oe=Q;if($e-=re,$e=Math.max(0,$e),oe){for(var Ue=0;Ue<re;Ue++)oe.words[Ue]=this.words[Ue];oe.length=re}if(re!==0)if(this.length>re)for(this.length-=re,Ue=0;Ue<this.length;Ue++)this.words[Ue]=this.words[Ue+re];else this.words[0]=0,this.length=1;var Ze=0;for(Ue=this.length-1;Ue>=0&&(Ze!==0||Ue>=$e);Ue--){var lt=this.words[Ue]|0;this.words[Ue]=Ze<<26-ve|lt>>>ve,Ze=lt&B}return oe&&Ze!==0&&(oe.words[oe.length++]=Ze),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},c.prototype.ishrn=function(k,Y,Q){return o(this.negative===0),this.iushrn(k,Y,Q)},c.prototype.shln=function(k){return this.clone().ishln(k)},c.prototype.ushln=function(k){return this.clone().iushln(k)},c.prototype.shrn=function(k){return this.clone().ishrn(k)},c.prototype.ushrn=function(k){return this.clone().iushrn(k)},c.prototype.testn=function(k){o(typeof k=="number"&&k>=0);var Y=k%26,Q=(k-Y)/26,$e=1<<Y;if(this.length<=Q)return!1;var ve=this.words[Q];return!!(ve&$e)},c.prototype.imaskn=function(k){o(typeof k=="number"&&k>=0);var Y=k%26,Q=(k-Y)/26;if(o(this.negative===0,"imaskn works only with positive numbers"),this.length<=Q)return this;if(Y!==0&&Q++,this.length=Math.min(Q,this.length),Y!==0){var $e=67108863^67108863>>>Y<<Y;this.words[this.length-1]&=$e}return this._strip()},c.prototype.maskn=function(k){return this.clone().imaskn(k)},c.prototype.iaddn=function(k){return o(typeof k=="number"),o(k<67108864),k<0?this.isubn(-k):this.negative!==0?this.length===1&&(this.words[0]|0)<=k?(this.words[0]=k-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(k),this.negative=1,this):this._iaddn(k)},c.prototype._iaddn=function(k){this.words[0]+=k;for(var Y=0;Y<this.length&&this.words[Y]>=67108864;Y++)this.words[Y]-=67108864,Y===this.length-1?this.words[Y+1]=1:this.words[Y+1]++;return this.length=Math.max(this.length,Y+1),this},c.prototype.isubn=function(k){if(o(typeof k=="number"),o(k<67108864),k<0)return this.iaddn(-k);if(this.negative!==0)return this.negative=0,this.iaddn(k),this.negative=1,this;if(this.words[0]-=k,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var Y=0;Y<this.length&&this.words[Y]<0;Y++)this.words[Y]+=67108864,this.words[Y+1]-=1;return this._strip()},c.prototype.addn=function(k){return this.clone().iaddn(k)},c.prototype.subn=function(k){return this.clone().isubn(k)},c.prototype.iabs=function(){return this.negative=0,this},c.prototype.abs=function(){return this.clone().iabs()},c.prototype._ishlnsubmul=function(k,Y,Q){var $e=k.length+Q,ve;this._expand($e);var re,B=0;for(ve=0;ve<k.length;ve++){re=(this.words[ve+Q]|0)+B;var oe=(k.words[ve]|0)*Y;re-=oe&67108863,B=(re>>26)-(oe/67108864|0),this.words[ve+Q]=re&67108863}for(;ve<this.length-Q;ve++)re=(this.words[ve+Q]|0)+B,B=re>>26,this.words[ve+Q]=re&67108863;if(B===0)return this._strip();for(o(B===-1),B=0,ve=0;ve<this.length;ve++)re=-(this.words[ve]|0)+B,B=re>>26,this.words[ve]=re&67108863;return this.negative=1,this._strip()},c.prototype._wordDiv=function(k,Y){var Q=this.length-k.length,$e=this.clone(),ve=k,re=ve.words[ve.length-1]|0,B=this._countBits(re);Q=26-B,Q!==0&&(ve=ve.ushln(Q),$e.iushln(Q),re=ve.words[ve.length-1]|0);var oe=$e.length-ve.length,Ue;if(Y!=="mod"){Ue=new c(null),Ue.length=oe+1,Ue.words=new Array(Ue.length);for(var Ze=0;Ze<Ue.length;Ze++)Ue.words[Ze]=0}var lt=$e.clone()._ishlnsubmul(ve,1,oe);lt.negative===0&&($e=lt,Ue&&(Ue.words[oe]=1));for(var St=oe-1;St>=0;St--){var Mt=($e.words[ve.length+St]|0)*67108864+($e.words[ve.length+St-1]|0);for(Mt=Math.min(Mt/re|0,67108863),$e._ishlnsubmul(ve,Mt,St);$e.negative!==0;)Mt--,$e.negative=0,$e._ishlnsubmul(ve,1,St),!$e.isZero()&&($e.negative^=1);Ue&&(Ue.words[St]=Mt)}return Ue&&Ue._strip(),$e._strip(),Y!=="div"&&Q!==0&&$e.iushrn(Q),{div:Ue||null,mod:$e}},c.prototype.divmod=function(k,Y,Q){if(o(!k.isZero()),this.isZero())return{div:new c(0),mod:new c(0)};var $e,ve,re;return this.negative!==0&&k.negative===0?(re=this.neg().divmod(k,Y),Y!=="mod"&&($e=re.div.neg()),Y!=="div"&&(ve=re.mod.neg(),Q&&ve.negative!==0&&ve.iadd(k)),{div:$e,mod:ve}):this.negative===0&&k.negative!==0?(re=this.divmod(k.neg(),Y),Y!=="mod"&&($e=re.div.neg()),{div:$e,mod:re.mod}):(this.negative&k.negative)!==0?(re=this.neg().divmod(k.neg(),Y),Y!=="div"&&(ve=re.mod.neg(),Q&&ve.negative!==0&&ve.isub(k)),{div:re.div,mod:ve}):k.length>this.length||this.cmp(k)<0?{div:new c(0),mod:this}:k.length===1?Y==="div"?{div:this.divn(k.words[0]),mod:null}:Y==="mod"?{div:null,mod:new c(this.modrn(k.words[0]))}:{div:this.divn(k.words[0]),mod:new c(this.modrn(k.words[0]))}:this._wordDiv(k,Y)},c.prototype.div=function(k){return this.divmod(k,"div",!1).div},c.prototype.mod=function(k){return this.divmod(k,"mod",!1).mod},c.prototype.umod=function(k){return this.divmod(k,"mod",!0).mod},c.prototype.divRound=function(k){var Y=this.divmod(k);if(Y.mod.isZero())return Y.div;var Q=Y.div.negative!==0?Y.mod.isub(k):Y.mod,$e=k.ushrn(1),ve=k.andln(1),re=Q.cmp($e);return re<0||ve===1&&re===0?Y.div:Y.div.negative!==0?Y.div.isubn(1):Y.div.iaddn(1)},c.prototype.modrn=function(k){var Y=k<0;Y&&(k=-k),o(k<=67108863);for(var Q=67108864%k,$e=0,ve=this.length-1;ve>=0;ve--)$e=(Q*$e+(this.words[ve]|0))%k;return Y?-$e:$e},c.prototype.modn=function(k){return this.modrn(k)},c.prototype.idivn=function(k){var Y=k<0;Y&&(k=-k),o(k<=67108863);for(var Q=0,$e=this.length-1;$e>=0;$e--){var ve=(this.words[$e]|0)+Q*67108864;this.words[$e]=ve/k|0,Q=ve%k}return this._strip(),Y?this.ineg():this},c.prototype.divn=function(k){return this.clone().idivn(k)},c.prototype.egcd=function(k){o(k.negative===0),o(!k.isZero());var Y=this,Q=k.clone();Y.negative!==0?Y=Y.umod(k):Y=Y.clone();for(var $e=new c(1),ve=new c(0),re=new c(0),B=new c(1),oe=0;Y.isEven()&&Q.isEven();)Y.iushrn(1),Q.iushrn(1),++oe;for(var Ue=Q.clone(),Ze=Y.clone();!Y.isZero();){for(var lt=0,St=1;(Y.words[0]&St)===0&&lt<26;++lt,St<<=1);if(lt>0)for(Y.iushrn(lt);lt-- >0;)($e.isOdd()||ve.isOdd())&&($e.iadd(Ue),ve.isub(Ze)),$e.iushrn(1),ve.iushrn(1);for(var Mt=0,Ft=1;(Q.words[0]&Ft)===0&&Mt<26;++Mt,Ft<<=1);if(Mt>0)for(Q.iushrn(Mt);Mt-- >0;)(re.isOdd()||B.isOdd())&&(re.iadd(Ue),B.isub(Ze)),re.iushrn(1),B.iushrn(1);Y.cmp(Q)>=0?(Y.isub(Q),$e.isub(re),ve.isub(B)):(Q.isub(Y),re.isub($e),B.isub(ve))}return{a:re,b:B,gcd:Q.iushln(oe)}},c.prototype._invmp=function(k){o(k.negative===0),o(!k.isZero());var Y=this,Q=k.clone();Y.negative!==0?Y=Y.umod(k):Y=Y.clone();for(var $e=new c(1),ve=new c(0),re=Q.clone();Y.cmpn(1)>0&&Q.cmpn(1)>0;){for(var B=0,oe=1;(Y.words[0]&oe)===0&&B<26;++B,oe<<=1);if(B>0)for(Y.iushrn(B);B-- >0;)$e.isOdd()&&$e.iadd(re),$e.iushrn(1);for(var Ue=0,Ze=1;(Q.words[0]&Ze)===0&&Ue<26;++Ue,Ze<<=1);if(Ue>0)for(Q.iushrn(Ue);Ue-- >0;)ve.isOdd()&&ve.iadd(re),ve.iushrn(1);Y.cmp(Q)>=0?(Y.isub(Q),$e.isub(ve)):(Q.isub(Y),ve.isub($e))}var lt;return Y.cmpn(1)===0?lt=$e:lt=ve,lt.cmpn(0)<0&&lt.iadd(k),lt},c.prototype.gcd=function(k){if(this.isZero())return k.abs();if(k.isZero())return this.abs();var Y=this.clone(),Q=k.clone();Y.negative=0,Q.negative=0;for(var $e=0;Y.isEven()&&Q.isEven();$e++)Y.iushrn(1),Q.iushrn(1);do{for(;Y.isEven();)Y.iushrn(1);for(;Q.isEven();)Q.iushrn(1);var ve=Y.cmp(Q);if(ve<0){var re=Y;Y=Q,Q=re}else if(ve===0||Q.cmpn(1)===0)break;Y.isub(Q)}while(!0);return Q.iushln($e)},c.prototype.invm=function(k){return this.egcd(k).a.umod(k)},c.prototype.isEven=function(){return(this.words[0]&1)===0},c.prototype.isOdd=function(){return(this.words[0]&1)===1},c.prototype.andln=function(k){return this.words[0]&k},c.prototype.bincn=function(k){o(typeof k=="number");var Y=k%26,Q=(k-Y)/26,$e=1<<Y;if(this.length<=Q)return this._expand(Q+1),this.words[Q]|=$e,this;for(var ve=$e,re=Q;ve!==0&&re<this.length;re++){var B=this.words[re]|0;B+=ve,ve=B>>>26,B&=67108863,this.words[re]=B}return ve!==0&&(this.words[re]=ve,this.length++),this},c.prototype.isZero=function(){return this.length===1&&this.words[0]===0},c.prototype.cmpn=function(k){var Y=k<0;if(this.negative!==0&&!Y)return-1;if(this.negative===0&&Y)return 1;this._strip();var Q;if(this.length>1)Q=1;else{Y&&(k=-k),o(k<=67108863,"Number is too big");var $e=this.words[0]|0;Q=$e===k?0:$e<k?-1:1}return this.negative!==0?-Q|0:Q},c.prototype.cmp=function(k){if(this.negative!==0&&k.negative===0)return-1;if(this.negative===0&&k.negative!==0)return 1;var Y=this.ucmp(k);return this.negative!==0?-Y|0:Y},c.prototype.ucmp=function(k){if(this.length>k.length)return 1;if(this.length<k.length)return-1;for(var Y=0,Q=this.length-1;Q>=0;Q--){var $e=this.words[Q]|0,ve=k.words[Q]|0;if($e!==ve){$e<ve?Y=-1:$e>ve&&(Y=1);break}}return Y},c.prototype.gtn=function(k){return this.cmpn(k)===1},c.prototype.gt=function(k){return this.cmp(k)===1},c.prototype.gten=function(k){return this.cmpn(k)>=0},c.prototype.gte=function(k){return this.cmp(k)>=0},c.prototype.ltn=function(k){return this.cmpn(k)===-1},c.prototype.lt=function(k){return this.cmp(k)===-1},c.prototype.lten=function(k){return this.cmpn(k)<=0},c.prototype.lte=function(k){return this.cmp(k)<=0},c.prototype.eqn=function(k){return this.cmpn(k)===0},c.prototype.eq=function(k){return this.cmp(k)===0},c.red=function(k){return new se(k)},c.prototype.toRed=function(k){return o(!this.red,"Already a number in reduction context"),o(this.negative===0,"red works only with positives"),k.convertTo(this)._forceRed(k)},c.prototype.fromRed=function(){return o(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},c.prototype._forceRed=function(k){return this.red=k,this},c.prototype.forceRed=function(k){return o(!this.red,"Already a number in reduction context"),this._forceRed(k)},c.prototype.redAdd=function(k){return o(this.red,"redAdd works only with red numbers"),this.red.add(this,k)},c.prototype.redIAdd=function(k){return o(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,k)},c.prototype.redSub=function(k){return o(this.red,"redSub works only with red numbers"),this.red.sub(this,k)},c.prototype.redISub=function(k){return o(this.red,"redISub works only with red numbers"),this.red.isub(this,k)},c.prototype.redShl=function(k){return o(this.red,"redShl works only with red numbers"),this.red.shl(this,k)},c.prototype.redMul=function(k){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,k),this.red.mul(this,k)},c.prototype.redIMul=function(k){return o(this.red,"redMul works only with red numbers"),this.red._verify2(this,k),this.red.imul(this,k)},c.prototype.redSqr=function(){return o(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},c.prototype.redISqr=function(){return o(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},c.prototype.redSqrt=function(){return o(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},c.prototype.redInvm=function(){return o(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},c.prototype.redNeg=function(){return o(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},c.prototype.redPow=function(k){return o(this.red&&!k.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,k)};var Ve={k256:null,p224:null,p192:null,p25519:null};function We(A,k){this.name=A,this.p=new c(k,16),this.n=this.p.bitLength(),this.k=new c(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}We.prototype._tmp=function(){var k=new c(null);return k.words=new Array(Math.ceil(this.n/13)),k},We.prototype.ireduce=function(k){var Y=k,Q;do this.split(Y,this.tmp),Y=this.imulK(Y),Y=Y.iadd(this.tmp),Q=Y.bitLength();while(Q>this.n);var $e=Q<this.n?-1:Y.ucmp(this.p);return $e===0?(Y.words[0]=0,Y.length=1):$e>0?Y.isub(this.p):Y.strip!==void 0?Y.strip():Y._strip(),Y},We.prototype.split=function(k,Y){k.iushrn(this.n,0,Y)},We.prototype.imulK=function(k){return k.imul(this.k)};function rt(){We.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(rt,We),rt.prototype.split=function(k,Y){for(var Q=4194303,$e=Math.min(k.length,9),ve=0;ve<$e;ve++)Y.words[ve]=k.words[ve];if(Y.length=$e,k.length<=9){k.words[0]=0,k.length=1;return}var re=k.words[9];for(Y.words[Y.length++]=re&Q,ve=10;ve<k.length;ve++){var B=k.words[ve]|0;k.words[ve-10]=(B&Q)<<4|re>>>22,re=B}re>>>=22,k.words[ve-10]=re,re===0&&k.length>10?k.length-=10:k.length-=9},rt.prototype.imulK=function(k){k.words[k.length]=0,k.words[k.length+1]=0,k.length+=2;for(var Y=0,Q=0;Q<k.length;Q++){var $e=k.words[Q]|0;Y+=$e*977,k.words[Q]=Y&67108863,Y=$e*64+(Y/67108864|0)}return k.words[k.length-1]===0&&(k.length--,k.words[k.length-1]===0&&k.length--),k};function st(){We.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(st,We);function ht(){We.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(ht,We);function je(){We.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(je,We),je.prototype.imulK=function(k){for(var Y=0,Q=0;Q<k.length;Q++){var $e=(k.words[Q]|0)*19+Y,ve=$e&67108863;$e>>>=26,k.words[Q]=ve,Y=$e}return Y!==0&&(k.words[k.length++]=Y),k},c._prime=function(k){if(Ve[k])return Ve[k];var Y;if(k==="k256")Y=new rt;else if(k==="p224")Y=new st;else if(k==="p192")Y=new ht;else if(k==="p25519")Y=new je;else throw new Error("Unknown prime "+k);return Ve[k]=Y,Y};function se(A){if(typeof A=="string"){var k=c._prime(A);this.m=k.p,this.prime=k}else o(A.gtn(1),"modulus must be greater than 1"),this.m=A,this.prime=null}se.prototype._verify1=function(k){o(k.negative===0,"red works only with positives"),o(k.red,"red works only with red numbers")},se.prototype._verify2=function(k,Y){o((k.negative|Y.negative)===0,"red works only with positives"),o(k.red&&k.red===Y.red,"red works only with red numbers")},se.prototype.imod=function(k){return this.prime?this.prime.ireduce(k)._forceRed(this):(L(k,k.umod(this.m)._forceRed(this)),k)},se.prototype.neg=function(k){return k.isZero()?k.clone():this.m.sub(k)._forceRed(this)},se.prototype.add=function(k,Y){this._verify2(k,Y);var Q=k.add(Y);return Q.cmp(this.m)>=0&&Q.isub(this.m),Q._forceRed(this)},se.prototype.iadd=function(k,Y){this._verify2(k,Y);var Q=k.iadd(Y);return Q.cmp(this.m)>=0&&Q.isub(this.m),Q},se.prototype.sub=function(k,Y){this._verify2(k,Y);var Q=k.sub(Y);return Q.cmpn(0)<0&&Q.iadd(this.m),Q._forceRed(this)},se.prototype.isub=function(k,Y){this._verify2(k,Y);var Q=k.isub(Y);return Q.cmpn(0)<0&&Q.iadd(this.m),Q},se.prototype.shl=function(k,Y){return this._verify1(k),this.imod(k.ushln(Y))},se.prototype.imul=function(k,Y){return this._verify2(k,Y),this.imod(k.imul(Y))},se.prototype.mul=function(k,Y){return this._verify2(k,Y),this.imod(k.mul(Y))},se.prototype.isqr=function(k){return this.imul(k,k.clone())},se.prototype.sqr=function(k){return this.mul(k,k)},se.prototype.sqrt=function(k){if(k.isZero())return k.clone();var Y=this.m.andln(3);if(o(Y%2===1),Y===3){var Q=this.m.add(new c(1)).iushrn(2);return this.pow(k,Q)}for(var $e=this.m.subn(1),ve=0;!$e.isZero()&&$e.andln(1)===0;)ve++,$e.iushrn(1);o(!$e.isZero());var re=new c(1).toRed(this),B=re.redNeg(),oe=this.m.subn(1).iushrn(1),Ue=this.m.bitLength();for(Ue=new c(2*Ue*Ue).toRed(this);this.pow(Ue,oe).cmp(B)!==0;)Ue.redIAdd(B);for(var Ze=this.pow(Ue,$e),lt=this.pow(k,$e.addn(1).iushrn(1)),St=this.pow(k,$e),Mt=ve;St.cmp(re)!==0;){for(var Ft=St,Zt=0;Ft.cmp(re)!==0;Zt++)Ft=Ft.redSqr();o(Zt<Mt);var Ut=this.pow(Ze,new c(1).iushln(Mt-Zt-1));lt=lt.redMul(Ut),Ze=Ut.redSqr(),St=St.redMul(Ze),Mt=Zt}return lt},se.prototype.invm=function(k){var Y=k._invmp(this.m);return Y.negative!==0?(Y.negative=0,this.imod(Y).redNeg()):this.imod(Y)},se.prototype.pow=function(k,Y){if(Y.isZero())return new c(1).toRed(this);if(Y.cmpn(1)===0)return k.clone();var Q=4,$e=new Array(1<<Q);$e[0]=new c(1).toRed(this),$e[1]=k;for(var ve=2;ve<$e.length;ve++)$e[ve]=this.mul($e[ve-1],k);var re=$e[0],B=0,oe=0,Ue=Y.bitLength()%26;for(Ue===0&&(Ue=26),ve=Y.length-1;ve>=0;ve--){for(var Ze=Y.words[ve],lt=Ue-1;lt>=0;lt--){var St=Ze>>lt&1;if(re!==$e[0]&&(re=this.sqr(re)),St===0&&B===0){oe=0;continue}B<<=1,B|=St,oe++,!(oe!==Q&&(ve!==0||lt!==0))&&(re=this.mul(re,$e[B]),oe=0,B=0)}Ue=26}return re},se.prototype.convertTo=function(k){var Y=k.umod(this.m);return Y===k?Y.clone():Y},se.prototype.convertFrom=function(k){var Y=k.clone();return Y.red=null,Y},c.mont=function(k){return new m(k)};function m(A){se.call(this,A),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(m,se),m.prototype.convertTo=function(k){return this.imod(k.ushln(this.shift))},m.prototype.convertFrom=function(k){var Y=this.imod(k.mul(this.rinv));return Y.red=null,Y},m.prototype.imul=function(k,Y){if(k.isZero()||Y.isZero())return k.words[0]=0,k.length=1,k;var Q=k.imul(Y),$e=Q.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),ve=Q.isub($e).iushrn(this.shift),re=ve;return ve.cmp(this.m)>=0?re=ve.isub(this.m):ve.cmpn(0)<0&&(re=ve.iadd(this.m)),re._forceRed(this)},m.prototype.mul=function(k,Y){if(k.isZero()||Y.isZero())return new c(0)._forceRed(this);var Q=k.mul(Y),$e=Q.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),ve=Q.isub($e).iushrn(this.shift),re=ve;return ve.cmp(this.m)>=0?re=ve.isub(this.m):ve.cmpn(0)<0&&(re=ve.iadd(this.m)),re._forceRed(this)},m.prototype.invm=function(k){var Y=this.imod(k._invmp(this.m).mul(this.r2));return Y._forceRed(this)}})(typeof t>"u"||t,r)}),require_browserify_rsa=__commonJS2((r,t)=>{var n=require_bn5(),s=require_randombytes(),o=require_safe_buffer().Buffer;function a(g){var b=g.modulus.byteLength(),_;do _=new n(s(b));while(_.cmp(g.modulus)>=0||!_.umod(g.prime1)||!_.umod(g.prime2));return _}function c(g){var b=a(g),_=b.toRed(n.mont(g.modulus)).redPow(new n(g.publicExponent)).fromRed();return{blinder:_,unblinder:b.invm(g.modulus)}}function f(g,b){var _=c(b),L=b.modulus.byteLength(),q=new n(g).mul(_.blinder).umod(b.modulus),X=q.toRed(n.mont(b.prime1)),te=q.toRed(n.mont(b.prime2)),ne=b.coefficient,Ce=b.prime1,Le=b.prime2,Ge=X.redPow(b.exponent1).fromRed(),ze=te.redPow(b.exponent2).fromRed(),Xe=Ge.isub(ze).imul(ne).umod(Ce).imul(Le);return ze.iadd(Xe).imul(_.unblinder).umod(b.modulus).toArrayLike(o,"be",L)}f.getr=a,t.exports=f}),require_publicEncrypt=__commonJS2((r,t)=>{var n=require_parse_asn1(),s=require_randombytes(),o=require_create_hash(),a=require_mgf(),c=require_xor(),f=require_bn4(),g=require_withPublic(),b=require_browserify_rsa(),_=require_safe_buffer().Buffer;t.exports=function(ne,Ce,Le){var Ge;ne.padding?Ge=ne.padding:Le?Ge=1:Ge=4;var ze=n(ne),Xe;if(Ge===4)Xe=L(ze,Ce);else if(Ge===1)Xe=q(ze,Ce,Le);else if(Ge===3){if(Xe=new f(Ce),Xe.cmp(ze.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return Le?b(Xe,ze):g(Xe,ze)};function L(te,ne){var Ce=te.modulus.byteLength(),Le=ne.length,Ge=o("sha1").update(_.alloc(0)).digest(),ze=Ge.length,Xe=2*ze;if(Le>Ce-Xe-2)throw new Error("message too long");var He=_.alloc(Ce-Le-Xe-2),Ve=Ce-ze-1,We=s(ze),rt=c(_.concat([Ge,He,_.alloc(1,1),ne],Ve),a(We,Ve)),st=c(We,a(rt,ze));return new f(_.concat([_.alloc(1),st,rt],Ce))}function q(te,ne,Ce){var Le=ne.length,Ge=te.modulus.byteLength();if(Le>Ge-11)throw new Error("message too long");var ze;return Ce?ze=_.alloc(Ge-Le-3,255):ze=X(Ge-Le-3),new f(_.concat([_.from([0,Ce?1:2]),ze,_.alloc(1),ne],Ge))}function X(te){for(var ne=_.allocUnsafe(te),Ce=0,Le=s(te*2),Ge=0,ze;Ce<te;)Ge===Le.length&&(Le=s(te*2),Ge=0),ze=Le[Ge++],ze&&(ne[Ce++]=ze);return ne}}),require_privateDecrypt=__commonJS2((r,t)=>{var n=require_parse_asn1(),s=require_mgf(),o=require_xor(),a=require_bn4(),c=require_browserify_rsa(),f=require_create_hash(),g=require_withPublic(),b=require_safe_buffer().Buffer;t.exports=function(te,ne,Ce){var Le;te.padding?Le=te.padding:Ce?Le=1:Le=4;var Ge=n(te),ze=Ge.modulus.byteLength();if(ne.length>ze||new a(ne).cmp(Ge.modulus)>=0)throw new Error("decryption error");var Xe;Ce?Xe=g(new a(ne),Ge):Xe=c(ne,Ge);var He=b.alloc(ze-Xe.length);if(Xe=b.concat([He,Xe],ze),Le===4)return _(Ge,Xe);if(Le===1)return L(Ge,Xe,Ce);if(Le===3)return Xe;throw new Error("unknown padding")};function _(X,te){var ne=X.modulus.byteLength(),Ce=f("sha1").update(b.alloc(0)).digest(),Le=Ce.length;if(te[0]!==0)throw new Error("decryption error");var Ge=te.slice(1,Le+1),ze=te.slice(Le+1),Xe=o(Ge,s(ze,Le)),He=o(ze,s(Xe,ne-Le-1));if(q(Ce,He.slice(0,Le)))throw new Error("decryption error");for(var Ve=Le;He[Ve]===0;)Ve++;if(He[Ve++]!==1)throw new Error("decryption error");return He.slice(Ve)}function L(X,te,ne){for(var Ce=te.slice(0,2),Le=2,Ge=0;te[Le++]!==0;)if(Le>=te.length){Ge++;break}var ze=te.slice(2,Le-1);if((Ce.toString("hex")!=="0002"&&!ne||Ce.toString("hex")!=="0001"&&ne)&&Ge++,ze.length<8&&Ge++,Ge)throw new Error("decryption error");return te.slice(Le)}function q(X,te){X=b.from(X),te=b.from(te);var ne=0,Ce=X.length;X.length!==te.length&&(ne++,Ce=Math.min(X.length,te.length));for(var Le=-1;++Le<Ce;)ne+=X[Le]^te[Le];return ne}}),require_browser2=__commonJS2(r=>{r.publicEncrypt=require_publicEncrypt(),r.privateDecrypt=require_privateDecrypt(),r.privateEncrypt=function(n,s){return r.publicEncrypt(n,s,!0)},r.publicDecrypt=function(n,s){return r.privateDecrypt(n,s,!0)}}),require_public_encrypt=__commonJS2(r=>{var t=(init_crypto(),__toCommonJS(exports_crypto));typeof t.publicEncrypt!="function"&&(t=require_browser2()),r.publicEncrypt=t.publicEncrypt,r.privateDecrypt=t.privateDecrypt,typeof t.privateEncrypt!="function"?r.privateEncrypt=require_browser2().privateEncrypt:r.privateEncrypt=t.privateEncrypt,typeof t.publicDecrypt!="function"?r.publicDecrypt=require_browser2().publicDecrypt:r.publicDecrypt=t.publicDecrypt}),require_browser3=__commonJS2(r=>{var t=require_safe_buffer(),n=require_randombytes(),s=t.Buffer,o=t.kMaxLength,a=globalThis.crypto||globalThis.msCrypto,c=Math.pow(2,32)-1;function f(q,X){if(typeof q!="number"||q!==q)throw new TypeError("offset must be a number");if(q>c||q<0)throw new TypeError("offset must be a uint32");if(q>o||q>X)throw new RangeError("offset out of range")}function g(q,X,te){if(typeof q!="number"||q!==q)throw new TypeError("size must be a number");if(q>c||q<0)throw new TypeError("size must be a uint32");if(q+X>te||q>o)throw new RangeError("buffer too small")}a&&a.getRandomValues,r.randomFill=b,r.randomFillSync=L;function b(q,X,te,ne){if(!s.isBuffer(q)&&!(q instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof X=="function")ne=X,X=0,te=q.length;else if(typeof te=="function")ne=te,te=q.length-X;else if(typeof ne!="function")throw new TypeError('"cb" argument must be a function');return f(X,q.length),g(te,X,q.length),_(q,X,te,ne)}function _(q,X,te,ne){if(ne){n(te,function(Le,Ge){if(Le)return ne(Le);Ge.copy(q,X),ne(null,q)});return}var Ce=n(te);return Ce.copy(q,X),q}function L(q,X,te){if(typeof X>"u"&&(X=0),!s.isBuffer(q)&&!(q instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return f(X,q.length),te===void 0&&(te=q.length-X),g(te,X,q.length),_(q,X,te)}}),require_randomfill=__commonJS2((r,t)=>{var n=(init_crypto(),__toCommonJS(exports_crypto));typeof n.randomFill=="function"&&typeof n.randomFillSync=="function"?(r.randomFill=n.randomFill,r.randomFillSync=n.randomFillSync):t.exports=require_browser3()}),require_crypto_browserify=__commonJS2(r=>{r.randomBytes=r.rng=r.pseudoRandomBytes=r.prng=require_randombytes(),r.createHash=r.Hash=require_create_hash(),r.createHmac=r.Hmac=require_create_hmac();var t=require_algorithms(),n=Object.keys(t),s=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(n);r.getHashes=function(){return s};var o=require_pbkdf2();r.pbkdf2=o.pbkdf2,r.pbkdf2Sync=o.pbkdf2Sync;var a=require_browserify_cipher();r.Cipher=a.Cipher,r.createCipher=a.createCipher,r.Cipheriv=a.Cipheriv,r.createCipheriv=a.createCipheriv,r.Decipher=a.Decipher,r.createDecipher=a.createDecipher,r.Decipheriv=a.Decipheriv,r.createDecipheriv=a.createDecipheriv,r.getCiphers=a.getCiphers,r.listCiphers=a.listCiphers;var c=require_diffie_hellman();r.DiffieHellmanGroup=c.DiffieHellmanGroup,r.createDiffieHellmanGroup=c.createDiffieHellmanGroup,r.getDiffieHellman=c.getDiffieHellman,r.createDiffieHellman=c.createDiffieHellman,r.DiffieHellman=c.DiffieHellman;var f=require_browserify_sign();r.createSign=f.createSign,r.Sign=f.Sign,r.createVerify=f.createVerify,r.Verify=f.Verify,r.createECDH=require_create_ecdh();var g=require_public_encrypt();r.publicEncrypt=g.publicEncrypt,r.privateEncrypt=g.privateEncrypt,r.publicDecrypt=g.publicDecrypt,r.privateDecrypt=g.privateDecrypt;var b=require_randomfill();r.randomFill=b.randomFill,r.randomFillSync=b.randomFillSync,r.createCredentials=function(){throw new Error(`sorry, createCredentials is not implemented yet
we accept pull requests
https://github.com/browserify/crypto-browserify`)},r.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}}),cryptoBrowserify=__toESM2(require_crypto_browserify(),1),prng2=cryptoBrowserify.prng,pseudoRandomBytes2=cryptoBrowserify.pseudoRandomBytes,rng2=cryptoBrowserify.rng,randomBytes2=cryptoBrowserify.randomBytes,Hash2=cryptoBrowserify.Hash,createHash2=cryptoBrowserify.createHash,Hmac2=cryptoBrowserify.Hmac,createHmac2=cryptoBrowserify.createHmac,getHashes2=cryptoBrowserify.getHashes,pbkdf22=cryptoBrowserify.pbkdf2,pbkdf2Sync2=cryptoBrowserify.pbkdf2Sync,Cipher2=cryptoBrowserify.Cipher,createCipher2=cryptoBrowserify.createCipher,Cipheriv2=cryptoBrowserify.Cipheriv,createCipheriv2=cryptoBrowserify.createCipheriv,Decipher2=cryptoBrowserify.Decipher,createDecipher2=cryptoBrowserify.createDecipher,Decipheriv2=cryptoBrowserify.Decipheriv,createDecipheriv2=cryptoBrowserify.createDecipheriv,getCiphers2=cryptoBrowserify.getCiphers,listCiphers2=cryptoBrowserify.listCiphers,DiffieHellmanGroup2=cryptoBrowserify.DiffieHellmanGroup,createDiffieHellmanGroup2=cryptoBrowserify.createDiffieHellmanGroup,getDiffieHellman2=cryptoBrowserify.getDiffieHellman,createDiffieHellman2=cryptoBrowserify.createDiffieHellman,DiffieHellman2=cryptoBrowserify.DiffieHellman,createSign2=cryptoBrowserify.createSign,Sign2=cryptoBrowserify.Sign,createVerify2=cryptoBrowserify.createVerify,Verify2=cryptoBrowserify.Verify,createECDH2=cryptoBrowserify.createECDH,publicEncrypt2=cryptoBrowserify.publicEncrypt,privateEncrypt2=cryptoBrowserify.privateEncrypt,publicDecrypt2=cryptoBrowserify.publicDecrypt,privateDecrypt2=cryptoBrowserify.privateDecrypt,randomFill2=cryptoBrowserify.randomFill,randomFillSync2=cryptoBrowserify.randomFillSync,createCredentials2=cryptoBrowserify.createCredentials,constants2=cryptoBrowserify.constants,hardcoded_curves=["p192","p224","p256","p384","p521","curve25519","ed25519","secp256k1","secp224r1","prime256v1","prime192v1","ed25519","secp384r1","secp521r1"],webcrypto=crypto,crypto_default=crypto}),require_sql_wasm=__commonJS((r,t)=>{var n="/Users/pablofernandez/tenex/NDK-nhlteu/node_modules/sql.js/dist",s=void 0,o=function(a){return s||(s=new Promise(function(c,f){var g=typeof a<"u"?a:{},b=g.onAbort;g.onAbort=function(Je){f(new Error(Je)),b&&b(Je)},g.postRun=g.postRun||[],g.postRun.push(function(){c(g)}),t=void 0;var _;_||=typeof g<"u"?g:{};var L=typeof window=="object",q=typeof WorkerGlobalScope<"u",X=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";_.onRuntimeInitialized=function(){function Je(jr,ln){switch(typeof ln){case"boolean":Fa(jr,ln?1:0);break;case"number":La(jr,ln);break;case"string":Da(jr,ln,-1,-1);break;case"object":if(ln===null)Gi(jr);else if(ln.length!=null){var mn=vi(ln,wi);Oa(jr,mn,ln.length,-1),Ei(mn)}else _i(jr,"Wrong API use : tried to return a value of an unknown type ("+ln+").",-1);break;default:Gi(jr)}}function ot(jr,ln){for(var mn=[],En=0;En<jr;En+=1){var $n=or(ln+4*En,"i32"),Tn=Ca($n);if(Tn===1||Tn===2)$n=Pa($n);else if(Tn===3)$n=Na($n);else if(Tn===4){Tn=$n,$n=Ia(Tn),Tn=Ba(Tn);for(var Qn=new Uint8Array($n),Yn=0;Yn<$n;Yn+=1)Qn[Yn]=je[Tn+Yn];$n=Qn}else $n=null;mn.push($n)}return mn}function It(jr,ln){this.Qa=jr,this.db=ln,this.Oa=1,this.lb=[]}function qt(jr,ln){if(this.db=ln,ln=Nr(jr)+1,this.eb=Ci(ln),this.eb===null)throw Error("Unable to allocate memory for the SQL string");Yt(jr,se,this.eb,ln),this.kb=this.eb,this.Za=this.pb=null}function _r(jr){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),jr!=null){var ln=this.filename,mn="/",En=ln;if(mn&&(mn=typeof mn=="string"?mn:ir(mn),En=ln?qr(mn+"/"+ln):mn),ln=mr(!0,!0),En=zn(En,ln),jr){if(typeof jr=="string"){mn=Array(jr.length);for(var $n=0,Tn=jr.length;$n<Tn;++$n)mn[$n]=jr.charCodeAt($n);jr=mn}In(En,ln|146),mn=Cn(En,577),rr(mn,jr,0,jr.length,0),Fn(mn),In(En,ln)}}this.handleError(wn(this.filename,Kr)),this.db=or(Kr,"i32"),Zi(this.db),this.fb={},this.Sa={}}var Kr=si(4),sn=_.cwrap,wn=sn("sqlite3_open","number",["string","number"]),Sn=sn("sqlite3_close_v2","number",["number"]),kn=sn("sqlite3_exec","number",["number","string","number","number","number"]),Vn=sn("sqlite3_changes","number",["number"]),Kn=sn("sqlite3_prepare_v2","number",["number","string","number","number","number"]),zi=sn("sqlite3_sql","string",["number"]),da=sn("sqlite3_normalized_sql","string",["number"]),Vi=sn("sqlite3_prepare_v2","number",["number","number","number","number","number"]),pa=sn("sqlite3_bind_text","number",["number","number","number","number","number"]),Wi=sn("sqlite3_bind_blob","number",["number","number","number","number","number"]),ga=sn("sqlite3_bind_double","number",["number","number","number"]),ya=sn("sqlite3_bind_int","number",["number","number","number"]),ma=sn("sqlite3_bind_parameter_index","number",["number","string"]),ba=sn("sqlite3_step","number",["number"]),wa=sn("sqlite3_errmsg","string",["number"]),va=sn("sqlite3_column_count","number",["number"]),Ea=sn("sqlite3_data_count","number",["number"]),$a=sn("sqlite3_column_double","number",["number","number"]),ji=sn("sqlite3_column_text","string",["number","number"]),ka=sn("sqlite3_column_blob","number",["number","number"]),Sa=sn("sqlite3_column_bytes","number",["number","number"]),xa=sn("sqlite3_column_type","number",["number","number"]),Aa=sn("sqlite3_column_name","string",["number","number"]),Ta=sn("sqlite3_reset","number",["number"]),Ma=sn("sqlite3_clear_bindings","number",["number"]),Ra=sn("sqlite3_finalize","number",["number"]),Ki=sn("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),Ca=sn("sqlite3_value_type","number",["number"]),Ia=sn("sqlite3_value_bytes","number",["number"]),Na=sn("sqlite3_value_text","string",["number"]),Ba=sn("sqlite3_value_blob","number",["number"]),Pa=sn("sqlite3_value_double","number",["number"]),La=sn("sqlite3_result_double","",["number","number"]),Gi=sn("sqlite3_result_null","",["number"]),Da=sn("sqlite3_result_text","",["number","string","number","number"]),Oa=sn("sqlite3_result_blob","",["number","number","number","number"]),Fa=sn("sqlite3_result_int","",["number","number"]),_i=sn("sqlite3_result_error","",["number","string","number"]),Ji=sn("sqlite3_aggregate_context","number",["number","number"]),Zi=sn("RegisterExtensionFunctions","number",["number"]),Yi=sn("sqlite3_update_hook","number",["number","number","number"]);It.prototype.bind=function(jr){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(jr)?this.Cb(jr):jr!=null&&typeof jr=="object"?this.Db(jr):!0},It.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var jr=ba(this.Qa);switch(jr){case 100:return!0;case 101:return!1;default:throw this.db.handleError(jr)}},It.prototype.wb=function(jr){return jr==null&&(jr=this.Oa,this.Oa+=1),$a(this.Qa,jr)},It.prototype.Gb=function(jr){if(jr==null&&(jr=this.Oa,this.Oa+=1),jr=ji(this.Qa,jr),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(jr)},It.prototype.Hb=function(jr){return jr==null&&(jr=this.Oa,this.Oa+=1),ji(this.Qa,jr)},It.prototype.getBlob=function(jr){jr==null&&(jr=this.Oa,this.Oa+=1);var ln=Sa(this.Qa,jr);jr=ka(this.Qa,jr);for(var mn=new Uint8Array(ln),En=0;En<ln;En+=1)mn[En]=je[jr+En];return mn},It.prototype.get=function(jr,ln){ln=ln||{},jr!=null&&this.bind(jr)&&this.step(),jr=[];for(var mn=Ea(this.Qa),En=0;En<mn;En+=1)switch(xa(this.Qa,En)){case 1:var $n=ln.useBigInt?this.Gb(En):this.wb(En);jr.push($n);break;case 2:jr.push(this.wb(En));break;case 3:jr.push(this.Hb(En));break;case 4:jr.push(this.getBlob(En));break;default:jr.push(null)}return jr},It.prototype.getColumnNames=function(){for(var jr=[],ln=va(this.Qa),mn=0;mn<ln;mn+=1)jr.push(Aa(this.Qa,mn));return jr},It.prototype.getAsObject=function(jr,ln){jr=this.get(jr,ln),ln=this.getColumnNames();for(var mn={},En=0;En<ln.length;En+=1)mn[ln[En]]=jr[En];return mn},It.prototype.getSQL=function(){return zi(this.Qa)},It.prototype.getNormalizedSQL=function(){return da(this.Qa)},It.prototype.run=function(jr){return jr!=null&&this.bind(jr),this.step(),this.reset()},It.prototype.sb=function(jr,ln){ln==null&&(ln=this.Oa,this.Oa+=1),jr=Ir(jr);var mn=vi(jr,wi);this.lb.push(mn),this.db.handleError(pa(this.Qa,ln,mn,jr.length-1,0))},It.prototype.Bb=function(jr,ln){ln==null&&(ln=this.Oa,this.Oa+=1);var mn=vi(jr,wi);this.lb.push(mn),this.db.handleError(Wi(this.Qa,ln,mn,jr.length,0))},It.prototype.rb=function(jr,ln){ln==null&&(ln=this.Oa,this.Oa+=1),this.db.handleError((jr===(jr|0)?ya:ga)(this.Qa,ln,jr))},It.prototype.Eb=function(jr){jr==null&&(jr=this.Oa,this.Oa+=1),Wi(this.Qa,jr,0,0,0)},It.prototype.tb=function(jr,ln){switch(ln==null&&(ln=this.Oa,this.Oa+=1),typeof jr){case"string":this.sb(jr,ln);return;case"number":this.rb(jr,ln);return;case"bigint":this.sb(jr.toString(),ln);return;case"boolean":this.rb(jr+0,ln);return;case"object":if(jr===null){this.Eb(ln);return}if(jr.length!=null){this.Bb(jr,ln);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+jr+")."},It.prototype.Db=function(jr){var ln=this;return Object.keys(jr).forEach(function(mn){var En=ma(ln.Qa,mn);En!==0&&ln.tb(jr[mn],En)}),!0},It.prototype.Cb=function(jr){for(var ln=0;ln<jr.length;ln+=1)this.tb(jr[ln],ln+1);return!0},It.prototype.reset=function(){return this.freemem(),Ma(this.Qa)===0&&Ta(this.Qa)===0},It.prototype.freemem=function(){for(var jr;(jr=this.lb.pop())!==void 0;)Ei(jr)},It.prototype.free=function(){this.freemem();var jr=Ra(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,jr},qt.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var jr=mi(),ln=si(4);er(Kr),er(ln);try{this.db.handleError(Vi(this.db.db,this.kb,-1,Kr,ln)),this.kb=or(ln,"i32");var mn=or(Kr,"i32");return mn===0?(this.mb(),{done:!0}):(this.Za=new It(mn,this.db),this.db.fb[mn]=this.Za,{value:this.Za,done:!1})}catch(En){throw this.pb=Fr(this.kb),this.mb(),En}finally{yi(jr)}},qt.prototype.mb=function(){Ei(this.eb),this.eb=null},qt.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:Fr(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(qt.prototype[Symbol.iterator]=function(){return this}),_r.prototype.run=function(jr,ln){if(!this.db)throw"Database closed";if(ln){jr=this.prepare(jr,ln);try{jr.step()}finally{jr.free()}}else this.handleError(kn(this.db,jr,0,0,Kr));return this},_r.prototype.exec=function(jr,ln,mn){if(!this.db)throw"Database closed";var En=mi(),$n=null;try{var Tn=Gn(jr),Qn=si(4);for(jr=[];or(Tn,"i8")!==0;){er(Kr),er(Qn),this.handleError(Vi(this.db,Tn,-1,Kr,Qn));var Yn=or(Kr,"i32");if(Tn=or(Qn,"i32"),Yn!==0){var Jn=null;for($n=new It(Yn,this),ln!=null&&$n.bind(ln);$n.step();)Jn===null&&(Jn={columns:$n.getColumnNames(),values:[]},jr.push(Jn)),Jn.values.push($n.get(null,mn));$n.free()}}return jr}catch(ei){throw $n&&$n.free(),ei}finally{yi(En)}},_r.prototype.each=function(jr,ln,mn,En,$n){typeof ln=="function"&&(En=mn,mn=ln,ln=void 0),jr=this.prepare(jr,ln);try{for(;jr.step();)mn(jr.getAsObject(null,$n))}finally{jr.free()}if(typeof En=="function")return En()},_r.prototype.prepare=function(jr,ln){if(er(Kr),this.handleError(Kn(this.db,jr,-1,Kr,0)),jr=or(Kr,"i32"),jr===0)throw"Nothing to prepare";var mn=new It(jr,this);return ln!=null&&mn.bind(ln),this.fb[jr]=mn},_r.prototype.iterateStatements=function(jr){return new qt(jr,this)},_r.prototype.export=function(){Object.values(this.fb).forEach(function(ln){ln.free()}),Object.values(this.Sa).forEach(ii),this.Sa={},this.handleError(Sn(this.db));var jr=lr(this.filename);return this.handleError(wn(this.filename,Kr)),this.db=or(Kr,"i32"),Zi(this.db),jr},_r.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(jr){jr.free()}),Object.values(this.Sa).forEach(ii),this.Sa={},this.Ya&&(ii(this.Ya),this.Ya=void 0),this.handleError(Sn(this.db)),On("/"+this.filename),this.db=null)},_r.prototype.handleError=function(jr){if(jr===0)return null;throw jr=wa(this.db),Error(jr)},_r.prototype.getRowsModified=function(){return Vn(this.db)},_r.prototype.create_function=function(jr,ln){Object.prototype.hasOwnProperty.call(this.Sa,jr)&&(ii(this.Sa[jr]),delete this.Sa[jr]);var mn=gi(function(En,$n,Tn){$n=ot($n,Tn);try{var Qn=ln.apply(null,$n)}catch(Yn){_i(En,Yn,-1);return}Je(En,Qn)},"viii");return this.Sa[jr]=mn,this.handleError(Ki(this.db,jr,ln.length,1,0,mn,0,0,0)),this},_r.prototype.create_aggregate=function(jr,ln){var mn=ln.init||function(){return null},En=ln.finalize||function(Jn){return Jn},$n=ln.step;if(!$n)throw"An aggregate function must have a step function in "+jr;var Tn={};Object.hasOwnProperty.call(this.Sa,jr)&&(ii(this.Sa[jr]),delete this.Sa[jr]),ln=jr+"__finalize",Object.hasOwnProperty.call(this.Sa,ln)&&(ii(this.Sa[ln]),delete this.Sa[ln]);var Qn=gi(function(Jn,ei,Ni){var ui=Ji(Jn,1);Object.hasOwnProperty.call(Tn,ui)||(Tn[ui]=mn()),ei=ot(ei,Ni),ei=[Tn[ui]].concat(ei);try{Tn[ui]=$n.apply(null,ei)}catch(Ua){delete Tn[ui],_i(Jn,Ua,-1)}},"viii"),Yn=gi(function(Jn){var ei=Ji(Jn,1);try{var Ni=En(Tn[ei])}catch(ui){delete Tn[ei],_i(Jn,ui,-1);return}Je(Jn,Ni),delete Tn[ei]},"vi");return this.Sa[jr]=Qn,this.Sa[ln]=Yn,this.handleError(Ki(this.db,jr,$n.length-1,1,0,0,Qn,Yn,0)),this},_r.prototype.updateHook=function(jr){this.Ya&&(Yi(this.db,0,0),ii(this.Ya),this.Ya=void 0),jr&&(this.Ya=gi(function(ln,mn,En,$n,Tn){switch(mn){case 18:ln="insert";break;case 23:ln="update";break;case 9:ln="delete";break;default:throw"unknown operationCode in updateHook callback: "+mn}if(En=En?nr(se,En):"",$n=$n?nr(se,$n):"",Tn>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";jr(ln,En,$n,Number(Tn))},"viiiij"),Yi(this.db,this.Ya,0))},_.Database=_r};var te={..._},ne="./this.program",Ce=(Je,ot)=>{throw ot},Le="",Ge,ze;if(X){var Xe=(()=>({}));init_path(),Le=n+"/",ze=Je=>(Je=ve(Je)?new URL(Je):Je,Xe.readFileSync(Je)),Ge=async Je=>(Je=ve(Je)?new URL(Je):Je,Xe.readFileSync(Je,void 0)),!_.thisProgram&&1<process.argv.length&&(ne=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof t<"u"&&(t.exports=_),Ce=(Je,ot)=>{throw process.exitCode=Je,ot}}else(L||q)&&(q?Le=self.location.href:typeof document<"u"&&document.currentScript&&(Le=document.currentScript.src),Le=Le.startsWith("blob:")?"":Le.slice(0,Le.replace(/[?#].*/,"").lastIndexOf("/")+1),q&&(ze=Je=>{var ot=new XMLHttpRequest;return ot.open("GET",Je,!1),ot.responseType="arraybuffer",ot.send(null),new Uint8Array(ot.response)}),Ge=async Je=>{if(ve(Je))return new Promise((It,qt)=>{var _r=new XMLHttpRequest;_r.open("GET",Je,!0),_r.responseType="arraybuffer",_r.onload=()=>{_r.status==200||_r.status==0&&_r.response?It(_r.response):qt(_r.status)},_r.onerror=qt,_r.send(null)});var ot=await fetch(Je,{credentials:"same-origin"});if(ot.ok)return ot.arrayBuffer();throw Error(ot.status+" : "+ot.url)});var He=_.print||console.log.bind(console),Ve=_.printErr||console.error.bind(console);Object.assign(_,te),te=null,_.thisProgram&&(ne=_.thisProgram);var We=_.wasmBinary,rt,st=!1,ht,je,se,m,A,k,Y,Q,$e,ve=Je=>Je.startsWith("file://");function re(){var Je=rt.buffer;_.HEAP8=je=new Int8Array(Je),_.HEAP16=m=new Int16Array(Je),_.HEAPU8=se=new Uint8Array(Je),_.HEAPU16=new Uint16Array(Je),_.HEAP32=A=new Int32Array(Je),_.HEAPU32=k=new Uint32Array(Je),_.HEAPF32=Y=new Float32Array(Je),_.HEAPF64=$e=new Float64Array(Je),_.HEAP64=Q=new BigInt64Array(Je),_.HEAPU64=new BigUint64Array(Je)}var B=0,oe=null;function Ue(Je){throw _.onAbort?.(Je),Je="Aborted("+Je+")",Ve(Je),st=!0,new WebAssembly.RuntimeError(Je+". Build with -sASSERTIONS for more info.")}var Ze;async function lt(Je){if(!We)try{var ot=await Ge(Je);return new Uint8Array(ot)}catch{}if(Je==Ze&&We)Je=new Uint8Array(We);else if(ze)Je=ze(Je);else throw"both async and sync fetching of the wasm failed";return Je}async function St(Je,ot){try{var It=await lt(Je);return await WebAssembly.instantiate(It,ot)}catch(qt){Ve(`failed to asynchronously prepare wasm: ${qt}`),Ue(qt)}}async function Mt(Je){var ot=Ze;if(!We&&typeof WebAssembly.instantiateStreaming=="function"&&!ve(ot)&&!X)try{var It=fetch(ot,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(It,Je)}catch(qt){Ve(`wasm streaming compile failed: ${qt}`),Ve("falling back to ArrayBuffer instantiation")}return St(ot,Je)}class Ft{name="ExitStatus";constructor(ot){this.message=`Program terminated with exit(${ot})`,this.status=ot}}var Zt=Je=>{for(;0<Je.length;)Je.shift()(_)},Ut=[],vr=[],zr=()=>{var Je=_.preRun.shift();vr.unshift(Je)};function or(Je,ot="i8"){switch(ot.endsWith("*")&&(ot="*"),ot){case"i1":return je[Je];case"i8":return je[Je];case"i16":return m[Je>>1];case"i32":return A[Je>>2];case"i64":return Q[Je>>3];case"float":return Y[Je>>2];case"double":return $e[Je>>3];case"*":return k[Je>>2];default:Ue(`invalid type for getValue: ${ot}`)}}var sr=_.noExitRuntime||!0;function er(Je){var ot="i32";switch(ot.endsWith("*")&&(ot="*"),ot){case"i1":je[Je]=0;break;case"i8":je[Je]=0;break;case"i16":m[Je>>1]=0;break;case"i32":A[Je>>2]=0;break;case"i64":Q[Je>>3]=BigInt(0);break;case"float":Y[Je>>2]=0;break;case"double":$e[Je>>3]=0;break;case"*":k[Je>>2]=0;break;default:Ue(`invalid type for setValue: ${ot}`)}}var Xt=typeof TextDecoder<"u"?new TextDecoder:void 0,nr=(Je,ot=0,It=NaN)=>{var qt=ot+It;for(It=ot;Je[It]&&!(It>=qt);)++It;if(16<It-ot&&Je.buffer&&Xt)return Xt.decode(Je.subarray(ot,It));for(qt="";ot<It;){var _r=Je[ot++];if(_r&128){var Kr=Je[ot++]&63;if((_r&224)==192)qt+=String.fromCharCode((_r&31)<<6|Kr);else{var sn=Je[ot++]&63;_r=(_r&240)==224?(_r&15)<<12|Kr<<6|sn:(_r&7)<<18|Kr<<12|sn<<6|Je[ot++]&63,65536>_r?qt+=String.fromCharCode(_r):(_r-=65536,qt+=String.fromCharCode(55296|_r>>10,56320|_r&1023))}}else qt+=String.fromCharCode(_r)}return qt},Fr=(Je,ot)=>Je?nr(se,Je,ot):"",Ar=(Je,ot)=>{for(var It=0,qt=Je.length-1;0<=qt;qt--){var _r=Je[qt];_r==="."?Je.splice(qt,1):_r===".."?(Je.splice(qt,1),It++):It&&(Je.splice(qt,1),It--)}if(ot)for(;It;It--)Je.unshift("..");return Je},qr=Je=>{var ot=Je.charAt(0)==="/",It=Je.slice(-1)==="/";return(Je=Ar(Je.split("/").filter(qt=>!!qt),!ot).join("/"))||ot||(Je="."),Je&&It&&(Je+="/"),(ot?"/":"")+Je},dn=Je=>{var ot=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(Je).slice(1);return Je=ot[0],ot=ot[1],!Je&&!ot?".":(ot&&=ot.slice(0,-1),Je+ot)},Mr=Je=>Je&&Je.match(/([^\/]+|\/)\/*$/)[1],gr=()=>{if(X){var Je=(init_crypto(),__toCommonJS(exports_crypto));return ot=>Je.randomFillSync(ot)}return ot=>crypto.getRandomValues(ot)},en=Je=>{(en=gr())(Je)},ur=(...Je)=>{for(var ot="",It=!1,qt=Je.length-1;-1<=qt&&!It;qt--){if(It=0<=qt?Je[qt]:"/",typeof It!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!It)return"";ot=It+"/"+ot,It=It.charAt(0)==="/"}return ot=Ar(ot.split("/").filter(_r=>!!_r),!It).join("/"),(It?"/":"")+ot||"."},ar=[],Nr=Je=>{for(var ot=0,It=0;It<Je.length;++It){var qt=Je.charCodeAt(It);127>=qt?ot++:2047>=qt?ot+=2:55296<=qt&&57343>=qt?(ot+=4,++It):ot+=3}return ot},Yt=(Je,ot,It,qt)=>{if(!(0<qt))return 0;var _r=It;qt=It+qt-1;for(var Kr=0;Kr<Je.length;++Kr){var sn=Je.charCodeAt(Kr);if(55296<=sn&&57343>=sn){var wn=Je.charCodeAt(++Kr);sn=65536+((sn&1023)<<10)|wn&1023}if(127>=sn){if(It>=qt)break;ot[It++]=sn}else{if(2047>=sn){if(It+1>=qt)break;ot[It++]=192|sn>>6}else{if(65535>=sn){if(It+2>=qt)break;ot[It++]=224|sn>>12}else{if(It+3>=qt)break;ot[It++]=240|sn>>18,ot[It++]=128|sn>>12&63}ot[It++]=128|sn>>6&63}ot[It++]=128|sn&63}}return ot[It]=0,It-_r},Ir=(Je,ot)=>{var It=Array(Nr(Je)+1);return Je=Yt(Je,It,0,It.length),ot&&(It.length=Je),It},Qe=[];function nt(Je,ot){Qe[Je]={input:[],output:[],cb:ot},Mn(Je,_t)}var _t={open(Je){var ot=Qe[Je.node.rdev];if(!ot)throw new Br(43);Je.tty=ot,Je.seekable=!1},close(Je){Je.tty.cb.fsync(Je.tty)},fsync(Je){Je.tty.cb.fsync(Je.tty)},read(Je,ot,It,qt){if(!Je.tty||!Je.tty.cb.xb)throw new Br(60);for(var _r=0,Kr=0;Kr<qt;Kr++){try{var sn=Je.tty.cb.xb(Je.tty)}catch{throw new Br(29)}if(sn===void 0&&_r===0)throw new Br(6);if(sn==null)break;_r++,ot[It+Kr]=sn}return _r&&(Je.node.atime=Date.now()),_r},write(Je,ot,It,qt){if(!Je.tty||!Je.tty.cb.qb)throw new Br(60);try{for(var _r=0;_r<qt;_r++)Je.tty.cb.qb(Je.tty,ot[It+_r])}catch{throw new Br(29)}return qt&&(Je.node.mtime=Je.node.ctime=Date.now()),_r}},Bt={xb(){e:{if(!ar.length){var Je=null;if(X){var ot=Buffer.alloc(256),It=0,qt=process.stdin.fd;try{It=Xe.readSync(qt,ot,0,256)}catch(_r){if(_r.toString().includes("EOF"))It=0;else throw _r}0<It&&(Je=ot.slice(0,It).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(Je=window.prompt("Input: "),Je!==null&&(Je+=`
`));if(!Je){Je=null;break e}ar=Ir(Je,!0)}Je=ar.shift()}return Je},qb(Je,ot){ot===null||ot===10?(He(nr(Je.output)),Je.output=[]):ot!=0&&Je.output.push(ot)},fsync(Je){0<Je.output?.length&&(He(nr(Je.output)),Je.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},Jt={qb(Je,ot){ot===null||ot===10?(Ve(nr(Je.output)),Je.output=[]):ot!=0&&Je.output.push(ot)},fsync(Je){0<Je.output?.length&&(Ve(nr(Je.output)),Je.output=[])}},xt={Wa:null,Xa(){return xt.createNode(null,"/",16895,0)},createNode(Je,ot,It,qt){if((It&61440)===24576||(It&61440)===4096)throw new Br(63);return xt.Wa||(xt.Wa={dir:{node:{Ta:xt.La.Ta,Ua:xt.La.Ua,lookup:xt.La.lookup,hb:xt.La.hb,rename:xt.La.rename,unlink:xt.La.unlink,rmdir:xt.La.rmdir,readdir:xt.La.readdir,symlink:xt.La.symlink},stream:{Va:xt.Ma.Va}},file:{node:{Ta:xt.La.Ta,Ua:xt.La.Ua},stream:{Va:xt.Ma.Va,read:xt.Ma.read,write:xt.Ma.write,ib:xt.Ma.ib,jb:xt.Ma.jb}},link:{node:{Ta:xt.La.Ta,Ua:xt.La.Ua,readlink:xt.La.readlink},stream:{}},ub:{node:{Ta:xt.La.Ta,Ua:xt.La.Ua},stream:_n}}),It=Ur(Je,ot,It,qt),cr(It.mode)?(It.La=xt.Wa.dir.node,It.Ma=xt.Wa.dir.stream,It.Na={}):(It.mode&61440)===32768?(It.La=xt.Wa.file.node,It.Ma=xt.Wa.file.stream,It.Ra=0,It.Na=null):(It.mode&61440)===40960?(It.La=xt.Wa.link.node,It.Ma=xt.Wa.link.stream):(It.mode&61440)===8192&&(It.La=xt.Wa.ub.node,It.Ma=xt.Wa.ub.stream),It.atime=It.mtime=It.ctime=Date.now(),Je&&(Je.Na[ot]=It,Je.atime=Je.mtime=Je.ctime=It.atime),It},Sb(Je){return Je.Na?Je.Na.subarray?Je.Na.subarray(0,Je.Ra):new Uint8Array(Je.Na):new Uint8Array(0)},La:{Ta(Je){var ot={};return ot.dev=(Je.mode&61440)===8192?Je.id:1,ot.ino=Je.id,ot.mode=Je.mode,ot.nlink=1,ot.uid=0,ot.gid=0,ot.rdev=Je.rdev,cr(Je.mode)?ot.size=4096:(Je.mode&61440)===32768?ot.size=Je.Ra:(Je.mode&61440)===40960?ot.size=Je.link.length:ot.size=0,ot.atime=new Date(Je.atime),ot.mtime=new Date(Je.mtime),ot.ctime=new Date(Je.ctime),ot.blksize=4096,ot.blocks=Math.ceil(ot.size/ot.blksize),ot},Ua(Je,ot){for(var It of["mode","atime","mtime","ctime"])ot[It]!=null&&(Je[It]=ot[It]);ot.size!==void 0&&(ot=ot.size,Je.Ra!=ot&&(ot==0?(Je.Na=null,Je.Ra=0):(It=Je.Na,Je.Na=new Uint8Array(ot),It&&Je.Na.set(It.subarray(0,Math.min(ot,Je.Ra))),Je.Ra=ot)))},lookup(){throw xt.vb},hb(Je,ot,It,qt){return xt.createNode(Je,ot,It,qt)},rename(Je,ot,It){try{var qt=Rr(ot,It)}catch{}if(qt){if(cr(Je.mode))for(var _r in qt.Na)throw new Br(55);an(qt)}delete Je.parent.Na[Je.name],ot.Na[It]=Je,Je.name=It,ot.ctime=ot.mtime=Je.parent.ctime=Je.parent.mtime=Date.now()},unlink(Je,ot){delete Je.Na[ot],Je.ctime=Je.mtime=Date.now()},rmdir(Je,ot){var It=Rr(Je,ot),qt;for(qt in It.Na)throw new Br(55);delete Je.Na[ot],Je.ctime=Je.mtime=Date.now()},readdir(Je){return[".","..",...Object.keys(Je.Na)]},symlink(Je,ot,It){return Je=xt.createNode(Je,ot,41471,0),Je.link=It,Je},readlink(Je){if((Je.mode&61440)!==40960)throw new Br(28);return Je.link}},Ma:{read(Je,ot,It,qt,_r){var Kr=Je.node.Na;if(_r>=Je.node.Ra)return 0;if(Je=Math.min(Je.node.Ra-_r,qt),8<Je&&Kr.subarray)ot.set(Kr.subarray(_r,_r+Je),It);else for(qt=0;qt<Je;qt++)ot[It+qt]=Kr[_r+qt];return Je},write(Je,ot,It,qt,_r,Kr){if(ot.buffer===je.buffer&&(Kr=!1),!qt)return 0;if(Je=Je.node,Je.mtime=Je.ctime=Date.now(),ot.subarray&&(!Je.Na||Je.Na.subarray)){if(Kr)return Je.Na=ot.subarray(It,It+qt),Je.Ra=qt;if(Je.Ra===0&&_r===0)return Je.Na=ot.slice(It,It+qt),Je.Ra=qt;if(_r+qt<=Je.Ra)return Je.Na.set(ot.subarray(It,It+qt),_r),qt}Kr=_r+qt;var sn=Je.Na?Je.Na.length:0;if(sn>=Kr||(Kr=Math.max(Kr,sn*(1048576>sn?2:1.125)>>>0),sn!=0&&(Kr=Math.max(Kr,256)),sn=Je.Na,Je.Na=new Uint8Array(Kr),0<Je.Ra&&Je.Na.set(sn.subarray(0,Je.Ra),0)),Je.Na.subarray&&ot.subarray)Je.Na.set(ot.subarray(It,It+qt),_r);else for(Kr=0;Kr<qt;Kr++)Je.Na[_r+Kr]=ot[It+Kr];return Je.Ra=Math.max(Je.Ra,_r+qt),qt},Va(Je,ot,It){if(It===1?ot+=Je.position:It===2&&(Je.node.mode&61440)===32768&&(ot+=Je.node.Ra),0>ot)throw new Br(28);return ot},ib(Je,ot,It,qt,_r){if((Je.node.mode&61440)!==32768)throw new Br(43);if(Je=Je.node.Na,_r&2||!Je||Je.buffer!==je.buffer){_r=!0,qt=65536*Math.ceil(ot/65536);var Kr=Hi(65536,qt);if(Kr&&se.fill(0,Kr,Kr+qt),qt=Kr,!qt)throw new Br(48);Je&&((0<It||It+ot<Je.length)&&(Je.subarray?Je=Je.subarray(It,It+ot):Je=Array.prototype.slice.call(Je,It,It+ot)),je.set(Je,qt))}else _r=!1,qt=Je.byteOffset;return{Kb:qt,Ab:_r}},jb(Je,ot,It,qt){return xt.Ma.write(Je,ot,0,qt,It,!1),0}}},mr=(Je,ot)=>{var It=0;return Je&&(It|=365),ot&&(It|=146),It},xr=null,wr={},nn=[],Cr=1,Zr=null,pn=!1,yr=!0,Tr={},Br=class{name="ErrnoError";constructor(Je){this.Pa=Je}},Jr=class{gb={};node=null;get flags(){return this.gb.flags}set flags(Je){this.gb.flags=Je}get position(){return this.gb.position}set position(Je){this.gb.position=Je}},rn=class{La={};Ma={};ab=null;constructor(Je,ot,It,qt){Je||=this,this.parent=Je,this.Xa=Je.Xa,this.id=Cr++,this.name=ot,this.mode=It,this.rdev=qt,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(Je){Je?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(Je){Je?this.mode|=146:this.mode&=-147}};function dr(Je,ot={}){if(!Je)throw new Br(44);ot.nb??(ot.nb=!0),Je.charAt(0)==="/"||(Je="//"+Je);var It=0;e:for(;40>It;It++){Je=Je.split("/").filter(wn=>!!wn);for(var qt=xr,_r="/",Kr=0;Kr<Je.length;Kr++){var sn=Kr===Je.length-1;if(sn&&ot.parent)break;if(Je[Kr]!==".")if(Je[Kr]==="..")_r=dn(_r),qt=qt.parent;else{_r=qr(_r+"/"+Je[Kr]);try{qt=Rr(qt,Je[Kr])}catch(wn){if(wn?.Pa===44&&sn&&ot.Jb)return{path:_r};throw wn}if(!qt.ab||sn&&!ot.nb||(qt=qt.ab.root),(qt.mode&61440)===40960&&(!sn||ot.$a)){if(!qt.La.readlink)throw new Br(52);qt=qt.La.readlink(qt),qt.charAt(0)==="/"||(qt=dn(_r)+"/"+qt),Je=qt+"/"+Je.slice(Kr+1).join("/");continue e}}}return{path:_r,node:qt}}throw new Br(32)}function ir(Je){for(var ot;;){if(Je===Je.parent)return Je=Je.Xa.zb,ot?Je[Je.length-1]!=="/"?`${Je}/${ot}`:Je+ot:Je;ot=ot?`${Je.name}/${ot}`:Je.name,Je=Je.parent}}function Er(Je,ot){for(var It=0,qt=0;qt<ot.length;qt++)It=(It<<5)-It+ot.charCodeAt(qt)|0;return(Je+It>>>0)%Zr.length}function an(Je){var ot=Er(Je.parent.id,Je.name);if(Zr[ot]===Je)Zr[ot]=Je.bb;else for(ot=Zr[ot];ot;){if(ot.bb===Je){ot.bb=Je.bb;break}ot=ot.bb}}function Rr(Je,ot){var It=cr(Je.mode)?(It=Lr(Je,"x"))?It:Je.La.lookup?0:2:54;if(It)throw new Br(It);for(It=Zr[Er(Je.id,ot)];It;It=It.bb){var qt=It.name;if(It.parent.id===Je.id&&qt===ot)return It}return Je.La.lookup(Je,ot)}function Ur(Je,ot,It,qt){return Je=new rn(Je,ot,It,qt),ot=Er(Je.parent.id,Je.name),Je.bb=Zr[ot],Zr[ot]=Je}function cr(Je){return(Je&61440)===16384}function Sr(Je){var ot=["r","w","rw"][Je&3];return Je&512&&(ot+="w"),ot}function Lr(Je,ot){if(yr)return 0;if(!ot.includes("r")||Je.mode&292){if(ot.includes("w")&&!(Je.mode&146)||ot.includes("x")&&!(Je.mode&73))return 2}else return 2;return 0}function Qr(Je,ot){if(!cr(Je.mode))return 54;try{return Rr(Je,ot),20}catch{}return Lr(Je,"wx")}function tn(Je,ot,It){try{var qt=Rr(Je,ot)}catch(_r){return _r.Pa}if(Je=Lr(Je,"wx"))return Je;if(It){if(!cr(qt.mode))return 54;if(qt===qt.parent||ir(qt)==="/")return 10}else if(cr(qt.mode))return 31;return 0}function hn(Je){if(!Je)throw new Br(63);return Je}function gn(Je){if(Je=nn[Je],!Je)throw new Br(8);return Je}function on(Je,ot=-1){if(Je=Object.assign(new Jr,Je),ot==-1)e:{for(ot=0;4096>=ot;ot++)if(!nn[ot])break e;throw new Br(33)}return Je.fd=ot,nn[ot]=Je}function cn(Je,ot=-1){return Je=on(Je,ot),Je.Ma?.Rb?.(Je),Je}function vn(Je,ot,It){var qt=Je?.Ma.Ua;Je=qt?Je:ot,qt??=ot.La.Ua,hn(qt),qt(Je,It)}var _n={open(Je){Je.Ma=wr[Je.node.rdev].Ma,Je.Ma.open?.(Je)},Va(){throw new Br(70)}};function Mn(Je,ot){wr[Je]={Ma:ot}}function xn(Je,ot){var It=ot==="/";if(It&&xr)throw new Br(10);if(!It&&ot){var qt=dr(ot,{nb:!1});if(ot=qt.path,qt=qt.node,qt.ab)throw new Br(10);if(!cr(qt.mode))throw new Br(54)}ot={type:Je,Wb:{},zb:ot,Ib:[]},Je=Je.Xa(ot),Je.Xa=ot,ot.root=Je,It?xr=Je:qt&&(qt.ab=ot,qt.Xa&&qt.Xa.Ib.push(ot))}function Nn(Je,ot,It){var qt=dr(Je,{parent:!0}).node;if(Je=Mr(Je),!Je)throw new Br(28);if(Je==="."||Je==="..")throw new Br(20);var _r=Qr(qt,Je);if(_r)throw new Br(_r);if(!qt.La.hb)throw new Br(63);return qt.La.hb(qt,Je,ot,It)}function zn(Je,ot=438){return Nn(Je,ot&4095|32768,0)}function An(Je,ot=511){return Nn(Je,ot&1023|16384,0)}function Bn(Je,ot,It){typeof It>"u"&&(It=ot,ot=438),Nn(Je,ot|8192,It)}function Dn(Je,ot){if(!ur(Je))throw new Br(44);var It=dr(ot,{parent:!0}).node;if(!It)throw new Br(44);ot=Mr(ot);var qt=Qr(It,ot);if(qt)throw new Br(qt);if(!It.La.symlink)throw new Br(63);It.La.symlink(It,ot,Je)}function Hn(Je){var ot=dr(Je,{parent:!0}).node;Je=Mr(Je);var It=Rr(ot,Je),qt=tn(ot,Je,!0);if(qt)throw new Br(qt);if(!ot.La.rmdir)throw new Br(63);if(It.ab)throw new Br(10);ot.La.rmdir(ot,Je),an(It)}function On(Je){var ot=dr(Je,{parent:!0}).node;if(!ot)throw new Br(44);Je=Mr(Je);var It=Rr(ot,Je),qt=tn(ot,Je,!1);if(qt)throw new Br(qt);if(!ot.La.unlink)throw new Br(63);if(It.ab)throw new Br(10);ot.La.unlink(ot,Je),an(It)}function Rn(Je,ot){return Je=dr(Je,{$a:!ot}).node,hn(Je.La.Ta)(Je)}function qn(Je,ot,It,qt){vn(Je,ot,{mode:It&4095|ot.mode&-4096,ctime:Date.now(),Fb:qt})}function In(Je,ot){Je=typeof Je=="string"?dr(Je,{$a:!0}).node:Je,qn(null,Je,ot)}function Pn(Je,ot,It){if(cr(ot.mode))throw new Br(31);if((ot.mode&61440)!==32768)throw new Br(28);var qt=Lr(ot,"w");if(qt)throw new Br(qt);vn(Je,ot,{size:It,timestamp:Date.now()})}function Cn(Je,ot,It=438){if(Je==="")throw new Br(44);if(typeof ot=="string"){var qt={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[ot];if(typeof qt>"u")throw Error(`Unknown file open mode: ${ot}`);ot=qt}if(It=ot&64?It&4095|32768:0,typeof Je=="object")qt=Je;else{var _r=Je.endsWith("/");Je=dr(Je,{$a:!(ot&131072),Jb:!0}),qt=Je.node,Je=Je.path}var Kr=!1;if(ot&64)if(qt){if(ot&128)throw new Br(20)}else{if(_r)throw new Br(31);qt=Nn(Je,It|511,0),Kr=!0}if(!qt)throw new Br(44);if((qt.mode&61440)===8192&&(ot&=-513),ot&65536&&!cr(qt.mode))throw new Br(54);if(!Kr&&(_r=qt?(qt.mode&61440)===40960?32:cr(qt.mode)&&(Sr(ot)!=="r"||ot&576)?31:Lr(qt,Sr(ot)):44))throw new Br(_r);return ot&512&&!Kr&&(_r=qt,_r=typeof _r=="string"?dr(_r,{$a:!0}).node:_r,Pn(null,_r,0)),ot&=-131713,_r=on({node:qt,path:ir(qt),flags:ot,seekable:!0,position:0,Ma:qt.Ma,Lb:[],error:!1}),_r.Ma.open&&_r.Ma.open(_r),Kr&&In(qt,It&511),!_.logReadFiles||ot&1||Je in Tr||(Tr[Je]=1),_r}function Fn(Je){if(Je.fd===null)throw new Br(8);Je.ob&&(Je.ob=null);try{Je.Ma.close&&Je.Ma.close(Je)}catch(ot){throw ot}finally{nn[Je.fd]=null}Je.fd=null}function Ln(Je,ot,It){if(Je.fd===null)throw new Br(8);if(!Je.seekable||!Je.Ma.Va)throw new Br(70);if(It!=0&&It!=1&&It!=2)throw new Br(28);Je.position=Je.Ma.Va(Je,ot,It),Je.Lb=[]}function Un(Je,ot,It,qt,_r){if(0>qt||0>_r)throw new Br(28);if(Je.fd===null)throw new Br(8);if((Je.flags&2097155)===1)throw new Br(8);if(cr(Je.node.mode))throw new Br(31);if(!Je.Ma.read)throw new Br(28);var Kr=typeof _r<"u";if(!Kr)_r=Je.position;else if(!Je.seekable)throw new Br(70);return ot=Je.Ma.read(Je,ot,It,qt,_r),Kr||(Je.position+=ot),ot}function rr(Je,ot,It,qt,_r){if(0>qt||0>_r)throw new Br(28);if(Je.fd===null)throw new Br(8);if((Je.flags&2097155)===0)throw new Br(8);if(cr(Je.node.mode))throw new Br(31);if(!Je.Ma.write)throw new Br(28);Je.seekable&&Je.flags&1024&&Ln(Je,0,2);var Kr=typeof _r<"u";if(!Kr)_r=Je.position;else if(!Je.seekable)throw new Br(70);return ot=Je.Ma.write(Je,ot,It,qt,_r,void 0),Kr||(Je.position+=ot),ot}function lr(Je){var ot,It=Cn(Je,It||0);Je=Rn(Je).size;var qt=new Uint8Array(Je);return Un(It,qt,0,Je,0),ot=qt,Fn(It),ot}function fn(Je,ot,It){Je=qr("/dev/"+Je);var qt=mr(!!ot,!!It);fn.yb??(fn.yb=64);var _r=fn.yb++<<8|0;Mn(_r,{open(Kr){Kr.seekable=!1},close(){It?.buffer?.length&&It(10)},read(Kr,sn,wn,Sn){for(var kn=0,Vn=0;Vn<Sn;Vn++){try{var Kn=ot()}catch{throw new Br(29)}if(Kn===void 0&&kn===0)throw new Br(6);if(Kn==null)break;kn++,sn[wn+Vn]=Kn}return kn&&(Kr.node.atime=Date.now()),kn},write(Kr,sn,wn,Sn){for(var kn=0;kn<Sn;kn++)try{It(sn[wn+kn])}catch{throw new Br(29)}return Sn&&(Kr.node.mtime=Kr.node.ctime=Date.now()),kn}}),Bn(Je,qt,_r)}var un={};function yn(Je,ot,It){if(ot.charAt(0)==="/")return ot;if(Je=Je===-100?"/":gn(Je).path,ot.length==0){if(!It)throw new Br(44);return Je}return Je+"/"+ot}function Wn(Je,ot){A[Je>>2]=ot.dev,A[Je+4>>2]=ot.mode,k[Je+8>>2]=ot.nlink,A[Je+12>>2]=ot.uid,A[Je+16>>2]=ot.gid,A[Je+20>>2]=ot.rdev,Q[Je+24>>3]=BigInt(ot.size),A[Je+32>>2]=4096,A[Je+36>>2]=ot.blocks;var It=ot.atime.getTime(),qt=ot.mtime.getTime(),_r=ot.ctime.getTime();return Q[Je+40>>3]=BigInt(Math.floor(It/1e3)),k[Je+48>>2]=It%1e3*1e6,Q[Je+56>>3]=BigInt(Math.floor(qt/1e3)),k[Je+64>>2]=qt%1e3*1e6,Q[Je+72>>3]=BigInt(Math.floor(_r/1e3)),k[Je+80>>2]=_r%1e3*1e6,Q[Je+88>>3]=BigInt(ot.ino),0}var jn=void 0,Zn=()=>{var Je=A[+jn>>2];return jn+=4,Je},fi=0,Mi=[0,31,60,91,121,152,182,213,244,274,305,335],bi=[0,31,59,90,120,151,181,212,243,273,304,334],ri={},di=Je=>{ht=Je,sr||0<fi||(_.onExit?.(Je),st=!0),Ce(Je,new Ft(Je))},pi=Je=>{if(!st)try{if(Je(),!(sr||0<fi))try{ht=Je=ht,di(Je)}catch(ot){ot instanceof Ft||ot=="unwind"||Ce(1,ot)}}catch(ot){ot instanceof Ft||ot=="unwind"||Ce(1,ot)}},oi={},ni=()=>{if(!Xn){var Je={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:ne||"./this.program"},ot;for(ot in oi)oi[ot]===void 0?delete Je[ot]:Je[ot]=oi[ot];var It=[];for(ot in Je)It.push(`${ot}=${Je[ot]}`);Xn=It}return Xn},Xn,Gn=Je=>{var ot=Nr(Je)+1,It=si(ot);return Yt(Je,se,It,ot),It},ha=(Je,ot,It,qt)=>{var _r={string:kn=>{var Vn=0;return kn!=null&&kn!==0&&(Vn=Gn(kn)),Vn},array:kn=>{var Vn=si(kn.length);return je.set(kn,Vn),Vn}};Je=_["_"+Je];var Kr=[],sn=0;if(qt)for(var wn=0;wn<qt.length;wn++){var Sn=_r[It[wn]];Sn?(sn===0&&(sn=mi()),Kr[wn]=Sn(qt[wn])):Kr[wn]=qt[wn]}return It=Je(...Kr),It=(function(kn){return sn!==0&&yi(sn),ot==="string"?kn?nr(se,kn):"":ot==="boolean"?!!kn:kn})(It)},wi=0,vi=(Je,ot)=>(ot=ot==1?si(Je.length):Ci(Je.length),Je.subarray||Je.slice||(Je=new Uint8Array(Je)),se.set(Je,ot),ot),ai,Ri=[],ti,ii=Je=>{ai.delete(ti.get(Je)),ti.set(Je,null),Ri.push(Je)},gi=(Je,ot)=>{if(!ai){ai=new WeakMap;var It=ti.length;if(ai)for(var qt=0;qt<0+It;qt++){var _r=ti.get(qt);_r&&ai.set(_r,qt)}}if(It=ai.get(Je)||0)return It;if(Ri.length)It=Ri.pop();else{try{ti.grow(1)}catch(Sn){throw Sn instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":Sn}It=ti.length-1}try{ti.set(It,Je)}catch(Sn){if(!(Sn instanceof TypeError))throw Sn;if(typeof WebAssembly.Function=="function"){var Kr=WebAssembly.Function;qt={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},_r={parameters:[],results:ot[0]=="v"?[]:[qt[ot[0]]]};for(var sn=1;sn<ot.length;++sn)_r.parameters.push(qt[ot[sn]]);ot=new Kr(_r,Je)}else{qt=[1],_r=ot.slice(0,1),ot=ot.slice(1),sn={i:127,p:127,j:126,f:125,d:124,e:111},qt.push(96);var wn=ot.length;128>wn?qt.push(wn):qt.push(wn%128|128,wn>>7);for(Kr of ot)qt.push(sn[Kr]);_r=="v"?qt.push(0):qt.push(1,sn[_r]),ot=[0,97,115,109,1,0,0,0,1],Kr=qt.length,128>Kr?ot.push(Kr):ot.push(Kr%128|128,Kr>>7),ot.push(...qt),ot.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),ot=new WebAssembly.Module(new Uint8Array(ot)),ot=new WebAssembly.Instance(ot,{e:{f:Je}}).exports.f}ti.set(It,ot)}return ai.set(Je,It),It};Zr=Array(4096),xn(xt,"/"),An("/tmp"),An("/home"),An("/home/web_user"),(function(){An("/dev"),Mn(259,{read:()=>0,write:(qt,_r,Kr,sn)=>sn,Va:()=>0}),Bn("/dev/null",259),nt(1280,Bt),nt(1536,Jt),Bn("/dev/tty",1280),Bn("/dev/tty1",1536);var Je=new Uint8Array(1024),ot=0,It=()=>(ot===0&&(en(Je),ot=Je.byteLength),Je[--ot]);fn("random",It),fn("urandom",It),An("/dev/shm"),An("/dev/shm/tmp")})(),(function(){An("/proc");var Je=An("/proc/self");An("/proc/self/fd"),xn({Xa(){var ot=Ur(Je,"fd",16895,73);return ot.Ma={Va:xt.Ma.Va},ot.La={lookup(It,qt){It=+qt;var _r=gn(It);return It={parent:null,Xa:{zb:"fake"},La:{readlink:()=>_r.path},id:It+1},It.parent=It},readdir(){return Array.from(nn.entries()).filter(([,It])=>It).map(([It])=>It.toString())}},ot}},"/proc/self/fd")})(),xt.vb=new Br(44),xt.vb.stack="<generic error, no stack>";var fa={a:(Je,ot,It,qt)=>Ue(`Assertion failed: ${Je?nr(se,Je):""}, at: `+[ot?ot?nr(se,ot):"":"unknown filename",It,qt?qt?nr(se,qt):"":"unknown function"]),i:function(Je,ot){try{return Je=Je?nr(se,Je):"",In(Je,ot),0}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return-It.Pa}},L:function(Je,ot,It){try{if(ot=ot?nr(se,ot):"",ot=yn(Je,ot),It&-8)return-28;var qt=dr(ot,{$a:!0}).node;return qt?(Je="",It&4&&(Je+="r"),It&2&&(Je+="w"),It&1&&(Je+="x"),Je&&Lr(qt,Je)?-2:0):-44}catch(_r){if(typeof un>"u"||_r.name!=="ErrnoError")throw _r;return-_r.Pa}},j:function(Je,ot){try{var It=gn(Je);return qn(It,It.node,ot,!1),0}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Pa}},h:function(Je){try{var ot=gn(Je);return vn(ot,ot.node,{timestamp:Date.now(),Fb:!1}),0}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return-It.Pa}},b:function(Je,ot,It){jn=It;try{var qt=gn(Je);switch(ot){case 0:var _r=Zn();if(0>_r)break;for(;nn[_r];)_r++;return cn(qt,_r).fd;case 1:case 2:return 0;case 3:return qt.flags;case 4:return _r=Zn(),qt.flags|=_r,0;case 12:return _r=Zn(),m[_r+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(Kr){if(typeof un>"u"||Kr.name!=="ErrnoError")throw Kr;return-Kr.Pa}},g:function(Je,ot){try{var It=gn(Je),qt=It.node,_r=It.Ma.Ta;Je=_r?It:qt,_r??=qt.La.Ta,hn(_r);var Kr=_r(Je);return Wn(ot,Kr)}catch(sn){if(typeof un>"u"||sn.name!=="ErrnoError")throw sn;return-sn.Pa}},H:function(Je,ot){ot=-9007199254740992>ot||9007199254740992<ot?NaN:Number(ot);try{if(isNaN(ot))return 61;var It=gn(Je);if(0>ot||(It.flags&2097155)===0)throw new Br(28);return Pn(It,It.node,ot),0}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Pa}},G:function(Je,ot){try{if(ot===0)return-28;var It=Nr("/")+1;return ot<It?-68:(Yt("/",se,Je,ot),It)}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Pa}},K:function(Je,ot){try{return Je=Je?nr(se,Je):"",Wn(ot,Rn(Je,!0))}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return-It.Pa}},C:function(Je,ot,It){try{return ot=ot?nr(se,ot):"",ot=yn(Je,ot),An(ot,It),0}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Pa}},J:function(Je,ot,It,qt){try{ot=ot?nr(se,ot):"";var _r=qt&256;return ot=yn(Je,ot,qt&4096),Wn(It,_r?Rn(ot,!0):Rn(ot))}catch(Kr){if(typeof un>"u"||Kr.name!=="ErrnoError")throw Kr;return-Kr.Pa}},x:function(Je,ot,It,qt){jn=qt;try{ot=ot?nr(se,ot):"",ot=yn(Je,ot);var _r=qt?Zn():0;return Cn(ot,It,_r).fd}catch(Kr){if(typeof un>"u"||Kr.name!=="ErrnoError")throw Kr;return-Kr.Pa}},v:function(Je,ot,It,qt){try{if(ot=ot?nr(se,ot):"",ot=yn(Je,ot),0>=qt)return-28;var _r=dr(ot).node;if(!_r)throw new Br(44);if(!_r.La.readlink)throw new Br(28);var Kr=_r.La.readlink(_r),sn=Math.min(qt,Nr(Kr)),wn=je[It+sn];return Yt(Kr,se,It,qt+1),je[It+sn]=wn,sn}catch(Sn){if(typeof un>"u"||Sn.name!=="ErrnoError")throw Sn;return-Sn.Pa}},u:function(Je){try{return Je=Je?nr(se,Je):"",Hn(Je),0}catch(ot){if(typeof un>"u"||ot.name!=="ErrnoError")throw ot;return-ot.Pa}},f:function(Je,ot){try{return Je=Je?nr(se,Je):"",Wn(ot,Rn(Je))}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return-It.Pa}},r:function(Je,ot,It){try{return ot=ot?nr(se,ot):"",ot=yn(Je,ot),It===0?On(ot):It===512?Hn(ot):Ue("Invalid flags passed to unlinkat"),0}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return-qt.Pa}},q:function(Je,ot,It){try{ot=ot?nr(se,ot):"",ot=yn(Je,ot,!0);var qt=Date.now(),_r,Kr;if(It){var sn=k[It>>2]+4294967296*A[It+4>>2],wn=A[It+8>>2];wn==1073741823?_r=qt:wn==1073741822?_r=null:_r=1e3*sn+wn/1e6,It+=16,sn=k[It>>2]+4294967296*A[It+4>>2],wn=A[It+8>>2],wn==1073741823?Kr=qt:wn==1073741822?Kr=null:Kr=1e3*sn+wn/1e6}else Kr=_r=qt;if((Kr??_r)!==null){Je=_r;var Sn=dr(ot,{$a:!0}).node;hn(Sn.La.Ua)(Sn,{atime:Je,mtime:Kr})}return 0}catch(kn){if(typeof un>"u"||kn.name!=="ErrnoError")throw kn;return-kn.Pa}},m:()=>Ue(""),l:()=>{sr=!1,fi=0},A:function(Je,ot){Je=-9007199254740992>Je||9007199254740992<Je?NaN:Number(Je),Je=new Date(1e3*Je),A[ot>>2]=Je.getSeconds(),A[ot+4>>2]=Je.getMinutes(),A[ot+8>>2]=Je.getHours(),A[ot+12>>2]=Je.getDate(),A[ot+16>>2]=Je.getMonth(),A[ot+20>>2]=Je.getFullYear()-1900,A[ot+24>>2]=Je.getDay();var It=Je.getFullYear();A[ot+28>>2]=(It%4!==0||It%100===0&&It%400!==0?bi:Mi)[Je.getMonth()]+Je.getDate()-1|0,A[ot+36>>2]=-(60*Je.getTimezoneOffset()),It=new Date(Je.getFullYear(),6,1).getTimezoneOffset();var qt=new Date(Je.getFullYear(),0,1).getTimezoneOffset();A[ot+32>>2]=(It!=qt&&Je.getTimezoneOffset()==Math.min(qt,It))|0},y:function(Je,ot,It,qt,_r,Kr,sn){_r=-9007199254740992>_r||9007199254740992<_r?NaN:Number(_r);try{if(isNaN(_r))return 61;var wn=gn(qt);if((ot&2)!==0&&(It&2)===0&&(wn.flags&2097155)!==2)throw new Br(2);if((wn.flags&2097155)===1)throw new Br(2);if(!wn.Ma.ib)throw new Br(43);if(!Je)throw new Br(28);var Sn=wn.Ma.ib(wn,Je,_r,ot,It),kn=Sn.Kb;return A[Kr>>2]=Sn.Ab,k[sn>>2]=kn,0}catch(Vn){if(typeof un>"u"||Vn.name!=="ErrnoError")throw Vn;return-Vn.Pa}},z:function(Je,ot,It,qt,_r,Kr){Kr=-9007199254740992>Kr||9007199254740992<Kr?NaN:Number(Kr);try{var sn=gn(_r);if(It&2){if(It=Kr,(sn.node.mode&61440)!==32768)throw new Br(43);if(!(qt&2)){var wn=se.slice(Je,Je+ot);sn.Ma.jb&&sn.Ma.jb(sn,wn,It,ot,qt)}}}catch(Sn){if(typeof un>"u"||Sn.name!=="ErrnoError")throw Sn;return-Sn.Pa}},n:(Je,ot)=>{if(ri[Je]&&(clearTimeout(ri[Je].id),delete ri[Je]),!ot)return 0;var It=setTimeout(()=>{delete ri[Je],pi(()=>qi(Je,performance.now()))},ot);return ri[Je]={id:It,Xb:ot},0},B:(Je,ot,It,qt)=>{var _r=new Date().getFullYear(),Kr=new Date(_r,0,1).getTimezoneOffset();_r=new Date(_r,6,1).getTimezoneOffset(),k[Je>>2]=60*Math.max(Kr,_r),A[ot>>2]=+(Kr!=_r),ot=sn=>{var wn=Math.abs(sn);return`UTC${0<=sn?"-":"+"}${String(Math.floor(wn/60)).padStart(2,"0")}${String(wn%60).padStart(2,"0")}`},Je=ot(Kr),ot=ot(_r),_r<Kr?(Yt(Je,se,It,17),Yt(ot,se,qt,17)):(Yt(Je,se,qt,17),Yt(ot,se,It,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:Je=>{var ot=se.length;if(Je>>>=0,2147483648<Je)return!1;for(var It=1;4>=It;It*=2){var qt=ot*(1+.2/It);qt=Math.min(qt,Je+100663296);e:{qt=(Math.min(2147483648,65536*Math.ceil(Math.max(Je,qt)/65536))-rt.buffer.byteLength+65535)/65536|0;try{rt.grow(qt),re();var _r=1;break e}catch{}_r=void 0}if(_r)return!0}return!1},E:(Je,ot)=>{var It=0;return ni().forEach((qt,_r)=>{var Kr=ot+It;for(_r=k[Je+4*_r>>2]=Kr,Kr=0;Kr<qt.length;++Kr)je[_r++]=qt.charCodeAt(Kr);je[_r]=0,It+=qt.length+1}),0},F:(Je,ot)=>{var It=ni();k[Je>>2]=It.length;var qt=0;return It.forEach(_r=>qt+=_r.length+1),k[ot>>2]=qt,0},e:function(Je){try{var ot=gn(Je);return Fn(ot),0}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return It.Pa}},p:function(Je,ot){try{var It=gn(Je);return je[ot]=It.tty?2:cr(It.mode)?3:(It.mode&61440)===40960?7:4,m[ot+2>>1]=0,Q[ot+8>>3]=BigInt(0),Q[ot+16>>3]=BigInt(0),0}catch(qt){if(typeof un>"u"||qt.name!=="ErrnoError")throw qt;return qt.Pa}},w:function(Je,ot,It,qt){try{e:{var _r=gn(Je);Je=ot;for(var Kr,sn=ot=0;sn<It;sn++){var wn=k[Je>>2],Sn=k[Je+4>>2];Je+=8;var kn=Un(_r,je,wn,Sn,Kr);if(0>kn){var Vn=-1;break e}if(ot+=kn,kn<Sn)break;typeof Kr<"u"&&(Kr+=kn)}Vn=ot}return k[qt>>2]=Vn,0}catch(Kn){if(typeof un>"u"||Kn.name!=="ErrnoError")throw Kn;return Kn.Pa}},D:function(Je,ot,It,qt){ot=-9007199254740992>ot||9007199254740992<ot?NaN:Number(ot);try{if(isNaN(ot))return 61;var _r=gn(Je);return Ln(_r,ot,It),Q[qt>>3]=BigInt(_r.position),_r.ob&&ot===0&&It===0&&(_r.ob=null),0}catch(Kr){if(typeof un>"u"||Kr.name!=="ErrnoError")throw Kr;return Kr.Pa}},I:function(Je){try{var ot=gn(Je);return ot.Ma?.fsync?ot.Ma.fsync(ot):0}catch(It){if(typeof un>"u"||It.name!=="ErrnoError")throw It;return It.Pa}},t:function(Je,ot,It,qt){try{e:{var _r=gn(Je);Je=ot;for(var Kr,sn=ot=0;sn<It;sn++){var wn=k[Je>>2],Sn=k[Je+4>>2];Je+=8;var kn=rr(_r,je,wn,Sn,Kr);if(0>kn){var Vn=-1;break e}if(ot+=kn,kn<Sn)break;typeof Kr<"u"&&(Kr+=kn)}Vn=ot}return k[qt>>2]=Vn,0}catch(Kn){if(typeof un>"u"||Kn.name!=="ErrnoError")throw Kn;return Kn.Pa}},k:di},bn;(async function(){function Je(It){return bn=It.exports,rt=bn.M,re(),ti=bn.O,B--,_.monitorRunDependencies?.(B),B==0&&oe&&(It=oe,oe=null,It()),bn}B++,_.monitorRunDependencies?.(B);var ot={a:fa};return _.instantiateWasm?new Promise(It=>{_.instantiateWasm(ot,(qt,_r)=>{Je(qt),It(qt.exports)})}):(Ze??=_.locateFile?_.locateFile("sql-wasm.wasm",Le):Le+"sql-wasm.wasm",Je((await Mt(ot)).instance))})(),_._sqlite3_free=Je=>(_._sqlite3_free=bn.P)(Je),_._sqlite3_value_text=Je=>(_._sqlite3_value_text=bn.Q)(Je),_._sqlite3_prepare_v2=(Je,ot,It,qt,_r)=>(_._sqlite3_prepare_v2=bn.R)(Je,ot,It,qt,_r),_._sqlite3_step=Je=>(_._sqlite3_step=bn.S)(Je),_._sqlite3_reset=Je=>(_._sqlite3_reset=bn.T)(Je),_._sqlite3_exec=(Je,ot,It,qt,_r)=>(_._sqlite3_exec=bn.U)(Je,ot,It,qt,_r),_._sqlite3_finalize=Je=>(_._sqlite3_finalize=bn.V)(Je),_._sqlite3_column_name=(Je,ot)=>(_._sqlite3_column_name=bn.W)(Je,ot),_._sqlite3_column_text=(Je,ot)=>(_._sqlite3_column_text=bn.X)(Je,ot),_._sqlite3_column_type=(Je,ot)=>(_._sqlite3_column_type=bn.Y)(Je,ot),_._sqlite3_errmsg=Je=>(_._sqlite3_errmsg=bn.Z)(Je),_._sqlite3_clear_bindings=Je=>(_._sqlite3_clear_bindings=bn._)(Je),_._sqlite3_value_blob=Je=>(_._sqlite3_value_blob=bn.$)(Je),_._sqlite3_value_bytes=Je=>(_._sqlite3_value_bytes=bn.aa)(Je),_._sqlite3_value_double=Je=>(_._sqlite3_value_double=bn.ba)(Je),_._sqlite3_value_int=Je=>(_._sqlite3_value_int=bn.ca)(Je),_._sqlite3_value_type=Je=>(_._sqlite3_value_type=bn.da)(Je),_._sqlite3_result_blob=(Je,ot,It,qt)=>(_._sqlite3_result_blob=bn.ea)(Je,ot,It,qt),_._sqlite3_result_double=(Je,ot)=>(_._sqlite3_result_double=bn.fa)(Je,ot),_._sqlite3_result_error=(Je,ot,It)=>(_._sqlite3_result_error=bn.ga)(Je,ot,It),_._sqlite3_result_int=(Je,ot)=>(_._sqlite3_result_int=bn.ha)(Je,ot),_._sqlite3_result_int64=(Je,ot)=>(_._sqlite3_result_int64=bn.ia)(Je,ot),_._sqlite3_result_null=Je=>(_._sqlite3_result_null=bn.ja)(Je),_._sqlite3_result_text=(Je,ot,It,qt)=>(_._sqlite3_result_text=bn.ka)(Je,ot,It,qt),_._sqlite3_aggregate_context=(Je,ot)=>(_._sqlite3_aggregate_context=bn.la)(Je,ot),_._sqlite3_column_count=Je=>(_._sqlite3_column_count=bn.ma)(Je),_._sqlite3_data_count=Je=>(_._sqlite3_data_count=bn.na)(Je),_._sqlite3_column_blob=(Je,ot)=>(_._sqlite3_column_blob=bn.oa)(Je,ot),_._sqlite3_column_bytes=(Je,ot)=>(_._sqlite3_column_bytes=bn.pa)(Je,ot),_._sqlite3_column_double=(Je,ot)=>(_._sqlite3_column_double=bn.qa)(Je,ot),_._sqlite3_bind_blob=(Je,ot,It,qt,_r)=>(_._sqlite3_bind_blob=bn.ra)(Je,ot,It,qt,_r),_._sqlite3_bind_double=(Je,ot,It)=>(_._sqlite3_bind_double=bn.sa)(Je,ot,It),_._sqlite3_bind_int=(Je,ot,It)=>(_._sqlite3_bind_int=bn.ta)(Je,ot,It),_._sqlite3_bind_text=(Je,ot,It,qt,_r)=>(_._sqlite3_bind_text=bn.ua)(Je,ot,It,qt,_r),_._sqlite3_bind_parameter_index=(Je,ot)=>(_._sqlite3_bind_parameter_index=bn.va)(Je,ot),_._sqlite3_sql=Je=>(_._sqlite3_sql=bn.wa)(Je),_._sqlite3_normalized_sql=Je=>(_._sqlite3_normalized_sql=bn.xa)(Je),_._sqlite3_changes=Je=>(_._sqlite3_changes=bn.ya)(Je),_._sqlite3_close_v2=Je=>(_._sqlite3_close_v2=bn.za)(Je),_._sqlite3_create_function_v2=(Je,ot,It,qt,_r,Kr,sn,wn,Sn)=>(_._sqlite3_create_function_v2=bn.Aa)(Je,ot,It,qt,_r,Kr,sn,wn,Sn),_._sqlite3_update_hook=(Je,ot,It)=>(_._sqlite3_update_hook=bn.Ba)(Je,ot,It),_._sqlite3_open=(Je,ot)=>(_._sqlite3_open=bn.Ca)(Je,ot);var Ci=_._malloc=Je=>(Ci=_._malloc=bn.Da)(Je),Ei=_._free=Je=>(Ei=_._free=bn.Ea)(Je);_._RegisterExtensionFunctions=Je=>(_._RegisterExtensionFunctions=bn.Fa)(Je);var Hi=(Je,ot)=>(Hi=bn.Ga)(Je,ot),qi=(Je,ot)=>(qi=bn.Ha)(Je,ot),yi=Je=>(yi=bn.Ia)(Je),si=Je=>(si=bn.Ja)(Je),mi=()=>(mi=bn.Ka)();_.stackSave=()=>mi(),_.stackRestore=Je=>yi(Je),_.stackAlloc=Je=>si(Je),_.cwrap=(Je,ot,It,qt)=>{var _r=!It||It.every(Kr=>Kr==="number"||Kr==="boolean");return ot!=="string"&&_r&&!qt?_["_"+Je]:(...Kr)=>ha(Je,ot,It,Kr)},_.addFunction=gi,_.removeFunction=ii,_.UTF8ToString=Fr,_.ALLOC_NORMAL=wi,_.allocate=vi,_.allocateUTF8OnStack=Gn;function Ii(){function Je(){if(_.calledRun=!0,!st){if(!_.noFSInit&&!pn){var ot,It;pn=!0,qt??=_.stdin,ot??=_.stdout,It??=_.stderr,qt?fn("stdin",qt):Dn("/dev/tty","/dev/stdin"),ot?fn("stdout",null,ot):Dn("/dev/tty","/dev/stdout"),It?fn("stderr",null,It):Dn("/dev/tty1","/dev/stderr"),Cn("/dev/stdin",0),Cn("/dev/stdout",1),Cn("/dev/stderr",1)}if(bn.N(),yr=!1,_.onRuntimeInitialized?.(),_.postRun)for(typeof _.postRun=="function"&&(_.postRun=[_.postRun]);_.postRun.length;){var qt=_.postRun.shift();Ut.unshift(qt)}Zt(Ut)}}if(0<B)oe=Ii;else{if(_.preRun)for(typeof _.preRun=="function"&&(_.preRun=[_.preRun]);_.preRun.length;)zr();Zt(vr),0<B?oe=Ii:_.setStatus?(_.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>_.setStatus(""),1),Je()},1)):Je()}}if(_.preInit)for(typeof _.preInit=="function"&&(_.preInit=[_.preInit]);0<_.preInit.length;)_.preInit.pop()();return Ii(),g}),s)};typeof r=="object"&&typeof t=="object"?(t.exports=o,t.exports.default=o):typeof define=="function"&&define.amd?define([],function(){return o}):typeof r=="object"&&(r.Module=o)}),require_types=__commonJS(r=>{Object.defineProperty(r,"__esModule",{value:!0})}),require_utils4=__commonJS(r=>{Object.defineProperty(r,"__esModule",{value:!0}),r._fast_remove_single=void 0;function t(n,s){s!==-1&&(s===0?n.shift():s===n.length-1?n.length=n.length-1:n.splice(s,1))}r._fast_remove_single=t}),require_bake_collection=__commonJS((exports,module)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(r){var t="";if(r===0)return t;for(var n=0;n<r-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(r-1),t}function generateBodyPartsCode(r,t){for(var n="",s="",o=0;o<t;++o)n+="var f".concat(o," = collection[").concat(o,`];
`),s+="f".concat(o,"(").concat(r,`)
`);return{funcDefCode:n,funcCallCode:s}}function generateBodyPartsVariadicCode(r){for(var t="",n="",s=0;s<r;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),n+="f".concat(s,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic}),require_task_collection=__commonJS(r=>{var t=r&&r.__spreadArray||function(Xe,He,Ve){if(Ve||arguments.length===2)for(var We=0,rt=He.length,st;We<rt;We++)(st||!(We in He))&&(st||(st=Array.prototype.slice.call(He,0,We)),st[We]=He[We]);return Xe.concat(st||Array.prototype.slice.call(He))};Object.defineProperty(r,"__esModule",{value:!0}),r.TaskCollection=void 0;var n=require_utils4(),s=require_bake_collection();function o(Xe,He){var Ve=this.length;if(Ve>1)if(He){var We;(We=this._tasks).push.apply(We,arguments),this.length+=arguments.length}else this._tasks.push(Xe),this.length++;else if(He){if(Ve===1){var rt=Array(1+arguments.length);rt.push(rt),rt.push.apply(rt,arguments),this._tasks=rt}else{var rt=Array(arguments.length);rt.push.apply(rt,arguments),this._tasks=rt}this.length+=arguments.length}else Ve===1?this._tasks=[this._tasks,Xe]:this._tasks=Xe,this.length++}function a(Xe,He){var Ve=this.length;if(Ve>1)if(He){var We;(We=this._tasks).push.apply(We,arguments),this.length+=arguments.length}else this._tasks.push(Xe),this.length++;else if(He){if(Ve===1){var rt=Array(1+arguments.length);rt.push(rt),rt.push.apply(rt,arguments),this._tasks=rt}else{var rt=Array(arguments.length);rt.push.apply(rt,arguments),this._tasks=rt}this.length+=arguments.length}else Ve===1?this._tasks=[this._tasks,Xe]:this._tasks=Xe,this.length++;this.firstEmitBuildStrategy?this.call=q:this.rebuild()}function c(Xe){this.length!==0&&(this.length===1?this._tasks===Xe&&(this.length=0):((0,n._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(Xe)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function f(Xe){if(this.length!==0){if(this.length===1)if(this._tasks===Xe&&(this.length=0),this.firstEmitBuildStrategy){this.call=s.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,n._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(Xe)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=q:this.rebuild()}}function g(Xe){for(var He,Ve=[],We=1;We<arguments.length;We++)Ve[We-1]=arguments[We];this.length===0?(this._tasks=Ve,this.length=1):this.length===1?(Ve.unshift(this._tasks),this._tasks=Ve,this.length=this._tasks.length):((He=this._tasks).splice.apply(He,t([Xe,0],Ve,!1)),this.length=this._tasks.length)}function b(Xe){for(var He,Ve=[],We=1;We<arguments.length;We++)Ve[We-1]=arguments[We];this.length===0?(this._tasks=Ve,this.length=1):this.length===1?(Ve.unshift(this._tasks),this._tasks=Ve,this.length=this._tasks.length):((He=this._tasks).splice.apply(He,t([Xe,0],Ve,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=q:this.rebuild()}function _(){this.length===0?this.call=s.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,s.bakeCollection)(this._tasks,this.argsNum)}function L(){this.length===0?this.call=s.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,s.bakeCollectionAwait)(this._tasks,this.argsNum)}function q(){this.rebuild(),this.call.apply(void 0,arguments)}var X=(function(){function Xe(He,Ve,We,rt){Ve===void 0&&(Ve=!0),We===void 0&&(We=null),rt===void 0&&(rt=!1),this.awaitTasks=rt,this.call=s.BAKED_EMPTY_FUNC,this.argsNum=He,this.firstEmitBuildStrategy=!0,rt?this.rebuild=L.bind(this):this.rebuild=_.bind(this),this.setAutoRebuild(Ve),We?typeof We=="function"?(this._tasks=We,this.length=1):(this._tasks=We,this.length=We.length):(this._tasks=null,this.length=0),Ve&&this.rebuild()}return Xe})();r.TaskCollection=X;function te(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC}function ne(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC}function Ce(Xe){this.argsNum<Xe&&(this.argsNum=Xe,this.firstEmitBuildStrategy?this.call=q:this.rebuild())}function Le(Xe){Xe?(this.push=a.bind(this),this.insert=b.bind(this),this.removeLast=f.bind(this)):(this.push=o.bind(this),this.insert=g.bind(this),this.removeLast=c.bind(this))}function Ge(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function ze(Xe){Xe.length===0?(this.length=0,this.call=s.BAKED_EMPTY_FUNC):Xe.length===1?(this.length=1,this.call=Xe[0],this._tasks=Xe[0]):(this.length=Xe.length,this._tasks=Xe,this.firstEmitBuildStrategy?this.call=q:this.rebuild())}X.prototype.fastClear=te,X.prototype.clear=ne,X.prototype.growArgsNum=Ce,X.prototype.setAutoRebuild=Le,X.prototype.tasksAsArray=Ge,X.prototype.setTasks=ze}),require_task_collection2=__commonJS(r=>{var t=r&&r.__createBinding||(Object.create?function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}:function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]}),n=r&&r.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(require_task_collection(),r)}),require_utils6=__commonJS(r=>{Object.defineProperty(r,"__esModule",{value:!0}),r.nullObj=void 0;function t(){var n={};return n.__proto__=null,n}r.nullObj=t}),require_ee=__commonJS(r=>{var t=r&&r.__spreadArray||function(Ve,We,rt){if(rt||arguments.length===2)for(var st=0,ht=We.length,je;st<ht;st++)(je||!(st in We))&&(je||(je=Array.prototype.slice.call(We,0,st)),je[st]=We[st]);return Ve.concat(je||Array.prototype.slice.call(We))};Object.defineProperty(r,"__esModule",{value:!0}),r.EventEmitter=void 0;var n=require_task_collection2(),s=require_utils4(),o=require_utils6();function a(Ve,We,rt,st,ht,je){var se=this.events[Ve];if(se){if(se.length===0)return!1;if(se.argsNum<6)se.call(We,rt,st,ht,je);else{for(var m=new Array(se.argsNum),A=0,k=m.length;A<k;++A)m[A]=arguments[A+1];se.call.apply(void 0,m)}return!0}return!1}function c(Ve,We,rt,st,ht,je){var se=this.events[Ve],m;if(se!==void 0){if(se.length===0)return!1;if(se.argsNum<6)se.call(We,rt,st,ht,je);else{m=new Array(se.argsNum);for(var A=0,k=m.length;A<k;++A)m[A]=arguments[A+1];se.call.apply(void 0,m)}}var Y=this.onceEvents[Ve];if(Y){if(typeof Y=="function")if(this.onceEvents[Ve]=void 0,arguments.length<6)Y(We,rt,st,ht,je);else{if(m===void 0){m=new Array(arguments.length-1);for(var A=0,k=m.length;A<k;++A)m[A]=arguments[A+1]}Y.apply(void 0,m)}else{var Q=Y;if(this.onceEvents[Ve]=void 0,arguments.length<6)for(var A=0;A<Q.length;++A)Q[A](We,rt,st,ht,je);else{if(m===void 0){m=new Array(arguments.length-1);for(var A=0,k=m.length;A<k;++A)m[A]=arguments[A+1]}for(var A=0;A<Q.length;++A)Q[A].apply(void 0,m)}}return!0}return se!==void 0}var f=(function(){function Ve(){this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(Ve.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),Ve})();r.EventEmitter=f;function g(Ve,We){switch(this.emit===a&&(this.emit=c),typeof this.onceEvents[Ve]){case"undefined":this.onceEvents[Ve]=We,typeof Ve=="symbol"&&this._symbolKeys.add(Ve);break;case"function":this.onceEvents[Ve]=[this.onceEvents[Ve],We];break;case"object":this.onceEvents[Ve].push(We)}return this}function b(Ve,We,rt){if(rt===void 0&&(rt=We.length),typeof We!="function")throw new TypeError("The listener must be a function");var st=this.events[Ve];return st?(st.push(We),st.growArgsNum(rt),this.maxListeners!==1/0&&this.maxListeners<=st.length&&console.warn('Maximum event listeners for "'.concat(String(Ve),'" event!'))):(this.events[Ve]=new n.TaskCollection(rt,!0,We,!1),typeof Ve=="symbol"&&this._symbolKeys.add(Ve)),this}function _(Ve,We){var rt=this.events[Ve];rt&&rt.removeLast(We);var st=this.onceEvents[Ve];return st&&(typeof st=="function"?this.onceEvents[Ve]=void 0:typeof st=="object"&&(st.length===1&&st[0]===We?this.onceEvents[Ve]=void 0:(0,s._fast_remove_single)(st,st.lastIndexOf(We)))),this}function L(Ve,We,rt,st){rt===void 0&&(rt=this),st===void 0&&(st=We.length),this.boundFuncs||(this.boundFuncs=new Map);var ht=We.bind(rt);return this.boundFuncs.set(We,ht),this.addListener(Ve,ht,st)}function q(Ve,We){var rt,st,ht=(rt=this.boundFuncs)===null||rt===void 0?void 0:rt.get(We);return(st=this.boundFuncs)===null||st===void 0||st.delete(We),this.removeListener(Ve,ht)}function X(Ve){return this.events[Ve]&&!!this.events[Ve].length}function te(Ve,We,rt){if(rt===void 0&&(rt=We.length),typeof We!="function")throw new TypeError("The listener must be a function");var st=this.events[Ve];return!st||!(st instanceof n.TaskCollection)?(st=this.events[Ve]=new n.TaskCollection(rt,!0,We,!1),typeof Ve=="symbol"&&this._symbolKeys.add(Ve)):(st.insert(0,We),st.growArgsNum(rt),this.maxListeners!==1/0&&this.maxListeners<=st.length&&console.warn('Maximum event listeners for "'.concat(String(Ve),'" event!'))),this}function ne(Ve,We){this.emit===a&&(this.emit=c);var rt=this.onceEvents[Ve];return rt?typeof rt!="object"?(this.onceEvents[Ve]=[We,rt],typeof Ve=="symbol"&&this._symbolKeys.add(Ve)):(rt.unshift(We),this.maxListeners!==1/0&&this.maxListeners<=rt.length&&console.warn('Maximum event listeners for "'.concat(String(Ve),'" once event!'))):(this.onceEvents[Ve]=[We],typeof Ve=="symbol"&&this._symbolKeys.add(Ve)),this}function Ce(Ve){return Ve===void 0?(this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set):(this.events[Ve]=void 0,this.onceEvents[Ve]=void 0,typeof Ve=="symbol"&&this._symbolKeys.delete(Ve)),this}function Le(Ve){return this.maxListeners=Ve,this}function Ge(){return this.maxListeners}function ze(Ve){return this.emit===a?this.events[Ve]?this.events[Ve].tasksAsArray().slice():[]:this.events[Ve]&&this.onceEvents[Ve]?t(t([],this.events[Ve].tasksAsArray(),!0),typeof this.onceEvents[Ve]=="function"?[this.onceEvents[Ve]]:this.onceEvents[Ve],!0):this.events[Ve]?this.events[Ve].tasksAsArray():this.onceEvents[Ve]?typeof this.onceEvents[Ve]=="function"?[this.onceEvents[Ve]]:this.onceEvents[Ve]:[]}function Xe(){var Ve=this;if(this.emit===a){var We=Object.keys(this.events);return t(t([],We,!0),Array.from(this._symbolKeys),!0).filter(function(st){return st in Ve.events&&Ve.events[st]&&Ve.events[st].length})}else{var We=Object.keys(this.events).filter(function(ht){return Ve.events[ht]&&Ve.events[ht].length}),rt=Object.keys(this.onceEvents).filter(function(ht){return Ve.onceEvents[ht]&&Ve.onceEvents[ht].length});return t(t(t([],We,!0),rt,!0),Array.from(this._symbolKeys).filter(function(ht){return ht in Ve.events&&Ve.events[ht]&&Ve.events[ht].length||ht in Ve.onceEvents&&Ve.onceEvents[ht]&&Ve.onceEvents[ht].length}),!0)}}function He(Ve){return this.emit===a?this.events[Ve]&&this.events[Ve].length||0:(this.events[Ve]&&this.events[Ve].length||0)+(this.onceEvents[Ve]&&this.onceEvents[Ve].length||0)}f.prototype.emit=a,f.prototype.on=b,f.prototype.once=g,f.prototype.addListener=b,f.prototype.removeListener=_,f.prototype.addListenerBound=L,f.prototype.removeListenerBound=q,f.prototype.hasListeners=X,f.prototype.prependListener=te,f.prototype.prependOnceListener=ne,f.prototype.off=_,f.prototype.removeAllListeners=Ce,f.prototype.setMaxListeners=Le,f.prototype.getMaxListeners=Ge,f.prototype.listeners=ze,f.prototype.eventNames=Xe,f.prototype.listenerCount=He}),require_lib=__commonJS(r=>{var t=r&&r.__createBinding||(Object.create?function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}:function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]}),n=r&&r.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(require_types(),r),n(require_ee(),r)}),require_ms=__commonJS((r,t)=>{var n=1e3,s=n*60,o=s*60,a=o*24,c=a*7,f=a*365.25;t.exports=function(q,X){X=X||{};var te=typeof q;if(te==="string"&&q.length>0)return g(q);if(te==="number"&&isFinite(q))return X.long?_(q):b(q);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(q))};function g(q){if(q=String(q),!(q.length>100)){var X=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(q);if(X){var te=parseFloat(X[1]),ne=(X[2]||"ms").toLowerCase();switch(ne){case"years":case"year":case"yrs":case"yr":case"y":return te*f;case"weeks":case"week":case"w":return te*c;case"days":case"day":case"d":return te*a;case"hours":case"hour":case"hrs":case"hr":case"h":return te*o;case"minutes":case"minute":case"mins":case"min":case"m":return te*s;case"seconds":case"second":case"secs":case"sec":case"s":return te*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return te;default:return}}}}function b(q){var X=Math.abs(q);return X>=a?Math.round(q/a)+"d":X>=o?Math.round(q/o)+"h":X>=s?Math.round(q/s)+"m":X>=n?Math.round(q/n)+"s":q+"ms"}function _(q){var X=Math.abs(q);return X>=a?L(q,X,a,"day"):X>=o?L(q,X,o,"hour"):X>=s?L(q,X,s,"minute"):X>=n?L(q,X,n,"second"):q+" ms"}function L(q,X,te,ne){var Ce=X>=te*1.5;return Math.round(q/te)+" "+ne+(Ce?"s":"")}}),require_common3=__commonJS((r,t)=>{function n(s){a.debug=a,a.default=a,a.coerce=L,a.disable=b,a.enable=f,a.enabled=_,a.humanize=require_ms(),a.destroy=q,Object.keys(s).forEach(X=>{a[X]=s[X]}),a.names=[],a.skips=[],a.formatters={};function o(X){let te=0;for(let ne=0;ne<X.length;ne++)te=(te<<5)-te+X.charCodeAt(ne),te|=0;return a.colors[Math.abs(te)%a.colors.length]}a.selectColor=o;function a(X){let te,ne=null,Ce,Le;function Ge(...ze){if(!Ge.enabled)return;const Xe=Ge,He=Number(new Date),Ve=He-(te||He);Xe.diff=Ve,Xe.prev=te,Xe.curr=He,te=He,ze[0]=a.coerce(ze[0]),typeof ze[0]!="string"&&ze.unshift("%O");let We=0;ze[0]=ze[0].replace(/%([a-zA-Z%])/g,(st,ht)=>{if(st==="%%")return"%";We++;const je=a.formatters[ht];if(typeof je=="function"){const se=ze[We];st=je.call(Xe,se),ze.splice(We,1),We--}return st}),a.formatArgs.call(Xe,ze),(Xe.log||a.log).apply(Xe,ze)}return Ge.namespace=X,Ge.useColors=a.useColors(),Ge.color=a.selectColor(X),Ge.extend=c,Ge.destroy=a.destroy,Object.defineProperty(Ge,"enabled",{enumerable:!0,configurable:!1,get:()=>ne!==null?ne:(Ce!==a.namespaces&&(Ce=a.namespaces,Le=a.enabled(X)),Le),set:ze=>{ne=ze}}),typeof a.init=="function"&&a.init(Ge),Ge}function c(X,te){const ne=a(this.namespace+(typeof te>"u"?":":te)+X);return ne.log=this.log,ne}function f(X){a.save(X),a.namespaces=X,a.names=[],a.skips=[];const te=(typeof X=="string"?X:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const ne of te)ne[0]==="-"?a.skips.push(ne.slice(1)):a.names.push(ne)}function g(X,te){let ne=0,Ce=0,Le=-1,Ge=0;for(;ne<X.length;)if(Ce<te.length&&(te[Ce]===X[ne]||te[Ce]==="*"))te[Ce]==="*"?(Le=Ce,Ge=ne,Ce++):(ne++,Ce++);else if(Le!==-1)Ce=Le+1,Ge++,ne=Ge;else return!1;for(;Ce<te.length&&te[Ce]==="*";)Ce++;return Ce===te.length}function b(){const X=[...a.names,...a.skips.map(te=>"-"+te)].join(",");return a.enable(""),X}function _(X){for(const te of a.skips)if(g(X,te))return!1;for(const te of a.names)if(g(X,te))return!0;return!1}function L(X){return X instanceof Error?X.stack||X.message:X}function q(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}t.exports=n}),require_browser4=__commonJS((r,t)=>{r.formatArgs=s,r.save=o,r.load=a,r.useColors=n,r.storage=c(),r.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;g.splice(1,0,b,"color: inherit");let _=0,L=0;g[0].replace(/%[a-zA-Z%]/g,q=>{q!=="%%"&&(_++,q==="%c"&&(L=_))}),g.splice(L,0,b)}r.log=console.debug||console.log||(()=>{});function o(g){try{g?r.storage.setItem("debug",g):r.storage.removeItem("debug")}catch{}}function a(){let g;try{g=r.storage.getItem("debug")||r.storage.getItem("DEBUG")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=define_process_env_default.DEBUG),g}function c(){try{return localStorage}catch{}}t.exports=require_common3()(r);var{formatters:f}=t.exports;f.j=function(g){try{return JSON.stringify(g)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}}),require_LRUCacheNode=__commonJS(r=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCacheNode=void 0;class t{constructor(s,o,a){const{entryExpirationTimeInMS:c=null,next:f=null,prev:g=null,onEntryEvicted:b,onEntryMarkedAsMostRecentlyUsed:_,clone:L,cloneFn:q}=a??{};if(typeof c=="number"&&(c<=0||Number.isNaN(c)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=L??!1,this.cloneFn=q??this.defaultClone,this.key=s,this.internalValue=this.clone?this.cloneFn(o):o,this.created=Date.now(),this.entryExpirationTimeInMS=c,this.next=f,this.prev=g,this.onEntryEvicted=b,this.onEntryMarkedAsMostRecentlyUsed=_}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:s,value:o,isExpired:a}=this;this.onEntryEvicted({key:s,value:o,isExpired:a})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:s,value:o}=this;this.onEntryMarkedAsMostRecentlyUsed({key:s,value:o})}}defaultClone(s){return typeof s=="boolean"||typeof s=="string"||typeof s=="number"?s:JSON.parse(JSON.stringify(s))}}r.LRUCacheNode=t}),require_LRUCache=__commonJS(r=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LRUCache=void 0;var t=require_LRUCacheNode();class n{constructor(o){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:a=25,entryExpirationTimeInMS:c=null,onEntryEvicted:f,onEntryMarkedAsMostRecentlyUsed:g,cloneFn:b,clone:_}=o??{};if(Number.isNaN(a)||a<=0)throw new Error("maxSize must be greater than 0.");if(typeof c=="number"&&(c<=0||Number.isNaN(c)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=a,this.entryExpirationTimeInMS=c,this.onEntryEvicted=f,this.onEntryMarkedAsMostRecentlyUsed=g,this.clone=_,this.cloneFn=b}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(o){if(Number.isNaN(o)||o<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=o,this.enforceSizeLimit()}set(o,a,c){const f=this.lookupTable.get(o);f&&this.removeNodeFromListAndLookupTable(f);const g=new t.LRUCacheNode(o,a,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...c});return this.setNodeAsHead(g),this.lookupTable.set(o,g),this.enforceSizeLimit(),this}get(o){const a=this.lookupTable.get(o);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),null):(this.setNodeAsHead(a),a.value):null}peek(o){const a=this.lookupTable.get(o);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),null):a.value:null}delete(o){const a=this.lookupTable.get(o);return a?this.removeNodeFromListAndLookupTable(a):!1}has(o){const a=this.lookupTable.get(o);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(o){let a=this.head;for(;a;){if(a.isExpired){const f=a.next;this.removeNodeFromListAndLookupTable(a),a=f;continue}const c=this.mapNodeToEntry(a);if(o(c))return this.setNodeAsHead(a),c;a=a.next}return null}forEach(o){let a=this.head,c=0;for(;a;){if(a.isExpired){const f=a.next;this.removeNodeFromListAndLookupTable(a),a=f;continue}o(a.value,a.key,c),a=a.next,c++}}*values(){let o=this.head;for(;o;){if(o.isExpired){const a=o.next;this.removeNodeFromListAndLookupTable(o),o=a;continue}yield o.value,o=o.next}}*keys(){let o=this.head;for(;o;){if(o.isExpired){const a=o.next;this.removeNodeFromListAndLookupTable(o),o=a;continue}yield o.key,o=o.next}}*entries(){let o=this.head;for(;o;){if(o.isExpired){const a=o.next;this.removeNodeFromListAndLookupTable(o),o=a;continue}yield this.mapNodeToEntry(o),o=o.next}}*[Symbol.iterator](){let o=this.head;for(;o;){if(o.isExpired){const a=o.next;this.removeNodeFromListAndLookupTable(o),o=a;continue}yield this.mapNodeToEntry(o),o=o.next}}enforceSizeLimit(){let o=this.tail;for(;o!==null&&this.size>this.maxSizeInternal;){const a=o.prev;this.removeNodeFromListAndLookupTable(o),o=a}}mapNodeToEntry({key:o,value:a}){return{key:o,value:a}}setNodeAsHead(o){this.removeNodeFromList(o),this.head?(o.next=this.head,this.head.prev=o,this.head=o):(this.head=o,this.tail=o),o.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(o){o.prev!==null&&(o.prev.next=o.next),o.next!==null&&(o.next.prev=o.prev),this.head===o&&(this.head=o.next),this.tail===o&&(this.tail=o.prev),o.next=null,o.prev=null}removeNodeFromListAndLookupTable(o){return o.invokeOnEvicted(),this.removeNodeFromList(o),this.lookupTable.delete(o.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const o=[];for(const a of this.lookupTable.values())a.isExpired&&o.push(a);o.forEach(a=>this.removeNodeFromListAndLookupTable(a))}}r.LRUCache=n}),require_dist=__commonJS(r=>{var t=r&&r.__createBinding||(Object.create?function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}:function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]}),n=r&&r.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(require_LRUCache(),r)}),require_lib2=__commonJS(r=>{/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.bytes=r.stringToBytes=r.str=r.bytesToString=r.hex=r.utf8=r.bech32m=r.bech32=r.base58check=r.base58xmr=r.base58xrp=r.base58flickr=r.base58=r.base64url=r.base64=r.base32crockford=r.base32hex=r.base32=r.base16=r.utils=r.assertNumber=void 0;function t(je){if(!Number.isSafeInteger(je))throw new Error(`Wrong integer: ${je}`)}r.assertNumber=t;function n(...je){const se=(k,Y)=>Q=>k(Y(Q)),m=Array.from(je).reverse().reduce((k,Y)=>k?se(k,Y.encode):Y.encode,void 0),A=je.reduce((k,Y)=>k?se(k,Y.decode):Y.decode,void 0);return{encode:m,decode:A}}function s(je){return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return se.map(m=>{if(t(m),m<0||m>=je.length)throw new Error(`Digit index outside alphabet: ${m} (alphabet: ${je.length})`);return je[m]})},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("alphabet.decode input should be array of strings");return se.map(m=>{if(typeof m!="string")throw new Error(`alphabet.decode: not string element=${m}`);const A=je.indexOf(m);if(A===-1)throw new Error(`Unknown letter: "${m}". Allowed: ${je}`);return A})}}}function o(je=""){if(typeof je!="string")throw new Error("join separator should be string");return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("join.encode input should be array of strings");for(let m of se)if(typeof m!="string")throw new Error(`join.encode: non-string input=${m}`);return se.join(je)},decode:se=>{if(typeof se!="string")throw new Error("join.decode input should be string");return se.split(je)}}}function a(je,se="="){if(t(je),typeof se!="string")throw new Error("padding chr should be string");return{encode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let A of m)if(typeof A!="string")throw new Error(`padding.encode: non-string input=${A}`);for(;m.length*je%8;)m.push(se);return m},decode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let k of m)if(typeof k!="string")throw new Error(`padding.decode: non-string input=${k}`);let A=m.length;if(A*je%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;A>0&&m[A-1]===se;A--)if(!((A-1)*je%8))throw new Error("Invalid padding: string has too much padding");return m.slice(0,A)}}}function c(je){if(typeof je!="function")throw new Error("normalize fn should be function");return{encode:se=>se,decode:se=>je(se)}}function f(je,se,m){if(se<2)throw new Error(`convertRadix: wrong from=${se}, base cannot be less than 2`);if(m<2)throw new Error(`convertRadix: wrong to=${m}, base cannot be less than 2`);if(!Array.isArray(je))throw new Error("convertRadix: data should be array");if(!je.length)return[];let A=0;const k=[],Y=Array.from(je);for(Y.forEach(Q=>{if(t(Q),Q<0||Q>=se)throw new Error(`Wrong integer: ${Q}`)});;){let Q=0,$e=!0;for(let ve=A;ve<Y.length;ve++){const re=Y[ve],B=se*Q+re;if(!Number.isSafeInteger(B)||se*Q/se!==Q||B-re!==se*Q)throw new Error("convertRadix: carry overflow");if(Q=B%m,Y[ve]=Math.floor(B/m),!Number.isSafeInteger(Y[ve])||Y[ve]*m+Q!==B)throw new Error("convertRadix: carry overflow");if($e)Y[ve]?$e=!1:A=ve;else continue}if(k.push(Q),$e)break}for(let Q=0;Q<je.length-1&&je[Q]===0;Q++)k.push(0);return k.reverse()}var g=(je,se)=>se?g(se,je%se):je,b=(je,se)=>je+(se-g(je,se));function _(je,se,m,A){if(!Array.isArray(je))throw new Error("convertRadix2: data should be array");if(se<=0||se>32)throw new Error(`convertRadix2: wrong from=${se}`);if(m<=0||m>32)throw new Error(`convertRadix2: wrong to=${m}`);if(b(se,m)>32)throw new Error(`convertRadix2: carry overflow from=${se} to=${m} carryBits=${b(se,m)}`);let k=0,Y=0;const Q=2**m-1,$e=[];for(const ve of je){if(t(ve),ve>=2**se)throw new Error(`convertRadix2: invalid data word=${ve} from=${se}`);if(k=k<<se|ve,Y+se>32)throw new Error(`convertRadix2: carry overflow pos=${Y} from=${se}`);for(Y+=se;Y>=m;Y-=m)$e.push((k>>Y-m&Q)>>>0);k&=2**Y-1}if(k=k<<m-Y&Q,!A&&Y>=se)throw new Error("Excess padding");if(!A&&k)throw new Error(`Non-zero padding: ${k}`);return A&&Y>0&&$e.push(k>>>0),$e}function L(je){return t(je),{encode:se=>{if(!(se instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return f(Array.from(se),2**8,je)},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(f(se,je,2**8))}}}function q(je,se=!1){if(t(je),je<=0||je>32)throw new Error("radix2: bits should be in (0..32]");if(b(8,je)>32||b(je,8)>32)throw new Error("radix2: carry overflow");return{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return _(Array.from(m),8,je,!se)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(_(m,je,8,se))}}}function X(je){if(typeof je!="function")throw new Error("unsafeWrapper fn should be function");return function(...se){try{return je.apply(null,se)}catch{}}}function te(je,se){if(t(je),typeof se!="function")throw new Error("checksum fn should be function");return{encode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const A=se(m).slice(0,je),k=new Uint8Array(m.length+je);return k.set(m),k.set(A,m.length),k},decode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const A=m.slice(0,-je),k=se(A).slice(0,je),Y=m.slice(-je);for(let Q=0;Q<je;Q++)if(k[Q]!==Y[Q])throw new Error("Invalid checksum");return A}}}r.utils={alphabet:s,chain:n,checksum:te,radix:L,radix2:q,join:o,padding:a},r.base16=n(q(4),s("0123456789ABCDEF"),o("")),r.base32=n(q(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),o("")),r.base32hex=n(q(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),o("")),r.base32crockford=n(q(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),c(je=>je.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),r.base64=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),o("")),r.base64url=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),o(""));var ne=je=>n(L(58),s(je),o(""));r.base58=ne("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),r.base58flickr=ne("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),r.base58xrp=ne("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");var Ce=[0,2,3,5,6,7,9,10,11];r.base58xmr={encode(je){let se="";for(let m=0;m<je.length;m+=8){const A=je.subarray(m,m+8);se+=r.base58.encode(A).padStart(Ce[A.length],"1")}return se},decode(je){let se=[];for(let m=0;m<je.length;m+=11){const A=je.slice(m,m+11),k=Ce.indexOf(A.length),Y=r.base58.decode(A);for(let Q=0;Q<Y.length-k;Q++)if(Y[Q]!==0)throw new Error("base58xmr: wrong padding");se=se.concat(Array.from(Y.slice(Y.length-k)))}return Uint8Array.from(se)}};var Le=je=>n(te(4,se=>je(je(se))),r.base58);r.base58check=Le;var Ge=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),ze=[996825010,642813549,513874426,1027748829,705979059];function Xe(je){const se=je>>25;let m=(je&33554431)<<5;for(let A=0;A<ze.length;A++)(se>>A&1)===1&&(m^=ze[A]);return m}function He(je,se,m=1){const A=je.length;let k=1;for(let Y=0;Y<A;Y++){const Q=je.charCodeAt(Y);if(Q<33||Q>126)throw new Error(`Invalid prefix (${je})`);k=Xe(k)^Q>>5}k=Xe(k);for(let Y=0;Y<A;Y++)k=Xe(k)^je.charCodeAt(Y)&31;for(let Y of se)k=Xe(k)^Y;for(let Y=0;Y<6;Y++)k=Xe(k);return k^=m,Ge.encode(_([k%2**30],30,5,!1))}function Ve(je){const se=je==="bech32"?1:734539939,m=q(5),A=m.decode,k=m.encode,Y=X(A);function Q(B,oe,Ue=90){if(typeof B!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof B}`);if(!Array.isArray(oe)||oe.length&&typeof oe[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof oe}`);const Ze=B.length+7+oe.length;if(Ue!==!1&&Ze>Ue)throw new TypeError(`Length ${Ze} exceeds limit ${Ue}`);return B=B.toLowerCase(),`${B}1${Ge.encode(oe)}${He(B,oe,se)}`}function $e(B,oe=90){if(typeof B!="string")throw new Error(`bech32.decode input should be string, not ${typeof B}`);if(B.length<8||oe!==!1&&B.length>oe)throw new TypeError(`Wrong string length: ${B.length} (${B}). Expected (8..${oe})`);const Ue=B.toLowerCase();if(B!==Ue&&B!==B.toUpperCase())throw new Error("String must be lowercase or uppercase");B=Ue;const Ze=B.lastIndexOf("1");if(Ze===0||Ze===-1)throw new Error('Letter "1" must be present between prefix and data only');const lt=B.slice(0,Ze),St=B.slice(Ze+1);if(St.length<6)throw new Error("Data must be at least 6 characters long");const Mt=Ge.decode(St).slice(0,-6),Ft=He(lt,Mt,se);if(!St.endsWith(Ft))throw new Error(`Invalid checksum in ${B}: expected "${Ft}"`);return{prefix:lt,words:Mt}}const ve=X($e);function re(B){const{prefix:oe,words:Ue}=$e(B,!1);return{prefix:oe,words:Ue,bytes:A(Ue)}}return{encode:Q,decode:$e,decodeToBytes:re,decodeUnsafe:ve,fromWords:A,fromWordsUnsafe:Y,toWords:k}}r.bech32=Ve("bech32"),r.bech32m=Ve("bech32m"),r.utf8={encode:je=>new TextDecoder().decode(je),decode:je=>new TextEncoder().encode(je)},r.hex=n(q(4),s("0123456789abcdef"),o(""),c(je=>{if(typeof je!="string"||je.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof je} with length ${je.length}`);return je.toLowerCase()}));var We={utf8:r.utf8,hex:r.hex,base16:r.base16,base32:r.base32,base64:r.base64,base64url:r.base64url,base58:r.base58,base58xmr:r.base58xmr},rt=`Invalid encoding type. Available types: ${Object.keys(We).join(", ")}`,st=(je,se)=>{if(typeof je!="string"||!We.hasOwnProperty(je))throw new TypeError(rt);if(!(se instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return We[je].encode(se)};r.bytesToString=st,r.str=r.bytesToString;var ht=(je,se)=>{if(!We.hasOwnProperty(je))throw new TypeError(rt);if(typeof se!="string")throw new TypeError("stringToBytes() expects string");return We[je].decode(se)};r.stringToBytes=ht,r.bytes=r.stringToBytes}),require_bolt11=__commonJS((r,t)=>{var{bech32:n,hex:s,utf8:o}=require_lib2(),a={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},c={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},f={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},g={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},b={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},_=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],L={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},q=BigInt("2100000000000000000"),X=BigInt(1e11),te={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},ne={};for(let We=0,rt=Object.keys(te);We<rt.length;We++){const st=rt[We],ht=te[rt[We]].toString();ne[ht]=st}var Ce={1:We=>s.encode(n.fromWordsUnsafe(We)),16:We=>s.encode(n.fromWordsUnsafe(We)),13:We=>o.encode(n.fromWordsUnsafe(We)),19:We=>s.encode(n.fromWordsUnsafe(We)),23:We=>s.encode(n.fromWordsUnsafe(We)),27:We=>s.encode(n.fromWordsUnsafe(We)),6:Ge,24:Ge,3:ze,5:Xe};function Le(We){return rt=>({tagCode:parseInt(We),words:n.encode("unknown",rt,Number.MAX_SAFE_INTEGER)})}function Ge(We){return We.reverse().reduce((rt,st,ht)=>rt+st*Math.pow(32,ht),0)}function ze(We){const rt=[];let st,ht,je,se,m,A=n.fromWordsUnsafe(We);for(;A.length>0;)st=s.encode(A.slice(0,33)),ht=s.encode(A.slice(33,41)),je=parseInt(s.encode(A.slice(41,45)),16),se=parseInt(s.encode(A.slice(45,49)),16),m=parseInt(s.encode(A.slice(49,51)),16),A=A.slice(51),rt.push({pubkey:st,short_channel_id:ht,fee_base_msat:je,fee_proportional_millionths:se,cltv_expiry_delta:m});return rt}function Xe(We){const rt=We.slice().reverse().map(je=>[!!(je&1),!!(je&2),!!(je&4),!!(je&8),!!(je&16)]).reduce((je,se)=>je.concat(se),[]);for(;rt.length<_.length*2;)rt.push(!1);const st={};_.forEach((je,se)=>{let m;rt[se*2]?m="required":rt[se*2+1]?m="supported":m="unsupported",st[je]=m});const ht=rt.slice(_.length*2);return st.extra_bits={start_bit:_.length*2,bits:ht,has_required:ht.reduce((je,se,m)=>m%2!==0?je||!1:je||se,!1)},st}function He(We,rt){let st,ht;if(We.slice(-1).match(/^[munp]$/))st=We.slice(-1),ht=We.slice(0,-1);else{if(We.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");ht=We}if(!ht.match(/^\d+$/))throw new Error("Not a valid human readable amount");const je=BigInt(ht),se=st?je*X/L[st]:je*X;if(st==="p"&&je%BigInt(10)!==BigInt(0)||se>q)throw new Error("Amount is outside of valid range");return rt?se.toString():se}function Ve(We,rt){if(typeof We!="string")throw new Error("Lightning Payment Request must be string");if(We.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const st=[],ht=n.decode(We,Number.MAX_SAFE_INTEGER);We=We.toLowerCase();const je=ht.prefix;let se=ht.words,m=We.slice(je.length+1),A=se.slice(-104);se=se.slice(0,-104);let k=je.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(k&&!k[2]&&(k=je.match(/^ln(\S+)$/)),!k)throw new Error("Not a proper lightning payment request");st.push({name:"lightning_network",letters:"ln"});const Y=k[1];let Q;if(rt){if(rt.bech32===void 0||rt.pubKeyHash===void 0||rt.scriptHash===void 0||!Array.isArray(rt.validWitnessVersions))throw new Error("Invalid network");Q=rt}else switch(Y){case a.bech32:Q=a;break;case c.bech32:Q=c;break;case f.bech32:Q=f;break;case g.bech32:Q=g;break;case b.bech32:Q=b;break}if(!Q||Q.bech32!==Y)throw new Error("Unknown coin bech32 prefix");st.push({name:"coin_network",letters:Y,value:Q});const $e=k[2];let ve;if($e){const Mt=k[3];ve=He($e+Mt,!0),st.push({name:"amount",letters:k[2]+k[3],value:ve})}else ve=null;st.push({name:"separator",letters:"1"});const re=Ge(se.slice(0,7));se=se.slice(7),st.push({name:"timestamp",letters:m.slice(0,7),value:re}),m=m.slice(7);let B,oe,Ue,Ze;for(;se.length>0;){const Mt=se[0].toString();B=ne[Mt]||"unknown_tag",oe=Ce[Mt]||Le(Mt),se=se.slice(1),Ue=Ge(se.slice(0,2)),se=se.slice(2),Ze=se.slice(0,Ue),se=se.slice(Ue),st.push({name:B,tag:m[0],letters:m.slice(0,3+Ue),value:oe(Ze)}),m=m.slice(3+Ue)}st.push({name:"signature",letters:m.slice(0,104),value:s.encode(n.fromWordsUnsafe(A))}),m=m.slice(104),st.push({name:"checksum",letters:m});let lt={paymentRequest:We,sections:st,get expiry(){let Mt=st.find(Ft=>Ft.name==="expiry");if(Mt)return St("timestamp")+Mt.value},get route_hints(){return st.filter(Mt=>Mt.name==="route_hint").map(Mt=>Mt.value)}};for(let Mt in te)Mt!=="route_hint"&&Object.defineProperty(lt,Mt,{get(){return St(Mt)}});return lt;function St(Mt){let Ft=st.find(Zt=>Zt.name===Mt);return Ft?Ft.value:void 0}}t.exports={decode:Ve,hrpToMillisat:He}}),SCHEMA={events:`
        CREATE TABLE IF NOT EXISTS events (
            id TEXT PRIMARY KEY,
            pubkey TEXT,
            created_at INTEGER,
            kind INTEGER,
            tags TEXT,
            content TEXT,
            sig TEXT,
            raw TEXT,
            deleted INTEGER DEFAULT 0
        );
        CREATE INDEX IF NOT EXISTS idx_events_pubkey ON events(pubkey);
        CREATE INDEX IF NOT EXISTS idx_events_kind ON events(kind);
        CREATE INDEX IF NOT EXISTS idx_events_created_at ON events(created_at);
    `,profiles:`
        CREATE TABLE IF NOT EXISTS profiles (
            pubkey TEXT PRIMARY KEY,
            profile TEXT,
            updated_at INTEGER
        );
    `,nutzap_monitor_state:`
        CREATE TABLE IF NOT EXISTS nutzap_monitor_state (
            id TEXT PRIMARY KEY,
            state TEXT
        );
    `,decrypted_events:`
        CREATE TABLE IF NOT EXISTS decrypted_events (
            id TEXT PRIMARY KEY,
            event TEXT
        );
    `,unpublished_events:`
        CREATE TABLE IF NOT EXISTS unpublished_events (
            id TEXT PRIMARY KEY,
            event TEXT,
            relays TEXT,
            lastTryAt INTEGER
        );
    `,event_tags:`
        CREATE TABLE IF NOT EXISTS event_tags (
            event_id TEXT NOT NULL,
            tag TEXT NOT NULL,
            value TEXT,
            PRIMARY KEY (event_id, tag, value)
        );
        CREATE INDEX IF NOT EXISTS idx_event_tags_event_id ON event_tags(event_id);
        CREATE INDEX IF NOT EXISTS idx_event_tags_tag ON event_tags(tag);
    `,cache_data:`
        CREATE TABLE IF NOT EXISTS cache_data (
            namespace TEXT NOT NULL,
            key TEXT NOT NULL,
            data TEXT NOT NULL,
            cached_at INTEGER NOT NULL,
            PRIMARY KEY (namespace, key)
        );
        CREATE INDEX IF NOT EXISTS idx_cache_data_namespace ON cache_data(namespace);
    `,event_relays:`
        CREATE TABLE IF NOT EXISTS event_relays (
            event_id TEXT NOT NULL,
            relay_url TEXT NOT NULL,
            seen_at INTEGER NOT NULL,
            PRIMARY KEY (event_id, relay_url)
        );
        CREATE INDEX IF NOT EXISTS idx_event_relays_event_id ON event_relays(event_id);
    `,nip05:`
        CREATE TABLE IF NOT EXISTS nip05 (
            nip05 TEXT PRIMARY KEY,
            profile TEXT,
            fetched_at INTEGER NOT NULL
        );
    `},CURRENT_VERSION=2;function getCurrentVersion(r){try{const t=r.exec("SELECT version FROM schema_version LIMIT 1");if(t&&t.length>0&&t[0].values&&t[0].values.length>0)return t[0].values[0][0]}catch{}return 0}function setVersion(r,t){r.run("CREATE TABLE IF NOT EXISTS schema_version (version INTEGER PRIMARY KEY)"),r.run("DELETE FROM schema_version"),r.run("INSERT INTO schema_version (version) VALUES (?)",[t])}async function runMigrations(r){const t=getCurrentVersion(r);try{r.exec(SCHEMA.events),r.exec(SCHEMA.profiles),r.exec(SCHEMA.nutzap_monitor_state),r.exec(SCHEMA.decrypted_events),r.exec(SCHEMA.unpublished_events),r.exec(SCHEMA.event_tags),r.exec(SCHEMA.cache_data),r.exec(SCHEMA.event_relays),t<1&&r.exec(SCHEMA.nip05),t<2&&r.exec(SCHEMA.nip05),setVersion(r,CURRENT_VERSION);try{const n=r.exec("SELECT name FROM sqlite_master WHERE type='table' AND name='nip05'");(!n||n.length===0||!n[0].values||n[0].values.length===0)&&console.error("[NDK Cache] ERROR: nip05 table was not created!")}catch(n){console.error("[NDK Cache] Failed to verify nip05 table:",n)}}catch(n){throw console.error("[NDK Cache] Migration failed:",n),n}}function openIndexedDB(r){return new Promise((t,n)=>{if(typeof indexedDB>"u"){n(new Error("IndexedDB not available"));return}const s=indexedDB.open(r,1);s.onupgradeneeded=()=>{s.result.createObjectStore("db",{keyPath:"id"})},s.onsuccess=()=>t(s.result),s.onerror=()=>n(s.error)})}async function loadFromIndexedDB(r){try{const t=await openIndexedDB(r);return new Promise((n,s)=>{const c=t.transaction("db","readonly").objectStore("db").get("main");c.onsuccess=()=>n(c.result?c.result.data:null),c.onerror=()=>s(c.error)})}catch{return null}}async function saveToIndexedDB(r,t){try{const n=await openIndexedDB(r);return new Promise((s,o)=>{const f=n.transaction("db","readwrite").objectStore("db").put({id:"main",data:t});f.onsuccess=()=>{s()},f.onerror=()=>o(f.error)})}catch{return}}async function loadWasmAndInitDb(r,t="ndk-cache"){let n,s;const o={};try{n=await Promise.resolve().then(()=>__toESM(require_sql_wasm(),1)),r&&(o.locateFile=()=>r),s=await n.default(o)}catch(b){throw console.error("[NDK-cache-sqlite-wasm] Failed to load the SQLite WASM binary."+(r?` Tried to fetch: ${r}.`:"")+" This usually means the WASM asset could not be found (e.g., 404 error). Please ensure the correct path is provided and the asset is available. Original error:",b),b}let a;const c=await loadFromIndexedDB(t);c?a=new s.Database(new Uint8Array(c)):a=new s.Database;let f=null;a._scheduleSave=()=>{f&&clearTimeout(f),f=setTimeout(()=>{a.saveToIndexedDB()},1e3)},a.saveToIndexedDB=async()=>{const b=a.export();await saveToIndexedDB(t,b)};const g=a.run;return a.run=(b,_)=>{const L=g.call(a,b,_);return a._scheduleSave(),L},a}async function addDecryptedEvent(r,t){await this.ensureInitialized();const n=t.serialize(!0,!0),s=`
        INSERT OR REPLACE INTO decrypted_events (
            id, event
        ) VALUES (?, ?)
    `;if(this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:s,params:[r,n]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(s,[r,n])}}async function addUnpublishedEvent(r,t,n=Date.now()){const s=`
        INSERT OR REPLACE INTO unpublished_events (
            id, event, relays, lastTryAt
        ) VALUES (?, ?, ?, ?)
    `;if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:s,params:[r.id,r.serialize(!0,!0),JSON.stringify(t),n]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(s,[r.id,r.serialize(!0,!0),JSON.stringify(t),n])}}async function discardUnpublishedEvent(r){const t="DELETE FROM unpublished_events WHERE id = ?";if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:t,params:[r]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(t,[r])}}async function fetchProfile(r){const t="SELECT profile, updated_at FROM profiles WHERE pubkey = ? LIMIT 1";if(await this.ensureInitialized(),this.useWorker){const n=await this.postWorkerMessage({type:"get",payload:{sql:t,params:[r]}});if(n&&n.profile)try{return{...JSON.parse(n.profile),cachedAt:n.updated_at}}catch{return null}return null}else{if(!this.db)throw new Error("Database not initialized");const n=this.db.exec(t,[r]);if(n&&n.length>0&&n[0].values&&n[0].values.length>0){const[s,o]=n[0].values[0];try{return{...JSON.parse(s),cachedAt:o}}catch{return null}}return null}}function fetchProfileSync(r){if(!this.db)throw new Error("Database not initialized");const n=this.db.exec("SELECT profile, updated_at FROM profiles WHERE pubkey = ? LIMIT 1",[r]);if(n&&n.length>0&&n[0].values&&n[0].values.length>0){const[s,o]=n[0].values[0];try{return{...JSON.parse(s),cachedAt:o}}catch{return null}}return null}function getAllProfilesSync(){if(!this.db)throw new Error("Database not initialized");const r=new Map,n=this.db.exec("SELECT pubkey, profile, updated_at FROM profiles");if(n&&n.length>0&&n[0].values&&n[0].values.length>0)for(const s of n[0].values){const[o,a,c]=s;try{const f=JSON.parse(a);r.set(o,{...f,cachedAt:c})}catch{}}return r}function getCacheData(r,t,n,s){const o=Math.floor(Date.now()/1e3),a=r.prepare("SELECT data, cached_at FROM cache_data WHERE namespace = ? AND key = ?");if(a.bind([t,n]),a.step()){const c=a.getAsObject(),f=c.cached_at;if(s&&o-f>s){a.free();return}const g=JSON.parse(c.data);return a.free(),g}a.free()}async function getCacheStats(){if(await this.ensureInitialized(),this.useWorker)return this.postWorkerMessage({type:"getCacheStats"});if(!this.db)throw new Error("Database not initialized");return getCacheStatsSync(this.db)}function getCacheStatsSync(r){const t=r.exec(`
        SELECT kind, COUNT(*) as count
        FROM events
        WHERE deleted = 0
        GROUP BY kind
        ORDER BY kind
    `),n={};if(t[0])for(const _ of t[0].values)n[_[0]]=_[1];const s=r.exec("SELECT COUNT(*) FROM events WHERE deleted = 0"),o=r.exec("SELECT COUNT(*) FROM profiles"),a=r.exec("SELECT COUNT(*) FROM event_tags"),c=r.exec("SELECT COUNT(*) FROM decrypted_events"),f=r.exec("SELECT COUNT(*) FROM unpublished_events"),g=r.exec("SELECT COUNT(*) FROM cache_data"),b=r.exec("SELECT COUNT(*) FROM event_relays");return{eventsByKind:n,totalEvents:s[0]?.values[0]?.[0]||0,totalProfiles:o[0]?.values[0]?.[0]||0,totalEventTags:a[0]?.values[0]?.[0]||0,totalDecryptedEvents:c[0]?.values[0]?.[0]||0,totalUnpublishedEvents:f[0]?.values[0]?.[0]||0,cacheData:g[0]?.values[0]?.[0]||0,eventRelays:b[0]?.values[0]?.[0]||0}}var import_tseep=__toESM(require_lib()),import_debug=__toESM(require_browser4()),import_debug2=__toESM(require_browser4()),import_tseep2=__toESM(require_lib());__toESM(require_browser4());function number$6(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bytes$6(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash$4(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$6(r.outputLen),number$6(r.blockLen)}function exists$6(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$6(r,t){bytes$6(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var crypto2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */var u8a$6=r=>r instanceof Uint8Array,createView$8=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr$6=(r,t)=>r<<32-t|r>>>t,isLE$6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$6)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes2(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$8(r){if(typeof r=="string"&&(r=utf8ToBytes2(r)),!u8a$6(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes$8(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$6(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$6=class{clone(){return this._cloneInto()}};function wrapConstructor$4(r){const t=s=>r().update(toBytes$8(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$6(r=32){if(crypto2&&typeof crypto2.getRandomValues=="function")return crypto2.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$8(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}let SHA2$4=class extends Hash$6{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$8(this.buffer)}update(t){exists$6(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes$8(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$8(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){exists$6(this),output$6(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$8(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$8(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}};var Chi$6=(r,t,n)=>r&t^~r&n,Maj$6=(r,t,n)=>r&t^r&n^t&n,SHA256_K$6=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$4=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$6=new Uint32Array(64);let SHA256$6=class extends SHA2$4{constructor(){super(64,32,8,!1),this.A=IV$4[0]|0,this.B=IV$4[1]|0,this.C=IV$4[2]|0,this.D=IV$4[3]|0,this.E=IV$4[4]|0,this.F=IV$4[5]|0,this.G=IV$4[6]|0,this.H=IV$4[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$6[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$6[L-15],X=SHA256_W$6[L-2],te=rotr$6(q,7)^rotr$6(q,18)^q>>>3,ne=rotr$6(X,17)^rotr$6(X,19)^X>>>10;SHA256_W$6[L]=ne+SHA256_W$6[L-7]+te+SHA256_W$6[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$6(f,6)^rotr$6(f,11)^rotr$6(f,25),X=_+q+Chi$6(f,g,b)+SHA256_K$6[L]+SHA256_W$6[L]|0,ne=(rotr$6(s,2)^rotr$6(s,13)^rotr$6(s,22))+Maj$6(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W$6.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var sha256$8=wrapConstructor$4(()=>new SHA256$6),exports_utils={};__export$2(exports_utils,{validateObject:()=>validateObject$2,utf8ToBytes:()=>utf8ToBytes3,numberToVarBytesBE:()=>numberToVarBytesBE$2,numberToHexUnpadded:()=>numberToHexUnpadded$4,numberToBytesLE:()=>numberToBytesLE$4,numberToBytesBE:()=>numberToBytesBE$4,hexToNumber:()=>hexToNumber$4,hexToBytes:()=>hexToBytes$7,equalBytes:()=>equalBytes$4,ensureBytes:()=>ensureBytes$4,createHmacDrbg:()=>createHmacDrbg$4,concatBytes:()=>concatBytes2,bytesToNumberLE:()=>bytesToNumberLE$4,bytesToNumberBE:()=>bytesToNumberBE$4,bytesToHex:()=>bytesToHex$7,bitSet:()=>bitSet$2,bitMask:()=>bitMask$4,bitLen:()=>bitLen$4,bitGet:()=>bitGet$2});/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n$k=BigInt(0),_1n$k=BigInt(1),_2n$c=BigInt(2),u8a2=r=>r instanceof Uint8Array,hexes$6=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$7(r){if(!u8a2(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes$6[r[n]];return t}function numberToHexUnpadded$4(r){const t=r.toString(16);return t.length&1?`0${t}`:t}function hexToNumber$4(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function hexToBytes$7(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function bytesToNumberBE$4(r){return hexToNumber$4(bytesToHex$7(r))}function bytesToNumberLE$4(r){if(!u8a2(r))throw new Error("Uint8Array expected");return hexToNumber$4(bytesToHex$7(Uint8Array.from(r).reverse()))}function numberToBytesBE$4(r,t){return hexToBytes$7(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE$4(r,t){return numberToBytesBE$4(r,t).reverse()}function numberToVarBytesBE$2(r){return hexToBytes$7(numberToHexUnpadded$4(r))}function ensureBytes$4(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes$7(t)}catch(a){throw new Error(`${r} must be valid hex string, got "${t}". Cause: ${a}`)}else if(u8a2(t))s=Uint8Array.from(t);else throw new Error(`${r} must be hex string or Uint8Array`);const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(`${r} expected ${n} bytes, got ${o}`);return s}function concatBytes2(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a2(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}function equalBytes$4(r,t){if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function utf8ToBytes3(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function bitLen$4(r){let t;for(t=0;r>_0n$k;r>>=_1n$k,t+=1);return t}function bitGet$2(r,t){return r>>BigInt(t)&_1n$k}var bitSet$2=(r,t,n)=>r|(n?_1n$k:_0n$k)<<BigInt(t),bitMask$4=r=>(_2n$c<<BigInt(r-1))-_1n$k,u8n$2=r=>new Uint8Array(r),u8fr$2=r=>Uint8Array.from(r);function createHmacDrbg$4(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let s=u8n$2(r),o=u8n$2(r),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...L)=>n(o,s,...L),g=(L=u8n$2())=>{o=f(u8fr$2([0]),L),s=f(),L.length!==0&&(o=f(u8fr$2([1]),L),s=f())},b=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let L=0;const q=[];for(;L<t;){s=f();const X=s.slice();q.push(X),L+=s.length}return concatBytes2(...q)};return(L,q)=>{c(),g(L);let X;for(;!(X=q(b()));)g();return c(),X}}var validatorFns$2={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function validateObject$2(r,t,n={}){const s=(o,a,c)=>{const f=validatorFns$2[a];if(typeof f!="function")throw new Error(`Invalid validator "${a}", expected function`);const g=r[o];if(!(c&&g===void 0)&&!f(g,r))throw new Error(`Invalid param ${String(o)}=${g} (${typeof g}), expected ${a}`)};for(const[o,a]of Object.entries(t))s(o,a,!1);for(const[o,a]of Object.entries(n))s(o,a,!0);return r}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n2=BigInt(0),_1n2=BigInt(1),_2n2=BigInt(2),_3n$8=BigInt(3),_4n$6=BigInt(4),_5n$4=BigInt(5),_8n$4=BigInt(8);BigInt(9);BigInt(16);function mod$4(r,t){const n=r%t;return n>=_0n2?n:t+n}function pow$2(r,t,n){if(n<=_0n2||t<_0n2)throw new Error("Expected power/modulo > 0");if(n===_1n2)return _0n2;let s=_1n2;for(;t>_0n2;)t&_1n2&&(s=s*r%n),r=r*r%n,t>>=_1n2;return s}function pow2$4(r,t,n){let s=r;for(;t-- >_0n2;)s*=s,s%=n;return s}function invert$4(r,t){if(r===_0n2||t<=_0n2)throw new Error(`invert: expected positive integers, got n=${r} mod=${t}`);let n=mod$4(r,t),s=t,o=_0n2,a=_1n2;for(;n!==_0n2;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n2)throw new Error("invert: does not exist");return mod$4(o,t)}function tonelliShanks$4(r){const t=(r-_1n2)/_2n2;let n,s,o;for(n=r-_1n2,s=0;n%_2n2===_0n2;n/=_2n2,s++);for(o=_2n2;o<r&&pow$2(o,t,r)!==r-_1n2;o++);if(s===1){const c=(r+_1n2)/_4n$6;return function(g,b){const _=g.pow(b,c);if(!g.eql(g.sqr(_),b))throw new Error("Cannot find square root");return _}}const a=(n+_1n2)/_2n2;return function(f,g){if(f.pow(g,t)===f.neg(f.ONE))throw new Error("Cannot find square root");let b=s,_=f.pow(f.mul(f.ONE,o),n),L=f.pow(g,a),q=f.pow(g,n);for(;!f.eql(q,f.ONE);){if(f.eql(q,f.ZERO))return f.ZERO;let X=1;for(let ne=f.sqr(q);X<b&&!f.eql(ne,f.ONE);X++)ne=f.sqr(ne);const te=f.pow(_,_1n2<<BigInt(b-X-1));_=f.sqr(te),L=f.mul(L,te),q=f.mul(q,_),b=X}return L}}function FpSqrt$4(r){if(r%_4n$6===_3n$8){const t=(r+_1n2)/_4n$6;return function(s,o){const a=s.pow(o,t);if(!s.eql(s.sqr(a),o))throw new Error("Cannot find square root");return a}}if(r%_8n$4===_5n$4){const t=(r-_5n$4)/_8n$4;return function(s,o){const a=s.mul(o,_2n2),c=s.pow(a,t),f=s.mul(o,c),g=s.mul(s.mul(f,_2n2),c),b=s.mul(f,s.sub(g,s.ONE));if(!s.eql(s.sqr(b),o))throw new Error("Cannot find square root");return b}}return tonelliShanks$4(r)}var FIELD_FIELDS$4=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$4(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS$4.reduce((s,o)=>(s[o]="function",s),t);return validateObject$2(r,n)}function FpPow$4(r,t,n){if(n<_0n2)throw new Error("Expected power > 0");if(n===_0n2)return r.ONE;if(n===_1n2)return t;let s=r.ONE,o=t;for(;n>_0n2;)n&_1n2&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n2;return s}function FpInvertBatch$4(r,t){const n=new Array(t.length),s=t.reduce((a,c,f)=>r.is0(c)?a:(n[f]=a,r.mul(a,c)),r.ONE),o=r.inv(s);return t.reduceRight((a,c,f)=>r.is0(c)?a:(n[f]=r.mul(a,n[f]),r.mul(a,c)),o),n}function nLength$4(r,t){const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field$4(r,t,n=!1,s={}){if(r<=_0n2)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:o,nByteLength:a}=nLength$4(r,t);if(a>2048)throw new Error("Field lengths over 2048 bytes are not supported");const c=FpSqrt$4(r),f=Object.freeze({ORDER:r,BITS:o,BYTES:a,MASK:bitMask$4(o),ZERO:_0n2,ONE:_1n2,create:g=>mod$4(g,r),isValid:g=>{if(typeof g!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof g}`);return _0n2<=g&&g<r},is0:g=>g===_0n2,isOdd:g=>(g&_1n2)===_1n2,neg:g=>mod$4(-g,r),eql:(g,b)=>g===b,sqr:g=>mod$4(g*g,r),add:(g,b)=>mod$4(g+b,r),sub:(g,b)=>mod$4(g-b,r),mul:(g,b)=>mod$4(g*b,r),pow:(g,b)=>FpPow$4(f,g,b),div:(g,b)=>mod$4(g*invert$4(b,r),r),sqrN:g=>g*g,addN:(g,b)=>g+b,subN:(g,b)=>g-b,mulN:(g,b)=>g*b,inv:g=>invert$4(g,r),sqrt:s.sqrt||(g=>c(f,g)),invertBatch:g=>FpInvertBatch$4(f,g),cmov:(g,b,_)=>_?b:g,toBytes:g=>n?numberToBytesLE$4(g,a):numberToBytesBE$4(g,a),fromBytes:g=>{if(g.length!==a)throw new Error(`Fp.fromBytes: expected ${a}, got ${g.length}`);return n?bytesToNumberLE$4(g):bytesToNumberBE$4(g)}});return Object.freeze(f)}function getFieldBytesLength$4(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$4(r){const t=getFieldBytesLength$4(r);return t+Math.ceil(t/2)}function mapHashToField$4(r,t,n=!1){const s=r.length,o=getFieldBytesLength$4(t),a=getMinHashLength$4(t);if(s<16||s<a||s>1024)throw new Error(`expected ${a}-1024 bytes of input, got ${s}`);const c=n?bytesToNumberBE$4(r):bytesToNumberLE$4(r),f=mod$4(c,t-_1n2)+_1n2;return n?numberToBytesLE$4(f,o):numberToBytesBE$4(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n3=BigInt(0),_1n3=BigInt(1);function wNAF$4(r,t){const n=(o,a)=>{const c=a.negate();return o?c:a},s=o=>{const a=Math.ceil(t/o)+1,c=2**(o-1);return{windows:a,windowSize:c}};return{constTimeNegate:n,unsafeLadder(o,a){let c=r.ZERO,f=o;for(;a>_0n3;)a&_1n3&&(c=c.add(f)),f=f.double(),a>>=_1n3;return c},precomputeWindow(o,a){const{windows:c,windowSize:f}=s(a),g=[];let b=o,_=b;for(let L=0;L<c;L++){_=b,g.push(_);for(let q=1;q<f;q++)_=_.add(b),g.push(_);b=_.double()}return g},wNAF(o,a,c){const{windows:f,windowSize:g}=s(o);let b=r.ZERO,_=r.BASE;const L=BigInt(2**o-1),q=2**o,X=BigInt(o);for(let te=0;te<f;te++){const ne=te*g;let Ce=Number(c&L);c>>=X,Ce>g&&(Ce-=q,c+=_1n3);const Le=ne,Ge=ne+Math.abs(Ce)-1,ze=te%2!==0,Xe=Ce<0;Ce===0?_=_.add(n(ze,a[Le])):b=b.add(n(Xe,a[Ge]))}return{p:b,f:_}},wNAFCached(o,a,c,f){const g=o._WINDOW_SIZE||1;let b=a.get(o);return b||(b=this.precomputeWindow(o,g),g!==1&&a.set(o,f(b))),this.wNAF(g,b,c)}}}function validateBasic$2(r){return validateField$4(r.Fp),validateObject$2(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$4(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$2(r){const t=validateBasic$2(r);validateObject$2(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:s,a:o}=t;if(n){if(!s.eql(o,s.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:b2n$2,hexToBytes:h2b$2}=exports_utils,DER$4={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(r){const{Err:t}=DER$4;if(r.length<2||r[0]!==2)throw new t("Invalid signature integer tag");const n=r[1],s=r.subarray(2,n+2);if(!n||s.length!==n)throw new t("Invalid signature integer: wrong length");if(s[0]&128)throw new t("Invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:b2n$2(s),l:r.subarray(n+2)}},toSig(r){const{Err:t}=DER$4,n=typeof r=="string"?h2b$2(r):r;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let s=n.length;if(s<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==s-2)throw new t("Invalid signature: incorrect length");const{d:o,l:a}=DER$4._parseInt(n.subarray(2)),{d:c,l:f}=DER$4._parseInt(a);if(f.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:c}},hexFromSig(r){const t=b=>Number.parseInt(b[0],16)&8?"00"+b:b,n=b=>{const _=b.toString(16);return _.length&1?`0${_}`:_},s=t(n(r.s)),o=t(n(r.r)),a=s.length/2,c=o.length/2,f=n(a),g=n(c);return`30${n(c+a+4)}02${g}${o}02${f}${s}`}},_0n4=BigInt(0),_1n4=BigInt(1);BigInt(2);var _3n2=BigInt(3);BigInt(4);function weierstrassPoints$2(r){const t=validatePointOpts$2(r),{Fp:n}=t,s=t.toBytes||((te,ne,Ce)=>{const Le=ne.toAffine();return concatBytes2(Uint8Array.from([4]),n.toBytes(Le.x),n.toBytes(Le.y))}),o=t.fromBytes||(te=>{const ne=te.subarray(1),Ce=n.fromBytes(ne.subarray(0,n.BYTES)),Le=n.fromBytes(ne.subarray(n.BYTES,2*n.BYTES));return{x:Ce,y:Le}});function a(te){const{a:ne,b:Ce}=t,Le=n.sqr(te),Ge=n.mul(Le,te);return n.add(n.add(Ge,n.mul(te,ne)),Ce)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw new Error("bad generator point: equation left != right");function c(te){return typeof te=="bigint"&&_0n4<te&&te<t.n}function f(te){if(!c(te))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function g(te){const{allowedPrivateKeyLengths:ne,nByteLength:Ce,wrapPrivateKey:Le,n:Ge}=t;if(ne&&typeof te!="bigint"){if(te instanceof Uint8Array&&(te=bytesToHex$7(te)),typeof te!="string"||!ne.includes(te.length))throw new Error("Invalid key");te=te.padStart(Ce*2,"0")}let ze;try{ze=typeof te=="bigint"?te:bytesToNumberBE$4(ensureBytes$4("private key",te,Ce))}catch{throw new Error(`private key must be ${Ce} bytes, hex or bigint, not ${typeof te}`)}return Le&&(ze=mod$4(ze,Ge)),f(ze),ze}const b=new Map;function _(te){if(!(te instanceof L))throw new Error("ProjectivePoint expected")}class L{constructor(ne,Ce,Le){if(this.px=ne,this.py=Ce,this.pz=Le,ne==null||!n.isValid(ne))throw new Error("x required");if(Ce==null||!n.isValid(Ce))throw new Error("y required");if(Le==null||!n.isValid(Le))throw new Error("z required")}static fromAffine(ne){const{x:Ce,y:Le}=ne||{};if(!ne||!n.isValid(Ce)||!n.isValid(Le))throw new Error("invalid affine point");if(ne instanceof L)throw new Error("projective point not allowed");const Ge=ze=>n.eql(ze,n.ZERO);return Ge(Ce)&&Ge(Le)?L.ZERO:new L(Ce,Le,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(ne){const Ce=n.invertBatch(ne.map(Le=>Le.pz));return ne.map((Le,Ge)=>Le.toAffine(Ce[Ge])).map(L.fromAffine)}static fromHex(ne){const Ce=L.fromAffine(o(ensureBytes$4("pointHex",ne)));return Ce.assertValidity(),Ce}static fromPrivateKey(ne){return L.BASE.multiply(g(ne))}_setWindowSize(ne){this._WINDOW_SIZE=ne,b.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:ne,y:Ce}=this.toAffine();if(!n.isValid(ne)||!n.isValid(Ce))throw new Error("bad point: x or y not FE");const Le=n.sqr(Ce),Ge=a(ne);if(!n.eql(Le,Ge))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:ne}=this.toAffine();if(n.isOdd)return!n.isOdd(ne);throw new Error("Field doesn't support isOdd")}equals(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne,Ve=n.eql(n.mul(Ce,He),n.mul(ze,Ge)),We=n.eql(n.mul(Le,He),n.mul(Xe,Ge));return Ve&&We}negate(){return new L(this.px,n.neg(this.py),this.pz)}double(){const{a:ne,b:Ce}=t,Le=n.mul(Ce,_3n2),{px:Ge,py:ze,pz:Xe}=this;let{ZERO:He,ZERO:Ve,ZERO:We}=n,rt=n.mul(Ge,Ge),st=n.mul(ze,ze),ht=n.mul(Xe,Xe),je=n.mul(Ge,ze);return je=n.add(je,je),We=n.mul(Ge,Xe),We=n.add(We,We),He=n.mul(ne,We),Ve=n.mul(Le,ht),Ve=n.add(He,Ve),He=n.sub(st,Ve),Ve=n.add(st,Ve),Ve=n.mul(He,Ve),He=n.mul(je,He),We=n.mul(Le,We),ht=n.mul(ne,ht),je=n.sub(rt,ht),je=n.mul(ne,je),je=n.add(je,We),We=n.add(rt,rt),rt=n.add(We,rt),rt=n.add(rt,ht),rt=n.mul(rt,je),Ve=n.add(Ve,rt),ht=n.mul(ze,Xe),ht=n.add(ht,ht),rt=n.mul(ht,je),He=n.sub(He,rt),We=n.mul(ht,st),We=n.add(We,We),We=n.add(We,We),new L(He,Ve,We)}add(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne;let{ZERO:Ve,ZERO:We,ZERO:rt}=n;const st=t.a,ht=n.mul(t.b,_3n2);let je=n.mul(Ce,ze),se=n.mul(Le,Xe),m=n.mul(Ge,He),A=n.add(Ce,Le),k=n.add(ze,Xe);A=n.mul(A,k),k=n.add(je,se),A=n.sub(A,k),k=n.add(Ce,Ge);let Y=n.add(ze,He);return k=n.mul(k,Y),Y=n.add(je,m),k=n.sub(k,Y),Y=n.add(Le,Ge),Ve=n.add(Xe,He),Y=n.mul(Y,Ve),Ve=n.add(se,m),Y=n.sub(Y,Ve),rt=n.mul(st,k),Ve=n.mul(ht,m),rt=n.add(Ve,rt),Ve=n.sub(se,rt),rt=n.add(se,rt),We=n.mul(Ve,rt),se=n.add(je,je),se=n.add(se,je),m=n.mul(st,m),k=n.mul(ht,k),se=n.add(se,m),m=n.sub(je,m),m=n.mul(st,m),k=n.add(k,m),je=n.mul(se,k),We=n.add(We,je),je=n.mul(Y,k),Ve=n.mul(A,Ve),Ve=n.sub(Ve,je),je=n.mul(A,se),rt=n.mul(Y,rt),rt=n.add(rt,je),new L(Ve,We,rt)}subtract(ne){return this.add(ne.negate())}is0(){return this.equals(L.ZERO)}wNAF(ne){return X.wNAFCached(this,b,ne,Ce=>{const Le=n.invertBatch(Ce.map(Ge=>Ge.pz));return Ce.map((Ge,ze)=>Ge.toAffine(Le[ze])).map(L.fromAffine)})}multiplyUnsafe(ne){const Ce=L.ZERO;if(ne===_0n4)return Ce;if(f(ne),ne===_1n4)return this;const{endo:Le}=t;if(!Le)return X.unsafeLadder(this,ne);let{k1neg:Ge,k1:ze,k2neg:Xe,k2:He}=Le.splitScalar(ne),Ve=Ce,We=Ce,rt=this;for(;ze>_0n4||He>_0n4;)ze&_1n4&&(Ve=Ve.add(rt)),He&_1n4&&(We=We.add(rt)),rt=rt.double(),ze>>=_1n4,He>>=_1n4;return Ge&&(Ve=Ve.negate()),Xe&&(We=We.negate()),We=new L(n.mul(We.px,Le.beta),We.py,We.pz),Ve.add(We)}multiply(ne){f(ne);let Ce=ne,Le,Ge;const{endo:ze}=t;if(ze){const{k1neg:Xe,k1:He,k2neg:Ve,k2:We}=ze.splitScalar(Ce);let{p:rt,f:st}=this.wNAF(He),{p:ht,f:je}=this.wNAF(We);rt=X.constTimeNegate(Xe,rt),ht=X.constTimeNegate(Ve,ht),ht=new L(n.mul(ht.px,ze.beta),ht.py,ht.pz),Le=rt.add(ht),Ge=st.add(je)}else{const{p:Xe,f:He}=this.wNAF(Ce);Le=Xe,Ge=He}return L.normalizeZ([Le,Ge])[0]}multiplyAndAddUnsafe(ne,Ce,Le){const Ge=L.BASE,ze=(He,Ve)=>Ve===_0n4||Ve===_1n4||!He.equals(Ge)?He.multiplyUnsafe(Ve):He.multiply(Ve),Xe=ze(this,Ce).add(ze(ne,Le));return Xe.is0()?void 0:Xe}toAffine(ne){const{px:Ce,py:Le,pz:Ge}=this,ze=this.is0();ne==null&&(ne=ze?n.ONE:n.inv(Ge));const Xe=n.mul(Ce,ne),He=n.mul(Le,ne),Ve=n.mul(Ge,ne);if(ze)return{x:n.ZERO,y:n.ZERO};if(!n.eql(Ve,n.ONE))throw new Error("invZ was invalid");return{x:Xe,y:He}}isTorsionFree(){const{h:ne,isTorsionFree:Ce}=t;if(ne===_1n4)return!0;if(Ce)return Ce(L,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:ne,clearCofactor:Ce}=t;return ne===_1n4?this:Ce?Ce(L,this):this.multiplyUnsafe(t.h)}toRawBytes(ne=!0){return this.assertValidity(),s(L,this,ne)}toHex(ne=!0){return bytesToHex$7(this.toRawBytes(ne))}}L.BASE=new L(t.Gx,t.Gy,n.ONE),L.ZERO=new L(n.ZERO,n.ONE,n.ZERO);const q=t.nBitLength,X=wNAF$4(L,t.endo?Math.ceil(q/2):q);return{CURVE:t,ProjectivePoint:L,normPrivateKeyToScalar:g,weierstrassEquation:a,isWithinCurveOrder:c}}function validateOpts$2(r){const t=validateBasic$2(r);return validateObject$2(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$4(r){const t=validateOpts$2(r),{Fp:n,n:s}=t,o=n.BYTES+1,a=2*n.BYTES+1;function c(k){return _0n4<k&&k<n.ORDER}function f(k){return mod$4(k,s)}function g(k){return invert$4(k,s)}const{ProjectivePoint:b,normPrivateKeyToScalar:_,weierstrassEquation:L,isWithinCurveOrder:q}=weierstrassPoints$2({...t,toBytes(k,Y,Q){const $e=Y.toAffine(),ve=n.toBytes($e.x),re=concatBytes2;return Q?re(Uint8Array.from([Y.hasEvenY()?2:3]),ve):re(Uint8Array.from([4]),ve,n.toBytes($e.y))},fromBytes(k){const Y=k.length,Q=k[0],$e=k.subarray(1);if(Y===o&&(Q===2||Q===3)){const ve=bytesToNumberBE$4($e);if(!c(ve))throw new Error("Point is not on curve");const re=L(ve);let B=n.sqrt(re);const oe=(B&_1n4)===_1n4;return(Q&1)===1!==oe&&(B=n.neg(B)),{x:ve,y:B}}else if(Y===a&&Q===4){const ve=n.fromBytes($e.subarray(0,n.BYTES)),re=n.fromBytes($e.subarray(n.BYTES,2*n.BYTES));return{x:ve,y:re}}else throw new Error(`Point of length ${Y} was invalid. Expected ${o} compressed bytes or ${a} uncompressed bytes`)}}),X=k=>bytesToHex$7(numberToBytesBE$4(k,t.nByteLength));function te(k){const Y=s>>_1n4;return k>Y}function ne(k){return te(k)?f(-k):k}const Ce=(k,Y,Q)=>bytesToNumberBE$4(k.slice(Y,Q));class Le{constructor(Y,Q,$e){this.r=Y,this.s=Q,this.recovery=$e,this.assertValidity()}static fromCompact(Y){const Q=t.nByteLength;return Y=ensureBytes$4("compactSignature",Y,Q*2),new Le(Ce(Y,0,Q),Ce(Y,Q,2*Q))}static fromDER(Y){const{r:Q,s:$e}=DER$4.toSig(ensureBytes$4("DER",Y));return new Le(Q,$e)}assertValidity(){if(!q(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!q(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Y){return new Le(this.r,this.s,Y)}recoverPublicKey(Y){const{r:Q,s:$e,recovery:ve}=this,re=We(ensureBytes$4("msgHash",Y));if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");const B=ve===2||ve===3?Q+t.n:Q;if(B>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const oe=(ve&1)===0?"02":"03",Ue=b.fromHex(oe+X(B)),Ze=g(B),lt=f(-re*Ze),St=f($e*Ze),Mt=b.BASE.multiplyAndAddUnsafe(Ue,lt,St);if(!Mt)throw new Error("point at infinify");return Mt.assertValidity(),Mt}hasHighS(){return te(this.s)}normalizeS(){return this.hasHighS()?new Le(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$7(this.toDERHex())}toDERHex(){return DER$4.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$7(this.toCompactHex())}toCompactHex(){return X(this.r)+X(this.s)}}const Ge={isValidPrivateKey(k){try{return _(k),!0}catch{return!1}},normPrivateKeyToScalar:_,randomPrivateKey:()=>{const k=getMinHashLength$4(t.n);return mapHashToField$4(t.randomBytes(k),t.n)},precompute(k=8,Y=b.BASE){return Y._setWindowSize(k),Y.multiply(BigInt(3)),Y}};function ze(k,Y=!0){return b.fromPrivateKey(k).toRawBytes(Y)}function Xe(k){const Y=k instanceof Uint8Array,Q=typeof k=="string",$e=(Y||Q)&&k.length;return Y?$e===o||$e===a:Q?$e===2*o||$e===2*a:k instanceof b}function He(k,Y,Q=!0){if(Xe(k))throw new Error("first arg must be private key");if(!Xe(Y))throw new Error("second arg must be public key");return b.fromHex(Y).multiply(_(k)).toRawBytes(Q)}const Ve=t.bits2int||function(k){const Y=bytesToNumberBE$4(k),Q=k.length*8-t.nBitLength;return Q>0?Y>>BigInt(Q):Y},We=t.bits2int_modN||function(k){return f(Ve(k))},rt=bitMask$4(t.nBitLength);function st(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(_0n4<=k&&k<rt))throw new Error(`bigint expected < 2^${t.nBitLength}`);return numberToBytesBE$4(k,t.nByteLength)}function ht(k,Y,Q=je){if(["recovered","canonical"].some(Zt=>Zt in Q))throw new Error("sign() legacy options not supported");const{hash:$e,randomBytes:ve}=t;let{lowS:re,prehash:B,extraEntropy:oe}=Q;re==null&&(re=!0),k=ensureBytes$4("msgHash",k),B&&(k=ensureBytes$4("prehashed msgHash",$e(k)));const Ue=We(k),Ze=_(Y),lt=[st(Ze),st(Ue)];if(oe!=null){const Zt=oe===!0?ve(n.BYTES):oe;lt.push(ensureBytes$4("extraEntropy",Zt))}const St=concatBytes2(...lt),Mt=Ue;function Ft(Zt){const Ut=Ve(Zt);if(!q(Ut))return;const vr=g(Ut),zr=b.BASE.multiply(Ut).toAffine(),or=f(zr.x);if(or===_0n4)return;const sr=f(vr*f(Mt+or*Ze));if(sr===_0n4)return;let er=(zr.x===or?0:2)|Number(zr.y&_1n4),Xt=sr;return re&&te(sr)&&(Xt=ne(sr),er^=1),new Le(or,Xt,er)}return{seed:St,k2sig:Ft}}const je={lowS:t.lowS,prehash:!1},se={lowS:t.lowS,prehash:!1};function m(k,Y,Q=je){const{seed:$e,k2sig:ve}=ht(k,Y,Q),re=t;return createHmacDrbg$4(re.hash.outputLen,re.nByteLength,re.hmac)($e,ve)}b.BASE._setWindowSize(8);function A(k,Y,Q,$e=se){const ve=k;if(Y=ensureBytes$4("msgHash",Y),Q=ensureBytes$4("publicKey",Q),"strict"in $e)throw new Error("options.strict was renamed to lowS");const{lowS:re,prehash:B}=$e;let oe,Ue;try{if(typeof ve=="string"||ve instanceof Uint8Array)try{oe=Le.fromDER(ve)}catch(zr){if(!(zr instanceof DER$4.Err))throw zr;oe=Le.fromCompact(ve)}else if(typeof ve=="object"&&typeof ve.r=="bigint"&&typeof ve.s=="bigint"){const{r:zr,s:or}=ve;oe=new Le(zr,or)}else throw new Error("PARSE");Ue=b.fromHex(Q)}catch(zr){if(zr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(re&&oe.hasHighS())return!1;B&&(Y=t.hash(Y));const{r:Ze,s:lt}=oe,St=We(Y),Mt=g(lt),Ft=f(St*Mt),Zt=f(Ze*Mt),Ut=b.BASE.multiplyAndAddUnsafe(Ue,Ft,Zt)?.toAffine();return Ut?f(Ut.x)===Ze:!1}return{CURVE:t,getPublicKey:ze,getSharedSecret:He,sign:m,verify:A,ProjectivePoint:b,Signature:Le,utils:Ge}}let HMAC$6=class extends Hash$6{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,hash$4(t);const s=toBytes$8(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return exists$6(this),this.iHash.update(t),this}digestInto(t){exists$6(this),bytes$6(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};var hmac$6=(r,t,n)=>new HMAC$6(r,t).update(n).digest();hmac$6.create=(r,t)=>new HMAC$6(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$2(r){return{hash:r,hmac:(t,...n)=>hmac$6(r,t,concatBytes$8(...n)),randomBytes:randomBytes$6}}function createCurve$4(r,t){const n=s=>weierstrass$4({...r,...getHash$2(s)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var secp256k1P$2=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$2=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n5=BigInt(1),_2n4=BigInt(2),divNearest$4=(r,t)=>(r+t/_2n4)/t;function sqrtMod$4(r){const t=secp256k1P$2,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow2$4(_,n,t)*_%t,q=pow2$4(L,n,t)*_%t,X=pow2$4(q,_2n4,t)*b%t,te=pow2$4(X,o,t)*X%t,ne=pow2$4(te,a,t)*te%t,Ce=pow2$4(ne,f,t)*ne%t,Le=pow2$4(Ce,g,t)*Ce%t,Ge=pow2$4(Le,f,t)*ne%t,ze=pow2$4(Ge,n,t)*_%t,Xe=pow2$4(ze,c,t)*te%t,He=pow2$4(Xe,s,t)*b%t,Ve=pow2$4(He,_2n4,t);if(!Fp$2.eql(Fp$2.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}var Fp$2=Field$4(secp256k1P$2,void 0,void 0,{sqrt:sqrtMod$4}),secp256k1$4=createCurve$4({a:BigInt(0),b:BigInt(7),Fp:Fp$2,n:secp256k1N$2,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const t=secp256k1N$2,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,c=BigInt("0x100000000000000000000000000000000"),f=divNearest$4(a*r,t),g=divNearest$4(-s*r,t);let b=mod$4(r-f*n-g*o,t),_=mod$4(-f*s-g*a,t);const L=b>c,q=_>c;if(L&&(b=t-b),q&&(_=t-_),b>c||_>c)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}}},sha256$8),_0n5=BigInt(0),fe$3=r=>typeof r=="bigint"&&_0n5<r&&r<secp256k1P$2,ge$3=r=>typeof r=="bigint"&&_0n5<r&&r<secp256k1N$2,TAGGED_HASH_PREFIXES$4={};function taggedHash$4(r,...t){let n=TAGGED_HASH_PREFIXES$4[r];if(n===void 0){const s=sha256$8(Uint8Array.from(r,o=>o.charCodeAt(0)));n=concatBytes2(s,s),TAGGED_HASH_PREFIXES$4[r]=n}return sha256$8(concatBytes2(n,...t))}var pointToBytes$4=r=>r.toRawBytes(!0).slice(1),numTo32b$2=r=>numberToBytesBE$4(r,32),modP$2=r=>mod$4(r,secp256k1P$2),modN$2=r=>mod$4(r,secp256k1N$2),Point$3=secp256k1$4.ProjectivePoint,GmulAdd$2=(r,t,n)=>Point$3.BASE.multiplyAndAddUnsafe(r,t,n);function schnorrGetExtPubKey$4(r){let t=secp256k1$4.utils.normPrivateKeyToScalar(r),n=Point$3.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:modN$2(-t),bytes:pointToBytes$4(n)}}function lift_x$4(r){if(!fe$3(r))throw new Error("bad x: need 0 < x < p");const t=modP$2(r*r),n=modP$2(t*r+BigInt(7));let s=sqrtMod$4(n);s%_2n4!==_0n5&&(s=modP$2(-s));const o=new Point$3(r,s,_1n5);return o.assertValidity(),o}function challenge$4(...r){return modN$2(bytesToNumberBE$4(taggedHash$4("BIP0340/challenge",...r)))}function schnorrGetPublicKey$4(r){return schnorrGetExtPubKey$4(r).bytes}function schnorrSign$4(r,t,n=randomBytes$6(32)){const s=ensureBytes$4("message",r),{bytes:o,scalar:a}=schnorrGetExtPubKey$4(t),c=ensureBytes$4("auxRand",n,32),f=numTo32b$2(a^bytesToNumberBE$4(taggedHash$4("BIP0340/aux",c))),g=taggedHash$4("BIP0340/nonce",f,o,s),b=modN$2(bytesToNumberBE$4(g));if(b===_0n5)throw new Error("sign failed: k is zero");const{bytes:_,scalar:L}=schnorrGetExtPubKey$4(b),q=challenge$4(_,o,s),X=new Uint8Array(64);if(X.set(_,0),X.set(numTo32b$2(modN$2(L+q*a)),32),!schnorrVerify$4(X,s,o))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify$4(r,t,n){const s=ensureBytes$4("signature",r,64),o=ensureBytes$4("message",t),a=ensureBytes$4("publicKey",n,32);try{const c=lift_x$4(bytesToNumberBE$4(a)),f=bytesToNumberBE$4(s.subarray(0,32));if(!fe$3(f))return!1;const g=bytesToNumberBE$4(s.subarray(32,64));if(!ge$3(g))return!1;const b=challenge$4(numTo32b$2(f),pointToBytes$4(c),o),_=GmulAdd$2(c,g,modN$2(-b));return!(!_||!_.hasEvenY()||_.toAffine().x!==f)}catch{return!1}}var schnorr$4={getPublicKey:schnorrGetPublicKey$4,sign:schnorrSign$4,verify:schnorrVerify$4,utils:{randomPrivateKey:secp256k1$4.utils.randomPrivateKey,lift_x:lift_x$4,pointToBytes:pointToBytes$4,numberToBytesBE:numberToBytesBE$4,bytesToNumberBE:bytesToNumberBE$4,taggedHash:taggedHash$4,mod:mod$4}},crypto3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */var u8a3=r=>r instanceof Uint8Array,u32$4=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView2=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr2=(r,t)=>r<<32-t|r>>>t,isLE2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE2)throw new Error("Non little-endian hardware is not supported");var hexes2=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex2(r){if(!u8a3(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes2[r[n]];return t}function hexToBytes2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function utf8ToBytes4(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes2(r){if(typeof r=="string"&&(r=utf8ToBytes4(r)),!u8a3(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes3(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a3(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}class Hash3{clone(){return this._cloneInto()}}var isPlainObject$3=r=>Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object;function checkOpts$4(r,t){if(t!==void 0&&(typeof t!="object"||!isPlainObject$3(t)))throw new Error("Options should be object or undefined");return Object.assign(r,t)}function wrapConstructor2(r){const t=s=>r().update(toBytes2(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes3(r=32){if(crypto3&&typeof crypto3.getRandomValues=="function")return crypto3.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function number2(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bool$4(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function bytes2(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash2(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number2(r.outputLen),number2(r.blockLen)}function exists2(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output2(r,t){bytes2(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var assert$2={number:number2,bool:bool$4,bytes:bytes2,hash:hash2,exists:exists2,output:output2},_assert_default=assert$2;function setBigUint642(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}class SHA22 extends Hash3{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView2(this.buffer)}update(t){_assert_default.exists(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes2(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView2(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){_assert_default.exists(this),_assert_default.output(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint642(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView2(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}}var Chi2=(r,t,n)=>r&t^~r&n,Maj2=(r,t,n)=>r&t^r&n^t&n,SHA256_K2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV2=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W2=new Uint32Array(64);class SHA2562 extends SHA22{constructor(){super(64,32,8,!1),this.A=IV2[0]|0,this.B=IV2[1]|0,this.C=IV2[2]|0,this.D=IV2[3]|0,this.E=IV2[4]|0,this.F=IV2[5]|0,this.G=IV2[6]|0,this.H=IV2[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W2[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W2[L-15],X=SHA256_W2[L-2],te=rotr2(q,7)^rotr2(q,18)^q>>>3,ne=rotr2(X,17)^rotr2(X,19)^X>>>10;SHA256_W2[L]=ne+SHA256_W2[L-7]+te+SHA256_W2[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr2(f,6)^rotr2(f,11)^rotr2(f,25),X=_+q+Chi2(f,g,b)+SHA256_K2[L]+SHA256_W2[L]|0,ne=(rotr2(s,2)^rotr2(s,13)^rotr2(s,22))+Maj2(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let SHA224$2=class extends SHA2562{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};var sha2562=wrapConstructor2(()=>new SHA2562);wrapConstructor2(()=>new SHA224$2);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber$2(r){if(!Number.isSafeInteger(r))throw new Error(`Wrong integer: ${r}`)}function chain$3(...r){const t=(o,a)=>c=>o(a(c)),n=Array.from(r).reverse().reduce((o,a)=>o?t(o,a.encode):a.encode,void 0),s=r.reduce((o,a)=>o?t(o,a.decode):a.decode,void 0);return{encode:n,decode:s}}function alphabet$3(r){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(assertNumber$2(n),n<0||n>=r.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${r.length})`);return r[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=r.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${r}`);return s})}}}function join2(r=""){if(typeof r!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(r)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(r)}}}function padding$2(r,t="="){if(assertNumber$2(r),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;n.length*r%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let s=n.length;if(s*r%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&n[s-1]===t;s--)if(!((s-1)*r%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,s)}}}function normalize2(r){if(typeof r!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>r(t)}}function convertRadix$3(r,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(r))throw new Error("convertRadix: data should be array");if(!r.length)return[];let s=0;const o=[],a=Array.from(r);for(a.forEach(c=>{if(assertNumber$2(c),c<0||c>=t)throw new Error(`Wrong integer: ${c}`)});;){let c=0,f=!0;for(let g=s;g<a.length;g++){const b=a[g],_=t*c+b;if(!Number.isSafeInteger(_)||t*c/t!==c||_-b!==t*c)throw new Error("convertRadix: carry overflow");if(c=_%n,a[g]=Math.floor(_/n),!Number.isSafeInteger(a[g])||a[g]*n+c!==_)throw new Error("convertRadix: carry overflow");if(f)a[g]?f=!1:s=g;else continue}if(o.push(c),f)break}for(let c=0;c<r.length-1&&r[c]===0;c++)o.push(0);return o.reverse()}var gcd$3=(r,t)=>t?gcd$3(t,r%t):r,radix2carry$3=(r,t)=>r+(t-gcd$3(r,t));function convertRadix2$3(r,t,n,s){if(!Array.isArray(r))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry$3(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${radix2carry$3(t,n)}`);let o=0,a=0;const c=2**n-1,f=[];for(const g of r){if(assertNumber$2(g),g>=2**t)throw new Error(`convertRadix2: invalid data word=${g} from=${t}`);if(o=o<<t|g,a+t>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${t}`);for(a+=t;a>=n;a-=n)f.push((o>>a-n&c)>>>0);o&=2**a-1}if(o=o<<n-a&c,!s&&a>=t)throw new Error("Excess padding");if(!s&&o)throw new Error(`Non-zero padding: ${o}`);return s&&a>0&&f.push(o>>>0),f}function radix$3(r){return assertNumber$2(r),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix$3(Array.from(t),2**8,r)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix$3(t,r,2**8))}}}function radix2$3(r,t=!1){if(assertNumber$2(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$3(8,r)>32||radix2carry$3(r,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$3(Array.from(n),8,r,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2$3(n,r,8,t))}}}function unsafeWrapper$3(r){if(typeof r!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return r.apply(null,t)}catch{}}}var base16$2=chain$3(radix2$3(4),alphabet$3("0123456789ABCDEF"),join2("")),base32$2=chain$3(radix2$3(5),alphabet$3("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding$2(5),join2(""));chain$3(radix2$3(5),alphabet$3("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding$2(5),join2(""));chain$3(radix2$3(5),alphabet$3("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join2(""),normalize2(r=>r.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));var base64$2=chain$3(radix2$3(6),alphabet$3("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding$2(6),join2("")),base64url$2=chain$3(radix2$3(6),alphabet$3("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding$2(6),join2("")),genBase58$3=r=>chain$3(radix$3(58),alphabet$3(r),join2("")),base58$3=genBase58$3("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58$3("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58$3("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");var XMR_BLOCK_LEN$2=[0,2,3,5,6,7,9,10,11],base58xmr$2={encode(r){let t="";for(let n=0;n<r.length;n+=8){const s=r.subarray(n,n+8);t+=base58$3.encode(s).padStart(XMR_BLOCK_LEN$2[s.length],"1")}return t},decode(r){let t=[];for(let n=0;n<r.length;n+=11){const s=r.slice(n,n+11),o=XMR_BLOCK_LEN$2.indexOf(s.length),a=base58$3.decode(s);for(let c=0;c<a.length-o;c++)if(a[c]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(a.slice(a.length-o)))}return Uint8Array.from(t)}},BECH_ALPHABET$3=chain$3(alphabet$3("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join2("")),POLYMOD_GENERATORS$3=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod$3(r){const t=r>>25;let n=(r&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS$3.length;s++)(t>>s&1)===1&&(n^=POLYMOD_GENERATORS$3[s]);return n}function bechChecksum$3(r,t,n=1){const s=r.length;let o=1;for(let a=0;a<s;a++){const c=r.charCodeAt(a);if(c<33||c>126)throw new Error(`Invalid prefix (${r})`);o=bech32Polymod$3(o)^c>>5}o=bech32Polymod$3(o);for(let a=0;a<s;a++)o=bech32Polymod$3(o)^r.charCodeAt(a)&31;for(let a of t)o=bech32Polymod$3(o)^a;for(let a=0;a<6;a++)o=bech32Polymod$3(o);return o^=n,BECH_ALPHABET$3.encode(convertRadix2$3([o%2**30],30,5,!1))}function genBech32$3(r){const t=r==="bech32"?1:734539939,n=radix2$3(5),s=n.decode,o=n.encode,a=unsafeWrapper$3(s);function c(_,L,q=90){if(typeof _!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof _}`);if(!Array.isArray(L)||L.length&&typeof L[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof L}`);const X=_.length+7+L.length;if(q!==!1&&X>q)throw new TypeError(`Length ${X} exceeds limit ${q}`);return _=_.toLowerCase(),`${_}1${BECH_ALPHABET$3.encode(L)}${bechChecksum$3(_,L,t)}`}function f(_,L=90){if(typeof _!="string")throw new Error(`bech32.decode input should be string, not ${typeof _}`);if(_.length<8||L!==!1&&_.length>L)throw new TypeError(`Wrong string length: ${_.length} (${_}). Expected (8..${L})`);const q=_.toLowerCase();if(_!==q&&_!==_.toUpperCase())throw new Error("String must be lowercase or uppercase");_=q;const X=_.lastIndexOf("1");if(X===0||X===-1)throw new Error('Letter "1" must be present between prefix and data only');const te=_.slice(0,X),ne=_.slice(X+1);if(ne.length<6)throw new Error("Data must be at least 6 characters long");const Ce=BECH_ALPHABET$3.decode(ne).slice(0,-6),Le=bechChecksum$3(te,Ce,t);if(!ne.endsWith(Le))throw new Error(`Invalid checksum in ${_}: expected "${Le}"`);return{prefix:te,words:Ce}}const g=unsafeWrapper$3(f);function b(_){const{prefix:L,words:q}=f(_,!1);return{prefix:L,words:q,bytes:s(q)}}return{encode:c,decode:f,decodeToBytes:b,decodeUnsafe:g,fromWords:s,fromWordsUnsafe:a,toWords:o}}var bech32$4=genBech32$3("bech32");genBech32$3("bech32m");var utf8$3={encode:r=>new TextDecoder().decode(r),decode:r=>new TextEncoder().encode(r)},hex$3=chain$3(radix2$3(4),alphabet$3("0123456789abcdef"),join2(""),normalize2(r=>{if(typeof r!="string"||r.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof r} with length ${r.length}`);return r.toLowerCase()})),CODERS$2={utf8:utf8$3,hex:hex$3,base16:base16$2,base32:base32$2,base64:base64$2,base64url:base64url$2,base58:base58$3,base58xmr:base58xmr$2};`${Object.keys(CODERS$2).join(", ")}`;function number3(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function bool2(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function isBytes$5(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function bytes3(r,...t){if(!isBytes$5(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${r.length}`)}function exists3(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output3(r,t){bytes3(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */var u8=r=>new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u322=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView3=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),isLE3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE3)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes5(r){if(typeof r!="string")throw new Error(`string expected, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes3(r){if(typeof r=="string")r=utf8ToBytes5(r);else if(isBytes$5(r))r=r.slice();else throw new Error(`Uint8Array expected, got ${typeof r}`);return r}function checkOpts2(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function equalBytes2(r,t){if(r.length!==t.length)return!1;let n=0;for(let s=0;s<r.length;s++)n|=r[s]^t[s];return n===0}var wrapCipher$2=(r,t)=>(Object.assign(t,r),t);function setBigUint643(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}var BLOCK_SIZE$2=16,ZEROS16$2=new Uint8Array(16),ZEROS32$2=u322(ZEROS16$2),POLY$2=225,mul2$2=(r,t,n,s)=>{const o=s&1;return{s3:n<<31|s>>>1,s2:t<<31|n>>>1,s1:r<<31|t>>>1,s0:r>>>1^POLY$2<<24&-(o&1)}},swapLE=r=>(r>>>0&255)<<24|(r>>>8&255)<<16|(r>>>16&255)<<8|r>>>24&255|0;function _toGHASHKey(r){r.reverse();const t=r[15]&1;let n=0;for(let s=0;s<r.length;s++){const o=r[s];r[s]=o>>>1|n,n=(o&1)<<7}return r[0]^=-t&225,r}var estimateWindow=r=>r>64*1024?8:r>1024?4:2;class GHASH{constructor(t,n){this.blockLen=BLOCK_SIZE$2,this.outputLen=BLOCK_SIZE$2,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=toBytes3(t),bytes3(t,16);const s=createView3(t);let o=s.getUint32(0,!1),a=s.getUint32(4,!1),c=s.getUint32(8,!1),f=s.getUint32(12,!1);const g=[];for(let te=0;te<128;te++)g.push({s0:swapLE(o),s1:swapLE(a),s2:swapLE(c),s3:swapLE(f)}),{s0:o,s1:a,s2:c,s3:f}=mul2$2(o,a,c,f);const b=estimateWindow(n||1024);if(![1,2,4,8].includes(b))throw new Error(`ghash: wrong window size=${b}, should be 2, 4 or 8`);this.W=b;const L=128/b,q=this.windowSize=2**b,X=[];for(let te=0;te<L;te++)for(let ne=0;ne<q;ne++){let Ce=0,Le=0,Ge=0,ze=0;for(let Xe=0;Xe<b;Xe++){if(!(ne>>>b-Xe-1&1))continue;const{s0:Ve,s1:We,s2:rt,s3:st}=g[b*te+Xe];Ce^=Ve,Le^=We,Ge^=rt,ze^=st}X.push({s0:Ce,s1:Le,s2:Ge,s3:ze})}this.t=X}_updateBlock(t,n,s,o){t^=this.s0,n^=this.s1,s^=this.s2,o^=this.s3;const{W:a,t:c,windowSize:f}=this;let g=0,b=0,_=0,L=0;const q=(1<<a)-1;let X=0;for(const te of[t,n,s,o])for(let ne=0;ne<4;ne++){const Ce=te>>>8*ne&255;for(let Le=8/a-1;Le>=0;Le--){const Ge=Ce>>>a*Le&q,{s0:ze,s1:Xe,s2:He,s3:Ve}=c[X*f+Ge];g^=ze,b^=Xe,_^=He,L^=Ve,X+=1}}this.s0=g,this.s1=b,this.s2=_,this.s3=L}update(t){t=toBytes3(t),exists3(this);const n=u322(t),s=Math.floor(t.length/BLOCK_SIZE$2),o=t.length%BLOCK_SIZE$2;for(let a=0;a<s;a++)this._updateBlock(n[a*4+0],n[a*4+1],n[a*4+2],n[a*4+3]);return o&&(ZEROS16$2.set(t.subarray(s*BLOCK_SIZE$2)),this._updateBlock(ZEROS32$2[0],ZEROS32$2[1],ZEROS32$2[2],ZEROS32$2[3]),ZEROS32$2.fill(0)),this}destroy(){const{t}=this;for(const n of t)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(t){exists3(this),output3(t,this),this.finished=!0;const{s0:n,s1:s,s2:o,s3:a}=this,c=u322(t);return c[0]=n,c[1]=s,c[2]=o,c[3]=a,t}digest(){const t=new Uint8Array(BLOCK_SIZE$2);return this.digestInto(t),this.destroy(),t}}class Polyval extends GHASH{constructor(t,n){t=toBytes3(t);const s=_toGHASHKey(t.slice());super(s,n),s.fill(0)}update(t){t=toBytes3(t),exists3(this);const n=u322(t),s=t.length%BLOCK_SIZE$2,o=Math.floor(t.length/BLOCK_SIZE$2);for(let a=0;a<o;a++)this._updateBlock(swapLE(n[a*4+3]),swapLE(n[a*4+2]),swapLE(n[a*4+1]),swapLE(n[a*4+0]));return s&&(ZEROS16$2.set(t.subarray(o*BLOCK_SIZE$2)),this._updateBlock(swapLE(ZEROS32$2[3]),swapLE(ZEROS32$2[2]),swapLE(ZEROS32$2[1]),swapLE(ZEROS32$2[0])),ZEROS32$2.fill(0)),this}digestInto(t){exists3(this),output3(t,this),this.finished=!0;const{s0:n,s1:s,s2:o,s3:a}=this,c=u322(t);return c[0]=n,c[1]=s,c[2]=o,c[3]=a,t.reverse()}}function wrapConstructorWithKey$2(r){const t=(s,o)=>r(o,s.length).update(toBytes3(s)).digest(),n=r(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(s,o)=>r(s,o),t}var ghash=wrapConstructorWithKey$2((r,t)=>new GHASH(r,t)),polyval=wrapConstructorWithKey$2((r,t)=>new Polyval(r,t)),BLOCK_SIZE2=16,BLOCK_SIZE32=4,EMPTY_BLOCK=new Uint8Array(BLOCK_SIZE2),POLY2=283;function mul22(r){return r<<1^POLY2&-(r>>7)}function mul$2(r,t){let n=0;for(;t>0;t>>=1)n^=r&-(t&1),r=mul22(r);return n}var sbox$2=(()=>{let r=new Uint8Array(256);for(let n=0,s=1;n<256;n++,s^=mul22(s))r[n]=s;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let s=r[255-n];s|=s<<8,t[r[n]]=(s^s>>4^s>>5^s>>6^s>>7^99)&255}return t})(),invSbox$2=sbox$2.map((r,t)=>sbox$2.indexOf(t)),rotr32_8$2=r=>r<<24|r>>>8,rotl32_8$2=r=>r<<8|r>>>24;function genTtable$2(r,t){if(r.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((b,_)=>t(r[_])),s=n.map(rotl32_8$2),o=s.map(rotl32_8$2),a=o.map(rotl32_8$2),c=new Uint32Array(256*256),f=new Uint32Array(256*256),g=new Uint16Array(256*256);for(let b=0;b<256;b++)for(let _=0;_<256;_++){const L=b*256+_;c[L]=n[b]^s[_],f[L]=o[b]^a[_],g[L]=r[b]<<8|r[_]}return{sbox:r,sbox2:g,T0:n,T1:s,T2:o,T3:a,T01:c,T23:f}}var tableEncoding$2=genTtable$2(sbox$2,r=>mul$2(r,3)<<24|r<<16|r<<8|mul$2(r,2)),tableDecoding$2=genTtable$2(invSbox$2,r=>mul$2(r,11)<<24|mul$2(r,13)<<16|mul$2(r,9)<<8|mul$2(r,14)),xPowers$2=(()=>{const r=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=mul22(n))r[t]=n;return r})();function expandKeyLE$2(r){bytes3(r);const t=r.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=tableEncoding$2,s=u322(r),o=s.length,a=f=>applySbox$2(n,f,f,f,f),c=new Uint32Array(t+28);c.set(s);for(let f=o;f<c.length;f++){let g=c[f-1];f%o===0?g=a(rotr32_8$2(g))^xPowers$2[f/o-1]:o>6&&f%o===4&&(g=a(g)),c[f]=c[f-o]^g}return c}function expandKeyDecLE$2(r){const t=expandKeyLE$2(r),n=t.slice(),s=t.length,{sbox2:o}=tableEncoding$2,{T0:a,T1:c,T2:f,T3:g}=tableDecoding$2;for(let b=0;b<s;b+=4)for(let _=0;_<4;_++)n[b+_]=t[s-b-4+_];t.fill(0);for(let b=4;b<s-4;b++){const _=n[b],L=applySbox$2(o,_,_,_,_);n[b]=a[L&255]^c[L>>>8&255]^f[L>>>16&255]^g[L>>>24]}return n}function apply0123$2(r,t,n,s,o,a){return r[n<<8&65280|s>>>8&255]^t[o>>>8&65280|a>>>24&255]}function applySbox$2(r,t,n,s,o){return r[t&255|n&65280]|r[s>>>16&255|o>>>16&65280]<<16}function encrypt$8(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableEncoding$2;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123$2(c,f,t,n,s,o),Ce=r[g++]^apply0123$2(c,f,n,s,o,t),Le=r[g++]^apply0123$2(c,f,s,o,t,n),Ge=r[g++]^apply0123$2(c,f,o,t,n,s);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox$2(a,t,n,s,o),L=r[g++]^applySbox$2(a,n,s,o,t),q=r[g++]^applySbox$2(a,s,o,t,n),X=r[g++]^applySbox$2(a,o,t,n,s);return{s0:_,s1:L,s2:q,s3:X}}function decrypt$8(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableDecoding$2;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123$2(c,f,t,o,s,n),Ce=r[g++]^apply0123$2(c,f,n,t,o,s),Le=r[g++]^apply0123$2(c,f,s,n,t,o),Ge=r[g++]^apply0123$2(c,f,o,s,n,t);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox$2(a,t,o,s,n),L=r[g++]^applySbox$2(a,n,t,o,s),q=r[g++]^applySbox$2(a,s,n,t,o),X=r[g++]^applySbox$2(a,o,s,n,t);return{s0:_,s1:L,s2:q,s3:X}}function getDst$2(r,t){if(!t)return new Uint8Array(r);if(bytes3(t),t.length<r)throw new Error(`aes: wrong destination length, expected at least ${r}, got: ${t.length}`);return t}function ctrCounter(r,t,n,s){bytes3(t,BLOCK_SIZE2),bytes3(n);const o=n.length;s=getDst$2(o,s);const a=t,c=u322(a);let{s0:f,s1:g,s2:b,s3:_}=encrypt$8(r,c[0],c[1],c[2],c[3]);const L=u322(n),q=u322(s);for(let te=0;te+4<=L.length;te+=4){q[te+0]=L[te+0]^f,q[te+1]=L[te+1]^g,q[te+2]=L[te+2]^b,q[te+3]=L[te+3]^_;let ne=1;for(let Ce=a.length-1;Ce>=0;Ce--)ne=ne+(a[Ce]&255)|0,a[Ce]=ne&255,ne>>>=8;({s0:f,s1:g,s2:b,s3:_}=encrypt$8(r,c[0],c[1],c[2],c[3]))}const X=BLOCK_SIZE2*Math.floor(L.length/BLOCK_SIZE32);if(X<o){const te=new Uint32Array([f,g,b,_]),ne=u8(te);for(let Ce=X,Le=0;Ce<o;Ce++,Le++)s[Ce]=n[Ce]^ne[Le]}return s}function ctr32(r,t,n,s,o){bytes3(n,BLOCK_SIZE2),bytes3(s),o=getDst$2(s.length,o);const a=n,c=u322(a),f=createView3(a),g=u322(s),b=u322(o),_=t?0:12,L=s.length;let q=f.getUint32(_,t),{s0:X,s1:te,s2:ne,s3:Ce}=encrypt$8(r,c[0],c[1],c[2],c[3]);for(let Ge=0;Ge+4<=g.length;Ge+=4)b[Ge+0]=g[Ge+0]^X,b[Ge+1]=g[Ge+1]^te,b[Ge+2]=g[Ge+2]^ne,b[Ge+3]=g[Ge+3]^Ce,q=q+1>>>0,f.setUint32(_,q,t),{s0:X,s1:te,s2:ne,s3:Ce}=encrypt$8(r,c[0],c[1],c[2],c[3]);const Le=BLOCK_SIZE2*Math.floor(g.length/BLOCK_SIZE32);if(Le<L){const Ge=new Uint32Array([X,te,ne,Ce]),ze=u8(Ge);for(let Xe=Le,He=0;Xe<L;Xe++,He++)o[Xe]=s[Xe]^ze[He]}return o}wrapCipher$2({blockSize:16,nonceLength:16},function r(t,n){bytes3(t),bytes3(n,BLOCK_SIZE2);function s(o,a){const c=expandKeyLE$2(t),f=n.slice(),g=ctrCounter(c,f,o,a);return c.fill(0),f.fill(0),g}return{encrypt:(o,a)=>s(o,a),decrypt:(o,a)=>s(o,a)}});function validateBlockDecrypt$2(r){if(bytes3(r),r.length%BLOCK_SIZE2!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE2}`)}function validateBlockEncrypt$2(r,t,n){let s=r.length;const o=s%BLOCK_SIZE2;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const a=u322(r);if(t){let g=BLOCK_SIZE2-o;g||(g=BLOCK_SIZE2),s=s+g}const c=getDst$2(s,n),f=u322(c);return{b:a,o:f,out:c}}function validatePCKS$2(r,t){if(!t)return r;const n=r.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const s=r[n-1];if(s<=0||s>16)throw new Error(`aes/pcks5: wrong padding byte: ${s}`);const o=r.subarray(0,-s);for(let a=0;a<s;a++)if(r[n-a-1]!==s)throw new Error("aes/pcks5: wrong padding");return o}function padPCKS$2(r){const t=new Uint8Array(16),n=u322(t);t.set(r);const s=BLOCK_SIZE2-r.length;for(let o=BLOCK_SIZE2-s;o<BLOCK_SIZE2;o++)t[o]=s;return n}wrapCipher$2({blockSize:16},function r(t,n={}){bytes3(t);const s=!n.disablePadding;return{encrypt:(o,a)=>{bytes3(o);const{b:c,o:f,out:g}=validateBlockEncrypt$2(o,s,a),b=expandKeyLE$2(t);let _=0;for(;_+4<=c.length;){const{s0:L,s1:q,s2:X,s3:te}=encrypt$8(b,c[_+0],c[_+1],c[_+2],c[_+3]);f[_++]=L,f[_++]=q,f[_++]=X,f[_++]=te}if(s){const L=padPCKS$2(o.subarray(_*4)),{s0:q,s1:X,s2:te,s3:ne}=encrypt$8(b,L[0],L[1],L[2],L[3]);f[_++]=q,f[_++]=X,f[_++]=te,f[_++]=ne}return b.fill(0),g},decrypt:(o,a)=>{validateBlockDecrypt$2(o);const c=expandKeyDecLE$2(t),f=getDst$2(o.length,a),g=u322(o),b=u322(f);for(let _=0;_+4<=g.length;){const{s0:L,s1:q,s2:X,s3:te}=decrypt$8(c,g[_+0],g[_+1],g[_+2],g[_+3]);b[_++]=L,b[_++]=q,b[_++]=X,b[_++]=te}return c.fill(0),validatePCKS$2(f,s)}}});var cbc$2=wrapCipher$2({blockSize:16,nonceLength:16},function r(t,n,s={}){bytes3(t),bytes3(n,16);const o=!s.disablePadding;return{encrypt:(a,c)=>{const f=expandKeyLE$2(t),{b:g,o:b,out:_}=validateBlockEncrypt$2(a,o,c),L=u322(n);let q=L[0],X=L[1],te=L[2],ne=L[3],Ce=0;for(;Ce+4<=g.length;)q^=g[Ce+0],X^=g[Ce+1],te^=g[Ce+2],ne^=g[Ce+3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$8(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne;if(o){const Le=padPCKS$2(a.subarray(Ce*4));q^=Le[0],X^=Le[1],te^=Le[2],ne^=Le[3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$8(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne}return f.fill(0),_},decrypt:(a,c)=>{validateBlockDecrypt$2(a);const f=expandKeyDecLE$2(t),g=u322(n),b=getDst$2(a.length,c),_=u322(a),L=u322(b);let q=g[0],X=g[1],te=g[2],ne=g[3];for(let Ce=0;Ce+4<=_.length;){const Le=q,Ge=X,ze=te,Xe=ne;q=_[Ce+0],X=_[Ce+1],te=_[Ce+2],ne=_[Ce+3];const{s0:He,s1:Ve,s2:We,s3:rt}=decrypt$8(f,q,X,te,ne);L[Ce++]=He^Le,L[Ce++]=Ve^Ge,L[Ce++]=We^ze,L[Ce++]=rt^Xe}return f.fill(0),validatePCKS$2(b,o)}}});wrapCipher$2({blockSize:16,nonceLength:16},function r(t,n){bytes3(t),bytes3(n,16);function s(o,a,c){const f=expandKeyLE$2(t),g=o.length;c=getDst$2(g,c);const b=u322(o),_=u322(c),L=a?_:b,q=u322(n);let X=q[0],te=q[1],ne=q[2],Ce=q[3];for(let Ge=0;Ge+4<=b.length;){const{s0:ze,s1:Xe,s2:He,s3:Ve}=encrypt$8(f,X,te,ne,Ce);_[Ge+0]=b[Ge+0]^ze,_[Ge+1]=b[Ge+1]^Xe,_[Ge+2]=b[Ge+2]^He,_[Ge+3]=b[Ge+3]^Ve,X=L[Ge++],te=L[Ge++],ne=L[Ge++],Ce=L[Ge++]}const Le=BLOCK_SIZE2*Math.floor(b.length/BLOCK_SIZE32);if(Le<g){({s0:X,s1:te,s2:ne,s3:Ce}=encrypt$8(f,X,te,ne,Ce));const Ge=u8(new Uint32Array([X,te,ne,Ce]));for(let ze=Le,Xe=0;ze<g;ze++,Xe++)c[ze]=o[ze]^Ge[Xe];Ge.fill(0)}return f.fill(0),c}return{encrypt:(o,a)=>s(o,!0,a),decrypt:(o,a)=>s(o,!1,a)}});function computeTag$2(r,t,n,s,o){const a=r.create(n,s.length+(o?.length||0));o&&a.update(o),a.update(s);const c=new Uint8Array(16),f=createView3(c);return o&&setBigUint643(f,0,BigInt(o.length*8),t),setBigUint643(f,8,BigInt(s.length*8),t),a.update(c),a.digest()}wrapCipher$2({blockSize:16,nonceLength:12,tagLength:16},function r(t,n,s){if(bytes3(n),n.length===0)throw new Error("aes/gcm: empty nonce");const o=16;function a(f,g,b){const _=computeTag$2(ghash,!1,f,b,s);for(let L=0;L<g.length;L++)_[L]^=g[L];return _}function c(){const f=expandKeyLE$2(t),g=EMPTY_BLOCK.slice(),b=EMPTY_BLOCK.slice();if(ctr32(f,!1,b,b,g),n.length===12)b.set(n);else{const L=EMPTY_BLOCK.slice(),q=createView3(L);setBigUint643(q,8,BigInt(n.length*8),!1),ghash.create(g).update(n).update(L).digestInto(b)}const _=ctr32(f,!1,b,EMPTY_BLOCK);return{xk:f,authKey:g,counter:b,tagMask:_}}return{encrypt:f=>{bytes3(f);const{xk:g,authKey:b,counter:_,tagMask:L}=c(),q=new Uint8Array(f.length+o);ctr32(g,!1,_,f,q);const X=a(b,L,q.subarray(0,q.length-o));return q.set(X,f.length),g.fill(0),q},decrypt:f=>{if(bytes3(f),f.length<o)throw new Error(`aes/gcm: ciphertext less than tagLen (${o})`);const{xk:g,authKey:b,counter:_,tagMask:L}=c(),q=f.subarray(0,-o),X=f.subarray(-o),te=a(b,L,q);if(!equalBytes2(te,X))throw new Error("aes/gcm: invalid ghash tag");const ne=ctr32(g,!1,_,q);return b.fill(0),L.fill(0),g.fill(0),ne}}});var limit=(r,t,n)=>s=>{if(!Number.isSafeInteger(s)||t>s||s>n)throw new Error(`${r}: invalid value=${s}, must be [${t}..${n}]`)};wrapCipher$2({blockSize:16,nonceLength:12,tagLength:16},function r(t,n,s){const a=limit("AAD",0,68719476736),c=limit("plaintext",0,2**36),f=limit("nonce",12,12),g=limit("ciphertext",16,2**36+16);bytes3(n),f(n.length),s&&(bytes3(s),a(s.length));function b(){const q=t.length;if(q!==16&&q!==24&&q!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${q} bytes`);const X=expandKeyLE$2(t),te=new Uint8Array(q),ne=new Uint8Array(16),Ce=u322(n);let Le=0,Ge=Ce[0],ze=Ce[1],Xe=Ce[2],He=0;for(const Ve of[ne,te].map(u322)){const We=u322(Ve);for(let rt=0;rt<We.length;rt+=2){const{s0:st,s1:ht}=encrypt$8(X,Le,Ge,ze,Xe);We[rt+0]=st,We[rt+1]=ht,Le=++He}}return X.fill(0),{authKey:ne,encKey:expandKeyLE$2(te)}}function _(q,X,te){const ne=computeTag$2(polyval,!0,X,te,s);for(let He=0;He<12;He++)ne[He]^=n[He];ne[15]&=127;const Ce=u322(ne);let Le=Ce[0],Ge=Ce[1],ze=Ce[2],Xe=Ce[3];return{s0:Le,s1:Ge,s2:ze,s3:Xe}=encrypt$8(q,Le,Ge,ze,Xe),Ce[0]=Le,Ce[1]=Ge,Ce[2]=ze,Ce[3]=Xe,ne}function L(q,X,te){let ne=X.slice();return ne[15]|=128,ctr32(q,!0,ne,te)}return{encrypt:q=>{bytes3(q),c(q.length);const{encKey:X,authKey:te}=b(),ne=_(X,te,q),Ce=new Uint8Array(q.length+16);return Ce.set(ne,q.length),Ce.set(L(X,ne,q)),X.fill(0),te.fill(0),Ce},decrypt:q=>{bytes3(q),g(q.length);const X=q.subarray(-16),{encKey:te,authKey:ne}=b(),Ce=L(te,X,q.subarray(0,-16)),Le=_(te,ne,Ce);if(te.fill(0),ne.fill(0),!equalBytes2(X,Le))throw new Error("invalid polyval tag");return Ce}}});var u8to16$2=(r,t)=>r[t++]&255|(r[t++]&255)<<8;let Poly1305$2=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=toBytes3(t),bytes3(t,32);const n=u8to16$2(t,0),s=u8to16$2(t,2),o=u8to16$2(t,4),a=u8to16$2(t,6),c=u8to16$2(t,8),f=u8to16$2(t,10),g=u8to16$2(t,12),b=u8to16$2(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|s<<3)&8191,this.r[2]=(s>>>10|o<<6)&7939,this.r[3]=(o>>>7|a<<9)&8191,this.r[4]=(a>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|f<<2)&8191,this.r[7]=(f>>>11|g<<5)&8065,this.r[8]=(g>>>8|b<<8)&8191,this.r[9]=b>>>5&127;for(let _=0;_<8;_++)this.pad[_]=u8to16$2(t,16+2*_)}process(t,n,s=!1){const o=s?0:2048,{h:a,r:c}=this,f=c[0],g=c[1],b=c[2],_=c[3],L=c[4],q=c[5],X=c[6],te=c[7],ne=c[8],Ce=c[9],Le=u8to16$2(t,n+0),Ge=u8to16$2(t,n+2),ze=u8to16$2(t,n+4),Xe=u8to16$2(t,n+6),He=u8to16$2(t,n+8),Ve=u8to16$2(t,n+10),We=u8to16$2(t,n+12),rt=u8to16$2(t,n+14);let st=a[0]+(Le&8191),ht=a[1]+((Le>>>13|Ge<<3)&8191),je=a[2]+((Ge>>>10|ze<<6)&8191),se=a[3]+((ze>>>7|Xe<<9)&8191),m=a[4]+((Xe>>>4|He<<12)&8191),A=a[5]+(He>>>1&8191),k=a[6]+((He>>>14|Ve<<2)&8191),Y=a[7]+((Ve>>>11|We<<5)&8191),Q=a[8]+((We>>>8|rt<<8)&8191),$e=a[9]+(rt>>>5|o),ve=0,re=ve+st*f+ht*(5*Ce)+je*(5*ne)+se*(5*te)+m*(5*X);ve=re>>>13,re&=8191,re+=A*(5*q)+k*(5*L)+Y*(5*_)+Q*(5*b)+$e*(5*g),ve+=re>>>13,re&=8191;let B=ve+st*g+ht*f+je*(5*Ce)+se*(5*ne)+m*(5*te);ve=B>>>13,B&=8191,B+=A*(5*X)+k*(5*q)+Y*(5*L)+Q*(5*_)+$e*(5*b),ve+=B>>>13,B&=8191;let oe=ve+st*b+ht*g+je*f+se*(5*Ce)+m*(5*ne);ve=oe>>>13,oe&=8191,oe+=A*(5*te)+k*(5*X)+Y*(5*q)+Q*(5*L)+$e*(5*_),ve+=oe>>>13,oe&=8191;let Ue=ve+st*_+ht*b+je*g+se*f+m*(5*Ce);ve=Ue>>>13,Ue&=8191,Ue+=A*(5*ne)+k*(5*te)+Y*(5*X)+Q*(5*q)+$e*(5*L),ve+=Ue>>>13,Ue&=8191;let Ze=ve+st*L+ht*_+je*b+se*g+m*f;ve=Ze>>>13,Ze&=8191,Ze+=A*(5*Ce)+k*(5*ne)+Y*(5*te)+Q*(5*X)+$e*(5*q),ve+=Ze>>>13,Ze&=8191;let lt=ve+st*q+ht*L+je*_+se*b+m*g;ve=lt>>>13,lt&=8191,lt+=A*f+k*(5*Ce)+Y*(5*ne)+Q*(5*te)+$e*(5*X),ve+=lt>>>13,lt&=8191;let St=ve+st*X+ht*q+je*L+se*_+m*b;ve=St>>>13,St&=8191,St+=A*g+k*f+Y*(5*Ce)+Q*(5*ne)+$e*(5*te),ve+=St>>>13,St&=8191;let Mt=ve+st*te+ht*X+je*q+se*L+m*_;ve=Mt>>>13,Mt&=8191,Mt+=A*b+k*g+Y*f+Q*(5*Ce)+$e*(5*ne),ve+=Mt>>>13,Mt&=8191;let Ft=ve+st*ne+ht*te+je*X+se*q+m*L;ve=Ft>>>13,Ft&=8191,Ft+=A*_+k*b+Y*g+Q*f+$e*(5*Ce),ve+=Ft>>>13,Ft&=8191;let Zt=ve+st*Ce+ht*ne+je*te+se*X+m*q;ve=Zt>>>13,Zt&=8191,Zt+=A*L+k*_+Y*b+Q*g+$e*f,ve+=Zt>>>13,Zt&=8191,ve=(ve<<2)+ve|0,ve=ve+re|0,re=ve&8191,ve=ve>>>13,B+=ve,a[0]=re,a[1]=B,a[2]=oe,a[3]=Ue,a[4]=Ze,a[5]=lt,a[6]=St,a[7]=Mt,a[8]=Ft,a[9]=Zt}finalize(){const{h:t,pad:n}=this,s=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let f=2;f<10;f++)t[f]+=o,o=t[f]>>>13,t[f]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,s[0]=t[0]+5,o=s[0]>>>13,s[0]&=8191;for(let f=1;f<10;f++)s[f]=t[f]+o,o=s[f]>>>13,s[f]&=8191;s[9]-=8192;let a=(o^1)-1;for(let f=0;f<10;f++)s[f]&=a;a=~a;for(let f=0;f<10;f++)t[f]=t[f]&a|s[f];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let c=t[0]+n[0];t[0]=c&65535;for(let f=1;f<8;f++)c=(t[f]+n[f]|0)+(c>>>16)|0,t[f]=c&65535}update(t){exists3(this);const{buffer:n,blockLen:s}=this;t=toBytes3(t);const o=t.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){for(;s<=o-a;a+=s)this.process(t,a);continue}n.set(t.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){exists3(this),output3(t,this),this.finished=!0;const{buffer:n,h:s}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let a=0;for(let c=0;c<8;c++)t[a++]=s[c]>>>0,t[a++]=s[c]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}};function wrapConstructorWithKey2(r){const t=(s,o)=>r(o).update(toBytes3(s)).digest(),n=r(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>r(s),t}var poly1305$2=wrapConstructorWithKey2(r=>new Poly1305$2(r)),_utf8ToBytes$2=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),sigma16$2=_utf8ToBytes$2("expand 16-byte k"),sigma32$2=_utf8ToBytes$2("expand 32-byte k"),sigma16_32$2=u322(sigma16$2),sigma32_32$2=u322(sigma32$2);sigma32_32$2.slice();function rotl$6(r,t){return r<<t|r>>>32-t}function isAligned32$2(r){return r.byteOffset%4===0}var BLOCK_LEN$2=64,BLOCK_LEN32$2=16,MAX_COUNTER$2=2**32-1,U32_EMPTY$2=new Uint32Array;function runCipher$2(r,t,n,s,o,a,c,f){const g=o.length,b=new Uint8Array(BLOCK_LEN$2),_=u322(b),L=isAligned32$2(o)&&isAligned32$2(a),q=L?u322(o):U32_EMPTY$2,X=L?u322(a):U32_EMPTY$2;for(let te=0;te<g;c++){if(r(t,n,s,_,c,f),c>=MAX_COUNTER$2)throw new Error("arx: counter overflow");const ne=Math.min(BLOCK_LEN$2,g-te);if(L&&ne===BLOCK_LEN$2){const Ce=te/4;if(te%4!==0)throw new Error("arx: invalid block position");for(let Le=0,Ge;Le<BLOCK_LEN32$2;Le++)Ge=Ce+Le,X[Ge]=q[Ge]^_[Le];te+=BLOCK_LEN$2;continue}for(let Ce=0,Le;Ce<ne;Ce++)Le=te+Ce,a[Le]=o[Le]^b[Ce];te+=ne}}function createCipher$2(r,t){const{allowShortKeys:n,extendNonceFn:s,counterLength:o,counterRight:a,rounds:c}=checkOpts2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return number3(o),number3(c),bool2(a),bool2(n),(f,g,b,_,L=0)=>{bytes3(f),bytes3(g),bytes3(b);const q=b.length;if(_||(_=new Uint8Array(q)),bytes3(_),number3(L),L<0||L>=MAX_COUNTER$2)throw new Error("arx: counter overflow");if(_.length<q)throw new Error(`arx: output (${_.length}) is shorter than data (${q})`);const X=[];let te=f.length,ne,Ce;if(te===32)ne=f.slice(),X.push(ne),Ce=sigma32_32$2;else if(te===16&&n)ne=new Uint8Array(32),ne.set(f),ne.set(f,16),Ce=sigma16_32$2,X.push(ne);else throw new Error(`arx: invalid 32-byte key, got length=${te}`);isAligned32$2(g)||(g=g.slice(),X.push(g));const Le=u322(ne);if(s){if(g.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(Ce,Le,u322(g.subarray(0,16)),Le),g=g.subarray(16)}const Ge=16-o;if(Ge!==g.length)throw new Error(`arx: nonce must be ${Ge} or 16 bytes`);if(Ge!==12){const Xe=new Uint8Array(12);Xe.set(g,a?0:12-g.length),g=Xe,X.push(g)}const ze=u322(g);for(runCipher$2(r,Ce,Le,ze,b,_,L,c);X.length>0;)X.pop().fill(0);return _}}function chachaCore$2(r,t,n,s,o,a=20){let c=r[0],f=r[1],g=r[2],b=r[3],_=t[0],L=t[1],q=t[2],X=t[3],te=t[4],ne=t[5],Ce=t[6],Le=t[7],Ge=o,ze=n[0],Xe=n[1],He=n[2],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let Ue=0;Ue<a;Ue+=2)Ve=Ve+ht|0,$e=rotl$6($e^Ve,16),A=A+$e|0,ht=rotl$6(ht^A,12),Ve=Ve+ht|0,$e=rotl$6($e^Ve,8),A=A+$e|0,ht=rotl$6(ht^A,7),We=We+je|0,ve=rotl$6(ve^We,16),k=k+ve|0,je=rotl$6(je^k,12),We=We+je|0,ve=rotl$6(ve^We,8),k=k+ve|0,je=rotl$6(je^k,7),rt=rt+se|0,re=rotl$6(re^rt,16),Y=Y+re|0,se=rotl$6(se^Y,12),rt=rt+se|0,re=rotl$6(re^rt,8),Y=Y+re|0,se=rotl$6(se^Y,7),st=st+m|0,B=rotl$6(B^st,16),Q=Q+B|0,m=rotl$6(m^Q,12),st=st+m|0,B=rotl$6(B^st,8),Q=Q+B|0,m=rotl$6(m^Q,7),Ve=Ve+je|0,B=rotl$6(B^Ve,16),Y=Y+B|0,je=rotl$6(je^Y,12),Ve=Ve+je|0,B=rotl$6(B^Ve,8),Y=Y+B|0,je=rotl$6(je^Y,7),We=We+se|0,$e=rotl$6($e^We,16),Q=Q+$e|0,se=rotl$6(se^Q,12),We=We+se|0,$e=rotl$6($e^We,8),Q=Q+$e|0,se=rotl$6(se^Q,7),rt=rt+m|0,ve=rotl$6(ve^rt,16),A=A+ve|0,m=rotl$6(m^A,12),rt=rt+m|0,ve=rotl$6(ve^rt,8),A=A+ve|0,m=rotl$6(m^A,7),st=st+ht|0,re=rotl$6(re^st,16),k=k+re|0,ht=rotl$6(ht^k,12),st=st+ht|0,re=rotl$6(re^st,8),k=k+re|0,ht=rotl$6(ht^k,7);let oe=0;s[oe++]=c+Ve|0,s[oe++]=f+We|0,s[oe++]=g+rt|0,s[oe++]=b+st|0,s[oe++]=_+ht|0,s[oe++]=L+je|0,s[oe++]=q+se|0,s[oe++]=X+m|0,s[oe++]=te+A|0,s[oe++]=ne+k|0,s[oe++]=Ce+Y|0,s[oe++]=Le+Q|0,s[oe++]=Ge+$e|0,s[oe++]=ze+ve|0,s[oe++]=Xe+re|0,s[oe++]=He+B|0}function hchacha$2(r,t,n,s){let o=r[0],a=r[1],c=r[2],f=r[3],g=t[0],b=t[1],_=t[2],L=t[3],q=t[4],X=t[5],te=t[6],ne=t[7],Ce=n[0],Le=n[1],Ge=n[2],ze=n[3];for(let He=0;He<20;He+=2)o=o+g|0,Ce=rotl$6(Ce^o,16),q=q+Ce|0,g=rotl$6(g^q,12),o=o+g|0,Ce=rotl$6(Ce^o,8),q=q+Ce|0,g=rotl$6(g^q,7),a=a+b|0,Le=rotl$6(Le^a,16),X=X+Le|0,b=rotl$6(b^X,12),a=a+b|0,Le=rotl$6(Le^a,8),X=X+Le|0,b=rotl$6(b^X,7),c=c+_|0,Ge=rotl$6(Ge^c,16),te=te+Ge|0,_=rotl$6(_^te,12),c=c+_|0,Ge=rotl$6(Ge^c,8),te=te+Ge|0,_=rotl$6(_^te,7),f=f+L|0,ze=rotl$6(ze^f,16),ne=ne+ze|0,L=rotl$6(L^ne,12),f=f+L|0,ze=rotl$6(ze^f,8),ne=ne+ze|0,L=rotl$6(L^ne,7),o=o+b|0,ze=rotl$6(ze^o,16),te=te+ze|0,b=rotl$6(b^te,12),o=o+b|0,ze=rotl$6(ze^o,8),te=te+ze|0,b=rotl$6(b^te,7),a=a+_|0,Ce=rotl$6(Ce^a,16),ne=ne+Ce|0,_=rotl$6(_^ne,12),a=a+_|0,Ce=rotl$6(Ce^a,8),ne=ne+Ce|0,_=rotl$6(_^ne,7),c=c+L|0,Le=rotl$6(Le^c,16),q=q+Le|0,L=rotl$6(L^q,12),c=c+L|0,Le=rotl$6(Le^c,8),q=q+Le|0,L=rotl$6(L^q,7),f=f+g|0,Ge=rotl$6(Ge^f,16),X=X+Ge|0,g=rotl$6(g^X,12),f=f+g|0,Ge=rotl$6(Ge^f,8),X=X+Ge|0,g=rotl$6(g^X,7);let Xe=0;s[Xe++]=o,s[Xe++]=a,s[Xe++]=c,s[Xe++]=f,s[Xe++]=Ce,s[Xe++]=Le,s[Xe++]=Ge,s[Xe++]=ze}var chacha20$2=createCipher$2(chachaCore$2,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xchacha20$2=createCipher$2(chachaCore$2,{counterRight:!1,counterLength:8,extendNonceFn:hchacha$2,allowShortKeys:!1}),ZEROS162=new Uint8Array(16),updatePadded$2=(r,t)=>{r.update(t);const n=t.length%16;n&&r.update(ZEROS162.subarray(n))},ZEROS322=new Uint8Array(32);function computeTag2(r,t,n,s,o){const a=r(t,n,ZEROS322),c=poly1305$2.create(a);o&&updatePadded$2(c,o),updatePadded$2(c,s);const f=new Uint8Array(16),g=createView3(f);setBigUint643(g,0,BigInt(o?o.length:0),!0),setBigUint643(g,8,BigInt(s.length),!0),c.update(f);const b=c.digest();return a.fill(0),b}var _poly1305_aead$2=r=>(t,n,s)=>(bytes3(t,32),bytes3(n),{encrypt:(a,c)=>{const f=a.length,g=f+16;c?bytes3(c,g):c=new Uint8Array(g),r(t,n,a,c,1);const b=computeTag2(r,t,n,c.subarray(0,-16),s);return c.set(b,f),c},decrypt:(a,c)=>{const f=a.length,g=f-16;if(f<16)throw new Error("encrypted data must be at least 16 bytes");c?bytes3(c,g):c=new Uint8Array(g);const b=a.subarray(0,-16),_=a.subarray(-16),L=computeTag2(r,t,n,b,s);if(!equalBytes2(_,L))throw new Error("invalid tag");return r(t,n,b,c,1),c}}),xchacha20poly1305$2=wrapCipher$2({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead$2(xchacha20$2));class HMAC2 extends Hash3{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,_assert_default.hash(t);const s=toBytes2(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return _assert_default.exists(this),this.iHash.update(t),this}digestInto(t){_assert_default.exists(this),_assert_default.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var hmac2=(r,t,n)=>new HMAC2(r,t).update(n).digest();hmac2.create=(r,t)=>new HMAC2(r,t);function extract$2(r,t,n){return _assert_default.hash(r),hmac2(r,toBytes2(n),toBytes2(t))}var HKDF_COUNTER$2=new Uint8Array([0]),EMPTY_BUFFER$2=new Uint8Array;function expand$2(r,t,n,s=32){if(_assert_default.hash(r),_assert_default.number(s),s>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(s/r.outputLen);n===void 0&&(n=EMPTY_BUFFER$2);const a=new Uint8Array(o*r.outputLen),c=hmac2.create(r,t),f=c._cloneInto(),g=new Uint8Array(c.outputLen);for(let b=0;b<o;b++)HKDF_COUNTER$2[0]=b+1,f.update(b===0?EMPTY_BUFFER$2:g).update(n).update(HKDF_COUNTER$2).digestInto(g),a.set(g,r.outputLen*b),c._cloneInto(f);return c.destroy(),f.destroy(),g.fill(0),HKDF_COUNTER$2.fill(0),a.slice(0,s)}var __defProp3=Object.defineProperty,__export2=(r,t)=>{for(var n in t)__defProp3(r,n,{get:t[n],enumerable:!0})},verifiedSymbol$2=Symbol("verified"),isRecord$2=r=>r instanceof Object;function validateEvent$2(r){if(!isRecord$2(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let t=0;t<r.tags.length;t++){let n=r.tags[t];if(!Array.isArray(n))return!1;for(let s=0;s<n.length;s++)if(typeof n[s]!="string")return!1}return!0}var utils_exports$2={};__export2(utils_exports$2,{Queue:()=>Queue$3,QueueNode:()=>QueueNode$2,binarySearch:()=>binarySearch$2,bytesToHex:()=>bytesToHex2,hexToBytes:()=>hexToBytes2,insertEventIntoAscendingList:()=>insertEventIntoAscendingList$2,insertEventIntoDescendingList:()=>insertEventIntoDescendingList$2,normalizeURL:()=>normalizeURL$2,utf8Decoder:()=>utf8Decoder$4,utf8Encoder:()=>utf8Encoder$4});var utf8Decoder$4=new TextDecoder("utf-8"),utf8Encoder$4=new TextEncoder;function normalizeURL$2(r){try{r.indexOf("://")===-1&&(r="wss://"+r);let t=new URL(r);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${r}`)}}function insertEventIntoDescendingList$2(r,t){const[n,s]=binarySearch$2(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return s||r.splice(n,0,t),r}function insertEventIntoAscendingList$2(r,t){const[n,s]=binarySearch$2(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return s||r.splice(n,0,t),r}function binarySearch$2(r,t){let n=0,s=r.length-1;for(;n<=s;){const o=Math.floor((n+s)/2),a=t(r[o]);if(a===0)return[o,!0];a<0?s=o-1:n=o+1}return[n,!1]}var QueueNode$2=class{value;next=null;prev=null;constructor(t){this.value=t}},Queue$3=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const n=new QueueNode$2(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},JS$2=class{generateSecretKey(){return schnorr$4.utils.randomPrivateKey()}getPublicKey(t){return bytesToHex2(schnorr$4.getPublicKey(t))}finalizeEvent(t,n){const s=t;return s.pubkey=bytesToHex2(schnorr$4.getPublicKey(n)),s.id=getEventHash$4(s),s.sig=bytesToHex2(schnorr$4.sign(getEventHash$4(s),n)),s[verifiedSymbol$2]=!0,s}verifyEvent(t){if(typeof t[verifiedSymbol$2]=="boolean")return t[verifiedSymbol$2];const n=getEventHash$4(t);if(n!==t.id)return t[verifiedSymbol$2]=!1,!1;try{const s=schnorr$4.verify(t.sig,n,t.pubkey);return t[verifiedSymbol$2]=s,s}catch{return t[verifiedSymbol$2]=!1,!1}}};function serializeEvent$2(r){if(!validateEvent$2(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function getEventHash$4(r){let t=sha2562(utf8Encoder$4.encode(serializeEvent$2(r)));return bytesToHex2(t)}var i2=new JS$2,generateSecretKey$2=i2.generateSecretKey,getPublicKey$2=i2.getPublicKey,finalizeEvent$2=i2.finalizeEvent,verifyEvent$2=i2.verifyEvent,kinds_exports$2={};__export2(kinds_exports$2,{Application:()=>Application$2,BadgeAward:()=>BadgeAward$2,BadgeDefinition:()=>BadgeDefinition$2,BlockedRelaysList:()=>BlockedRelaysList$2,BookmarkList:()=>BookmarkList$2,Bookmarksets:()=>Bookmarksets$2,Calendar:()=>Calendar$2,CalendarEventRSVP:()=>CalendarEventRSVP$2,ChannelCreation:()=>ChannelCreation$2,ChannelHideMessage:()=>ChannelHideMessage$2,ChannelMessage:()=>ChannelMessage$2,ChannelMetadata:()=>ChannelMetadata$2,ChannelMuteUser:()=>ChannelMuteUser$2,ClassifiedListing:()=>ClassifiedListing$2,ClientAuth:()=>ClientAuth$2,CommunitiesList:()=>CommunitiesList$2,CommunityDefinition:()=>CommunityDefinition$2,CommunityPostApproval:()=>CommunityPostApproval$2,Contacts:()=>Contacts$2,CreateOrUpdateProduct:()=>CreateOrUpdateProduct$2,CreateOrUpdateStall:()=>CreateOrUpdateStall$2,Curationsets:()=>Curationsets$2,Date:()=>Date2$2,DirectMessageRelaysList:()=>DirectMessageRelaysList$2,DraftClassifiedListing:()=>DraftClassifiedListing$2,DraftLong:()=>DraftLong$2,Emojisets:()=>Emojisets$2,EncryptedDirectMessage:()=>EncryptedDirectMessage$2,EventDeletion:()=>EventDeletion$2,FileMetadata:()=>FileMetadata$2,FileServerPreference:()=>FileServerPreference$2,Followsets:()=>Followsets$2,GenericRepost:()=>GenericRepost$2,Genericlists:()=>Genericlists$2,GiftWrap:()=>GiftWrap$2,HTTPAuth:()=>HTTPAuth$2,Handlerinformation:()=>Handlerinformation$2,Handlerrecommendation:()=>Handlerrecommendation$2,Highlights:()=>Highlights$2,InterestsList:()=>InterestsList$2,Interestsets:()=>Interestsets$2,JobFeedback:()=>JobFeedback$2,JobRequest:()=>JobRequest$2,JobResult:()=>JobResult$2,Label:()=>Label$2,LightningPubRPC:()=>LightningPubRPC$2,LiveChatMessage:()=>LiveChatMessage$2,LiveEvent:()=>LiveEvent$2,LongFormArticle:()=>LongFormArticle$2,Metadata:()=>Metadata$2,Mutelist:()=>Mutelist$2,NWCWalletInfo:()=>NWCWalletInfo$2,NWCWalletRequest:()=>NWCWalletRequest$2,NWCWalletResponse:()=>NWCWalletResponse$2,NostrConnect:()=>NostrConnect$2,OpenTimestamps:()=>OpenTimestamps$2,Pinlist:()=>Pinlist$2,PrivateDirectMessage:()=>PrivateDirectMessage$2,ProblemTracker:()=>ProblemTracker$2,ProfileBadges:()=>ProfileBadges$2,PublicChatsList:()=>PublicChatsList$2,Reaction:()=>Reaction$2,RecommendRelay:()=>RecommendRelay$2,RelayList:()=>RelayList$2,Relaysets:()=>Relaysets$2,Report:()=>Report$2,Reporting:()=>Reporting$2,Repost:()=>Repost$2,Seal:()=>Seal$2,SearchRelaysList:()=>SearchRelaysList$2,ShortTextNote:()=>ShortTextNote$2,Time:()=>Time$2,UserEmojiList:()=>UserEmojiList$2,UserStatuses:()=>UserStatuses$2,Zap:()=>Zap$2,ZapGoal:()=>ZapGoal$2,ZapRequest:()=>ZapRequest$2,classifyKind:()=>classifyKind$2,isAddressableKind:()=>isAddressableKind$2,isEphemeralKind:()=>isEphemeralKind$2,isKind:()=>isKind$2,isRegularKind:()=>isRegularKind$2,isReplaceableKind:()=>isReplaceableKind$2});function isRegularKind$2(r){return 1e3<=r&&r<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(r)}function isReplaceableKind$2(r){return[0,3].includes(r)||1e4<=r&&r<2e4}function isEphemeralKind$2(r){return 2e4<=r&&r<3e4}function isAddressableKind$2(r){return 3e4<=r&&r<4e4}function classifyKind$2(r){return isRegularKind$2(r)?"regular":isReplaceableKind$2(r)?"replaceable":isEphemeralKind$2(r)?"ephemeral":isAddressableKind$2(r)?"parameterized":"unknown"}function isKind$2(r,t){const n=t instanceof Array?t:[t];return validateEvent$2(r)&&n.includes(r.kind)||!1}var Metadata$2=0,ShortTextNote$2=1,RecommendRelay$2=2,Contacts$2=3,EncryptedDirectMessage$2=4,EventDeletion$2=5,Repost$2=6,Reaction$2=7,BadgeAward$2=8,Seal$2=13,PrivateDirectMessage$2=14,GenericRepost$2=16,ChannelCreation$2=40,ChannelMetadata$2=41,ChannelMessage$2=42,ChannelHideMessage$2=43,ChannelMuteUser$2=44,OpenTimestamps$2=1040,GiftWrap$2=1059,FileMetadata$2=1063,LiveChatMessage$2=1311,ProblemTracker$2=1971,Report$2=1984,Reporting$2=1984,Label$2=1985,CommunityPostApproval$2=4550,JobRequest$2=5999,JobResult$2=6999,JobFeedback$2=7e3,ZapGoal$2=9041,ZapRequest$2=9734,Zap$2=9735,Highlights$2=9802,Mutelist$2=1e4,Pinlist$2=10001,RelayList$2=10002,BookmarkList$2=10003,CommunitiesList$2=10004,PublicChatsList$2=10005,BlockedRelaysList$2=10006,SearchRelaysList$2=10007,InterestsList$2=10015,UserEmojiList$2=10030,DirectMessageRelaysList$2=10050,FileServerPreference$2=10096,NWCWalletInfo$2=13194,LightningPubRPC$2=21e3,ClientAuth$2=22242,NWCWalletRequest$2=23194,NWCWalletResponse$2=23195,NostrConnect$2=24133,HTTPAuth$2=27235,Followsets$2=3e4,Genericlists$2=30001,Relaysets$2=30002,Bookmarksets$2=30003,Curationsets$2=30004,ProfileBadges$2=30008,BadgeDefinition$2=30009,Interestsets$2=30015,CreateOrUpdateStall$2=30017,CreateOrUpdateProduct$2=30018,LongFormArticle$2=30023,DraftLong$2=30024,Emojisets$2=30030,Application$2=30078,LiveEvent$2=30311,UserStatuses$2=30315,ClassifiedListing$2=30402,DraftClassifiedListing$2=30403,Date2$2=31922,Time$2=31923,Calendar$2=31924,CalendarEventRSVP$2=31925,Handlerrecommendation$2=31989,Handlerinformation$2=31990,CommunityDefinition$2=34550;function matchFilter$1(r,t){if(r.ids&&r.ids.indexOf(t.id)===-1||r.kinds&&r.kinds.indexOf(t.kind)===-1||r.authors&&r.authors.indexOf(t.pubkey)===-1)return!1;for(let n in r)if(n[0]==="#"){let s=n.slice(1),o=r[`#${s}`];if(o&&!t.tags.find(([a,c])=>a===n.slice(1)&&o.indexOf(c)!==-1))return!1}return!(r.since&&t.created_at<r.since||r.until&&t.created_at>r.until)}function matchFilters$1(r,t){for(let n=0;n<r.length;n++)if(matchFilter$1(r[n],t))return!0;return!1}var fakejson_exports$2={};__export2(fakejson_exports$2,{getHex64:()=>getHex64$2,getInt:()=>getInt$2,getSubscriptionId:()=>getSubscriptionId$2,matchEventId:()=>matchEventId$2,matchEventKind:()=>matchEventKind$2,matchEventPubkey:()=>matchEventPubkey$2});function getHex64$2(r,t){let n=t.length+3,s=r.indexOf(`"${t}":`)+n,o=r.slice(s).indexOf('"')+s+1;return r.slice(o,o+64)}function getInt$2(r,t){let n=t.length,s=r.indexOf(`"${t}":`)+n+3,o=r.slice(s),a=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,a),10)}function getSubscriptionId$2(r){let t=r.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=r.slice(t+7+1).indexOf('"');if(n===-1)return null;let s=t+7+1+n,o=r.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return r.slice(s+1,a)}function matchEventId$2(r,t){return t===getHex64$2(r,"id")}function matchEventPubkey$2(r,t){return t===getHex64$2(r,"pubkey")}function matchEventKind$2(r,t){return t===getInt$2(r,"kind")}var nip42_exports$2={};__export2(nip42_exports$2,{makeAuthEvent:()=>makeAuthEvent$2});function makeAuthEvent$2(r,t){return{kind:ClientAuth$2,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",t]],content:""}}var _WebSocket$2;try{_WebSocket$2=WebSocket}catch{}var _WebSocket2$2;try{_WebSocket2$2=WebSocket}catch{}var nip19_exports$4={};__export2(nip19_exports$4,{BECH32_REGEX:()=>BECH32_REGEX$5,Bech32MaxSize:()=>Bech32MaxSize$6,NostrTypeGuard:()=>NostrTypeGuard$4,decode:()=>decode$7,decodeNostrURI:()=>decodeNostrURI$4,encodeBytes:()=>encodeBytes$6,naddrEncode:()=>naddrEncode$4,neventEncode:()=>neventEncode$4,noteEncode:()=>noteEncode$4,nprofileEncode:()=>nprofileEncode$4,npubEncode:()=>npubEncode$4,nsecEncode:()=>nsecEncode$4});var NostrTypeGuard$4={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize$6=5e3,BECH32_REGEX$5=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array$4(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI$4(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode$7(r)}catch{return{type:"invalid",data:null}}}function decode$7(r){let{prefix:t,words:n}=bech32$4.decode(r,Bech32MaxSize$6),s=new Uint8Array(bech32$4.fromWords(n));switch(t){case"nprofile":{let o=parseTLV$4(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex2(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$4.decode(a)):[]}}}case"nevent":{let o=parseTLV$4(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex2(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$4.decode(a)):[],author:o[2]?.[0]?bytesToHex2(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex2(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV$4(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder$4.decode(o[0][0]),pubkey:bytesToHex2(o[2][0]),kind:parseInt(bytesToHex2(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder$4.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex2(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV$4(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode$4(r){return encodeBytes$6("nsec",r)}function npubEncode$4(r){return encodeBytes$6("npub",hexToBytes2(r))}function noteEncode$4(r){return encodeBytes$6("note",hexToBytes2(r))}function encodeBech32$6(r,t){let n=bech32$4.toWords(t);return bech32$4.encode(r,n,Bech32MaxSize$6)}function encodeBytes$6(r,t){return encodeBech32$6(r,t)}function nprofileEncode$4(r){let t=encodeTLV$4({0:[hexToBytes2(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder$4.encode(n))});return encodeBech32$6("nprofile",t)}function neventEncode$4(r){let t;r.kind!==void 0&&(t=integerToUint8Array$4(r.kind));let n=encodeTLV$4({0:[hexToBytes2(r.id)],1:(r.relays||[]).map(s=>utf8Encoder$4.encode(s)),2:r.author?[hexToBytes2(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32$6("nevent",n)}function naddrEncode$4(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV$4({0:[utf8Encoder$4.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder$4.encode(s)),2:[hexToBytes2(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech32$6("naddr",n)}function encodeTLV$4(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes3(...t)}var nip04_exports$2={};__export2(nip04_exports$2,{decrypt:()=>decrypt2$2,encrypt:()=>encrypt2$2});function encrypt2$2(r,t,n){const s=r instanceof Uint8Array?bytesToHex2(r):r,o=secp256k1$4.getSharedSecret(s,"02"+t),a=getNormalizedX$2(o);let c=Uint8Array.from(randomBytes3(16)),f=utf8Encoder$4.encode(n),g=cbc$2(a,c).encrypt(f),b=base64$2.encode(new Uint8Array(g)),_=base64$2.encode(new Uint8Array(c.buffer));return`${b}?iv=${_}`}function decrypt2$2(r,t,n){const s=r instanceof Uint8Array?bytesToHex2(r):r;let[o,a]=n.split("?iv="),c=secp256k1$4.getSharedSecret(s,"02"+t),f=getNormalizedX$2(c),g=base64$2.decode(a),b=base64$2.decode(o),_=cbc$2(f,g).decrypt(b);return utf8Decoder$4.decode(_)}function getNormalizedX$2(r){return r.slice(1,33)}var nip05_exports$2={};__export2(nip05_exports$2,{NIP05_REGEX:()=>NIP05_REGEX$4,isNip05:()=>isNip05$2,isValid:()=>isValid$2,queryProfile:()=>queryProfile$2,searchDomain:()=>searchDomain$2,useFetchImplementation:()=>useFetchImplementation$2});var NIP05_REGEX$4=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05$2=r=>NIP05_REGEX$4.test(r||""),_fetch$2;try{_fetch$2=fetch}catch(r){}function useFetchImplementation$2(r){_fetch$2=r}async function searchDomain$2(r,t=""){try{const n=`https://${r}/.well-known/nostr.json?name=${t}`,s=await _fetch$2(n,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");return(await s.json()).names}catch{return{}}}async function queryProfile$2(r){const t=r.match(NIP05_REGEX$4);if(!t)return null;const[,n="_",s]=t;try{const o=`https://${s}/.well-known/nostr.json?name=${n}`,a=await _fetch$2(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const c=await a.json(),f=c.names[n];return f?{pubkey:f,relays:c.relays?.[f]}:null}catch{return null}}async function isValid$2(r,t){const n=await queryProfile$2(t);return n?n.pubkey===r:!1}var nip10_exports$2={};__export2(nip10_exports$2,{parse:()=>parse2$2});function parse2$2(r){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,s;for(let o=r.tags.length-1;o>=0;o--){const a=r.tags[o];if(a[0]==="e"&&a[1]){const[c,f,g,b,_]=a,L={id:f,relays:g?[g]:[],author:_};if(b==="root"){t.root=L;continue}if(b==="reply"){t.reply=L;continue}if(b==="mention"){t.mentions.push(L);continue}n?s=L:n=L,t.mentions.push(L);continue}if(a[0]==="q"&&a[1]){const[c,f,g]=a;t.quotes.push({id:f,relays:g?[g]:[]})}if(a[0]==="p"&&a[1]){t.profiles.push({pubkey:a[1],relays:a[2]?[a[2]]:[]});continue}}return t.root||(t.root=s||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let a=t.mentions.indexOf(o);if(a!==-1&&t.mentions.splice(a,1),o.author){let c=t.profiles.find(f=>f.pubkey===o.author);c&&c.relays&&(o.relays||(o.relays=[]),c.relays.forEach(f=>{o.relays?.indexOf(f)===-1&&o.relays.push(f)}),c.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let a=t.profiles.find(c=>c.pubkey===o.author);a&&a.relays&&(o.relays||(o.relays=[]),a.relays.forEach(c=>{o.relays.indexOf(c)===-1&&o.relays.push(c)}),a.relays=o.relays)}}),t}var nip11_exports$2={};__export2(nip11_exports$2,{fetchRelayInformation:()=>fetchRelayInformation$4,useFetchImplementation:()=>useFetchImplementation2$2});var _fetch2$2;try{_fetch2$2=fetch}catch{}function useFetchImplementation2$2(r){_fetch2$2=r}async function fetchRelayInformation$4(r){return await(await fetch(r.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports$2={};__export2(nip13_exports$2,{fastEventHash:()=>fastEventHash$2,getPow:()=>getPow$2,minePow:()=>minePow$2});function getPow$2(r){let t=0;for(let n=0;n<64;n+=8){const s=parseInt(r.substring(n,n+8),16);if(s===0)t+=32;else{t+=Math.clz32(s);break}}return t}function minePow$2(r,t){let n=0;const s=r,o=["nonce",n.toString(),t.toString()];for(s.tags.push(o);;){const a=Math.floor(new Date().getTime()/1e3);if(a!==s.created_at&&(n=0,s.created_at=a),o[1]=(++n).toString(),s.id=fastEventHash$2(s),getPow$2(s.id)>=t)break}return s}function fastEventHash$2(r){return bytesToHex2(sha2562(utf8Encoder$4.encode(JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content]))))}var nip17_exports$2={};__export2(nip17_exports$2,{unwrapEvent:()=>unwrapEvent2$2,unwrapManyEvents:()=>unwrapManyEvents2$2,wrapEvent:()=>wrapEvent2$2,wrapManyEvents:()=>wrapManyEvents2$2});var nip59_exports$2={};__export2(nip59_exports$2,{createRumor:()=>createRumor$2,createSeal:()=>createSeal$2,createWrap:()=>createWrap$2,unwrapEvent:()=>unwrapEvent$2,unwrapManyEvents:()=>unwrapManyEvents$2,wrapEvent:()=>wrapEvent$4,wrapManyEvents:()=>wrapManyEvents$2});var nip44_exports$2={};__export2(nip44_exports$2,{decrypt:()=>decrypt22,encrypt:()=>encrypt22,getConversationKey:()=>getConversationKey$2,v2:()=>v2$2});var minPlaintextSize$2=1,maxPlaintextSize$2=65535;function getConversationKey$2(r,t){const n=secp256k1$4.getSharedSecret(r,"02"+t).subarray(1,33);return extract$2(sha2562,n,"nip44-v2")}function getMessageKeys$2(r,t){const n=expand$2(sha2562,r,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function calcPaddedLen$2(r){if(!Number.isSafeInteger(r)||r<1)throw new Error("expected positive integer");if(r<=32)return 32;const t=1<<Math.floor(Math.log2(r-1))+1,n=t<=256?32:t/8;return n*(Math.floor((r-1)/n)+1)}function writeU16BE$2(r){if(!Number.isSafeInteger(r)||r<minPlaintextSize$2||r>maxPlaintextSize$2)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,r,!1),t}function pad2(r){const t=utf8Encoder$4.encode(r),n=t.length,s=writeU16BE$2(n),o=new Uint8Array(calcPaddedLen$2(n)-n);return concatBytes3(s,t,o)}function unpad$2(r){const t=new DataView(r.buffer).getUint16(0),n=r.subarray(2,2+t);if(t<minPlaintextSize$2||t>maxPlaintextSize$2||n.length!==t||r.length!==2+calcPaddedLen$2(t))throw new Error("invalid padding");return utf8Decoder$4.decode(n)}function hmacAad$2(r,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const s=concatBytes3(n,t);return hmac2(sha2562,r,s)}function decodePayload$2(r){if(typeof r!="string")throw new Error("payload must be a valid string");const t=r.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(r[0]==="#")throw new Error("unknown encryption version");let n;try{n=base64$2.decode(r)}catch(a){throw new Error("invalid base64: "+a.message)}const s=n.length;if(s<99||s>65603)throw new Error("invalid data length: "+s);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function encrypt22(r,t,n=randomBytes3(32)){const{chacha_key:s,chacha_nonce:o,hmac_key:a}=getMessageKeys$2(t,n),c=pad2(r),f=chacha20$2(s,o,c),g=hmacAad$2(a,f,n);return base64$2.encode(concatBytes3(new Uint8Array([2]),n,f,g))}function decrypt22(r,t){const{nonce:n,ciphertext:s,mac:o}=decodePayload$2(r),{chacha_key:a,chacha_nonce:c,hmac_key:f}=getMessageKeys$2(t,n),g=hmacAad$2(f,s,n);if(!equalBytes2(g,o))throw new Error("invalid MAC");const b=chacha20$2(a,c,s);return unpad$2(b)}var v2$2={utils:{getConversationKey:getConversationKey$2,calcPaddedLen:calcPaddedLen$2},encrypt:encrypt22,decrypt:decrypt22},TWO_DAYS$2=2880*60,now$2=()=>Math.round(Date.now()/1e3),randomNow$2=()=>Math.round(now$2()-Math.random()*TWO_DAYS$2),nip44ConversationKey$2=(r,t)=>getConversationKey$2(r,t),nip44Encrypt$2=(r,t,n)=>encrypt22(JSON.stringify(r),nip44ConversationKey$2(t,n)),nip44Decrypt$2=(r,t)=>JSON.parse(decrypt22(r.content,nip44ConversationKey$2(t,r.pubkey)));function createRumor$2(r,t){const n={created_at:now$2(),content:"",tags:[],...r,pubkey:getPublicKey$2(t)};return n.id=getEventHash$4(n),n}function createSeal$2(r,t,n){return finalizeEvent$2({kind:Seal$2,content:nip44Encrypt$2(r,t,n),created_at:randomNow$2(),tags:[]},t)}function createWrap$2(r,t){const n=generateSecretKey$2();return finalizeEvent$2({kind:GiftWrap$2,content:nip44Encrypt$2(r,n,t),created_at:randomNow$2(),tags:[["p",t]]},n)}function wrapEvent$4(r,t,n){const s=createRumor$2(r,t),o=createSeal$2(s,t,n);return createWrap$2(o,n)}function wrapManyEvents$2(r,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const s=getPublicKey$2(t),o=[wrapEvent$4(r,t,s)];return n.forEach(a=>{o.push(wrapEvent$4(r,t,a))}),o}function unwrapEvent$2(r,t){const n=nip44Decrypt$2(r,t);return nip44Decrypt$2(n,t)}function unwrapManyEvents$2(r,t){let n=[];return r.forEach(s=>{n.push(unwrapEvent$2(s,t))}),n.sort((s,o)=>s.created_at-o.created_at),n}function createEvent$2(r,t,n,s){const o={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage$2,tags:[],content:t};return(Array.isArray(r)?r:[r]).forEach(({publicKey:c,relayUrl:f})=>{o.tags.push(f?["p",c,f]:["p",c])}),s&&o.tags.push(["e",s.eventId,s.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function wrapEvent2$2(r,t,n,s,o){const a=createEvent$2(t,n,s,o);return wrapEvent$4(a,r,t.publicKey)}function wrapManyEvents2$2(r,t,n,s,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey$2(r)},...t].map(c=>wrapEvent2$2(r,c,n,s,o))}var unwrapEvent2$2=unwrapEvent$2,unwrapManyEvents2$2=unwrapManyEvents$2,nip18_exports$2={};__export2(nip18_exports$2,{finishRepostEvent:()=>finishRepostEvent$2,getRepostedEvent:()=>getRepostedEvent$2,getRepostedEventPointer:()=>getRepostedEventPointer$2});function finishRepostEvent$2(r,t,n,s){let o;const a=[...r.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===ShortTextNote$2?o=Repost$2:(o=GenericRepost$2,a.push(["k",String(t.kind)])),finalizeEvent$2({kind:o,tags:a,content:r.content===""||t.tags?.find(c=>c[0]==="-")?"":JSON.stringify(t),created_at:r.created_at},s)}function getRepostedEventPointer$2(r){if(![Repost$2,GenericRepost$2].includes(r.kind))return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(s=>typeof s=="string"),author:n?.[1]}}function getRepostedEvent$2(r,{skipVerification:t}={}){const n=getRepostedEventPointer$2(r);if(n===void 0||r.content==="")return;let s;try{s=JSON.parse(r.content)}catch{return}if(s.id===n.id&&!(!t&&!verifyEvent$2(s)))return s}var nip21_exports$2={};__export2(nip21_exports$2,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX$2,parse:()=>parse22,test:()=>test$2});var NOSTR_URI_REGEX$2=new RegExp(`nostr:(${BECH32_REGEX$5.source})`);function test$2(r){return typeof r=="string"&&new RegExp(`^${NOSTR_URI_REGEX$2.source}$`).test(r)}function parse22(r){const t=r.match(new RegExp(`^${NOSTR_URI_REGEX$2.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${r}`);return{uri:t[0],value:t[1],decoded:decode$7(t[1])}}var nip25_exports$2={};__export2(nip25_exports$2,{finishReactionEvent:()=>finishReactionEvent$2,getReactedEventPointer:()=>getReactedEventPointer$2});function finishReactionEvent$2(r,t,n){const s=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return finalizeEvent$2({...r,kind:Reaction$2,tags:[...r.tags??[],...s,["e",t.id],["p",t.pubkey]],content:r.content??"+"},n)}function getReactedEventPointer$2(r){if(r.kind!==Reaction$2)return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(s=>s!==void 0),author:n[1]}}var nip27_exports$2={};__export2(nip27_exports$2,{parse:()=>parse3$2});var noCharacter$2=/\W/m,noURLCharacter$2=/\W |\W$|$|,| /m;function*parse3$2(r){const t=r.length;let n=0,s=0;for(;s<t;){let o=r.indexOf(":",s);if(o===-1)break;if(r.substring(o-5,o)==="nostr"){const a=r.substring(o+60).match(noCharacter$2),c=a?o+60+a.index:t;try{let f,{data:g,type:b}=decode$7(r.substring(o+1,c));switch(b){case"npub":f={pubkey:g};break;case"nsec":case"note":s=c+1;continue;default:f=g}n!==o-5&&(yield{type:"text",text:r.substring(n,o-5)}),yield{type:"reference",pointer:f},s=c,n=s;continue}catch{s=o+1;continue}}else if(r.substring(o-5,o)==="https"||r.substring(o-4,o)==="http"){const a=r.substring(o+4).match(noURLCharacter$2),c=a?o+4+a.index:t,f=r[o-1]==="s"?5:4;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),/\.(png|jpe?g|gif|webp)$/i.test(g.pathname)){yield{type:"image",url:g.toString()},s=c,n=s;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(g.pathname)){yield{type:"video",url:g.toString()},s=c,n=s;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(g.pathname)){yield{type:"audio",url:g.toString()},s=c,n=s;continue}yield{type:"url",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else if(r.substring(o-3,o)==="wss"||r.substring(o-2,o)==="ws"){const a=r.substring(o+4).match(noURLCharacter$2),c=a?o+4+a.index:t,f=r[o-1]==="s"?3:2;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),yield{type:"relay",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else{s=o+1;continue}}n!==t&&(yield{type:"text",text:r.substring(n)})}var nip28_exports$2={};__export2(nip28_exports$2,{channelCreateEvent:()=>channelCreateEvent$2,channelHideMessageEvent:()=>channelHideMessageEvent$2,channelMessageEvent:()=>channelMessageEvent$2,channelMetadataEvent:()=>channelMetadataEvent$2,channelMuteUserEvent:()=>channelMuteUserEvent$2});var channelCreateEvent$2=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$2({kind:ChannelCreation$2,tags:[...r.tags??[]],content:n,created_at:r.created_at},t)},channelMetadataEvent$2=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$2({kind:ChannelMetadata$2,tags:[["e",r.channel_create_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMessageEvent$2=(r,t)=>{const n=[["e",r.channel_create_event_id,r.relay_url,"root"]];return r.reply_to_channel_message_event_id&&n.push(["e",r.reply_to_channel_message_event_id,r.relay_url,"reply"]),finalizeEvent$2({kind:ChannelMessage$2,tags:[...n,...r.tags??[]],content:r.content,created_at:r.created_at},t)},channelHideMessageEvent$2=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$2({kind:ChannelHideMessage$2,tags:[["e",r.channel_message_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMuteUserEvent$2=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$2({kind:ChannelMuteUser$2,tags:[["p",r.pubkey_to_mute],...r.tags??[]],content:n,created_at:r.created_at},t)},nip30_exports$2={};__export2(nip30_exports$2,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX$2,matchAll:()=>matchAll$2,regex:()=>regex$4,replaceAll:()=>replaceAll$2});var EMOJI_SHORTCODE_REGEX$2=/:(\w+):/,regex$4=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX$2.source}\\B`,"g");function*matchAll$2(r){const t=r.matchAll(regex$4());for(const n of t)try{const[s,o]=n;yield{shortcode:s,name:o,start:n.index,end:n.index+s.length}}catch{}}function replaceAll$2(r,t){return r.replaceAll(regex$4(),(n,s)=>t({shortcode:n,name:s}))}var nip39_exports$2={};__export2(nip39_exports$2,{useFetchImplementation:()=>useFetchImplementation3$2,validateGithub:()=>validateGithub$2});var _fetch3$2;try{_fetch3$2=fetch}catch{}function useFetchImplementation3$2(r){_fetch3$2=r}async function validateGithub$2(r,t,n){try{return await(await _fetch3$2(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${r}`}catch{return!1}}var nip47_exports$2={};__export2(nip47_exports$2,{makeNwcRequestEvent:()=>makeNwcRequestEvent$2,parseConnectionString:()=>parseConnectionString$2});function parseConnectionString$2(r){const{host:t,pathname:n,searchParams:s}=new URL(r),o=n||t,a=s.get("relay"),c=s.get("secret");if(!o||!a||!c)throw new Error("invalid connection string");return{pubkey:o,relay:a,secret:c}}async function makeNwcRequestEvent$2(r,t,n){const o=encrypt2$2(t,r,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),a={kind:NWCWalletRequest$2,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",r]]};return finalizeEvent$2(a,t)}var nip54_exports$2={};__export2(nip54_exports$2,{normalizeIdentifier:()=>normalizeIdentifier$2});function normalizeIdentifier$2(r){return r=r.trim().toLowerCase(),r=r.normalize("NFKC"),Array.from(r).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nip57_exports$2={};__export2(nip57_exports$2,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11$2,getZapEndpoint:()=>getZapEndpoint$2,makeZapReceipt:()=>makeZapReceipt$2,makeZapRequest:()=>makeZapRequest$2,useFetchImplementation:()=>useFetchImplementation4$2,validateZapRequest:()=>validateZapRequest$2});var _fetch4$2;try{_fetch4$2=fetch}catch{}function useFetchImplementation4$2(r){_fetch4$2=r}async function getZapEndpoint$2(r){try{let t="",{lud06:n,lud16:s}=JSON.parse(r.content);if(n){let{words:c}=bech32$4.decode(n,1e3),f=bech32$4.fromWords(c);t=utf8Decoder$4.decode(f)}else if(s){let[c,f]=s.split("@");t=new URL(`/.well-known/lnurlp/${c}`,`https://${f}`).toString()}else return null;let a=await(await _fetch4$2(t)).json();if(a.allowsNostr&&a.nostrPubkey)return a.callback}catch{}return null}function makeZapRequest$2(r){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:r.comment||"",tags:[["p","pubkey"in r?r.pubkey:r.event.pubkey],["amount",r.amount.toString()],["relays",...r.relays]]};if("event"in r){if(t.tags.push(["e",r.event.id]),isReplaceableKind$2(r.event.kind)){const n=["a",`${r.event.kind}:${r.event.pubkey}:`];t.tags.push(n)}else if(isAddressableKind$2(r.event.kind)){let n=r.event.tags.find(([o,a])=>o==="d"&&a);if(!n)throw new Error("d tag not found or is empty");const s=["a",`${r.event.kind}:${r.event.pubkey}:${n[1]}`];t.tags.push(s)}t.tags.push(["k",r.event.kind.toString()])}return t}function validateZapRequest$2(r){let t;try{t=JSON.parse(r)}catch{return"Invalid zap request JSON."}if(!validateEvent$2(t))return"Zap request is not a valid Nostr event.";if(!verifyEvent$2(t))return"Invalid signature on zap request.";let n=t.tags.find(([a,c])=>a==="p"&&c);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let s=t.tags.find(([a,c])=>a==="e"&&c);return s&&!s[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([a,c])=>a==="relays"&&c)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt$2({zapRequest:r,preimage:t,bolt11:n,paidAt:s}){let o=JSON.parse(r),a=o.tags.filter(([f])=>f==="e"||f==="p"||f==="a"),c={kind:9735,created_at:Math.round(s.getTime()/1e3),content:"",tags:[...a,["P",o.pubkey],["bolt11",n],["description",r]]};return t&&c.tags.push(["preimage",t]),c}function getSatoshisAmountFromBolt11$2(r){if(r.length<50)return 0;r=r.substring(0,50);const t=r.lastIndexOf("1");if(t===-1)return 0;const n=r.substring(0,t);if(!n.startsWith("lnbc"))return 0;const s=n.substring(4);if(s.length<1)return 0;const o=s[s.length-1],a=o.charCodeAt(0)-48,c=a>=0&&a<=9;let f=s.length-1;if(c&&f++,f<1)return 0;const g=parseInt(s.substring(0,f));switch(o){case"m":return g*1e5;case"u":return g*100;case"n":return g/10;case"p":return g/1e4;default:return g*1e8}}var nip98_exports$2={};__export2(nip98_exports$2,{getToken:()=>getToken$2,hashPayload:()=>hashPayload$2,unpackEventFromToken:()=>unpackEventFromToken$2,validateEvent:()=>validateEvent2$2,validateEventKind:()=>validateEventKind$2,validateEventMethodTag:()=>validateEventMethodTag$2,validateEventPayloadTag:()=>validateEventPayloadTag$2,validateEventTimestamp:()=>validateEventTimestamp$2,validateEventUrlTag:()=>validateEventUrlTag$2,validateToken:()=>validateToken$2});var _authorizationScheme$2="Nostr ";async function getToken$2(r,t,n,s=!1,o){const a={kind:HTTPAuth$2,tags:[["u",r],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&a.tags.push(["payload",hashPayload$2(o)]);const c=await n(a);return(s?_authorizationScheme$2:"")+base64$2.encode(utf8Encoder$4.encode(JSON.stringify(c)))}async function validateToken$2(r,t,n){const s=await unpackEventFromToken$2(r).catch(a=>{throw a});return await validateEvent2$2(s,t,n).catch(a=>{throw a})}async function unpackEventFromToken$2(r){if(!r)throw new Error("Missing token");r=r.replace(_authorizationScheme$2,"");const t=utf8Decoder$4.decode(base64$2.decode(r));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function validateEventTimestamp$2(r){return r.created_at?Math.round(new Date().getTime()/1e3)-r.created_at<60:!1}function validateEventKind$2(r){return r.kind===HTTPAuth$2}function validateEventUrlTag$2(r,t){const n=r.tags.find(s=>s[0]==="u");return n?n.length>0&&n[1]===t:!1}function validateEventMethodTag$2(r,t){const n=r.tags.find(s=>s[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function hashPayload$2(r){const t=sha2562(utf8Encoder$4.encode(JSON.stringify(r)));return bytesToHex2(t)}function validateEventPayloadTag$2(r,t){const n=r.tags.find(o=>o[0]==="payload");if(!n)return!1;const s=hashPayload$2(t);return n.length>0&&n[1]===s}async function validateEvent2$2(r,t,n,s){if(!verifyEvent$2(r))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind$2(r))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp$2(r))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag$2(r,t))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag$2(r,n))throw new Error("Invalid nostr event, method tag invalid");if(s&&typeof s=="object"&&Object.keys(s).length>0&&!validateEventPayloadTag$2(r,s))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var crypto4=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes2(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function anumber$3(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function abytes$2(r,...t){if(!isBytes2(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function ahash$2(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$3(r.outputLen),anumber$3(r.blockLen)}function aexists$2(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function aoutput$2(r,t){abytes$2(r);const n=t.outputLen;if(r.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function clean$2(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}function createView4(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function rotr3(r,t){return r<<32-t|r>>>t}var hasHexBuiltin$2=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes3=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex3(r){if(abytes$2(r),hasHexBuiltin$2)return r.toHex();let t="";for(let n=0;n<r.length;n++)t+=hexes3[r[n]];return t}var asciis$2={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$2(r){if(r>=asciis$2._0&&r<=asciis$2._9)return r-asciis$2._0;if(r>=asciis$2.A&&r<=asciis$2.F)return r-(asciis$2.A-10);if(r>=asciis$2.a&&r<=asciis$2.f)return r-(asciis$2.a-10)}function hexToBytes3(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(hasHexBuiltin$2)return Uint8Array.fromHex(r);const t=r.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(n);for(let o=0,a=0;o<n;o++,a+=2){const c=asciiToBase16$2(r.charCodeAt(a)),f=asciiToBase16$2(r.charCodeAt(a+1));if(c===void 0||f===void 0){const g=r[a]+r[a+1];throw new Error('hex string expected, got non-hex character "'+g+'" at index '+a)}s[o]=c*16+f}return s}function utf8ToBytes6(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function toBytes4(r){return typeof r=="string"&&(r=utf8ToBytes6(r)),abytes$2(r),r}function concatBytes4(...r){let t=0;for(let s=0;s<r.length;s++){const o=r[s];abytes$2(o),t+=o.length}const n=new Uint8Array(t);for(let s=0,o=0;s<r.length;s++){const a=r[s];n.set(a,o),o+=a.length}return n}class Hash5{}function createHasher$2(r){const t=s=>r().update(toBytes4(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes5(r=32){if(crypto4&&typeof crypto4.getRandomValues=="function")return crypto4.getRandomValues(new Uint8Array(r));if(crypto4&&typeof crypto4.randomBytes=="function")return Uint8Array.from(crypto4.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint644(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}function Chi3(r,t,n){return r&t^~r&n}function Maj3(r,t,n){return r&t^r&n^t&n}let HashMD$2=class extends Hash5{constructor(t,n,s,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.buffer=new Uint8Array(t),this.view=createView4(this.buffer)}update(t){aexists$2(this),t=toBytes4(t),abytes$2(t);const{view:n,buffer:s,blockLen:o}=this,a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView4(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){aexists$2(this),aoutput$2(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,clean$2(this.buffer.subarray(c)),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint644(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView4(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.destroyed=c,t.finished=a,t.length=o,t.pos=f,o%n&&t.buffer.set(s),t}clone(){return this._cloneInto()}};var SHA256_IV$2=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_K3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W3=new Uint32Array(64);class SHA2563 extends HashMD$2{constructor(t=32){super(64,t,8,!1),this.A=SHA256_IV$2[0]|0,this.B=SHA256_IV$2[1]|0,this.C=SHA256_IV$2[2]|0,this.D=SHA256_IV$2[3]|0,this.E=SHA256_IV$2[4]|0,this.F=SHA256_IV$2[5]|0,this.G=SHA256_IV$2[6]|0,this.H=SHA256_IV$2[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W3[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W3[L-15],X=SHA256_W3[L-2],te=rotr3(q,7)^rotr3(q,18)^q>>>3,ne=rotr3(X,17)^rotr3(X,19)^X>>>10;SHA256_W3[L]=ne+SHA256_W3[L-7]+te+SHA256_W3[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr3(f,6)^rotr3(f,11)^rotr3(f,25),X=_+q+Chi3(f,g,b)+SHA256_K3[L]+SHA256_W3[L]|0,ne=(rotr3(s,2)^rotr3(s,13)^rotr3(s,22))+Maj3(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){clean$2(SHA256_W3)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$2(this.buffer)}}var sha2563=createHasher$2(()=>new SHA2563);class HMAC3 extends Hash5{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ahash$2(t);const s=toBytes4(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),clean$2(a)}update(t){return aexists$2(this),this.iHash.update(t),this}digestInto(t){aexists$2(this),abytes$2(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var hmac3=(r,t,n)=>new HMAC3(r,t).update(n).digest();hmac3.create=(r,t)=>new HMAC3(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n6=BigInt(0),_1n6=BigInt(1);function _abool2$2(r,t=""){if(typeof r!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof r)}return r}function _abytes2$2(r,t,n=""){const s=isBytes2(r),o=r?.length,a=t!==void 0;if(!s||a&&o!==t){const c=n&&`"${n}" `,f=a?` of length ${t}`:"",g=s?`length=${o}`:`type=${typeof r}`;throw new Error(c+"expected Uint8Array"+f+", got "+g)}return r}function numberToHexUnpadded2(r){const t=r.toString(16);return t.length&1?"0"+t:t}function hexToNumber2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?_0n6:BigInt("0x"+r)}function bytesToNumberBE2(r){return hexToNumber2(bytesToHex3(r))}function bytesToNumberLE2(r){return abytes$2(r),hexToNumber2(bytesToHex3(Uint8Array.from(r).reverse()))}function numberToBytesBE2(r,t){return hexToBytes3(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE2(r,t){return numberToBytesBE2(r,t).reverse()}function ensureBytes2(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes3(t)}catch(a){throw new Error(r+" must be hex string or Uint8Array, cause: "+a)}else if(isBytes2(t))s=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(r+" of length "+n+" expected, got "+o);return s}var isPosBig$2=r=>typeof r=="bigint"&&_0n6<=r;function inRange$2(r,t,n){return isPosBig$2(r)&&isPosBig$2(t)&&isPosBig$2(n)&&t<=r&&r<n}function aInRange$2(r,t,n,s){if(!inRange$2(t,n,s))throw new Error("expected valid "+r+": "+n+" <= n < "+s+", got "+t)}function bitLen2(r){let t;for(t=0;r>_0n6;r>>=_1n6,t+=1);return t}var bitMask2=r=>(_1n6<<BigInt(r))-_1n6;function createHmacDrbg2(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const s=X=>new Uint8Array(X),o=X=>Uint8Array.of(X);let a=s(r),c=s(r),f=0;const g=()=>{a.fill(1),c.fill(0),f=0},b=(...X)=>n(c,a,...X),_=(X=s(0))=>{c=b(o(0),X),a=b(),X.length!==0&&(c=b(o(1),X),a=b())},L=()=>{if(f++>=1e3)throw new Error("drbg: tried 1000 values");let X=0;const te=[];for(;X<t;){a=b();const ne=a.slice();te.push(ne),X+=a.length}return concatBytes4(...te)};return(X,te)=>{g(),_(X);let ne;for(;!(ne=te(L()));)_();return g(),ne}}function _validateObject$2(r,t,n={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function s(o,a,c){const f=r[o];if(c&&f===void 0)return;const g=typeof f;if(g!==a||f===null)throw new Error(`param "${o}" is invalid: expected ${a}, got ${g}`)}Object.entries(t).forEach(([o,a])=>s(o,a,!1)),Object.entries(n).forEach(([o,a])=>s(o,a,!0))}function memoized$2(r){const t=new WeakMap;return(n,...s)=>{const o=t.get(n);if(o!==void 0)return o;const a=r(n,...s);return t.set(n,a),a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n7=BigInt(0),_1n7=BigInt(1),_2n5=BigInt(2),_3n3=BigInt(3),_4n3=BigInt(4),_5n2=BigInt(5),_7n$2=BigInt(7),_8n2=BigInt(8),_9n2=BigInt(9),_16n2=BigInt(16);function mod2(r,t){const n=r%t;return n>=_0n7?n:t+n}function pow22(r,t,n){let s=r;for(;t-- >_0n7;)s*=s,s%=n;return s}function invert2(r,t){if(r===_0n7)throw new Error("invert: expected non-zero number");if(t<=_0n7)throw new Error("invert: expected positive modulus, got "+t);let n=mod2(r,t),s=t,o=_0n7,a=_1n7;for(;n!==_0n7;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n7)throw new Error("invert: does not exist");return mod2(o,t)}function assertIsSquare$2(r,t,n){if(!r.eql(r.sqr(t),n))throw new Error("Cannot find square root")}function sqrt3mod4$2(r,t){const n=(r.ORDER+_1n7)/_4n3,s=r.pow(t,n);return assertIsSquare$2(r,s,t),s}function sqrt5mod8$2(r,t){const n=(r.ORDER-_5n2)/_8n2,s=r.mul(t,_2n5),o=r.pow(s,n),a=r.mul(t,o),c=r.mul(r.mul(a,_2n5),o),f=r.mul(a,r.sub(c,r.ONE));return assertIsSquare$2(r,f,t),f}function sqrt9mod16$2(r){const t=Field2(r),n=tonelliShanks2(r),s=n(t,t.neg(t.ONE)),o=n(t,s),a=n(t,t.neg(s)),c=(r+_7n$2)/_16n2;return(f,g)=>{let b=f.pow(g,c),_=f.mul(b,s);const L=f.mul(b,o),q=f.mul(b,a),X=f.eql(f.sqr(_),g),te=f.eql(f.sqr(L),g);b=f.cmov(b,_,X),_=f.cmov(q,L,te);const ne=f.eql(f.sqr(_),g),Ce=f.cmov(b,_,ne);return assertIsSquare$2(f,Ce,g),Ce}}function tonelliShanks2(r){if(r<_3n3)throw new Error("sqrt is not defined for small field");let t=r-_1n7,n=0;for(;t%_2n5===_0n7;)t/=_2n5,n++;let s=_2n5;const o=Field2(r);for(;FpLegendre$2(o,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return sqrt3mod4$2;let a=o.pow(s,t);const c=(t+_1n7)/_2n5;return function(g,b){if(g.is0(b))return b;if(FpLegendre$2(g,b)!==1)throw new Error("Cannot find square root");let _=n,L=g.mul(g.ONE,a),q=g.pow(b,t),X=g.pow(b,c);for(;!g.eql(q,g.ONE);){if(g.is0(q))return g.ZERO;let te=1,ne=g.sqr(q);for(;!g.eql(ne,g.ONE);)if(te++,ne=g.sqr(ne),te===_)throw new Error("Cannot find square root");const Ce=_1n7<<BigInt(_-te-1),Le=g.pow(L,Ce);_=te,L=g.sqr(Le),q=g.mul(q,L),X=g.mul(X,Le)}return X}}function FpSqrt2(r){return r%_4n3===_3n3?sqrt3mod4$2:r%_8n2===_5n2?sqrt5mod8$2:r%_16n2===_9n2?sqrt9mod16$2(r):tonelliShanks2(r)}var FIELD_FIELDS2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField2(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=FIELD_FIELDS2.reduce((s,o)=>(s[o]="function",s),t);return _validateObject$2(r,n),r}function FpPow2(r,t,n){if(n<_0n7)throw new Error("invalid exponent, negatives unsupported");if(n===_0n7)return r.ONE;if(n===_1n7)return t;let s=r.ONE,o=t;for(;n>_0n7;)n&_1n7&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n7;return s}function FpInvertBatch2(r,t,n=!1){const s=new Array(t.length).fill(n?r.ZERO:void 0),o=t.reduce((c,f,g)=>r.is0(f)?c:(s[g]=c,r.mul(c,f)),r.ONE),a=r.inv(o);return t.reduceRight((c,f,g)=>r.is0(f)?c:(s[g]=r.mul(c,s[g]),r.mul(c,f)),a),s}function FpLegendre$2(r,t){const n=(r.ORDER-_1n7)/_2n5,s=r.pow(t,n),o=r.eql(s,r.ONE),a=r.eql(s,r.ZERO),c=r.eql(s,r.neg(r.ONE));if(!o&&!a&&!c)throw new Error("invalid Legendre symbol result");return o?1:a?0:-1}function nLength2(r,t){t!==void 0&&anumber$3(t);const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field2(r,t,n=!1,s={}){if(r<=_0n7)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,a,c=!1,f;if(typeof t=="object"&&t!=null){if(s.sqrt||n)throw new Error("cannot specify opts in two arguments");const q=t;q.BITS&&(o=q.BITS),q.sqrt&&(a=q.sqrt),typeof q.isLE=="boolean"&&(n=q.isLE),typeof q.modFromBytes=="boolean"&&(c=q.modFromBytes),f=q.allowedLengths}else typeof t=="number"&&(o=t),s.sqrt&&(a=s.sqrt);const{nBitLength:g,nByteLength:b}=nLength2(r,o);if(b>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let _;const L=Object.freeze({ORDER:r,isLE:n,BITS:g,BYTES:b,MASK:bitMask2(g),ZERO:_0n7,ONE:_1n7,allowedLengths:f,create:q=>mod2(q,r),isValid:q=>{if(typeof q!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof q);return _0n7<=q&&q<r},is0:q=>q===_0n7,isValidNot0:q=>!L.is0(q)&&L.isValid(q),isOdd:q=>(q&_1n7)===_1n7,neg:q=>mod2(-q,r),eql:(q,X)=>q===X,sqr:q=>mod2(q*q,r),add:(q,X)=>mod2(q+X,r),sub:(q,X)=>mod2(q-X,r),mul:(q,X)=>mod2(q*X,r),pow:(q,X)=>FpPow2(L,q,X),div:(q,X)=>mod2(q*invert2(X,r),r),sqrN:q=>q*q,addN:(q,X)=>q+X,subN:(q,X)=>q-X,mulN:(q,X)=>q*X,inv:q=>invert2(q,r),sqrt:a||(q=>(_||(_=FpSqrt2(r)),_(L,q))),toBytes:q=>n?numberToBytesLE2(q,b):numberToBytesBE2(q,b),fromBytes:(q,X=!0)=>{if(f){if(!f.includes(q.length)||q.length>b)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+q.length);const ne=new Uint8Array(b);ne.set(q,n?0:ne.length-q.length),q=ne}if(q.length!==b)throw new Error("Field.fromBytes: expected "+b+" bytes, got "+q.length);let te=n?bytesToNumberLE2(q):bytesToNumberBE2(q);if(c&&(te=mod2(te,r)),!X&&!L.isValid(te))throw new Error("invalid field element: outside of range 0..ORDER");return te},invertBatch:q=>FpInvertBatch2(L,q),cmov:(q,X,te)=>te?X:q});return Object.freeze(L)}function getFieldBytesLength2(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength2(r){const t=getFieldBytesLength2(r);return t+Math.ceil(t/2)}function mapHashToField2(r,t,n=!1){const s=r.length,o=getFieldBytesLength2(t),a=getMinHashLength2(t);if(s<16||s<a||s>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+s);const c=n?bytesToNumberLE2(r):bytesToNumberBE2(r),f=mod2(c,t-_1n7)+_1n7;return n?numberToBytesLE2(f,o):numberToBytesBE2(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var _0n8=BigInt(0),_1n8=BigInt(1);function negateCt$2(r,t){const n=t.negate();return r?n:t}function normalizeZ$2(r,t){const n=FpInvertBatch2(r.Fp,t.map(s=>s.Z));return t.map((s,o)=>r.fromAffine(s.toAffine(n[o])))}function validateW$2(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function calcWOpts$2(r,t){validateW$2(r,t);const n=Math.ceil(t/r)+1,s=2**(r-1),o=2**r,a=bitMask2(r),c=BigInt(r);return{windows:n,windowSize:s,mask:a,maxNumber:o,shiftBy:c}}function calcOffsets$2(r,t,n){const{windowSize:s,mask:o,maxNumber:a,shiftBy:c}=n;let f=Number(r&o),g=r>>c;f>s&&(f-=a,g+=_1n8);const b=t*s,_=b+Math.abs(f)-1,L=f===0,q=f<0,X=t%2!==0;return{nextN:g,offset:_,isZero:L,isNeg:q,isNegF:X,offsetF:b}}function validateMSMPoints$2(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((n,s)=>{if(!(n instanceof t))throw new Error("invalid point at index "+s)})}function validateMSMScalars$2(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((n,s)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+s)})}var pointPrecomputes$2=new WeakMap,pointWindowSizes$2=new WeakMap;function getW$2(r){return pointWindowSizes$2.get(r)||1}function assert0$2(r){if(r!==_0n8)throw new Error("invalid wNAF")}class wNAF2{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,s=this.ZERO){let o=t;for(;n>_0n8;)n&_1n8&&(s=s.add(o)),o=o.double(),n>>=_1n8;return s}precomputeWindow(t,n){const{windows:s,windowSize:o}=calcWOpts$2(n,this.bits),a=[];let c=t,f=c;for(let g=0;g<s;g++){f=c,a.push(f);for(let b=1;b<o;b++)f=f.add(c),a.push(f);c=f.double()}return a}wNAF(t,n,s){if(!this.Fn.isValid(s))throw new Error("invalid scalar");let o=this.ZERO,a=this.BASE;const c=calcWOpts$2(t,this.bits);for(let f=0;f<c.windows;f++){const{nextN:g,offset:b,isZero:_,isNeg:L,isNegF:q,offsetF:X}=calcOffsets$2(s,f,c);s=g,_?a=a.add(negateCt$2(q,n[X])):o=o.add(negateCt$2(L,n[b]))}return assert0$2(s),{p:o,f:a}}wNAFUnsafe(t,n,s,o=this.ZERO){const a=calcWOpts$2(t,this.bits);for(let c=0;c<a.windows&&s!==_0n8;c++){const{nextN:f,offset:g,isZero:b,isNeg:_}=calcOffsets$2(s,c,a);if(s=f,!b){const L=n[g];o=o.add(_?L.negate():L)}}return assert0$2(s),o}getPrecomputes(t,n,s){let o=pointPrecomputes$2.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof s=="function"&&(o=s(o)),pointPrecomputes$2.set(n,o))),o}cached(t,n,s){const o=getW$2(t);return this.wNAF(o,this.getPrecomputes(o,t,s),n)}unsafe(t,n,s,o){const a=getW$2(t);return a===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),n,o)}createCache(t,n){validateW$2(n,this.bits),pointWindowSizes$2.set(t,n),pointPrecomputes$2.delete(t)}hasCache(t){return getW$2(t)!==1}}function mulEndoUnsafe$2(r,t,n,s){let o=t,a=r.ZERO,c=r.ZERO;for(;n>_0n8||s>_0n8;)n&_1n8&&(a=a.add(o)),s&_1n8&&(c=c.add(o)),o=o.double(),n>>=_1n8,s>>=_1n8;return{p1:a,p2:c}}function pippenger$2(r,t,n,s){validateMSMPoints$2(n,r),validateMSMScalars$2(s,t);const o=n.length,a=s.length;if(o!==a)throw new Error("arrays of points and scalars must have equal length");const c=r.ZERO,f=bitLen2(BigInt(o));let g=1;f>12?g=f-3:f>4?g=f-2:f>0&&(g=2);const b=bitMask2(g),_=new Array(Number(b)+1).fill(c),L=Math.floor((t.BITS-1)/g)*g;let q=c;for(let X=L;X>=0;X-=g){_.fill(c);for(let ne=0;ne<a;ne++){const Ce=s[ne],Le=Number(Ce>>BigInt(X)&b);_[Le]=_[Le].add(n[ne])}let te=c;for(let ne=_.length-1,Ce=c;ne>0;ne--)Ce=Ce.add(_[ne]),te=te.add(Ce);if(q=q.add(te),X!==0)for(let ne=0;ne<g;ne++)q=q.double()}return q}function createField$2(r,t,n){if(t){if(t.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField2(t),t}else return Field2(r,{isLE:n})}function _createCurveFields$2(r,t,n={},s){if(s===void 0&&(s=r==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${r} CURVE object`);for(const g of["p","n","h"]){const b=t[g];if(!(typeof b=="bigint"&&b>_0n8))throw new Error(`CURVE.${g} must be positive bigint`)}const o=createField$2(t.p,n.Fp,s),a=createField$2(t.n,n.Fn,s),f=["Gx","Gy","a","b"];for(const g of f)if(!o.isValid(t[g]))throw new Error(`CURVE.${g} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var divNearest2=(r,t)=>(r+(r>=0?t:-t)/_2n6)/t;function _splitEndoScalar$2(r,t,n){const[[s,o],[a,c]]=t,f=divNearest2(c*r,n),g=divNearest2(-o*r,n);let b=r-f*s-g*a,_=-f*o-g*c;const L=b<_0n9,q=_<_0n9;L&&(b=-b),q&&(_=-_);const X=bitMask2(Math.ceil(bitLen2(n)/2))+_1n9;if(b<_0n9||b>=X||_<_0n9||_>=X)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}function validateSigFormat$2(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function validateSigOpts$2(r,t){const n={};for(let s of Object.keys(t))n[s]=r[s]===void 0?t[s]:r[s];return _abool2$2(n.lowS,"lowS"),_abool2$2(n.prehash,"prehash"),n.format!==void 0&&validateSigFormat$2(n.format),n}class DERErr2 extends Error{constructor(t=""){super(t)}}var DER2={Err:DERErr2,_tlv:{encode:(r,t)=>{const{Err:n}=DER2;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const s=t.length/2,o=numberToHexUnpadded2(s);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const a=s>127?numberToHexUnpadded2(o.length/2|128):"";return numberToHexUnpadded2(r)+a+o+t},decode(r,t){const{Err:n}=DER2;let s=0;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[s++]!==r)throw new n("tlv.decode: wrong tlv");const o=t[s++],a=!!(o&128);let c=0;if(!a)c=o;else{const g=o&127;if(!g)throw new n("tlv.decode(long): indefinite length not supported");if(g>4)throw new n("tlv.decode(long): byte length is too big");const b=t.subarray(s,s+g);if(b.length!==g)throw new n("tlv.decode: length bytes not complete");if(b[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const _ of b)c=c<<8|_;if(s+=g,c<128)throw new n("tlv.decode(long): not minimal encoding")}const f=t.subarray(s,s+c);if(f.length!==c)throw new n("tlv.decode: wrong value length");return{v:f,l:t.subarray(s+c)}}},_int:{encode(r){const{Err:t}=DER2;if(r<_0n9)throw new t("integer: negative integers are not allowed");let n=numberToHexUnpadded2(r);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(r){const{Err:t}=DER2;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE2(r)}},toSig(r){const{Err:t,_int:n,_tlv:s}=DER2,o=ensureBytes2("signature",r),{v:a,l:c}=s.decode(48,o);if(c.length)throw new t("invalid signature: left bytes after parsing");const{v:f,l:g}=s.decode(2,a),{v:b,l:_}=s.decode(2,g);if(_.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(f),s:n.decode(b)}},hexFromSig(r){const{_tlv:t,_int:n}=DER2,s=t.encode(2,n.encode(r.r)),o=t.encode(2,n.encode(r.s)),a=s+o;return t.encode(48,a)}},_0n9=BigInt(0),_1n9=BigInt(1),_2n6=BigInt(2),_3n4=BigInt(3),_4n4=BigInt(4);function _normFnElement$2(r,t){const{BYTES:n}=r;let s;if(typeof t=="bigint")s=t;else{let o=ensureBytes2("private key",t);try{s=r.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}function weierstrassN$2(r,t={}){const n=_createCurveFields$2("weierstrass",r,t),{Fp:s,Fn:o}=n;let a=n.CURVE;const{h:c,n:f}=a;_validateObject$2(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:g}=t;if(g&&(!s.is0(a.a)||typeof g.beta!="bigint"||!Array.isArray(g.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const b=getWLengths$2(s,o);function _(){if(!s.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function L(se,m,A){const{x:k,y:Y}=m.toAffine(),Q=s.toBytes(k);if(_abool2$2(A,"isCompressed"),A){_();const $e=!s.isOdd(Y);return concatBytes4(pprefix$2($e),Q)}else return concatBytes4(Uint8Array.of(4),Q,s.toBytes(Y))}function q(se){_abytes2$2(se,void 0,"Point");const{publicKey:m,publicKeyUncompressed:A}=b,k=se.length,Y=se[0],Q=se.subarray(1);if(k===m&&(Y===2||Y===3)){const $e=s.fromBytes(Q);if(!s.isValid($e))throw new Error("bad point: is not on curve, wrong x");const ve=ne($e);let re;try{re=s.sqrt(ve)}catch(Ue){const Ze=Ue instanceof Error?": "+Ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ze)}_();const B=s.isOdd(re);return(Y&1)===1!==B&&(re=s.neg(re)),{x:$e,y:re}}else if(k===A&&Y===4){const $e=s.BYTES,ve=s.fromBytes(Q.subarray(0,$e)),re=s.fromBytes(Q.subarray($e,$e*2));if(!Ce(ve,re))throw new Error("bad point: is not on curve");return{x:ve,y:re}}else throw new Error(`bad point: got length ${k}, expected compressed=${m} or uncompressed=${A}`)}const X=t.toBytes||L,te=t.fromBytes||q;function ne(se){const m=s.sqr(se),A=s.mul(m,se);return s.add(s.add(A,s.mul(se,a.a)),a.b)}function Ce(se,m){const A=s.sqr(m),k=ne(se);return s.eql(A,k)}if(!Ce(a.Gx,a.Gy))throw new Error("bad curve params: generator point");const Le=s.mul(s.pow(a.a,_3n4),_4n4),Ge=s.mul(s.sqr(a.b),BigInt(27));if(s.is0(s.add(Le,Ge)))throw new Error("bad curve params: a or b");function ze(se,m,A=!1){if(!s.isValid(m)||A&&s.is0(m))throw new Error(`bad point coordinate ${se}`);return m}function Xe(se){if(!(se instanceof st))throw new Error("ProjectivePoint expected")}function He(se){if(!g||!g.basises)throw new Error("no endo");return _splitEndoScalar$2(se,g.basises,o.ORDER)}const Ve=memoized$2((se,m)=>{const{X:A,Y:k,Z:Y}=se;if(s.eql(Y,s.ONE))return{x:A,y:k};const Q=se.is0();m==null&&(m=Q?s.ONE:s.inv(Y));const $e=s.mul(A,m),ve=s.mul(k,m),re=s.mul(Y,m);if(Q)return{x:s.ZERO,y:s.ZERO};if(!s.eql(re,s.ONE))throw new Error("invZ was invalid");return{x:$e,y:ve}}),We=memoized$2(se=>{if(se.is0()){if(t.allowInfinityPoint&&!s.is0(se.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:A}=se.toAffine();if(!s.isValid(m)||!s.isValid(A))throw new Error("bad point: x or y not field elements");if(!Ce(m,A))throw new Error("bad point: equation left != right");if(!se.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function rt(se,m,A,k,Y){return A=new st(s.mul(A.X,se),A.Y,A.Z),m=negateCt$2(k,m),A=negateCt$2(Y,A),m.add(A)}class st{constructor(m,A,k){this.X=ze("x",m),this.Y=ze("y",A,!0),this.Z=ze("z",k),Object.freeze(this)}static CURVE(){return a}static fromAffine(m){const{x:A,y:k}=m||{};if(!m||!s.isValid(A)||!s.isValid(k))throw new Error("invalid affine point");if(m instanceof st)throw new Error("projective point not allowed");return s.is0(A)&&s.is0(k)?st.ZERO:new st(A,k,s.ONE)}static fromBytes(m){const A=st.fromAffine(te(_abytes2$2(m,void 0,"point")));return A.assertValidity(),A}static fromHex(m){return st.fromBytes(ensureBytes2("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,A=!0){return je.createCache(this,m),A||this.multiply(_3n4),this}assertValidity(){We(this)}hasEvenY(){const{y:m}=this.toAffine();if(!s.isOdd)throw new Error("Field doesn't support isOdd");return!s.isOdd(m)}equals(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m,re=s.eql(s.mul(A,ve),s.mul(Q,Y)),B=s.eql(s.mul(k,ve),s.mul($e,Y));return re&&B}negate(){return new st(this.X,s.neg(this.Y),this.Z)}double(){const{a:m,b:A}=a,k=s.mul(A,_3n4),{X:Y,Y:Q,Z:$e}=this;let{ZERO:ve,ZERO:re,ZERO:B}=s,oe=s.mul(Y,Y),Ue=s.mul(Q,Q),Ze=s.mul($e,$e),lt=s.mul(Y,Q);return lt=s.add(lt,lt),B=s.mul(Y,$e),B=s.add(B,B),ve=s.mul(m,B),re=s.mul(k,Ze),re=s.add(ve,re),ve=s.sub(Ue,re),re=s.add(Ue,re),re=s.mul(ve,re),ve=s.mul(lt,ve),B=s.mul(k,B),Ze=s.mul(m,Ze),lt=s.sub(oe,Ze),lt=s.mul(m,lt),lt=s.add(lt,B),B=s.add(oe,oe),oe=s.add(B,oe),oe=s.add(oe,Ze),oe=s.mul(oe,lt),re=s.add(re,oe),Ze=s.mul(Q,$e),Ze=s.add(Ze,Ze),oe=s.mul(Ze,lt),ve=s.sub(ve,oe),B=s.mul(Ze,Ue),B=s.add(B,B),B=s.add(B,B),new st(ve,re,B)}add(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m;let{ZERO:re,ZERO:B,ZERO:oe}=s;const Ue=a.a,Ze=s.mul(a.b,_3n4);let lt=s.mul(A,Q),St=s.mul(k,$e),Mt=s.mul(Y,ve),Ft=s.add(A,k),Zt=s.add(Q,$e);Ft=s.mul(Ft,Zt),Zt=s.add(lt,St),Ft=s.sub(Ft,Zt),Zt=s.add(A,Y);let Ut=s.add(Q,ve);return Zt=s.mul(Zt,Ut),Ut=s.add(lt,Mt),Zt=s.sub(Zt,Ut),Ut=s.add(k,Y),re=s.add($e,ve),Ut=s.mul(Ut,re),re=s.add(St,Mt),Ut=s.sub(Ut,re),oe=s.mul(Ue,Zt),re=s.mul(Ze,Mt),oe=s.add(re,oe),re=s.sub(St,oe),oe=s.add(St,oe),B=s.mul(re,oe),St=s.add(lt,lt),St=s.add(St,lt),Mt=s.mul(Ue,Mt),Zt=s.mul(Ze,Zt),St=s.add(St,Mt),Mt=s.sub(lt,Mt),Mt=s.mul(Ue,Mt),Zt=s.add(Zt,Mt),lt=s.mul(St,Zt),B=s.add(B,lt),lt=s.mul(Ut,Zt),re=s.mul(Ft,re),re=s.sub(re,lt),lt=s.mul(Ft,St),oe=s.mul(Ut,oe),oe=s.add(oe,lt),new st(re,B,oe)}subtract(m){return this.add(m.negate())}is0(){return this.equals(st.ZERO)}multiply(m){const{endo:A}=t;if(!o.isValidNot0(m))throw new Error("invalid scalar: out of range");let k,Y;const Q=$e=>je.cached(this,$e,ve=>normalizeZ$2(st,ve));if(A){const{k1neg:$e,k1:ve,k2neg:re,k2:B}=He(m),{p:oe,f:Ue}=Q(ve),{p:Ze,f:lt}=Q(B);Y=Ue.add(lt),k=rt(A.beta,oe,Ze,$e,re)}else{const{p:$e,f:ve}=Q(m);k=$e,Y=ve}return normalizeZ$2(st,[k,Y])[0]}multiplyUnsafe(m){const{endo:A}=t,k=this;if(!o.isValid(m))throw new Error("invalid scalar: out of range");if(m===_0n9||k.is0())return st.ZERO;if(m===_1n9)return k;if(je.hasCache(this))return this.multiply(m);if(A){const{k1neg:Y,k1:Q,k2neg:$e,k2:ve}=He(m),{p1:re,p2:B}=mulEndoUnsafe$2(st,k,Q,ve);return rt(A.beta,re,B,Y,$e)}else return je.unsafe(k,m)}multiplyAndAddUnsafe(m,A,k){const Y=this.multiplyUnsafe(A).add(m.multiplyUnsafe(k));return Y.is0()?void 0:Y}toAffine(m){return Ve(this,m)}isTorsionFree(){const{isTorsionFree:m}=t;return c===_1n9?!0:m?m(st,this):je.unsafe(this,f).is0()}clearCofactor(){const{clearCofactor:m}=t;return c===_1n9?this:m?m(st,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(m=!0){return _abool2$2(m,"isCompressed"),this.assertValidity(),X(st,this,m)}toHex(m=!0){return bytesToHex3(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return normalizeZ$2(st,m)}static msm(m,A){return pippenger$2(st,o,m,A)}static fromPrivateKey(m){return st.BASE.multiply(_normFnElement$2(o,m))}}st.BASE=new st(a.Gx,a.Gy,s.ONE),st.ZERO=new st(s.ZERO,s.ONE,s.ZERO),st.Fp=s,st.Fn=o;const ht=o.BITS,je=new wNAF2(st,t.endo?Math.ceil(ht/2):ht);return st.BASE.precompute(8),st}function pprefix$2(r){return Uint8Array.of(r?2:3)}function getWLengths$2(r,t){return{secretKey:t.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ecdh$2(r,t={}){const{Fn:n}=r,s=t.randomBytes||randomBytes5,o=Object.assign(getWLengths$2(r.Fp,n),{seed:getMinHashLength2(n.ORDER)});function a(X){try{return!!_normFnElement$2(n,X)}catch{return!1}}function c(X,te){const{publicKey:ne,publicKeyUncompressed:Ce}=o;try{const Le=X.length;return te===!0&&Le!==ne||te===!1&&Le!==Ce?!1:!!r.fromBytes(X)}catch{return!1}}function f(X=s(o.seed)){return mapHashToField2(_abytes2$2(X,o.seed,"seed"),n.ORDER)}function g(X,te=!0){return r.BASE.multiply(_normFnElement$2(n,X)).toBytes(te)}function b(X){const te=f(X);return{secretKey:te,publicKey:g(te)}}function _(X){if(typeof X=="bigint")return!1;if(X instanceof r)return!0;const{secretKey:te,publicKey:ne,publicKeyUncompressed:Ce}=o;if(n.allowedLengths||te===ne)return;const Le=ensureBytes2("key",X).length;return Le===ne||Le===Ce}function L(X,te,ne=!0){if(_(X)===!0)throw new Error("first arg must be private key");if(_(te)===!1)throw new Error("second arg must be public key");const Ce=_normFnElement$2(n,X);return r.fromHex(te).multiply(Ce).toBytes(ne)}return Object.freeze({getPublicKey:g,getSharedSecret:L,keygen:b,Point:r,utils:{isValidSecretKey:a,isValidPublicKey:c,randomSecretKey:f,isValidPrivateKey:a,randomPrivateKey:f,normPrivateKeyToScalar:X=>_normFnElement$2(n,X),precompute(X=8,te=r.BASE){return te.precompute(X,!1)}},lengths:o})}function ecdsa$2(r,t,n={}){ahash$2(t),_validateObject$2(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const s=n.randomBytes||randomBytes5,o=n.hmac||((A,...k)=>hmac3(t,A,concatBytes4(...k))),{Fp:a,Fn:c}=r,{ORDER:f,BITS:g}=c,{keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X}=ecdh$2(r,n),te={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},ne="compact";function Ce(A){const k=f>>_1n9;return A>k}function Le(A,k){if(!c.isValidNot0(k))throw new Error(`invalid signature ${A}: out of range 1..Point.Fn.ORDER`);return k}function Ge(A,k){validateSigFormat$2(k);const Y=X.signature,Q=k==="compact"?Y:k==="recovered"?Y+1:void 0;return _abytes2$2(A,Q,`${k} signature`)}class ze{constructor(k,Y,Q){this.r=Le("r",k),this.s=Le("s",Y),Q!=null&&(this.recovery=Q),Object.freeze(this)}static fromBytes(k,Y=ne){Ge(k,Y);let Q;if(Y==="der"){const{r:B,s:oe}=DER2.toSig(_abytes2$2(k));return new ze(B,oe)}Y==="recovered"&&(Q=k[0],Y="compact",k=k.subarray(1));const $e=c.BYTES,ve=k.subarray(0,$e),re=k.subarray($e,$e*2);return new ze(c.fromBytes(ve),c.fromBytes(re),Q)}static fromHex(k,Y){return this.fromBytes(hexToBytes3(k),Y)}addRecoveryBit(k){return new ze(this.r,this.s,k)}recoverPublicKey(k){const Y=a.ORDER,{r:Q,s:$e,recovery:ve}=this;if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");if(f*_2n6<Y&&ve>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=ve===2||ve===3?Q+f:Q;if(!a.isValid(B))throw new Error("recovery id 2 or 3 invalid");const oe=a.toBytes(B),Ue=r.fromBytes(concatBytes4(pprefix$2((ve&1)===0),oe)),Ze=c.inv(B),lt=He(ensureBytes2("msgHash",k)),St=c.create(-lt*Ze),Mt=c.create($e*Ze),Ft=r.BASE.multiplyUnsafe(St).add(Ue.multiplyUnsafe(Mt));if(Ft.is0())throw new Error("point at infinify");return Ft.assertValidity(),Ft}hasHighS(){return Ce(this.s)}toBytes(k=ne){if(validateSigFormat$2(k),k==="der")return hexToBytes3(DER2.hexFromSig(this));const Y=c.toBytes(this.r),Q=c.toBytes(this.s);if(k==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes4(Uint8Array.of(this.recovery),Y,Q)}return concatBytes4(Y,Q)}toHex(k){return bytesToHex3(this.toBytes(k))}assertValidity(){}static fromCompact(k){return ze.fromBytes(ensureBytes2("sig",k),"compact")}static fromDER(k){return ze.fromBytes(ensureBytes2("sig",k),"der")}normalizeS(){return this.hasHighS()?new ze(this.r,c.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex3(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex3(this.toBytes("compact"))}}const Xe=n.bits2int||function(k){if(k.length>8192)throw new Error("input is too large");const Y=bytesToNumberBE2(k),Q=k.length*8-g;return Q>0?Y>>BigInt(Q):Y},He=n.bits2int_modN||function(k){return c.create(Xe(k))},Ve=bitMask2(g);function We(A){return aInRange$2("num < 2^"+g,A,_0n9,Ve),c.toBytes(A)}function rt(A,k){return _abytes2$2(A,void 0,"message"),k?_abytes2$2(t(A),void 0,"prehashed message"):A}function st(A,k,Y){if(["recovered","canonical"].some(St=>St in Y))throw new Error("sign() legacy options not supported");const{lowS:Q,prehash:$e,extraEntropy:ve}=validateSigOpts$2(Y,te);A=rt(A,$e);const re=He(A),B=_normFnElement$2(c,k),oe=[We(B),We(re)];if(ve!=null&&ve!==!1){const St=ve===!0?s(X.secretKey):ve;oe.push(ensureBytes2("extraEntropy",St))}const Ue=concatBytes4(...oe),Ze=re;function lt(St){const Mt=Xe(St);if(!c.isValidNot0(Mt))return;const Ft=c.inv(Mt),Zt=r.BASE.multiply(Mt).toAffine(),Ut=c.create(Zt.x);if(Ut===_0n9)return;const vr=c.create(Ft*c.create(Ze+Ut*B));if(vr===_0n9)return;let zr=(Zt.x===Ut?0:2)|Number(Zt.y&_1n9),or=vr;return Q&&Ce(vr)&&(or=c.neg(vr),zr^=1),new ze(Ut,or,zr)}return{seed:Ue,k2sig:lt}}function ht(A,k,Y={}){A=ensureBytes2("message",A);const{seed:Q,k2sig:$e}=st(A,k,Y);return createHmacDrbg2(t.outputLen,c.BYTES,o)(Q,$e)}function je(A){let k;const Y=typeof A=="string"||isBytes2(A),Q=!Y&&A!==null&&typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!Y&&!Q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Q)k=new ze(A.r,A.s);else if(Y){try{k=ze.fromBytes(ensureBytes2("sig",A),"der")}catch($e){if(!($e instanceof DER2.Err))throw $e}if(!k)try{k=ze.fromBytes(ensureBytes2("sig",A),"compact")}catch{return!1}}return k||!1}function se(A,k,Y,Q={}){const{lowS:$e,prehash:ve,format:re}=validateSigOpts$2(Q,te);if(Y=ensureBytes2("publicKey",Y),k=rt(ensureBytes2("message",k),ve),"strict"in Q)throw new Error("options.strict was renamed to lowS");const B=re===void 0?je(A):ze.fromBytes(ensureBytes2("sig",A),re);if(B===!1)return!1;try{const oe=r.fromBytes(Y);if($e&&B.hasHighS())return!1;const{r:Ue,s:Ze}=B,lt=He(k),St=c.inv(Ze),Mt=c.create(lt*St),Ft=c.create(Ue*St),Zt=r.BASE.multiplyUnsafe(Mt).add(oe.multiplyUnsafe(Ft));return Zt.is0()?!1:c.create(Zt.x)===Ue}catch{return!1}}function m(A,k,Y={}){const{prehash:Q}=validateSigOpts$2(Y,te);return k=rt(k,Q),ze.fromBytes(A,"recovered").recoverPublicKey(k).toBytes()}return Object.freeze({keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X,Point:r,sign:ht,verify:se,recoverPublicKey:m,Signature:ze,hash:t})}function _weierstrass_legacy_opts_to_new$2(r){const t={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},n=r.Fp;let s=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(c=>Math.ceil(c/2)))):void 0;const o=Field2(t.n,{BITS:r.nBitLength,allowedLengths:s,modFromBytes:r.wrapPrivateKey}),a={Fp:n,Fn:o,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:t,curveOpts:a}}function _ecdsa_legacy_opts_to_new$2(r){const{CURVE:t,curveOpts:n}=_weierstrass_legacy_opts_to_new$2(r),s={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:t,curveOpts:n,hash:r.hash,ecdsaOpts:s}}function _ecdsa_new_output_to_legacy$2(r,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},r,nLength2(n.Fn.ORDER,n.Fn.BITS))})}function weierstrass2(r){const{CURVE:t,curveOpts:n,hash:s,ecdsaOpts:o}=_ecdsa_legacy_opts_to_new$2(r),a=weierstrassN$2(t,n),c=ecdsa$2(a,s,o);return _ecdsa_new_output_to_legacy$2(r,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve2(r,t){const n=s=>weierstrass2({...r,hash:s});return{...n(t),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var secp256k1_CURVE$2={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO$2={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n10=BigInt(0),_1n10=BigInt(1),_2n7=BigInt(2);function sqrtMod2(r){const t=secp256k1_CURVE$2.p,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow22(_,n,t)*_%t,q=pow22(L,n,t)*_%t,X=pow22(q,_2n7,t)*b%t,te=pow22(X,o,t)*X%t,ne=pow22(te,a,t)*te%t,Ce=pow22(ne,f,t)*ne%t,Le=pow22(Ce,g,t)*Ce%t,Ge=pow22(Le,f,t)*ne%t,ze=pow22(Ge,n,t)*_%t,Xe=pow22(ze,c,t)*te%t,He=pow22(Xe,s,t)*b%t,Ve=pow22(He,_2n7,t);if(!Fpk1$2.eql(Fpk1$2.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}var Fpk1$2=Field2(secp256k1_CURVE$2.p,{sqrt:sqrtMod2}),secp256k12=createCurve2({...secp256k1_CURVE$2,Fp:Fpk1$2,lowS:!0,endo:secp256k1_ENDO$2},sha2563),TAGGED_HASH_PREFIXES2={};function taggedHash2(r,...t){let n=TAGGED_HASH_PREFIXES2[r];if(n===void 0){const s=sha2563(utf8ToBytes6(r));n=concatBytes4(s,s),TAGGED_HASH_PREFIXES2[r]=n}return sha2563(concatBytes4(n,...t))}var pointToBytes2=r=>r.toBytes(!0).slice(1),Pointk1$2=secp256k12.Point,hasEven$2=r=>r%_2n7===_0n10;function schnorrGetExtPubKey2(r){const{Fn:t,BASE:n}=Pointk1$2,s=_normFnElement$2(t,r),o=n.multiply(s);return{scalar:hasEven$2(o.y)?s:t.neg(s),bytes:pointToBytes2(o)}}function lift_x2(r){const t=Fpk1$2;if(!t.isValidNot0(r))throw new Error("invalid x: Fail if x  p");const n=t.create(r*r),s=t.create(n*r+BigInt(7));let o=t.sqrt(s);hasEven$2(o)||(o=t.neg(o));const a=Pointk1$2.fromAffine({x:r,y:o});return a.assertValidity(),a}var num$2=bytesToNumberBE2;function challenge2(...r){return Pointk1$2.Fn.create(num$2(taggedHash2("BIP0340/challenge",...r)))}function schnorrGetPublicKey2(r){return schnorrGetExtPubKey2(r).bytes}function schnorrSign2(r,t,n=randomBytes5(32)){const{Fn:s}=Pointk1$2,o=ensureBytes2("message",r),{bytes:a,scalar:c}=schnorrGetExtPubKey2(t),f=ensureBytes2("auxRand",n,32),g=s.toBytes(c^num$2(taggedHash2("BIP0340/aux",f))),b=taggedHash2("BIP0340/nonce",g,a,o),{bytes:_,scalar:L}=schnorrGetExtPubKey2(b),q=challenge2(_,a,o),X=new Uint8Array(64);if(X.set(_,0),X.set(s.toBytes(s.create(L+q*c)),32),!schnorrVerify2(X,o,a))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify2(r,t,n){const{Fn:s,BASE:o}=Pointk1$2,a=ensureBytes2("signature",r,64),c=ensureBytes2("message",t),f=ensureBytes2("publicKey",n,32);try{const g=lift_x2(num$2(f)),b=num$2(a.subarray(0,32));if(!inRange$2(b,_1n10,secp256k1_CURVE$2.p))return!1;const _=num$2(a.subarray(32,64));if(!inRange$2(_,_1n10,secp256k1_CURVE$2.n))return!1;const L=challenge2(s.toBytes(b),pointToBytes2(g),c),q=o.multiplyUnsafe(_).add(g.multiplyUnsafe(s.neg(L))),{x:X,y:te}=q.toAffine();return!(q.is0()||!hasEven$2(te)||X!==b)}catch{return!1}}var schnorr2=(()=>{const n=(o=randomBytes5(48))=>mapHashToField2(o,secp256k1_CURVE$2.n);secp256k12.utils.randomSecretKey;function s(o){const a=n(o);return{secretKey:a,publicKey:schnorrGetPublicKey2(a)}}return{keygen:s,getPublicKey:schnorrGetPublicKey2,sign:schnorrSign2,verify:schnorrVerify2,Point:Pointk1$2,utils:{randomSecretKey:n,randomPrivateKey:n,taggedHash:taggedHash2,lift_x:lift_x2,pointToBytes:pointToBytes2,numberToBytesBE:numberToBytesBE2,bytesToNumberBE:bytesToNumberBE2,mod:mod2},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),sha2564=sha2563,import_typescript_lru_cache=__toESM(require_dist()),import_tseep3=__toESM(require_lib()),exports_nip49={};__export$2(exports_nip49,{encrypt:()=>encrypt3,decrypt:()=>decrypt3});function pbkdf2Init$2(r,t,n,s){_assert_default.hash(r);const o=checkOpts$4({dkLen:32,asyncTick:10},s),{c:a,dkLen:c,asyncTick:f}=o;if(_assert_default.number(a),_assert_default.number(c),_assert_default.number(f),a<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const g=toBytes2(t),b=toBytes2(n),_=new Uint8Array(c),L=hmac2.create(r,g),q=L._cloneInto().update(b);return{c:a,dkLen:c,asyncTick:f,DK:_,PRF:L,PRFSalt:q}}function pbkdf2Output$2(r,t,n,s,o){return r.destroy(),t.destroy(),s&&s.destroy(),o.fill(0),n}function pbkdf2$2(r,t,n,s){const{c:o,dkLen:a,DK:c,PRF:f,PRFSalt:g}=pbkdf2Init$2(r,t,n,s);let b;const _=new Uint8Array(4),L=createView2(_),q=new Uint8Array(f.outputLen);for(let X=1,te=0;te<a;X++,te+=f.outputLen){const ne=c.subarray(te,te+f.outputLen);L.setInt32(0,X,!1),(b=g._cloneInto(b)).update(_).digestInto(q),ne.set(q.subarray(0,ne.length));for(let Ce=1;Ce<o;Ce++){f._cloneInto(b).update(q).digestInto(q);for(let Le=0;Le<ne.length;Le++)ne[Le]^=q[Le]}}return pbkdf2Output$2(f,g,c,b,q)}var rotl2=(r,t)=>r<<t|r>>>32-t;function XorAndSalsa$2(r,t,n,s,o,a){let c=r[t++]^n[s++],f=r[t++]^n[s++],g=r[t++]^n[s++],b=r[t++]^n[s++],_=r[t++]^n[s++],L=r[t++]^n[s++],q=r[t++]^n[s++],X=r[t++]^n[s++],te=r[t++]^n[s++],ne=r[t++]^n[s++],Ce=r[t++]^n[s++],Le=r[t++]^n[s++],Ge=r[t++]^n[s++],ze=r[t++]^n[s++],Xe=r[t++]^n[s++],He=r[t++]^n[s++],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let oe=0;oe<8;oe+=2)ht^=rotl2(Ve+$e|0,7),A^=rotl2(ht+Ve|0,9),$e^=rotl2(A+ht|0,13),Ve^=rotl2($e+A|0,18),k^=rotl2(je+We|0,7),ve^=rotl2(k+je|0,9),We^=rotl2(ve+k|0,13),je^=rotl2(We+ve|0,18),re^=rotl2(Y+se|0,7),rt^=rotl2(re+Y|0,9),se^=rotl2(rt+re|0,13),Y^=rotl2(se+rt|0,18),st^=rotl2(B+Q|0,7),m^=rotl2(st+B|0,9),Q^=rotl2(m+st|0,13),B^=rotl2(Q+m|0,18),We^=rotl2(Ve+st|0,7),rt^=rotl2(We+Ve|0,9),st^=rotl2(rt+We|0,13),Ve^=rotl2(st+rt|0,18),se^=rotl2(je+ht|0,7),m^=rotl2(se+je|0,9),ht^=rotl2(m+se|0,13),je^=rotl2(ht+m|0,18),Q^=rotl2(Y+k|0,7),A^=rotl2(Q+Y|0,9),k^=rotl2(A+Q|0,13),Y^=rotl2(k+A|0,18),$e^=rotl2(B+re|0,7),ve^=rotl2($e+B|0,9),re^=rotl2(ve+$e|0,13),B^=rotl2(re+ve|0,18);o[a++]=c+Ve|0,o[a++]=f+We|0,o[a++]=g+rt|0,o[a++]=b+st|0,o[a++]=_+ht|0,o[a++]=L+je|0,o[a++]=q+se|0,o[a++]=X+m|0,o[a++]=te+A|0,o[a++]=ne+k|0,o[a++]=Ce+Y|0,o[a++]=Le+Q|0,o[a++]=Ge+$e|0,o[a++]=ze+ve|0,o[a++]=Xe+re|0,o[a++]=He+B|0}function BlockMix$2(r,t,n,s,o){let a=s+0,c=s+16*o;for(let f=0;f<16;f++)n[c+f]=r[t+(2*o-1)*16+f];for(let f=0;f<o;f++,a+=16,t+=16)XorAndSalsa$2(n,c,r,t,n,a),f>0&&(c+=16),XorAndSalsa$2(n,a,r,t+=16,n,c)}function scryptInit$2(r,t,n){const s=checkOpts$4({dkLen:32,asyncTick:10,maxmem:1073742848},n),{N:o,r:a,p:c,dkLen:f,asyncTick:g,maxmem:b,onProgress:_}=s;if(_assert_default.number(o),_assert_default.number(a),_assert_default.number(c),_assert_default.number(f),_assert_default.number(g),_assert_default.number(b),_!==void 0&&typeof _!="function")throw new Error("progressCb should be function");const L=128*a,q=L/4;if(o<=1||(o&o-1)!==0||o>=2**(L/8)||o>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(c<0||c>(2**32-1)*32/L)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(f<0||f>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const X=L*(o+c);if(X>b)throw new Error(`Scrypt: parameters too large, ${X} (128 * r * (N + p)) > ${b} (maxmem)`);const te=pbkdf2$2(sha2562,r,t,{c:1,dkLen:L*c}),ne=u32$4(te),Ce=u32$4(new Uint8Array(L*o)),Le=u32$4(new Uint8Array(L));let Ge=()=>{};if(_){const ze=2*o*c,Xe=Math.max(Math.floor(ze/1e4),1);let He=0;Ge=()=>{He++,_&&(!(He%Xe)||He===ze)&&_(He/ze)}}return{N:o,r:a,p:c,dkLen:f,blockSize32:q,V:Ce,B32:ne,B:te,tmp:Le,blockMixCb:Ge,asyncTick:g}}function scryptOutput$2(r,t,n,s,o){const a=pbkdf2$2(sha2562,r,n,{c:1,dkLen:t});return n.fill(0),s.fill(0),o.fill(0),a}function scrypt$2(r,t,n){const{N:s,r:o,p:a,dkLen:c,blockSize32:f,V:g,B32:b,B:_,tmp:L,blockMixCb:q}=scryptInit$2(r,t,n);for(let X=0;X<a;X++){const te=f*X;for(let ne=0;ne<f;ne++)g[ne]=b[te+ne];for(let ne=0,Ce=0;ne<s-1;ne++)BlockMix$2(g,Ce,g,Ce+=f,o),q();BlockMix$2(g,(s-1)*f,b,te,o),q();for(let ne=0;ne<s;ne++){const Ce=b[te+f-16]%s;for(let Le=0;Le<f;Le++)L[Le]=b[te+Le]^g[Ce*f+Le];BlockMix$2(L,0,b,te,o),q()}}return scryptOutput$2(r,c,_,g,L)}var Bech32MaxSize2=5e3;function encodeBech322(r,t){let n=bech32$4.toWords(t);return bech32$4.encode(r,n,Bech32MaxSize2)}function encodeBytes2(r,t){return encodeBech322(r,t)}function encrypt3(r,t,n=16,s=2){let o=randomBytes3(16),a=2**n,c=scrypt$2(t.normalize("NFKC"),o,{N:a,r:8,p:1,dkLen:32}),f=randomBytes3(24),g=Uint8Array.from([s]),_=xchacha20poly1305$2(c,f,g).encrypt(r),L=concatBytes3(Uint8Array.from([2]),Uint8Array.from([n]),o,f,g,_);return encodeBytes2("ncryptsec",L)}function decrypt3(r,t){let{prefix:n,words:s}=bech32$4.decode(r,Bech32MaxSize2);if(n!=="ncryptsec")throw new Error(`invalid prefix ${n}, expected 'ncryptsec'`);let o=new Uint8Array(bech32$4.fromWords(s)),a=o[0];if(a!==2)throw new Error(`invalid version ${a}, expected 0x02`);let f=2**o[1],g=o.slice(2,18),b=o.slice(18,42),_=o[42],L=Uint8Array.from([_]),q=o.slice(43),X=scrypt$2(t.normalize("NFKC"),g,{N:f,r:8,p:1,dkLen:32});return xchacha20poly1305$2(X,b,L).decrypt(q)}var import_tseep4=__toESM(require_lib()),import_debug4=__toESM(require_browser4()),import_debug5=__toESM(require_browser4()),import_debug6=__toESM(require_browser4()),import_debug7=__toESM(require_browser4()),import_tseep5=__toESM(require_lib()),import_tseep6=__toESM(require_lib()),import_typescript_lru_cache2=__toESM(require_dist()),import_typescript_lru_cache3=__toESM(require_dist()),import_debug8=__toESM(require_browser4()),exports_nip19={};__export$2(exports_nip19,{nsecEncode:()=>nsecEncode2,npubEncode:()=>npubEncode2,nprofileEncode:()=>nprofileEncode2,noteEncode:()=>noteEncode2,neventEncode:()=>neventEncode2,naddrEncode:()=>naddrEncode2,encodeBytes:()=>encodeBytes3,decodeNostrURI:()=>decodeNostrURI2,decode:()=>decode2,NostrTypeGuard:()=>NostrTypeGuard2,Bech32MaxSize:()=>Bech32MaxSize3,BECH32_REGEX:()=>BECH32_REGEX2});var utf8Decoder2=new TextDecoder("utf-8"),utf8Encoder2=new TextEncoder,NostrTypeGuard2={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize3=5e3,BECH32_REGEX2=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array2(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI2(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode2(r)}catch{return{type:"invalid",data:null}}}function decode2(r){let{prefix:t,words:n}=bech32$4.decode(r,Bech32MaxSize3),s=new Uint8Array(bech32$4.fromWords(n));switch(t){case"nprofile":{let o=parseTLV2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex2(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder2.decode(a)):[]}}}case"nevent":{let o=parseTLV2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex2(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder2.decode(a)):[],author:o[2]?.[0]?bytesToHex2(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex2(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder2.decode(o[0][0]),pubkey:bytesToHex2(o[2][0]),kind:parseInt(bytesToHex2(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder2.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex2(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV2(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode2(r){return encodeBytes3("nsec",r)}function npubEncode2(r){return encodeBytes3("npub",hexToBytes2(r))}function noteEncode2(r){return encodeBytes3("note",hexToBytes2(r))}function encodeBech323(r,t){let n=bech32$4.toWords(t);return bech32$4.encode(r,n,Bech32MaxSize3)}function encodeBytes3(r,t){return encodeBech323(r,t)}function nprofileEncode2(r){let t=encodeTLV2({0:[hexToBytes2(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder2.encode(n))});return encodeBech323("nprofile",t)}function neventEncode2(r){let t;r.kind!==void 0&&(t=integerToUint8Array2(r.kind));let n=encodeTLV2({0:[hexToBytes2(r.id)],1:(r.relays||[]).map(s=>utf8Encoder2.encode(s)),2:r.author?[hexToBytes2(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech323("nevent",n)}function naddrEncode2(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV2({0:[utf8Encoder2.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder2.encode(s)),2:[hexToBytes2(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech323("naddr",n)}function encodeTLV2(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes3(...t)}var import_debug9=__toESM(require_browser4()),import_debug10=__toESM(require_browser4()),import_tseep7=__toESM(require_lib()),import_tseep8=__toESM(require_lib());__toESM(require_bolt11());var import_debug11=__toESM(require_browser4());__toESM(require_lib());var import_debug12=__toESM(require_browser4()),__defProp4=Object.defineProperty,__getOwnPropDesc2=Object.getOwnPropertyDescriptor,__getOwnPropNames3=Object.getOwnPropertyNames,__hasOwnProp3=Object.prototype.hasOwnProperty,__copyProps$2=(r,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of __getOwnPropNames3(t))!__hasOwnProp3.call(r,o)&&o!==n&&__defProp4(r,o,{get:()=>t[o],enumerable:!(s=__getOwnPropDesc2(t,o))||s.enumerable});return r},__reExport$2=(r,t,n)=>(__copyProps$2(r,t,"default"),n),NDKKind$2=(r=>(r[r.Metadata=0]="Metadata",r[r.Text=1]="Text",r[r.RecommendRelay=2]="RecommendRelay",r[r.Contacts=3]="Contacts",r[r.EncryptedDirectMessage=4]="EncryptedDirectMessage",r[r.EventDeletion=5]="EventDeletion",r[r.Repost=6]="Repost",r[r.Reaction=7]="Reaction",r[r.BadgeAward=8]="BadgeAward",r[r.GroupChat=9]="GroupChat",r[r.Thread=11]="Thread",r[r.GroupReply=12]="GroupReply",r[r.GiftWrapSeal=13]="GiftWrapSeal",r[r.PrivateDirectMessage=14]="PrivateDirectMessage",r[r.Image=20]="Image",r[r.Video=21]="Video",r[r.ShortVideo=22]="ShortVideo",r[r.Story=23]="Story",r[r.Vanish=62]="Vanish",r[r.CashuWalletBackup=375]="CashuWalletBackup",r[r.GiftWrap=1059]="GiftWrap",r[r.GenericRepost=16]="GenericRepost",r[r.ChannelCreation=40]="ChannelCreation",r[r.ChannelMetadata=41]="ChannelMetadata",r[r.ChannelMessage=42]="ChannelMessage",r[r.ChannelHideMessage=43]="ChannelHideMessage",r[r.ChannelMuteUser=44]="ChannelMuteUser",r[r.WikiMergeRequest=818]="WikiMergeRequest",r[r.GenericReply=1111]="GenericReply",r[r.Media=1063]="Media",r[r.DraftCheckpoint=1234]="DraftCheckpoint",r[r.Task=1934]="Task",r[r.Report=1984]="Report",r[r.Label=1985]="Label",r[r.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",r[r.DVMReqTextSummarization=5001]="DVMReqTextSummarization",r[r.DVMReqTextTranslation=5002]="DVMReqTextTranslation",r[r.DVMReqTextGeneration=5050]="DVMReqTextGeneration",r[r.DVMReqImageGeneration=5100]="DVMReqImageGeneration",r[r.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",r[r.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",r[r.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",r[r.DVMReqTimestamping=5900]="DVMReqTimestamping",r[r.DVMEventSchedule=5905]="DVMEventSchedule",r[r.DVMJobFeedback=7e3]="DVMJobFeedback",r[r.Subscribe=7001]="Subscribe",r[r.Unsubscribe=7002]="Unsubscribe",r[r.SubscriptionReceipt=7003]="SubscriptionReceipt",r[r.CashuReserve=7373]="CashuReserve",r[r.CashuQuote=7374]="CashuQuote",r[r.CashuToken=7375]="CashuToken",r[r.CashuWalletTx=7376]="CashuWalletTx",r[r.GroupAdminAddUser=9e3]="GroupAdminAddUser",r[r.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",r[r.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",r[r.GroupAdminEditStatus=9006]="GroupAdminEditStatus",r[r.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",r[r.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",r[r.MuteList=1e4]="MuteList",r[r.PinList=10001]="PinList",r[r.RelayList=10002]="RelayList",r[r.BookmarkList=10003]="BookmarkList",r[r.CommunityList=10004]="CommunityList",r[r.PublicChatList=10005]="PublicChatList",r[r.BlockRelayList=10006]="BlockRelayList",r[r.SearchRelayList=10007]="SearchRelayList",r[r.SimpleGroupList=10009]="SimpleGroupList",r[r.InterestList=10015]="InterestList",r[r.CashuMintList=10019]="CashuMintList",r[r.EmojiList=10030]="EmojiList",r[r.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",r[r.BlossomList=10063]="BlossomList",r[r.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",r[r.TierList=17e3]="TierList",r[r.CashuWallet=17375]="CashuWallet",r[r.FollowSet=3e4]="FollowSet",r[r.CategorizedPeopleList=3e4]="CategorizedPeopleList",r[r.CategorizedBookmarkList=30001]="CategorizedBookmarkList",r[r.RelaySet=30002]="RelaySet",r[r.CategorizedRelayList=30002]="CategorizedRelayList",r[r.BookmarkSet=30003]="BookmarkSet",r[r.CurationSet=30004]="CurationSet",r[r.ArticleCurationSet=30004]="ArticleCurationSet",r[r.VideoCurationSet=30005]="VideoCurationSet",r[r.ImageCurationSet=30006]="ImageCurationSet",r[r.InterestSet=30015]="InterestSet",r[r.InterestsList=30015]="InterestsList",r[r.ProjectTemplate=30717]="ProjectTemplate",r[r.EmojiSet=30030]="EmojiSet",r[r.ModularArticle=30040]="ModularArticle",r[r.ModularArticleItem=30041]="ModularArticleItem",r[r.Wiki=30818]="Wiki",r[r.Draft=31234]="Draft",r[r.Project=31933]="Project",r[r.SubscriptionTier=37001]="SubscriptionTier",r[r.EcashMintRecommendation=38e3]="EcashMintRecommendation",r[r.CashuMintAnnouncement=38172]="CashuMintAnnouncement",r[r.FedimintMintAnnouncement=38173]="FedimintMintAnnouncement",r[r.HighlightSet=39802]="HighlightSet",r[r.CategorizedHighlightList=39802]="CategorizedHighlightList",r[r.Nutzap=9321]="Nutzap",r[r.ZapRequest=9734]="ZapRequest",r[r.Zap=9735]="Zap",r[r.Highlight=9802]="Highlight",r[r.ClientAuth=22242]="ClientAuth",r[r.NostrWalletConnectReq=23194]="NostrWalletConnectReq",r[r.NostrWalletConnectRes=23195]="NostrWalletConnectRes",r[r.NostrConnect=24133]="NostrConnect",r[r.BlossomUpload=24242]="BlossomUpload",r[r.HttpAuth=27235]="HttpAuth",r[r.ProfileBadge=30008]="ProfileBadge",r[r.BadgeDefinition=30009]="BadgeDefinition",r[r.MarketStall=30017]="MarketStall",r[r.MarketProduct=30018]="MarketProduct",r[r.Article=30023]="Article",r[r.AppSpecificData=30078]="AppSpecificData",r[r.Classified=30402]="Classified",r[r.HorizontalVideo=34235]="HorizontalVideo",r[r.VerticalVideo=34236]="VerticalVideo",r[r.GroupMetadata=39e3]="GroupMetadata",r[r.GroupAdmins=39001]="GroupAdmins",r[r.GroupMembers=39002]="GroupMembers",r[r.FollowPack=39089]="FollowPack",r[r.MediaFollowPack=39092]="MediaFollowPack",r[r.AppRecommendation=31989]="AppRecommendation",r[r.AppHandler=31990]="AppHandler",r))(NDKKind$2||{});function getRelaysForSync$2(r,t,n="write"){if(!r.outboxTracker)return;const s=r.outboxTracker.data.get(t);if(s)return n==="write"?s.writeRelays:s.readRelays}async function getWriteRelaysFor$2(r,t,n="write"){if(r.outboxTracker)return r.outboxTracker.data.has(t)||await r.outboxTracker.trackUsers([t]),getRelaysForSync$2(r,t,n)}function getTopRelaysForAuthors$2(r,t){const n=new Map;return t.forEach(o=>{const a=getRelaysForSync$2(r,o);a&&a.forEach(c=>{const f=n.get(c)||0;n.set(c,f+1)})}),Array.from(n.entries()).sort((o,a)=>a[1]-o[1]).map(o=>o[0])}function getAllRelaysForAllPubkeys$2(r,t,n="read"){const s=new Map,o=new Set;return t.forEach(a=>{const c=getRelaysForSync$2(r,a,n);c&&c.size>0?(c.forEach(f=>{(s.get(f)||new Set).add(a)}),s.set(a,c)):o.add(a)}),{pubkeysToRelays:s,authorsMissingRelays:o}}function chooseRelayCombinationForPubkeys$2(r,t,n,{count:s,preferredRelays:o}={}){s??=2,o??=new Set;const a=r.pool,c=a.connectedRelays();c.forEach(q=>{o?.add(q.url)});const f=new Map,{pubkeysToRelays:g,authorsMissingRelays:b}=getAllRelaysForAllPubkeys$2(r,t,n),_=getTopRelaysForAuthors$2(r,t),L=(q,X)=>{const te=f.get(X)||[];te.push(q),f.set(X,te)};for(const[q,X]of g.entries()){let te=s;const ne=new Set;for(const Ce of c)X.has(Ce.url)&&(L(q,Ce.url),ne.add(Ce.url),te--);for(const Ce of X)ne.has(Ce)||f.has(Ce)&&(L(q,Ce),ne.add(Ce),te--);if(!(te<=0))for(const Ce of _){if(te<=0)break;ne.has(Ce)||X.has(Ce)&&(L(q,Ce),ne.add(Ce),te--)}}for(const q of b)a.permanentAndConnectedRelays().forEach(X=>{const te=f.get(X.url)||[];te.push(q),f.set(X.url,te)});return f}function getRelaysForFilterWithAuthors$1(r,t,n=2){return chooseRelayCombinationForPubkeys$2(r,t,"write",{count:n})}function tryNormalizeRelayUrl$2(r){try{return normalizeRelayUrl$2(r)}catch{return}}function normalizeRelayUrl$2(r){let t=normalizeUrl$2(r,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function normalize3(r){const t=new Set;for(const n of r)try{t.add(normalizeRelayUrl$2(n))}catch{}return Array.from(t)}var DATA_URL_DEFAULT_MIME_TYPE$2="text/plain",DATA_URL_DEFAULT_CHARSET$2="us-ascii",testParameter$2=(r,t)=>t.some(n=>n instanceof RegExp?n.test(r):n===r),supportedProtocols$2=new Set(["https:","http:","file:"]),hasCustomProtocol$2=r=>{try{const{protocol:t}=new URL(r);return t.endsWith(":")&&!t.includes(".")&&!supportedProtocols$2.has(t)}catch{return!1}},normalizeDataURL$2=(r,{stripHash:t})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(r);if(!n)throw new Error(`Invalid URL: ${r}`);const s=n.groups?.type??"",o=n.groups?.data??"";let a=n.groups?.hash??"";const c=s.split(";");a=t?"":a;let f=!1;c[c.length-1]==="base64"&&(c.pop(),f=!0);const g=c.shift()?.toLowerCase()??"",_=[...c.map(L=>{let[q,X=""]=L.split("=").map(te=>te.trim());return q==="charset"&&(X=X.toLowerCase(),X===DATA_URL_DEFAULT_CHARSET$2)?"":`${q}${X?`=${X}`:""}`}).filter(Boolean)];return f&&_.push("base64"),(_.length>0||g&&g!==DATA_URL_DEFAULT_MIME_TYPE$2)&&_.unshift(g),`data:${_.join(";")},${f?o.trim():o}${a?`#${a}`:""}`};function normalizeUrl$2(r,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),r=r.trim(),/^data:/i.test(r))return normalizeDataURL$2(r,t);if(hasCustomProtocol$2(r))return r;const n=r.startsWith("//");!n&&/^\.*\//.test(r)||(r=r.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const o=new URL(r);if(o.hostname=o.hostname.toLowerCase(),t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&o.protocol==="https:"&&(o.protocol="http:"),t.forceHttps&&o.protocol==="http:"&&(o.protocol="https:"),t.stripAuthentication&&(o.username="",o.password=""),t.stripHash?o.hash="":t.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname){const c=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let f=0,g="";for(;;){const _=c.exec(o.pathname);if(!_)break;const L=_[0],q=_.index,X=o.pathname.slice(f,q);g+=X.replace(/\/{2,}/g,"/"),g+=L,f=q+L.length}const b=o.pathname.slice(f,o.pathname.length);g+=b.replace(/\/{2,}/g,"/"),o.pathname=g}if(o.pathname)try{o.pathname=decodeURI(o.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let c=o.pathname.split("/");const f=c[c.length-1];testParameter$2(f,t.removeDirectoryIndex)&&(c=c.slice(0,-1),o.pathname=`${c.slice(1).join("/")}/`)}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const c of[...o.searchParams.keys()])testParameter$2(c,t.removeQueryParameters)&&o.searchParams.delete(c);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(o.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const c of[...o.searchParams.keys()])testParameter$2(c,t.keepQueryParameters)||o.searchParams.delete(c);if(t.sortQueryParameters){o.searchParams.sort();try{o.search=decodeURIComponent(o.search)}catch{}}t.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,"")),t.removeExplicitPort&&o.port&&(o.port="");const a=r;return r=o.toString(),!t.removeSingleSlash&&o.pathname==="/"&&!a.endsWith("/")&&o.hash===""&&(r=r.replace(/\/$/,"")),(t.removeTrailingSlash||o.pathname==="/")&&o.hash===""&&t.removeSingleSlash&&(r=r.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(r=r.replace(/^http:\/\//,"//")),t.stripProtocol&&(r=r.replace(/^(?:https?:)?\/\//,"")),r}var NDKRelayKeepalive$2=class{constructor(t=3e4,n){this.onSilenceDetected=n,this.timeout=t}lastActivity=Date.now();timer;timeout;isRunning=!1;recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const t=Date.now()-this.lastActivity;if(t>=this.timeout)this.onSilenceDetected();else{const n=this.timeout-t;this.timer=setTimeout(()=>{this.onSilenceDetected()},n)}},this.timeout)}};async function probeRelayConnection$2(r){const t=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(n=>{let s=!1;const o=setTimeout(()=>{s||(s=!0,r.send(["CLOSE",t]),n(!1))},5e3),a=()=>{s||(s=!0,clearTimeout(o),r.send(["CLOSE",t]),n(!0))};r.once("message",a),r.send(["REQ",t,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS$2=5,FLAPPING_THRESHOLD_MS$2=1e3,NDKRelayConnectivity$2=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;pendingAuthPublishes=new Map;serial=0;baseEoseTimeout=4400;keepalive;wsStateMonitor;sleepDetector;lastSleepCheck=Date.now();lastMessageSent=Date.now();wasIdle=!1;constructor(t,n){this.ndkRelay=t,this._status=1;const s=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${s}`),this.ndk=n,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive$2(12e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection$2({send:n=>this.send(JSON.stringify(n)),once:(n,s)=>{const o=a=>{try{const c=JSON.parse(a.data);(c[0]==="EOSE"||c[0]==="EVENT"||c[0]==="NOTICE")&&(s(),this.ws?.removeEventListener("message",o))}catch{}};this.ws?.addEventListener("message",o)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const t=Date.now(),n=t-this.lastSleepCheck;n>15e3&&(this.debug(`Detected possible sleep/wake (${n}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=t},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection$2({send:t=>this.send(JSON.stringify(t)),once:(t,n)=>{const s=o=>{try{const a=JSON.parse(o.data);(a[0]==="EOSE"||a[0]==="EVENT"||a[0]==="NOTICE")&&(n(),this.ws?.removeEventListener("message",s))}catch{}};this.ws?.addEventListener("message",s)}}).then(t=>{t||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(t,n=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(n),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(s){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,s),this._status=1,n?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2880*60*1e3),s}}disconnect(){this._status=0,this.keepalive?.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.keepalive?.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this.keepalive?.stop(),this.clearPendingPublishes(new Error(`Relay ${this.ndkRelay.url} disconnected`)),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(t){this.netDebug?.(t.data,this.ndkRelay,"recv"),this.keepalive?.recordActivity();try{const n=JSON.parse(t.data),[s,o,...a]=n,c=this.ndkRelay.getProtocolHandler(s);if(c){c(this.ndkRelay,n);return}switch(s){case"EVENT":{const f=this.openSubs.get(o),g=n[2];if(!f){this.debug(`Received event for unknown subscription ${o}`);return}f.onevent(g);return}case"COUNT":{const f=n[2],g=this.openCountRequests.get(o);g&&(g.resolve(f.count),this.openCountRequests.delete(o));return}case"EOSE":{const f=this.openSubs.get(o);if(!f)return;f.oneose(o);return}case"OK":{const f=n[2],g=n[3],b=this.openEventPublishes.get(o),_=b?.pop();if(!b||!_){this.debug("Received OK for unknown event publish",o);return}f?(_.resolve(g),this.pendingAuthPublishes.delete(o)):g&&(g.toLowerCase().includes("auth-required")||g.toLowerCase().includes("not authorized")||g.toLowerCase().includes("blocked: not authorized"))?this.pendingAuthPublishes.get(o)?(this.debug("Publish failed due to auth-required, will retry after auth",o),b.push(_),this.openEventPublishes.set(o,b)):_.reject(new Error(g)):(_.reject(new Error(g)),this.pendingAuthPublishes.delete(o)),b.length===0?this.openEventPublishes.delete(o):!f&&!(g?.toLowerCase().includes("auth-required")||g?.toLowerCase().includes("not authorized")||g?.toLowerCase().includes("blocked: not authorized"))&&this.openEventPublishes.set(o,b);return}case"CLOSED":{const f=this.openSubs.get(o);if(!f)return;f.onclosed(n[2]);return}case"NOTICE":this.onNotice(n[1]);return;case"AUTH":{this.onAuthRequested(n[1]);return}}}catch(n){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${n.message}`,n?.stack);return}}async onAuthRequested(t){const n=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!n}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,n){if(this._status>=5){this._status=7;let s;try{s=await n(this.ndkRelay,t)}catch(o){this.debug("Authentication policy threw an error",o),s=!1}if(this.debug("Authentication policy returned",!!s),s instanceof NDKEvent$2||s===!0){s instanceof NDKEvent$2&&await this.auth(s);const o=async()=>{if(this._status>=5&&this._status<8){const a=new NDKEvent$2(this.ndk);a.kind=22242,a.tags=[["relay",this.ndkRelay.url],["challenge",t]],await a.sign(),this.auth(a).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful"),this.retryPendingAuthPublishes()}).catch(c=>{this._status=6,this.ndkRelay.emit("auth:failed",c),this.debug("Authentication failed",c),this.rejectPendingAuthPublishes(c)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};s===!0&&(this.ndk?.signer?o().catch(a=>{console.error("Error authenticating",a)}):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",o))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t)}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!==0)return!1;const s=t.reduce((f,g)=>f+g,0)/t.length,o=t.map(f=>(f-s)**2).reduce((f,g)=>f+g,0)/t.length;return Math.sqrt(o)<FLAPPING_THRESHOLD_MS$2}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let n;if(this.wasIdle){const s=[0,1e3,2e3,5e3,1e4,3e4];n=s[Math.min(t,s.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${t}, delay ${n}ms`)}else this.connectedAt?n=Math.max(0,6e4-(Date.now()-this.connectedAt)):(n=Math.min(1e3*2**t,3e4),this.debug(`Using standard backoff, attempt ${t}, delay ${n}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(s=>{t<MAX_RECONNECT_ATTEMPTS$2?this.handleReconnection(t+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},n),this.ndkRelay.emit("delayed-connect",n),this.debug("Reconnecting in",n),this._connectionStats.nextReconnectAt=Date.now()+n}async send(t){Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(t),this.netDebug?.(t,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status),this._status>=5&&this.ws?.readyState!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${this.ws?.readyState}`),this.handleStaleConnection()))}async auth(t){const n=new Promise((s,o)=>{const a=this.openEventPublishes.get(t.id)??[];a.push({resolve:s,reject:o}),this.openEventPublishes.set(t.id,a)});return this.send(`["AUTH",${JSON.stringify(t.rawEvent())}]`),n}clearPendingPublishes(t){this.rejectPendingAuthPublishes(t);for(const[n,s]of this.openEventPublishes.entries()){for(;s.length>0;){const o=s.shift();o&&o.reject(t)}this.openEventPublishes.delete(n)}}retryPendingAuthPublishes(){if(this.pendingAuthPublishes.size!==0){this.debug(`Retrying ${this.pendingAuthPublishes.size} pending publishes after auth`);for(const[t,n]of this.pendingAuthPublishes.entries())this.debug(`Retrying publish for event ${t}`),this.send(`["EVENT",${JSON.stringify(n)}]`);this.pendingAuthPublishes.clear()}}rejectPendingAuthPublishes(t){if(this.pendingAuthPublishes.size!==0){this.debug(`Rejecting ${this.pendingAuthPublishes.size} pending publishes due to auth failure`);for(const[n]of this.pendingAuthPublishes.entries()){const s=this.openEventPublishes.get(n);if(s&&s.length>0){const o=s.pop();o&&o.reject(new Error(`Authentication failed: ${t.message}`)),s.length===0&&this.openEventPublishes.delete(n)}}this.pendingAuthPublishes.clear()}}async publish(t){const n=new Promise((s,o)=>{const a=this.openEventPublishes.get(t.id)??[];a.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${t.id} twice`),a.push({resolve:s,reject:o}),this.openEventPublishes.set(t.id,a)});return this.pendingAuthPublishes.set(t.id,t),this.send(`["EVENT",${JSON.stringify(t)}]`),n}async count(t,n){this.serial++;const s=n?.id||`count:${this.serial}`,o=new Promise((a,c)=>{this.openCountRequests.set(s,{resolve:a,reject:c})});return this.send(`["COUNT","${s}",${JSON.stringify(t).substring(1)}`),o}close(t,n){this.send(`["CLOSE","${t}"]`);const s=this.openSubs.get(t);this.openSubs.delete(t),s&&s.onclose(n)}req(t){`${this.send(`["REQ","${t.subId}",${JSON.stringify(t.executeFilters).substring(1)}`)}`,this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}};async function fetchRelayInformation2(r){const t=r.replace(/^wss:\/\//,"https://").replace(/^ws:\/\//,"http://"),n=await fetch(t,{headers:{Accept:"application/nostr+json"}});if(!n.ok)throw new Error(`Failed to fetch relay information: ${n.status} ${n.statusText}`);return await n.json()}var NDKRelayPublisher$2=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,n=2500){let s;const o=()=>new Promise((L,q)=>{try{this.publishEvent(t).then(X=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),L(!0)}).catch(q)}catch(X){q(X)}}),a=new Promise((L,q)=>{s=setTimeout(()=>{s=void 0,q(new Error(`Timeout: ${n}ms`))},n)}),c=()=>{o().then(L=>f(L)).catch(L=>g(L))};let f,g;const b=L=>{throw this.ndkRelay.debug("Publish failed",L,t.id),this.ndkRelay.emit("publish:failed",t,L),t.emit("relay:publish:failed",this.ndkRelay,L),L},_=()=>{s&&clearTimeout(s),this.ndkRelay.removeListener("connect",c)};return this.ndkRelay.status>=5?Promise.race([o(),a]).catch(b).finally(_):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((L,q)=>{f=L,g=q,this.ndkRelay.on("connect",c)}),a]).catch(b).finally(_))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function filterFingerprint$2(r,t){const n=[];for(const o of r){const a=Object.entries(o||{}).map(([c,f])=>["since","until"].includes(c)?`${c}:${f}`:c).sort().join("-");n.push(a)}let s=t?"+":"";return s+=n.join("|"),s}function mergeFilters$2(r){const t=[],n={};return r.filter(s=>!!s.limit).forEach(s=>t.push(s)),r=r.filter(s=>!s.limit),r.length===0?t:(r.forEach(s=>{Object.entries(s).forEach(([o,a])=>{Array.isArray(a)?n[o]===void 0?n[o]=[...a]:n[o]=Array.from(new Set([...n[o],...a])):n[o]=a})}),[...t,n])}var MAX_ITEMS$2=3;function formatArray2(r,t){const s=(t?r.slice(0,MAX_ITEMS$2).map(t):r.slice(0,MAX_ITEMS$2)).join(",");return r.length>MAX_ITEMS$2?`${s}+${r.length-MAX_ITEMS$2}`:s}function formatFilters$2(r){return r.map(t=>{const n=[];t.ids?.length&&n.push(`ids:[${formatArray2(t.ids,s=>String(s).slice(0,8))}]`),t.kinds?.length&&n.push(`kinds:[${formatArray2(t.kinds)}]`),t.authors?.length&&n.push(`authors:[${formatArray2(t.authors,s=>String(s).slice(0,8))}]`),t.since&&n.push(`since:${t.since}`),t.until&&n.push(`until:${t.until}`),t.limit&&n.push(`limit:${t.limit}`),t.search&&n.push(`search:"${String(t.search).slice(0,20)}"`);for(const[s,o]of Object.entries(t))s.startsWith("#")&&Array.isArray(o)&&o.length>0&&n.push(`${s}:[${formatArray2(o,a=>String(a).slice(0,8))}]`);return`{${n.join(" ")}}`}).join(", ")}var NDKRelaySubscription$2=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(t,n,s){this.relay=t,this.topSubManager=s,this.debug=t.debug.extend(`sub[${this.id}]`),this.fingerprint=n||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,n){if(this.debug("Adding item",{filters:formatFilters$2(n),internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,itemsSize:this.items.size}),!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:n}),this.status!==3&&t.subId&&(!this._subId||this._subId.length<25)&&(this.status===0||this.status===1)&&this.addSubIdPart(t.subId),this.status){case 0:this.evaluateExecutionPlan(t);break;case 3:break;case 1:this.evaluateExecutionPlan(t);break;case 4:throw this.debug("Subscription is closed, cannot add new items",{filters:formatFilters$2(n),subId:t.subId,internalId:t.internalId}),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const t=this.status;if(this.status=4,t===3)try{this.relay.close(this.subId)}catch(n){this.debug("Error closing subscription",n,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable()){this.status=1,this.execute();return}if(t.filters.find(o=>!!o.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const n=t.groupableDelay,s=t.groupableDelayType;if(!n)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(n,s);else{const o=this.delayType,a=this.fireTime-Date.now();if(o==="at-least"&&s==="at-least")a<n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-least"&&s==="at-most")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-most"&&s==="at-most")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-most"&&s==="at-least")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else throw new Error(`Unknown delay type combination ${o} ${s}`)}}schedule(t,n){this.status=1;const s=Date.now();this.fireTime=s+t,this.delayType=n;const o=setTimeout(this.execute.bind(this),t);n==="at-least"&&(this.executionTimer=o)}executeOnRelayReady=()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size,filters:formatFilters$2(this.compileFilters())}),this.status=1,this.execute()}};finalizeSubId(){if(this.subIdParts.size>0){let n=Array.from(this.subIdParts).map(s=>s.substring(0,10)).join("-");n.length>20&&(n=n.substring(0,20)),this._subId=n}else this._subId=this.fingerprint.slice(0,15);this._subId+=`-${Math.random().toString(36).substring(2,7)}`}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",t,this.subId)}).bind(this);execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubManager.dispatchEvent(t,this.relay)}oneose(t){if(this.eosed=!0,t!==this.subId){this.debug("Received EOSE for an abandoned subscription",t,this.subId),this.relay.close(t);return}this.items.size===0&&this.close();for(const{subscription:n}of this.items.values())n.eoseReceived(this.relay),n.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:formatFilters$2(n.filters),internalId:n.internalId,status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.removeItem(n))}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:n}of this.items.values())n.closedReceived(this.relay,t)}compileFilters(){const t=[],n=Array.from(this.items.values()).map(o=>o.filters);if(!n[0])return this.debug(" No filters to merge",{itemsSize:this.items.size}),[];const s=n[0].length;for(let o=0;o<s;o++){const a=n.map(f=>f[o]),c=mergeFilters$2(a);t.push(...c)}return t}},NDKRelaySubscriptionManager$2=class{relay;subscriptions;generalSubManager;constructor(t,n){this.relay=t,this.subscriptions=new Map,this.generalSubManager=n}addSubscription(t,n){let s;if(!t.isGroupable())s=this.createSubscription(t,n);else{const o=filterFingerprint$2(n,t.closeOnEose);o&&(s=(this.subscriptions.get(o)||[]).find(c=>c.status<3)),s??=this.createSubscription(t,n,o)}s.addItem(t,n)}createSubscription(t,n,s){const o=new NDKRelaySubscription$2(this.relay,s||null,this.generalSubManager);o.onClose=this.onRelaySubscriptionClose.bind(this);const a=this.subscriptions.get(o.fingerprint)??[];return this.subscriptions.set(o.fingerprint,[...a,o]),o}onRelaySubscriptionClose(t){let n=this.subscriptions.get(t.fingerprint)??[];n?n.length===1?this.subscriptions.delete(t.fingerprint):(n=n.filter(s=>s.id!==t.id),this.subscriptions.set(t.fingerprint,n)):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},NDKRelay$2=class Xi extends import_tseep2.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;protocolHandlers=new Map;_relayInfo;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,n,s)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let o=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const a=n/100;o=Math.max(t.lowestValidationRatio,t.validationRatio-a)}return o<t.validationRatio?o:t.validationRatio};constructor(t,n,s){super(),this.url=normalizeRelayUrl$2(t),this.scores=new Map,this.debug=import_debug2.default(`ndk:relay:${t}`),this.connectivity=new NDKRelayConnectivity$2(this,s),this.connectivity.netDebug=s?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager$2(this,s.subManager),this.publisher=new NDKRelayPublisher$2(this),this.authPolicy=n,this.targetValidationRatio=s?.initialValidationRatio,this.lowestValidationRatio=s?.lowestValidationRatio,this.validationRatioFn=(s?.validationRatioFn??Xi.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const t=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=t}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,n=!0){return this.connectivity.connect(t,n)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,n){this.subs.addSubscription(t,n)}async publish(t,n=2500){return this.publisher.publish(t,n)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}req;close;registerProtocolHandler(t,n){this.protocolHandlers.set(t,n)}unregisterProtocolHandler(t){this.protocolHandlers.delete(t)}getProtocolHandler(t){return this.protocolHandlers.get(t)}async fetchInfo(t=!1){const s=this.connectivity.ndk;if(!t&&s?.cacheAdapter?.getRelayStatus){const o=await s.cacheAdapter.getRelayStatus(this.url);if(o?.nip11&&Date.now()-o.nip11.fetchedAt<864e5)return this._relayInfo=o.nip11.data,o.nip11.data}return!t&&this._relayInfo?this._relayInfo:(this._relayInfo=await fetchRelayInformation2(this.url),s?.cacheAdapter?.updateRelayStatus&&await s.cacheAdapter.updateRelayStatus(this.url,{nip11:{data:this._relayInfo,fetchedAt:Date.now()}}),this._relayInfo)}get info(){return this._relayInfo}},NDKPublishError$2=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,n,s,o){super(t),this.errors=n,this.publishedToRelays=s,this.intendedRelaySet=o}get relayErrors(){const t=[];for(const[n,s]of this.errors)t.push(`${n.url}: ${s}`);return t.join(`
`)}},NDKRelaySet$2=class Qi{relays;debug;ndk;pool;constructor(t,n,s){this.relays=t,this.ndk=n,this.pool=s??n.pool,this.debug=n.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,n,s=!0,o){if(o=o??n.pool,!o)throw new Error("No pool provided");const a=new Set;for(const c of t){const f=o.relays.get(normalizeRelayUrl$2(c));if(f)f.status<5&&s&&f.connect(),a.add(f);else{const g=new NDKRelay$2(normalizeRelayUrl$2(c),n?.relayAuthDefaultPolicy,n);o.useTemporaryRelay(g,void 0,`requested from fromRelayUrls ${t}`),a.add(g)}}return new Qi(new Set(a),n,o)}async publish(t,n,s=1){const o=new Set,a=new Map,c=t.isEphemeral();t.publishStatus="pending";const f=g=>{o.add(g)};t.on("relay:published",f);try{const g=Array.from(this.relays).map(b=>new Promise(_=>{const L=n?setTimeout(()=>{o.has(b)||(a.set(b,new Error(`Publish timeout after ${n}ms`)),_(!1))},n):null;b.publish(t,n).then(q=>{L&&clearTimeout(L),q?(o.add(b),_(!0)):_(!1)}).catch(q=>{L&&clearTimeout(L),c||a.set(b,q),_(!1)})}));if(await Promise.all(g),o.size<s){if(!c){const b=new NDKPublishError$2("Not enough relays received the event ("+o.size+" published, "+s+" required)",a,o,this);throw t.publishStatus="error",t.publishError=b,this.ndk?.emit("event:publish-failed",t,b,this.relayUrls),b}}else t.publishStatus="success",t.emit("published",{relaySet:this,publishedToRelays:o});return o}finally{t.off("relay:published",f)}}get size(){return this.relays.size}},d$6=import_debug.default("ndk:outbox:calculate");async function calculateRelaySetFromEvent$2(r,t,n){const s=new Set,o=await getWriteRelaysFor$2(r,t.pubkey);o&&o.forEach(f=>{const g=r.pool?.getRelay(f);g&&s.add(g)});let a=t.tags.filter(f=>["a","e"].includes(f[0])).map(f=>f[2]).filter(f=>f?.startsWith("wss://")).filter(f=>{try{return new URL(f),!0}catch{return!1}}).map(f=>normalizeRelayUrl$2(f));a=Array.from(new Set(a)).slice(0,5),a.forEach(f=>{const g=r.pool?.getRelay(f,!0,!0);g&&(d$6("Adding relay hint %s",f),s.add(g))});const c=t.getMatchingTags("p").map(f=>f[1]);return c.length<5?Array.from(chooseRelayCombinationForPubkeys$2(r,c,"read",{preferredRelays:new Set(o)}).keys()).forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d$6("Adding p-tagged relay %s",g),s.add(b))}):d$6("Too many p-tags to consider %d",c.length),r.pool?.permanentAndConnectedRelays().forEach(f=>s.add(f)),n&&s.size<n&&r.explicitRelayUrls?.filter(g=>!Array.from(s).some(b=>b.url===g)).slice(0,n-s.size)?.forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d$6("Adding explicit relay %s",g),s.add(b))}),new NDKRelaySet$2(s,r)}function calculateRelaySetsFromFilter$1(r,t,n,s){const o=new Map,a=new Set;if(t.forEach(c=>{c.authors&&c.authors.forEach(f=>a.add(f))}),a.size>0){const c=getRelaysForFilterWithAuthors$1(r,Array.from(a),s);for(const f of c.keys())o.set(f,[]);for(const f of t)if(f.authors)for(const[g,b]of c.entries()){const _=f.authors.filter(L=>b.includes(L));o.set(g,[...o.get(g),{...f,authors:_}])}else for(const g of c.keys())o.set(g,[...o.get(g),f])}else r.explicitRelayUrls&&r.explicitRelayUrls.forEach(c=>{o.set(c,t)});return o.size===0&&n.permanentAndConnectedRelays().slice(0,5).forEach(c=>{o.set(c.url,t)}),o}function calculateRelaySetsFromFilters$1(r,t,n,s){return calculateRelaySetsFromFilter$1(r,t,n,s)}function isValidHex64$2(r){if(typeof r!="string"||r.length!==64)return!1;for(let t=0;t<64;t++){const n=r.charCodeAt(t);if(!(n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70))return!1}return!0}function isValidPubkey$2(r){return isValidHex64$2(r)}function isValidNip05$1(r){if(typeof r!="string")return!1;for(let t=0;t<r.length;t++)if(r.charCodeAt(t)===46)return!0;return!1}function mergeTags$2(r,t){const n=new Map,s=c=>c.join(","),o=(c,f)=>c.every((g,b)=>g===f[b]),a=c=>{for(const[f,g]of n)if(o(g,c)||o(c,g)){c.length>=g.length&&n.set(f,c);return}n.set(s(c),c)};return r.concat(t).forEach(a),Array.from(n.values())}var hashtagRegex$2=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags$2(r){const t=r.match(hashtagRegex$2),n=new Set,s=new Set;if(t)for(const o of t)n.has(o.slice(1))||(s.add(o.slice(1)),n.add(o.slice(1)));return Array.from(s)}async function generateContentTags$2(r,t=[],n,s){if(n?.skipContentTagging)return{content:r,tags:t};const o=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,a=[],c=f=>{t.find(g=>["q",f[0]].includes(g[0])&&g[1]===f[1])||t.push(f)};if(r=r.replace(o,f=>{try{const g=f.split(/(@|nostr:)/)[2],{type:b,data:_}=nip19_exports$4.decode(g);let L;if(n?.filters){const q=!n.filters.includeTypes||n.filters.includeTypes.includes(b),X=n.filters.excludeTypes?.includes(b);if(!q||X)return f}switch(b){case"npub":n?.pTags!==!1&&(L=["p",_]);break;case"nprofile":n?.pTags!==!1&&(L=["p",_.pubkey]);break;case"note":a.push(new Promise(async q=>{const X=await maybeGetEventRelayUrl$2(g);c(["q",_,X]),q()}));break;case"nevent":a.push(new Promise(async q=>{const{id:X,author:te}=_;let{relays:ne}=_;(!ne||ne.length===0)&&(ne=[await maybeGetEventRelayUrl$2(g)]),c(["q",X,ne[0]]),te&&n?.pTags!==!1&&n?.pTagOnQTags!==!1&&c(["p",te]),q()}));break;case"naddr":a.push(new Promise(async q=>{const X=[_.kind,_.pubkey,_.identifier].join(":");let te=_.relays??[];te.length===0&&(te=[await maybeGetEventRelayUrl$2(g)]),c(["q",X,te[0]]),n?.pTags!==!1&&n?.pTagOnQTags!==!1&&n?.pTagOnATags!==!1&&c(["p",_.pubkey]),q()}));break;default:return f}return L&&c(L),`nostr:${g}`}catch{return f}}),await Promise.all(a),!n?.filters?.excludeTypes?.includes("hashtag")){const f=generateHashtags$2(r).map(g=>["t",g]);t=mergeTags$2(t,f)}if(n?.pTags!==!1&&n?.copyPTagsFromTarget&&s){const f=s.getMatchingTags("p");for(const g of f)!g[1]||!isValidPubkey$2(g[1])||t.find(b=>b[0]==="p"&&b[1]===g[1])||t.push(g)}return{content:r,tags:t}}async function maybeGetEventRelayUrl$2(r){return""}async function encrypt4(r,t,n="nip44"){let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||(()=>{const c=this.getMatchingTags("p");if(c.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:c[0][1]})})();if(n==="nip44"&&await isEncryptionEnabled$2(o,"nip44")&&(s=await o.encrypt(a,this.content,"nip44")),(!s||n==="nip04")&&await isEncryptionEnabled$2(o,"nip04")&&(s=await o.encrypt(a,this.content,"nip04")),!s)throw new Error("Failed to encrypt event.");this.content=s}async function decrypt4(r,t,n){if(this.ndk?.cacheAdapter?.getDecryptedEvent){const f=await this.ndk.cacheAdapter.getDecryptedEvent(this.id);if(f){this.content=f.content;return}}let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||this.author;if(!a)throw new Error("No sender provided and no author available");const c=n||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((c==="nip04"||this.kind===4)&&await isEncryptionEnabled$2(o,"nip04")&&this.content.search("\\?iv=")&&(s=await o.decrypt(a,this.content,"nip04")),!s&&c==="nip44"&&await isEncryptionEnabled$2(o,"nip44")&&(s=await o.decrypt(a,this.content,"nip44")),!s)throw new Error("Failed to decrypt event.");this.content=s,this.ndk?.cacheAdapter?.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this.id,this)}async function isEncryptionEnabled$2(r,t){return r.encryptionEnabled?t?!!await r.encryptionEnabled(t):!0:!1}function eventHasETagMarkers$2(r){for(const t of r.tags)if(t[0]==="e"&&(t[3]??"").length>0)return!0;return!1}function getRootTag$2(r,t){t??=r.tagType();const n=r.tags.find(isTagRootTag$2);if(!n){if(eventHasETagMarkers$2(r))return;const s=r.getMatchingTags(t);if(s.length<3)return s[0]}return n}var nip22RootTags$2=new Set(["A","E","I"]),nip22ReplyTags$2=new Set(["a","e","i"]);function getReplyTag$2(r,t){if(r.kind===1111){let o;for(const a of r.tags)if(nip22RootTags$2.has(a[0]))o=a;else if(nip22ReplyTags$2.has(a[0])){o=a;break}return o}t??=r.tagType();let n=!1,s;for(const o of r.tags)if(o[0]===t){if((o[3]??"").length>0&&(n=!0),n&&o[3]==="reply")return o;n&&o[3]==="root"&&(s=o),n||(s=o)}return s}function isTagRootTag$2(r){return r[0]==="E"||r[3]==="root"}async function fetchTaggedEvent$2(r,t){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(r,t);if(n.length===0)return;const[s,o,a]=n[0],c=a!==""?this.ndk.pool.getRelay(a):void 0;return await this.ndk.fetchEvent(o,{},c)}async function fetchRootEvent$2(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getRootTag$2(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}async function fetchReplyEvent$2(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getReplyTag$2(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}function isReplaceable$2(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral$2(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable$2(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT$2=2;function encode$4(r=DEFAULT_RELAY_COUNT$2){let t=[];return this.onRelays.length>0?t=this.onRelays.map(n=>n.url):this.relay&&(t=[this.relay.url]),t.length>r&&(t=t.slice(0,r)),this.isParamReplaceable()?nip19_exports$4.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?nip19_exports$4.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):nip19_exports$4.noteEncode(this.tagId())}async function repost$2(r=!0,t){if(!t&&r){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const n=new NDKEvent$2(this.ndk,{kind:getKind$2(this)});return this.isProtected||(n.content=JSON.stringify(this.rawEvent())),n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),t&&await n.sign(t),r&&await n.publish(),n}function getKind$2(r){return r.kind===1?6:16}function getEventDetails$2(r){return"inspect"in r&&typeof r.inspect=="string"?r.inspect:JSON.stringify(r)}function validateForSerialization$2(r){if(typeof r.kind!="number")throw new Error(`Can't serialize event with invalid properties: kind (must be number, got ${typeof r.kind}). Event: ${getEventDetails$2(r)}`);if(typeof r.content!="string")throw new Error(`Can't serialize event with invalid properties: content (must be string, got ${typeof r.content}). Event: ${getEventDetails$2(r)}`);if(typeof r.created_at!="number")throw new Error(`Can't serialize event with invalid properties: created_at (must be number, got ${typeof r.created_at}). Event: ${getEventDetails$2(r)}`);if(typeof r.pubkey!="string")throw new Error(`Can't serialize event with invalid properties: pubkey (must be string, got ${typeof r.pubkey}). Event: ${getEventDetails$2(r)}`);if(!Array.isArray(r.tags))throw new Error(`Can't serialize event with invalid properties: tags (must be array, got ${typeof r.tags}). Event: ${getEventDetails$2(r)}`);for(let t=0;t<r.tags.length;t++){const n=r.tags[t];if(!Array.isArray(n))throw new Error(`Can't serialize event with invalid properties: tags[${t}] (must be array, got ${typeof n}). Event: ${getEventDetails$2(r)}`);for(let s=0;s<n.length;s++)if(typeof n[s]!="string")throw new Error(`Can't serialize event with invalid properties: tags[${t}][${s}] (must be string, got ${typeof n[s]}). Event: ${getEventDetails$2(r)}`)}}function serialize$2(r=!1,t=!1){validateForSerialization$2(this);const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return r&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}function deserialize$2(r){const t=JSON.parse(r),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};if(t.length>=7){const s=t[6],o=t[7];s&&s.length===128?(n.sig=s,o&&o.length===64&&(n.id=o)):s&&s.length===64&&(n.id=s,o&&o.length===128&&(n.sig=o))}return n}var worker$1,processingQueue$2={};function signatureVerificationInit$1(r){worker$1=r,worker$1.onmessage=t=>{if(!Array.isArray(t.data)||t.data.length!==2){console.error("[NDK]  Signature verification worker received incompatible message format.",`

 Expected format: [eventId, boolean]`,`
 Received:`,t.data,`

 This likely means:`,`
  1. You have a STALE worker.js file that needs updating`,`
  2. Version mismatch between @nostr-dev-kit/ndk and deployed worker`,`
  3. Wrong worker is being used for signature verification`,`

 Solution: Update your worker files:`,`
  cp node_modules/@nostr-dev-kit/ndk/dist/workers/sig-verification.js public/`,`
  cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/worker.js public/`,`

 Or use Vite/bundler imports instead of static files:`,`
  import SigWorker from "@nostr-dev-kit/ndk/workers/sig-verification?worker"`);return}const[n,s]=t.data,o=processingQueue$2[n];if(!o){console.error("No record found for event",n);return}delete processingQueue$2[n];for(const a of o.resolves)a(s)}}async function verifySignatureAsync$2(r,t,n){const s=r.ndk,o=Date.now();let a;return s.signatureVerificationFunction?a=await s.signatureVerificationFunction(r):a=await new Promise(c=>{const f=r.serialize();let g=!1;processingQueue$2[r.id]||(processingQueue$2[r.id]={event:r,resolves:[],relay:n},g=!0),processingQueue$2[r.id].resolves.push(c),g&&worker$1?.postMessage({serialized:f,id:r.id,sig:r.sig,pubkey:r.pubkey})}),s.signatureVerificationTimeMs+=Date.now()-o,a}var PUBKEY_REGEX$2=/^[a-f0-9]{64}$/;function validate$2(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX$2)||!Array.isArray(this.tags))return!1;for(let r=0;r<this.tags.length;r++){const t=this.tags[r];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]=="object")return!1}return!0}var verifiedSignatures$2=new import_typescript_lru_cache.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature$2(r){if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const t=verifiedSignatures$2.get(this.id);if(t!==null)return this.signatureVerified=!!t,this.signatureVerified;try{if(this.ndk?.asyncSigVerification){const n=this.relay;verifySignatureAsync$2(this,r,n).then(s=>{r&&(this.signatureVerified=s,s&&verifiedSignatures$2.set(this.id,this.sig)),s?n&&n.addValidatedEvent():(n?this.ndk?.reportInvalidSignature(this,n):this.ndk?.reportInvalidSignature(this),verifiedSignatures$2.set(this.id,!1))}).catch(s=>{console.error("signature verification error",this.id,s)})}else{const n=sha2564(new TextEncoder().encode(this.serialize())),s=schnorr2.verify(this.sig,n,this.pubkey);return s?verifiedSignatures$2.set(this.id,this.sig):verifiedSignatures$2.set(this.id,!1),this.signatureVerified=s,s}}catch{return this.signatureVerified=!1,!1}}function getEventHash2(){return getEventHashFromSerializedEvent$2(this.serialize())}function getEventHashFromSerializedEvent$2(r){const t=sha2564(new TextEncoder().encode(r));return bytesToHex3(t)}var skipClientTagOnKinds$2=new Set([0,4,1059,13,3,9734,5]),NDKEvent$2=class li extends import_tseep.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(t,n){super(),this.ndk=t,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof li&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(t,n){return new li(t,deserialize$2(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,n,s){const o=["i"],a=["k"];switch(n){case"url":{const c=new URL(t);c.hash="",o.push(c.toString()),a.push(`${c.protocol}//${c.host}`);break}case"hashtag":o.push(`#${t.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${t.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${t.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${t}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${t}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${t}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${t.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${t.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${n}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(t,n,s,o,a){let c=[];if(t.fetchProfile!==void 0){if(o??="p",o==="p"&&a?.pTags===!1)return;const g=[o,t.pubkey];n&&g.push("",n),c.push(g)}else if(t instanceof li){const g=t;if(s??=g?.pubkey===this.pubkey,c=g.referenceTags(n,s,o,a),a?.pTags!==!1)for(const b of g.getMatchingTags("p"))!b[1]||!isValidPubkey$2(b[1])||b[1]!==this.pubkey&&(this.tags.find(_=>_[0]==="p"&&_[1]===b[1])||this.tags.push(["p",b[1]]))}else if(Array.isArray(t))c=[t];else throw new Error("Invalid argument",t);this.tags=mergeTags$2(this.tags,c)}async toNostrEvent(t,n){if(!t&&this.pubkey===""){const a=await this.ndk?.signer?.user();this.pubkey=a?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:s,tags:o}=await this.generateTags(n);this.content=s||"",this.tags=o;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}serialize=serialize$2.bind(this);getEventHash=getEventHash2.bind(this);validate=validate$2.bind(this);verifySignature=verifySignature$2.bind(this);isReplaceable=isReplaceable$2.bind(this);isEphemeral=isEphemeral$2.bind(this);isDvm=()=>this.kind&&this.kind>=5e3&&this.kind<=7e3;isParamReplaceable=isParamReplaceable$2.bind(this);encode=encode$4.bind(this);encrypt=encrypt4.bind(this);decrypt=decrypt4.bind(this);getMatchingTags(t,n){const s=this.tags.filter(o=>o[0]===t);return n===void 0?s:s.filter(o=>o[3]===n)}hasTag(t,n){return this.tags.some(s=>s[0]===t&&(!n||s[3]===n))}tagValue(t,n){const s=this.getMatchingTags(t,n);if(s.length!==0)return s[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t,n){const s=Array.isArray(t)?t:[t];this.tags=this.tags.filter(o=>{const a=s.includes(o[0]),c=n?o[3]===n:!0;return!(a&&c)})}replaceTag(t){this.removeTag(t[0]),this.tags.push(t)}async sign(t,n){this.ndk?.aiGuardrails?.event?.signing(this),t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk?.signer);const s=await this.toNostrEvent(void 0,n);return this.sig=await t.sign(s),this.sig}async publishReplaceable(t,n,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,n,s)}async publish(t,n,s,o){if(s||(s=1),this.sig||await this.sign(void 0,o),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(this.ndk.aiGuardrails?.event?.publishing(this),(!t||t.size===0)&&(t=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent$2(this.ndk,this,s)),this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds){const f=this.getMatchingTags("e").map(g=>g[1]);this.ndk.cacheAdapter.deleteEventIds(f)}const a=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent&&shouldTrackUnpublishedEvent$2(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(f){console.error("Error adding unpublished event to cache",f)}this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(f=>f[1])),this.ndk.subManager.dispatchEvent(a,void 0,!0);const c=await t.publish(this,n,s);return c.forEach(f=>this.ndk?.subManager.seenEvent(this.id,f)),c}async generateTags(t){let n=[];const s=await generateContentTags$2(this.content,this.tags,t,this),o=s.content;if(n=s.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const c=this.tagValue("title");let g=[...Array(c?6:16)].map(()=>Math.random().toString(36)[2]).join("");c&&c.length>0&&(g=`${c.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${g}`),n.push(["d",g])}if(this.shouldAddClientTag){const a=["client",this.ndk?.clientName??""];this.ndk?.clientNip89&&a.push(this.ndk?.clientNip89),n.push(a)}else this.shouldStripClientTag&&(n=n.filter(a=>a[0]!=="client"));return{content:o||"",tags:n}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||skipClientTagOnKinds$2.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds$2.has(this.kind)}muted(){return this.ndk?.muteFilter&&this.ndk.muteFilter(this)?"muted":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const t=this.dTag??"";return`${this.kind}:${this.pubkey}:${t}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let n;return this.isParamReplaceable()?n=["a",this.tagAddress()]:n=["e",this.tagId()],this.relay?n.push(this.relay.url):n.push(""),n.push(t??""),this.isParamReplaceable()||n.push(this.pubkey),n}referenceTags(t,n,s,o){let a=[];return this.isParamReplaceable()?a=[[s??"a",this.tagAddress()],[s??"e",this.id]]:a=[[s??"e",this.id]],a=a.map(c=>(c[0]==="e"||t?c.push(this.relay?.url??""):this.relay?.url&&c.push(this.relay?.url),c)),a.forEach(c=>{c[0]==="e"?(c.push(t??""),c.push(this.pubkey)):t&&c.push(t)}),a=[...a,...this.getMatchingTags("h")],!n&&o?.pTags!==!1&&a.push(...this.author.referenceTags()),a}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new li(this.ndk,{kind:5,content:t||""});return s.tag(this,void 0,!0),s.tags.push(["k",this.kind?.toString()]),n&&(this.emit("deleted"),await s.publish()),s}set isProtected(t){this.removeTag("-"),t&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}fetchTaggedEvent=fetchTaggedEvent$2.bind(this);fetchRootEvent=fetchRootEvent$2.bind(this);fetchReplyEvent=fetchReplyEvent$2.bind(this);repost=repost$2.bind(this);async react(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new li(this.ndk,{kind:7,content:t});return s.tag(this),this.kind!==1&&s.tags.push(["k",`${this.kind}`]),n&&await s.publish(),s}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(t=>t.url).join(", "))}reply(t,n){const s=new li(this.ndk);if(this.ndk?.aiGuardrails?.event?.creatingReply(s),this.kind===1&&!t)s.kind=1,this.hasTag("e")?s.tags=[...s.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,n)]:s.tag(this,"root",!1,void 0,n);else{s.kind=1111;const o=["A","E","I","P"],a=this.tags.filter(c=>o.includes(c[0]));if(a.length>0){const c=this.tagValue("K");s.tags.push(...a),c&&s.tags.push(["K",c]);let f;if(this.isParamReplaceable()){f=["a",this.tagAddress()];const g=this.relay?.url??"";g&&f.push(g)}else{f=["e",this.tagId()];const g=this.relay?.url??"";f.push(g),f.push(this.pubkey)}s.tags.push(f)}else{let c,f;const g=this.relay?.url??"";this.isParamReplaceable()?(c=["a",this.tagAddress(),g],f=["A",this.tagAddress(),g]):(c=["e",this.tagId(),g,this.pubkey],f=["E",this.tagId(),g,this.pubkey]),s.tags.push(c),s.tags.push(f),s.tags.push(["K",this.kind?.toString()]),n?.pTags!==!1&&n?.pTagOnATags!==!1&&s.tags.push(["P",this.pubkey])}s.tags.push(["k",this.kind?.toString()]),n?.pTags!==!1&&(s.tags.push(...this.getMatchingTags("p")),s.tags.push(["p",this.pubkey]))}return s}},untrackedUnpublishedEvents$2=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent$2(r){return!untrackedUnpublishedEvents$2.has(r.kind)}var NDKPool$2=class extends import_tseep3.EventEmitter{_relays=new Map;status="idle";autoConnectRelays=new Set;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;disconnectionTimes=new Map;systemEventDetector;constructor(t,n,{debug:s,name:o}={}){super(),this.debug=s??n.debug.extend("pool"),o&&(this._name=o),this.ndk=n,this.relayUrls=t,this.ndk.pools&&this.ndk.pools.push(this)}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const n of t){const s=new NDKRelay$2(n,void 0,this.ndk);s.connectivity.netDebug=this.ndk.netDebug,this.addRelay(s)}}_name="unnamed";get name(){return this._name}set name(t){this._name=t,this.debug=this.debug.extend(t)}useTemporaryRelay(t,n=3e4,s){const o=this.relays.has(t.url);o||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,s));const a=this.temporaryRelayTimers.get(t.url);if(a&&clearTimeout(a),!o||a){const c=setTimeout(()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)},n);this.temporaryRelayTimers.set(t.url,c)}}addRelay(t,n=!0){const s=this.relays.has(t.url),o=t.url.includes("/npub1");let a=!0;const c=t.url;if(s)return;if(this.ndk.relayConnectionFilter&&!this.ndk.relayConnectionFilter(c)){this.debug(`Refusing to add relay ${c}: blocked by relayConnectionFilter`);return}if(o){this.debug(`Refusing to add relay ${c}: is a filter relay`);return}if(this.ndk.cacheAdapter?.getRelayStatus){const te=this.ndk.cacheAdapter.getRelayStatus(c),ne=te instanceof Promise?void 0:te;if(ne?.dontConnectBefore){if(ne.dontConnectBefore>Date.now()){const Ce=ne.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${c}: delayed connect for ${Ce}ms`),setTimeout(()=>{this.addRelay(t,n)},Ce);return}a=!1}}const f=te=>this.emit("notice",t,te),g=()=>this.handleRelayConnect(c),b=()=>this.handleRelayReady(t),_=()=>{this.recordDisconnection(t),this.emit("relay:disconnect",t)},L=()=>this.handleFlapping(t),q=te=>this.emit("relay:auth",t,te),X=()=>this.emit("relay:authed",t);t.off("notice",f),t.off("connect",g),t.off("ready",b),t.off("disconnect",_),t.off("flapping",L),t.off("auth",q),t.off("authed",X),t.on("notice",f),t.on("connect",g),t.on("ready",b),t.on("disconnect",_),t.on("flapping",L),t.on("auth",q),t.on("authed",X),t.on("delayed-connect",te=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+te})}),this._relays.set(c,t),n&&this.autoConnectRelays.add(c),n&&this.status==="active"&&(this.emit("relay:connecting",t),t.connect(void 0,a).catch(te=>{this.debug(`Failed to connect to relay ${c}`,te)}))}removeRelay(t){const n=this.relays.get(t);if(n)return n.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",n),!0;const s=this.temporaryRelayTimers.get(t);return s&&(clearTimeout(s),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const n=normalizeRelayUrl$2(t),s=this.relays.get(n);return s?s.status===5:!1}getRelay(t,n=!0,s=!1,o){let a=this.relays.get(normalizeRelayUrl$2(t));return a||(a=new NDKRelay$2(t,void 0,this.ndk),a.connectivity.netDebug=this.ndk.netDebug,s?this.useTemporaryRelay(a,3e4,o):this.addRelay(a,n)),a}handleRelayConnect(t){const n=this.relays.get(t);if(!n){console.error("NDK BUG: relay not found in pool",{relayUrl:t});return}this.emit("relay:connect",n),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}ms`:""}...`);const n=Array.from(this.autoConnectRelays.keys()).map(c=>this.relays.get(c)).filter(c=>!!c);for(const c of n)c.status!==5&&c.status!==4&&(this.emit("relay:connecting",c),c.connect().catch(f=>{this.debug(`Failed to connect to relay ${c.url}: ${f??"No reason specified"}`)}));const s=()=>n.every(c=>c.status===5),o=new Promise(c=>{if(s()){c();return}const f=[];for(const g of n){const b=()=>{if(s()){for(let _=0;_<n.length;_++)n[_].off("connect",f[_]);c()}};f.push(b),g.on("connect",b)}}),a=typeof t=="number"?new Promise(c=>setTimeout(c,t)):new Promise(()=>{});await Promise.race([o,a])}checkOnFlappingRelays(){const t=this.flappingRelays.size,n=this.relays.size;if(t/n>=.8)for(const s of this.flappingRelays)this.backoffTimes.set(s,0)}recordDisconnection(t){const n=Date.now();this.disconnectionTimes.set(t.url,n);for(const[s,o]of this.disconnectionTimes.entries())n-o>1e4&&this.disconnectionTimes.delete(s);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const t=Date.now(),n=[];for(const s of this.disconnectionTimes.values())t-s<5e3&&n.push(s);n.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${n.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){if(this.systemEventDetector){this.debug("System-wide reconnection already in progress, skipping");return}this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const t of this.relays.values())t.connectivity&&(t.connectivity.resetReconnectionState(),t.status!==5&&t.status!==4&&t.connect().catch(n=>{this.debug(`Failed to reconnect relay ${t.url} after system event: ${n}`)}));this.disconnectionTimes.clear()}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let n=this.backoffTimes.get(t.url)||5e3;n=n*2,this.backoffTimes.set(t.url,n),this.debug(`Backoff time for ${t.url} is ${n}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()},n),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const n of this.relays.values())t.total++,n.status===5?t.connected++:n.status===1?t.disconnected++:n.status===4&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url))}urls(){return Array.from(this.relays.keys())}},NDKDVMJobFeedback$2=class es extends NDKEvent$2{static kinds=[7e3];constructor(t,n){super(t,n),this.kind??=7e3}static async from(t){const n=new es(t.ndk,t.rawEvent());return n.encrypted&&await n.dvmDecrypt(),n}get status(){return this.tagValue("status")}set status(t){this.removeTag("status"),t!==void 0&&this.tags.push(["status",t])}get encrypted(){return!!this.getMatchingTags("encrypted")[0]}async dvmDecrypt(){await this.decrypt();const t=JSON.parse(this.content);this.tags.push(...t)}},NDKCashuMintList$2=class ss extends NDKEvent$2{static kind=10019;static kinds=[10019];_p2pk;constructor(t,n){super(t,n),this.kind??=10019}static from(t){return new ss(t.ndk,t)}set relays(t){this.tags=this.tags.filter(n=>n[0]!=="relay");for(const n of t)this.tags.push(["relay",n])}get relays(){const t=[];for(const n of this.tags)n[0]==="relay"&&t.push(n[1]);return t}set mints(t){this.tags=this.tags.filter(n=>n[0]!=="mint");for(const n of t)this.tags.push(["mint",n])}get mints(){const t=[];for(const n of this.tags)n[0]==="mint"&&t.push(n[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return NDKRelaySet$2.fromRelayUrls(this.relays,this.ndk)}},NDKArticle$2=class as extends NDKEvent$2{static kind=30023;static kinds=[30023];constructor(t,n){super(t,n),this.kind??=30023}static from(t){return new as(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t){let n=Number.parseInt(t);return n>1e12&&(n=Math.floor(n/1e3)),n}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},NDKBlossomList$2=class us extends NDKEvent$2{static kinds=[10063];constructor(t,n){super(t,n),this.kind??=10063}static from(t){return new us(t.ndk,t.rawEvent())}get servers(){return this.tags.filter(t=>t[0]==="server").map(t=>t[1])}set servers(t){this.tags=this.tags.filter(n=>n[0]!=="server");for(const n of t)this.tags.push(["server",n])}get default(){const t=this.servers;return t.length>0?t[0]:void 0}set default(t){if(!t)return;const s=this.servers.filter(o=>o!==t);this.servers=[t,...s]}addServer(t){if(!t)return;const n=this.servers;n.includes(t)||(this.servers=[...n,t])}removeServer(t){if(!t)return;const n=this.servers;this.servers=n.filter(s=>s!==t)}},NDKFedimintMint$2=class ls extends NDKEvent$2{static kind=38173;static kinds=[38173];constructor(t,n){super(t,n),this.kind??=38173}static async from(t){return new ls(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get inviteCodes(){return this.getMatchingTags("u").map(t=>t[1])}set inviteCodes(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get modules(){return this.getMatchingTags("modules").map(t=>t[1])}set modules(t){this.removeTag("modules");for(const n of t)this.tags.push(["modules",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKCashuMintAnnouncement$2=class cs extends NDKEvent$2{static kind=38172;static kinds=[38172];constructor(t,n){super(t,n),this.kind??=38172}static async from(t){return new cs(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get url(){return this.tagValue("u")}set url(t){this.removeTag("u"),t&&this.tags.push(["u",t])}get nuts(){return this.getMatchingTags("nuts").map(t=>t[1])}set nuts(t){this.removeTag("nuts");for(const n of t)this.tags.push(["nuts",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKMintRecommendation$2=class hs extends NDKEvent$2{static kind=38e3;static kinds=[38e3];constructor(t,n){super(t,n),this.kind??=38e3}static async from(t){return new hs(t.ndk,t)}get recommendedKind(){const t=this.tagValue("k");return t?Number(t):void 0}set recommendedKind(t){this.removeTag("k"),t&&this.tags.push(["k",t.toString()])}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get urls(){return this.getMatchingTags("u").map(t=>t[1])}set urls(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get mintEventPointers(){return this.getMatchingTags("a").map(t=>({kind:Number(t[1].split(":")[0]),identifier:t[1].split(":")[2],relay:t[2]}))}addMintEventPointer(t,n,s,o){const a=["a",`${t}:${n}:${s}`];o&&a.push(o),this.tags.push(a)}get review(){return this.content}set review(t){this.content=t}},NDKClassified$2=class fs extends NDKEvent$2{static kinds=[30402];constructor(t,n){super(t,n),this.kind??=30402}static from(t){return new fs(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}get location(){return this.tagValue("location")}set location(t){this.removeTag("location"),t&&this.tags.push(["location",t])}get price(){const t=this.tags.find(n=>n[0]==="price");if(t)return{amount:Number.parseFloat(t[1]),currency:t[2],frequency:t[3]}}set price(t){if(typeof t=="string"&&(t={amount:Number.parseFloat(t)}),t?.amount){const n=["price",t.amount.toString()];t.currency&&n.push(t.currency),t.frequency&&n.push(t.frequency),this.tags.push(n)}else this.removeTag("price")}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}},NDKDraft$2=class ds extends NDKEvent$2{_event;static kind=31234;static kinds=[31234,1234];counterparty;constructor(t,n){super(t,n),this.kind??=31234}static from(t){return new ds(t.ndk,t)}set identifier(t){this.removeTag("d"),this.tags.push(["d",t])}get identifier(){return this.dTag}set event(t){t instanceof NDKEvent$2?this._event=t:this._event=new NDKEvent$2(void 0,t),this.prepareEvent()}set checkpoint(t){t?(this.tags.push(t.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const t=this.tagValue("p");return!!t&&t!==this.pubkey}async getEvent(t){if(this._event)return this._event;if(t??=this.ndk?.signer,!t)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const n=t.pubkey,o=[this.tagValue("p"),this.pubkey].filter(Boolean).find(f=>f!==n);let a;a=new NDKUser$2({pubkey:o??n}),await this.decrypt(a,t);const c=JSON.parse(this.content);return this._event=await wrapEvent3(new NDKEvent$2(this.ndk,c)),this._event}catch(n){console.error(n);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:t,publish:n,relaySet:s}){if(t??=this.ndk?.signer,!t)throw new Error("No signer available");const o=this.counterparty||await t.user();if(await this.encrypt(o,t),this.counterparty){const a=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",a])}if(n!==!1)return this.publishReplaceable(s)}};function mapImetaTag$2(r){const t={};if(r.length===2){const s=r[1].split(" ");for(let o=0;o<s.length;o+=2){const a=s[o],c=s[o+1];a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}const n=r.slice(1);for(const s of n){const o=s.split(" "),a=o[0],c=o.slice(1).join(" ");a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}function imetaTagToTag$2(r){const t=["imeta"];for(const[n,s]of Object.entries(r))if(Array.isArray(s))for(const o of s)t.push(`${n} ${o}`);else s&&t.push(`${n} ${s}`);return t}var NDKFollowPack$2=class ps extends NDKEvent$2{static kind=39089;static kinds=[39089,39092];constructor(t,n){super(t,n),this.kind??=39089}static from(t){return new ps(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){const t=this.tags.find(n=>n[0]==="imeta");if(t){const n=mapImetaTag$2(t);if(n.url)return n.url}return this.tagValue("image")}set image(t){this.tags=this.tags.filter(n=>n[0]!=="imeta"&&n[0]!=="image"),typeof t=="string"?t!==void 0&&this.tags.push(["image",t]):t&&typeof t=="object"&&(this.tags.push(imetaTagToTag$2(t)),t.url&&this.tags.push(["image",t.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(t=>t[0]==="p"&&t[1]&&isValidPubkey$2(t[1])).map(t=>t[1])))}set pubkeys(t){this.tags=this.tags.filter(n=>n[0]!=="p");for(const n of t)this.tags.push(["p",n])}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}},NDKHighlight$2=class gs extends NDKEvent$2{_article;static kind=9802;static kinds=[9802];constructor(t,n){super(t,n),this.kind??=9802}static from(t){return new gs(t.ndk,t)}get url(){return this.tagValue("r")}set context(t){t===void 0?this.tags=this.tags.filter(([n,s])=>n!=="context"):(this.tags=this.tags.filter(([n,s])=>n!=="context"),this.tags.push(["context",t]))}get context(){return this.tags.find(([t,n])=>t==="context")?.[1]??void 0}get article(){return this._article}set article(t){this._article=t,typeof t=="string"?this.tags.push(["r",t]):this.tag(t)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){if(this._article!==void 0)return this._article;let t;const n=this.getArticleTag();if(n){switch(n[0]){case"a":{const[s,o,a]=n[1].split(":");t=nip19_exports$4.naddrEncode({kind:Number.parseInt(s),pubkey:o,identifier:a});break}case"e":t=nip19_exports$4.noteEncode(n[1]);break;case"r":this._article=n[1];break}if(t){let s=await this.ndk?.fetchEvent(t);s&&(s.kind===30023&&(s=NDKArticle$2.from(s)),this._article=s)}return this._article}}},NDKImage$2=class ys extends NDKEvent$2{static kind=20;static kinds=[20];_imetas;constructor(t,n){super(t,n),this.kind??=20}static from(t){return new ys(t.ndk,t.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag$2).filter(t=>!!t.url),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag$2))}},NDKList$2=class bs extends NDKEvent$2{_encryptedTags;static kinds=[30001,10004,10050,10030,10015,10001,10002,10007,10006,10003];encryptedTagsLength;constructor(t,n){super(t,n),this.kind??=30001}static from(t){return new bs(t.ndk,t)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(n,this.content),o=JSON.parse(s);return o?.[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(n=>n[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,n=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(t instanceof NDKEvent$2)a=[t.tagReference(n)];else if(t instanceof NDKUser$2)a=t.referenceTags();else if(t instanceof NDKRelay$2)a=t.referenceTags();else if(Array.isArray(t))a=[t];else throw new Error("Invalid object type");if(n&&a[0].push(n),s){const c=await this.ndk.signer.user(),f=await this.encryptedTags();o==="top"?f.unshift(...a):f.push(...a),this._encryptedTags=f,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(f),await this.encrypt(c)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,n=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(f=>f[1]===t);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),c=a.findIndex(f=>f[1]===t);if(c>=0&&(a.splice(c,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),n)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,n){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(n){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(t,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(n=>n[1]===t)}filterForItems(){const t=new Set,n=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])t.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,c,f]=o[1].split(":");if(!a||!c)continue;const g=`${a}:${c}`,b=n.get(g)||[];b.push(f||""),n.set(g,b)}if(t.size>0&&s.push({ids:Array.from(t)}),n.size>0)for(const[o,a]of n.entries()){const[c,f]=o.split(":");s.push({kinds:[Number.parseInt(c)],authors:[f],"#d":a})}return s}},NDKAppHandlerEvent$2=class ws extends NDKEvent$2{profile;static kinds=[31990];constructor(t,n){super(t,n),this.kind??=31990}static from(t){const n=new ws(t.ndk,t.rawEvent());return n.isValid?n:null}get isValid(){const t=new Map,n=o=>[o[0],o[2]].join(":").toLowerCase(),s=["web","android","ios"];for(const o of this.tags)if(s.includes(o[0])){const a=n(o);if(t.has(a)&&t.get(a)!==o[1].toLowerCase())return!1;t.set(a,o[1].toLowerCase())}return!0}async fetchProfile(){if(this.profile===void 0&&this.content.length>0)try{const t=JSON.parse(this.content);if(t?.name)return t;this.profile=null}catch{this.profile=null}return new Promise((t,n)=>{const s=this.author;s.fetchProfile().then(()=>{t(s.profile)}).catch(n)})}},NDKNutzap$2=class Bi extends NDKEvent$2{debug;_proofs=[];static kind=9321;static kinds=[Bi.kind];constructor(t,n){super(t,n),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??import_debug4.default("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const s=this.getMatchingTags("proof");s.length?this._proofs=s.map(o=>JSON.parse(o[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(t){const n=new Bi(t.ndk,t);if(!(!n._proofs||!n._proofs.length))return n}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(n=>n[0]!=="proof");for(const n of t)this.tags.push(["proof",JSON.stringify(n)])}get proofs(){return this._proofs}get rawP2pk(){const t=this.proofs[0];try{const n=JSON.parse(t.secret);let s;if(typeof n=="string"?(s=JSON.parse(n),this.debug("stringified payload",t.secret)):typeof n=="object"&&(s=n),Array.isArray(s)&&s[0]==="P2PK"&&s.length>1&&typeof s[1]=="object"&&s[1]!==null||typeof s=="object"&&s!==null&&typeof s[1]?.data=="string")return s[1].data}catch(n){this.debug("error parsing p2pk pubkey",n,this.proofs[0])}}get p2pk(){const t=this.rawP2pk;if(t)return t.startsWith("02")?t.slice(2):t}get mint(){return this.tagValue("u")}set mint(t){this.replaceTag(["u",t])}get unit(){let t=this.tagValue("unit")??"sat";return t?.startsWith("msat")&&(t="sat"),t}set unit(t){if(this.removeTag("unit"),t?.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((n,s)=>n+s.amount,0)}sender=this.author;set target(t){this.tags=this.tags.filter(n=>n[0]!=="p"),t instanceof NDKEvent$2&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new NDKUser$2({pubkey:t})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const t=await super.toNostrEvent();return t.content=this.comment,t}get isValid(){let t=0,n=0,s=0;for(const o of this.tags)o[0]==="e"&&t++,o[0]==="p"&&n++,o[0]==="u"&&s++;return n===1&&s===1&&t<=1&&this.proofs.length>0}},NDKProject$2=class vs extends NDKEvent$2{static kind=31933;static kinds=[31933];_signer;constructor(t,n){super(t,n),this.kind=31933}static from(t){return new vs(t.ndk,t.rawEvent())}set repo(t){this.removeTag("repo"),t&&this.tags.push(["repo",t])}set hashtags(t){this.removeTag("hashtags"),t.filter(n=>n.length>0).length&&this.tags.push(["hashtags",...t])}get hashtags(){const t=this.tags.find(n=>n[0]==="hashtags");return t?t.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get picture(){return this.tagValue("picture")}set picture(t){this.removeTag("picture"),t&&this.tags.push(["picture",t])}set description(t){this.content=t}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){if(this._signer)return this._signer;const t=this.tagValue("key");if(!t)this._signer=NDKPrivateKeySigner$2.generate(),await this.encryptAndSaveNsec();else{const n=await this.ndk?.signer?.decrypt(this.ndk.activeUser,t);if(!n)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner$2(n)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(t){this._signer=new NDKPrivateKeySigner$2(t),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){if(!this._signer)throw new Error("Signer is not set.");const t=this._signer.privateKey,n=await this.ndk?.signer?.encrypt(this.ndk.activeUser,t);n&&(this.removeTag("key"),this.tags.push(["key",n]))}},NDKProjectTemplate$2=class Es extends NDKEvent$2{static kind=30717;static kinds=[30717];constructor(t,n){super(t,n),this.kind=30717}static from(t){return new Es(t.ndk,t.rawEvent())}get templateId(){return this.dTag??""}set templateId(t){this.dTag=t}get name(){return this.tagValue("title")??""}set name(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get description(){return this.tagValue("description")??""}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(t){this.removeTag("uri"),t&&this.tags.push(["uri",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get command(){return this.tagValue("command")}set command(t){this.removeTag("command"),t&&this.tags.push(["command",t])}get agentConfig(){const t=this.tagValue("agent");if(t)try{return JSON.parse(t)}catch{return}}set agentConfig(t){this.removeTag("agent"),t&&this.tags.push(["agent",JSON.stringify(t)])}get templateTags(){return this.getMatchingTags("t").map(t=>t[1]).filter(Boolean)}set templateTags(t){this.tags=this.tags.filter(n=>n[0]!=="t"),t.forEach(n=>{n&&this.tags.push(["t",n])})}},READ_MARKER$2="read",WRITE_MARKER$2="write",NDKRelayList$2=class _s extends NDKEvent$2{static kinds=[10002];constructor(t,n){super(t,n),this.kind??=10002}static from(t){return new _s(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===READ_MARKER$2).map(t=>tryNormalizeRelayUrl$2(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(const n of t)this.tags.push(["r",n,READ_MARKER$2])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===WRITE_MARKER$2).map(t=>tryNormalizeRelayUrl$2(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(const n of t)this.tags.push(["r",n,WRITE_MARKER$2])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(const n of t)this.tags.push(["r",n])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet$2(new Set(this.relays.map(t=>this.ndk?.pool.getRelay(t)).filter(t=>!!t)),this.ndk)}};function relayListFromKind3$1(r,t){try{const n=JSON.parse(t.content),s=new NDKRelayList$2(r),o=new Set,a=new Set;for(let[c,f]of Object.entries(n)){try{c=normalizeRelayUrl$2(c)}catch{continue}if(!f)o.add(c),a.add(c);else{const g=f;g.write&&a.add(c),g.read&&o.add(c)}}return s.readRelayUrls=Array.from(o),s.writeRelayUrls=Array.from(a),s}catch{}}var NDKRepost$2=class $s extends NDKEvent$2{_repostedEvents;static kinds=[6,16];static from(t){return new $s(t.ndk,t.rawEvent())}async repostedEvents(t,n){const s=[];if(!this.ndk)throw new Error("NDK instance not set");if(this._repostedEvents!==void 0)return this._repostedEvents;for(const o of this.repostedEventIds()){const a=filterForId$2(o),c=await this.ndk.fetchEvent(a,n);c&&s.push(t?t.from(c):c)}return s}repostedEventIds(){return this.tags.filter(t=>t[0]==="e"||t[0]==="a").map(t=>t[1])}};function filterForId$2(r){if(r.match(/:/)){const[t,n,s]=r.split(":");return{kinds:[Number.parseInt(t)],authors:[n],"#d":[s]}}return{ids:[r]}}var NDKSimpleGroupMemberList$2=class ks extends NDKEvent$2{relaySet;memberSet=new Set;static kind=39002;static kinds=[39002];constructor(t,n){super(t,n),this.kind??=39002,this.memberSet=new Set(this.members)}static from(t){return new ks(t.ndk,t)}get members(){return this.getMatchingTags("p").map(t=>t[1])}hasMember(t){return this.memberSet.has(t)}async publish(t,n,s){return t??=this.relaySet,super.publishReplaceable(t,n,s)}},NDKSimpleGroupMetadata$2=class Ss extends NDKEvent$2{static kind=39e3;static kinds=[39e3];constructor(t,n){super(t,n),this.kind??=39e3}static from(t){return new Ss(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}};function strToPosition$2(r){const[t,n]=r.split(",").map(Number);return{x:t,y:n}}function strToDimension$2(r){const[t,n]=r.split("x").map(Number);return{width:t,height:n}}var NDKStorySticker$2=class xs{static Text="text";static Pubkey="pubkey";static Event="event";static Prompt="prompt";static Countdown="countdown";type;value;position;dimension;properties;constructor(t){if(Array.isArray(t)){const n=t;if(n[0]!=="sticker"||n.length<5)throw new Error("Invalid sticker tag");this.type=n[1],this.value=n[2],this.position=strToPosition$2(n[3]),this.dimension=strToDimension$2(n[4]);const s={};for(let o=5;o<n.length;o++){const[a,...c]=n[o].split(" ");s[a]=c.join(" ")}Object.keys(s).length>0&&(this.properties=s)}else this.type=t,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(t){try{return new xs(t)}catch{return null}}get style(){return this.properties?.style}set style(t){t?this.properties={...this.properties,style:t}:delete this.properties?.style}get rotation(){return this.properties?.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(t){t!==void 0?this.properties={...this.properties,rot:t.toString()}:delete this.properties?.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}hasValidDimensions=()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height);hasValidPosition=()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y);toTag(){if(!this.isValid){const s=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${s.join(", ")}`)}let t;switch(this.type){case"event":t=this.value.tagId();break;case"pubkey":t=this.value.pubkey;break;default:t=this.value}const n=["sticker",this.type,t,coordinates$2(this.position),dimension$2(this.dimension)];if(this.properties)for(const[s,o]of Object.entries(this.properties))n.push(`${s} ${o}`);return n}},NDKStory$2=class As extends NDKEvent$2{static kind=23;static kinds=[23];_imeta;_dimensions;constructor(t,n){if(super(t,n),this.kind??=23,n)for(const s of n.tags)switch(s[0]){case"imeta":this._imeta=mapImetaTag$2(s);break;case"dim":this.dimensions=strToDimension$2(s[1]);break}}static from(t){return new As(t.ndk,t)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(t){this._imeta=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),t&&this.tags.push(imetaTagToTag$2(t))}get dimensions(){const t=this.tagValue("dim");if(t)return strToDimension$2(t)}set dimensions(t){this.removeTag("dim"),t&&this.tags.push(["dim",`${t.width}x${t.height}`])}get duration(){const t=this.tagValue("dur");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("dur"),t!==void 0&&this.tags.push(["dur",t.toString()])}get stickers(){const t=[];for(const n of this.tags){if(n[0]!=="sticker"||n.length<5)continue;const s=NDKStorySticker$2.fromTag(n);s&&t.push(s)}return t}addSticker(t){let n;if(t instanceof NDKStorySticker$2)n=t;else{const s=["sticker",t.type,typeof t.value=="string"?t.value:"",coordinates$2(t.position),dimension$2(t.dimension)];if(t.properties)for(const[o,a]of Object.entries(t.properties))s.push(`${o} ${a}`);n=new NDKStorySticker$2(s),n.value=t.value}n.type==="pubkey"?this.tag(n.value):n.type==="event"&&this.tag(n.value),this.tags.push(n.toTag())}removeSticker(t){const n=this.stickers;if(t<0||t>=n.length)return;let s=0;for(let o=0;o<this.tags.length;o++)if(this.tags[o][0]==="sticker"){if(s===t){this.tags.splice(o,1);break}s++}}},coordinates$2=r=>`${r.x},${r.y}`,dimension$2=r=>`${r.width}x${r.height}`,NDKSubscriptionReceipt$2=class Ts extends NDKEvent$2{debug;static kinds=[7003];constructor(t,n){super(t,n),this.kind??=7003,this.debug=t?.debug.extend("subscription-start")??import_debug5.default("ndk:subscription-start")}static from(t){return new Ts(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser$2({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get subscriber(){const t=this.getMatchingTags("P")?.[0];return t?new NDKUser$2({pubkey:t[1]}):void 0}set subscriber(t){this.removeTag("P"),t&&this.tags.push(["P",t.pubkey])}set subscriptionStart(t){this.debug(`before setting subscription start: ${this.rawEvent}`),this.removeTag("e"),this.tag(t,"subscription",!0),this.debug(`after setting subscription start: ${this.rawEvent}`)}get tierName(){return this.getMatchingTags("tier")?.[0]?.[1]}get isValid(){const t=this.validPeriod;if(!t||t.start>t.end)return!1;const n=this.getMatchingTags("p"),s=this.getMatchingTags("P");return!(n.length!==1||s.length!==1)}get validPeriod(){const t=this.getMatchingTags("valid")?.[0];if(t)try{return{start:new Date(Number.parseInt(t[1])*1e3),end:new Date(Number.parseInt(t[2])*1e3)}}catch{return}}set validPeriod(t){this.removeTag("valid"),t&&this.tags.push(["valid",Math.floor(t.start.getTime()/1e3).toString(),Math.floor(t.end.getTime()/1e3).toString()])}get startPeriod(){return this.validPeriod?.start}get endPeriod(){return this.validPeriod?.end}isActive(t){t??=new Date;const n=this.validPeriod;return!(!n||t<n.start||t>n.end)}},possibleIntervalFrequencies$2=["daily","weekly","monthly","quarterly","yearly"];function newAmount$2(r,t,n){return["amount",r.toString(),t,n]}function parseTagToSubscriptionAmount$2(r){const t=Number.parseInt(r[1]);if(Number.isNaN(t)||t===void 0||t===null||t<=0)return;const n=r[2];if(n===void 0||n==="")return;const s=r[3];if(s!==void 0&&possibleIntervalFrequencies$2.includes(s))return{amount:t,currency:n,term:s}}var NDKSubscriptionTier$2=class Ms extends NDKArticle$2{static kind=37001;static kinds=[37001];constructor(t,n){const s=n?.kind??37001;super(t,n),this.kind=s}static from(t){return new Ms(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>parseTagToSubscriptionAmount$2(t)).filter(t=>t!==void 0)}addAmount(t,n,s){this.tags.push(newAmount$2(t,n,s))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},NDKSubscriptionStart$2=class Rs extends NDKEvent$2{debug;static kinds=[7001];constructor(t,n){super(t,n),this.kind??=7001,this.debug=t?.debug.extend("subscription-start")??import_debug6.default("ndk:subscription-start")}static from(t){return new Rs(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser$2({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get amount(){const t=this.getMatchingTags("amount")?.[0];if(t)return parseTagToSubscriptionAmount$2(t)}set amount(t){this.removeTag("amount"),t&&this.tags.push(newAmount$2(t.amount,t.currency,t.term))}get tierId(){const t=this.getMatchingTags("e")?.[0],n=this.getMatchingTags("a")?.[0];if(!(!t||!n))return t[1]??n[1]}set tier(t){this.removeTag("e"),this.removeTag("a"),this.removeTag("event"),t&&(this.tag(t),this.removeTag("p"),this.tags.push(["p",t.pubkey]),this.tags.push(["event",JSON.stringify(t.rawEvent())]))}async fetchTier(){const t=this.tagValue("event");if(t)try{const o=JSON.parse(t);return new NDKSubscriptionTier$2(this.ndk,o)}catch{this.debug("Failed to parse event tag")}const n=this.tierId;if(!n)return;const s=await this.ndk?.fetchEvent(n);if(s)return NDKSubscriptionTier$2.from(s)}get isValid(){return this.getMatchingTags("amount").length!==1?(this.debug("Invalid # of amount tag"),!1):this.amount?this.getMatchingTags("p").length!==1?(this.debug("Invalid # of p tag"),!1):this.recipient?!0:(this.debug("Invalid p tag"),!1):(this.debug("Invalid amount tag"),!1)}},NDKTask$2=class Cs extends NDKEvent$2{static kind=1934;static kinds=[1934];constructor(t,n){super(t,n),this.kind=1934}static from(t){return new Cs(t.ndk,t.rawEvent())}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get title(){return this.tagValue("title")}set project(t){this.removeTag("a"),this.tags.push(t.tagReference())}get projectSlug(){const t=this.getMatchingTags("a")[0];return t?t[1].split(/:/)?.[2]:void 0}},NDKThread$2=class Is extends NDKEvent$2{static kind=11;static kinds=[11];constructor(t,n){super(t,n),this.kind??=11}static from(t){return new Is(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}},NDKVideo$2=class Ns extends NDKEvent$2{static kind=21;static kinds=[34235,34236,22,21];_imetas;static from(t){return new Ns(t.ndk,t.rawEvent())}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get thumbnail(){let t;return this.imetas&&this.imetas.length>0&&(t=this.imetas[0].image?.[0]),t??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag$2),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag$2))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}async generateTags(){if(super.generateTags(),!this.kind&&this.imetas?.[0]?.dim){const[t,n]=this.imetas[0].dim.split("x"),s=t&&n&&Number.parseInt(t)<Number.parseInt(n);this.duration&&this.duration<120&&s?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const t=this.tagValue("duration");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("duration"),t!==void 0&&this.tags.push(["duration",Math.floor(t).toString()])}},NDKWiki$2=class Bs extends NDKArticle$2{static kind=30818;static kinds=[30818];static from(t){return new Bs(t.ndk,t.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(t){this.removeTag("a","defer"),this.tag(t,"defer")}},NDKWikiMergeRequest$2=class Ps extends NDKEvent$2{static kinds=[818];static from(t){return new Ps(t.ndk,t.rawEvent())}get targetId(){return this.tagValue("a")}set target(t){this.tags=this.tags.filter(n=>{if(n[0]==="a"||n[0]==="e"&&n[3]!=="source")return!0}),this.tag(t)}get sourceId(){return this.tagValue("e","source")}set source(t){this.removeTag("e","source"),this.tag(t,"source",!1,"e")}},registeredEventClasses$2=new Set;function wrapEvent3(r){const t=new Map,s=[...[NDKImage$2,NDKVideo$2,NDKCashuMintList$2,NDKArticle$2,NDKHighlight$2,NDKDraft$2,NDKWiki$2,NDKWikiMergeRequest$2,NDKNutzap$2,NDKProject$2,NDKTask$2,NDKProjectTemplate$2,NDKSimpleGroupMemberList$2,NDKSimpleGroupMetadata$2,NDKSubscriptionTier$2,NDKSubscriptionStart$2,NDKSubscriptionReceipt$2,NDKList$2,NDKRelayList$2,NDKStory$2,NDKBlossomList$2,NDKFollowPack$2,NDKThread$2,NDKRepost$2,NDKClassified$2,NDKAppHandlerEvent$2,NDKDVMJobFeedback$2,NDKCashuMintAnnouncement$2,NDKFedimintMint$2,NDKMintRecommendation$2],...registeredEventClasses$2];for(const a of s)for(const c of a.kinds)t.set(c,a);const o=t.get(r.kind);return o?o.from(r):r}function checkMissingKind$1(r,t){(r.kind===void 0||r.kind===null)&&t("event-missing-kind",`Cannot sign event without 'kind'.

 Event data:
    content: ${r.content?`"${r.content.substring(0,50)}${r.content.length>50?"...":""}"`:"(empty)"}
    tags: ${r.tags.length} tag${r.tags.length!==1?"s":""}
    kind: ${r.kind} 

Set event.kind before signing.`,"Example: event.kind = 1; // for text note",!1)}function checkContentIsObject$1(r,t){if(typeof r.content=="object"){const n=JSON.stringify(r.content,null,2).substring(0,200);t("event-content-is-object",`Event content is an object. Content must be a string.

 Your content (${typeof r.content}):
${n}${JSON.stringify(r.content).length>200?"...":""}

 event.content = { ... }  // WRONG
 event.content = JSON.stringify({ ... })  // CORRECT`,"Use JSON.stringify() for structured data: event.content = JSON.stringify(data)",!1)}}function checkCreatedAtMilliseconds$1(r,t){if(r.created_at&&r.created_at>1e10){const n=Math.floor(r.created_at/1e3),s=new Date(r.created_at).toISOString();t("event-created-at-milliseconds",`Event created_at is in milliseconds, not seconds.

 Your value:
    created_at: ${r.created_at} 
    Interpreted as: ${s}
    Should be: ${n} 

Nostr timestamps MUST be in seconds since Unix epoch.`,"Use Math.floor(Date.now() / 1000) instead of Date.now()",!1)}}function checkInvalidPTags$1(r,t){r.getMatchingTags("p").forEach((s,o)=>{if(s[1]&&!/^[0-9a-f]{64}$/i.test(s[1])){const a=JSON.stringify(s);t("tag-invalid-p-tag",`p-tag[${o}] has invalid pubkey.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"
    Length: ${s[1].length} (expected 64)
    Format: ${s[1].startsWith("npub")?"bech32 (npub)":"unknown"}

p-tags MUST contain 64-character hex pubkeys.`,s[1].startsWith("npub")?`Use ndkUser.pubkey instead of npub:
    event.tags.push(['p', ndkUser.pubkey])
    event.tags.push(['p', 'npub1...'])`:"p-tags must contain valid hex pubkeys (64 characters, 0-9a-f)",!1)}})}function checkInvalidETags$1(r,t){r.getMatchingTags("e").forEach((s,o)=>{if(s[1]&&!/^[0-9a-f]{64}$/i.test(s[1])){const a=JSON.stringify(s),c=s[1].startsWith("note")||s[1].startsWith("nevent");t("tag-invalid-e-tag",`e-tag[${o}] has invalid event ID.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"
    Length: ${s[1].length} (expected 64)
    Format: ${c?"bech32 (note/nevent)":"unknown"}

e-tags MUST contain 64-character hex event IDs.`,c?`Use event.id instead of bech32:
    event.tags.push(['e', referencedEvent.id])
    event.tags.push(['e', 'note1...'])`:"e-tags must contain valid hex event IDs (64 characters, 0-9a-f)",!1)}})}function checkManualReplyMarkers$1(r,t,n){if(r.kind!==1||n.has(r))return;const s=r.tags.filter(o=>o[0]==="e"&&(o[3]==="reply"||o[3]==="root"));if(s.length>0){const o=s.map((a,c)=>`   ${c+1}. ${JSON.stringify(a)}`).join(`
`);t("event-manual-reply-markers",`Event has ${s.length} e-tag(s) with manual reply/root markers.

 Your tags with markers:
${o}

  Manual reply markers detected! This will cause incorrect threading.`,`Reply events MUST be created using .reply():

    CORRECT:
   const replyEvent = originalEvent.reply();
   replyEvent.content = 'good point!';
   await replyEvent.publish();

    WRONG:
   event.tags.push(['e', eventId, '', 'reply']);

NDK handles all reply threading automatically - never add reply/root markers manually.`)}}function checkHashtagsWithPrefix$1(r,t){r.getMatchingTags("t").forEach((s,o)=>{if(s[1]&&s[1].startsWith("#")){const a=JSON.stringify(s);t("tag-hashtag-with-prefix",`t-tag[${o}] contains hashtag with # prefix.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"

Hashtag tags should NOT include the # symbol.`,`Remove the # prefix from hashtag tags:
    event.tags.push(['t', 'nostr'])
    event.tags.push(['t', '#nostr'])`,!1)}})}function checkReplaceableWithOldTimestamp$1(r,t){if(r.kind===void 0||r.kind===null||!r.created_at||!r.isReplaceable())return;const n=Math.floor(Date.now()/1e3),s=n-r.created_at;if(s>10){const a=Math.floor(s/60),c=a>0?`${a} minute${a!==1?"s":""}`:`${s} seconds`;t("event-replaceable-old-timestamp",`Publishing a replaceable event with an old created_at timestamp.

 Event details:
    kind: ${r.kind} (replaceable)
    created_at: ${r.created_at}
    age: ${c} old
    current time: ${n}

  This is wrong and will be rejected by relays.`,`For replaceable events, use publishReplaceable():

    CORRECT:
   await event.publishReplaceable();
   // Automatically updates created_at to now

    WRONG:
   await event.publish();
   // Uses old created_at`)}}function signing$1(r,t,n,s){checkMissingKind$1(r,t),checkContentIsObject$1(r,t),checkCreatedAtMilliseconds$1(r,t),checkInvalidPTags$1(r,t),checkInvalidETags$1(r,t),checkHashtagsWithPrefix$1(r,t),checkManualReplyMarkers$1(r,n,s)}function publishing$1(r,t){checkReplaceableWithOldTimestamp$1(r,t)}function isNip33Pattern$1(r){const t=Array.isArray(r)?r:[r];if(t.length!==1)return!1;const n=t[0];return n.kinds&&Array.isArray(n.kinds)&&n.kinds.length===1&&n.authors&&Array.isArray(n.authors)&&n.authors.length===1&&n["#d"]&&Array.isArray(n["#d"])&&n["#d"].length===1}function isReplaceableEventFilter$1(r){const t=Array.isArray(r)?r:[r];return t.length===0?!1:t.every(n=>!n.kinds||!Array.isArray(n.kinds)||n.kinds.length===0||!n.authors||!Array.isArray(n.authors)||n.authors.length===0?!1:n.kinds.every(o=>o===0||o===3||o>=1e4&&o<=19999))}function formatFilter$1(r){return JSON.stringify(r,null,2).split(`
`).map((n,s)=>s===0?n:`   ${n}`).join(`
`)}function fetchingEvents$1(r,t,n,s,o){if(o(),t?.cacheUsage==="ONLY_CACHE")return;const a=Array.isArray(r)?r:[r],c=a.map(formatFilter$1).join(`

   ---

   `);if(isNip33Pattern$1(r))a[0],n("fetch-events-usage",`For fetching a NIP-33 addressable event, use fetchEvent() with the naddr directly.

 Your filter:
   `+c+`

   BAD:  const decoded = nip19.decode(naddr);
           const events = await ndk.fetchEvents({
             kinds: [decoded.data.kind],
             authors: [decoded.data.pubkey],
             "#d": [decoded.data.identifier]
           });
           const event = Array.from(events)[0];

   GOOD: const event = await ndk.fetchEvent(naddr);
   GOOD: const event = await ndk.fetchEvent('naddr1...');

fetchEvent() handles naddr decoding automatically and returns the event directly.`);else{if(isReplaceableEventFilter$1(r))return;{if(!s())return;let f="";const g=a.some(L=>L.limit!==void 0),b=new Set(a.flatMap(L=>L.kinds||[])).size,_=new Set(a.flatMap(L=>L.authors||[])).size;if(g){const L=Math.max(...a.map(q=>q.limit||0));f+=`
    Limit: ${L} event${L!==1?"s":""}`}b>0&&(f+=`
    Kinds: ${b} type${b!==1?"s":""}`),_>0&&(f+=`
    Authors: ${_} author${_!==1?"s":""}`),n("fetch-events-usage",`fetchEvents() is a BLOCKING operation that waits for EOSE.
In most cases, you should use subscribe() instead.

 Your filter`+(a.length>1?"s":"")+`:
   `+c+(f?`

 Filter analysis:`+f:"")+`

   BAD:  const events = await ndk.fetchEvents(filter);
   GOOD: ndk.subscribe(filter, { onEvent: (e) => ... });

Only use fetchEvents() when you MUST block until data arrives.`,"For one-time queries, use fetchEvent() instead of fetchEvents() when expecting a single result.")}}}var GuardrailCheckId$1={NDK_NO_CACHE:"ndk-no-cache",FILTER_BECH32_IN_ARRAY:"filter-bech32-in-array",FILTER_INVALID_HEX:"filter-invalid-hex",FILTER_ONLY_LIMIT:"filter-only-limit",FILTER_EMPTY:"filter-empty",FILTER_SINCE_AFTER_UNTIL:"filter-since-after-until",FILTER_INVALID_A_TAG:"filter-invalid-a-tag",FILTER_HASHTAG_WITH_PREFIX:"filter-hashtag-with-prefix"};function checkCachePresence$1(r,t){t(GuardrailCheckId$1.NDK_NO_CACHE)&&setTimeout(()=>{if(!r.cacheAdapter){const o=`
 AI_GUARDRAILS WARNING: NDK initialized without a cache adapter. Apps perform significantly better with caching.

 ${typeof window<"u"?"Consider using @nostr-dev-kit/ndk-cache-dexie or @nostr-dev-kit/ndk-cache-sqlite-wasm":"Consider using @nostr-dev-kit/ndk-cache-redis or @nostr-dev-kit/ndk-cache-sqlite"}

 To disable this check:
   ndk.aiGuardrails.skip('${GuardrailCheckId$1.NDK_NO_CACHE}')
   or set: ndk.aiGuardrails = { skip: new Set(['${GuardrailCheckId$1.NDK_NO_CACHE}']) }`;console.warn(o)}},2500)}var AIGuardrails$1=class{enabled=!1;skipSet=new Set;extensions=new Map;_nextCallDisabled=null;_replyEvents=new WeakSet;_fetchEventsCount=0;_subscribeCount=0;constructor(t=!1){this.setMode(t)}register(t,n){this.extensions.has(t)&&console.warn(`AIGuardrails: Extension '${t}' already registered, overwriting`);const s={};for(const[o,a]of Object.entries(n))typeof a=="function"&&(s[o]=(...c)=>{this.enabled&&a(...c,this.shouldCheck.bind(this),this.error.bind(this),this.warn.bind(this))});this.extensions.set(t,s),this[t]=s}setMode(t){typeof t=="boolean"?(this.enabled=t,this.skipSet.clear()):t&&typeof t=="object"&&(this.enabled=!0,this.skipSet=t.skip||new Set)}isEnabled(){return this.enabled}shouldCheck(t){return!(!this.enabled||this.skipSet.has(t)||this._nextCallDisabled==="all"||this._nextCallDisabled&&this._nextCallDisabled.has(t))}skip(t){this.skipSet.add(t)}enable(t){this.skipSet.delete(t)}getSkipped(){return Array.from(this.skipSet)}captureAndClearNextCallDisabled(){const t=this._nextCallDisabled;return this._nextCallDisabled=null,t}incrementFetchEventsCount(){this._fetchEventsCount++}incrementSubscribeCount(){this._subscribeCount++}shouldWarnAboutFetchEventsRatio(){const t=this._fetchEventsCount+this._subscribeCount;return t<=6?!1:this._fetchEventsCount/t>.5}error(t,n,s,o=!0){if(!this.shouldCheck(t))return;const a=this.formatMessage(t,"ERROR",n,s,o);throw console.error(a),new Error(a)}warn(t,n,s){if(!this.shouldCheck(t))return;const o=this.formatMessage(t,"WARNING",n,s,!0);throw console.error(o),new Error(o)}formatMessage(t,n,s,o,a=!0){let c=`
 AI_GUARDRAILS ${n}: ${s}`;return o&&(c+=`

 ${o}`),a&&(c+=`

 To disable this check:
   ndk.guardrailOff('${t}').yourMethod()  // For one call`,c+=`
   ndk.aiGuardrails.skip('${t}')  // Permanently`,c+=`
   or set: ndk.aiGuardrails = { skip: new Set(['${t}']) }`),c}ndkInstantiated(t){this.enabled&&checkCachePresence$1(t,this.shouldCheck.bind(this))}ndk={fetchingEvents:(t,n)=>{this.enabled&&fetchingEvents$1(t,n,this.warn.bind(this),this.shouldWarnAboutFetchEventsRatio.bind(this),this.incrementFetchEventsCount.bind(this))}};event={signing:t=>{this.enabled&&signing$1(t,this.error.bind(this),this.warn.bind(this),this._replyEvents)},publishing:t=>{this.enabled&&publishing$1(t,this.warn.bind(this))},received:(t,n)=>{this.enabled},creatingReply:t=>{this.enabled&&this._replyEvents.add(t)}};subscription={created:(t,n)=>{this.enabled&&this.incrementSubscribeCount()}};relay={connected:t=>{this.enabled}}};function processFilters$1(r,t="validate",n,s){if(t==="ignore")return r;const o=[],a=r.map((c,f)=>(s?.aiGuardrails.isEnabled()&&runAIGuardrailsForFilter$1(c,f,s),processFilter$1(c,t,f,o,n)));if(t==="validate"&&o.length>0)throw new Error(`Invalid filter(s) detected:
${o.join(`
`)}`);return a}function processFilter$1(r,t,n,s,o){const a=t==="validate",c=a?r:{...r};if(r.ids){const f=[];r.ids.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].ids[${b}] is undefined`):o?.(`Fixed: Removed undefined value at ids[${b}]`):typeof g!="string"?a?s.push(`Filter[${n}].ids[${b}] is not a string (got ${typeof g})`):o?.(`Fixed: Removed non-string value at ids[${b}] (was ${typeof g})`):isValidHex64$2(g)?f.push(g):a?s.push(`Filter[${n}].ids[${b}] is not a valid 64-char hex string: "${g}"`):o?.(`Fixed: Removed invalid hex string at ids[${b}]`)}),a||(c.ids=f.length>0?f:void 0)}if(r.authors){const f=[];r.authors.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].authors[${b}] is undefined`):o?.(`Fixed: Removed undefined value at authors[${b}]`):typeof g!="string"?a?s.push(`Filter[${n}].authors[${b}] is not a string (got ${typeof g})`):o?.(`Fixed: Removed non-string value at authors[${b}] (was ${typeof g})`):isValidHex64$2(g)?f.push(g):a?s.push(`Filter[${n}].authors[${b}] is not a valid 64-char hex pubkey: "${g}"`):o?.(`Fixed: Removed invalid hex pubkey at authors[${b}]`)}),a||(c.authors=f.length>0?f:void 0)}if(r.kinds){const f=[];r.kinds.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].kinds[${b}] is undefined`):o?.(`Fixed: Removed undefined value at kinds[${b}]`):typeof g!="number"?a?s.push(`Filter[${n}].kinds[${b}] is not a number (got ${typeof g})`):o?.(`Fixed: Removed non-number value at kinds[${b}] (was ${typeof g})`):Number.isInteger(g)?g<0||g>65535?a?s.push(`Filter[${n}].kinds[${b}] is out of valid range (0-65535): ${g}`):o?.(`Fixed: Removed out-of-range kind at kinds[${b}]: ${g}`):f.push(g):a?s.push(`Filter[${n}].kinds[${b}] is not an integer: ${g}`):o?.(`Fixed: Removed non-integer value at kinds[${b}]: ${g}`)}),a||(c.kinds=f.length>0?f:void 0)}for(const f in r)if(f.startsWith("#")&&f.length===2){const g=r[f];if(Array.isArray(g)){const b=[];g.forEach((_,L)=>{_===void 0?a?s.push(`Filter[${n}].${f}[${L}] is undefined`):o?.(`Fixed: Removed undefined value at ${f}[${L}]`):typeof _!="string"?a?s.push(`Filter[${n}].${f}[${L}] is not a string (got ${typeof _})`):o?.(`Fixed: Removed non-string value at ${f}[${L}] (was ${typeof _})`):(f==="#e"||f==="#p")&&!isValidHex64$2(_)?a?s.push(`Filter[${n}].${f}[${L}] is not a valid 64-char hex string: "${_}"`):o?.(`Fixed: Removed invalid hex string at ${f}[${L}]`):b.push(_)}),a||(c[f]=b.length>0?b:void 0)}}return a||Object.keys(c).forEach(f=>{c[f]===void 0&&delete c[f]}),c}function runAIGuardrailsForFilter$1(r,t,n){const s=n.aiGuardrails,o=JSON.stringify(r,null,2);if(Object.keys(r).length===1&&r.limit!==void 0&&s.error(GuardrailCheckId$1.FILTER_ONLY_LIMIT,`Filter[${t}] contains only 'limit' without any filtering criteria.

 Your filter:
${o}

  This will fetch random events from relays without any criteria.`,`Add filtering criteria:
    { kinds: [1], limit: 10 }
    { authors: [pubkey], limit: 10 }
    { limit: 10 }`),Object.keys(r).length===0&&s.error(GuardrailCheckId$1.FILTER_EMPTY,`Filter[${t}] is empty.

 Your filter:
${o}

  This will request ALL events from relays, which is never what you want.`,"Add filtering criteria like 'kinds', 'authors', or tags.",!1),r.since!==void 0&&r.until!==void 0&&r.since>r.until){const c=new Date(r.since*1e3).toISOString(),f=new Date(r.until*1e3).toISOString();s.error(GuardrailCheckId$1.FILTER_SINCE_AFTER_UNTIL,`Filter[${t}] has 'since' AFTER 'until'.

 Your filter:
${o}

 since: ${r.since} (${c})
 until: ${r.until} (${f})

No events can match this time range!`,"'since' must be BEFORE 'until'. Both are Unix timestamps in seconds.",!1)}const a=/^n(addr|event|ote|pub|profile)1/;r.ids&&r.ids.forEach((c,f)=>{typeof c=="string"&&(a.test(c)?s.error(GuardrailCheckId$1.FILTER_BECH32_IN_ARRAY,`Filter[${t}].ids[${f}] contains bech32: "${c}". IDs must be hex, not bech32.`,'Use filterFromId() to decode bech32 first: import { filterFromId } from "@nostr-dev-kit/ndk"',!1):isValidHex64$2(c)||s.error(GuardrailCheckId$1.FILTER_INVALID_HEX,`Filter[${t}].ids[${f}] is not a valid 64-char hex string: "${c}"`,`Event IDs must be 64-character hexadecimal strings. Invalid IDs often come from corrupted data in user-generated lists. Always validate hex strings before using them in filters:

   const validIds = ids.filter(id => /^[0-9a-f]{64}$/i.test(id));`,!1))}),r.authors&&r.authors.forEach((c,f)=>{typeof c=="string"&&(a.test(c)?s.error(GuardrailCheckId$1.FILTER_BECH32_IN_ARRAY,`Filter[${t}].authors[${f}] contains bech32: "${c}". Authors must be hex pubkeys, not npub.`,"Use ndkUser.pubkey instead. Example: { authors: [ndkUser.pubkey] }",!1):isValidHex64$2(c)||s.error(GuardrailCheckId$1.FILTER_INVALID_HEX,`Filter[${t}].authors[${f}] is not a valid 64-char hex pubkey: "${c}"`,`Kind:3 follow lists can contain invalid entries like labels ("Follow List"), partial strings ("highlig"), or other corrupted data. You MUST validate all pubkeys before using them in filters.

   Example:
   const validPubkeys = pubkeys.filter(p => /^[0-9a-f]{64}$/i.test(p));
   ndk.subscribe({ authors: validPubkeys, kinds: [1] });`,!1))});for(const c in r)if(c.startsWith("#")&&c.length===2){const f=r[c];Array.isArray(f)&&f.forEach((g,b)=>{typeof g=="string"&&(c==="#e"||c==="#p")&&(a.test(g)?s.error(GuardrailCheckId$1.FILTER_BECH32_IN_ARRAY,`Filter[${t}].${c}[${b}] contains bech32: "${g}". Tag values must be decoded.`,"Use filterFromId() or nip19.decode() to get the hex value first.",!1):isValidHex64$2(g)||s.error(GuardrailCheckId$1.FILTER_INVALID_HEX,`Filter[${t}].${c}[${b}] is not a valid 64-char hex string: "${g}"`,`${c==="#e"?"Event IDs":"Public keys"} in tag filters must be 64-character hexadecimal strings. Kind:3 follow lists and other user-generated content can contain invalid data. Always filter before using:

   const validValues = values.filter(v => /^[0-9a-f]{64}$/i.test(v));`,!1))})}r["#a"]&&r["#a"]?.forEach((f,g)=>{if(typeof f=="string")if(!/^\d+:[0-9a-f]{64}:.*$/.test(f))s.error(GuardrailCheckId$1.FILTER_INVALID_A_TAG,`Filter[${t}].#a[${g}] has invalid format: "${f}". Must be "kind:pubkey:d-tag".`,'Example: "30023:fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52:my-article"',!1);else{const b=Number.parseInt(f.split(":")[0],10);(b<3e4||b>39999)&&s.error(GuardrailCheckId$1.FILTER_INVALID_A_TAG,`Filter[${t}].#a[${g}] uses non-addressable kind ${b}: "${f}". #a filters are only for addressable events (kinds 30000-39999).`,`Addressable events include:
    30000-30039: Parameterized Replaceable Events (profiles, settings, etc.)
    30040-39999: Other addressable events

For regular events (kind ${b}), use:
    #e filter for specific event IDs
    kinds + authors filters for event queries`,!1)}}),r["#t"]&&r["#t"]?.forEach((f,g)=>{typeof f=="string"&&f.startsWith("#")&&s.error(GuardrailCheckId$1.FILTER_HASHTAG_WITH_PREFIX,`Filter[${t}].#t[${g}] contains hashtag with # prefix: "${f}". Hashtag values should NOT include the # symbol.`,`Remove the # prefix from hashtag filters:
    { "#t": ["nostr"] }
    { "#t": ["#nostr"] }`,!1)})}function queryFullyFilled$1(r){return!!(filterIncludesIds$1(r.filter)&&resultHasAllRequestedIds$1(r))}function filterIncludesIds$1(r){return!!r.ids}function resultHasAllRequestedIds$1(r){const t=r.filter.ids;return!!t&&t.length===r.eventFirstSeen.size}function filterFromId$1(r){let t;if(r.match(NIP33_A_REGEX$1)){const[n,s,o]=r.split(":"),a={authors:[s],kinds:[Number.parseInt(n)]};return o&&(a["#d"]=[o]),a}if(r.match(BECH32_REGEX3))try{switch(t=nip19_exports$4.decode(r),t.type){case"nevent":{const n={ids:[t.data.id]};return t.data.author&&(n.authors=[t.data.author]),t.data.kind&&(n.kinds=[t.data.kind]),n}case"note":return{ids:[t.data]};case"naddr":{const n={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(n["#d"]=[t.data.identifier]),n}}}catch(n){console.error("Error decoding",r,n)}return{ids:[r]}}function isNip33AValue$1(r){return r.match(NIP33_A_REGEX$1)!==null}var NIP33_A_REGEX$1=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX3=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32$1(r,t){try{const n=nip19_exports$4.decode(r);if(["naddr","nevent"].includes(n?.type)){const s=n.data;if(s?.relays)return s.relays.map(o=>new NDKRelay$2(o,t.relayAuthDefaultPolicy,t))}}catch{}return[]}var defaultOpts$1={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"],includeMuted:!1},NDKSubscription$1=class extends import_tseep4.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;exclusiveRelay=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;mostRecentCacheEventTimestamp;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;cacheUnconstrainFilter;constructor(t,n,s,o){super(),this.ndk=t,this.opts={...defaultOpts$1,...s||{}},this.pool=this.opts.pool||t.pool;const a=Array.isArray(n)?n:[n],c=t.filterValidationMode==="validate"?"validate":t.filterValidationMode==="fix"?"fix":"ignore";if(this.filters=processFilters$1(a,c,t.debug,t),this.filters.length===0)throw new Error("Subscription must have at least one filter");this.subId=o||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=t.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet$2.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter,this.exclusiveRelay=this.opts.exclusiveRelay||!1,this.opts.onEvent&&this.on("event",this.opts.onEvent),this.opts.onEose&&this.on("eose",this.opts.onEose),this.opts.onClose&&this.on("close",this.opts.onClose)}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters?.keys()).filter(n=>!this.eosesSeen.has(this.pool.getRelay(n,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return this.opts.addSinceFromCache?!0:this.opts?.cacheUsage==="ONLY_RELAY"?!1:(this.filters.some(n=>n.kinds?.some(s=>kindIsEphemeral$1(s))),!0)}shouldQueryRelays(){return this.opts?.cacheUsage!=="ONLY_CACHE"}shouldWaitForCache(){return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&this.opts.cacheUsage!=="PARALLEL"}start(t=!0){let n;const s=a=>{for(const c of a)c.created_at&&(!this.mostRecentCacheEventTimestamp||c.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=c.created_at),this.eventReceived(c,void 0,!0,!1);t||(n=a)},o=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(n=this.startWithCache(),n instanceof Promise?this.shouldWaitForCache()?(n.then(a=>{if(s(a),queryFullyFilled$1(this)){this.emit("eose",this);return}o()}),null):(n.then(a=>{s(a),this.shouldQueryRelays()||this.emit("eose",this)}),this.shouldQueryRelays()&&o(),null):(s(n),queryFullyFilled$1(this)?this.emit("eose",this):o(),n)):(o(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{if(this.relayFilters?.has(t.url))return;calculateRelaySetsFromFilters$1(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}onStopped;stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.onStopped?.()}hasAuthorsFilter(){return this.filters.some(t=>t.authors?.length)}startWithCache(){return this.ndk.cacheAdapter?.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let t=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const n=this.mostRecentCacheEventTimestamp+1;t=t.map(s=>({...s,since:Math.max(s.since||0,n)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters$1(this.ndk,t,this.pool,this.opts.relayGoalPerAuthor);else{this.relayFilters=new Map;for(const n of this.relaySet.relays)this.relayFilters.set(n.url,t)}for(const[n,s]of this.relayFilters)this.pool.getRelay(n,!0,!0,s).subscribe(this,s)}refreshRelayConnections(){if(this.relaySet&&this.relaySet.relays.size>0)return;const t=calculateRelaySetsFromFilters$1(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor);for(const[n,s]of t)this.relayFilters?.has(n)||(this.relayFilters?.set(n,s),this.pool.getRelay(n,!0,!0,s).subscribe(this,s))}eventReceived(t,n,s=!1,o=!1){const a=t.id,c=this.eventFirstSeen.has(a);let f;if(t instanceof NDKEvent$2&&(f=t),c){const g=Date.now()-(this.eventFirstSeen.get(a)||0);if(this.emit("event:dup",t,n,g,this,s,o),this.opts?.onEventDup&&this.opts.onEventDup(t,n,g,this,s,o),!s&&!o&&n&&this.ndk.cacheAdapter?.setEventDup&&!this.opts.dontSaveToCache&&(f??=t instanceof NDKEvent$2?t:new NDKEvent$2(this.ndk,t),this.ndk.cacheAdapter.setEventDup(f,n)),n){const b=verifiedSignatures$2.get(a);if(b&&typeof b=="string")if(t.sig===b)n.addValidatedEvent();else{const _=t instanceof NDKEvent$2?t:new NDKEvent$2(this.ndk,t);this.ndk.reportInvalidSignature(_,n)}}}else{if(f??=new NDKEvent$2(this.ndk,t),f.ndk=this.ndk,f.relay=n,!s&&!o){if(!this.skipValidation&&!f.isValid){this.debug("Event failed validation %s from relay %s",a,n?.url);return}if(n)if(n.shouldValidateEvent()&&!this.skipVerification)if(f.relay=n,this.ndk.asyncSigVerification)f.verifySignature(!0);else{if(!f.verifySignature(!0)){this.debug("Event failed signature validation",t),this.ndk.reportInvalidSignature(f,n);return}n.addValidatedEvent()}else n.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(f,this.filters,n)}if(!this.opts.includeMuted&&this.ndk.muteFilter&&this.ndk.muteFilter(f)){this.debug("Event muted, skipping");return}(!o||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(this.opts?.wrap??!1,f,n,s,o),this.eventFirstSeen.set(a,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(t,n,s,o,a){const c=t?wrapEvent3(n):n;c instanceof Promise?c.then(f=>this.emitEvent(!1,f,s,o,a)):c&&this.emit("event",c,s,this,o,a)}closedReceived(t,n){this.emit("closed",t,n)}eoseTimeout;eosed=!1;eoseReceived(t){this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const s=this.eosesSeen.size===this.relayFilters?.size,o=queryFullyFilled$1(this),a=c=>{this.debug("Performing EOSE: %s %d",c,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,this.opts?.closeOnEose&&this.stop())};if(o||s)a("query filled or seen all");else if(this.relayFilters){let c=1e3;const f=new Set(this.pool.connectedRelays().map(_=>_.url)),g=Array.from(this.relayFilters.keys()).filter(_=>f.has(_));if(g.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const b=this.eosesSeen.size/g.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:b,seen:this.eosesSeen.size,total:g.length}),this.eosesSeen.size>=2&&b>=.5){if(c=c*(1-b),c===0){a("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const _=()=>{n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,n!==void 0&&n<20?this.eoseTimeout=setTimeout(_,c):a(`send eose timeout: ${c}`)};this.eoseTimeout=setTimeout(_,c)}}}},kindIsEphemeral$1=r=>r>=2e4&&r<3e4;async function follows$2(r,t,n=3){if(!this.ndk)throw new Error("NDK not set");const s=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},r||{groupable:!1});if(s){const o=new Set;return s.tags.forEach(a=>{a[0]==="p"&&a[1]&&isValidPubkey$2(a[1])&&o.add(a[1])}),t&&this.ndk?.outboxTracker?.trackUsers(Array.from(o)),[...o].reduce((a,c)=>{const f=new NDKUser$2({pubkey:c});return f.ndk=this.ndk,a.add(f),a},new Set)}return new Set}var NIP05_REGEX2=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For$2(r,t,n=fetch,s={}){return await r.queuesNip05.add({id:t,func:async()=>{if(r.cacheAdapter?.loadNip05){const g=await r.cacheAdapter.loadNip05(t);if(g!=="missing"){if(g){const b=new NDKUser$2({pubkey:g.pubkey,relayUrls:g.relays,nip46Urls:g.nip46});return b.ndk=r,b}if(s.cache!=="no-cache")return null}}const o=t.match(NIP05_REGEX2);if(!o)return null;const[a,c="_",f]=o;try{const g=await n(`https://${f}/.well-known/nostr.json?name=${c}`,s),{names:b,relays:_,nip46:L}=parseNIP05Result$2(await g.json()),q=b[c.toLowerCase()];let X=null;return q&&(X={pubkey:q,relays:_?.[q],nip46:L?.[q]}),r?.cacheAdapter?.saveNip05&&r.cacheAdapter.saveNip05(t,X),X}catch(g){return r?.cacheAdapter?.saveNip05&&r?.cacheAdapter.saveNip05(t,null),console.error("Failed to fetch NIP05 for",t,g),null}}})}function parseNIP05Result$2(r){const t={names:{}};for(const[n,s]of Object.entries(r.names))typeof n=="string"&&typeof s=="string"&&(t.names[n.toLowerCase()]=s);if(r.relays){t.relays={};for(const[n,s]of Object.entries(r.relays))typeof n=="string"&&Array.isArray(s)&&(t.relays[n]=s.filter(o=>typeof o=="string"))}if(r.nip46){t.nip46={};for(const[n,s]of Object.entries(r.nip46))typeof n=="string"&&Array.isArray(s)&&(t.nip46[n]=s.filter(o=>typeof o=="string"))}return t}function profileFromEvent$2(r){const t={};let n;try{n=JSON.parse(r.content)}catch(s){throw new Error(`Failed to parse profile event: ${s}`)}t.profileEvent=JSON.stringify(r.rawEvent());for(const s of Object.keys(n))switch(s){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.picture=n.picture||n.image,t.image=t.picture;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"website":t.website=n.website;break;default:t[s]=n[s];break}return t.created_at=r.created_at,t}function serializeProfile$2(r){const t={};for(const[n,s]of Object.entries(r))switch(n){case"username":case"name":t.name=s;break;case"displayName":t.display_name=s;break;case"image":case"picture":t.picture=s;break;case"bio":case"about":t.about=s;break;default:t[n]=s;break}return JSON.stringify(t)}var NDKUser$2=class Ls{ndk;profile;profileEvent;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){if(t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls),t.nprofile)try{const n=nip19_exports$4.decode(t.nprofile);n.type==="nprofile"&&(this._pubkey=n.data.pubkey,n.data.relays&&n.data.relays.length>0&&this.relayUrls.push(...n.data.relays))}catch(n){console.error("Failed to decode nprofile",n)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports$4.npubEncode(this.pubkey)}return this._npub}get nprofile(){const t=this.profileEvent?.onRelays?.map(n=>n.url);return nip19_exports$4.nprofileEncode({pubkey:this.pubkey,relays:t})}set npub(t){this._npub=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports$4.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}filter(){return{"#p":[this.pubkey]}}async getZapInfo(t){if(!this.ndk)throw new Error("No NDK instance found");const n=async c=>{if(!t)return c;let f;const g=new Promise((b,_)=>{f=setTimeout(()=>_(new Error("Timeout")),t)});try{const b=await Promise.race([c,g]);return f&&clearTimeout(f),b}catch(b){if(b instanceof Error&&b.message==="Timeout")try{return await c}catch{return}return}},[s,o]=await Promise.all([n(this.fetchProfile()),n(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),a=new Map;if(o){const c=NDKCashuMintList$2.from(o);c.mints.length>0&&a.set("nip61",{mints:c.mints,relays:c.relays,p2pk:c.p2pk})}if(s){const{lud06:c,lud16:f}=s;a.set("nip57",{lud06:c,lud16:f})}return a}static async fromNip05(t,n,s=!1){if(!n)throw new Error("No NDK instance found");const o={};s&&(o.cache="no-cache");const a=await getNip05For$2(n,t,n?.httpFetch,o);if(a){const c=new Ls({pubkey:a.pubkey,relayUrls:a.relays,nip46Urls:a.nip46});return c.ndk=n,c}}async fetchProfile(t,n=!1){if(!this.ndk)throw new Error("NDK not set");let s=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&t?.cacheUsage!=="ONLY_RELAY"){let o=null;if(this.ndk.cacheAdapter.fetchProfileSync?o=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(o=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),o)return this.profile=o,o}return t??={},t.cacheUsage??="ONLY_RELAY",t.closeOnEose??=!0,t.groupable??=!0,t.groupableDelay??=250,s||(s=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},t)),s?(this.profile=profileFromEvent$2(s),n&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}follows=follows$2.bind(this);async followSet(t,n,s=3){const o=await this.follows(t,n,s);return new Set(Array.from(o).map(a=>a.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){const n=[["p",this.pubkey]];return t&&n[0].push("",t),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent$2(this.ndk,{kind:0,content:serializeProfile$2(this.profile)}).publish()}async follow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey;if(Array.from(n).some(f=>typeof f=="string"?f===o:f.pubkey===o))return!1;n.add(t);const c=new NDKEvent$2(this.ndk,{kind:s});for(const f of n)typeof f=="string"?c.tags.push(["p",f]):c.tag(f);return await c.publish(),!0}async unfollow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey,a=new Set;let c=!1;for(const g of n)(typeof g=="string"?g:g.pubkey)!==o?a.add(g):c=!0;if(!c)return!1;const f=new NDKEvent$2(this.ndk,{kind:s});for(const g of a)typeof g=="string"?f.tags.push(["p",g]):f.tag(g);return await f.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const n=await getNip05For$2(this.ndk,t);return n===null?null:n.pubkey===this.pubkey}},signerRegistry$2=new Map;function registerSigner$2(r,t){signerRegistry$2.set(r,t)}var NDKPrivateKeySigner$2=class $i{_user;_privateKey;_pubkey;constructor(t,n){if(typeof t=="string")if(t.startsWith("nsec1")){const{type:s,data:o}=nip19_exports$4.decode(t);if(s==="nsec")this._privateKey=o;else throw new Error("Invalid private key provided.")}else if(t.length===64)this._privateKey=hexToBytes3(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._pubkey=getPublicKey$2(this._privateKey),n&&(this._user=n.getUser({pubkey:this._pubkey})),this._user??=new NDKUser$2({pubkey:this._pubkey})}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex3(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports$4.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports$4.npubEncode(this._pubkey)}encryptToNcryptsec(t,n=16,s=2){if(!this._privateKey)throw new Error("Private key not available");return encrypt3(this._privateKey,t,n,s)}static generate(){const t=generateSecretKey$2();return new $i(t)}static fromNcryptsec(t,n,s){const o=decrypt3(t,n);return new $i(o,s)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent$2(t,this._privateKey).sig}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&n.push("nip04"),(!t||t==="nip44")&&n.push("nip44"),n}async encrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports$2.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports$2.v2.encrypt(n,a)}return await nip04_exports$2.encrypt(this._privateKey,o,n)}async decrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports$2.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports$2.v2.decrypt(n,a)}return await nip04_exports$2.decrypt(this._privateKey,o,n)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const t={type:"private-key",payload:this.privateKey};return JSON.stringify(t)}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${s.type}`);if(!s.payload||typeof s.payload!="string")throw new Error("Invalid payload content for private-key signer");return new $i(s.payload,n)}};registerSigner$2("private-key",NDKPrivateKeySigner$2);function dedup$1(r,t){return r.created_at>t.created_at?r:t}async function getRelayListForUser$1(r,t){return(await getRelayListForUsers$1([r],t)).get(r)}async function getRelayListForUsers$1(r,t,n=!1,s=1e3,o){const a=t.outboxPool||t.pool,c=new Set;for(const q of a.relays.values())c.add(q);if(o)for(const q of o.values())for(const X of q){const te=a.getRelay(X,!0,!0);te&&c.add(te)}const f=new Map,g=new Map,b=new NDKRelaySet$2(c,t);if(t.cacheAdapter?.locking&&!n){const q=await t.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(r))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const X of q)X.kind===10002&&f.set(X.pubkey,NDKRelayList$2.from(X));for(const X of q)if(X.kind===3){if(f.has(X.pubkey))continue;const te=relayListFromKind3$1(t,X);te&&g.set(X.pubkey,te)}r=r.filter(X=>!f.has(X)&&!g.has(X))}if(r.length===0)return f;const _=new Map,L=new Map;return new Promise(q=>{let X=!1;(async()=>{const ne={closeOnEose:!0,pool:a,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:b};b&&(ne.relaySet=b),t.subscribe({kinds:[3,10002],authors:r},ne,{onEvent:ze=>{if(ze.kind===10002){const Xe=_.get(ze.pubkey);if(Xe&&Xe.created_at>ze.created_at)return;_.set(ze.pubkey,ze)}else if(ze.kind===3){const Xe=L.get(ze.pubkey);if(Xe&&Xe.created_at>ze.created_at)return;L.set(ze.pubkey,ze)}},onEose:()=>{if(!X){X=!0,t.debug(`[getRelayListForUsers] EOSE - relayListEvents: ${_.size}, contactListEvents: ${L.size}`);for(const ze of _.values())f.set(ze.pubkey,NDKRelayList$2.from(ze));for(const ze of r){if(f.has(ze))continue;const Xe=L.get(ze);if(!Xe)continue;const He=relayListFromKind3$1(t,Xe);He&&f.set(ze,He)}t.debug(`[getRelayListForUsers] Returning ${f.size} relay lists for ${r.length} pubkeys`),q(f)}}});const Ce=Array.from(c).some(ze=>ze.status<=2),Le=Array.from(c).some(ze=>ze.status===4);let Ge=s;(Ce||Le)&&(Ge=s+3e3),t.debug(`[getRelayListForUsers] Setting fallback timeout to ${Ge}ms (disconnected: ${Ce}, connecting: ${Le})`,{pubkeys:r}),setTimeout(()=>{X||(X=!0,t.debug(`[getRelayListForUsers] Timeout reached, returning ${f.size} relay lists`),q(f))},Ge)})()})}var OutboxItem$1=class{type;relayUrlScores;readRelays;writeRelays;constructor(t){this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker$1=class extends import_tseep6.EventEmitter{data;ndk;debug;constructor(t){super(),this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new import_typescript_lru_cache2.LRUCache({maxSize:1e5,entryExpirationTimeInMS:120*1e3})}async trackUsers(t,n=!1){const s=[];for(let o=0;o<t.length;o+=400){const a=t.slice(o,o+400),c=a.map(g=>getKeyFromItem$1(g)).filter(g=>!this.data.has(g));if(c.length===0)continue;for(const g of c)this.data.set(g,new OutboxItem$1("user"));const f=new Map;for(const g of a)g instanceof NDKUser$2&&g.relayUrls.length>0&&f.set(g.pubkey,g.relayUrls);s.push(new Promise(g=>{getRelayListForUsers$1(c,this.ndk,n,1e3,f).then(b=>{this.debug(`Received relay lists for ${b.size} pubkeys out of ${c.length} requested`);for(const[_,L]of b){let q=this.data.get(_);if(q??=new OutboxItem$1("user"),L){if(q.readRelays=new Set(normalize3(L.readRelayUrls)),q.writeRelays=new Set(normalize3(L.writeRelayUrls)),this.ndk.relayConnectionFilter){for(const X of q.readRelays)this.ndk.relayConnectionFilter(X)||q.readRelays.delete(X);for(const X of q.writeRelays)this.ndk.relayConnectionFilter(X)||q.writeRelays.delete(X)}this.data.set(_,q),this.emit("user:relay-list-updated",_,q),this.debug(`Adding ${q.readRelays.size} read relays and ${q.writeRelays.size} write relays for ${_}`,L?.rawEvent())}}}).finally(g)}))}return Promise.all(s)}track(t,n,s=!0){const o=getKeyFromItem$1(t);n??=getTypeFromItem$1(t);let a=this.data.get(o);return a||(a=new OutboxItem$1(n),t instanceof NDKUser$2&&this.trackUsers([t])),a}};function getKeyFromItem$1(r){return r instanceof NDKUser$2?r.pubkey:r}function getTypeFromItem$1(r){return r instanceof NDKUser$2?"user":"kind"}function correctRelaySet$1(r,t){const n=t.connectedRelays();if(!Array.from(r.relays).some(o=>n.map(a=>a.url).includes(o.url)))for(const o of n)r.addRelay(o);if(n.length===0)for(const o of t.relays.values())r.addRelay(o);return r}var NDKSubscriptionManager$1=class{subscriptions;seenEvents=new import_typescript_lru_cache3.LRUCache({maxSize:1e4,entryExpirationTimeInMS:300*1e3});constructor(){this.subscriptions=new Map}add(t){this.subscriptions.set(t.internalId,t),t.onStopped,t.onStopped=()=>{this.subscriptions.delete(t.internalId)},t.on("close",()=>{this.subscriptions.delete(t.internalId)})}seenEvent(t,n){const s=this.seenEvents.get(t)||[];s.some(o=>o.url===n.url)||s.push(n),this.seenEvents.set(t,s)}dispatchEvent(t,n,s=!1){n&&this.seenEvent(t.id,n);const o=this.subscriptions.values(),a=[];for(const c of o)matchFilters$1(c.filters,t)&&a.push(c);for(const c of a){if(c.exclusiveRelay&&c.relaySet){let f=!1;if(s?f=!c.skipOptimisticPublishEvent:n?f=c.relaySet.relays.has(n):f=(this.seenEvents.get(t.id)||[]).some(b=>c.relaySet.relays.has(b)),!f){c.debug.extend("exclusive-relay")("Rejected event %s from %s (relay not in exclusive set)",t.id,n?.url||(s?"optimistic":"cache"));continue}}c.eventReceived(t,n,!1,s)}}},debug6$1=import_debug8.default("ndk:active-user");async function getUserRelayList$1(r){if(!this.autoConnectUserRelays)return;const t=await getRelayListForUser$1(r.pubkey,this);if(t){for(const n of t.relays){let s=this.pool.relays.get(n);s||(s=new NDKRelay$2(n,this.relayAuthDefaultPolicy,this),this.pool.addRelay(s))}return debug6$1("Connected to %d user relays",t.relays.length),t}}async function setActiveUser$1(r){if(!this.autoConnectUserRelays)return;const t=this.outboxPool||this.pool;t.connectedRelays.length>0?await getUserRelayList$1.call(this,r):t.once("connect",async()=>{await getUserRelayList$1.call(this,r)})}function getEntity$1(r){try{const t=nip19_exports$4.decode(r);return t.type==="npub"?npub$1(this,t.data):t.type==="nprofile"?nprofile$1(this,t.data):t}catch{return null}}function npub$1(r,t){return r.getUser({pubkey:t})}function nprofile$1(r,t){const n=r.getUser({pubkey:t.pubkey});return t.relays&&(n.relayUrls=t.relays),n}function isValidHint$1(r){if(!r||r==="")return!1;try{return new URL(r),!0}catch{return!1}}async function fetchEventFromTag$1(r,t,n,s={type:"timeout"}){const o=this.debug.extend("fetch-event-from-tag"),[a,c,f]=r;n={},o("fetching event from tag",r,n,s);const g=getRelaysForSync$2(this,t.pubkey);if(g&&g.size>0){o("fetching event from author relays %o",Array.from(g));const ne=NDKRelaySet$2.fromRelayUrls(Array.from(g),this),Ce=await this.fetchEvent(c,n,ne);if(Ce)return Ce}else o("no author relays found for %s",t.pubkey,t);const b=calculateRelaySetsFromFilters$1(this,[{ids:[c]}],this.pool);o("fetching event without relay hint",b);const _=await this.fetchEvent(c,n);if(_)return _;if(f&&f!==""){const ne=await this.fetchEvent(c,n,this.pool.getRelay(f,!0,!0,[{ids:[c]}]));if(ne)return ne}let L;const q=isValidHint$1(f)?this.pool.getRelay(f,!1,!0,[{ids:[c]}]):void 0,X=new Promise(ne=>{this.fetchEvent(c,n,q).then(ne)});if(!isValidHint$1(f)||s.type==="none")return X;const te=new Promise(async ne=>{const Ce=s.relaySet,Le=s.timeout??1500,Ge=new Promise(ze=>setTimeout(ze,Le));if(s.type==="timeout"&&await Ge,L)ne(L);else{o("fallback fetch triggered");const ze=await this.fetchEvent(c,n,Ce);ne(ze)}});switch(s.type){case"timeout":return Promise.race([X,te]);case"eose":return L=await X,L||te}}var Queue2=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(r,t){this.maxConcurrency=t}add(r){if(this.promises.has(r.id))return this.promises.get(r.id);const t=new Promise((n,s)=>{this.queue.push({...r,func:()=>r.func().then(o=>(n(o),o),o=>{throw s(o),o})}),this.process()});return this.promises.set(r.id,t),t.finally(()=>{this.promises.delete(r.id),this.processing.delete(r.id),this.process()}),t}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const r=this.queue.shift();!r||this.processing.has(r.id)||(this.processing.add(r.id),r.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS$1=["wss://purplepag.es/","wss://nos.lol/"];(class extends import_tseep5.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;muteFilter;relayConnectionFilter;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=.1;validationRatioFn;filterValidationMode="validate";subManager;aiGuardrails;_signatureVerificationFunction;_signatureVerificationWorker;signatureVerificationTimeMs=0;publishingFailureHandled=!1;pools=[];relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;_wallet;walletConfig;constructor(r={}){super(),this.debug=r.debug||import_debug7.default("ndk"),this.netDebug=r.netDebug,this._explicitRelayUrls=r.explicitRelayUrls||[],this.subManager=new NDKSubscriptionManager$1,this.pool=new NDKPool$2(r.explicitRelayUrls||[],this),this.pool.name="Main",this.pool.on("relay:auth",async(t,n)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,n)}),this.autoConnectUserRelays=r.autoConnectUserRelays??!0,this.clientName=r.clientName,this.clientNip89=r.clientNip89,this.relayAuthDefaultPolicy=r.relayAuthDefaultPolicy,r.enableOutboxModel!==!1&&(this.outboxPool=new NDKPool$2(r.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS$1,this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker$1(this),this.outboxTracker.on("user:relay-list-updated",(t,n)=>{this.debug(`Outbox relay list updated for ${t}`);for(const s of this.subManager.subscriptions.values())s.filters.some(a=>a.authors?.includes(t))&&typeof s.refreshRelayConnections=="function"&&(this.debug(`Refreshing relay connections for subscription ${s.internalId}`),s.refreshRelayConnections())})),this.signer=r.signer,this.cacheAdapter=r.cacheAdapter,this.muteFilter=r.muteFilter,this.relayConnectionFilter=r.relayConnectionFilter,r.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet$2.fromRelayUrls(r.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue2("zaps",3),this.queuesNip05=new Queue2("nip05",10),r.signatureVerificationWorker&&(this.signatureVerificationWorker=r.signatureVerificationWorker),r.signatureVerificationFunction&&(this.signatureVerificationFunction=r.signatureVerificationFunction),this.initialValidationRatio=r.initialValidationRatio||1,this.lowestValidationRatio=r.lowestValidationRatio||.1,this.validationRatioFn=r.validationRatioFn||this.defaultValidationRatioFn,this.filterValidationMode=r.filterValidationMode||"validate",this.aiGuardrails=new AIGuardrails$1(r.aiGuardrails||!1),this.aiGuardrails.ndkInstantiated(this);try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(r){this._explicitRelayUrls=r.map(normalizeRelayUrl$2),this.pool.relayUrls=r}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(r){this._signatureVerificationWorker=r,r?(signatureVerificationInit$1(r),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(r){this._signatureVerificationFunction=r,this.asyncSigVerification=!!r}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(r,t,n=!0){let s;return typeof r=="string"?s=new NDKRelay$2(r,t,this):s=r,this.pool.addRelay(s,n),this.explicitRelayUrls?.push(s.url),s}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(r){const t=this._activeUser?.pubkey!==r?.pubkey;this._activeUser=r,t&&this.emit("activeUser:change",r),r&&t&&setActiveUser$1.call(this,r)}get signer(){return this._signer}set signer(r){this._signer=r,r&&this.emit("signer:ready",r),r?.user().then(t=>{t.ndk=this,this.activeUser=t})}async connect(r){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await this._signer.relays?.(this)),this._signer.relays&&(await this._signer.relays(this)).forEach(s=>this.pool.addRelay(s)));const t=[this.pool.connect(r)];return this.outboxPool&&t.push(this.outboxPool.connect(r)),this.cacheAdapter?.initializeAsync&&t.push(this.cacheAdapter.initializeAsync(this)),Promise.allSettled(t).then(()=>{})}reportInvalidSignature(r,t){this.debug(`Invalid signature detected for event ${r.id}${t?` from relay ${t.url}`:""}`),this.emit("event:invalid-sig",r,t)}defaultValidationRatioFn(r,t,n){if(t<10)return this.initialValidationRatio;const s=Math.min(t/100,1),o=this.initialValidationRatio*(1-s)+this.lowestValidationRatio*s;return Math.max(o,this.lowestValidationRatio)}getUser(r){if(typeof r=="string")if(r.startsWith("npub1")){const{type:n,data:s}=nip19_exports$4.decode(r);if(n!=="npub")throw new Error(`Invalid npub: ${r}`);return this.getUser({pubkey:s})}else if(r.startsWith("nprofile1")){const{type:n,data:s}=nip19_exports$4.decode(r);if(n!=="nprofile")throw new Error(`Invalid nprofile: ${r}`);return this.getUser({pubkey:s.pubkey,relayUrls:s.relays})}else return this.getUser({pubkey:r});const t=new NDKUser$2(r);return t.ndk=this,t}async getUserFromNip05(r,t=!1){return NDKUser$2.fromNip05(r,this,t)}async fetchUser(r,t=!1){if(isValidNip05$1(r))return NDKUser$2.fromNip05(r,this,t);if(r.startsWith("npub1")){const{type:n,data:s}=nip19_exports$4.decode(r);if(n!=="npub")throw new Error(`Invalid npub: ${r}`);const o=new NDKUser$2({pubkey:s});return o.ndk=this,o}else if(r.startsWith("nprofile1")){const{type:n,data:s}=nip19_exports$4.decode(r);if(n!=="nprofile")throw new Error(`Invalid nprofile: ${r}`);const o=new NDKUser$2({pubkey:s.pubkey,relayUrls:s.relays});return o.ndk=this,o}else{const n=new NDKUser$2({pubkey:r});return n.ndk=this,n}}subscribe(r,t,n=!0,s=!0){let o=t?.relaySet,a=s;n instanceof NDKRelaySet$2?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),o=n,a=s):(typeof n=="boolean"||typeof n=="object")&&(a=n);let c;const f={relaySet:o,...t};a&&typeof a=="object"&&(a.onEvent&&(f.onEvent=a.onEvent),a.onEose&&(f.onEose=a.onEose),a.onClose&&(f.onClose=a.onClose),a.onEvents&&(c=a.onEvents));const g=new NDKSubscription$1(this,r,f);this.subManager.add(g),this.aiGuardrails?.subscription?.created(Array.isArray(r)?r:[r],f);const b=g.pool;if(g.relaySet)for(const _ of g.relaySet.relays)b.useTemporaryRelay(_,void 0,g.filters);if(this.outboxPool&&g.hasAuthorsFilter()){const _=g.filters.filter(L=>L.authors&&L.authors?.length>0).flatMap(L=>L.authors);this.outboxTracker?.trackUsers(_)}return a&&setTimeout(async()=>{this.cacheAdapter?.initializeAsync&&!this.cacheAdapter.ready&&await this.cacheAdapter.initializeAsync(this);const _=g.start(!c);_&&_.length>0&&c&&c(_)},0),g}fetchEventFromTag=fetchEventFromTag$1.bind(this);fetchEventSync(r){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let t;typeof r=="string"?t=[filterFromId$1(r)]:t=r;const n=new NDKSubscription$1(this,t),s=this.cacheAdapter.query(n);if(s instanceof Promise)throw new Error("Cache adapter is async");return s.map(o=>(o.ndk=this,o))}async fetchEvent(r,t,n){let s,o;if(n instanceof NDKRelay$2?o=new NDKRelaySet$2(new Set([n]),this):n instanceof NDKRelaySet$2&&(o=n),!n&&typeof r=="string"&&!isNip33AValue$1(r)){const a=relaysFromBech32$1(r,this);a.length>0&&(o=new NDKRelaySet$2(new Set(a),this),o=correctRelaySet$1(o,this.pool))}if(typeof r=="string"?s=[filterFromId$1(r)]:Array.isArray(r)?s=r:s=[r],typeof r!="string"&&this.aiGuardrails?.ndk?.fetchingEvents(s),s.length===0)throw new Error(`Invalid filter: ${JSON.stringify(r)}`);return new Promise((a,c)=>{let f=null;const g={...t||{},closeOnEose:!0};o&&(g.relaySet=o);const b=setTimeout(()=>{_.stop(),this.aiGuardrails._nextCallDisabled=null,a(f)},1e4),_=this.subscribe(s,g,{onEvent:L=>{L.ndk=this,L.isReplaceable()?(!f||f.created_at<L.created_at)&&(f=L):(clearTimeout(b),this.aiGuardrails._nextCallDisabled=null,a(L))},onEose:()=>{clearTimeout(b),this.aiGuardrails._nextCallDisabled=null,a(f)}})})}async fetchEvents(r,t,n){return this.aiGuardrails?.ndk?.fetchingEvents(r,t),new Promise(s=>{const o=new Map,a={...t||{},closeOnEose:!0};n&&(a.relaySet=n);const c=f=>{let g;f instanceof NDKEvent$2?g=f:g=new NDKEvent$2(void 0,f);const b=g.deduplicationKey(),_=o.get(b);_&&(g=dedup$1(_,g)),g.ndk=this,o.set(b,g)};this.subscribe(r,{...a,onEvent:c,onEose:()=>{this.aiGuardrails._nextCallDisabled=null,s(new Set(o.values()))}})})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getEntity=getEntity$1.bind(this);guardrailOff(r){return r?typeof r=="string"?this.aiGuardrails._nextCallDisabled=new Set([r]):this.aiGuardrails._nextCallDisabled=new Set(r):this.aiGuardrails._nextCallDisabled="all",this}set wallet(r){if(!r){this._wallet=void 0,this.walletConfig=void 0;return}this._wallet=r,this.walletConfig??={},this.walletConfig.lnPay=r?.lnPay?.bind(r),this.walletConfig.cashuPay=r?.cashuPay?.bind(r)}get wallet(){return this._wallet}});var nip19_exports2={};__reExport$2(nip19_exports2,exports_nip19);var nip49_exports$2={};__reExport$2(nip49_exports$2,exports_nip49);function disconnect$2(r,t){return t??=import_debug9.default("ndk:relay:auth-policies:disconnect"),async n=>{t?.(`Relay ${n.url} requested authentication, disconnecting`),r.removeRelay(n.url)}}async function signAndAuth$2(r,t,n,s,o,a){try{await r.sign(n),o(r)}catch(c){s?.(`Failed to publish auth event to relay ${t.url}`,c),a(r)}}function signIn$2({ndk:r,signer:t,debug:n}={}){return n??=import_debug9.default("ndk:auth-policies:signIn"),async(s,o)=>{n?.(`Relay ${s.url} requested authentication, signing in`);const a=new NDKEvent$2(r);return a.kind=22242,a.tags=[["relay",s.url],["challenge",o]],t??=r?.signer,new Promise(async(c,f)=>{t?await signAndAuth$2(a,s,t,n,c,f):r?.once("signer:ready",async g=>{await signAndAuth$2(a,s,g,n,c,f)})})}}var NDKRelayAuthPolicies$2={disconnect:disconnect$2,signIn:signIn$2};async function ndkSignerFromPayload$2(r,t){let n;try{n=JSON.parse(r)}catch(o){console.error("Failed to parse signer payload string",r,o);return}if(!n||typeof n.type!="string"){console.error("Failed to parse signer payload string",r,new Error("Missing type field"));return}const s=signerRegistry$2.get(n.type);if(!s)throw new Error(`Unknown signer type: ${n.type}`);try{return await s.fromPayload(r,t)}catch(o){const a=o instanceof Error?o.message:String(o);throw new Error(`Failed to deserialize signer type ${n.type}: ${a}`)}}var NDKNip07Signer$2=class Ds{_userPromise;encryptionQueue=[];encryptionProcessing=!1;debug;waitTimeout;_pubkey;ndk;_user;constructor(t=1e3,n){this.debug=import_debug10.default("ndk:nip07"),this.waitTimeout=t,this.ndk=n}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr?.getPublicKey();if(!t)throw new Error("User rejected access");this._pubkey=t;let n;return this.ndk?n=this.ndk.getUser({pubkey:t}):n=new NDKUser$2({pubkey:t}),this._user=n,n}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(t){await this.waitForExtension();const n=await window.nostr?.signEvent(t);if(!n)throw new Error("Failed to sign event");return n.sig}async relays(t){await this.waitForExtension();const n=await window.nostr?.getRelays?.()||{},s=[];for(const o of Object.keys(n))n[o].read&&n[o].write&&s.push(o);return s.map(o=>new NDKRelay$2(o,t?.relayAuthDefaultPolicy,t))}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&window.nostr?.nip04&&n.push("nip04"),(!t||t==="nip44")&&window.nostr?.nip44&&n.push("nip44"),n}async encrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"encrypt",o,n)}async decrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"decrypt",o,n)}async queueEncryption(t,n,s,o){return new Promise((a,c)=>{this.encryptionQueue.push({scheme:t,method:n,counterpartyHexpubkey:s,value:o,resolve:a,reject:c}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(t,n=0){if(!t&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const s=t||this.encryptionQueue.shift();if(!s){this.encryptionProcessing=!1;return}const{scheme:o,method:a,counterpartyHexpubkey:c,value:f,resolve:g,reject:b}=s;this.debug("Processing encryption queue item",{method:a,counterpartyHexpubkey:c,value:f});try{const _=await window.nostr?.[o]?.[a](c,f);if(!_)throw new Error("Failed to encrypt/decrypt");g(_)}catch(_){const L=_ instanceof Error?_.message:String(_);if(L.includes("call already executing")&&n<5){this.debug("Retrying encryption queue item",{method:a,counterpartyHexpubkey:c,value:f,retries:n}),setTimeout(()=>{this.processEncryptionQueue(s,n+1)},50*n);return}b(_ instanceof Error?_:new Error(L))}this.processEncryptionQueue()}waitForExtension(){return new Promise((t,n)=>{if(window.nostr){t();return}let s;const o=setInterval(()=>{window.nostr&&(clearTimeout(s),clearInterval(o),t())},100);s=setTimeout(()=>{clearInterval(o),n(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${s.type}`);return new Ds(void 0,n)}};registerSigner$2("nip07",NDKNip07Signer$2);var NDKNostrRpc$2=class extends import_tseep7.EventEmitter{ndk;signer;relaySet;debug;encryptionType="nip04";pool;constructor(t,n,s,o){if(super(),this.ndk=t,this.signer=n,o){this.pool=new NDKPool$2(o,t,{debug:s.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet$2(new Set,t,this.pool);for(const a of o){const c=this.pool.getRelay(a,!1,!1);c.authPolicy=NDKRelayAuthPolicies$2.signIn({ndk:t,signer:n,debug:s}),this.relaySet.addRelay(c),c.connect()}}this.debug=s.extend("rpc")}subscribe(t){return new Promise(n=>{const s=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet,onEvent:async o=>{try{const a=await this.parseEvent(o);a.method?this.emit("request",a):(this.emit(`response-${a.id}`,a),this.emit("response",a))}catch(a){this.debug("error parsing event",a,o.rawEvent())}},onEose:()=>{this.debug("eosed"),n(s)}})})}async parseEvent(t){this.encryptionType==="nip44"&&t.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!t.content.includes("?iv=")&&(this.encryptionType="nip44");const n=this.ndk.getUser({pubkey:t.pubkey});n.ndk=this.ndk;let s;try{s=await this.signer.decrypt(n,t.content,this.encryptionType)}catch{const L=this.encryptionType==="nip04"?"nip44":"nip04";s=await this.signer.decrypt(n,t.content,L),this.encryptionType=L}const o=JSON.parse(s),{id:a,method:c,params:f,result:g,error:b}=o;return c?{id:a,pubkey:t.pubkey,method:c,params:f,event:t}:{id:a,result:g,error:b,event:t}}async sendResponse(t,n,s,o=24133,a){const c={id:t,result:s};a&&(c.error=a);const f=await this.signer.user(),g=this.ndk.getUser({pubkey:n}),b=new NDKEvent$2(this.ndk,{kind:o,content:JSON.stringify(c),tags:[["p",n]],pubkey:f.pubkey});b.content=await this.signer.encrypt(g,b.content,this.encryptionType),await b.sign(this.signer),await b.publish(this.relaySet)}async sendRequest(t,n,s=[],o=24133,a){const c=Math.random().toString(36).substring(7),f=await this.signer.user(),g=this.ndk.getUser({pubkey:t}),b={id:c,method:n,params:s},_=new Promise(()=>{const q=X=>{X.result==="auth_url"?(this.once(`response-${c}`,q),this.emit("authUrl",X.error)):a&&a(X)};this.once(`response-${c}`,q)}),L=new NDKEvent$2(this.ndk,{kind:o,content:JSON.stringify(b),tags:[["p",t]],pubkey:f.pubkey});return L.content=await this.signer.encrypt(g,L.content,this.encryptionType),await L.sign(this.signer),await L.publish(this.relaySet),_}};function nostrConnectGenerateSecret$2(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri$2(r,t,n,s){const o={name:s?.name?encodeURIComponent(s.name):"",url:s?.url?encodeURIComponent(s.url):"",image:s?.image?encodeURIComponent(s.image):"",perms:s?.perms?encodeURIComponent(s.perms):""};let a=`nostrconnect://${r}?image=${o.image}&url=${o.url}&name=${o.name}&perms=${o.perms}&secret=${encodeURIComponent(t)}`;return n&&(a+=`&relay=${encodeURIComponent(n)}`),a}var NDKNip46Signer$2=class ki extends import_tseep8.EventEmitter{ndk;_user;bunkerPubkey;userPubkey;get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}secret;localSigner;nip05;rpc;debug;relayUrls;subscription;nostrConnectUri;nostrConnectSecret;constructor(t,n,s,o,a){super(),this.ndk=t,this.debug=t.debug.extend("nip46:signer"),this.relayUrls=o,s?typeof s=="string"?this.localSigner=new NDKPrivateKeySigner$2(s):this.localSigner=s:this.localSigner=NDKPrivateKeySigner$2.generate(),n===!1||(n?n.startsWith("bunker://")?this.bunkerFlowInit(n):this.nip05Init(n):this.nostrconnectFlowInit(a)),this.rpc=new NDKNostrRpc$2(this.ndk,this.localSigner,this.debug,this.relayUrls)}static bunker(t,n,s){return new ki(t,n,s)}static nostrconnect(t,n,s,o){return new ki(t,void 0,s,[n],o)}nostrconnectFlowInit(t){this.nostrConnectSecret=nostrConnectGenerateSecret$2();const n=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri$2(n,this.nostrConnectSecret,this.relayUrls?.[0],t)}bunkerFlowInit(t){const n=new URL(t),s=n.hostname||n.pathname.replace(/^\/\//,""),o=n.searchParams.get("pubkey"),a=n.searchParams.getAll("relay"),c=n.searchParams.get("secret");this.bunkerPubkey=s,this.userPubkey=o,this.relayUrls=a,this.secret=c}nip05Init(t){this.nip05=t}async startListening(){if(this.subscription)return;const t=await this.localSigner.user();if(!t)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[t.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((t,n)=>{const s=o=>{o.result===this.nostrConnectSecret&&(this._user=o.event.author,this.userPubkey=o.event.pubkey,this.bunkerPubkey=o.event.pubkey,this.rpc.off("response",s),t(this._user))};this.startListening(),this.rpc.on("response",s)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const t=await NDKUser$2.fromNip05(this.nip05,this.ndk);t&&(this._user=t,this.userPubkey=t.pubkey,this.relayUrls=t.nip46Urls,this.rpc=new NDKNostrRpc$2(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...t)=>{this.emit("authUrl",...t)}),new Promise((t,n)=>{const s=[this.userPubkey??""];if(this.secret&&s.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",s,24133,o=>{o.result==="ack"?this.getPublicKey().then(a=>{this.userPubkey=a,this._user=this.ndk.getUser({pubkey:a}),t(this._user)}):n(o.error)})})}stop(){this.subscription?.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((t,n)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,s=>{t(s.result)})})}async encryptionEnabled(t){return t?[t]:Promise.resolve(["nip04","nip44"])}async encrypt(t,n,s="nip04"){return this.encryption(t,n,s,"encrypt")}async decrypt(t,n,s="nip04"){return this.encryption(t,n,s,"decrypt")}async encryption(t,n,s,o){return new Promise((c,f)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${s}_${o}`,[t.pubkey,n],24133,g=>{g.error?f(g.error):c(g.result)})})}async sign(t){return new Promise((s,o)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(t)],24133,a=>{if(a.error)o(a.error);else{const c=JSON.parse(a.result);s(c.sig)}})})}async createAccount(t,n,s){await this.startListening();const o=[];return t&&o.push(t),n&&o.push(n),s&&o.push(s),new Promise((a,c)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",o,24133,f=>{if(f.error)c(f.error);else{const g=f.result;a(g)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const t={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(t)}static async fromPayload(t,n){if(!n)throw new Error("NDK instance is required to deserialize NIP-46 signer");const s=JSON.parse(t);if(s.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${s.type}`);const o=s.payload;if(!o||typeof o!="object"||!o.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const a=await ndkSignerFromPayload$2(o.localSignerPayload,n);if(!a)throw new Error("Failed to deserialize local signer for NIP-46");if(!(a instanceof NDKPrivateKeySigner$2))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let c;return c=new ki(n,!1,a,o.relayUrls),c.userPubkey=o.userPubkey,c.bunkerPubkey=o.bunkerPubkey,c.relayUrls=o.relayUrls,c.secret=o.secret,o.userPubkey&&(c._user=new NDKUser$2({pubkey:o.userPubkey}),c._user&&(c._user.ndk=n)),c}};registerSigner$2("nip46",NDKNip46Signer$2);function matchFilter2(r,t){if(r.ids&&r.ids.indexOf(t.id)===-1||r.kinds&&r.kinds.indexOf(t.kind)===-1||r.authors&&r.authors.indexOf(t.pubkey)===-1)return!1;for(const n in r)if(n[0]==="#"){const s=n.slice(1);if(s==="t"){const o=r[`#${s}`]?.map(a=>a.toLowerCase());if(o&&!t.tags.find(([a,c])=>a===s&&o?.indexOf(c.toLowerCase())!==-1))return!1}else{const o=r[`#${s}`];if(o&&!t.tags.find(([a,c])=>a===s&&o?.indexOf(c)!==-1))return!1}}return!(r.since&&t.created_at<r.since||r.until&&t.created_at>r.until)}import_debug12.default("ndk:zapper:ln");import_debug11.default("ndk:zapper");async function getDecryptedEvent(r){const t="SELECT event FROM decrypted_events WHERE id = ? LIMIT 1";if(await this.ensureInitialized(),this.useWorker){const n=await this.postWorkerMessage({type:"get",payload:{sql:t,params:[r]}});if(n&&n.event)try{const s=deserialize$2(n.event);return new NDKEvent$2(this.ndk,s)}catch(s){return console.error("[getDecryptedEvent] Parse error:",s),null}return null}else{if(!this.db)throw new Error("Database not initialized");const n=this.db.exec(t,[r]);if(n&&n.length>0&&n[0].values&&n[0].values.length>0){const s=n[0].values[0][0];try{const o=deserialize$2(s);return new NDKEvent$2(this.ndk,o)}catch{return null}}else console.warn("[WASM] No decrypted event found for ID:",r);return null}}async function getEvent(r){const t="SELECT raw FROM events WHERE id = ? AND deleted = 0 LIMIT 1";if(await this.ensureInitialized(),this.useWorker){const n=await this.postWorkerMessage({type:"get",payload:{sql:t,params:[r]}});if(n&&n.raw)try{return JSON.parse(n.raw)}catch{return null}return null}else{if(!this.db)throw new Error("DB not initialized");const n=this.db.exec(t,[r]);if(n&&n.length>0&&n[0].values&&n[0].values.length>0){const s=n[0].values[0][0];try{return JSON.parse(s)}catch{return null}}return null}}function normalizeDbRows(r){if(!r||r.length===0)return[];const t=r[0];if(!t||!t.columns||!t.values)return[];const{columns:n,values:s}=t;return s.map(o=>{const a={};return n.forEach((c,f)=>{a[c]=o[f]}),a})}async function getEventRelays(r){if(r.length===0)return new Map;const n=`
        SELECT event_id, relay_url, seen_at
        FROM event_relays
        WHERE event_id IN (${r.map(()=>"?").join(",")})
        ORDER BY event_id, seen_at ASC
    `;let s;if(await this.ensureInitialized(),this.useWorker)s=await this.postWorkerMessage({type:"exec",payload:{sql:n,params:r}});else{if(!this.db)throw new Error("DB not initialized");const a=this.db.exec(n,r);s=normalizeDbRows(a)}const o=new Map;for(const a of s)o.has(a.event_id)||o.set(a.event_id,[]),o.get(a.event_id).push({url:a.relay_url,seenAt:a.seen_at});return o}async function getProfiles(r){if(await this.ensureInitialized(),this.useWorker){if(typeof r=="function")throw new Error("In worker mode, getProfiles only supports filter descriptors, not functions.");const t=await this.postWorkerMessage({type:"getProfiles",payload:r}),n=new Map;for(const{pubkey:s,profile:o}of t)n.set(s,o);return n}else{if(typeof r!="function")throw new Error("In non-worker mode, getProfiles only supports filter functions.");if(!this.db)throw new Error("Database not initialized");const n=this.db.exec("SELECT pubkey, profile FROM profiles"),s=new Map;if(n&&n.length>0&&n[0].values&&n[0].values.length>0)for(const o of n[0].values){const[a,c]=o;try{const f=JSON.parse(c);r(a,f)&&s.set(a,f)}catch{}}return s}}async function getRelayStatus(r){const t=`
        CREATE TABLE IF NOT EXISTS relay_status (
            url TEXT PRIMARY KEY,
            info TEXT
        )
    `,n="SELECT info FROM relay_status WHERE url = ? LIMIT 1";if(await this.ensureInitialized(),this.useWorker){await this.postWorkerMessage({type:"run",payload:{sql:t,params:[]}});const s=await this.postWorkerMessage({type:"get",payload:{sql:n,params:[r]}});if(s&&s.info)try{return JSON.parse(s.info)}catch{return}return}else{if(!this.db)throw new Error("Database not initialized");this.db.run(t);const s=this.db.exec(n,[r]);if(s&&s.length>0&&s[0].values&&s[0].values.length>0){const o=s[0].values[0][0];try{return JSON.parse(o)}catch{return}}return}}async function getUnpublishedEvents(){const r="SELECT id, event, relays, lastTryAt FROM unpublished_events";if(await this.ensureInitialized(),this.useWorker){const t=await this.postWorkerMessage({type:"all",payload:{sql:r,params:[]}}),n=[];if(t)for(const s of t)try{const o=JSON.parse(s.event),a=s.relays?JSON.parse(s.relays):[];n.push({event:o,relays:a,lastTryAt:s.lastTryAt})}catch{}return n}else{if(!this.db)throw new Error("Database not initialized");const t=[],n=this.db.exec(r);if(n&&n.length>0&&n[0].values&&n[0].values.length>0)for(const s of n[0].values){const[o,a,c,f]=s;try{const g=JSON.parse(a),b=c?JSON.parse(c):[];t.push({event:g,relays:b,lastTryAt:f})}catch{}}return t}}async function loadNip05(r,t=3600){const n="SELECT profile, fetched_at FROM nip05 WHERE nip05 = ? LIMIT 1";if(await this.ensureInitialized(),this.useWorker){const s=await this.postWorkerMessage({type:"get",payload:{sql:n,params:[r]}});if(!s)return"missing";const o=Date.now();if(s.profile===null||s.profile===void 0)return s.fetched_at&&s.fetched_at+t*1e3<o?"missing":null;try{return JSON.parse(s.profile)}catch{return"missing"}}else{if(!this.db)throw new Error("Database not initialized");const s=this.db.exec(n,[r]);if(!s||s.length===0||!s[0].values||s[0].values.length===0)return"missing";const[o,a]=s[0].values[0],c=Date.now();if(o===null)return a&&a+t*1e3<c?"missing":null;try{return JSON.parse(o)}catch{return"missing"}}}function normalizeDbRows2(r){if(!r||r.length===0)return[];const t=r[0];if(!t||!t.columns||!t.values)return[];const{columns:n,values:s}=t;return s.map(o=>{const a={};return n.forEach((c,f)=>{a[c]=o[f]}),a})}function query(r){return this.ready?this.useWorker?queryWorker.call(this,r):this.db?queryDb(this,r):[]:this.initializationPromise?this.initializationPromise.then(async()=>this.useWorker?await queryWorker.call(this,r):this.db?await queryDb(this,r):[]):[]}async function queryWorker(r){const t=filterForCache(r),n=await this.postWorkerMessage({type:"query",payload:{filters:t,cacheUnconstrainFilter:r.cacheUnconstrainFilter}}),s=new Map;for(const c of t){const f=foundEvents(r,n,c);for(const g of f)g&&g.id&&s.set(g.id,g)}const o=Array.from(s.keys()),a=await this.getEventRelays(o);for(const[c,f]of s){const g=a.get(c)||[];restoreRelaysOnEvent(f,g,r)}return Array.from(s.values())}function querySync(r,t){const n=[];for(const s of t)if(Object.keys(s).some(a=>a.startsWith("#")&&a.length===2)){for(const a in s)if(a.startsWith("#")&&a.length===2){const c=Array.isArray(s[a])?s[a]:[],g=`
                        SELECT * FROM events
                        INNER JOIN event_tags ON events.id = event_tags.event_id
                        WHERE events.deleted = 0 AND event_tags.tag = ? AND event_tags.value IN (${c.map(()=>"?").join(",")})
                        ORDER BY created_at DESC
                    `,b=[a[1],...c],_=r.exec(g,b),L=normalizeDbRows2(_);n.push(...L);break}}else if(s.authors&&s.kinds){const a=`
                SELECT * FROM events
                WHERE deleted = 0
                AND pubkey IN (${s.authors.map(()=>"?").join(",")})
                AND kind IN (${s.kinds.map(()=>"?").join(",")})
                ORDER BY created_at DESC
            `,c=[...s.authors,...s.kinds],f=r.exec(a,c),g=normalizeDbRows2(f);n.push(...g)}else if(s.authors){const a=`
                SELECT * FROM events
                WHERE deleted = 0
                AND pubkey IN (${s.authors.map(()=>"?").join(",")})
                ORDER BY created_at DESC
            `,c=s.authors,f=r.exec(a,c),g=normalizeDbRows2(f);n.push(...g)}else if(s.kinds){const a=`
                SELECT * FROM events
                WHERE deleted = 0
                AND kind IN (${s.kinds.map(()=>"?").join(",")})
                ORDER BY created_at DESC
            `,c=s.kinds,f=r.exec(a,c),g=normalizeDbRows2(f);n.push(...g)}else if(s.ids){const a=`
                SELECT * FROM events
                WHERE deleted = 0
                AND id IN (${s.ids.map(()=>"?").join(",")})
                ORDER BY created_at DESC
            `,c=s.ids,f=r.exec(a,c),g=normalizeDbRows2(f);n.push(...g)}return n}async function queryDb(r,t){if(!r.db)return[];const n=filterForCache(t),s=querySync(r.db,n),o=new Map;for(const f of n){const g=foundEvents(t,s,f);for(const b of g)b&&b.id&&o.set(b.id,b)}const a=Array.from(o.keys()),c=await r.getEventRelays(a);for(const[f,g]of o){const b=c.get(f)||[];restoreRelaysOnEvent(g,b,t)}return Array.from(o.values())}function filterForCache(r){return r.cacheUnconstrainFilter?r.filters.map(n=>({...n})).filter(n=>{for(const s of r.cacheUnconstrainFilter)delete n[s];return Object.keys(n).length>0}):r.filters}function foundEvents(r,t,n){const s=[];let o;for(const a of t){const c=foundEvent(r,a,a.relay,n);if(c){const f=c.tagValue("expiration");if(f&&(o??=Math.floor(Date.now()/1e3),o>Number.parseInt(f)))continue;if(s.push(c),n?.limit&&s.length>=n.limit)break}}return s}function foundEvent(r,t,n,s){try{const o=JSON.parse(t.raw);let a;return Array.isArray(o)?a={id:o[0],pubkey:o[1],created_at:o[2],kind:o[3],tags:o[4],content:o[5],sig:o[6]}:a=o,s&&!matchFilter2(s,a)?null:new NDKEvent$2(void 0,a)}catch(o){return console.error("failed to deserialize event",o,"record:",t,"record.raw:",t.raw),null}}function restoreRelaysOnEvent(r,t,n){if(t.length===0)return;const s=n.pool.getRelay(t[0].url,!1);if(s&&(r.relay=s),n.ndk)for(const o of t){const a=n.pool.getRelay(o.url,!1);a&&n.ndk.subManager.seenEvent(r.id,a)}}async function saveNip05(r,t){const n=`
        INSERT OR REPLACE INTO nip05 (
            nip05, profile, fetched_at
        ) VALUES (?, ?, ?)
    `,s=t?JSON.stringify(t):null,o=Date.now();if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:n,params:[r,s,o]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(n,[r,s,o])}}async function saveProfile(r,t){const n=`
        INSERT OR REPLACE INTO profiles (
            pubkey, profile, updated_at
        ) VALUES (?, ?, ?)
    `,s=JSON.stringify(t),o=Math.floor(Date.now()/1e3);if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:n,params:[r,s,o]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(n,[r,s,o])}}function setCacheData(r,t,n,s){const o=Math.floor(Date.now()/1e3),a=JSON.stringify(s);r.run("INSERT OR REPLACE INTO cache_data (namespace, key, data, cached_at) VALUES (?, ?, ?, ?)",[t,n,a,o])}function setEventSync(r,t,n){const s=`
        INSERT OR REPLACE INTO events (
            id, pubkey, created_at, kind, tags, content, sig, raw, deleted
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
    `,o=JSON.stringify(t.tags??[]),a=JSON.stringify([t.id,t.pubkey,t.created_at,t.kind,t.tags??[],t.content,t.sig]),c=[t.id??"",t.pubkey??"",t.created_at??0,t.kind??0,o,t.content??"",t.sig??"",a,0];if(r.run(s,c),n?.url&&r.run("INSERT OR IGNORE INTO event_relays (event_id, relay_url, seen_at) VALUES (?, ?, ?)",[t.id,n.url,Date.now()]),t.tags&&t.tags.length>0)for(const f of t.tags)f.length>=2&&f[0].length===1&&r.run("INSERT OR IGNORE INTO event_tags (event_id, tag, value) VALUES (?, ?, ?)",[t.id,f[0],f[1]||null]);if(t.kind===NDKKind$2.Metadata||t.kind===0)try{const f=typeof t.content=="string"?JSON.parse(t.content):t.content;f&&t.pubkey&&r.run("INSERT OR REPLACE INTO profiles (pubkey, profile, updated_at) VALUES (?, ?, ?)",[t.pubkey,JSON.stringify(f),t.created_at??Date.now()])}catch{}}async function setEvent(r,t,n){if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"setEvent",payload:{event:{id:r.id,pubkey:r.pubkey,created_at:r.created_at,kind:r.kind,tags:r.tags,content:r.content,sig:r.sig},relay:n?.url}});else{if(!this.db)throw new Error("DB not initialized");setEventSync(this.db,r,n)}}function setEventDupSync(r,t,n){n?.url&&r.run("INSERT OR IGNORE INTO event_relays (event_id, relay_url, seen_at) VALUES (?, ?, ?)",[t.id,n.url,Date.now()])}async function setEventDup(r,t){if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"setEventDup",payload:{eventId:r.id,relayUrl:t.url}});else{if(!this.db)throw new Error("DB not initialized");setEventDupSync(this.db,r,t)}}async function updateRelayStatus(r,t){const n=`
        CREATE TABLE IF NOT EXISTS relay_status (
            url TEXT PRIMARY KEY,
            info TEXT
        );
    `,s=`
        INSERT OR REPLACE INTO relay_status (url, info)
        VALUES (?, ?)
    `,o=await this.getRelayStatus(r),a={...o,...t,metadata:{...o?.metadata,...t.metadata}};if(a.metadata)for(const[c,f]of Object.entries(a.metadata))f===void 0&&delete a.metadata[c];if(await this.ensureInitialized(),this.useWorker)await this.postWorkerMessage({type:"run",payload:{sql:n,params:[]}}),await this.postWorkerMessage({type:"run",payload:{sql:s,params:[r,JSON.stringify(a)]}});else{if(!this.db)throw new Error("Database not initialized");this.db.run(n),this.db.run(s,[r,JSON.stringify(a)])}}class NDKCacheAdapterSqliteWasm{dbName;wasmUrl;locking=!1;db;ndk;ready=!1;fetchProfileSync;getAllProfilesSync;worker;workerUrl;useWorker=!1;pendingRequests=new Map;nextRequestId=0;initializationPromise;constructor(t={}){this.dbName=t.dbName||"ndk-cache",this.wasmUrl=t.wasmUrl,this.useWorker=t.useWorker??!1,this.workerUrl=t.workerUrl,this.useWorker||(this.fetchProfileSync=fetchProfileSync.bind(this),this.getAllProfilesSync=getAllProfilesSync.bind(this))}async initializeAsync(t){return this.initializationPromise?this.initializationPromise:(this.initializationPromise=(async()=>{this.ndk=t,this.useWorker?await this.initializeWorker():(this.db=await loadWasmAndInitDb(this.wasmUrl,this.dbName),await runMigrations(this.db)),this.ready=!0})(),this.initializationPromise)}async initializeWorker(){let t=this.workerUrl;if(!t)try{t=new URL(""+new URL("../assets/worker.Mt4aLcPu.js",import.meta.url).href,import.meta.url).toString()}catch(n){throw console.error("Failed to determine worker URL automatically. Please provide 'workerUrl' option.",n),new Error("Worker URL configuration error.")}try{this.worker=new Worker(t,{type:"module"})}catch(n){const o=function(a){return typeof a=="object"&&a!==null&&"message"in a&&typeof a.message=="string"}(n)?n.message.toLowerCase():"";throw o.includes("404")||o.includes("not found")||o.includes("failed to fetch")||o.includes("networkerror")||o.includes("could not load")||o.includes("cannot find")?console.error(`[NDK-cache-sqlite-wasm] Failed to load worker file at "${t}".
This usually means the worker asset is missing or not served correctly (e.g., 404 error).
Please ensure the worker file exists at the specified URL and is accessible to the browser. Check your bundler configuration and asset paths. See the documentation for details.`,n):console.error(`[NDK-cache-sqlite-wasm] Error while creating worker at "${t}":`,n),n}this.worker.onmessage=n=>{const s=n.data;if(s._protocol&&s._protocol!=="ndk-cache-sqlite"){console.error("[NDK Cache SQLite WASM]  Wrong worker protocol!",`

Expected: ndk-cache-sqlite`,`
Received: ${s._protocol}`,`

This means the wrong worker instance was passed to the cache adapter.`,`
Make sure you are using the correct worker file for the cache.`);return}s._version&&s._version!=="0.8.1"&&console.warn("[NDK Cache SQLite WASM]   Worker version mismatch!",`
Library version: 0.8.1`,`
Worker version: ${s._version}`,`

Update your worker file:`,`
  cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/worker.js public/`);const{id:o,result:a,error:c}=s,f=this.pendingRequests.get(o);f&&(c?f.reject(new Error(`Worker error: ${c.message||c}`)):f.resolve(a),this.pendingRequests.delete(o))},this.worker.onerror=n=>{const s=n.message||"unknown error";console.error(`[NDK-cache-sqlite-wasm]  Worker failed: ${s}

 Common solutions:
1. Copy worker.js and sql-wasm.wasm to your public directory:
   cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/worker.js public/
   cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/sql-wasm.wasm public/

2. Ensure your bundler serves the public directory correctly

3. Check browser DevTools Network tab for 404 errors on worker.js

Current workerUrl: ${t}`),this.pendingRequests.forEach(o=>o.reject(new Error(`Worker failed: ${s}. Check console for setup instructions.`))),this.pendingRequests.clear()},await this.postWorkerMessage({type:"init",payload:{dbName:this.dbName,wasmUrl:this.wasmUrl}})}async postWorkerMessage(t){if(!this.worker)return Promise.reject(new Error("Worker not initialized"));const n=`req-${this.nextRequestId++}`;return new Promise((s,o)=>{this.pendingRequests.set(n,{resolve:s,reject:o}),this.worker.postMessage({...t,id:n})})}setEvent=setEvent.bind(this);setEventDup=setEventDup.bind(this);getEvent=getEvent.bind(this);getEventRelays=getEventRelays.bind(this);fetchProfile=fetchProfile.bind(this);saveProfile=saveProfile.bind(this);updateRelayStatus=updateRelayStatus.bind(this);getRelayStatus=getRelayStatus.bind(this);getDecryptedEvent=getDecryptedEvent.bind(this);addDecryptedEvent=addDecryptedEvent.bind(this);addUnpublishedEvent=addUnpublishedEvent.bind(this);getUnpublishedEvents=getUnpublishedEvents.bind(this);discardUnpublishedEvent=discardUnpublishedEvent.bind(this);query=query.bind(this);getProfiles=getProfiles.bind(this);getCacheStats=getCacheStats.bind(this);loadNip05=loadNip05.bind(this);saveNip05=saveNip05.bind(this);async getCacheData(t,n,s){if(await this.ensureInitialized(),!!this.db)return getCacheData(this.db,t,n,s)}async setCacheData(t,n,s){await this.ensureInitialized(),this.db&&setCacheData(this.db,t,n,s)}async ensureInitialized(){this.ready||this.initializationPromise&&await this.initializationPromise}}var src_default=NDKCacheAdapterSqliteWasm;function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var lib$5={},types$1={},hasRequiredTypes$1;function requireTypes$1(){return hasRequiredTypes$1||(hasRequiredTypes$1=1,Object.defineProperty(types$1,"__esModule",{value:!0})),types$1}var ee$1={},taskCollection$3={},taskCollection$2={},utils$4={},hasRequiredUtils$3;function requireUtils$3(){if(hasRequiredUtils$3)return utils$4;hasRequiredUtils$3=1,Object.defineProperty(utils$4,"__esModule",{value:!0}),utils$4._fast_remove_single=void 0;function r(t,n){n!==-1&&(n===0?t.shift():n===t.length-1?t.length=t.length-1:t.splice(n,1))}return utils$4._fast_remove_single=r,utils$4}var bakeCollection$1={},hasRequiredBakeCollection$1;function requireBakeCollection$1(){return hasRequiredBakeCollection$1||(hasRequiredBakeCollection$1=1,(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=(function(){});var FORLOOP_FALLBACK=1500;function generateArgsDefCode(r){var t="";if(r===0)return t;for(var n=0;n<r-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(r-1),t}function generateBodyPartsCode(r,t){for(var n="",s="",o=0;o<t;++o)n+="var f".concat(o," = collection[").concat(o,`];
`),s+="f".concat(o,"(").concat(r,`)
`);return{funcDefCode:n,funcCallCode:s}}function generateBodyPartsVariadicCode(r){for(var t="",n="",s=0;s<r;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),n+="f".concat(s,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection$1)),bakeCollection$1}var hasRequiredTaskCollection$3;function requireTaskCollection$3(){if(hasRequiredTaskCollection$3)return taskCollection$2;hasRequiredTaskCollection$3=1;var r=taskCollection$2&&taskCollection$2.__spreadArray||function(ze,Xe,He){if(He||arguments.length===2)for(var Ve=0,We=Xe.length,rt;Ve<We;Ve++)(rt||!(Ve in Xe))&&(rt||(rt=Array.prototype.slice.call(Xe,0,Ve)),rt[Ve]=Xe[Ve]);return ze.concat(rt||Array.prototype.slice.call(Xe))};Object.defineProperty(taskCollection$2,"__esModule",{value:!0}),taskCollection$2.TaskCollection=void 0;var t=requireUtils$3(),n=requireBakeCollection$1();function s(ze,Xe){var He=this.length;if(He>1)if(Xe){var Ve;(Ve=this._tasks).push.apply(Ve,arguments),this.length+=arguments.length}else this._tasks.push(ze),this.length++;else if(Xe){if(He===1){var We=Array(1+arguments.length);We.push(We),We.push.apply(We,arguments),this._tasks=We}else{var We=Array(arguments.length);We.push.apply(We,arguments),this._tasks=We}this.length+=arguments.length}else He===1?this._tasks=[this._tasks,ze]:this._tasks=ze,this.length++}function o(ze,Xe){var He=this.length;if(He>1)if(Xe){var Ve;(Ve=this._tasks).push.apply(Ve,arguments),this.length+=arguments.length}else this._tasks.push(ze),this.length++;else if(Xe){if(He===1){var We=Array(1+arguments.length);We.push(We),We.push.apply(We,arguments),this._tasks=We}else{var We=Array(arguments.length);We.push.apply(We,arguments),this._tasks=We}this.length+=arguments.length}else He===1?this._tasks=[this._tasks,ze]:this._tasks=ze,this.length++;this.firstEmitBuildStrategy?this.call=L:this.rebuild()}function a(ze){this.length!==0&&(this.length===1?this._tasks===ze&&(this.length=0):((0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(ze)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function c(ze){if(this.length!==0){if(this.length===1)if(this._tasks===ze&&(this.length=0),this.firstEmitBuildStrategy){this.call=n.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(ze)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=L:this.rebuild()}}function f(ze){for(var Xe,He=[],Ve=1;Ve<arguments.length;Ve++)He[Ve-1]=arguments[Ve];this.length===0?(this._tasks=He,this.length=1):this.length===1?(He.unshift(this._tasks),this._tasks=He,this.length=this._tasks.length):((Xe=this._tasks).splice.apply(Xe,r([ze,0],He,!1)),this.length=this._tasks.length)}function g(ze){for(var Xe,He=[],Ve=1;Ve<arguments.length;Ve++)He[Ve-1]=arguments[Ve];this.length===0?(this._tasks=He,this.length=1):this.length===1?(He.unshift(this._tasks),this._tasks=He,this.length=this._tasks.length):((Xe=this._tasks).splice.apply(Xe,r([ze,0],He,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=L:this.rebuild()}function b(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollection)(this._tasks,this.argsNum)}function _(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollectionAwait)(this._tasks,this.argsNum)}function L(){this.rebuild(),this.call.apply(void 0,arguments)}var q=(function(){function ze(Xe,He,Ve,We){He===void 0&&(He=!0),Ve===void 0&&(Ve=null),We===void 0&&(We=!1),this.awaitTasks=We,this.call=n.BAKED_EMPTY_FUNC,this.argsNum=Xe,this.firstEmitBuildStrategy=!0,We?this.rebuild=_.bind(this):this.rebuild=b.bind(this),this.setAutoRebuild(He),Ve?typeof Ve=="function"?(this._tasks=Ve,this.length=1):(this._tasks=Ve,this.length=Ve.length):(this._tasks=null,this.length=0),He&&this.rebuild()}return ze})();taskCollection$2.TaskCollection=q;function X(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function te(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function ne(ze){this.argsNum<ze&&(this.argsNum=ze,this.firstEmitBuildStrategy?this.call=L:this.rebuild())}function Ce(ze){ze?(this.push=o.bind(this),this.insert=g.bind(this),this.removeLast=c.bind(this)):(this.push=s.bind(this),this.insert=f.bind(this),this.removeLast=a.bind(this))}function Le(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function Ge(ze){ze.length===0?(this.length=0,this.call=n.BAKED_EMPTY_FUNC):ze.length===1?(this.length=1,this.call=ze[0],this._tasks=ze[0]):(this.length=ze.length,this._tasks=ze,this.firstEmitBuildStrategy?this.call=L:this.rebuild())}return q.prototype.fastClear=X,q.prototype.clear=te,q.prototype.growArgsNum=ne,q.prototype.setAutoRebuild=Ce,q.prototype.tasksAsArray=Le,q.prototype.setTasks=Ge,taskCollection$2}var hasRequiredTaskCollection$2;function requireTaskCollection$2(){return hasRequiredTaskCollection$2||(hasRequiredTaskCollection$2=1,(function(r){var t=taskCollection$3&&taskCollection$3.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=taskCollection$3&&taskCollection$3.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireTaskCollection$3(),r)})(taskCollection$3)),taskCollection$3}var utils$3={},hasRequiredUtils$2;function requireUtils$2(){if(hasRequiredUtils$2)return utils$3;hasRequiredUtils$2=1,Object.defineProperty(utils$3,"__esModule",{value:!0}),utils$3.nullObj=void 0;function r(){var t={};return t.__proto__=null,t}return utils$3.nullObj=r,utils$3}var hasRequiredEe$1;function requireEe$1(){if(hasRequiredEe$1)return ee$1;hasRequiredEe$1=1;var r=ee$1&&ee$1.__spreadArray||function(He,Ve,We){if(We||arguments.length===2)for(var rt=0,st=Ve.length,ht;rt<st;rt++)(ht||!(rt in Ve))&&(ht||(ht=Array.prototype.slice.call(Ve,0,rt)),ht[rt]=Ve[rt]);return He.concat(ht||Array.prototype.slice.call(Ve))};Object.defineProperty(ee$1,"__esModule",{value:!0}),ee$1.EventEmitter=void 0;var t=requireTaskCollection$2(),n=requireUtils$3(),s=requireUtils$2();function o(He,Ve,We,rt,st,ht){var je=this.events[He];if(je){if(je.length===0)return!1;if(je.argsNum<6)je.call(Ve,We,rt,st,ht);else{for(var se=new Array(je.argsNum),m=0,A=se.length;m<A;++m)se[m]=arguments[m+1];je.call.apply(void 0,se)}return!0}return!1}function a(He,Ve,We,rt,st,ht){var je=this.events[He],se;if(je!==void 0){if(je.length===0)return!1;if(je.argsNum<6)je.call(Ve,We,rt,st,ht);else{se=new Array(je.argsNum);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1];je.call.apply(void 0,se)}}var k=this.onceEvents[He];if(k){if(typeof k=="function")if(this.onceEvents[He]=void 0,arguments.length<6)k(Ve,We,rt,st,ht);else{if(se===void 0){se=new Array(arguments.length-1);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1]}k.apply(void 0,se)}else{var Y=k;if(this.onceEvents[He]=void 0,arguments.length<6)for(var m=0;m<Y.length;++m)Y[m](Ve,We,rt,st,ht);else{if(se===void 0){se=new Array(arguments.length-1);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1]}for(var m=0;m<Y.length;++m)Y[m].apply(void 0,se)}}return!0}return je!==void 0}var c=(function(){function He(){this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(He.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),He})();ee$1.EventEmitter=c;function f(He,Ve){switch(this.emit===o&&(this.emit=a),typeof this.onceEvents[He]){case"undefined":this.onceEvents[He]=Ve,typeof He=="symbol"&&this._symbolKeys.add(He);break;case"function":this.onceEvents[He]=[this.onceEvents[He],Ve];break;case"object":this.onceEvents[He].push(Ve)}return this}function g(He,Ve,We){if(We===void 0&&(We=Ve.length),typeof Ve!="function")throw new TypeError("The listener must be a function");var rt=this.events[He];return rt?(rt.push(Ve),rt.growArgsNum(We),this.maxListeners!==1/0&&this.maxListeners<=rt.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" event!'))):(this.events[He]=new t.TaskCollection(We,!0,Ve,!1),typeof He=="symbol"&&this._symbolKeys.add(He)),this}function b(He,Ve){var We=this.events[He];We&&We.removeLast(Ve);var rt=this.onceEvents[He];return rt&&(typeof rt=="function"?this.onceEvents[He]=void 0:typeof rt=="object"&&(rt.length===1&&rt[0]===Ve?this.onceEvents[He]=void 0:(0,n._fast_remove_single)(rt,rt.lastIndexOf(Ve)))),this}function _(He,Ve,We,rt){We===void 0&&(We=this),rt===void 0&&(rt=Ve.length),this.boundFuncs||(this.boundFuncs=new Map);var st=Ve.bind(We);return this.boundFuncs.set(Ve,st),this.addListener(He,st,rt)}function L(He,Ve){var We,rt,st=(We=this.boundFuncs)===null||We===void 0?void 0:We.get(Ve);return(rt=this.boundFuncs)===null||rt===void 0||rt.delete(Ve),this.removeListener(He,st)}function q(He){return this.events[He]&&!!this.events[He].length}function X(He,Ve,We){if(We===void 0&&(We=Ve.length),typeof Ve!="function")throw new TypeError("The listener must be a function");var rt=this.events[He];return!rt||!(rt instanceof t.TaskCollection)?(rt=this.events[He]=new t.TaskCollection(We,!0,Ve,!1),typeof He=="symbol"&&this._symbolKeys.add(He)):(rt.insert(0,Ve),rt.growArgsNum(We),this.maxListeners!==1/0&&this.maxListeners<=rt.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" event!'))),this}function te(He,Ve){this.emit===o&&(this.emit=a);var We=this.onceEvents[He];return We?typeof We!="object"?(this.onceEvents[He]=[Ve,We],typeof He=="symbol"&&this._symbolKeys.add(He)):(We.unshift(Ve),this.maxListeners!==1/0&&this.maxListeners<=We.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" once event!'))):(this.onceEvents[He]=[Ve],typeof He=="symbol"&&this._symbolKeys.add(He)),this}function ne(He){return He===void 0?(this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set):(this.events[He]=void 0,this.onceEvents[He]=void 0,typeof He=="symbol"&&this._symbolKeys.delete(He)),this}function Ce(He){return this.maxListeners=He,this}function Le(){return this.maxListeners}function Ge(He){return this.emit===o?this.events[He]?this.events[He].tasksAsArray().slice():[]:this.events[He]&&this.onceEvents[He]?r(r([],this.events[He].tasksAsArray(),!0),typeof this.onceEvents[He]=="function"?[this.onceEvents[He]]:this.onceEvents[He],!0):this.events[He]?this.events[He].tasksAsArray():this.onceEvents[He]?typeof this.onceEvents[He]=="function"?[this.onceEvents[He]]:this.onceEvents[He]:[]}function ze(){var He=this;if(this.emit===o){var Ve=Object.keys(this.events);return r(r([],Ve,!0),Array.from(this._symbolKeys),!0).filter(function(rt){return rt in He.events&&He.events[rt]&&He.events[rt].length})}else{var Ve=Object.keys(this.events).filter(function(st){return He.events[st]&&He.events[st].length}),We=Object.keys(this.onceEvents).filter(function(st){return He.onceEvents[st]&&He.onceEvents[st].length});return r(r(r([],Ve,!0),We,!0),Array.from(this._symbolKeys).filter(function(st){return st in He.events&&He.events[st]&&He.events[st].length||st in He.onceEvents&&He.onceEvents[st]&&He.onceEvents[st].length}),!0)}}function Xe(He){return this.emit===o?this.events[He]&&this.events[He].length||0:(this.events[He]&&this.events[He].length||0)+(this.onceEvents[He]&&this.onceEvents[He].length||0)}return c.prototype.emit=o,c.prototype.on=g,c.prototype.once=f,c.prototype.addListener=g,c.prototype.removeListener=b,c.prototype.addListenerBound=_,c.prototype.removeListenerBound=L,c.prototype.hasListeners=q,c.prototype.prependListener=X,c.prototype.prependOnceListener=te,c.prototype.off=b,c.prototype.removeAllListeners=ne,c.prototype.setMaxListeners=Ce,c.prototype.getMaxListeners=Le,c.prototype.listeners=Ge,c.prototype.eventNames=ze,c.prototype.listenerCount=Xe,ee$1}var hasRequiredLib$3;function requireLib$3(){return hasRequiredLib$3||(hasRequiredLib$3=1,(function(r){var t=lib$5&&lib$5.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=lib$5&&lib$5.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireTypes$1(),r),n(requireEe$1(),r)})(lib$5)),lib$5}var libExports$1=requireLib$3(),browser$2={exports:{}},ms$2,hasRequiredMs$2;function requireMs$2(){if(hasRequiredMs$2)return ms$2;hasRequiredMs$2=1;var r=1e3,t=r*60,n=t*60,s=n*24,o=s*7,a=s*365.25;ms$2=function(_,L){L=L||{};var q=typeof _;if(q==="string"&&_.length>0)return c(_);if(q==="number"&&isFinite(_))return L.long?g(_):f(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function c(_){if(_=String(_),!(_.length>100)){var L=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(L){var q=parseFloat(L[1]),X=(L[2]||"ms").toLowerCase();switch(X){case"years":case"year":case"yrs":case"yr":case"y":return q*a;case"weeks":case"week":case"w":return q*o;case"days":case"day":case"d":return q*s;case"hours":case"hour":case"hrs":case"hr":case"h":return q*n;case"minutes":case"minute":case"mins":case"min":case"m":return q*t;case"seconds":case"second":case"secs":case"sec":case"s":return q*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return q;default:return}}}}function f(_){var L=Math.abs(_);return L>=s?Math.round(_/s)+"d":L>=n?Math.round(_/n)+"h":L>=t?Math.round(_/t)+"m":L>=r?Math.round(_/r)+"s":_+"ms"}function g(_){var L=Math.abs(_);return L>=s?b(_,L,s,"day"):L>=n?b(_,L,n,"hour"):L>=t?b(_,L,t,"minute"):L>=r?b(_,L,r,"second"):_+" ms"}function b(_,L,q,X){var te=L>=q*1.5;return Math.round(_/q)+" "+X+(te?"s":"")}return ms$2}var common$2,hasRequiredCommon$2;function requireCommon$2(){if(hasRequiredCommon$2)return common$2;hasRequiredCommon$2=1;function r(t){s.debug=s,s.default=s,s.coerce=b,s.disable=f,s.enable=a,s.enabled=g,s.humanize=requireMs$2(),s.destroy=_,Object.keys(t).forEach(L=>{s[L]=t[L]}),s.names=[],s.skips=[],s.formatters={};function n(L){let q=0;for(let X=0;X<L.length;X++)q=(q<<5)-q+L.charCodeAt(X),q|=0;return s.colors[Math.abs(q)%s.colors.length]}s.selectColor=n;function s(L){let q,X=null,te,ne;function Ce(...Le){if(!Ce.enabled)return;const Ge=Ce,ze=Number(new Date),Xe=ze-(q||ze);Ge.diff=Xe,Ge.prev=q,Ge.curr=ze,q=ze,Le[0]=s.coerce(Le[0]),typeof Le[0]!="string"&&Le.unshift("%O");let He=0;Le[0]=Le[0].replace(/%([a-zA-Z%])/g,(We,rt)=>{if(We==="%%")return"%";He++;const st=s.formatters[rt];if(typeof st=="function"){const ht=Le[He];We=st.call(Ge,ht),Le.splice(He,1),He--}return We}),s.formatArgs.call(Ge,Le),(Ge.log||s.log).apply(Ge,Le)}return Ce.namespace=L,Ce.useColors=s.useColors(),Ce.color=s.selectColor(L),Ce.extend=o,Ce.destroy=s.destroy,Object.defineProperty(Ce,"enabled",{enumerable:!0,configurable:!1,get:()=>X!==null?X:(te!==s.namespaces&&(te=s.namespaces,ne=s.enabled(L)),ne),set:Le=>{X=Le}}),typeof s.init=="function"&&s.init(Ce),Ce}function o(L,q){const X=s(this.namespace+(typeof q>"u"?":":q)+L);return X.log=this.log,X}function a(L){s.save(L),s.namespaces=L,s.names=[],s.skips=[];const q=(typeof L=="string"?L:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const X of q)X[0]==="-"?s.skips.push(X.slice(1)):s.names.push(X)}function c(L,q){let X=0,te=0,ne=-1,Ce=0;for(;X<L.length;)if(te<q.length&&(q[te]===L[X]||q[te]==="*"))q[te]==="*"?(ne=te,Ce=X,te++):(X++,te++);else if(ne!==-1)te=ne+1,Ce++,X=Ce;else return!1;for(;te<q.length&&q[te]==="*";)te++;return te===q.length}function f(){const L=[...s.names,...s.skips.map(q=>"-"+q)].join(",");return s.enable(""),L}function g(L){for(const q of s.skips)if(c(L,q))return!1;for(const q of s.names)if(c(L,q))return!0;return!1}function b(L){return L instanceof Error?L.stack||L.message:L}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return common$2=r,common$2}var hasRequiredBrowser$2;function requireBrowser$2(){return hasRequiredBrowser$2||(hasRequiredBrowser$2=1,(function(r,t){var n={};t.formatArgs=o,t.save=a,t.load=c,t.useColors=s,t.storage=f(),t.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let b;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(b[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;b.splice(1,0,_,"color: inherit");let L=0,q=0;b[0].replace(/%[a-zA-Z%]/g,X=>{X!=="%%"&&(L++,X==="%c"&&(q=L))}),b.splice(q,0,_)}t.log=console.debug||console.log||(()=>{});function a(b){try{b?t.storage.setItem("debug",b):t.storage.removeItem("debug")}catch{}}function c(){let b;try{b=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=n.DEBUG),b}function f(){try{return localStorage}catch{}}r.exports=requireCommon$2()(t);const{formatters:g}=r.exports;g.j=function(b){try{return JSON.stringify(b)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}})(browser$2,browser$2.exports)),browser$2.exports}var browserExports$2=requireBrowser$2();const createDebug2=getDefaultExportFromCjs(browserExports$2);function number$5(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bytes$5(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash$3(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$5(r.outputLen),number$5(r.blockLen)}function exists$5(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$5(r,t){bytes$5(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const crypto$6=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$5=r=>r instanceof Uint8Array,createView$7=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr$5=(r,t)=>r<<32-t|r>>>t,isLE$5=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$5)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$9(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$7(r){if(typeof r=="string"&&(r=utf8ToBytes$9(r)),!u8a$5(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes$7(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$5(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$5=class{clone(){return this._cloneInto()}};function wrapConstructor$3(r){const t=s=>r().update(toBytes$7(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$5(r=32){if(crypto$6&&typeof crypto$6.getRandomValues=="function")return crypto$6.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$7(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}let SHA2$3=class extends Hash$5{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$7(this.buffer)}update(t){exists$5(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes$7(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$7(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){exists$5(this),output$5(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$7(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$7(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}};const Chi$5=(r,t,n)=>r&t^~r&n,Maj$5=(r,t,n)=>r&t^r&n^t&n,SHA256_K$5=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$3=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$5=new Uint32Array(64);let SHA256$5=class extends SHA2$3{constructor(){super(64,32,8,!1),this.A=IV$3[0]|0,this.B=IV$3[1]|0,this.C=IV$3[2]|0,this.D=IV$3[3]|0,this.E=IV$3[4]|0,this.F=IV$3[5]|0,this.G=IV$3[6]|0,this.H=IV$3[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$5[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$5[L-15],X=SHA256_W$5[L-2],te=rotr$5(q,7)^rotr$5(q,18)^q>>>3,ne=rotr$5(X,17)^rotr$5(X,19)^X>>>10;SHA256_W$5[L]=ne+SHA256_W$5[L-7]+te+SHA256_W$5[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$5(f,6)^rotr$5(f,11)^rotr$5(f,25),X=_+q+Chi$5(f,g,b)+SHA256_K$5[L]+SHA256_W$5[L]|0,ne=(rotr$5(s,2)^rotr$5(s,13)^rotr$5(s,22))+Maj$5(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W$5.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$7=wrapConstructor$3(()=>new SHA256$5);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$j=BigInt(0),_1n$j=BigInt(1),_2n$b=BigInt(2),u8a$4=r=>r instanceof Uint8Array,hexes$5=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$6(r){if(!u8a$4(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes$5[r[n]];return t}function numberToHexUnpadded$3(r){const t=r.toString(16);return t.length&1?`0${t}`:t}function hexToNumber$3(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function hexToBytes$6(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function bytesToNumberBE$3(r){return hexToNumber$3(bytesToHex$6(r))}function bytesToNumberLE$3(r){if(!u8a$4(r))throw new Error("Uint8Array expected");return hexToNumber$3(bytesToHex$6(Uint8Array.from(r).reverse()))}function numberToBytesBE$3(r,t){return hexToBytes$6(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE$3(r,t){return numberToBytesBE$3(r,t).reverse()}function numberToVarBytesBE$1(r){return hexToBytes$6(numberToHexUnpadded$3(r))}function ensureBytes$3(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes$6(t)}catch(a){throw new Error(`${r} must be valid hex string, got "${t}". Cause: ${a}`)}else if(u8a$4(t))s=Uint8Array.from(t);else throw new Error(`${r} must be hex string or Uint8Array`);const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(`${r} expected ${n} bytes, got ${o}`);return s}function concatBytes$6(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$4(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}function equalBytes$3(r,t){if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function utf8ToBytes$8(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function bitLen$3(r){let t;for(t=0;r>_0n$j;r>>=_1n$j,t+=1);return t}function bitGet$1(r,t){return r>>BigInt(t)&_1n$j}const bitSet$1=(r,t,n)=>r|(n?_1n$j:_0n$j)<<BigInt(t),bitMask$3=r=>(_2n$b<<BigInt(r-1))-_1n$j,u8n$1=r=>new Uint8Array(r),u8fr$1=r=>Uint8Array.from(r);function createHmacDrbg$3(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let s=u8n$1(r),o=u8n$1(r),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...L)=>n(o,s,...L),g=(L=u8n$1())=>{o=f(u8fr$1([0]),L),s=f(),L.length!==0&&(o=f(u8fr$1([1]),L),s=f())},b=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let L=0;const q=[];for(;L<t;){s=f();const X=s.slice();q.push(X),L+=s.length}return concatBytes$6(...q)};return(L,q)=>{c(),g(L);let X;for(;!(X=q(b()));)g();return c(),X}}const validatorFns$1={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function validateObject$1(r,t,n={}){const s=(o,a,c)=>{const f=validatorFns$1[a];if(typeof f!="function")throw new Error(`Invalid validator "${a}", expected function`);const g=r[o];if(!(c&&g===void 0)&&!f(g,r))throw new Error(`Invalid param ${String(o)}=${g} (${typeof g}), expected ${a}`)};for(const[o,a]of Object.entries(t))s(o,a,!1);for(const[o,a]of Object.entries(n))s(o,a,!0);return r}const ut$1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:bitGet$1,bitLen:bitLen$3,bitMask:bitMask$3,bitSet:bitSet$1,bytesToHex:bytesToHex$6,bytesToNumberBE:bytesToNumberBE$3,bytesToNumberLE:bytesToNumberLE$3,concatBytes:concatBytes$6,createHmacDrbg:createHmacDrbg$3,ensureBytes:ensureBytes$3,equalBytes:equalBytes$3,hexToBytes:hexToBytes$6,hexToNumber:hexToNumber$3,numberToBytesBE:numberToBytesBE$3,numberToBytesLE:numberToBytesLE$3,numberToHexUnpadded:numberToHexUnpadded$3,numberToVarBytesBE:numberToVarBytesBE$1,utf8ToBytes:utf8ToBytes$8,validateObject:validateObject$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$i=BigInt(0),_1n$i=BigInt(1),_2n$a=BigInt(2),_3n$7=BigInt(3),_4n$5=BigInt(4),_5n$3=BigInt(5),_8n$3=BigInt(8);BigInt(9);BigInt(16);function mod$3(r,t){const n=r%t;return n>=_0n$i?n:t+n}function pow$1(r,t,n){if(n<=_0n$i||t<_0n$i)throw new Error("Expected power/modulo > 0");if(n===_1n$i)return _0n$i;let s=_1n$i;for(;t>_0n$i;)t&_1n$i&&(s=s*r%n),r=r*r%n,t>>=_1n$i;return s}function pow2$3(r,t,n){let s=r;for(;t-- >_0n$i;)s*=s,s%=n;return s}function invert$3(r,t){if(r===_0n$i||t<=_0n$i)throw new Error(`invert: expected positive integers, got n=${r} mod=${t}`);let n=mod$3(r,t),s=t,o=_0n$i,a=_1n$i;for(;n!==_0n$i;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n$i)throw new Error("invert: does not exist");return mod$3(o,t)}function tonelliShanks$3(r){const t=(r-_1n$i)/_2n$a;let n,s,o;for(n=r-_1n$i,s=0;n%_2n$a===_0n$i;n/=_2n$a,s++);for(o=_2n$a;o<r&&pow$1(o,t,r)!==r-_1n$i;o++);if(s===1){const c=(r+_1n$i)/_4n$5;return function(g,b){const _=g.pow(b,c);if(!g.eql(g.sqr(_),b))throw new Error("Cannot find square root");return _}}const a=(n+_1n$i)/_2n$a;return function(f,g){if(f.pow(g,t)===f.neg(f.ONE))throw new Error("Cannot find square root");let b=s,_=f.pow(f.mul(f.ONE,o),n),L=f.pow(g,a),q=f.pow(g,n);for(;!f.eql(q,f.ONE);){if(f.eql(q,f.ZERO))return f.ZERO;let X=1;for(let ne=f.sqr(q);X<b&&!f.eql(ne,f.ONE);X++)ne=f.sqr(ne);const te=f.pow(_,_1n$i<<BigInt(b-X-1));_=f.sqr(te),L=f.mul(L,te),q=f.mul(q,_),b=X}return L}}function FpSqrt$3(r){if(r%_4n$5===_3n$7){const t=(r+_1n$i)/_4n$5;return function(s,o){const a=s.pow(o,t);if(!s.eql(s.sqr(a),o))throw new Error("Cannot find square root");return a}}if(r%_8n$3===_5n$3){const t=(r-_5n$3)/_8n$3;return function(s,o){const a=s.mul(o,_2n$a),c=s.pow(a,t),f=s.mul(o,c),g=s.mul(s.mul(f,_2n$a),c),b=s.mul(f,s.sub(g,s.ONE));if(!s.eql(s.sqr(b),o))throw new Error("Cannot find square root");return b}}return tonelliShanks$3(r)}const FIELD_FIELDS$3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$3(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS$3.reduce((s,o)=>(s[o]="function",s),t);return validateObject$1(r,n)}function FpPow$3(r,t,n){if(n<_0n$i)throw new Error("Expected power > 0");if(n===_0n$i)return r.ONE;if(n===_1n$i)return t;let s=r.ONE,o=t;for(;n>_0n$i;)n&_1n$i&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n$i;return s}function FpInvertBatch$3(r,t){const n=new Array(t.length),s=t.reduce((a,c,f)=>r.is0(c)?a:(n[f]=a,r.mul(a,c)),r.ONE),o=r.inv(s);return t.reduceRight((a,c,f)=>r.is0(c)?a:(n[f]=r.mul(a,n[f]),r.mul(a,c)),o),n}function nLength$3(r,t){const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field$3(r,t,n=!1,s={}){if(r<=_0n$i)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:o,nByteLength:a}=nLength$3(r,t);if(a>2048)throw new Error("Field lengths over 2048 bytes are not supported");const c=FpSqrt$3(r),f=Object.freeze({ORDER:r,BITS:o,BYTES:a,MASK:bitMask$3(o),ZERO:_0n$i,ONE:_1n$i,create:g=>mod$3(g,r),isValid:g=>{if(typeof g!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof g}`);return _0n$i<=g&&g<r},is0:g=>g===_0n$i,isOdd:g=>(g&_1n$i)===_1n$i,neg:g=>mod$3(-g,r),eql:(g,b)=>g===b,sqr:g=>mod$3(g*g,r),add:(g,b)=>mod$3(g+b,r),sub:(g,b)=>mod$3(g-b,r),mul:(g,b)=>mod$3(g*b,r),pow:(g,b)=>FpPow$3(f,g,b),div:(g,b)=>mod$3(g*invert$3(b,r),r),sqrN:g=>g*g,addN:(g,b)=>g+b,subN:(g,b)=>g-b,mulN:(g,b)=>g*b,inv:g=>invert$3(g,r),sqrt:s.sqrt||(g=>c(f,g)),invertBatch:g=>FpInvertBatch$3(f,g),cmov:(g,b,_)=>_?b:g,toBytes:g=>n?numberToBytesLE$3(g,a):numberToBytesBE$3(g,a),fromBytes:g=>{if(g.length!==a)throw new Error(`Fp.fromBytes: expected ${a}, got ${g.length}`);return n?bytesToNumberLE$3(g):bytesToNumberBE$3(g)}});return Object.freeze(f)}function getFieldBytesLength$3(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$3(r){const t=getFieldBytesLength$3(r);return t+Math.ceil(t/2)}function mapHashToField$3(r,t,n=!1){const s=r.length,o=getFieldBytesLength$3(t),a=getMinHashLength$3(t);if(s<16||s<a||s>1024)throw new Error(`expected ${a}-1024 bytes of input, got ${s}`);const c=n?bytesToNumberBE$3(r):bytesToNumberLE$3(r),f=mod$3(c,t-_1n$i)+_1n$i;return n?numberToBytesLE$3(f,o):numberToBytesBE$3(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$h=BigInt(0),_1n$h=BigInt(1);function wNAF$3(r,t){const n=(o,a)=>{const c=a.negate();return o?c:a},s=o=>{const a=Math.ceil(t/o)+1,c=2**(o-1);return{windows:a,windowSize:c}};return{constTimeNegate:n,unsafeLadder(o,a){let c=r.ZERO,f=o;for(;a>_0n$h;)a&_1n$h&&(c=c.add(f)),f=f.double(),a>>=_1n$h;return c},precomputeWindow(o,a){const{windows:c,windowSize:f}=s(a),g=[];let b=o,_=b;for(let L=0;L<c;L++){_=b,g.push(_);for(let q=1;q<f;q++)_=_.add(b),g.push(_);b=_.double()}return g},wNAF(o,a,c){const{windows:f,windowSize:g}=s(o);let b=r.ZERO,_=r.BASE;const L=BigInt(2**o-1),q=2**o,X=BigInt(o);for(let te=0;te<f;te++){const ne=te*g;let Ce=Number(c&L);c>>=X,Ce>g&&(Ce-=q,c+=_1n$h);const Le=ne,Ge=ne+Math.abs(Ce)-1,ze=te%2!==0,Xe=Ce<0;Ce===0?_=_.add(n(ze,a[Le])):b=b.add(n(Xe,a[Ge]))}return{p:b,f:_}},wNAFCached(o,a,c,f){const g=o._WINDOW_SIZE||1;let b=a.get(o);return b||(b=this.precomputeWindow(o,g),g!==1&&a.set(o,f(b))),this.wNAF(g,b,c)}}}function validateBasic$1(r){return validateField$3(r.Fp),validateObject$1(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$3(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(r){const t=validateBasic$1(r);validateObject$1(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:s,a:o}=t;if(n){if(!s.eql(o,s.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$1,DER$3={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(r){const{Err:t}=DER$3;if(r.length<2||r[0]!==2)throw new t("Invalid signature integer tag");const n=r[1],s=r.subarray(2,n+2);if(!n||s.length!==n)throw new t("Invalid signature integer: wrong length");if(s[0]&128)throw new t("Invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(s),l:r.subarray(n+2)}},toSig(r){const{Err:t}=DER$3,n=typeof r=="string"?h2b$1(r):r;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let s=n.length;if(s<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==s-2)throw new t("Invalid signature: incorrect length");const{d:o,l:a}=DER$3._parseInt(n.subarray(2)),{d:c,l:f}=DER$3._parseInt(a);if(f.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:c}},hexFromSig(r){const t=b=>Number.parseInt(b[0],16)&8?"00"+b:b,n=b=>{const _=b.toString(16);return _.length&1?`0${_}`:_},s=t(n(r.s)),o=t(n(r.r)),a=s.length/2,c=o.length/2,f=n(a),g=n(c);return`30${n(c+a+4)}02${g}${o}02${f}${s}`}},_0n$g=BigInt(0),_1n$g=BigInt(1);BigInt(2);const _3n$6=BigInt(3);BigInt(4);function weierstrassPoints$1(r){const t=validatePointOpts$1(r),{Fp:n}=t,s=t.toBytes||((te,ne,Ce)=>{const Le=ne.toAffine();return concatBytes$6(Uint8Array.from([4]),n.toBytes(Le.x),n.toBytes(Le.y))}),o=t.fromBytes||(te=>{const ne=te.subarray(1),Ce=n.fromBytes(ne.subarray(0,n.BYTES)),Le=n.fromBytes(ne.subarray(n.BYTES,2*n.BYTES));return{x:Ce,y:Le}});function a(te){const{a:ne,b:Ce}=t,Le=n.sqr(te),Ge=n.mul(Le,te);return n.add(n.add(Ge,n.mul(te,ne)),Ce)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw new Error("bad generator point: equation left != right");function c(te){return typeof te=="bigint"&&_0n$g<te&&te<t.n}function f(te){if(!c(te))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function g(te){const{allowedPrivateKeyLengths:ne,nByteLength:Ce,wrapPrivateKey:Le,n:Ge}=t;if(ne&&typeof te!="bigint"){if(te instanceof Uint8Array&&(te=bytesToHex$6(te)),typeof te!="string"||!ne.includes(te.length))throw new Error("Invalid key");te=te.padStart(Ce*2,"0")}let ze;try{ze=typeof te=="bigint"?te:bytesToNumberBE$3(ensureBytes$3("private key",te,Ce))}catch{throw new Error(`private key must be ${Ce} bytes, hex or bigint, not ${typeof te}`)}return Le&&(ze=mod$3(ze,Ge)),f(ze),ze}const b=new Map;function _(te){if(!(te instanceof L))throw new Error("ProjectivePoint expected")}class L{constructor(ne,Ce,Le){if(this.px=ne,this.py=Ce,this.pz=Le,ne==null||!n.isValid(ne))throw new Error("x required");if(Ce==null||!n.isValid(Ce))throw new Error("y required");if(Le==null||!n.isValid(Le))throw new Error("z required")}static fromAffine(ne){const{x:Ce,y:Le}=ne||{};if(!ne||!n.isValid(Ce)||!n.isValid(Le))throw new Error("invalid affine point");if(ne instanceof L)throw new Error("projective point not allowed");const Ge=ze=>n.eql(ze,n.ZERO);return Ge(Ce)&&Ge(Le)?L.ZERO:new L(Ce,Le,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(ne){const Ce=n.invertBatch(ne.map(Le=>Le.pz));return ne.map((Le,Ge)=>Le.toAffine(Ce[Ge])).map(L.fromAffine)}static fromHex(ne){const Ce=L.fromAffine(o(ensureBytes$3("pointHex",ne)));return Ce.assertValidity(),Ce}static fromPrivateKey(ne){return L.BASE.multiply(g(ne))}_setWindowSize(ne){this._WINDOW_SIZE=ne,b.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:ne,y:Ce}=this.toAffine();if(!n.isValid(ne)||!n.isValid(Ce))throw new Error("bad point: x or y not FE");const Le=n.sqr(Ce),Ge=a(ne);if(!n.eql(Le,Ge))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:ne}=this.toAffine();if(n.isOdd)return!n.isOdd(ne);throw new Error("Field doesn't support isOdd")}equals(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne,Ve=n.eql(n.mul(Ce,He),n.mul(ze,Ge)),We=n.eql(n.mul(Le,He),n.mul(Xe,Ge));return Ve&&We}negate(){return new L(this.px,n.neg(this.py),this.pz)}double(){const{a:ne,b:Ce}=t,Le=n.mul(Ce,_3n$6),{px:Ge,py:ze,pz:Xe}=this;let He=n.ZERO,Ve=n.ZERO,We=n.ZERO,rt=n.mul(Ge,Ge),st=n.mul(ze,ze),ht=n.mul(Xe,Xe),je=n.mul(Ge,ze);return je=n.add(je,je),We=n.mul(Ge,Xe),We=n.add(We,We),He=n.mul(ne,We),Ve=n.mul(Le,ht),Ve=n.add(He,Ve),He=n.sub(st,Ve),Ve=n.add(st,Ve),Ve=n.mul(He,Ve),He=n.mul(je,He),We=n.mul(Le,We),ht=n.mul(ne,ht),je=n.sub(rt,ht),je=n.mul(ne,je),je=n.add(je,We),We=n.add(rt,rt),rt=n.add(We,rt),rt=n.add(rt,ht),rt=n.mul(rt,je),Ve=n.add(Ve,rt),ht=n.mul(ze,Xe),ht=n.add(ht,ht),rt=n.mul(ht,je),He=n.sub(He,rt),We=n.mul(ht,st),We=n.add(We,We),We=n.add(We,We),new L(He,Ve,We)}add(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne;let Ve=n.ZERO,We=n.ZERO,rt=n.ZERO;const st=t.a,ht=n.mul(t.b,_3n$6);let je=n.mul(Ce,ze),se=n.mul(Le,Xe),m=n.mul(Ge,He),A=n.add(Ce,Le),k=n.add(ze,Xe);A=n.mul(A,k),k=n.add(je,se),A=n.sub(A,k),k=n.add(Ce,Ge);let Y=n.add(ze,He);return k=n.mul(k,Y),Y=n.add(je,m),k=n.sub(k,Y),Y=n.add(Le,Ge),Ve=n.add(Xe,He),Y=n.mul(Y,Ve),Ve=n.add(se,m),Y=n.sub(Y,Ve),rt=n.mul(st,k),Ve=n.mul(ht,m),rt=n.add(Ve,rt),Ve=n.sub(se,rt),rt=n.add(se,rt),We=n.mul(Ve,rt),se=n.add(je,je),se=n.add(se,je),m=n.mul(st,m),k=n.mul(ht,k),se=n.add(se,m),m=n.sub(je,m),m=n.mul(st,m),k=n.add(k,m),je=n.mul(se,k),We=n.add(We,je),je=n.mul(Y,k),Ve=n.mul(A,Ve),Ve=n.sub(Ve,je),je=n.mul(A,se),rt=n.mul(Y,rt),rt=n.add(rt,je),new L(Ve,We,rt)}subtract(ne){return this.add(ne.negate())}is0(){return this.equals(L.ZERO)}wNAF(ne){return X.wNAFCached(this,b,ne,Ce=>{const Le=n.invertBatch(Ce.map(Ge=>Ge.pz));return Ce.map((Ge,ze)=>Ge.toAffine(Le[ze])).map(L.fromAffine)})}multiplyUnsafe(ne){const Ce=L.ZERO;if(ne===_0n$g)return Ce;if(f(ne),ne===_1n$g)return this;const{endo:Le}=t;if(!Le)return X.unsafeLadder(this,ne);let{k1neg:Ge,k1:ze,k2neg:Xe,k2:He}=Le.splitScalar(ne),Ve=Ce,We=Ce,rt=this;for(;ze>_0n$g||He>_0n$g;)ze&_1n$g&&(Ve=Ve.add(rt)),He&_1n$g&&(We=We.add(rt)),rt=rt.double(),ze>>=_1n$g,He>>=_1n$g;return Ge&&(Ve=Ve.negate()),Xe&&(We=We.negate()),We=new L(n.mul(We.px,Le.beta),We.py,We.pz),Ve.add(We)}multiply(ne){f(ne);let Ce=ne,Le,Ge;const{endo:ze}=t;if(ze){const{k1neg:Xe,k1:He,k2neg:Ve,k2:We}=ze.splitScalar(Ce);let{p:rt,f:st}=this.wNAF(He),{p:ht,f:je}=this.wNAF(We);rt=X.constTimeNegate(Xe,rt),ht=X.constTimeNegate(Ve,ht),ht=new L(n.mul(ht.px,ze.beta),ht.py,ht.pz),Le=rt.add(ht),Ge=st.add(je)}else{const{p:Xe,f:He}=this.wNAF(Ce);Le=Xe,Ge=He}return L.normalizeZ([Le,Ge])[0]}multiplyAndAddUnsafe(ne,Ce,Le){const Ge=L.BASE,ze=(He,Ve)=>Ve===_0n$g||Ve===_1n$g||!He.equals(Ge)?He.multiplyUnsafe(Ve):He.multiply(Ve),Xe=ze(this,Ce).add(ze(ne,Le));return Xe.is0()?void 0:Xe}toAffine(ne){const{px:Ce,py:Le,pz:Ge}=this,ze=this.is0();ne==null&&(ne=ze?n.ONE:n.inv(Ge));const Xe=n.mul(Ce,ne),He=n.mul(Le,ne),Ve=n.mul(Ge,ne);if(ze)return{x:n.ZERO,y:n.ZERO};if(!n.eql(Ve,n.ONE))throw new Error("invZ was invalid");return{x:Xe,y:He}}isTorsionFree(){const{h:ne,isTorsionFree:Ce}=t;if(ne===_1n$g)return!0;if(Ce)return Ce(L,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:ne,clearCofactor:Ce}=t;return ne===_1n$g?this:Ce?Ce(L,this):this.multiplyUnsafe(t.h)}toRawBytes(ne=!0){return this.assertValidity(),s(L,this,ne)}toHex(ne=!0){return bytesToHex$6(this.toRawBytes(ne))}}L.BASE=new L(t.Gx,t.Gy,n.ONE),L.ZERO=new L(n.ZERO,n.ONE,n.ZERO);const q=t.nBitLength,X=wNAF$3(L,t.endo?Math.ceil(q/2):q);return{CURVE:t,ProjectivePoint:L,normPrivateKeyToScalar:g,weierstrassEquation:a,isWithinCurveOrder:c}}function validateOpts$1(r){const t=validateBasic$1(r);return validateObject$1(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$3(r){const t=validateOpts$1(r),{Fp:n,n:s}=t,o=n.BYTES+1,a=2*n.BYTES+1;function c(k){return _0n$g<k&&k<n.ORDER}function f(k){return mod$3(k,s)}function g(k){return invert$3(k,s)}const{ProjectivePoint:b,normPrivateKeyToScalar:_,weierstrassEquation:L,isWithinCurveOrder:q}=weierstrassPoints$1({...t,toBytes(k,Y,Q){const $e=Y.toAffine(),ve=n.toBytes($e.x),re=concatBytes$6;return Q?re(Uint8Array.from([Y.hasEvenY()?2:3]),ve):re(Uint8Array.from([4]),ve,n.toBytes($e.y))},fromBytes(k){const Y=k.length,Q=k[0],$e=k.subarray(1);if(Y===o&&(Q===2||Q===3)){const ve=bytesToNumberBE$3($e);if(!c(ve))throw new Error("Point is not on curve");const re=L(ve);let B=n.sqrt(re);const oe=(B&_1n$g)===_1n$g;return(Q&1)===1!==oe&&(B=n.neg(B)),{x:ve,y:B}}else if(Y===a&&Q===4){const ve=n.fromBytes($e.subarray(0,n.BYTES)),re=n.fromBytes($e.subarray(n.BYTES,2*n.BYTES));return{x:ve,y:re}}else throw new Error(`Point of length ${Y} was invalid. Expected ${o} compressed bytes or ${a} uncompressed bytes`)}}),X=k=>bytesToHex$6(numberToBytesBE$3(k,t.nByteLength));function te(k){const Y=s>>_1n$g;return k>Y}function ne(k){return te(k)?f(-k):k}const Ce=(k,Y,Q)=>bytesToNumberBE$3(k.slice(Y,Q));class Le{constructor(Y,Q,$e){this.r=Y,this.s=Q,this.recovery=$e,this.assertValidity()}static fromCompact(Y){const Q=t.nByteLength;return Y=ensureBytes$3("compactSignature",Y,Q*2),new Le(Ce(Y,0,Q),Ce(Y,Q,2*Q))}static fromDER(Y){const{r:Q,s:$e}=DER$3.toSig(ensureBytes$3("DER",Y));return new Le(Q,$e)}assertValidity(){if(!q(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!q(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Y){return new Le(this.r,this.s,Y)}recoverPublicKey(Y){const{r:Q,s:$e,recovery:ve}=this,re=We(ensureBytes$3("msgHash",Y));if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");const B=ve===2||ve===3?Q+t.n:Q;if(B>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const oe=(ve&1)===0?"02":"03",Ue=b.fromHex(oe+X(B)),Ze=g(B),lt=f(-re*Ze),St=f($e*Ze),Mt=b.BASE.multiplyAndAddUnsafe(Ue,lt,St);if(!Mt)throw new Error("point at infinify");return Mt.assertValidity(),Mt}hasHighS(){return te(this.s)}normalizeS(){return this.hasHighS()?new Le(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$6(this.toDERHex())}toDERHex(){return DER$3.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$6(this.toCompactHex())}toCompactHex(){return X(this.r)+X(this.s)}}const Ge={isValidPrivateKey(k){try{return _(k),!0}catch{return!1}},normPrivateKeyToScalar:_,randomPrivateKey:()=>{const k=getMinHashLength$3(t.n);return mapHashToField$3(t.randomBytes(k),t.n)},precompute(k=8,Y=b.BASE){return Y._setWindowSize(k),Y.multiply(BigInt(3)),Y}};function ze(k,Y=!0){return b.fromPrivateKey(k).toRawBytes(Y)}function Xe(k){const Y=k instanceof Uint8Array,Q=typeof k=="string",$e=(Y||Q)&&k.length;return Y?$e===o||$e===a:Q?$e===2*o||$e===2*a:k instanceof b}function He(k,Y,Q=!0){if(Xe(k))throw new Error("first arg must be private key");if(!Xe(Y))throw new Error("second arg must be public key");return b.fromHex(Y).multiply(_(k)).toRawBytes(Q)}const Ve=t.bits2int||function(k){const Y=bytesToNumberBE$3(k),Q=k.length*8-t.nBitLength;return Q>0?Y>>BigInt(Q):Y},We=t.bits2int_modN||function(k){return f(Ve(k))},rt=bitMask$3(t.nBitLength);function st(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(_0n$g<=k&&k<rt))throw new Error(`bigint expected < 2^${t.nBitLength}`);return numberToBytesBE$3(k,t.nByteLength)}function ht(k,Y,Q=je){if(["recovered","canonical"].some(Zt=>Zt in Q))throw new Error("sign() legacy options not supported");const{hash:$e,randomBytes:ve}=t;let{lowS:re,prehash:B,extraEntropy:oe}=Q;re==null&&(re=!0),k=ensureBytes$3("msgHash",k),B&&(k=ensureBytes$3("prehashed msgHash",$e(k)));const Ue=We(k),Ze=_(Y),lt=[st(Ze),st(Ue)];if(oe!=null){const Zt=oe===!0?ve(n.BYTES):oe;lt.push(ensureBytes$3("extraEntropy",Zt))}const St=concatBytes$6(...lt),Mt=Ue;function Ft(Zt){const Ut=Ve(Zt);if(!q(Ut))return;const vr=g(Ut),zr=b.BASE.multiply(Ut).toAffine(),or=f(zr.x);if(or===_0n$g)return;const sr=f(vr*f(Mt+or*Ze));if(sr===_0n$g)return;let er=(zr.x===or?0:2)|Number(zr.y&_1n$g),Xt=sr;return re&&te(sr)&&(Xt=ne(sr),er^=1),new Le(or,Xt,er)}return{seed:St,k2sig:Ft}}const je={lowS:t.lowS,prehash:!1},se={lowS:t.lowS,prehash:!1};function m(k,Y,Q=je){const{seed:$e,k2sig:ve}=ht(k,Y,Q),re=t;return createHmacDrbg$3(re.hash.outputLen,re.nByteLength,re.hmac)($e,ve)}b.BASE._setWindowSize(8);function A(k,Y,Q,$e=se){const ve=k;if(Y=ensureBytes$3("msgHash",Y),Q=ensureBytes$3("publicKey",Q),"strict"in $e)throw new Error("options.strict was renamed to lowS");const{lowS:re,prehash:B}=$e;let oe,Ue;try{if(typeof ve=="string"||ve instanceof Uint8Array)try{oe=Le.fromDER(ve)}catch(zr){if(!(zr instanceof DER$3.Err))throw zr;oe=Le.fromCompact(ve)}else if(typeof ve=="object"&&typeof ve.r=="bigint"&&typeof ve.s=="bigint"){const{r:zr,s:or}=ve;oe=new Le(zr,or)}else throw new Error("PARSE");Ue=b.fromHex(Q)}catch(zr){if(zr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(re&&oe.hasHighS())return!1;B&&(Y=t.hash(Y));const{r:Ze,s:lt}=oe,St=We(Y),Mt=g(lt),Ft=f(St*Mt),Zt=f(Ze*Mt),Ut=b.BASE.multiplyAndAddUnsafe(Ue,Ft,Zt)?.toAffine();return Ut?f(Ut.x)===Ze:!1}return{CURVE:t,getPublicKey:ze,getSharedSecret:He,sign:m,verify:A,ProjectivePoint:b,Signature:Le,utils:Ge}}let HMAC$5=class extends Hash$5{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,hash$3(t);const s=toBytes$7(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return exists$5(this),this.iHash.update(t),this}digestInto(t){exists$5(this),bytes$5(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$5=(r,t,n)=>new HMAC$5(r,t).update(n).digest();hmac$5.create=(r,t)=>new HMAC$5(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$1(r){return{hash:r,hmac:(t,...n)=>hmac$5(r,t,concatBytes$7(...n)),randomBytes:randomBytes$5}}function createCurve$3(r,t){const n=s=>weierstrass$3({...r,...getHash$1(s)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$f=BigInt(1),_2n$9=BigInt(2),divNearest$3=(r,t)=>(r+t/_2n$9)/t;function sqrtMod$3(r){const t=secp256k1P$1,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow2$3(_,n,t)*_%t,q=pow2$3(L,n,t)*_%t,X=pow2$3(q,_2n$9,t)*b%t,te=pow2$3(X,o,t)*X%t,ne=pow2$3(te,a,t)*te%t,Ce=pow2$3(ne,f,t)*ne%t,Le=pow2$3(Ce,g,t)*Ce%t,Ge=pow2$3(Le,f,t)*ne%t,ze=pow2$3(Ge,n,t)*_%t,Xe=pow2$3(ze,c,t)*te%t,He=pow2$3(Xe,s,t)*b%t,Ve=pow2$3(He,_2n$9,t);if(!Fp$1.eql(Fp$1.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}const Fp$1=Field$3(secp256k1P$1,void 0,void 0,{sqrt:sqrtMod$3}),secp256k1$3=createCurve$3({a:BigInt(0),b:BigInt(7),Fp:Fp$1,n:secp256k1N$1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const t=secp256k1N$1,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n$f*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,c=BigInt("0x100000000000000000000000000000000"),f=divNearest$3(a*r,t),g=divNearest$3(-s*r,t);let b=mod$3(r-f*n-g*o,t),_=mod$3(-f*s-g*a,t);const L=b>c,q=_>c;if(L&&(b=t-b),q&&(_=t-_),b>c||_>c)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}}},sha256$7),_0n$f=BigInt(0),fe$2=r=>typeof r=="bigint"&&_0n$f<r&&r<secp256k1P$1,ge$2=r=>typeof r=="bigint"&&_0n$f<r&&r<secp256k1N$1,TAGGED_HASH_PREFIXES$3={};function taggedHash$3(r,...t){let n=TAGGED_HASH_PREFIXES$3[r];if(n===void 0){const s=sha256$7(Uint8Array.from(r,o=>o.charCodeAt(0)));n=concatBytes$6(s,s),TAGGED_HASH_PREFIXES$3[r]=n}return sha256$7(concatBytes$6(n,...t))}const pointToBytes$3=r=>r.toRawBytes(!0).slice(1),numTo32b$1=r=>numberToBytesBE$3(r,32),modP$1=r=>mod$3(r,secp256k1P$1),modN$1=r=>mod$3(r,secp256k1N$1),Point$2=secp256k1$3.ProjectivePoint,GmulAdd$1=(r,t,n)=>Point$2.BASE.multiplyAndAddUnsafe(r,t,n);function schnorrGetExtPubKey$3(r){let t=secp256k1$3.utils.normPrivateKeyToScalar(r),n=Point$2.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:modN$1(-t),bytes:pointToBytes$3(n)}}function lift_x$3(r){if(!fe$2(r))throw new Error("bad x: need 0 < x < p");const t=modP$1(r*r),n=modP$1(t*r+BigInt(7));let s=sqrtMod$3(n);s%_2n$9!==_0n$f&&(s=modP$1(-s));const o=new Point$2(r,s,_1n$f);return o.assertValidity(),o}function challenge$3(...r){return modN$1(bytesToNumberBE$3(taggedHash$3("BIP0340/challenge",...r)))}function schnorrGetPublicKey$3(r){return schnorrGetExtPubKey$3(r).bytes}function schnorrSign$3(r,t,n=randomBytes$5(32)){const s=ensureBytes$3("message",r),{bytes:o,scalar:a}=schnorrGetExtPubKey$3(t),c=ensureBytes$3("auxRand",n,32),f=numTo32b$1(a^bytesToNumberBE$3(taggedHash$3("BIP0340/aux",c))),g=taggedHash$3("BIP0340/nonce",f,o,s),b=modN$1(bytesToNumberBE$3(g));if(b===_0n$f)throw new Error("sign failed: k is zero");const{bytes:_,scalar:L}=schnorrGetExtPubKey$3(b),q=challenge$3(_,o,s),X=new Uint8Array(64);if(X.set(_,0),X.set(numTo32b$1(modN$1(L+q*a)),32),!schnorrVerify$3(X,s,o))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify$3(r,t,n){const s=ensureBytes$3("signature",r,64),o=ensureBytes$3("message",t),a=ensureBytes$3("publicKey",n,32);try{const c=lift_x$3(bytesToNumberBE$3(a)),f=bytesToNumberBE$3(s.subarray(0,32));if(!fe$2(f))return!1;const g=bytesToNumberBE$3(s.subarray(32,64));if(!ge$2(g))return!1;const b=challenge$3(numTo32b$1(f),pointToBytes$3(c),o),_=GmulAdd$1(c,g,modN$1(-b));return!(!_||!_.hasEvenY()||_.toAffine().x!==f)}catch{return!1}}const schnorr$3={getPublicKey:schnorrGetPublicKey$3,sign:schnorrSign$3,verify:schnorrVerify$3,utils:{randomPrivateKey:secp256k1$3.utils.randomPrivateKey,lift_x:lift_x$3,pointToBytes:pointToBytes$3,numberToBytesBE:numberToBytesBE$3,bytesToNumberBE:bytesToNumberBE$3,taggedHash:taggedHash$3,mod:mod$3}},crypto$5=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$3=r=>r instanceof Uint8Array,u32$3=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView$6=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr$4=(r,t)=>r<<32-t|r>>>t,isLE$4=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$4)throw new Error("Non little-endian hardware is not supported");const hexes$4=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$5(r){if(!u8a$3(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes$4[r[n]];return t}function hexToBytes$5(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function utf8ToBytes$7(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$6(r){if(typeof r=="string"&&(r=utf8ToBytes$7(r)),!u8a$3(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes$5(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$3(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$4=class{clone(){return this._cloneInto()}};const isPlainObject$2=r=>Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object;function checkOpts$3(r,t){if(t!==void 0&&(typeof t!="object"||!isPlainObject$2(t)))throw new Error("Options should be object or undefined");return Object.assign(r,t)}function wrapConstructor$2(r){const t=s=>r().update(toBytes$6(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$4(r=32){if(crypto$5&&typeof crypto$5.getRandomValues=="function")return crypto$5.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function number$4(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bool$3(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function bytes$4(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash$2(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$4(r.outputLen),number$4(r.blockLen)}function exists$4(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$4(r,t){bytes$4(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const assert$1={number:number$4,bool:bool$3,bytes:bytes$4,hash:hash$2,exists:exists$4,output:output$4};function setBigUint64$6(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}let SHA2$2=class extends Hash$4{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$6(this.buffer)}update(t){assert$1.exists(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes$6(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$6(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){assert$1.exists(this),assert$1.output(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$6(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$6(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}};const Chi$4=(r,t,n)=>r&t^~r&n,Maj$4=(r,t,n)=>r&t^r&n^t&n,SHA256_K$4=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$2=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$4=new Uint32Array(64);let SHA256$4=class extends SHA2$2{constructor(){super(64,32,8,!1),this.A=IV$2[0]|0,this.B=IV$2[1]|0,this.C=IV$2[2]|0,this.D=IV$2[3]|0,this.E=IV$2[4]|0,this.F=IV$2[5]|0,this.G=IV$2[6]|0,this.H=IV$2[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$4[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$4[L-15],X=SHA256_W$4[L-2],te=rotr$4(q,7)^rotr$4(q,18)^q>>>3,ne=rotr$4(X,17)^rotr$4(X,19)^X>>>10;SHA256_W$4[L]=ne+SHA256_W$4[L-7]+te+SHA256_W$4[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$4(f,6)^rotr$4(f,11)^rotr$4(f,25),X=_+q+Chi$4(f,g,b)+SHA256_K$4[L]+SHA256_W$4[L]|0,ne=(rotr$4(s,2)^rotr$4(s,13)^rotr$4(s,22))+Maj$4(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W$4.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},SHA224$1=class extends SHA256$4{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const sha256$6=wrapConstructor$2(()=>new SHA256$4);wrapConstructor$2(()=>new SHA224$1);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber$1(r){if(!Number.isSafeInteger(r))throw new Error(`Wrong integer: ${r}`)}function chain$2(...r){const t=(o,a)=>c=>o(a(c)),n=Array.from(r).reverse().reduce((o,a)=>o?t(o,a.encode):a.encode,void 0),s=r.reduce((o,a)=>o?t(o,a.decode):a.decode,void 0);return{encode:n,decode:s}}function alphabet$2(r){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(assertNumber$1(n),n<0||n>=r.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${r.length})`);return r[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=r.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${r}`);return s})}}}function join$3(r=""){if(typeof r!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(r)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(r)}}}function padding$1(r,t="="){if(assertNumber$1(r),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;n.length*r%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let s=n.length;if(s*r%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&n[s-1]===t;s--)if(!((s-1)*r%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,s)}}}function normalize$4(r){if(typeof r!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>r(t)}}function convertRadix$2(r,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(r))throw new Error("convertRadix: data should be array");if(!r.length)return[];let s=0;const o=[],a=Array.from(r);for(a.forEach(c=>{if(assertNumber$1(c),c<0||c>=t)throw new Error(`Wrong integer: ${c}`)});;){let c=0,f=!0;for(let g=s;g<a.length;g++){const b=a[g],_=t*c+b;if(!Number.isSafeInteger(_)||t*c/t!==c||_-b!==t*c)throw new Error("convertRadix: carry overflow");if(c=_%n,a[g]=Math.floor(_/n),!Number.isSafeInteger(a[g])||a[g]*n+c!==_)throw new Error("convertRadix: carry overflow");if(f)a[g]?f=!1:s=g;else continue}if(o.push(c),f)break}for(let c=0;c<r.length-1&&r[c]===0;c++)o.push(0);return o.reverse()}const gcd$2=(r,t)=>t?gcd$2(t,r%t):r,radix2carry$2=(r,t)=>r+(t-gcd$2(r,t));function convertRadix2$2(r,t,n,s){if(!Array.isArray(r))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry$2(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${radix2carry$2(t,n)}`);let o=0,a=0;const c=2**n-1,f=[];for(const g of r){if(assertNumber$1(g),g>=2**t)throw new Error(`convertRadix2: invalid data word=${g} from=${t}`);if(o=o<<t|g,a+t>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${t}`);for(a+=t;a>=n;a-=n)f.push((o>>a-n&c)>>>0);o&=2**a-1}if(o=o<<n-a&c,!s&&a>=t)throw new Error("Excess padding");if(!s&&o)throw new Error(`Non-zero padding: ${o}`);return s&&a>0&&f.push(o>>>0),f}function radix$2(r){return assertNumber$1(r),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix$2(Array.from(t),2**8,r)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix$2(t,r,2**8))}}}function radix2$2(r,t=!1){if(assertNumber$1(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$2(8,r)>32||radix2carry$2(r,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$2(Array.from(n),8,r,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2$2(n,r,8,t))}}}function unsafeWrapper$2(r){if(typeof r!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return r.apply(null,t)}catch{}}}const base16$1=chain$2(radix2$2(4),alphabet$2("0123456789ABCDEF"),join$3("")),base32$1=chain$2(radix2$2(5),alphabet$2("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding$1(5),join$3(""));chain$2(radix2$2(5),alphabet$2("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding$1(5),join$3(""));chain$2(radix2$2(5),alphabet$2("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join$3(""),normalize$4(r=>r.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64$1=chain$2(radix2$2(6),alphabet$2("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding$1(6),join$3("")),base64url$1=chain$2(radix2$2(6),alphabet$2("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding$1(6),join$3("")),genBase58$2=r=>chain$2(radix$2(58),alphabet$2(r),join$3("")),base58$2=genBase58$2("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58$2("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58$2("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN$1=[0,2,3,5,6,7,9,10,11],base58xmr$1={encode(r){let t="";for(let n=0;n<r.length;n+=8){const s=r.subarray(n,n+8);t+=base58$2.encode(s).padStart(XMR_BLOCK_LEN$1[s.length],"1")}return t},decode(r){let t=[];for(let n=0;n<r.length;n+=11){const s=r.slice(n,n+11),o=XMR_BLOCK_LEN$1.indexOf(s.length),a=base58$2.decode(s);for(let c=0;c<a.length-o;c++)if(a[c]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(a.slice(a.length-o)))}return Uint8Array.from(t)}},BECH_ALPHABET$2=chain$2(alphabet$2("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$3("")),POLYMOD_GENERATORS$2=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod$2(r){const t=r>>25;let n=(r&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS$2.length;s++)(t>>s&1)===1&&(n^=POLYMOD_GENERATORS$2[s]);return n}function bechChecksum$2(r,t,n=1){const s=r.length;let o=1;for(let a=0;a<s;a++){const c=r.charCodeAt(a);if(c<33||c>126)throw new Error(`Invalid prefix (${r})`);o=bech32Polymod$2(o)^c>>5}o=bech32Polymod$2(o);for(let a=0;a<s;a++)o=bech32Polymod$2(o)^r.charCodeAt(a)&31;for(let a of t)o=bech32Polymod$2(o)^a;for(let a=0;a<6;a++)o=bech32Polymod$2(o);return o^=n,BECH_ALPHABET$2.encode(convertRadix2$2([o%2**30],30,5,!1))}function genBech32$2(r){const t=r==="bech32"?1:734539939,n=radix2$2(5),s=n.decode,o=n.encode,a=unsafeWrapper$2(s);function c(_,L,q=90){if(typeof _!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof _}`);if(!Array.isArray(L)||L.length&&typeof L[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof L}`);const X=_.length+7+L.length;if(q!==!1&&X>q)throw new TypeError(`Length ${X} exceeds limit ${q}`);return _=_.toLowerCase(),`${_}1${BECH_ALPHABET$2.encode(L)}${bechChecksum$2(_,L,t)}`}function f(_,L=90){if(typeof _!="string")throw new Error(`bech32.decode input should be string, not ${typeof _}`);if(_.length<8||L!==!1&&_.length>L)throw new TypeError(`Wrong string length: ${_.length} (${_}). Expected (8..${L})`);const q=_.toLowerCase();if(_!==q&&_!==_.toUpperCase())throw new Error("String must be lowercase or uppercase");_=q;const X=_.lastIndexOf("1");if(X===0||X===-1)throw new Error('Letter "1" must be present between prefix and data only');const te=_.slice(0,X),ne=_.slice(X+1);if(ne.length<6)throw new Error("Data must be at least 6 characters long");const Ce=BECH_ALPHABET$2.decode(ne).slice(0,-6),Le=bechChecksum$2(te,Ce,t);if(!ne.endsWith(Le))throw new Error(`Invalid checksum in ${_}: expected "${Le}"`);return{prefix:te,words:Ce}}const g=unsafeWrapper$2(f);function b(_){const{prefix:L,words:q}=f(_,!1);return{prefix:L,words:q,bytes:s(q)}}return{encode:c,decode:f,decodeToBytes:b,decodeUnsafe:g,fromWords:s,fromWordsUnsafe:a,toWords:o}}const bech32$3=genBech32$2("bech32");genBech32$2("bech32m");const utf8$2={encode:r=>new TextDecoder().decode(r),decode:r=>new TextEncoder().encode(r)},hex$2=chain$2(radix2$2(4),alphabet$2("0123456789abcdef"),join$3(""),normalize$4(r=>{if(typeof r!="string"||r.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof r} with length ${r.length}`);return r.toLowerCase()})),CODERS$1={utf8:utf8$2,hex:hex$2,base16:base16$1,base32:base32$1,base64:base64$1,base64url:base64url$1,base58:base58$2,base58xmr:base58xmr$1};`${Object.keys(CODERS$1).join(", ")}`;function number$3(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function bool$2(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function isBytes$4(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function bytes$3(r,...t){if(!isBytes$4(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${r.length}`)}function exists$3(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$3(r,t){bytes$3(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32$2=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView$5=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),isLE$3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$3)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$6(r){if(typeof r!="string")throw new Error(`string expected, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$5(r){if(typeof r=="string")r=utf8ToBytes$6(r);else if(isBytes$4(r))r=r.slice();else throw new Error(`Uint8Array expected, got ${typeof r}`);return r}function checkOpts$2(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function equalBytes$2(r,t){if(r.length!==t.length)return!1;let n=0;for(let s=0;s<r.length;s++)n|=r[s]^t[s];return n===0}const wrapCipher$1=(r,t)=>(Object.assign(t,r),t);function setBigUint64$5(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=4,b=0;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}const BLOCK_SIZE$1=16,POLY$1=283;function mul2$1(r){return r<<1^POLY$1&-(r>>7)}function mul$1(r,t){let n=0;for(;t>0;t>>=1)n^=r&-(t&1),r=mul2$1(r);return n}const sbox$1=(()=>{let r=new Uint8Array(256);for(let n=0,s=1;n<256;n++,s^=mul2$1(s))r[n]=s;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let s=r[255-n];s|=s<<8,t[r[n]]=(s^s>>4^s>>5^s>>6^s>>7^99)&255}return t})(),invSbox$1=sbox$1.map((r,t)=>sbox$1.indexOf(t)),rotr32_8$1=r=>r<<24|r>>>8,rotl32_8$1=r=>r<<8|r>>>24;function genTtable$1(r,t){if(r.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((b,_)=>t(r[_])),s=n.map(rotl32_8$1),o=s.map(rotl32_8$1),a=o.map(rotl32_8$1),c=new Uint32Array(256*256),f=new Uint32Array(256*256),g=new Uint16Array(256*256);for(let b=0;b<256;b++)for(let _=0;_<256;_++){const L=b*256+_;c[L]=n[b]^s[_],f[L]=o[b]^a[_],g[L]=r[b]<<8|r[_]}return{sbox:r,sbox2:g,T0:n,T1:s,T2:o,T3:a,T01:c,T23:f}}const tableEncoding$1=genTtable$1(sbox$1,r=>mul$1(r,3)<<24|r<<16|r<<8|mul$1(r,2)),tableDecoding$1=genTtable$1(invSbox$1,r=>mul$1(r,11)<<24|mul$1(r,13)<<16|mul$1(r,9)<<8|mul$1(r,14)),xPowers$1=(()=>{const r=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=mul2$1(n))r[t]=n;return r})();function expandKeyLE$1(r){bytes$3(r);const t=r.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=tableEncoding$1,s=u32$2(r),o=s.length,a=f=>applySbox$1(n,f,f,f,f),c=new Uint32Array(t+28);c.set(s);for(let f=o;f<c.length;f++){let g=c[f-1];f%o===0?g=a(rotr32_8$1(g))^xPowers$1[f/o-1]:o>6&&f%o===4&&(g=a(g)),c[f]=c[f-o]^g}return c}function expandKeyDecLE$1(r){const t=expandKeyLE$1(r),n=t.slice(),s=t.length,{sbox2:o}=tableEncoding$1,{T0:a,T1:c,T2:f,T3:g}=tableDecoding$1;for(let b=0;b<s;b+=4)for(let _=0;_<4;_++)n[b+_]=t[s-b-4+_];t.fill(0);for(let b=4;b<s-4;b++){const _=n[b],L=applySbox$1(o,_,_,_,_);n[b]=a[L&255]^c[L>>>8&255]^f[L>>>16&255]^g[L>>>24]}return n}function apply0123$1(r,t,n,s,o,a){return r[n<<8&65280|s>>>8&255]^t[o>>>8&65280|a>>>24&255]}function applySbox$1(r,t,n,s,o){return r[t&255|n&65280]|r[s>>>16&255|o>>>16&65280]<<16}function encrypt$7(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableEncoding$1;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123$1(c,f,t,n,s,o),Ce=r[g++]^apply0123$1(c,f,n,s,o,t),Le=r[g++]^apply0123$1(c,f,s,o,t,n),Ge=r[g++]^apply0123$1(c,f,o,t,n,s);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox$1(a,t,n,s,o),L=r[g++]^applySbox$1(a,n,s,o,t),q=r[g++]^applySbox$1(a,s,o,t,n),X=r[g++]^applySbox$1(a,o,t,n,s);return{s0:_,s1:L,s2:q,s3:X}}function decrypt$7(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableDecoding$1;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123$1(c,f,t,o,s,n),Ce=r[g++]^apply0123$1(c,f,n,t,o,s),Le=r[g++]^apply0123$1(c,f,s,n,t,o),Ge=r[g++]^apply0123$1(c,f,o,s,n,t);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox$1(a,t,o,s,n),L=r[g++]^applySbox$1(a,n,t,o,s),q=r[g++]^applySbox$1(a,s,n,t,o),X=r[g++]^applySbox$1(a,o,s,n,t);return{s0:_,s1:L,s2:q,s3:X}}function getDst$1(r,t){if(!t)return new Uint8Array(r);if(bytes$3(t),t.length<r)throw new Error(`aes: wrong destination length, expected at least ${r}, got: ${t.length}`);return t}function validateBlockDecrypt$1(r){if(bytes$3(r),r.length%BLOCK_SIZE$1!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE$1}`)}function validateBlockEncrypt$1(r,t,n){let s=r.length;const o=s%BLOCK_SIZE$1;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const a=u32$2(r);if(t){let g=BLOCK_SIZE$1-o;g||(g=BLOCK_SIZE$1),s=s+g}const c=getDst$1(s,n),f=u32$2(c);return{b:a,o:f,out:c}}function validatePCKS$1(r,t){if(!t)return r;const n=r.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const s=r[n-1];if(s<=0||s>16)throw new Error(`aes/pcks5: wrong padding byte: ${s}`);const o=r.subarray(0,-s);for(let a=0;a<s;a++)if(r[n-a-1]!==s)throw new Error("aes/pcks5: wrong padding");return o}function padPCKS$1(r){const t=new Uint8Array(16),n=u32$2(t);t.set(r);const s=BLOCK_SIZE$1-r.length;for(let o=BLOCK_SIZE$1-s;o<BLOCK_SIZE$1;o++)t[o]=s;return n}const cbc$1=wrapCipher$1({blockSize:16,nonceLength:16},function r(t,n,s={}){bytes$3(t),bytes$3(n,16);const o=!s.disablePadding;return{encrypt:(a,c)=>{const f=expandKeyLE$1(t),{b:g,o:b,out:_}=validateBlockEncrypt$1(a,o,c),L=u32$2(n);let q=L[0],X=L[1],te=L[2],ne=L[3],Ce=0;for(;Ce+4<=g.length;)q^=g[Ce+0],X^=g[Ce+1],te^=g[Ce+2],ne^=g[Ce+3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$7(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne;if(o){const Le=padPCKS$1(a.subarray(Ce*4));q^=Le[0],X^=Le[1],te^=Le[2],ne^=Le[3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$7(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne}return f.fill(0),_},decrypt:(a,c)=>{validateBlockDecrypt$1(a);const f=expandKeyDecLE$1(t),g=u32$2(n),b=getDst$1(a.length,c),_=u32$2(a),L=u32$2(b);let q=g[0],X=g[1],te=g[2],ne=g[3];for(let Ce=0;Ce+4<=_.length;){const Le=q,Ge=X,ze=te,Xe=ne;q=_[Ce+0],X=_[Ce+1],te=_[Ce+2],ne=_[Ce+3];const{s0:He,s1:Ve,s2:We,s3:rt}=decrypt$7(f,q,X,te,ne);L[Ce++]=He^Le,L[Ce++]=Ve^Ge,L[Ce++]=We^ze,L[Ce++]=rt^Xe}return f.fill(0),validatePCKS$1(b,o)}}}),u8to16$1=(r,t)=>r[t++]&255|(r[t++]&255)<<8;let Poly1305$1=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=toBytes$5(t),bytes$3(t,32);const n=u8to16$1(t,0),s=u8to16$1(t,2),o=u8to16$1(t,4),a=u8to16$1(t,6),c=u8to16$1(t,8),f=u8to16$1(t,10),g=u8to16$1(t,12),b=u8to16$1(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|s<<3)&8191,this.r[2]=(s>>>10|o<<6)&7939,this.r[3]=(o>>>7|a<<9)&8191,this.r[4]=(a>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|f<<2)&8191,this.r[7]=(f>>>11|g<<5)&8065,this.r[8]=(g>>>8|b<<8)&8191,this.r[9]=b>>>5&127;for(let _=0;_<8;_++)this.pad[_]=u8to16$1(t,16+2*_)}process(t,n,s=!1){const o=s?0:2048,{h:a,r:c}=this,f=c[0],g=c[1],b=c[2],_=c[3],L=c[4],q=c[5],X=c[6],te=c[7],ne=c[8],Ce=c[9],Le=u8to16$1(t,n+0),Ge=u8to16$1(t,n+2),ze=u8to16$1(t,n+4),Xe=u8to16$1(t,n+6),He=u8to16$1(t,n+8),Ve=u8to16$1(t,n+10),We=u8to16$1(t,n+12),rt=u8to16$1(t,n+14);let st=a[0]+(Le&8191),ht=a[1]+((Le>>>13|Ge<<3)&8191),je=a[2]+((Ge>>>10|ze<<6)&8191),se=a[3]+((ze>>>7|Xe<<9)&8191),m=a[4]+((Xe>>>4|He<<12)&8191),A=a[5]+(He>>>1&8191),k=a[6]+((He>>>14|Ve<<2)&8191),Y=a[7]+((Ve>>>11|We<<5)&8191),Q=a[8]+((We>>>8|rt<<8)&8191),$e=a[9]+(rt>>>5|o),ve=0,re=ve+st*f+ht*(5*Ce)+je*(5*ne)+se*(5*te)+m*(5*X);ve=re>>>13,re&=8191,re+=A*(5*q)+k*(5*L)+Y*(5*_)+Q*(5*b)+$e*(5*g),ve+=re>>>13,re&=8191;let B=ve+st*g+ht*f+je*(5*Ce)+se*(5*ne)+m*(5*te);ve=B>>>13,B&=8191,B+=A*(5*X)+k*(5*q)+Y*(5*L)+Q*(5*_)+$e*(5*b),ve+=B>>>13,B&=8191;let oe=ve+st*b+ht*g+je*f+se*(5*Ce)+m*(5*ne);ve=oe>>>13,oe&=8191,oe+=A*(5*te)+k*(5*X)+Y*(5*q)+Q*(5*L)+$e*(5*_),ve+=oe>>>13,oe&=8191;let Ue=ve+st*_+ht*b+je*g+se*f+m*(5*Ce);ve=Ue>>>13,Ue&=8191,Ue+=A*(5*ne)+k*(5*te)+Y*(5*X)+Q*(5*q)+$e*(5*L),ve+=Ue>>>13,Ue&=8191;let Ze=ve+st*L+ht*_+je*b+se*g+m*f;ve=Ze>>>13,Ze&=8191,Ze+=A*(5*Ce)+k*(5*ne)+Y*(5*te)+Q*(5*X)+$e*(5*q),ve+=Ze>>>13,Ze&=8191;let lt=ve+st*q+ht*L+je*_+se*b+m*g;ve=lt>>>13,lt&=8191,lt+=A*f+k*(5*Ce)+Y*(5*ne)+Q*(5*te)+$e*(5*X),ve+=lt>>>13,lt&=8191;let St=ve+st*X+ht*q+je*L+se*_+m*b;ve=St>>>13,St&=8191,St+=A*g+k*f+Y*(5*Ce)+Q*(5*ne)+$e*(5*te),ve+=St>>>13,St&=8191;let Mt=ve+st*te+ht*X+je*q+se*L+m*_;ve=Mt>>>13,Mt&=8191,Mt+=A*b+k*g+Y*f+Q*(5*Ce)+$e*(5*ne),ve+=Mt>>>13,Mt&=8191;let Ft=ve+st*ne+ht*te+je*X+se*q+m*L;ve=Ft>>>13,Ft&=8191,Ft+=A*_+k*b+Y*g+Q*f+$e*(5*Ce),ve+=Ft>>>13,Ft&=8191;let Zt=ve+st*Ce+ht*ne+je*te+se*X+m*q;ve=Zt>>>13,Zt&=8191,Zt+=A*L+k*_+Y*b+Q*g+$e*f,ve+=Zt>>>13,Zt&=8191,ve=(ve<<2)+ve|0,ve=ve+re|0,re=ve&8191,ve=ve>>>13,B+=ve,a[0]=re,a[1]=B,a[2]=oe,a[3]=Ue,a[4]=Ze,a[5]=lt,a[6]=St,a[7]=Mt,a[8]=Ft,a[9]=Zt}finalize(){const{h:t,pad:n}=this,s=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let f=2;f<10;f++)t[f]+=o,o=t[f]>>>13,t[f]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,s[0]=t[0]+5,o=s[0]>>>13,s[0]&=8191;for(let f=1;f<10;f++)s[f]=t[f]+o,o=s[f]>>>13,s[f]&=8191;s[9]-=8192;let a=(o^1)-1;for(let f=0;f<10;f++)s[f]&=a;a=~a;for(let f=0;f<10;f++)t[f]=t[f]&a|s[f];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let c=t[0]+n[0];t[0]=c&65535;for(let f=1;f<8;f++)c=(t[f]+n[f]|0)+(c>>>16)|0,t[f]=c&65535}update(t){exists$3(this);const{buffer:n,blockLen:s}=this;t=toBytes$5(t);const o=t.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){for(;s<=o-a;a+=s)this.process(t,a);continue}n.set(t.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){exists$3(this),output$3(t,this),this.finished=!0;const{buffer:n,h:s}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let a=0;for(let c=0;c<8;c++)t[a++]=s[c]>>>0,t[a++]=s[c]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}};function wrapConstructorWithKey$1(r){const t=(s,o)=>r(o).update(toBytes$5(s)).digest(),n=r(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>r(s),t}const poly1305$1=wrapConstructorWithKey$1(r=>new Poly1305$1(r)),_utf8ToBytes$1=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),sigma16$1=_utf8ToBytes$1("expand 16-byte k"),sigma32$1=_utf8ToBytes$1("expand 32-byte k"),sigma16_32$1=u32$2(sigma16$1),sigma32_32$1=u32$2(sigma32$1);sigma32_32$1.slice();function rotl$5(r,t){return r<<t|r>>>32-t}function isAligned32$1(r){return r.byteOffset%4===0}const BLOCK_LEN$1=64,BLOCK_LEN32$1=16,MAX_COUNTER$1=2**32-1,U32_EMPTY$1=new Uint32Array;function runCipher$1(r,t,n,s,o,a,c,f){const g=o.length,b=new Uint8Array(BLOCK_LEN$1),_=u32$2(b),L=isAligned32$1(o)&&isAligned32$1(a),q=L?u32$2(o):U32_EMPTY$1,X=L?u32$2(a):U32_EMPTY$1;for(let te=0;te<g;c++){if(r(t,n,s,_,c,f),c>=MAX_COUNTER$1)throw new Error("arx: counter overflow");const ne=Math.min(BLOCK_LEN$1,g-te);if(L&&ne===BLOCK_LEN$1){const Ce=te/4;if(te%4!==0)throw new Error("arx: invalid block position");for(let Le=0,Ge;Le<BLOCK_LEN32$1;Le++)Ge=Ce+Le,X[Ge]=q[Ge]^_[Le];te+=BLOCK_LEN$1;continue}for(let Ce=0,Le;Ce<ne;Ce++)Le=te+Ce,a[Le]=o[Le]^b[Ce];te+=ne}}function createCipher$1(r,t){const{allowShortKeys:n,extendNonceFn:s,counterLength:o,counterRight:a,rounds:c}=checkOpts$2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return number$3(o),number$3(c),bool$2(a),bool$2(n),(f,g,b,_,L=0)=>{bytes$3(f),bytes$3(g),bytes$3(b);const q=b.length;if(_||(_=new Uint8Array(q)),bytes$3(_),number$3(L),L<0||L>=MAX_COUNTER$1)throw new Error("arx: counter overflow");if(_.length<q)throw new Error(`arx: output (${_.length}) is shorter than data (${q})`);const X=[];let te=f.length,ne,Ce;if(te===32)ne=f.slice(),X.push(ne),Ce=sigma32_32$1;else if(te===16&&n)ne=new Uint8Array(32),ne.set(f),ne.set(f,16),Ce=sigma16_32$1,X.push(ne);else throw new Error(`arx: invalid 32-byte key, got length=${te}`);isAligned32$1(g)||(g=g.slice(),X.push(g));const Le=u32$2(ne);if(s){if(g.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(Ce,Le,u32$2(g.subarray(0,16)),Le),g=g.subarray(16)}const Ge=16-o;if(Ge!==g.length)throw new Error(`arx: nonce must be ${Ge} or 16 bytes`);if(Ge!==12){const Xe=new Uint8Array(12);Xe.set(g,a?0:12-g.length),g=Xe,X.push(g)}const ze=u32$2(g);for(runCipher$1(r,Ce,Le,ze,b,_,L,c);X.length>0;)X.pop().fill(0);return _}}function chachaCore$1(r,t,n,s,o,a=20){let c=r[0],f=r[1],g=r[2],b=r[3],_=t[0],L=t[1],q=t[2],X=t[3],te=t[4],ne=t[5],Ce=t[6],Le=t[7],Ge=o,ze=n[0],Xe=n[1],He=n[2],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let Ue=0;Ue<a;Ue+=2)Ve=Ve+ht|0,$e=rotl$5($e^Ve,16),A=A+$e|0,ht=rotl$5(ht^A,12),Ve=Ve+ht|0,$e=rotl$5($e^Ve,8),A=A+$e|0,ht=rotl$5(ht^A,7),We=We+je|0,ve=rotl$5(ve^We,16),k=k+ve|0,je=rotl$5(je^k,12),We=We+je|0,ve=rotl$5(ve^We,8),k=k+ve|0,je=rotl$5(je^k,7),rt=rt+se|0,re=rotl$5(re^rt,16),Y=Y+re|0,se=rotl$5(se^Y,12),rt=rt+se|0,re=rotl$5(re^rt,8),Y=Y+re|0,se=rotl$5(se^Y,7),st=st+m|0,B=rotl$5(B^st,16),Q=Q+B|0,m=rotl$5(m^Q,12),st=st+m|0,B=rotl$5(B^st,8),Q=Q+B|0,m=rotl$5(m^Q,7),Ve=Ve+je|0,B=rotl$5(B^Ve,16),Y=Y+B|0,je=rotl$5(je^Y,12),Ve=Ve+je|0,B=rotl$5(B^Ve,8),Y=Y+B|0,je=rotl$5(je^Y,7),We=We+se|0,$e=rotl$5($e^We,16),Q=Q+$e|0,se=rotl$5(se^Q,12),We=We+se|0,$e=rotl$5($e^We,8),Q=Q+$e|0,se=rotl$5(se^Q,7),rt=rt+m|0,ve=rotl$5(ve^rt,16),A=A+ve|0,m=rotl$5(m^A,12),rt=rt+m|0,ve=rotl$5(ve^rt,8),A=A+ve|0,m=rotl$5(m^A,7),st=st+ht|0,re=rotl$5(re^st,16),k=k+re|0,ht=rotl$5(ht^k,12),st=st+ht|0,re=rotl$5(re^st,8),k=k+re|0,ht=rotl$5(ht^k,7);let oe=0;s[oe++]=c+Ve|0,s[oe++]=f+We|0,s[oe++]=g+rt|0,s[oe++]=b+st|0,s[oe++]=_+ht|0,s[oe++]=L+je|0,s[oe++]=q+se|0,s[oe++]=X+m|0,s[oe++]=te+A|0,s[oe++]=ne+k|0,s[oe++]=Ce+Y|0,s[oe++]=Le+Q|0,s[oe++]=Ge+$e|0,s[oe++]=ze+ve|0,s[oe++]=Xe+re|0,s[oe++]=He+B|0}function hchacha$1(r,t,n,s){let o=r[0],a=r[1],c=r[2],f=r[3],g=t[0],b=t[1],_=t[2],L=t[3],q=t[4],X=t[5],te=t[6],ne=t[7],Ce=n[0],Le=n[1],Ge=n[2],ze=n[3];for(let He=0;He<20;He+=2)o=o+g|0,Ce=rotl$5(Ce^o,16),q=q+Ce|0,g=rotl$5(g^q,12),o=o+g|0,Ce=rotl$5(Ce^o,8),q=q+Ce|0,g=rotl$5(g^q,7),a=a+b|0,Le=rotl$5(Le^a,16),X=X+Le|0,b=rotl$5(b^X,12),a=a+b|0,Le=rotl$5(Le^a,8),X=X+Le|0,b=rotl$5(b^X,7),c=c+_|0,Ge=rotl$5(Ge^c,16),te=te+Ge|0,_=rotl$5(_^te,12),c=c+_|0,Ge=rotl$5(Ge^c,8),te=te+Ge|0,_=rotl$5(_^te,7),f=f+L|0,ze=rotl$5(ze^f,16),ne=ne+ze|0,L=rotl$5(L^ne,12),f=f+L|0,ze=rotl$5(ze^f,8),ne=ne+ze|0,L=rotl$5(L^ne,7),o=o+b|0,ze=rotl$5(ze^o,16),te=te+ze|0,b=rotl$5(b^te,12),o=o+b|0,ze=rotl$5(ze^o,8),te=te+ze|0,b=rotl$5(b^te,7),a=a+_|0,Ce=rotl$5(Ce^a,16),ne=ne+Ce|0,_=rotl$5(_^ne,12),a=a+_|0,Ce=rotl$5(Ce^a,8),ne=ne+Ce|0,_=rotl$5(_^ne,7),c=c+L|0,Le=rotl$5(Le^c,16),q=q+Le|0,L=rotl$5(L^q,12),c=c+L|0,Le=rotl$5(Le^c,8),q=q+Le|0,L=rotl$5(L^q,7),f=f+g|0,Ge=rotl$5(Ge^f,16),X=X+Ge|0,g=rotl$5(g^X,12),f=f+g|0,Ge=rotl$5(Ge^f,8),X=X+Ge|0,g=rotl$5(g^X,7);let Xe=0;s[Xe++]=o,s[Xe++]=a,s[Xe++]=c,s[Xe++]=f,s[Xe++]=Ce,s[Xe++]=Le,s[Xe++]=Ge,s[Xe++]=ze}const chacha20$1=createCipher$1(chachaCore$1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xchacha20$1=createCipher$1(chachaCore$1,{counterRight:!1,counterLength:8,extendNonceFn:hchacha$1,allowShortKeys:!1}),ZEROS16$1=new Uint8Array(16),updatePadded$1=(r,t)=>{r.update(t);const n=t.length%16;n&&r.update(ZEROS16$1.subarray(n))},ZEROS32$1=new Uint8Array(32);function computeTag$1(r,t,n,s,o){const a=r(t,n,ZEROS32$1),c=poly1305$1.create(a);o&&updatePadded$1(c,o),updatePadded$1(c,s);const f=new Uint8Array(16),g=createView$5(f);setBigUint64$5(g,0,BigInt(o?o.length:0),!0),setBigUint64$5(g,8,BigInt(s.length),!0),c.update(f);const b=c.digest();return a.fill(0),b}const _poly1305_aead$1=r=>(t,n,s)=>(bytes$3(t,32),bytes$3(n),{encrypt:(a,c)=>{const f=a.length,g=f+16;c?bytes$3(c,g):c=new Uint8Array(g),r(t,n,a,c,1);const b=computeTag$1(r,t,n,c.subarray(0,-16),s);return c.set(b,f),c},decrypt:(a,c)=>{const f=a.length,g=f-16;if(f<16)throw new Error("encrypted data must be at least 16 bytes");c?bytes$3(c,g):c=new Uint8Array(g);const b=a.subarray(0,-16),_=a.subarray(-16),L=computeTag$1(r,t,n,b,s);if(!equalBytes$2(_,L))throw new Error("invalid tag");return r(t,n,b,c,1),c}}),xchacha20poly1305$1=wrapCipher$1({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead$1(xchacha20$1));let HMAC$4=class extends Hash$4{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,assert$1.hash(t);const s=toBytes$6(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return assert$1.exists(this),this.iHash.update(t),this}digestInto(t){assert$1.exists(this),assert$1.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$4=(r,t,n)=>new HMAC$4(r,t).update(n).digest();hmac$4.create=(r,t)=>new HMAC$4(r,t);function extract$1(r,t,n){return assert$1.hash(r),hmac$4(r,toBytes$6(n),toBytes$6(t))}const HKDF_COUNTER$1=new Uint8Array([0]),EMPTY_BUFFER$1=new Uint8Array;function expand$1(r,t,n,s=32){if(assert$1.hash(r),assert$1.number(s),s>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(s/r.outputLen);n===void 0&&(n=EMPTY_BUFFER$1);const a=new Uint8Array(o*r.outputLen),c=hmac$4.create(r,t),f=c._cloneInto(),g=new Uint8Array(c.outputLen);for(let b=0;b<o;b++)HKDF_COUNTER$1[0]=b+1,f.update(b===0?EMPTY_BUFFER$1:g).update(n).update(HKDF_COUNTER$1).digestInto(g),a.set(g,r.outputLen*b),c._cloneInto(f);return c.destroy(),f.destroy(),g.fill(0),HKDF_COUNTER$1.fill(0),a.slice(0,s)}var __defProp$3=Object.defineProperty,__export$1=(r,t)=>{for(var n in t)__defProp$3(r,n,{get:t[n],enumerable:!0})},verifiedSymbol$1=Symbol("verified"),isRecord$1=r=>r instanceof Object;function validateEvent$1(r){if(!isRecord$1(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let t=0;t<r.tags.length;t++){let n=r.tags[t];if(!Array.isArray(n))return!1;for(let s=0;s<n.length;s++)if(typeof n[s]!="string")return!1}return!0}var utils_exports$1={};__export$1(utils_exports$1,{Queue:()=>Queue$2,QueueNode:()=>QueueNode$1,binarySearch:()=>binarySearch$1,bytesToHex:()=>bytesToHex$5,hexToBytes:()=>hexToBytes$5,insertEventIntoAscendingList:()=>insertEventIntoAscendingList$1,insertEventIntoDescendingList:()=>insertEventIntoDescendingList$1,normalizeURL:()=>normalizeURL$1,utf8Decoder:()=>utf8Decoder$3,utf8Encoder:()=>utf8Encoder$3});var utf8Decoder$3=new TextDecoder("utf-8"),utf8Encoder$3=new TextEncoder;function normalizeURL$1(r){try{r.indexOf("://")===-1&&(r="wss://"+r);let t=new URL(r);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${r}`)}}function insertEventIntoDescendingList$1(r,t){const[n,s]=binarySearch$1(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return s||r.splice(n,0,t),r}function insertEventIntoAscendingList$1(r,t){const[n,s]=binarySearch$1(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return s||r.splice(n,0,t),r}function binarySearch$1(r,t){let n=0,s=r.length-1;for(;n<=s;){const o=Math.floor((n+s)/2),a=t(r[o]);if(a===0)return[o,!0];a<0?s=o-1:n=o+1}return[n,!1]}var QueueNode$1=class{value;next=null;prev=null;constructor(t){this.value=t}},Queue$2=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const n=new QueueNode$1(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},JS$1=class{generateSecretKey(){return schnorr$3.utils.randomPrivateKey()}getPublicKey(t){return bytesToHex$5(schnorr$3.getPublicKey(t))}finalizeEvent(t,n){const s=t;return s.pubkey=bytesToHex$5(schnorr$3.getPublicKey(n)),s.id=getEventHash$3(s),s.sig=bytesToHex$5(schnorr$3.sign(getEventHash$3(s),n)),s[verifiedSymbol$1]=!0,s}verifyEvent(t){if(typeof t[verifiedSymbol$1]=="boolean")return t[verifiedSymbol$1];const n=getEventHash$3(t);if(n!==t.id)return t[verifiedSymbol$1]=!1,!1;try{const s=schnorr$3.verify(t.sig,n,t.pubkey);return t[verifiedSymbol$1]=s,s}catch{return t[verifiedSymbol$1]=!1,!1}}};function serializeEvent$1(r){if(!validateEvent$1(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function getEventHash$3(r){let t=sha256$6(utf8Encoder$3.encode(serializeEvent$1(r)));return bytesToHex$5(t)}var i$3=new JS$1,generateSecretKey$1=i$3.generateSecretKey,getPublicKey$1=i$3.getPublicKey,finalizeEvent$1=i$3.finalizeEvent,verifyEvent$1=i$3.verifyEvent,kinds_exports$1={};__export$1(kinds_exports$1,{Application:()=>Application$1,BadgeAward:()=>BadgeAward$1,BadgeDefinition:()=>BadgeDefinition$1,BlockedRelaysList:()=>BlockedRelaysList$1,BookmarkList:()=>BookmarkList$1,Bookmarksets:()=>Bookmarksets$1,Calendar:()=>Calendar$1,CalendarEventRSVP:()=>CalendarEventRSVP$1,ChannelCreation:()=>ChannelCreation$1,ChannelHideMessage:()=>ChannelHideMessage$1,ChannelMessage:()=>ChannelMessage$1,ChannelMetadata:()=>ChannelMetadata$1,ChannelMuteUser:()=>ChannelMuteUser$1,ClassifiedListing:()=>ClassifiedListing$1,ClientAuth:()=>ClientAuth$1,CommunitiesList:()=>CommunitiesList$1,CommunityDefinition:()=>CommunityDefinition$1,CommunityPostApproval:()=>CommunityPostApproval$1,Contacts:()=>Contacts$1,CreateOrUpdateProduct:()=>CreateOrUpdateProduct$1,CreateOrUpdateStall:()=>CreateOrUpdateStall$1,Curationsets:()=>Curationsets$1,Date:()=>Date2$1,DirectMessageRelaysList:()=>DirectMessageRelaysList$1,DraftClassifiedListing:()=>DraftClassifiedListing$1,DraftLong:()=>DraftLong$1,Emojisets:()=>Emojisets$1,EncryptedDirectMessage:()=>EncryptedDirectMessage$1,EventDeletion:()=>EventDeletion$1,FileMetadata:()=>FileMetadata$1,FileServerPreference:()=>FileServerPreference$1,Followsets:()=>Followsets$1,GenericRepost:()=>GenericRepost$1,Genericlists:()=>Genericlists$1,GiftWrap:()=>GiftWrap$1,HTTPAuth:()=>HTTPAuth$1,Handlerinformation:()=>Handlerinformation$1,Handlerrecommendation:()=>Handlerrecommendation$1,Highlights:()=>Highlights$1,InterestsList:()=>InterestsList$1,Interestsets:()=>Interestsets$1,JobFeedback:()=>JobFeedback$1,JobRequest:()=>JobRequest$1,JobResult:()=>JobResult$1,Label:()=>Label$1,LightningPubRPC:()=>LightningPubRPC$1,LiveChatMessage:()=>LiveChatMessage$1,LiveEvent:()=>LiveEvent$1,LongFormArticle:()=>LongFormArticle$1,Metadata:()=>Metadata$1,Mutelist:()=>Mutelist$1,NWCWalletInfo:()=>NWCWalletInfo$1,NWCWalletRequest:()=>NWCWalletRequest$1,NWCWalletResponse:()=>NWCWalletResponse$1,NostrConnect:()=>NostrConnect$1,OpenTimestamps:()=>OpenTimestamps$1,Pinlist:()=>Pinlist$1,PrivateDirectMessage:()=>PrivateDirectMessage$1,ProblemTracker:()=>ProblemTracker$1,ProfileBadges:()=>ProfileBadges$1,PublicChatsList:()=>PublicChatsList$1,Reaction:()=>Reaction$1,RecommendRelay:()=>RecommendRelay$1,RelayList:()=>RelayList$1,Relaysets:()=>Relaysets$1,Report:()=>Report$1,Reporting:()=>Reporting$1,Repost:()=>Repost$1,Seal:()=>Seal$1,SearchRelaysList:()=>SearchRelaysList$1,ShortTextNote:()=>ShortTextNote$1,Time:()=>Time$1,UserEmojiList:()=>UserEmojiList$1,UserStatuses:()=>UserStatuses$1,Zap:()=>Zap$1,ZapGoal:()=>ZapGoal$1,ZapRequest:()=>ZapRequest$1,classifyKind:()=>classifyKind$1,isAddressableKind:()=>isAddressableKind$1,isEphemeralKind:()=>isEphemeralKind$1,isKind:()=>isKind$1,isRegularKind:()=>isRegularKind$1,isReplaceableKind:()=>isReplaceableKind$1});function isRegularKind$1(r){return 1e3<=r&&r<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(r)}function isReplaceableKind$1(r){return[0,3].includes(r)||1e4<=r&&r<2e4}function isEphemeralKind$1(r){return 2e4<=r&&r<3e4}function isAddressableKind$1(r){return 3e4<=r&&r<4e4}function classifyKind$1(r){return isRegularKind$1(r)?"regular":isReplaceableKind$1(r)?"replaceable":isEphemeralKind$1(r)?"ephemeral":isAddressableKind$1(r)?"parameterized":"unknown"}function isKind$1(r,t){const n=t instanceof Array?t:[t];return validateEvent$1(r)&&n.includes(r.kind)||!1}var Metadata$1=0,ShortTextNote$1=1,RecommendRelay$1=2,Contacts$1=3,EncryptedDirectMessage$1=4,EventDeletion$1=5,Repost$1=6,Reaction$1=7,BadgeAward$1=8,Seal$1=13,PrivateDirectMessage$1=14,GenericRepost$1=16,ChannelCreation$1=40,ChannelMetadata$1=41,ChannelMessage$1=42,ChannelHideMessage$1=43,ChannelMuteUser$1=44,OpenTimestamps$1=1040,GiftWrap$1=1059,FileMetadata$1=1063,LiveChatMessage$1=1311,ProblemTracker$1=1971,Report$1=1984,Reporting$1=1984,Label$1=1985,CommunityPostApproval$1=4550,JobRequest$1=5999,JobResult$1=6999,JobFeedback$1=7e3,ZapGoal$1=9041,ZapRequest$1=9734,Zap$1=9735,Highlights$1=9802,Mutelist$1=1e4,Pinlist$1=10001,RelayList$1=10002,BookmarkList$1=10003,CommunitiesList$1=10004,PublicChatsList$1=10005,BlockedRelaysList$1=10006,SearchRelaysList$1=10007,InterestsList$1=10015,UserEmojiList$1=10030,DirectMessageRelaysList$1=10050,FileServerPreference$1=10096,NWCWalletInfo$1=13194,LightningPubRPC$1=21e3,ClientAuth$1=22242,NWCWalletRequest$1=23194,NWCWalletResponse$1=23195,NostrConnect$1=24133,HTTPAuth$1=27235,Followsets$1=3e4,Genericlists$1=30001,Relaysets$1=30002,Bookmarksets$1=30003,Curationsets$1=30004,ProfileBadges$1=30008,BadgeDefinition$1=30009,Interestsets$1=30015,CreateOrUpdateStall$1=30017,CreateOrUpdateProduct$1=30018,LongFormArticle$1=30023,DraftLong$1=30024,Emojisets$1=30030,Application$1=30078,LiveEvent$1=30311,UserStatuses$1=30315,ClassifiedListing$1=30402,DraftClassifiedListing$1=30403,Date2$1=31922,Time$1=31923,Calendar$1=31924,CalendarEventRSVP$1=31925,Handlerrecommendation$1=31989,Handlerinformation$1=31990,CommunityDefinition$1=34550;function matchFilter(r,t){if(r.ids&&r.ids.indexOf(t.id)===-1||r.kinds&&r.kinds.indexOf(t.kind)===-1||r.authors&&r.authors.indexOf(t.pubkey)===-1)return!1;for(let n in r)if(n[0]==="#"){let s=n.slice(1),o=r[`#${s}`];if(o&&!t.tags.find(([a,c])=>a===n.slice(1)&&o.indexOf(c)!==-1))return!1}return!(r.since&&t.created_at<r.since||r.until&&t.created_at>r.until)}function matchFilters(r,t){for(let n=0;n<r.length;n++)if(matchFilter(r[n],t))return!0;return!1}var fakejson_exports$1={};__export$1(fakejson_exports$1,{getHex64:()=>getHex64$1,getInt:()=>getInt$1,getSubscriptionId:()=>getSubscriptionId$1,matchEventId:()=>matchEventId$1,matchEventKind:()=>matchEventKind$1,matchEventPubkey:()=>matchEventPubkey$1});function getHex64$1(r,t){let n=t.length+3,s=r.indexOf(`"${t}":`)+n,o=r.slice(s).indexOf('"')+s+1;return r.slice(o,o+64)}function getInt$1(r,t){let n=t.length,s=r.indexOf(`"${t}":`)+n+3,o=r.slice(s),a=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,a),10)}function getSubscriptionId$1(r){let t=r.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=r.slice(t+7+1).indexOf('"');if(n===-1)return null;let s=t+7+1+n,o=r.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return r.slice(s+1,a)}function matchEventId$1(r,t){return t===getHex64$1(r,"id")}function matchEventPubkey$1(r,t){return t===getHex64$1(r,"pubkey")}function matchEventKind$1(r,t){return t===getInt$1(r,"kind")}var nip42_exports$1={};__export$1(nip42_exports$1,{makeAuthEvent:()=>makeAuthEvent$1});function makeAuthEvent$1(r,t){return{kind:ClientAuth$1,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",t]],content:""}}var _WebSocket$1;try{_WebSocket$1=WebSocket}catch{}var _WebSocket2$1;try{_WebSocket2$1=WebSocket}catch{}var nip19_exports$3={};__export$1(nip19_exports$3,{BECH32_REGEX:()=>BECH32_REGEX$4,Bech32MaxSize:()=>Bech32MaxSize$5,NostrTypeGuard:()=>NostrTypeGuard$3,decode:()=>decode$6,decodeNostrURI:()=>decodeNostrURI$3,encodeBytes:()=>encodeBytes$5,naddrEncode:()=>naddrEncode$3,neventEncode:()=>neventEncode$3,noteEncode:()=>noteEncode$3,nprofileEncode:()=>nprofileEncode$3,npubEncode:()=>npubEncode$3,nsecEncode:()=>nsecEncode$3});var NostrTypeGuard$3={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize$5=5e3,BECH32_REGEX$4=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array$3(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI$3(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode$6(r)}catch{return{type:"invalid",data:null}}}function decode$6(r){let{prefix:t,words:n}=bech32$3.decode(r,Bech32MaxSize$5),s=new Uint8Array(bech32$3.fromWords(n));switch(t){case"nprofile":{let o=parseTLV$3(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$5(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$3.decode(a)):[]}}}case"nevent":{let o=parseTLV$3(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$5(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$3.decode(a)):[],author:o[2]?.[0]?bytesToHex$5(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex$5(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV$3(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder$3.decode(o[0][0]),pubkey:bytesToHex$5(o[2][0]),kind:parseInt(bytesToHex$5(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder$3.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex$5(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV$3(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode$3(r){return encodeBytes$5("nsec",r)}function npubEncode$3(r){return encodeBytes$5("npub",hexToBytes$5(r))}function noteEncode$3(r){return encodeBytes$5("note",hexToBytes$5(r))}function encodeBech32$5(r,t){let n=bech32$3.toWords(t);return bech32$3.encode(r,n,Bech32MaxSize$5)}function encodeBytes$5(r,t){return encodeBech32$5(r,t)}function nprofileEncode$3(r){let t=encodeTLV$3({0:[hexToBytes$5(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder$3.encode(n))});return encodeBech32$5("nprofile",t)}function neventEncode$3(r){let t;r.kind!==void 0&&(t=integerToUint8Array$3(r.kind));let n=encodeTLV$3({0:[hexToBytes$5(r.id)],1:(r.relays||[]).map(s=>utf8Encoder$3.encode(s)),2:r.author?[hexToBytes$5(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32$5("nevent",n)}function naddrEncode$3(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV$3({0:[utf8Encoder$3.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder$3.encode(s)),2:[hexToBytes$5(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech32$5("naddr",n)}function encodeTLV$3(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes$5(...t)}var nip04_exports$1={};__export$1(nip04_exports$1,{decrypt:()=>decrypt$6,encrypt:()=>encrypt$6});function encrypt$6(r,t,n){const s=r instanceof Uint8Array?bytesToHex$5(r):r,o=secp256k1$3.getSharedSecret(s,"02"+t),a=getNormalizedX$1(o);let c=Uint8Array.from(randomBytes$4(16)),f=utf8Encoder$3.encode(n),g=cbc$1(a,c).encrypt(f),b=base64$1.encode(new Uint8Array(g)),_=base64$1.encode(new Uint8Array(c.buffer));return`${b}?iv=${_}`}function decrypt$6(r,t,n){const s=r instanceof Uint8Array?bytesToHex$5(r):r;let[o,a]=n.split("?iv="),c=secp256k1$3.getSharedSecret(s,"02"+t),f=getNormalizedX$1(c),g=base64$1.decode(a),b=base64$1.decode(o),_=cbc$1(f,g).decrypt(b);return utf8Decoder$3.decode(_)}function getNormalizedX$1(r){return r.slice(1,33)}var nip05_exports$1={};__export$1(nip05_exports$1,{NIP05_REGEX:()=>NIP05_REGEX$3,isNip05:()=>isNip05$1,isValid:()=>isValid$1,queryProfile:()=>queryProfile$1,searchDomain:()=>searchDomain$1,useFetchImplementation:()=>useFetchImplementation$1});var NIP05_REGEX$3=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05$1=r=>NIP05_REGEX$3.test(r||""),_fetch$1;try{_fetch$1=fetch}catch(r){}function useFetchImplementation$1(r){_fetch$1=r}async function searchDomain$1(r,t=""){try{const n=`https://${r}/.well-known/nostr.json?name=${t}`,s=await _fetch$1(n,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");return(await s.json()).names}catch{return{}}}async function queryProfile$1(r){const t=r.match(NIP05_REGEX$3);if(!t)return null;const[,n="_",s]=t;try{const o=`https://${s}/.well-known/nostr.json?name=${n}`,a=await _fetch$1(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const c=await a.json(),f=c.names[n];return f?{pubkey:f,relays:c.relays?.[f]}:null}catch{return null}}async function isValid$1(r,t){const n=await queryProfile$1(t);return n?n.pubkey===r:!1}var nip10_exports$1={};__export$1(nip10_exports$1,{parse:()=>parse$1});function parse$1(r){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,s;for(let o=r.tags.length-1;o>=0;o--){const a=r.tags[o];if(a[0]==="e"&&a[1]){const[c,f,g,b,_]=a,L={id:f,relays:g?[g]:[],author:_};if(b==="root"){t.root=L;continue}if(b==="reply"){t.reply=L;continue}if(b==="mention"){t.mentions.push(L);continue}n?s=L:n=L,t.mentions.push(L);continue}if(a[0]==="q"&&a[1]){const[c,f,g]=a;t.quotes.push({id:f,relays:g?[g]:[]})}if(a[0]==="p"&&a[1]){t.profiles.push({pubkey:a[1],relays:a[2]?[a[2]]:[]});continue}}return t.root||(t.root=s||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let a=t.mentions.indexOf(o);if(a!==-1&&t.mentions.splice(a,1),o.author){let c=t.profiles.find(f=>f.pubkey===o.author);c&&c.relays&&(o.relays||(o.relays=[]),c.relays.forEach(f=>{o.relays?.indexOf(f)===-1&&o.relays.push(f)}),c.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let a=t.profiles.find(c=>c.pubkey===o.author);a&&a.relays&&(o.relays||(o.relays=[]),a.relays.forEach(c=>{o.relays.indexOf(c)===-1&&o.relays.push(c)}),a.relays=o.relays)}}),t}var nip11_exports$1={};__export$1(nip11_exports$1,{fetchRelayInformation:()=>fetchRelayInformation$3,useFetchImplementation:()=>useFetchImplementation2$1});var _fetch2$1;try{_fetch2$1=fetch}catch{}function useFetchImplementation2$1(r){_fetch2$1=r}async function fetchRelayInformation$3(r){return await(await fetch(r.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports$1={};__export$1(nip13_exports$1,{fastEventHash:()=>fastEventHash$1,getPow:()=>getPow$1,minePow:()=>minePow$1});function getPow$1(r){let t=0;for(let n=0;n<64;n+=8){const s=parseInt(r.substring(n,n+8),16);if(s===0)t+=32;else{t+=Math.clz32(s);break}}return t}function minePow$1(r,t){let n=0;const s=r,o=["nonce",n.toString(),t.toString()];for(s.tags.push(o);;){const a=Math.floor(new Date().getTime()/1e3);if(a!==s.created_at&&(n=0,s.created_at=a),o[1]=(++n).toString(),s.id=fastEventHash$1(s),getPow$1(s.id)>=t)break}return s}function fastEventHash$1(r){return bytesToHex$5(sha256$6(utf8Encoder$3.encode(JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content]))))}var nip17_exports$1={};__export$1(nip17_exports$1,{unwrapEvent:()=>unwrapEvent2$1,unwrapManyEvents:()=>unwrapManyEvents2$1,wrapEvent:()=>wrapEvent2$1,wrapManyEvents:()=>wrapManyEvents2$1});var nip59_exports$1={};__export$1(nip59_exports$1,{createRumor:()=>createRumor$1,createSeal:()=>createSeal$1,createWrap:()=>createWrap$1,unwrapEvent:()=>unwrapEvent$1,unwrapManyEvents:()=>unwrapManyEvents$1,wrapEvent:()=>wrapEvent$3,wrapManyEvents:()=>wrapManyEvents$1});var nip44_exports$1={};__export$1(nip44_exports$1,{decrypt:()=>decrypt2$1,encrypt:()=>encrypt2$1,getConversationKey:()=>getConversationKey$1,v2:()=>v2$1});var minPlaintextSize$1=1,maxPlaintextSize$1=65535;function getConversationKey$1(r,t){const n=secp256k1$3.getSharedSecret(r,"02"+t).subarray(1,33);return extract$1(sha256$6,n,"nip44-v2")}function getMessageKeys$1(r,t){const n=expand$1(sha256$6,r,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function calcPaddedLen$1(r){if(!Number.isSafeInteger(r)||r<1)throw new Error("expected positive integer");if(r<=32)return 32;const t=1<<Math.floor(Math.log2(r-1))+1,n=t<=256?32:t/8;return n*(Math.floor((r-1)/n)+1)}function writeU16BE$1(r){if(!Number.isSafeInteger(r)||r<minPlaintextSize$1||r>maxPlaintextSize$1)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,r,!1),t}function pad$1(r){const t=utf8Encoder$3.encode(r),n=t.length,s=writeU16BE$1(n),o=new Uint8Array(calcPaddedLen$1(n)-n);return concatBytes$5(s,t,o)}function unpad$1(r){const t=new DataView(r.buffer).getUint16(0),n=r.subarray(2,2+t);if(t<minPlaintextSize$1||t>maxPlaintextSize$1||n.length!==t||r.length!==2+calcPaddedLen$1(t))throw new Error("invalid padding");return utf8Decoder$3.decode(n)}function hmacAad$1(r,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const s=concatBytes$5(n,t);return hmac$4(sha256$6,r,s)}function decodePayload$1(r){if(typeof r!="string")throw new Error("payload must be a valid string");const t=r.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(r[0]==="#")throw new Error("unknown encryption version");let n;try{n=base64$1.decode(r)}catch(a){throw new Error("invalid base64: "+a.message)}const s=n.length;if(s<99||s>65603)throw new Error("invalid data length: "+s);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function encrypt2$1(r,t,n=randomBytes$4(32)){const{chacha_key:s,chacha_nonce:o,hmac_key:a}=getMessageKeys$1(t,n),c=pad$1(r),f=chacha20$1(s,o,c),g=hmacAad$1(a,f,n);return base64$1.encode(concatBytes$5(new Uint8Array([2]),n,f,g))}function decrypt2$1(r,t){const{nonce:n,ciphertext:s,mac:o}=decodePayload$1(r),{chacha_key:a,chacha_nonce:c,hmac_key:f}=getMessageKeys$1(t,n),g=hmacAad$1(f,s,n);if(!equalBytes$2(g,o))throw new Error("invalid MAC");const b=chacha20$1(a,c,s);return unpad$1(b)}var v2$1={utils:{getConversationKey:getConversationKey$1,calcPaddedLen:calcPaddedLen$1},encrypt:encrypt2$1,decrypt:decrypt2$1},TWO_DAYS$1=2880*60,now$1=()=>Math.round(Date.now()/1e3),randomNow$1=()=>Math.round(now$1()-Math.random()*TWO_DAYS$1),nip44ConversationKey$1=(r,t)=>getConversationKey$1(r,t),nip44Encrypt$1=(r,t,n)=>encrypt2$1(JSON.stringify(r),nip44ConversationKey$1(t,n)),nip44Decrypt$1=(r,t)=>JSON.parse(decrypt2$1(r.content,nip44ConversationKey$1(t,r.pubkey)));function createRumor$1(r,t){const n={created_at:now$1(),content:"",tags:[],...r,pubkey:getPublicKey$1(t)};return n.id=getEventHash$3(n),n}function createSeal$1(r,t,n){return finalizeEvent$1({kind:Seal$1,content:nip44Encrypt$1(r,t,n),created_at:randomNow$1(),tags:[]},t)}function createWrap$1(r,t){const n=generateSecretKey$1();return finalizeEvent$1({kind:GiftWrap$1,content:nip44Encrypt$1(r,n,t),created_at:randomNow$1(),tags:[["p",t]]},n)}function wrapEvent$3(r,t,n){const s=createRumor$1(r,t),o=createSeal$1(s,t,n);return createWrap$1(o,n)}function wrapManyEvents$1(r,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const s=getPublicKey$1(t),o=[wrapEvent$3(r,t,s)];return n.forEach(a=>{o.push(wrapEvent$3(r,t,a))}),o}function unwrapEvent$1(r,t){const n=nip44Decrypt$1(r,t);return nip44Decrypt$1(n,t)}function unwrapManyEvents$1(r,t){let n=[];return r.forEach(s=>{n.push(unwrapEvent$1(s,t))}),n.sort((s,o)=>s.created_at-o.created_at),n}function createEvent$1(r,t,n,s){const o={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage$1,tags:[],content:t};return(Array.isArray(r)?r:[r]).forEach(({publicKey:c,relayUrl:f})=>{o.tags.push(f?["p",c,f]:["p",c])}),s&&o.tags.push(["e",s.eventId,s.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function wrapEvent2$1(r,t,n,s,o){const a=createEvent$1(t,n,s,o);return wrapEvent$3(a,r,t.publicKey)}function wrapManyEvents2$1(r,t,n,s,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey$1(r)},...t].map(c=>wrapEvent2$1(r,c,n,s,o))}var unwrapEvent2$1=unwrapEvent$1,unwrapManyEvents2$1=unwrapManyEvents$1,nip18_exports$1={};__export$1(nip18_exports$1,{finishRepostEvent:()=>finishRepostEvent$1,getRepostedEvent:()=>getRepostedEvent$1,getRepostedEventPointer:()=>getRepostedEventPointer$1});function finishRepostEvent$1(r,t,n,s){let o;const a=[...r.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===ShortTextNote$1?o=Repost$1:(o=GenericRepost$1,a.push(["k",String(t.kind)])),finalizeEvent$1({kind:o,tags:a,content:r.content===""||t.tags?.find(c=>c[0]==="-")?"":JSON.stringify(t),created_at:r.created_at},s)}function getRepostedEventPointer$1(r){if(![Repost$1,GenericRepost$1].includes(r.kind))return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(s=>typeof s=="string"),author:n?.[1]}}function getRepostedEvent$1(r,{skipVerification:t}={}){const n=getRepostedEventPointer$1(r);if(n===void 0||r.content==="")return;let s;try{s=JSON.parse(r.content)}catch{return}if(s.id===n.id&&!(!t&&!verifyEvent$1(s)))return s}var nip21_exports$1={};__export$1(nip21_exports$1,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX$1,parse:()=>parse2$1,test:()=>test$1});var NOSTR_URI_REGEX$1=new RegExp(`nostr:(${BECH32_REGEX$4.source})`);function test$1(r){return typeof r=="string"&&new RegExp(`^${NOSTR_URI_REGEX$1.source}$`).test(r)}function parse2$1(r){const t=r.match(new RegExp(`^${NOSTR_URI_REGEX$1.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${r}`);return{uri:t[0],value:t[1],decoded:decode$6(t[1])}}var nip25_exports$1={};__export$1(nip25_exports$1,{finishReactionEvent:()=>finishReactionEvent$1,getReactedEventPointer:()=>getReactedEventPointer$1});function finishReactionEvent$1(r,t,n){const s=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return finalizeEvent$1({...r,kind:Reaction$1,tags:[...r.tags??[],...s,["e",t.id],["p",t.pubkey]],content:r.content??"+"},n)}function getReactedEventPointer$1(r){if(r.kind!==Reaction$1)return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(s=>s!==void 0),author:n[1]}}var nip27_exports$1={};__export$1(nip27_exports$1,{parse:()=>parse3$1});var noCharacter$1=/\W/m,noURLCharacter$1=/\W |\W$|$|,| /m;function*parse3$1(r){const t=r.length;let n=0,s=0;for(;s<t;){let o=r.indexOf(":",s);if(o===-1)break;if(r.substring(o-5,o)==="nostr"){const a=r.substring(o+60).match(noCharacter$1),c=a?o+60+a.index:t;try{let f,{data:g,type:b}=decode$6(r.substring(o+1,c));switch(b){case"npub":f={pubkey:g};break;case"nsec":case"note":s=c+1;continue;default:f=g}n!==o-5&&(yield{type:"text",text:r.substring(n,o-5)}),yield{type:"reference",pointer:f},s=c,n=s;continue}catch{s=o+1;continue}}else if(r.substring(o-5,o)==="https"||r.substring(o-4,o)==="http"){const a=r.substring(o+4).match(noURLCharacter$1),c=a?o+4+a.index:t,f=r[o-1]==="s"?5:4;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),/\.(png|jpe?g|gif|webp)$/i.test(g.pathname)){yield{type:"image",url:g.toString()},s=c,n=s;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(g.pathname)){yield{type:"video",url:g.toString()},s=c,n=s;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(g.pathname)){yield{type:"audio",url:g.toString()},s=c,n=s;continue}yield{type:"url",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else if(r.substring(o-3,o)==="wss"||r.substring(o-2,o)==="ws"){const a=r.substring(o+4).match(noURLCharacter$1),c=a?o+4+a.index:t,f=r[o-1]==="s"?3:2;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),yield{type:"relay",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else{s=o+1;continue}}n!==t&&(yield{type:"text",text:r.substring(n)})}var nip28_exports$1={};__export$1(nip28_exports$1,{channelCreateEvent:()=>channelCreateEvent$1,channelHideMessageEvent:()=>channelHideMessageEvent$1,channelMessageEvent:()=>channelMessageEvent$1,channelMetadataEvent:()=>channelMetadataEvent$1,channelMuteUserEvent:()=>channelMuteUserEvent$1});var channelCreateEvent$1=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$1({kind:ChannelCreation$1,tags:[...r.tags??[]],content:n,created_at:r.created_at},t)},channelMetadataEvent$1=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$1({kind:ChannelMetadata$1,tags:[["e",r.channel_create_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMessageEvent$1=(r,t)=>{const n=[["e",r.channel_create_event_id,r.relay_url,"root"]];return r.reply_to_channel_message_event_id&&n.push(["e",r.reply_to_channel_message_event_id,r.relay_url,"reply"]),finalizeEvent$1({kind:ChannelMessage$1,tags:[...n,...r.tags??[]],content:r.content,created_at:r.created_at},t)},channelHideMessageEvent$1=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$1({kind:ChannelHideMessage$1,tags:[["e",r.channel_message_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMuteUserEvent$1=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent$1({kind:ChannelMuteUser$1,tags:[["p",r.pubkey_to_mute],...r.tags??[]],content:n,created_at:r.created_at},t)},nip30_exports$1={};__export$1(nip30_exports$1,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX$1,matchAll:()=>matchAll$1,regex:()=>regex$3,replaceAll:()=>replaceAll$1});var EMOJI_SHORTCODE_REGEX$1=/:(\w+):/,regex$3=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX$1.source}\\B`,"g");function*matchAll$1(r){const t=r.matchAll(regex$3());for(const n of t)try{const[s,o]=n;yield{shortcode:s,name:o,start:n.index,end:n.index+s.length}}catch{}}function replaceAll$1(r,t){return r.replaceAll(regex$3(),(n,s)=>t({shortcode:n,name:s}))}var nip39_exports$1={};__export$1(nip39_exports$1,{useFetchImplementation:()=>useFetchImplementation3$1,validateGithub:()=>validateGithub$1});var _fetch3$1;try{_fetch3$1=fetch}catch{}function useFetchImplementation3$1(r){_fetch3$1=r}async function validateGithub$1(r,t,n){try{return await(await _fetch3$1(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${r}`}catch{return!1}}var nip47_exports$1={};__export$1(nip47_exports$1,{makeNwcRequestEvent:()=>makeNwcRequestEvent$1,parseConnectionString:()=>parseConnectionString$1});function parseConnectionString$1(r){const{host:t,pathname:n,searchParams:s}=new URL(r),o=n||t,a=s.get("relay"),c=s.get("secret");if(!o||!a||!c)throw new Error("invalid connection string");return{pubkey:o,relay:a,secret:c}}async function makeNwcRequestEvent$1(r,t,n){const o=encrypt$6(t,r,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),a={kind:NWCWalletRequest$1,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",r]]};return finalizeEvent$1(a,t)}var nip54_exports$1={};__export$1(nip54_exports$1,{normalizeIdentifier:()=>normalizeIdentifier$1});function normalizeIdentifier$1(r){return r=r.trim().toLowerCase(),r=r.normalize("NFKC"),Array.from(r).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nip57_exports$1={};__export$1(nip57_exports$1,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11$1,getZapEndpoint:()=>getZapEndpoint$1,makeZapReceipt:()=>makeZapReceipt$1,makeZapRequest:()=>makeZapRequest$1,useFetchImplementation:()=>useFetchImplementation4$1,validateZapRequest:()=>validateZapRequest$1});var _fetch4$1;try{_fetch4$1=fetch}catch{}function useFetchImplementation4$1(r){_fetch4$1=r}async function getZapEndpoint$1(r){try{let t="",{lud06:n,lud16:s}=JSON.parse(r.content);if(n){let{words:c}=bech32$3.decode(n,1e3),f=bech32$3.fromWords(c);t=utf8Decoder$3.decode(f)}else if(s){let[c,f]=s.split("@");t=new URL(`/.well-known/lnurlp/${c}`,`https://${f}`).toString()}else return null;let a=await(await _fetch4$1(t)).json();if(a.allowsNostr&&a.nostrPubkey)return a.callback}catch{}return null}function makeZapRequest$1(r){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:r.comment||"",tags:[["p","pubkey"in r?r.pubkey:r.event.pubkey],["amount",r.amount.toString()],["relays",...r.relays]]};if("event"in r){if(t.tags.push(["e",r.event.id]),isReplaceableKind$1(r.event.kind)){const n=["a",`${r.event.kind}:${r.event.pubkey}:`];t.tags.push(n)}else if(isAddressableKind$1(r.event.kind)){let n=r.event.tags.find(([o,a])=>o==="d"&&a);if(!n)throw new Error("d tag not found or is empty");const s=["a",`${r.event.kind}:${r.event.pubkey}:${n[1]}`];t.tags.push(s)}t.tags.push(["k",r.event.kind.toString()])}return t}function validateZapRequest$1(r){let t;try{t=JSON.parse(r)}catch{return"Invalid zap request JSON."}if(!validateEvent$1(t))return"Zap request is not a valid Nostr event.";if(!verifyEvent$1(t))return"Invalid signature on zap request.";let n=t.tags.find(([a,c])=>a==="p"&&c);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let s=t.tags.find(([a,c])=>a==="e"&&c);return s&&!s[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([a,c])=>a==="relays"&&c)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt$1({zapRequest:r,preimage:t,bolt11:n,paidAt:s}){let o=JSON.parse(r),a=o.tags.filter(([f])=>f==="e"||f==="p"||f==="a"),c={kind:9735,created_at:Math.round(s.getTime()/1e3),content:"",tags:[...a,["P",o.pubkey],["bolt11",n],["description",r]]};return t&&c.tags.push(["preimage",t]),c}function getSatoshisAmountFromBolt11$1(r){if(r.length<50)return 0;r=r.substring(0,50);const t=r.lastIndexOf("1");if(t===-1)return 0;const n=r.substring(0,t);if(!n.startsWith("lnbc"))return 0;const s=n.substring(4);if(s.length<1)return 0;const o=s[s.length-1],a=o.charCodeAt(0)-48,c=a>=0&&a<=9;let f=s.length-1;if(c&&f++,f<1)return 0;const g=parseInt(s.substring(0,f));switch(o){case"m":return g*1e5;case"u":return g*100;case"n":return g/10;case"p":return g/1e4;default:return g*1e8}}var nip98_exports$1={};__export$1(nip98_exports$1,{getToken:()=>getToken$1,hashPayload:()=>hashPayload$1,unpackEventFromToken:()=>unpackEventFromToken$1,validateEvent:()=>validateEvent2$1,validateEventKind:()=>validateEventKind$1,validateEventMethodTag:()=>validateEventMethodTag$1,validateEventPayloadTag:()=>validateEventPayloadTag$1,validateEventTimestamp:()=>validateEventTimestamp$1,validateEventUrlTag:()=>validateEventUrlTag$1,validateToken:()=>validateToken$1});var _authorizationScheme$1="Nostr ";async function getToken$1(r,t,n,s=!1,o){const a={kind:HTTPAuth$1,tags:[["u",r],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&a.tags.push(["payload",hashPayload$1(o)]);const c=await n(a);return(s?_authorizationScheme$1:"")+base64$1.encode(utf8Encoder$3.encode(JSON.stringify(c)))}async function validateToken$1(r,t,n){const s=await unpackEventFromToken$1(r).catch(a=>{throw a});return await validateEvent2$1(s,t,n).catch(a=>{throw a})}async function unpackEventFromToken$1(r){if(!r)throw new Error("Missing token");r=r.replace(_authorizationScheme$1,"");const t=utf8Decoder$3.decode(base64$1.decode(r));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function validateEventTimestamp$1(r){return r.created_at?Math.round(new Date().getTime()/1e3)-r.created_at<60:!1}function validateEventKind$1(r){return r.kind===HTTPAuth$1}function validateEventUrlTag$1(r,t){const n=r.tags.find(s=>s[0]==="u");return n?n.length>0&&n[1]===t:!1}function validateEventMethodTag$1(r,t){const n=r.tags.find(s=>s[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function hashPayload$1(r){const t=sha256$6(utf8Encoder$3.encode(JSON.stringify(r)));return bytesToHex$5(t)}function validateEventPayloadTag$1(r,t){const n=r.tags.find(o=>o[0]==="payload");if(!n)return!1;const s=hashPayload$1(t);return n.length>0&&n[1]===s}async function validateEvent2$1(r,t,n,s){if(!verifyEvent$1(r))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind$1(r))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp$1(r))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag$1(r,t))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag$1(r,n))throw new Error("Invalid nostr event, method tag invalid");if(s&&typeof s=="object"&&Object.keys(s).length>0&&!validateEventPayloadTag$1(r,s))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const crypto$4=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$3(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function anumber$2(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function abytes$1(r,...t){if(!isBytes$3(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function ahash$1(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$2(r.outputLen),anumber$2(r.blockLen)}function aexists$1(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function aoutput$1(r,t){abytes$1(r);const n=t.outputLen;if(r.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function clean$1(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}function createView$4(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function rotr$3(r,t){return r<<32-t|r>>>t}function rotl$4(r,t){return r<<t|r>>>32-t>>>0}const hasHexBuiltin$1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$3=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$4(r){if(abytes$1(r),hasHexBuiltin$1)return r.toHex();let t="";for(let n=0;n<r.length;n++)t+=hexes$3[r[n]];return t}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(r){if(r>=asciis$1._0&&r<=asciis$1._9)return r-asciis$1._0;if(r>=asciis$1.A&&r<=asciis$1.F)return r-(asciis$1.A-10);if(r>=asciis$1.a&&r<=asciis$1.f)return r-(asciis$1.a-10)}function hexToBytes$4(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(hasHexBuiltin$1)return Uint8Array.fromHex(r);const t=r.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(n);for(let o=0,a=0;o<n;o++,a+=2){const c=asciiToBase16$1(r.charCodeAt(a)),f=asciiToBase16$1(r.charCodeAt(a+1));if(c===void 0||f===void 0){const g=r[a]+r[a+1];throw new Error('hex string expected, got non-hex character "'+g+'" at index '+a)}s[o]=c*16+f}return s}function utf8ToBytes$5(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function toBytes$4(r){return typeof r=="string"&&(r=utf8ToBytes$5(r)),abytes$1(r),r}function concatBytes$4(...r){let t=0;for(let s=0;s<r.length;s++){const o=r[s];abytes$1(o),t+=o.length}const n=new Uint8Array(t);for(let s=0,o=0;s<r.length;s++){const a=r[s];n.set(a,o),o+=a.length}return n}let Hash$3=class{};function createHasher$1(r){const t=s=>r().update(toBytes$4(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$3(r=32){if(crypto$4&&typeof crypto$4.getRandomValues=="function")return crypto$4.getRandomValues(new Uint8Array(r));if(crypto$4&&typeof crypto$4.randomBytes=="function")return Uint8Array.from(crypto$4.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$4(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}function Chi$3(r,t,n){return r&t^~r&n}function Maj$3(r,t,n){return r&t^r&n^t&n}let HashMD$1=class extends Hash$3{constructor(t,n,s,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.buffer=new Uint8Array(t),this.view=createView$4(this.buffer)}update(t){aexists$1(this),t=toBytes$4(t),abytes$1(t);const{view:n,buffer:s,blockLen:o}=this,a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$4(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){aexists$1(this),aoutput$1(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,clean$1(this.buffer.subarray(c)),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$4(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$4(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.destroyed=c,t.finished=a,t.length=o,t.pos=f,o%n&&t.buffer.set(s),t}clone(){return this._cloneInto()}};const SHA256_IV$1=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV$1=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(r,t=!1){return t?{h:Number(r&U32_MASK64$1),l:Number(r>>_32n$1&U32_MASK64$1)}:{h:Number(r>>_32n$1&U32_MASK64$1)|0,l:Number(r&U32_MASK64$1)|0}}function split$2(r,t=!1){const n=r.length;let s=new Uint32Array(n),o=new Uint32Array(n);for(let a=0;a<n;a++){const{h:c,l:f}=fromBig$1(r[a],t);[s[a],o[a]]=[c,f]}return[s,o]}const shrSH$1=(r,t,n)=>r>>>n,shrSL$1=(r,t,n)=>r<<32-n|t>>>n,rotrSH$1=(r,t,n)=>r>>>n|t<<32-n,rotrSL$1=(r,t,n)=>r<<32-n|t>>>n,rotrBH$1=(r,t,n)=>r<<64-n|t>>>n-32,rotrBL$1=(r,t,n)=>r>>>n-32|t<<64-n;function add$1(r,t,n,s){const o=(t>>>0)+(s>>>0);return{h:r+n+(o/2**32|0)|0,l:o|0}}const add3L$1=(r,t,n)=>(r>>>0)+(t>>>0)+(n>>>0),add3H$1=(r,t,n,s)=>t+n+s+(r/2**32|0)|0,add4L$1=(r,t,n,s)=>(r>>>0)+(t>>>0)+(n>>>0)+(s>>>0),add4H$1=(r,t,n,s,o)=>t+n+s+o+(r/2**32|0)|0,add5L$1=(r,t,n,s,o)=>(r>>>0)+(t>>>0)+(n>>>0)+(s>>>0)+(o>>>0),add5H$1=(r,t,n,s,o,a)=>t+n+s+o+a+(r/2**32|0)|0,SHA256_K$3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W$3=new Uint32Array(64);let SHA256$3=class extends HashMD$1{constructor(t=32){super(64,t,8,!1),this.A=SHA256_IV$1[0]|0,this.B=SHA256_IV$1[1]|0,this.C=SHA256_IV$1[2]|0,this.D=SHA256_IV$1[3]|0,this.E=SHA256_IV$1[4]|0,this.F=SHA256_IV$1[5]|0,this.G=SHA256_IV$1[6]|0,this.H=SHA256_IV$1[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$3[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$3[L-15],X=SHA256_W$3[L-2],te=rotr$3(q,7)^rotr$3(q,18)^q>>>3,ne=rotr$3(X,17)^rotr$3(X,19)^X>>>10;SHA256_W$3[L]=ne+SHA256_W$3[L-7]+te+SHA256_W$3[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$3(f,6)^rotr$3(f,11)^rotr$3(f,25),X=_+q+Chi$3(f,g,b)+SHA256_K$3[L]+SHA256_W$3[L]|0,ne=(rotr$3(s,2)^rotr$3(s,13)^rotr$3(s,22))+Maj$3(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){clean$1(SHA256_W$3)}destroy(){this.set(0,0,0,0,0,0,0,0),clean$1(this.buffer)}};const K512$1=split$2(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),SHA512_Kh$1=K512$1[0],SHA512_Kl$1=K512$1[1],SHA512_W_H$1=new Uint32Array(80),SHA512_W_L$1=new Uint32Array(80);let SHA512$1=class extends HashMD$1{constructor(t=64){super(128,t,16,!1),this.Ah=SHA512_IV$1[0]|0,this.Al=SHA512_IV$1[1]|0,this.Bh=SHA512_IV$1[2]|0,this.Bl=SHA512_IV$1[3]|0,this.Ch=SHA512_IV$1[4]|0,this.Cl=SHA512_IV$1[5]|0,this.Dh=SHA512_IV$1[6]|0,this.Dl=SHA512_IV$1[7]|0,this.Eh=SHA512_IV$1[8]|0,this.El=SHA512_IV$1[9]|0,this.Fh=SHA512_IV$1[10]|0,this.Fl=SHA512_IV$1[11]|0,this.Gh=SHA512_IV$1[12]|0,this.Gl=SHA512_IV$1[13]|0,this.Hh=SHA512_IV$1[14]|0,this.Hl=SHA512_IV$1[15]|0}get(){const{Ah:t,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:g,Eh:b,El:_,Fh:L,Fl:q,Gh:X,Gl:te,Hh:ne,Hl:Ce}=this;return[t,n,s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce]}set(t,n,s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce){this.Ah=t|0,this.Al=n|0,this.Bh=s|0,this.Bl=o|0,this.Ch=a|0,this.Cl=c|0,this.Dh=f|0,this.Dl=g|0,this.Eh=b|0,this.El=_|0,this.Fh=L|0,this.Fl=q|0,this.Gh=X|0,this.Gl=te|0,this.Hh=ne|0,this.Hl=Ce|0}process(t,n){for(let ze=0;ze<16;ze++,n+=4)SHA512_W_H$1[ze]=t.getUint32(n),SHA512_W_L$1[ze]=t.getUint32(n+=4);for(let ze=16;ze<80;ze++){const Xe=SHA512_W_H$1[ze-15]|0,He=SHA512_W_L$1[ze-15]|0,Ve=rotrSH$1(Xe,He,1)^rotrSH$1(Xe,He,8)^shrSH$1(Xe,He,7),We=rotrSL$1(Xe,He,1)^rotrSL$1(Xe,He,8)^shrSL$1(Xe,He,7),rt=SHA512_W_H$1[ze-2]|0,st=SHA512_W_L$1[ze-2]|0,ht=rotrSH$1(rt,st,19)^rotrBH$1(rt,st,61)^shrSH$1(rt,st,6),je=rotrSL$1(rt,st,19)^rotrBL$1(rt,st,61)^shrSL$1(rt,st,6),se=add4L$1(We,je,SHA512_W_L$1[ze-7],SHA512_W_L$1[ze-16]),m=add4H$1(se,Ve,ht,SHA512_W_H$1[ze-7],SHA512_W_H$1[ze-16]);SHA512_W_H$1[ze]=m|0,SHA512_W_L$1[ze]=se|0}let{Ah:s,Al:o,Bh:a,Bl:c,Ch:f,Cl:g,Dh:b,Dl:_,Eh:L,El:q,Fh:X,Fl:te,Gh:ne,Gl:Ce,Hh:Le,Hl:Ge}=this;for(let ze=0;ze<80;ze++){const Xe=rotrSH$1(L,q,14)^rotrSH$1(L,q,18)^rotrBH$1(L,q,41),He=rotrSL$1(L,q,14)^rotrSL$1(L,q,18)^rotrBL$1(L,q,41),Ve=L&X^~L&ne,We=q&te^~q&Ce,rt=add5L$1(Ge,He,We,SHA512_Kl$1[ze],SHA512_W_L$1[ze]),st=add5H$1(rt,Le,Xe,Ve,SHA512_Kh$1[ze],SHA512_W_H$1[ze]),ht=rt|0,je=rotrSH$1(s,o,28)^rotrBH$1(s,o,34)^rotrBH$1(s,o,39),se=rotrSL$1(s,o,28)^rotrBL$1(s,o,34)^rotrBL$1(s,o,39),m=s&a^s&f^a&f,A=o&c^o&g^c&g;Le=ne|0,Ge=Ce|0,ne=X|0,Ce=te|0,X=L|0,te=q|0,{h:L,l:q}=add$1(b|0,_|0,st|0,ht|0),b=f|0,_=g|0,f=a|0,g=c|0,a=s|0,c=o|0;const k=add3L$1(ht,se,A);s=add3H$1(k,st,je,m),o=k|0}({h:s,l:o}=add$1(this.Ah|0,this.Al|0,s|0,o|0)),{h:a,l:c}=add$1(this.Bh|0,this.Bl|0,a|0,c|0),{h:f,l:g}=add$1(this.Ch|0,this.Cl|0,f|0,g|0),{h:b,l:_}=add$1(this.Dh|0,this.Dl|0,b|0,_|0),{h:L,l:q}=add$1(this.Eh|0,this.El|0,L|0,q|0),{h:X,l:te}=add$1(this.Fh|0,this.Fl|0,X|0,te|0),{h:ne,l:Ce}=add$1(this.Gh|0,this.Gl|0,ne|0,Ce|0),{h:Le,l:Ge}=add$1(this.Hh|0,this.Hl|0,Le|0,Ge|0),this.set(s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce,Le,Ge)}roundClean(){clean$1(SHA512_W_H$1,SHA512_W_L$1)}destroy(){clean$1(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const sha256$5=createHasher$1(()=>new SHA256$3),sha512$1=createHasher$1(()=>new SHA512$1);let HMAC$3=class extends Hash$3{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ahash$1(t);const s=toBytes$4(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),clean$1(a)}update(t){return aexists$1(this),this.iHash.update(t),this}digestInto(t){aexists$1(this),abytes$1(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$3=(r,t,n)=>new HMAC$3(r,t).update(n).digest();hmac$3.create=(r,t)=>new HMAC$3(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$e=BigInt(0),_1n$e=BigInt(1);function _abool2$1(r,t=""){if(typeof r!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof r)}return r}function _abytes2$1(r,t,n=""){const s=isBytes$3(r),o=r?.length,a=t!==void 0;if(!s||a&&o!==t){const c=n&&`"${n}" `,f=a?` of length ${t}`:"",g=s?`length=${o}`:`type=${typeof r}`;throw new Error(c+"expected Uint8Array"+f+", got "+g)}return r}function numberToHexUnpadded$2(r){const t=r.toString(16);return t.length&1?"0"+t:t}function hexToNumber$2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?_0n$e:BigInt("0x"+r)}function bytesToNumberBE$2(r){return hexToNumber$2(bytesToHex$4(r))}function bytesToNumberLE$2(r){return abytes$1(r),hexToNumber$2(bytesToHex$4(Uint8Array.from(r).reverse()))}function numberToBytesBE$2(r,t){return hexToBytes$4(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE$2(r,t){return numberToBytesBE$2(r,t).reverse()}function ensureBytes$2(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes$4(t)}catch(a){throw new Error(r+" must be hex string or Uint8Array, cause: "+a)}else if(isBytes$3(t))s=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(r+" of length "+n+" expected, got "+o);return s}const isPosBig$1=r=>typeof r=="bigint"&&_0n$e<=r;function inRange$1(r,t,n){return isPosBig$1(r)&&isPosBig$1(t)&&isPosBig$1(n)&&t<=r&&r<n}function aInRange$1(r,t,n,s){if(!inRange$1(t,n,s))throw new Error("expected valid "+r+": "+n+" <= n < "+s+", got "+t)}function bitLen$2(r){let t;for(t=0;r>_0n$e;r>>=_1n$e,t+=1);return t}const bitMask$2=r=>(_1n$e<<BigInt(r))-_1n$e;function createHmacDrbg$2(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const s=X=>new Uint8Array(X),o=X=>Uint8Array.of(X);let a=s(r),c=s(r),f=0;const g=()=>{a.fill(1),c.fill(0),f=0},b=(...X)=>n(c,a,...X),_=(X=s(0))=>{c=b(o(0),X),a=b(),X.length!==0&&(c=b(o(1),X),a=b())},L=()=>{if(f++>=1e3)throw new Error("drbg: tried 1000 values");let X=0;const te=[];for(;X<t;){a=b();const ne=a.slice();te.push(ne),X+=a.length}return concatBytes$4(...te)};return(X,te)=>{g(),_(X);let ne;for(;!(ne=te(L()));)_();return g(),ne}}function _validateObject$1(r,t,n={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function s(o,a,c){const f=r[o];if(c&&f===void 0)return;const g=typeof f;if(g!==a||f===null)throw new Error(`param "${o}" is invalid: expected ${a}, got ${g}`)}Object.entries(t).forEach(([o,a])=>s(o,a,!1)),Object.entries(n).forEach(([o,a])=>s(o,a,!0))}function memoized$1(r){const t=new WeakMap;return(n,...s)=>{const o=t.get(n);if(o!==void 0)return o;const a=r(n,...s);return t.set(n,a),a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$d=BigInt(0),_1n$d=BigInt(1),_2n$8=BigInt(2),_3n$5=BigInt(3),_4n$4=BigInt(4),_5n$2=BigInt(5),_7n$1=BigInt(7),_8n$2=BigInt(8),_9n$1=BigInt(9),_16n$1=BigInt(16);function mod$2(r,t){const n=r%t;return n>=_0n$d?n:t+n}function pow2$2(r,t,n){let s=r;for(;t-- >_0n$d;)s*=s,s%=n;return s}function invert$2(r,t){if(r===_0n$d)throw new Error("invert: expected non-zero number");if(t<=_0n$d)throw new Error("invert: expected positive modulus, got "+t);let n=mod$2(r,t),s=t,o=_0n$d,a=_1n$d;for(;n!==_0n$d;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n$d)throw new Error("invert: does not exist");return mod$2(o,t)}function assertIsSquare$1(r,t,n){if(!r.eql(r.sqr(t),n))throw new Error("Cannot find square root")}function sqrt3mod4$1(r,t){const n=(r.ORDER+_1n$d)/_4n$4,s=r.pow(t,n);return assertIsSquare$1(r,s,t),s}function sqrt5mod8$1(r,t){const n=(r.ORDER-_5n$2)/_8n$2,s=r.mul(t,_2n$8),o=r.pow(s,n),a=r.mul(t,o),c=r.mul(r.mul(a,_2n$8),o),f=r.mul(a,r.sub(c,r.ONE));return assertIsSquare$1(r,f,t),f}function sqrt9mod16$1(r){const t=Field$2(r),n=tonelliShanks$2(r),s=n(t,t.neg(t.ONE)),o=n(t,s),a=n(t,t.neg(s)),c=(r+_7n$1)/_16n$1;return(f,g)=>{let b=f.pow(g,c),_=f.mul(b,s);const L=f.mul(b,o),q=f.mul(b,a),X=f.eql(f.sqr(_),g),te=f.eql(f.sqr(L),g);b=f.cmov(b,_,X),_=f.cmov(q,L,te);const ne=f.eql(f.sqr(_),g),Ce=f.cmov(b,_,ne);return assertIsSquare$1(f,Ce,g),Ce}}function tonelliShanks$2(r){if(r<_3n$5)throw new Error("sqrt is not defined for small field");let t=r-_1n$d,n=0;for(;t%_2n$8===_0n$d;)t/=_2n$8,n++;let s=_2n$8;const o=Field$2(r);for(;FpLegendre$1(o,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return sqrt3mod4$1;let a=o.pow(s,t);const c=(t+_1n$d)/_2n$8;return function(g,b){if(g.is0(b))return b;if(FpLegendre$1(g,b)!==1)throw new Error("Cannot find square root");let _=n,L=g.mul(g.ONE,a),q=g.pow(b,t),X=g.pow(b,c);for(;!g.eql(q,g.ONE);){if(g.is0(q))return g.ZERO;let te=1,ne=g.sqr(q);for(;!g.eql(ne,g.ONE);)if(te++,ne=g.sqr(ne),te===_)throw new Error("Cannot find square root");const Ce=_1n$d<<BigInt(_-te-1),Le=g.pow(L,Ce);_=te,L=g.sqr(Le),q=g.mul(q,L),X=g.mul(X,Le)}return X}}function FpSqrt$2(r){return r%_4n$4===_3n$5?sqrt3mod4$1:r%_8n$2===_5n$2?sqrt5mod8$1:r%_16n$1===_9n$1?sqrt9mod16$1(r):tonelliShanks$2(r)}const FIELD_FIELDS$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$2(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=FIELD_FIELDS$2.reduce((s,o)=>(s[o]="function",s),t);return _validateObject$1(r,n),r}function FpPow$2(r,t,n){if(n<_0n$d)throw new Error("invalid exponent, negatives unsupported");if(n===_0n$d)return r.ONE;if(n===_1n$d)return t;let s=r.ONE,o=t;for(;n>_0n$d;)n&_1n$d&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n$d;return s}function FpInvertBatch$2(r,t,n=!1){const s=new Array(t.length).fill(n?r.ZERO:void 0),o=t.reduce((c,f,g)=>r.is0(f)?c:(s[g]=c,r.mul(c,f)),r.ONE),a=r.inv(o);return t.reduceRight((c,f,g)=>r.is0(f)?c:(s[g]=r.mul(c,s[g]),r.mul(c,f)),a),s}function FpLegendre$1(r,t){const n=(r.ORDER-_1n$d)/_2n$8,s=r.pow(t,n),o=r.eql(s,r.ONE),a=r.eql(s,r.ZERO),c=r.eql(s,r.neg(r.ONE));if(!o&&!a&&!c)throw new Error("invalid Legendre symbol result");return o?1:a?0:-1}function nLength$2(r,t){t!==void 0&&anumber$2(t);const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field$2(r,t,n=!1,s={}){if(r<=_0n$d)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,a,c=!1,f;if(typeof t=="object"&&t!=null){if(s.sqrt||n)throw new Error("cannot specify opts in two arguments");const q=t;q.BITS&&(o=q.BITS),q.sqrt&&(a=q.sqrt),typeof q.isLE=="boolean"&&(n=q.isLE),typeof q.modFromBytes=="boolean"&&(c=q.modFromBytes),f=q.allowedLengths}else typeof t=="number"&&(o=t),s.sqrt&&(a=s.sqrt);const{nBitLength:g,nByteLength:b}=nLength$2(r,o);if(b>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let _;const L=Object.freeze({ORDER:r,isLE:n,BITS:g,BYTES:b,MASK:bitMask$2(g),ZERO:_0n$d,ONE:_1n$d,allowedLengths:f,create:q=>mod$2(q,r),isValid:q=>{if(typeof q!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof q);return _0n$d<=q&&q<r},is0:q=>q===_0n$d,isValidNot0:q=>!L.is0(q)&&L.isValid(q),isOdd:q=>(q&_1n$d)===_1n$d,neg:q=>mod$2(-q,r),eql:(q,X)=>q===X,sqr:q=>mod$2(q*q,r),add:(q,X)=>mod$2(q+X,r),sub:(q,X)=>mod$2(q-X,r),mul:(q,X)=>mod$2(q*X,r),pow:(q,X)=>FpPow$2(L,q,X),div:(q,X)=>mod$2(q*invert$2(X,r),r),sqrN:q=>q*q,addN:(q,X)=>q+X,subN:(q,X)=>q-X,mulN:(q,X)=>q*X,inv:q=>invert$2(q,r),sqrt:a||(q=>(_||(_=FpSqrt$2(r)),_(L,q))),toBytes:q=>n?numberToBytesLE$2(q,b):numberToBytesBE$2(q,b),fromBytes:(q,X=!0)=>{if(f){if(!f.includes(q.length)||q.length>b)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+q.length);const ne=new Uint8Array(b);ne.set(q,n?0:ne.length-q.length),q=ne}if(q.length!==b)throw new Error("Field.fromBytes: expected "+b+" bytes, got "+q.length);let te=n?bytesToNumberLE$2(q):bytesToNumberBE$2(q);if(c&&(te=mod$2(te,r)),!X&&!L.isValid(te))throw new Error("invalid field element: outside of range 0..ORDER");return te},invertBatch:q=>FpInvertBatch$2(L,q),cmov:(q,X,te)=>te?X:q});return Object.freeze(L)}function getFieldBytesLength$2(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$2(r){const t=getFieldBytesLength$2(r);return t+Math.ceil(t/2)}function mapHashToField$2(r,t,n=!1){const s=r.length,o=getFieldBytesLength$2(t),a=getMinHashLength$2(t);if(s<16||s<a||s>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+s);const c=n?bytesToNumberLE$2(r):bytesToNumberBE$2(r),f=mod$2(c,t-_1n$d)+_1n$d;return n?numberToBytesLE$2(f,o):numberToBytesBE$2(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$c=BigInt(0),_1n$c=BigInt(1);function negateCt$1(r,t){const n=t.negate();return r?n:t}function normalizeZ$1(r,t){const n=FpInvertBatch$2(r.Fp,t.map(s=>s.Z));return t.map((s,o)=>r.fromAffine(s.toAffine(n[o])))}function validateW$1(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function calcWOpts$1(r,t){validateW$1(r,t);const n=Math.ceil(t/r)+1,s=2**(r-1),o=2**r,a=bitMask$2(r),c=BigInt(r);return{windows:n,windowSize:s,mask:a,maxNumber:o,shiftBy:c}}function calcOffsets$1(r,t,n){const{windowSize:s,mask:o,maxNumber:a,shiftBy:c}=n;let f=Number(r&o),g=r>>c;f>s&&(f-=a,g+=_1n$c);const b=t*s,_=b+Math.abs(f)-1,L=f===0,q=f<0,X=t%2!==0;return{nextN:g,offset:_,isZero:L,isNeg:q,isNegF:X,offsetF:b}}function validateMSMPoints$1(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((n,s)=>{if(!(n instanceof t))throw new Error("invalid point at index "+s)})}function validateMSMScalars$1(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((n,s)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+s)})}const pointPrecomputes$1=new WeakMap,pointWindowSizes$1=new WeakMap;function getW$1(r){return pointWindowSizes$1.get(r)||1}function assert0$1(r){if(r!==_0n$c)throw new Error("invalid wNAF")}let wNAF$2=class{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,s=this.ZERO){let o=t;for(;n>_0n$c;)n&_1n$c&&(s=s.add(o)),o=o.double(),n>>=_1n$c;return s}precomputeWindow(t,n){const{windows:s,windowSize:o}=calcWOpts$1(n,this.bits),a=[];let c=t,f=c;for(let g=0;g<s;g++){f=c,a.push(f);for(let b=1;b<o;b++)f=f.add(c),a.push(f);c=f.double()}return a}wNAF(t,n,s){if(!this.Fn.isValid(s))throw new Error("invalid scalar");let o=this.ZERO,a=this.BASE;const c=calcWOpts$1(t,this.bits);for(let f=0;f<c.windows;f++){const{nextN:g,offset:b,isZero:_,isNeg:L,isNegF:q,offsetF:X}=calcOffsets$1(s,f,c);s=g,_?a=a.add(negateCt$1(q,n[X])):o=o.add(negateCt$1(L,n[b]))}return assert0$1(s),{p:o,f:a}}wNAFUnsafe(t,n,s,o=this.ZERO){const a=calcWOpts$1(t,this.bits);for(let c=0;c<a.windows&&s!==_0n$c;c++){const{nextN:f,offset:g,isZero:b,isNeg:_}=calcOffsets$1(s,c,a);if(s=f,!b){const L=n[g];o=o.add(_?L.negate():L)}}return assert0$1(s),o}getPrecomputes(t,n,s){let o=pointPrecomputes$1.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof s=="function"&&(o=s(o)),pointPrecomputes$1.set(n,o))),o}cached(t,n,s){const o=getW$1(t);return this.wNAF(o,this.getPrecomputes(o,t,s),n)}unsafe(t,n,s,o){const a=getW$1(t);return a===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),n,o)}createCache(t,n){validateW$1(n,this.bits),pointWindowSizes$1.set(t,n),pointPrecomputes$1.delete(t)}hasCache(t){return getW$1(t)!==1}};function mulEndoUnsafe$1(r,t,n,s){let o=t,a=r.ZERO,c=r.ZERO;for(;n>_0n$c||s>_0n$c;)n&_1n$c&&(a=a.add(o)),s&_1n$c&&(c=c.add(o)),o=o.double(),n>>=_1n$c,s>>=_1n$c;return{p1:a,p2:c}}function pippenger$1(r,t,n,s){validateMSMPoints$1(n,r),validateMSMScalars$1(s,t);const o=n.length,a=s.length;if(o!==a)throw new Error("arrays of points and scalars must have equal length");const c=r.ZERO,f=bitLen$2(BigInt(o));let g=1;f>12?g=f-3:f>4?g=f-2:f>0&&(g=2);const b=bitMask$2(g),_=new Array(Number(b)+1).fill(c),L=Math.floor((t.BITS-1)/g)*g;let q=c;for(let X=L;X>=0;X-=g){_.fill(c);for(let ne=0;ne<a;ne++){const Ce=s[ne],Le=Number(Ce>>BigInt(X)&b);_[Le]=_[Le].add(n[ne])}let te=c;for(let ne=_.length-1,Ce=c;ne>0;ne--)Ce=Ce.add(_[ne]),te=te.add(Ce);if(q=q.add(te),X!==0)for(let ne=0;ne<g;ne++)q=q.double()}return q}function createField$1(r,t,n){if(t){if(t.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField$2(t),t}else return Field$2(r,{isLE:n})}function _createCurveFields$1(r,t,n={},s){if(s===void 0&&(s=r==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${r} CURVE object`);for(const g of["p","n","h"]){const b=t[g];if(!(typeof b=="bigint"&&b>_0n$c))throw new Error(`CURVE.${g} must be positive bigint`)}const o=createField$1(t.p,n.Fp,s),a=createField$1(t.n,n.Fn,s),f=["Gx","Gy","a","b"];for(const g of f)if(!o.isValid(t[g]))throw new Error(`CURVE.${g} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const divNearest$2=(r,t)=>(r+(r>=0?t:-t)/_2n$7)/t;function _splitEndoScalar$1(r,t,n){const[[s,o],[a,c]]=t,f=divNearest$2(c*r,n),g=divNearest$2(-o*r,n);let b=r-f*s-g*a,_=-f*o-g*c;const L=b<_0n$b,q=_<_0n$b;L&&(b=-b),q&&(_=-_);const X=bitMask$2(Math.ceil(bitLen$2(n)/2))+_1n$b;if(b<_0n$b||b>=X||_<_0n$b||_>=X)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}function validateSigFormat$1(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function validateSigOpts$1(r,t){const n={};for(let s of Object.keys(t))n[s]=r[s]===void 0?t[s]:r[s];return _abool2$1(n.lowS,"lowS"),_abool2$1(n.prehash,"prehash"),n.format!==void 0&&validateSigFormat$1(n.format),n}let DERErr$1=class extends Error{constructor(t=""){super(t)}};const DER$2={Err:DERErr$1,_tlv:{encode:(r,t)=>{const{Err:n}=DER$2;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const s=t.length/2,o=numberToHexUnpadded$2(s);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const a=s>127?numberToHexUnpadded$2(o.length/2|128):"";return numberToHexUnpadded$2(r)+a+o+t},decode(r,t){const{Err:n}=DER$2;let s=0;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[s++]!==r)throw new n("tlv.decode: wrong tlv");const o=t[s++],a=!!(o&128);let c=0;if(!a)c=o;else{const g=o&127;if(!g)throw new n("tlv.decode(long): indefinite length not supported");if(g>4)throw new n("tlv.decode(long): byte length is too big");const b=t.subarray(s,s+g);if(b.length!==g)throw new n("tlv.decode: length bytes not complete");if(b[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const _ of b)c=c<<8|_;if(s+=g,c<128)throw new n("tlv.decode(long): not minimal encoding")}const f=t.subarray(s,s+c);if(f.length!==c)throw new n("tlv.decode: wrong value length");return{v:f,l:t.subarray(s+c)}}},_int:{encode(r){const{Err:t}=DER$2;if(r<_0n$b)throw new t("integer: negative integers are not allowed");let n=numberToHexUnpadded$2(r);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(r){const{Err:t}=DER$2;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$2(r)}},toSig(r){const{Err:t,_int:n,_tlv:s}=DER$2,o=ensureBytes$2("signature",r),{v:a,l:c}=s.decode(48,o);if(c.length)throw new t("invalid signature: left bytes after parsing");const{v:f,l:g}=s.decode(2,a),{v:b,l:_}=s.decode(2,g);if(_.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(f),s:n.decode(b)}},hexFromSig(r){const{_tlv:t,_int:n}=DER$2,s=t.encode(2,n.encode(r.r)),o=t.encode(2,n.encode(r.s)),a=s+o;return t.encode(48,a)}},_0n$b=BigInt(0),_1n$b=BigInt(1),_2n$7=BigInt(2),_3n$4=BigInt(3),_4n$3=BigInt(4);function _normFnElement$1(r,t){const{BYTES:n}=r;let s;if(typeof t=="bigint")s=t;else{let o=ensureBytes$2("private key",t);try{s=r.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}function weierstrassN$1(r,t={}){const n=_createCurveFields$1("weierstrass",r,t),{Fp:s,Fn:o}=n;let a=n.CURVE;const{h:c,n:f}=a;_validateObject$1(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:g}=t;if(g&&(!s.is0(a.a)||typeof g.beta!="bigint"||!Array.isArray(g.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const b=getWLengths$1(s,o);function _(){if(!s.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function L(se,m,A){const{x:k,y:Y}=m.toAffine(),Q=s.toBytes(k);if(_abool2$1(A,"isCompressed"),A){_();const $e=!s.isOdd(Y);return concatBytes$4(pprefix$1($e),Q)}else return concatBytes$4(Uint8Array.of(4),Q,s.toBytes(Y))}function q(se){_abytes2$1(se,void 0,"Point");const{publicKey:m,publicKeyUncompressed:A}=b,k=se.length,Y=se[0],Q=se.subarray(1);if(k===m&&(Y===2||Y===3)){const $e=s.fromBytes(Q);if(!s.isValid($e))throw new Error("bad point: is not on curve, wrong x");const ve=ne($e);let re;try{re=s.sqrt(ve)}catch(Ue){const Ze=Ue instanceof Error?": "+Ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ze)}_();const B=s.isOdd(re);return(Y&1)===1!==B&&(re=s.neg(re)),{x:$e,y:re}}else if(k===A&&Y===4){const $e=s.BYTES,ve=s.fromBytes(Q.subarray(0,$e)),re=s.fromBytes(Q.subarray($e,$e*2));if(!Ce(ve,re))throw new Error("bad point: is not on curve");return{x:ve,y:re}}else throw new Error(`bad point: got length ${k}, expected compressed=${m} or uncompressed=${A}`)}const X=t.toBytes||L,te=t.fromBytes||q;function ne(se){const m=s.sqr(se),A=s.mul(m,se);return s.add(s.add(A,s.mul(se,a.a)),a.b)}function Ce(se,m){const A=s.sqr(m),k=ne(se);return s.eql(A,k)}if(!Ce(a.Gx,a.Gy))throw new Error("bad curve params: generator point");const Le=s.mul(s.pow(a.a,_3n$4),_4n$3),Ge=s.mul(s.sqr(a.b),BigInt(27));if(s.is0(s.add(Le,Ge)))throw new Error("bad curve params: a or b");function ze(se,m,A=!1){if(!s.isValid(m)||A&&s.is0(m))throw new Error(`bad point coordinate ${se}`);return m}function Xe(se){if(!(se instanceof st))throw new Error("ProjectivePoint expected")}function He(se){if(!g||!g.basises)throw new Error("no endo");return _splitEndoScalar$1(se,g.basises,o.ORDER)}const Ve=memoized$1((se,m)=>{const{X:A,Y:k,Z:Y}=se;if(s.eql(Y,s.ONE))return{x:A,y:k};const Q=se.is0();m==null&&(m=Q?s.ONE:s.inv(Y));const $e=s.mul(A,m),ve=s.mul(k,m),re=s.mul(Y,m);if(Q)return{x:s.ZERO,y:s.ZERO};if(!s.eql(re,s.ONE))throw new Error("invZ was invalid");return{x:$e,y:ve}}),We=memoized$1(se=>{if(se.is0()){if(t.allowInfinityPoint&&!s.is0(se.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:A}=se.toAffine();if(!s.isValid(m)||!s.isValid(A))throw new Error("bad point: x or y not field elements");if(!Ce(m,A))throw new Error("bad point: equation left != right");if(!se.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function rt(se,m,A,k,Y){return A=new st(s.mul(A.X,se),A.Y,A.Z),m=negateCt$1(k,m),A=negateCt$1(Y,A),m.add(A)}class st{constructor(m,A,k){this.X=ze("x",m),this.Y=ze("y",A,!0),this.Z=ze("z",k),Object.freeze(this)}static CURVE(){return a}static fromAffine(m){const{x:A,y:k}=m||{};if(!m||!s.isValid(A)||!s.isValid(k))throw new Error("invalid affine point");if(m instanceof st)throw new Error("projective point not allowed");return s.is0(A)&&s.is0(k)?st.ZERO:new st(A,k,s.ONE)}static fromBytes(m){const A=st.fromAffine(te(_abytes2$1(m,void 0,"point")));return A.assertValidity(),A}static fromHex(m){return st.fromBytes(ensureBytes$2("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,A=!0){return je.createCache(this,m),A||this.multiply(_3n$4),this}assertValidity(){We(this)}hasEvenY(){const{y:m}=this.toAffine();if(!s.isOdd)throw new Error("Field doesn't support isOdd");return!s.isOdd(m)}equals(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m,re=s.eql(s.mul(A,ve),s.mul(Q,Y)),B=s.eql(s.mul(k,ve),s.mul($e,Y));return re&&B}negate(){return new st(this.X,s.neg(this.Y),this.Z)}double(){const{a:m,b:A}=a,k=s.mul(A,_3n$4),{X:Y,Y:Q,Z:$e}=this;let ve=s.ZERO,re=s.ZERO,B=s.ZERO,oe=s.mul(Y,Y),Ue=s.mul(Q,Q),Ze=s.mul($e,$e),lt=s.mul(Y,Q);return lt=s.add(lt,lt),B=s.mul(Y,$e),B=s.add(B,B),ve=s.mul(m,B),re=s.mul(k,Ze),re=s.add(ve,re),ve=s.sub(Ue,re),re=s.add(Ue,re),re=s.mul(ve,re),ve=s.mul(lt,ve),B=s.mul(k,B),Ze=s.mul(m,Ze),lt=s.sub(oe,Ze),lt=s.mul(m,lt),lt=s.add(lt,B),B=s.add(oe,oe),oe=s.add(B,oe),oe=s.add(oe,Ze),oe=s.mul(oe,lt),re=s.add(re,oe),Ze=s.mul(Q,$e),Ze=s.add(Ze,Ze),oe=s.mul(Ze,lt),ve=s.sub(ve,oe),B=s.mul(Ze,Ue),B=s.add(B,B),B=s.add(B,B),new st(ve,re,B)}add(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m;let re=s.ZERO,B=s.ZERO,oe=s.ZERO;const Ue=a.a,Ze=s.mul(a.b,_3n$4);let lt=s.mul(A,Q),St=s.mul(k,$e),Mt=s.mul(Y,ve),Ft=s.add(A,k),Zt=s.add(Q,$e);Ft=s.mul(Ft,Zt),Zt=s.add(lt,St),Ft=s.sub(Ft,Zt),Zt=s.add(A,Y);let Ut=s.add(Q,ve);return Zt=s.mul(Zt,Ut),Ut=s.add(lt,Mt),Zt=s.sub(Zt,Ut),Ut=s.add(k,Y),re=s.add($e,ve),Ut=s.mul(Ut,re),re=s.add(St,Mt),Ut=s.sub(Ut,re),oe=s.mul(Ue,Zt),re=s.mul(Ze,Mt),oe=s.add(re,oe),re=s.sub(St,oe),oe=s.add(St,oe),B=s.mul(re,oe),St=s.add(lt,lt),St=s.add(St,lt),Mt=s.mul(Ue,Mt),Zt=s.mul(Ze,Zt),St=s.add(St,Mt),Mt=s.sub(lt,Mt),Mt=s.mul(Ue,Mt),Zt=s.add(Zt,Mt),lt=s.mul(St,Zt),B=s.add(B,lt),lt=s.mul(Ut,Zt),re=s.mul(Ft,re),re=s.sub(re,lt),lt=s.mul(Ft,St),oe=s.mul(Ut,oe),oe=s.add(oe,lt),new st(re,B,oe)}subtract(m){return this.add(m.negate())}is0(){return this.equals(st.ZERO)}multiply(m){const{endo:A}=t;if(!o.isValidNot0(m))throw new Error("invalid scalar: out of range");let k,Y;const Q=$e=>je.cached(this,$e,ve=>normalizeZ$1(st,ve));if(A){const{k1neg:$e,k1:ve,k2neg:re,k2:B}=He(m),{p:oe,f:Ue}=Q(ve),{p:Ze,f:lt}=Q(B);Y=Ue.add(lt),k=rt(A.beta,oe,Ze,$e,re)}else{const{p:$e,f:ve}=Q(m);k=$e,Y=ve}return normalizeZ$1(st,[k,Y])[0]}multiplyUnsafe(m){const{endo:A}=t,k=this;if(!o.isValid(m))throw new Error("invalid scalar: out of range");if(m===_0n$b||k.is0())return st.ZERO;if(m===_1n$b)return k;if(je.hasCache(this))return this.multiply(m);if(A){const{k1neg:Y,k1:Q,k2neg:$e,k2:ve}=He(m),{p1:re,p2:B}=mulEndoUnsafe$1(st,k,Q,ve);return rt(A.beta,re,B,Y,$e)}else return je.unsafe(k,m)}multiplyAndAddUnsafe(m,A,k){const Y=this.multiplyUnsafe(A).add(m.multiplyUnsafe(k));return Y.is0()?void 0:Y}toAffine(m){return Ve(this,m)}isTorsionFree(){const{isTorsionFree:m}=t;return c===_1n$b?!0:m?m(st,this):je.unsafe(this,f).is0()}clearCofactor(){const{clearCofactor:m}=t;return c===_1n$b?this:m?m(st,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(m=!0){return _abool2$1(m,"isCompressed"),this.assertValidity(),X(st,this,m)}toHex(m=!0){return bytesToHex$4(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return normalizeZ$1(st,m)}static msm(m,A){return pippenger$1(st,o,m,A)}static fromPrivateKey(m){return st.BASE.multiply(_normFnElement$1(o,m))}}st.BASE=new st(a.Gx,a.Gy,s.ONE),st.ZERO=new st(s.ZERO,s.ONE,s.ZERO),st.Fp=s,st.Fn=o;const ht=o.BITS,je=new wNAF$2(st,t.endo?Math.ceil(ht/2):ht);return st.BASE.precompute(8),st}function pprefix$1(r){return Uint8Array.of(r?2:3)}function getWLengths$1(r,t){return{secretKey:t.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ecdh$1(r,t={}){const{Fn:n}=r,s=t.randomBytes||randomBytes$3,o=Object.assign(getWLengths$1(r.Fp,n),{seed:getMinHashLength$2(n.ORDER)});function a(X){try{return!!_normFnElement$1(n,X)}catch{return!1}}function c(X,te){const{publicKey:ne,publicKeyUncompressed:Ce}=o;try{const Le=X.length;return te===!0&&Le!==ne||te===!1&&Le!==Ce?!1:!!r.fromBytes(X)}catch{return!1}}function f(X=s(o.seed)){return mapHashToField$2(_abytes2$1(X,o.seed,"seed"),n.ORDER)}function g(X,te=!0){return r.BASE.multiply(_normFnElement$1(n,X)).toBytes(te)}function b(X){const te=f(X);return{secretKey:te,publicKey:g(te)}}function _(X){if(typeof X=="bigint")return!1;if(X instanceof r)return!0;const{secretKey:te,publicKey:ne,publicKeyUncompressed:Ce}=o;if(n.allowedLengths||te===ne)return;const Le=ensureBytes$2("key",X).length;return Le===ne||Le===Ce}function L(X,te,ne=!0){if(_(X)===!0)throw new Error("first arg must be private key");if(_(te)===!1)throw new Error("second arg must be public key");const Ce=_normFnElement$1(n,X);return r.fromHex(te).multiply(Ce).toBytes(ne)}return Object.freeze({getPublicKey:g,getSharedSecret:L,keygen:b,Point:r,utils:{isValidSecretKey:a,isValidPublicKey:c,randomSecretKey:f,isValidPrivateKey:a,randomPrivateKey:f,normPrivateKeyToScalar:X=>_normFnElement$1(n,X),precompute(X=8,te=r.BASE){return te.precompute(X,!1)}},lengths:o})}function ecdsa$1(r,t,n={}){ahash$1(t),_validateObject$1(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const s=n.randomBytes||randomBytes$3,o=n.hmac||((A,...k)=>hmac$3(t,A,concatBytes$4(...k))),{Fp:a,Fn:c}=r,{ORDER:f,BITS:g}=c,{keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X}=ecdh$1(r,n),te={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},ne="compact";function Ce(A){const k=f>>_1n$b;return A>k}function Le(A,k){if(!c.isValidNot0(k))throw new Error(`invalid signature ${A}: out of range 1..Point.Fn.ORDER`);return k}function Ge(A,k){validateSigFormat$1(k);const Y=X.signature,Q=k==="compact"?Y:k==="recovered"?Y+1:void 0;return _abytes2$1(A,Q,`${k} signature`)}class ze{constructor(k,Y,Q){this.r=Le("r",k),this.s=Le("s",Y),Q!=null&&(this.recovery=Q),Object.freeze(this)}static fromBytes(k,Y=ne){Ge(k,Y);let Q;if(Y==="der"){const{r:B,s:oe}=DER$2.toSig(_abytes2$1(k));return new ze(B,oe)}Y==="recovered"&&(Q=k[0],Y="compact",k=k.subarray(1));const $e=c.BYTES,ve=k.subarray(0,$e),re=k.subarray($e,$e*2);return new ze(c.fromBytes(ve),c.fromBytes(re),Q)}static fromHex(k,Y){return this.fromBytes(hexToBytes$4(k),Y)}addRecoveryBit(k){return new ze(this.r,this.s,k)}recoverPublicKey(k){const Y=a.ORDER,{r:Q,s:$e,recovery:ve}=this;if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");if(f*_2n$7<Y&&ve>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=ve===2||ve===3?Q+f:Q;if(!a.isValid(B))throw new Error("recovery id 2 or 3 invalid");const oe=a.toBytes(B),Ue=r.fromBytes(concatBytes$4(pprefix$1((ve&1)===0),oe)),Ze=c.inv(B),lt=He(ensureBytes$2("msgHash",k)),St=c.create(-lt*Ze),Mt=c.create($e*Ze),Ft=r.BASE.multiplyUnsafe(St).add(Ue.multiplyUnsafe(Mt));if(Ft.is0())throw new Error("point at infinify");return Ft.assertValidity(),Ft}hasHighS(){return Ce(this.s)}toBytes(k=ne){if(validateSigFormat$1(k),k==="der")return hexToBytes$4(DER$2.hexFromSig(this));const Y=c.toBytes(this.r),Q=c.toBytes(this.s);if(k==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes$4(Uint8Array.of(this.recovery),Y,Q)}return concatBytes$4(Y,Q)}toHex(k){return bytesToHex$4(this.toBytes(k))}assertValidity(){}static fromCompact(k){return ze.fromBytes(ensureBytes$2("sig",k),"compact")}static fromDER(k){return ze.fromBytes(ensureBytes$2("sig",k),"der")}normalizeS(){return this.hasHighS()?new ze(this.r,c.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex$4(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex$4(this.toBytes("compact"))}}const Xe=n.bits2int||function(k){if(k.length>8192)throw new Error("input is too large");const Y=bytesToNumberBE$2(k),Q=k.length*8-g;return Q>0?Y>>BigInt(Q):Y},He=n.bits2int_modN||function(k){return c.create(Xe(k))},Ve=bitMask$2(g);function We(A){return aInRange$1("num < 2^"+g,A,_0n$b,Ve),c.toBytes(A)}function rt(A,k){return _abytes2$1(A,void 0,"message"),k?_abytes2$1(t(A),void 0,"prehashed message"):A}function st(A,k,Y){if(["recovered","canonical"].some(St=>St in Y))throw new Error("sign() legacy options not supported");const{lowS:Q,prehash:$e,extraEntropy:ve}=validateSigOpts$1(Y,te);A=rt(A,$e);const re=He(A),B=_normFnElement$1(c,k),oe=[We(B),We(re)];if(ve!=null&&ve!==!1){const St=ve===!0?s(X.secretKey):ve;oe.push(ensureBytes$2("extraEntropy",St))}const Ue=concatBytes$4(...oe),Ze=re;function lt(St){const Mt=Xe(St);if(!c.isValidNot0(Mt))return;const Ft=c.inv(Mt),Zt=r.BASE.multiply(Mt).toAffine(),Ut=c.create(Zt.x);if(Ut===_0n$b)return;const vr=c.create(Ft*c.create(Ze+Ut*B));if(vr===_0n$b)return;let zr=(Zt.x===Ut?0:2)|Number(Zt.y&_1n$b),or=vr;return Q&&Ce(vr)&&(or=c.neg(vr),zr^=1),new ze(Ut,or,zr)}return{seed:Ue,k2sig:lt}}function ht(A,k,Y={}){A=ensureBytes$2("message",A);const{seed:Q,k2sig:$e}=st(A,k,Y);return createHmacDrbg$2(t.outputLen,c.BYTES,o)(Q,$e)}function je(A){let k;const Y=typeof A=="string"||isBytes$3(A),Q=!Y&&A!==null&&typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!Y&&!Q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Q)k=new ze(A.r,A.s);else if(Y){try{k=ze.fromBytes(ensureBytes$2("sig",A),"der")}catch($e){if(!($e instanceof DER$2.Err))throw $e}if(!k)try{k=ze.fromBytes(ensureBytes$2("sig",A),"compact")}catch{return!1}}return k||!1}function se(A,k,Y,Q={}){const{lowS:$e,prehash:ve,format:re}=validateSigOpts$1(Q,te);if(Y=ensureBytes$2("publicKey",Y),k=rt(ensureBytes$2("message",k),ve),"strict"in Q)throw new Error("options.strict was renamed to lowS");const B=re===void 0?je(A):ze.fromBytes(ensureBytes$2("sig",A),re);if(B===!1)return!1;try{const oe=r.fromBytes(Y);if($e&&B.hasHighS())return!1;const{r:Ue,s:Ze}=B,lt=He(k),St=c.inv(Ze),Mt=c.create(lt*St),Ft=c.create(Ue*St),Zt=r.BASE.multiplyUnsafe(Mt).add(oe.multiplyUnsafe(Ft));return Zt.is0()?!1:c.create(Zt.x)===Ue}catch{return!1}}function m(A,k,Y={}){const{prehash:Q}=validateSigOpts$1(Y,te);return k=rt(k,Q),ze.fromBytes(A,"recovered").recoverPublicKey(k).toBytes()}return Object.freeze({keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X,Point:r,sign:ht,verify:se,recoverPublicKey:m,Signature:ze,hash:t})}function _weierstrass_legacy_opts_to_new$1(r){const t={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},n=r.Fp;let s=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(c=>Math.ceil(c/2)))):void 0;const o=Field$2(t.n,{BITS:r.nBitLength,allowedLengths:s,modFromBytes:r.wrapPrivateKey}),a={Fp:n,Fn:o,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:t,curveOpts:a}}function _ecdsa_legacy_opts_to_new$1(r){const{CURVE:t,curveOpts:n}=_weierstrass_legacy_opts_to_new$1(r),s={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:t,curveOpts:n,hash:r.hash,ecdsaOpts:s}}function _ecdsa_new_output_to_legacy$1(r,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},r,nLength$2(n.Fn.ORDER,n.Fn.BITS))})}function weierstrass$2(r){const{CURVE:t,curveOpts:n,hash:s,ecdsaOpts:o}=_ecdsa_legacy_opts_to_new$1(r),a=weierstrassN$1(t,n),c=ecdsa$1(a,s,o);return _ecdsa_new_output_to_legacy$1(r,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve$2(r,t){const n=s=>weierstrass$2({...r,hash:s});return{...n(t),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1_CURVE$1={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO$1={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n$a=BigInt(0),_1n$a=BigInt(1),_2n$6=BigInt(2);function sqrtMod$2(r){const t=secp256k1_CURVE$1.p,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow2$2(_,n,t)*_%t,q=pow2$2(L,n,t)*_%t,X=pow2$2(q,_2n$6,t)*b%t,te=pow2$2(X,o,t)*X%t,ne=pow2$2(te,a,t)*te%t,Ce=pow2$2(ne,f,t)*ne%t,Le=pow2$2(Ce,g,t)*Ce%t,Ge=pow2$2(Le,f,t)*ne%t,ze=pow2$2(Ge,n,t)*_%t,Xe=pow2$2(ze,c,t)*te%t,He=pow2$2(Xe,s,t)*b%t,Ve=pow2$2(He,_2n$6,t);if(!Fpk1$1.eql(Fpk1$1.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}const Fpk1$1=Field$2(secp256k1_CURVE$1.p,{sqrt:sqrtMod$2}),secp256k1$2=createCurve$2({...secp256k1_CURVE$1,Fp:Fpk1$1,lowS:!0,endo:secp256k1_ENDO$1},sha256$5),TAGGED_HASH_PREFIXES$2={};function taggedHash$2(r,...t){let n=TAGGED_HASH_PREFIXES$2[r];if(n===void 0){const s=sha256$5(utf8ToBytes$5(r));n=concatBytes$4(s,s),TAGGED_HASH_PREFIXES$2[r]=n}return sha256$5(concatBytes$4(n,...t))}const pointToBytes$2=r=>r.toBytes(!0).slice(1),Pointk1$1=secp256k1$2.Point,hasEven$1=r=>r%_2n$6===_0n$a;function schnorrGetExtPubKey$2(r){const{Fn:t,BASE:n}=Pointk1$1,s=_normFnElement$1(t,r),o=n.multiply(s);return{scalar:hasEven$1(o.y)?s:t.neg(s),bytes:pointToBytes$2(o)}}function lift_x$2(r){const t=Fpk1$1;if(!t.isValidNot0(r))throw new Error("invalid x: Fail if x  p");const n=t.create(r*r),s=t.create(n*r+BigInt(7));let o=t.sqrt(s);hasEven$1(o)||(o=t.neg(o));const a=Pointk1$1.fromAffine({x:r,y:o});return a.assertValidity(),a}const num$1=bytesToNumberBE$2;function challenge$2(...r){return Pointk1$1.Fn.create(num$1(taggedHash$2("BIP0340/challenge",...r)))}function schnorrGetPublicKey$2(r){return schnorrGetExtPubKey$2(r).bytes}function schnorrSign$2(r,t,n=randomBytes$3(32)){const{Fn:s}=Pointk1$1,o=ensureBytes$2("message",r),{bytes:a,scalar:c}=schnorrGetExtPubKey$2(t),f=ensureBytes$2("auxRand",n,32),g=s.toBytes(c^num$1(taggedHash$2("BIP0340/aux",f))),b=taggedHash$2("BIP0340/nonce",g,a,o),{bytes:_,scalar:L}=schnorrGetExtPubKey$2(b),q=challenge$2(_,a,o),X=new Uint8Array(64);if(X.set(_,0),X.set(s.toBytes(s.create(L+q*c)),32),!schnorrVerify$2(X,o,a))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify$2(r,t,n){const{Fn:s,BASE:o}=Pointk1$1,a=ensureBytes$2("signature",r,64),c=ensureBytes$2("message",t),f=ensureBytes$2("publicKey",n,32);try{const g=lift_x$2(num$1(f)),b=num$1(a.subarray(0,32));if(!inRange$1(b,_1n$a,secp256k1_CURVE$1.p))return!1;const _=num$1(a.subarray(32,64));if(!inRange$1(_,_1n$a,secp256k1_CURVE$1.n))return!1;const L=challenge$2(s.toBytes(b),pointToBytes$2(g),c),q=o.multiplyUnsafe(_).add(g.multiplyUnsafe(s.neg(L))),{x:X,y:te}=q.toAffine();return!(q.is0()||!hasEven$1(te)||X!==b)}catch{return!1}}const schnorr$2=(()=>{const n=(o=randomBytes$3(48))=>mapHashToField$2(o,secp256k1_CURVE$1.n);secp256k1$2.utils.randomSecretKey;function s(o){const a=n(o);return{secretKey:a,publicKey:schnorrGetPublicKey$2(a)}}return{keygen:s,getPublicKey:schnorrGetPublicKey$2,sign:schnorrSign$2,verify:schnorrVerify$2,Point:Pointk1$1,utils:{randomSecretKey:n,randomPrivateKey:n,taggedHash:taggedHash$2,lift_x:lift_x$2,pointToBytes:pointToBytes$2,numberToBytesBE:numberToBytesBE$2,bytesToNumberBE:bytesToNumberBE$2,mod:mod$2},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),sha256$4=sha256$5;var dist$1={},LRUCache$2={},LRUCacheNode$1={},hasRequiredLRUCacheNode$1;function requireLRUCacheNode$1(){if(hasRequiredLRUCacheNode$1)return LRUCacheNode$1;hasRequiredLRUCacheNode$1=1,Object.defineProperty(LRUCacheNode$1,"__esModule",{value:!0}),LRUCacheNode$1.LRUCacheNode=void 0;class r{constructor(n,s,o){const{entryExpirationTimeInMS:a=null,next:c=null,prev:f=null,onEntryEvicted:g,onEntryMarkedAsMostRecentlyUsed:b,clone:_,cloneFn:L}=o??{};if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=_??!1,this.cloneFn=L??this.defaultClone,this.key=n,this.internalValue=this.clone?this.cloneFn(s):s,this.created=Date.now(),this.entryExpirationTimeInMS=a,this.next=c,this.prev=f,this.onEntryEvicted=g,this.onEntryMarkedAsMostRecentlyUsed=b}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:n,value:s,isExpired:o}=this;this.onEntryEvicted({key:n,value:s,isExpired:o})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:n,value:s}=this;this.onEntryMarkedAsMostRecentlyUsed({key:n,value:s})}}defaultClone(n){return typeof n=="boolean"||typeof n=="string"||typeof n=="number"?n:JSON.parse(JSON.stringify(n))}}return LRUCacheNode$1.LRUCacheNode=r,LRUCacheNode$1}var hasRequiredLRUCache$1;function requireLRUCache$1(){if(hasRequiredLRUCache$1)return LRUCache$2;hasRequiredLRUCache$1=1,Object.defineProperty(LRUCache$2,"__esModule",{value:!0}),LRUCache$2.LRUCache=void 0;const r=requireLRUCacheNode$1();class t{constructor(s){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:o=25,entryExpirationTimeInMS:a=null,onEntryEvicted:c,onEntryMarkedAsMostRecentlyUsed:f,cloneFn:g,clone:b}=s??{};if(Number.isNaN(o)||o<=0)throw new Error("maxSize must be greater than 0.");if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=o,this.entryExpirationTimeInMS=a,this.onEntryEvicted=c,this.onEntryMarkedAsMostRecentlyUsed=f,this.clone=b,this.cloneFn=g}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(s){if(Number.isNaN(s)||s<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=s,this.enforceSizeLimit()}set(s,o,a){const c=this.lookupTable.get(s);c&&this.removeNodeFromListAndLookupTable(c);const f=new r.LRUCacheNode(s,o,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...a});return this.setNodeAsHead(f),this.lookupTable.set(s,f),this.enforceSizeLimit(),this}get(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):(this.setNodeAsHead(o),o.value):null}peek(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):o.value:null}delete(s){const o=this.lookupTable.get(s);return o?this.removeNodeFromListAndLookupTable(o):!1}has(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(s){let o=this.head;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}const a=this.mapNodeToEntry(o);if(s(a))return this.setNodeAsHead(o),a;o=o.next}return null}forEach(s){let o=this.head,a=0;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}s(o.value,o.key,a),o=o.next,a++}}*values(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield s.value,s=s.next}}*keys(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield s.key,s=s.next}}*entries(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield this.mapNodeToEntry(s),s=s.next}}*[Symbol.iterator](){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield this.mapNodeToEntry(s),s=s.next}}enforceSizeLimit(){let s=this.tail;for(;s!==null&&this.size>this.maxSizeInternal;){const o=s.prev;this.removeNodeFromListAndLookupTable(s),s=o}}mapNodeToEntry({key:s,value:o}){return{key:s,value:o}}setNodeAsHead(s){this.removeNodeFromList(s),this.head?(s.next=this.head,this.head.prev=s,this.head=s):(this.head=s,this.tail=s),s.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(s){s.prev!==null&&(s.prev.next=s.next),s.next!==null&&(s.next.prev=s.prev),this.head===s&&(this.head=s.next),this.tail===s&&(this.tail=s.prev),s.next=null,s.prev=null}removeNodeFromListAndLookupTable(s){return s.invokeOnEvicted(),this.removeNodeFromList(s),this.lookupTable.delete(s.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const s=[];for(const o of this.lookupTable.values())o.isExpired&&s.push(o);s.forEach(o=>this.removeNodeFromListAndLookupTable(o))}}return LRUCache$2.LRUCache=t,LRUCache$2}var hasRequiredDist$1;function requireDist$1(){return hasRequiredDist$1||(hasRequiredDist$1=1,(function(r){var t=dist$1&&dist$1.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=dist$1&&dist$1.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireLRUCache$1(),r)})(dist$1)),dist$1}var distExports$1=requireDist$1();function pbkdf2Init$1(r,t,n,s){assert$1.hash(r);const o=checkOpts$3({dkLen:32,asyncTick:10},s),{c:a,dkLen:c,asyncTick:f}=o;if(assert$1.number(a),assert$1.number(c),assert$1.number(f),a<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const g=toBytes$6(t),b=toBytes$6(n),_=new Uint8Array(c),L=hmac$4.create(r,g),q=L._cloneInto().update(b);return{c:a,dkLen:c,asyncTick:f,DK:_,PRF:L,PRFSalt:q}}function pbkdf2Output$1(r,t,n,s,o){return r.destroy(),t.destroy(),s&&s.destroy(),o.fill(0),n}function pbkdf2$1(r,t,n,s){const{c:o,dkLen:a,DK:c,PRF:f,PRFSalt:g}=pbkdf2Init$1(r,t,n,s);let b;const _=new Uint8Array(4),L=createView$6(_),q=new Uint8Array(f.outputLen);for(let X=1,te=0;te<a;X++,te+=f.outputLen){const ne=c.subarray(te,te+f.outputLen);L.setInt32(0,X,!1),(b=g._cloneInto(b)).update(_).digestInto(q),ne.set(q.subarray(0,ne.length));for(let Ce=1;Ce<o;Ce++){f._cloneInto(b).update(q).digestInto(q);for(let Le=0;Le<ne.length;Le++)ne[Le]^=q[Le]}}return pbkdf2Output$1(f,g,c,b,q)}const rotl$3=(r,t)=>r<<t|r>>>32-t;function XorAndSalsa$1(r,t,n,s,o,a){let c=r[t++]^n[s++],f=r[t++]^n[s++],g=r[t++]^n[s++],b=r[t++]^n[s++],_=r[t++]^n[s++],L=r[t++]^n[s++],q=r[t++]^n[s++],X=r[t++]^n[s++],te=r[t++]^n[s++],ne=r[t++]^n[s++],Ce=r[t++]^n[s++],Le=r[t++]^n[s++],Ge=r[t++]^n[s++],ze=r[t++]^n[s++],Xe=r[t++]^n[s++],He=r[t++]^n[s++],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let oe=0;oe<8;oe+=2)ht^=rotl$3(Ve+$e|0,7),A^=rotl$3(ht+Ve|0,9),$e^=rotl$3(A+ht|0,13),Ve^=rotl$3($e+A|0,18),k^=rotl$3(je+We|0,7),ve^=rotl$3(k+je|0,9),We^=rotl$3(ve+k|0,13),je^=rotl$3(We+ve|0,18),re^=rotl$3(Y+se|0,7),rt^=rotl$3(re+Y|0,9),se^=rotl$3(rt+re|0,13),Y^=rotl$3(se+rt|0,18),st^=rotl$3(B+Q|0,7),m^=rotl$3(st+B|0,9),Q^=rotl$3(m+st|0,13),B^=rotl$3(Q+m|0,18),We^=rotl$3(Ve+st|0,7),rt^=rotl$3(We+Ve|0,9),st^=rotl$3(rt+We|0,13),Ve^=rotl$3(st+rt|0,18),se^=rotl$3(je+ht|0,7),m^=rotl$3(se+je|0,9),ht^=rotl$3(m+se|0,13),je^=rotl$3(ht+m|0,18),Q^=rotl$3(Y+k|0,7),A^=rotl$3(Q+Y|0,9),k^=rotl$3(A+Q|0,13),Y^=rotl$3(k+A|0,18),$e^=rotl$3(B+re|0,7),ve^=rotl$3($e+B|0,9),re^=rotl$3(ve+$e|0,13),B^=rotl$3(re+ve|0,18);o[a++]=c+Ve|0,o[a++]=f+We|0,o[a++]=g+rt|0,o[a++]=b+st|0,o[a++]=_+ht|0,o[a++]=L+je|0,o[a++]=q+se|0,o[a++]=X+m|0,o[a++]=te+A|0,o[a++]=ne+k|0,o[a++]=Ce+Y|0,o[a++]=Le+Q|0,o[a++]=Ge+$e|0,o[a++]=ze+ve|0,o[a++]=Xe+re|0,o[a++]=He+B|0}function BlockMix$1(r,t,n,s,o){let a=s+0,c=s+16*o;for(let f=0;f<16;f++)n[c+f]=r[t+(2*o-1)*16+f];for(let f=0;f<o;f++,a+=16,t+=16)XorAndSalsa$1(n,c,r,t,n,a),f>0&&(c+=16),XorAndSalsa$1(n,a,r,t+=16,n,c)}function scryptInit$1(r,t,n){const s=checkOpts$3({dkLen:32,asyncTick:10,maxmem:1073742848},n),{N:o,r:a,p:c,dkLen:f,asyncTick:g,maxmem:b,onProgress:_}=s;if(assert$1.number(o),assert$1.number(a),assert$1.number(c),assert$1.number(f),assert$1.number(g),assert$1.number(b),_!==void 0&&typeof _!="function")throw new Error("progressCb should be function");const L=128*a,q=L/4;if(o<=1||(o&o-1)!==0||o>=2**(L/8)||o>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(c<0||c>(2**32-1)*32/L)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(f<0||f>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const X=L*(o+c);if(X>b)throw new Error(`Scrypt: parameters too large, ${X} (128 * r * (N + p)) > ${b} (maxmem)`);const te=pbkdf2$1(sha256$6,r,t,{c:1,dkLen:L*c}),ne=u32$3(te),Ce=u32$3(new Uint8Array(L*o)),Le=u32$3(new Uint8Array(L));let Ge=()=>{};if(_){const ze=2*o*c,Xe=Math.max(Math.floor(ze/1e4),1);let He=0;Ge=()=>{He++,_&&(!(He%Xe)||He===ze)&&_(He/ze)}}return{N:o,r:a,p:c,dkLen:f,blockSize32:q,V:Ce,B32:ne,B:te,tmp:Le,blockMixCb:Ge,asyncTick:g}}function scryptOutput$1(r,t,n,s,o){const a=pbkdf2$1(sha256$6,r,n,{c:1,dkLen:t});return n.fill(0),s.fill(0),o.fill(0),a}function scrypt$1(r,t,n){const{N:s,r:o,p:a,dkLen:c,blockSize32:f,V:g,B32:b,B:_,tmp:L,blockMixCb:q}=scryptInit$1(r,t,n);for(let X=0;X<a;X++){const te=f*X;for(let ne=0;ne<f;ne++)g[ne]=b[te+ne];for(let ne=0,Ce=0;ne<s-1;ne++)BlockMix$1(g,Ce,g,Ce+=f,o),q();BlockMix$1(g,(s-1)*f,b,te,o),q();for(let ne=0;ne<s;ne++){const Ce=b[te+f-16]%s;for(let Le=0;Le<f;Le++)L[Le]=b[te+Le]^g[Ce*f+Le];BlockMix$1(L,0,b,te,o),q()}}return scryptOutput$1(r,c,_,g,L)}var Bech32MaxSize$4=5e3;function encodeBech32$4(r,t){let n=bech32$3.toWords(t);return bech32$3.encode(r,n,Bech32MaxSize$4)}function encodeBytes$4(r,t){return encodeBech32$4(r,t)}function encrypt$5(r,t,n=16,s=2){let o=randomBytes$4(16),a=2**n,c=scrypt$1(t.normalize("NFKC"),o,{N:a,r:8,p:1,dkLen:32}),f=randomBytes$4(24),g=Uint8Array.from([s]),_=xchacha20poly1305$1(c,f,g).encrypt(r),L=concatBytes$5(Uint8Array.from([2]),Uint8Array.from([n]),o,f,g,_);return encodeBytes$4("ncryptsec",L)}function decrypt$5(r,t){let{prefix:n,words:s}=bech32$3.decode(r,Bech32MaxSize$4);if(n!=="ncryptsec")throw new Error(`invalid prefix ${n}, expected 'ncryptsec'`);let o=new Uint8Array(bech32$3.fromWords(s)),a=o[0];if(a!==2)throw new Error(`invalid version ${a}, expected 0x02`);let f=2**o[1],g=o.slice(2,18),b=o.slice(18,42),_=o[42],L=Uint8Array.from([_]),q=o.slice(43),X=scrypt$1(t.normalize("NFKC"),g,{N:f,r:8,p:1,dkLen:32});return xchacha20poly1305$1(X,b,L).decrypt(q)}const nip49_star$1=Object.freeze(Object.defineProperty({__proto__:null,decrypt:decrypt$5,encrypt:encrypt$5},Symbol.toStringTag,{value:"Module"}));var utf8Decoder$2=new TextDecoder("utf-8"),utf8Encoder$2=new TextEncoder,NostrTypeGuard$2={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize$3=5e3,BECH32_REGEX$3=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array$2(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI$2(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode$5(r)}catch{return{type:"invalid",data:null}}}function decode$5(r){let{prefix:t,words:n}=bech32$3.decode(r,Bech32MaxSize$3),s=new Uint8Array(bech32$3.fromWords(n));switch(t){case"nprofile":{let o=parseTLV$2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$5(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$2.decode(a)):[]}}}case"nevent":{let o=parseTLV$2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$5(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$2.decode(a)):[],author:o[2]?.[0]?bytesToHex$5(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex$5(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV$2(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder$2.decode(o[0][0]),pubkey:bytesToHex$5(o[2][0]),kind:parseInt(bytesToHex$5(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder$2.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex$5(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV$2(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode$2(r){return encodeBytes$3("nsec",r)}function npubEncode$2(r){return encodeBytes$3("npub",hexToBytes$5(r))}function noteEncode$2(r){return encodeBytes$3("note",hexToBytes$5(r))}function encodeBech32$3(r,t){let n=bech32$3.toWords(t);return bech32$3.encode(r,n,Bech32MaxSize$3)}function encodeBytes$3(r,t){return encodeBech32$3(r,t)}function nprofileEncode$2(r){let t=encodeTLV$2({0:[hexToBytes$5(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder$2.encode(n))});return encodeBech32$3("nprofile",t)}function neventEncode$2(r){let t;r.kind!==void 0&&(t=integerToUint8Array$2(r.kind));let n=encodeTLV$2({0:[hexToBytes$5(r.id)],1:(r.relays||[]).map(s=>utf8Encoder$2.encode(s)),2:r.author?[hexToBytes$5(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32$3("nevent",n)}function naddrEncode$2(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV$2({0:[utf8Encoder$2.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder$2.encode(s)),2:[hexToBytes$5(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech32$3("naddr",n)}function encodeTLV$2(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes$5(...t)}const nip19_star$1=Object.freeze(Object.defineProperty({__proto__:null,BECH32_REGEX:BECH32_REGEX$3,Bech32MaxSize:Bech32MaxSize$3,NostrTypeGuard:NostrTypeGuard$2,decode:decode$5,decodeNostrURI:decodeNostrURI$2,encodeBytes:encodeBytes$3,naddrEncode:naddrEncode$2,neventEncode:neventEncode$2,noteEncode:noteEncode$2,nprofileEncode:nprofileEncode$2,npubEncode:npubEncode$2,nsecEncode:nsecEncode$2},Symbol.toStringTag,{value:"Module"}));var lib$4={},hasRequiredLib$2;function requireLib$2(){return hasRequiredLib$2||(hasRequiredLib$2=1,(function(r){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.bytes=r.stringToBytes=r.str=r.bytesToString=r.hex=r.utf8=r.bech32m=r.bech32=r.base58check=r.base58xmr=r.base58xrp=r.base58flickr=r.base58=r.base64url=r.base64=r.base32crockford=r.base32hex=r.base32=r.base16=r.utils=r.assertNumber=void 0;function t(je){if(!Number.isSafeInteger(je))throw new Error(`Wrong integer: ${je}`)}r.assertNumber=t;function n(...je){const se=(k,Y)=>Q=>k(Y(Q)),m=Array.from(je).reverse().reduce((k,Y)=>k?se(k,Y.encode):Y.encode,void 0),A=je.reduce((k,Y)=>k?se(k,Y.decode):Y.decode,void 0);return{encode:m,decode:A}}function s(je){return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return se.map(m=>{if(t(m),m<0||m>=je.length)throw new Error(`Digit index outside alphabet: ${m} (alphabet: ${je.length})`);return je[m]})},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("alphabet.decode input should be array of strings");return se.map(m=>{if(typeof m!="string")throw new Error(`alphabet.decode: not string element=${m}`);const A=je.indexOf(m);if(A===-1)throw new Error(`Unknown letter: "${m}". Allowed: ${je}`);return A})}}}function o(je=""){if(typeof je!="string")throw new Error("join separator should be string");return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("join.encode input should be array of strings");for(let m of se)if(typeof m!="string")throw new Error(`join.encode: non-string input=${m}`);return se.join(je)},decode:se=>{if(typeof se!="string")throw new Error("join.decode input should be string");return se.split(je)}}}function a(je,se="="){if(t(je),typeof se!="string")throw new Error("padding chr should be string");return{encode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let A of m)if(typeof A!="string")throw new Error(`padding.encode: non-string input=${A}`);for(;m.length*je%8;)m.push(se);return m},decode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let k of m)if(typeof k!="string")throw new Error(`padding.decode: non-string input=${k}`);let A=m.length;if(A*je%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;A>0&&m[A-1]===se;A--)if(!((A-1)*je%8))throw new Error("Invalid padding: string has too much padding");return m.slice(0,A)}}}function c(je){if(typeof je!="function")throw new Error("normalize fn should be function");return{encode:se=>se,decode:se=>je(se)}}function f(je,se,m){if(se<2)throw new Error(`convertRadix: wrong from=${se}, base cannot be less than 2`);if(m<2)throw new Error(`convertRadix: wrong to=${m}, base cannot be less than 2`);if(!Array.isArray(je))throw new Error("convertRadix: data should be array");if(!je.length)return[];let A=0;const k=[],Y=Array.from(je);for(Y.forEach(Q=>{if(t(Q),Q<0||Q>=se)throw new Error(`Wrong integer: ${Q}`)});;){let Q=0,$e=!0;for(let ve=A;ve<Y.length;ve++){const re=Y[ve],B=se*Q+re;if(!Number.isSafeInteger(B)||se*Q/se!==Q||B-re!==se*Q)throw new Error("convertRadix: carry overflow");if(Q=B%m,Y[ve]=Math.floor(B/m),!Number.isSafeInteger(Y[ve])||Y[ve]*m+Q!==B)throw new Error("convertRadix: carry overflow");if($e)Y[ve]?$e=!1:A=ve;else continue}if(k.push(Q),$e)break}for(let Q=0;Q<je.length-1&&je[Q]===0;Q++)k.push(0);return k.reverse()}const g=(je,se)=>se?g(se,je%se):je,b=(je,se)=>je+(se-g(je,se));function _(je,se,m,A){if(!Array.isArray(je))throw new Error("convertRadix2: data should be array");if(se<=0||se>32)throw new Error(`convertRadix2: wrong from=${se}`);if(m<=0||m>32)throw new Error(`convertRadix2: wrong to=${m}`);if(b(se,m)>32)throw new Error(`convertRadix2: carry overflow from=${se} to=${m} carryBits=${b(se,m)}`);let k=0,Y=0;const Q=2**m-1,$e=[];for(const ve of je){if(t(ve),ve>=2**se)throw new Error(`convertRadix2: invalid data word=${ve} from=${se}`);if(k=k<<se|ve,Y+se>32)throw new Error(`convertRadix2: carry overflow pos=${Y} from=${se}`);for(Y+=se;Y>=m;Y-=m)$e.push((k>>Y-m&Q)>>>0);k&=2**Y-1}if(k=k<<m-Y&Q,!A&&Y>=se)throw new Error("Excess padding");if(!A&&k)throw new Error(`Non-zero padding: ${k}`);return A&&Y>0&&$e.push(k>>>0),$e}function L(je){return t(je),{encode:se=>{if(!(se instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return f(Array.from(se),2**8,je)},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(f(se,je,2**8))}}}function q(je,se=!1){if(t(je),je<=0||je>32)throw new Error("radix2: bits should be in (0..32]");if(b(8,je)>32||b(je,8)>32)throw new Error("radix2: carry overflow");return{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return _(Array.from(m),8,je,!se)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(_(m,je,8,se))}}}function X(je){if(typeof je!="function")throw new Error("unsafeWrapper fn should be function");return function(...se){try{return je.apply(null,se)}catch{}}}function te(je,se){if(t(je),typeof se!="function")throw new Error("checksum fn should be function");return{encode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const A=se(m).slice(0,je),k=new Uint8Array(m.length+je);return k.set(m),k.set(A,m.length),k},decode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const A=m.slice(0,-je),k=se(A).slice(0,je),Y=m.slice(-je);for(let Q=0;Q<je;Q++)if(k[Q]!==Y[Q])throw new Error("Invalid checksum");return A}}}r.utils={alphabet:s,chain:n,checksum:te,radix:L,radix2:q,join:o,padding:a},r.base16=n(q(4),s("0123456789ABCDEF"),o("")),r.base32=n(q(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),o("")),r.base32hex=n(q(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),o("")),r.base32crockford=n(q(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),c(je=>je.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),r.base64=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),o("")),r.base64url=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),o(""));const ne=je=>n(L(58),s(je),o(""));r.base58=ne("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),r.base58flickr=ne("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),r.base58xrp=ne("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ce=[0,2,3,5,6,7,9,10,11];r.base58xmr={encode(je){let se="";for(let m=0;m<je.length;m+=8){const A=je.subarray(m,m+8);se+=r.base58.encode(A).padStart(Ce[A.length],"1")}return se},decode(je){let se=[];for(let m=0;m<je.length;m+=11){const A=je.slice(m,m+11),k=Ce.indexOf(A.length),Y=r.base58.decode(A);for(let Q=0;Q<Y.length-k;Q++)if(Y[Q]!==0)throw new Error("base58xmr: wrong padding");se=se.concat(Array.from(Y.slice(Y.length-k)))}return Uint8Array.from(se)}};const Le=je=>n(te(4,se=>je(je(se))),r.base58);r.base58check=Le;const Ge=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),ze=[996825010,642813549,513874426,1027748829,705979059];function Xe(je){const se=je>>25;let m=(je&33554431)<<5;for(let A=0;A<ze.length;A++)(se>>A&1)===1&&(m^=ze[A]);return m}function He(je,se,m=1){const A=je.length;let k=1;for(let Y=0;Y<A;Y++){const Q=je.charCodeAt(Y);if(Q<33||Q>126)throw new Error(`Invalid prefix (${je})`);k=Xe(k)^Q>>5}k=Xe(k);for(let Y=0;Y<A;Y++)k=Xe(k)^je.charCodeAt(Y)&31;for(let Y of se)k=Xe(k)^Y;for(let Y=0;Y<6;Y++)k=Xe(k);return k^=m,Ge.encode(_([k%2**30],30,5,!1))}function Ve(je){const se=je==="bech32"?1:734539939,m=q(5),A=m.decode,k=m.encode,Y=X(A);function Q(B,oe,Ue=90){if(typeof B!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof B}`);if(!Array.isArray(oe)||oe.length&&typeof oe[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof oe}`);const Ze=B.length+7+oe.length;if(Ue!==!1&&Ze>Ue)throw new TypeError(`Length ${Ze} exceeds limit ${Ue}`);return B=B.toLowerCase(),`${B}1${Ge.encode(oe)}${He(B,oe,se)}`}function $e(B,oe=90){if(typeof B!="string")throw new Error(`bech32.decode input should be string, not ${typeof B}`);if(B.length<8||oe!==!1&&B.length>oe)throw new TypeError(`Wrong string length: ${B.length} (${B}). Expected (8..${oe})`);const Ue=B.toLowerCase();if(B!==Ue&&B!==B.toUpperCase())throw new Error("String must be lowercase or uppercase");B=Ue;const Ze=B.lastIndexOf("1");if(Ze===0||Ze===-1)throw new Error('Letter "1" must be present between prefix and data only');const lt=B.slice(0,Ze),St=B.slice(Ze+1);if(St.length<6)throw new Error("Data must be at least 6 characters long");const Mt=Ge.decode(St).slice(0,-6),Ft=He(lt,Mt,se);if(!St.endsWith(Ft))throw new Error(`Invalid checksum in ${B}: expected "${Ft}"`);return{prefix:lt,words:Mt}}const ve=X($e);function re(B){const{prefix:oe,words:Ue}=$e(B,!1);return{prefix:oe,words:Ue,bytes:A(Ue)}}return{encode:Q,decode:$e,decodeToBytes:re,decodeUnsafe:ve,fromWords:A,fromWordsUnsafe:Y,toWords:k}}r.bech32=Ve("bech32"),r.bech32m=Ve("bech32m"),r.utf8={encode:je=>new TextDecoder().decode(je),decode:je=>new TextEncoder().encode(je)},r.hex=n(q(4),s("0123456789abcdef"),o(""),c(je=>{if(typeof je!="string"||je.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof je} with length ${je.length}`);return je.toLowerCase()}));const We={utf8:r.utf8,hex:r.hex,base16:r.base16,base32:r.base32,base64:r.base64,base64url:r.base64url,base58:r.base58,base58xmr:r.base58xmr},rt=`Invalid encoding type. Available types: ${Object.keys(We).join(", ")}`,st=(je,se)=>{if(typeof je!="string"||!We.hasOwnProperty(je))throw new TypeError(rt);if(!(se instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return We[je].encode(se)};r.bytesToString=st,r.str=r.bytesToString;const ht=(je,se)=>{if(!We.hasOwnProperty(je))throw new TypeError(rt);if(typeof se!="string")throw new TypeError("stringToBytes() expects string");return We[je].decode(se)};r.stringToBytes=ht,r.bytes=r.stringToBytes})(lib$4)),lib$4}var bolt11$2,hasRequiredBolt11$1;function requireBolt11$1(){if(hasRequiredBolt11$1)return bolt11$2;hasRequiredBolt11$1=1;const{bech32:r,hex:t,utf8:n}=requireLib$2(),s={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},o={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},a={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},f={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},g=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],b={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},_=BigInt("2100000000000000000"),L=BigInt(1e11),q={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},X={};for(let He=0,Ve=Object.keys(q);He<Ve.length;He++){const We=Ve[He],rt=q[Ve[He]].toString();X[rt]=We}const te={1:He=>t.encode(r.fromWordsUnsafe(He)),16:He=>t.encode(r.fromWordsUnsafe(He)),13:He=>n.encode(r.fromWordsUnsafe(He)),19:He=>t.encode(r.fromWordsUnsafe(He)),23:He=>t.encode(r.fromWordsUnsafe(He)),27:He=>t.encode(r.fromWordsUnsafe(He)),6:Ce,24:Ce,3:Le,5:Ge};function ne(He){return Ve=>({tagCode:parseInt(He),words:r.encode("unknown",Ve,Number.MAX_SAFE_INTEGER)})}function Ce(He){return He.reverse().reduce((Ve,We,rt)=>Ve+We*Math.pow(32,rt),0)}function Le(He){const Ve=[];let We,rt,st,ht,je,se=r.fromWordsUnsafe(He);for(;se.length>0;)We=t.encode(se.slice(0,33)),rt=t.encode(se.slice(33,41)),st=parseInt(t.encode(se.slice(41,45)),16),ht=parseInt(t.encode(se.slice(45,49)),16),je=parseInt(t.encode(se.slice(49,51)),16),se=se.slice(51),Ve.push({pubkey:We,short_channel_id:rt,fee_base_msat:st,fee_proportional_millionths:ht,cltv_expiry_delta:je});return Ve}function Ge(He){const Ve=He.slice().reverse().map(st=>[!!(st&1),!!(st&2),!!(st&4),!!(st&8),!!(st&16)]).reduce((st,ht)=>st.concat(ht),[]);for(;Ve.length<g.length*2;)Ve.push(!1);const We={};g.forEach((st,ht)=>{let je;Ve[ht*2]?je="required":Ve[ht*2+1]?je="supported":je="unsupported",We[st]=je});const rt=Ve.slice(g.length*2);return We.extra_bits={start_bit:g.length*2,bits:rt,has_required:rt.reduce((st,ht,je)=>je%2!==0?st||!1:st||ht,!1)},We}function ze(He,Ve){let We,rt;if(He.slice(-1).match(/^[munp]$/))We=He.slice(-1),rt=He.slice(0,-1);else{if(He.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");rt=He}if(!rt.match(/^\d+$/))throw new Error("Not a valid human readable amount");const st=BigInt(rt),ht=We?st*L/b[We]:st*L;if(We==="p"&&st%BigInt(10)!==BigInt(0)||ht>_)throw new Error("Amount is outside of valid range");return Ve?ht.toString():ht}function Xe(He,Ve){if(typeof He!="string")throw new Error("Lightning Payment Request must be string");if(He.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const We=[],rt=r.decode(He,Number.MAX_SAFE_INTEGER);He=He.toLowerCase();const st=rt.prefix;let ht=rt.words,je=He.slice(st.length+1),se=ht.slice(-104);ht=ht.slice(0,-104);let m=st.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(m&&!m[2]&&(m=st.match(/^ln(\S+)$/)),!m)throw new Error("Not a proper lightning payment request");We.push({name:"lightning_network",letters:"ln"});const A=m[1];let k;if(Ve){if(Ve.bech32===void 0||Ve.pubKeyHash===void 0||Ve.scriptHash===void 0||!Array.isArray(Ve.validWitnessVersions))throw new Error("Invalid network");k=Ve}else switch(A){case s.bech32:k=s;break;case o.bech32:k=o;break;case a.bech32:k=a;break;case c.bech32:k=c;break;case f.bech32:k=f;break}if(!k||k.bech32!==A)throw new Error("Unknown coin bech32 prefix");We.push({name:"coin_network",letters:A,value:k});const Y=m[2];let Q;if(Y){const lt=m[3];Q=ze(Y+lt,!0),We.push({name:"amount",letters:m[2]+m[3],value:Q})}else Q=null;We.push({name:"separator",letters:"1"});const $e=Ce(ht.slice(0,7));ht=ht.slice(7),We.push({name:"timestamp",letters:je.slice(0,7),value:$e}),je=je.slice(7);let ve,re,B,oe;for(;ht.length>0;){const lt=ht[0].toString();ve=X[lt]||"unknown_tag",re=te[lt]||ne(lt),ht=ht.slice(1),B=Ce(ht.slice(0,2)),ht=ht.slice(2),oe=ht.slice(0,B),ht=ht.slice(B),We.push({name:ve,tag:je[0],letters:je.slice(0,3+B),value:re(oe)}),je=je.slice(3+B)}We.push({name:"signature",letters:je.slice(0,104),value:t.encode(r.fromWordsUnsafe(se))}),je=je.slice(104),We.push({name:"checksum",letters:je});let Ue={paymentRequest:He,sections:We,get expiry(){let lt=We.find(St=>St.name==="expiry");if(lt)return Ze("timestamp")+lt.value},get route_hints(){return We.filter(lt=>lt.name==="route_hint").map(lt=>lt.value)}};for(let lt in q)lt!=="route_hint"&&Object.defineProperty(Ue,lt,{get(){return Ze(lt)}});return Ue;function Ze(lt){let St=We.find(Mt=>Mt.name===lt);return St?St.value:void 0}}return bolt11$2={decode:Xe,hrpToMillisat:ze},bolt11$2}var bolt11Exports$1=requireBolt11$1();/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$2(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function isArrayOf(r,t){return Array.isArray(t)?t.length===0?!0:r?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function afn(r){if(typeof r!="function")throw new Error("function expected");return!0}function astr(r,t){if(typeof t!="string")throw new Error(`${r}: string expected`);return!0}function anumber$1(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function aArr(r){if(!Array.isArray(r))throw new Error("array expected")}function astrArr(r,t){if(!isArrayOf(!0,t))throw new Error(`${r}: array of strings expected`)}function anumArr(r,t){if(!isArrayOf(!1,t))throw new Error(`${r}: array of numbers expected`)}function chain$1(...r){const t=a=>a,n=(a,c)=>f=>a(c(f)),s=r.map(a=>a.encode).reduceRight(n,t),o=r.map(a=>a.decode).reduce(n,t);return{encode:s,decode:o}}function alphabet$1(r){const t=typeof r=="string"?r.split(""):r,n=t.length;astrArr("alphabet",t);const s=new Map(t.map((o,a)=>[o,a]));return{encode:o=>(aArr(o),o.map(a=>{if(!Number.isSafeInteger(a)||a<0||a>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${a}". Allowed: ${r}`);return t[a]})),decode:o=>(aArr(o),o.map(a=>{astr("alphabet.decode",a);const c=s.get(a);if(c===void 0)throw new Error(`Unknown letter: "${a}". Allowed: ${r}`);return c}))}}function join$2(r=""){return astr("join",r),{encode:t=>(astrArr("join.decode",t),t.join(r)),decode:t=>(astr("join.decode",t),t.split(r))}}function convertRadix$1(r,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(aArr(r),!r.length)return[];let s=0;const o=[],a=Array.from(r,f=>{if(anumber$1(f),f<0||f>=t)throw new Error(`invalid integer: ${f}`);return f}),c=a.length;for(;;){let f=0,g=!0;for(let b=s;b<c;b++){const _=a[b],L=t*f,q=L+_;if(!Number.isSafeInteger(q)||L/t!==f||q-_!==L)throw new Error("convertRadix: carry overflow");const X=q/n;f=q%n;const te=Math.floor(X);if(a[b]=te,!Number.isSafeInteger(te)||te*n+f!==q)throw new Error("convertRadix: carry overflow");if(g)te?g=!1:s=b;else continue}if(o.push(f),g)break}for(let f=0;f<r.length-1&&r[f]===0;f++)o.push(0);return o.reverse()}const gcd$1=(r,t)=>t===0?r:gcd$1(t,r%t),radix2carry$1=(r,t)=>r+(t-gcd$1(r,t)),powers=(()=>{let r=[];for(let t=0;t<40;t++)r.push(2**t);return r})();function convertRadix2$1(r,t,n,s){if(aArr(r),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry$1(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${radix2carry$1(t,n)}`);let o=0,a=0;const c=powers[t],f=powers[n]-1,g=[];for(const b of r){if(anumber$1(b),b>=c)throw new Error(`convertRadix2: invalid data word=${b} from=${t}`);if(o=o<<t|b,a+t>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${t}`);for(a+=t;a>=n;a-=n)g.push((o>>a-n&f)>>>0);const _=powers[a];if(_===void 0)throw new Error("invalid carry");o&=_-1}if(o=o<<n-a&f,!s&&a>=t)throw new Error("Excess padding");if(!s&&o>0)throw new Error(`Non-zero padding: ${o}`);return s&&a>0&&g.push(o>>>0),g}function radix$1(r){anumber$1(r);const t=2**8;return{encode:n=>{if(!isBytes$2(n))throw new Error("radix.encode input should be Uint8Array");return convertRadix$1(Array.from(n),t,r)},decode:n=>(anumArr("radix.decode",n),Uint8Array.from(convertRadix$1(n,r,t)))}}function radix2$1(r,t=!1){if(anumber$1(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$1(8,r)>32||radix2carry$1(r,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!isBytes$2(n))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$1(Array.from(n),8,r,!t)},decode:n=>(anumArr("radix2.decode",n),Uint8Array.from(convertRadix2$1(n,r,8,t)))}}function unsafeWrapper$1(r){return afn(r),function(...t){try{return r.apply(null,t)}catch{}}}function checksum(r,t){return anumber$1(r),afn(t),{encode(n){if(!isBytes$2(n))throw new Error("checksum.encode: input should be Uint8Array");const s=t(n).slice(0,r),o=new Uint8Array(n.length+r);return o.set(n),o.set(s,n.length),o},decode(n){if(!isBytes$2(n))throw new Error("checksum.decode: input should be Uint8Array");const s=n.slice(0,-r),o=n.slice(-r),a=t(s).slice(0,r);for(let c=0;c<r;c++)if(a[c]!==o[c])throw new Error("Invalid checksum");return s}}}const genBase58$1=r=>chain$1(radix$1(58),alphabet$1(r),join$2("")),base58$1=genBase58$1("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),createBase58check=r=>chain$1(checksum(4,t=>r(r(t))),base58$1),BECH_ALPHABET$1=chain$1(alphabet$1("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$2("")),POLYMOD_GENERATORS$1=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod$1(r){const t=r>>25;let n=(r&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS$1.length;s++)(t>>s&1)===1&&(n^=POLYMOD_GENERATORS$1[s]);return n}function bechChecksum$1(r,t,n=1){const s=r.length;let o=1;for(let a=0;a<s;a++){const c=r.charCodeAt(a);if(c<33||c>126)throw new Error(`Invalid prefix (${r})`);o=bech32Polymod$1(o)^c>>5}o=bech32Polymod$1(o);for(let a=0;a<s;a++)o=bech32Polymod$1(o)^r.charCodeAt(a)&31;for(let a of t)o=bech32Polymod$1(o)^a;for(let a=0;a<6;a++)o=bech32Polymod$1(o);return o^=n,BECH_ALPHABET$1.encode(convertRadix2$1([o%powers[30]],30,5,!1))}function genBech32$1(r){const t=r==="bech32"?1:734539939,n=radix2$1(5),s=n.decode,o=n.encode,a=unsafeWrapper$1(s);function c(L,q,X=90){astr("bech32.encode prefix",L),isBytes$2(q)&&(q=Array.from(q)),anumArr("bech32.encode",q);const te=L.length;if(te===0)throw new TypeError(`Invalid prefix length ${te}`);const ne=te+7+q.length;if(X!==!1&&ne>X)throw new TypeError(`Length ${ne} exceeds limit ${X}`);const Ce=L.toLowerCase(),Le=bechChecksum$1(Ce,q,t);return`${Ce}1${BECH_ALPHABET$1.encode(q)}${Le}`}function f(L,q=90){astr("bech32.decode input",L);const X=L.length;if(X<8||q!==!1&&X>q)throw new TypeError(`invalid string length: ${X} (${L}). Expected (8..${q})`);const te=L.toLowerCase();if(L!==te&&L!==L.toUpperCase())throw new Error("String must be lowercase or uppercase");const ne=te.lastIndexOf("1");if(ne===0||ne===-1)throw new Error('Letter "1" must be present between prefix and data only');const Ce=te.slice(0,ne),Le=te.slice(ne+1);if(Le.length<6)throw new Error("Data must be at least 6 characters long");const Ge=BECH_ALPHABET$1.decode(Le).slice(0,-6),ze=bechChecksum$1(Ce,Ge,t);if(!Le.endsWith(ze))throw new Error(`Invalid checksum in ${L}: expected "${ze}"`);return{prefix:Ce,words:Ge}}const g=unsafeWrapper$1(f);function b(L){const{prefix:q,words:X}=f(L,!1);return{prefix:q,words:X,bytes:s(X)}}function _(L,q){return c(L,o(q))}return{encode:c,decode:f,encodeFromBytes:_,decodeToBytes:b,decodeUnsafe:g,fromWords:s,fromWordsUnsafe:a,toWords:o}}const bech32$2=genBech32$1("bech32");var __defProp$2=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__getOwnPropNames$1=Object.getOwnPropertyNames,__hasOwnProp$1=Object.prototype.hasOwnProperty,__copyProps$1=(r,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of __getOwnPropNames$1(t))!__hasOwnProp$1.call(r,o)&&o!==n&&__defProp$2(r,o,{get:()=>t[o],enumerable:!(s=__getOwnPropDesc$1(t,o))||s.enumerable});return r},__reExport$1=(r,t,n)=>(__copyProps$1(r,t,"default"),n),NDKKind$1=(r=>(r[r.Metadata=0]="Metadata",r[r.Text=1]="Text",r[r.RecommendRelay=2]="RecommendRelay",r[r.Contacts=3]="Contacts",r[r.EncryptedDirectMessage=4]="EncryptedDirectMessage",r[r.EventDeletion=5]="EventDeletion",r[r.Repost=6]="Repost",r[r.Reaction=7]="Reaction",r[r.BadgeAward=8]="BadgeAward",r[r.GroupChat=9]="GroupChat",r[r.Thread=11]="Thread",r[r.GroupReply=12]="GroupReply",r[r.GiftWrapSeal=13]="GiftWrapSeal",r[r.PrivateDirectMessage=14]="PrivateDirectMessage",r[r.Image=20]="Image",r[r.Video=21]="Video",r[r.ShortVideo=22]="ShortVideo",r[r.Story=23]="Story",r[r.Vanish=62]="Vanish",r[r.CashuWalletBackup=375]="CashuWalletBackup",r[r.GiftWrap=1059]="GiftWrap",r[r.GenericRepost=16]="GenericRepost",r[r.ChannelCreation=40]="ChannelCreation",r[r.ChannelMetadata=41]="ChannelMetadata",r[r.ChannelMessage=42]="ChannelMessage",r[r.ChannelHideMessage=43]="ChannelHideMessage",r[r.ChannelMuteUser=44]="ChannelMuteUser",r[r.WikiMergeRequest=818]="WikiMergeRequest",r[r.GenericReply=1111]="GenericReply",r[r.Media=1063]="Media",r[r.DraftCheckpoint=1234]="DraftCheckpoint",r[r.Task=1934]="Task",r[r.Report=1984]="Report",r[r.Label=1985]="Label",r[r.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",r[r.DVMReqTextSummarization=5001]="DVMReqTextSummarization",r[r.DVMReqTextTranslation=5002]="DVMReqTextTranslation",r[r.DVMReqTextGeneration=5050]="DVMReqTextGeneration",r[r.DVMReqImageGeneration=5100]="DVMReqImageGeneration",r[r.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",r[r.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",r[r.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",r[r.DVMReqTimestamping=5900]="DVMReqTimestamping",r[r.DVMEventSchedule=5905]="DVMEventSchedule",r[r.DVMJobFeedback=7e3]="DVMJobFeedback",r[r.Subscribe=7001]="Subscribe",r[r.Unsubscribe=7002]="Unsubscribe",r[r.SubscriptionReceipt=7003]="SubscriptionReceipt",r[r.CashuReserve=7373]="CashuReserve",r[r.CashuQuote=7374]="CashuQuote",r[r.CashuToken=7375]="CashuToken",r[r.CashuWalletTx=7376]="CashuWalletTx",r[r.GroupAdminAddUser=9e3]="GroupAdminAddUser",r[r.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",r[r.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",r[r.GroupAdminEditStatus=9006]="GroupAdminEditStatus",r[r.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",r[r.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",r[r.MuteList=1e4]="MuteList",r[r.PinList=10001]="PinList",r[r.RelayList=10002]="RelayList",r[r.BookmarkList=10003]="BookmarkList",r[r.CommunityList=10004]="CommunityList",r[r.PublicChatList=10005]="PublicChatList",r[r.BlockRelayList=10006]="BlockRelayList",r[r.SearchRelayList=10007]="SearchRelayList",r[r.SimpleGroupList=10009]="SimpleGroupList",r[r.InterestList=10015]="InterestList",r[r.CashuMintList=10019]="CashuMintList",r[r.EmojiList=10030]="EmojiList",r[r.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",r[r.BlossomList=10063]="BlossomList",r[r.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",r[r.TierList=17e3]="TierList",r[r.CashuWallet=17375]="CashuWallet",r[r.FollowSet=3e4]="FollowSet",r[r.CategorizedPeopleList=3e4]="CategorizedPeopleList",r[r.CategorizedBookmarkList=30001]="CategorizedBookmarkList",r[r.RelaySet=30002]="RelaySet",r[r.CategorizedRelayList=30002]="CategorizedRelayList",r[r.BookmarkSet=30003]="BookmarkSet",r[r.CurationSet=30004]="CurationSet",r[r.ArticleCurationSet=30004]="ArticleCurationSet",r[r.VideoCurationSet=30005]="VideoCurationSet",r[r.ImageCurationSet=30006]="ImageCurationSet",r[r.InterestSet=30015]="InterestSet",r[r.InterestsList=30015]="InterestsList",r[r.ProjectTemplate=30717]="ProjectTemplate",r[r.EmojiSet=30030]="EmojiSet",r[r.ModularArticle=30040]="ModularArticle",r[r.ModularArticleItem=30041]="ModularArticleItem",r[r.Wiki=30818]="Wiki",r[r.Draft=31234]="Draft",r[r.Project=31933]="Project",r[r.SubscriptionTier=37001]="SubscriptionTier",r[r.EcashMintRecommendation=38e3]="EcashMintRecommendation",r[r.CashuMintAnnouncement=38172]="CashuMintAnnouncement",r[r.FedimintMintAnnouncement=38173]="FedimintMintAnnouncement",r[r.HighlightSet=39802]="HighlightSet",r[r.CategorizedHighlightList=39802]="CategorizedHighlightList",r[r.Nutzap=9321]="Nutzap",r[r.ZapRequest=9734]="ZapRequest",r[r.Zap=9735]="Zap",r[r.Highlight=9802]="Highlight",r[r.ClientAuth=22242]="ClientAuth",r[r.NostrWalletConnectReq=23194]="NostrWalletConnectReq",r[r.NostrWalletConnectRes=23195]="NostrWalletConnectRes",r[r.NostrConnect=24133]="NostrConnect",r[r.BlossomUpload=24242]="BlossomUpload",r[r.HttpAuth=27235]="HttpAuth",r[r.ProfileBadge=30008]="ProfileBadge",r[r.BadgeDefinition=30009]="BadgeDefinition",r[r.MarketStall=30017]="MarketStall",r[r.MarketProduct=30018]="MarketProduct",r[r.Article=30023]="Article",r[r.AppSpecificData=30078]="AppSpecificData",r[r.Classified=30402]="Classified",r[r.HorizontalVideo=34235]="HorizontalVideo",r[r.VerticalVideo=34236]="VerticalVideo",r[r.GroupMetadata=39e3]="GroupMetadata",r[r.GroupAdmins=39001]="GroupAdmins",r[r.GroupMembers=39002]="GroupMembers",r[r.FollowPack=39089]="FollowPack",r[r.MediaFollowPack=39092]="MediaFollowPack",r[r.AppRecommendation=31989]="AppRecommendation",r[r.AppHandler=31990]="AppHandler",r))(NDKKind$1||{}),NdkNutzapStatus=(r=>(r.INITIAL="initial",r.PROCESSING="processing",r.REDEEMED="redeemed",r.SPENT="spent",r.MISSING_PRIVKEY="missing_privkey",r.TEMPORARY_ERROR="temporary_error",r.PERMANENT_ERROR="permanent_error",r.INVALID_NUTZAP="invalid_nutzap",r))(NdkNutzapStatus||{});function getRelaysForSync$1(r,t,n="write"){if(!r.outboxTracker)return;const s=r.outboxTracker.data.get(t);if(s)return n==="write"?s.writeRelays:s.readRelays}async function getWriteRelaysFor$1(r,t,n="write"){if(r.outboxTracker)return r.outboxTracker.data.has(t)||await r.outboxTracker.trackUsers([t]),getRelaysForSync$1(r,t,n)}function getTopRelaysForAuthors$1(r,t){const n=new Map;return t.forEach(o=>{const a=getRelaysForSync$1(r,o);a&&a.forEach(c=>{const f=n.get(c)||0;n.set(c,f+1)})}),Array.from(n.entries()).sort((o,a)=>a[1]-o[1]).map(o=>o[0])}function getAllRelaysForAllPubkeys$1(r,t,n="read"){const s=new Map,o=new Set;return t.forEach(a=>{const c=getRelaysForSync$1(r,a,n);c&&c.size>0?(c.forEach(f=>{(s.get(f)||new Set).add(a)}),s.set(a,c)):o.add(a)}),{pubkeysToRelays:s,authorsMissingRelays:o}}function chooseRelayCombinationForPubkeys$1(r,t,n,{count:s,preferredRelays:o}={}){s??=2,o??=new Set;const a=r.pool,c=a.connectedRelays();c.forEach(q=>{o?.add(q.url)});const f=new Map,{pubkeysToRelays:g,authorsMissingRelays:b}=getAllRelaysForAllPubkeys$1(r,t,n),_=getTopRelaysForAuthors$1(r,t),L=(q,X)=>{const te=f.get(X)||[];te.push(q),f.set(X,te)};for(const[q,X]of g.entries()){let te=s;const ne=new Set;for(const Ce of c)X.has(Ce.url)&&(L(q,Ce.url),ne.add(Ce.url),te--);for(const Ce of X)ne.has(Ce)||f.has(Ce)&&(L(q,Ce),ne.add(Ce),te--);if(!(te<=0))for(const Ce of _){if(te<=0)break;ne.has(Ce)||X.has(Ce)&&(L(q,Ce),ne.add(Ce),te--)}}for(const q of b)a.permanentAndConnectedRelays().forEach(X=>{const te=f.get(X.url)||[];te.push(q),f.set(X.url,te)});return f}function getRelaysForFilterWithAuthors(r,t,n=2){return chooseRelayCombinationForPubkeys$1(r,t,"write",{count:n})}function tryNormalizeRelayUrl$1(r){try{return normalizeRelayUrl$1(r)}catch{return}}function normalizeRelayUrl$1(r){let t=normalizeUrl$1(r,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function normalize$3(r){const t=new Set;for(const n of r)try{t.add(normalizeRelayUrl$1(n))}catch{}return Array.from(t)}var DATA_URL_DEFAULT_MIME_TYPE$1="text/plain",DATA_URL_DEFAULT_CHARSET$1="us-ascii",testParameter$1=(r,t)=>t.some(n=>n instanceof RegExp?n.test(r):n===r),supportedProtocols$1=new Set(["https:","http:","file:"]),hasCustomProtocol$1=r=>{try{const{protocol:t}=new URL(r);return t.endsWith(":")&&!t.includes(".")&&!supportedProtocols$1.has(t)}catch{return!1}},normalizeDataURL$1=(r,{stripHash:t})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(r);if(!n)throw new Error(`Invalid URL: ${r}`);const s=n.groups?.type??"",o=n.groups?.data??"";let a=n.groups?.hash??"";const c=s.split(";");a=t?"":a;let f=!1;c[c.length-1]==="base64"&&(c.pop(),f=!0);const g=c.shift()?.toLowerCase()??"",_=[...c.map(L=>{let[q,X=""]=L.split("=").map(te=>te.trim());return q==="charset"&&(X=X.toLowerCase(),X===DATA_URL_DEFAULT_CHARSET$1)?"":`${q}${X?`=${X}`:""}`}).filter(Boolean)];return f&&_.push("base64"),(_.length>0||g&&g!==DATA_URL_DEFAULT_MIME_TYPE$1)&&_.unshift(g),`data:${_.join(";")},${f?o.trim():o}${a?`#${a}`:""}`};function normalizeUrl$1(r,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),r=r.trim(),/^data:/i.test(r))return normalizeDataURL$1(r,t);if(hasCustomProtocol$1(r))return r;const n=r.startsWith("//");!n&&/^\.*\//.test(r)||(r=r.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const o=new URL(r);if(o.hostname=o.hostname.toLowerCase(),t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&o.protocol==="https:"&&(o.protocol="http:"),t.forceHttps&&o.protocol==="http:"&&(o.protocol="https:"),t.stripAuthentication&&(o.username="",o.password=""),t.stripHash?o.hash="":t.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname){const c=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let f=0,g="";for(;;){const _=c.exec(o.pathname);if(!_)break;const L=_[0],q=_.index,X=o.pathname.slice(f,q);g+=X.replace(/\/{2,}/g,"/"),g+=L,f=q+L.length}const b=o.pathname.slice(f,o.pathname.length);g+=b.replace(/\/{2,}/g,"/"),o.pathname=g}if(o.pathname)try{o.pathname=decodeURI(o.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let c=o.pathname.split("/");const f=c[c.length-1];testParameter$1(f,t.removeDirectoryIndex)&&(c=c.slice(0,-1),o.pathname=`${c.slice(1).join("/")}/`)}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const c of[...o.searchParams.keys()])testParameter$1(c,t.removeQueryParameters)&&o.searchParams.delete(c);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(o.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const c of[...o.searchParams.keys()])testParameter$1(c,t.keepQueryParameters)||o.searchParams.delete(c);if(t.sortQueryParameters){o.searchParams.sort();try{o.search=decodeURIComponent(o.search)}catch{}}t.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,"")),t.removeExplicitPort&&o.port&&(o.port="");const a=r;return r=o.toString(),!t.removeSingleSlash&&o.pathname==="/"&&!a.endsWith("/")&&o.hash===""&&(r=r.replace(/\/$/,"")),(t.removeTrailingSlash||o.pathname==="/")&&o.hash===""&&t.removeSingleSlash&&(r=r.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(r=r.replace(/^http:\/\//,"//")),t.stripProtocol&&(r=r.replace(/^(?:https?:)?\/\//,"")),r}var NDKRelayKeepalive$1=class{constructor(t=3e4,n){this.onSilenceDetected=n,this.timeout=t}lastActivity=Date.now();timer;timeout;isRunning=!1;recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const t=Date.now()-this.lastActivity;if(t>=this.timeout)this.onSilenceDetected();else{const n=this.timeout-t;this.timer=setTimeout(()=>{this.onSilenceDetected()},n)}},this.timeout)}};async function probeRelayConnection$1(r){const t=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(n=>{let s=!1;const o=setTimeout(()=>{s||(s=!0,r.send(["CLOSE",t]),n(!1))},5e3),a=()=>{s||(s=!0,clearTimeout(o),r.send(["CLOSE",t]),n(!0))};r.once("message",a),r.send(["REQ",t,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS$1=5,FLAPPING_THRESHOLD_MS$1=1e3,NDKRelayConnectivity$1=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;pendingAuthPublishes=new Map;serial=0;baseEoseTimeout=4400;keepalive;wsStateMonitor;sleepDetector;lastSleepCheck=Date.now();lastMessageSent=Date.now();wasIdle=!1;constructor(t,n){this.ndkRelay=t,this._status=1;const s=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${s}`),this.ndk=n,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive$1(12e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection$1({send:n=>this.send(JSON.stringify(n)),once:(n,s)=>{const o=a=>{try{const c=JSON.parse(a.data);(c[0]==="EOSE"||c[0]==="EVENT"||c[0]==="NOTICE")&&(s(),this.ws?.removeEventListener("message",o))}catch{}};this.ws?.addEventListener("message",o)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const t=Date.now(),n=t-this.lastSleepCheck;n>15e3&&(this.debug(`Detected possible sleep/wake (${n}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=t},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection$1({send:t=>this.send(JSON.stringify(t)),once:(t,n)=>{const s=o=>{try{const a=JSON.parse(o.data);(a[0]==="EOSE"||a[0]==="EVENT"||a[0]==="NOTICE")&&(n(),this.ws?.removeEventListener("message",s))}catch{}};this.ws?.addEventListener("message",s)}}).then(t=>{t||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(t,n=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(n),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(s){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,s),this._status=1,n?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2880*60*1e3),s}}disconnect(){this._status=0,this.keepalive?.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.keepalive?.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this.keepalive?.stop(),this.clearPendingPublishes(new Error(`Relay ${this.ndkRelay.url} disconnected`)),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(t){this.netDebug?.(t.data,this.ndkRelay,"recv"),this.keepalive?.recordActivity();try{const n=JSON.parse(t.data),[s,o,...a]=n,c=this.ndkRelay.getProtocolHandler(s);if(c){c(this.ndkRelay,n);return}switch(s){case"EVENT":{const f=this.openSubs.get(o),g=n[2];if(!f){this.debug(`Received event for unknown subscription ${o}`);return}f.onevent(g);return}case"COUNT":{const f=n[2],g=this.openCountRequests.get(o);g&&(g.resolve(f.count),this.openCountRequests.delete(o));return}case"EOSE":{const f=this.openSubs.get(o);if(!f)return;f.oneose(o);return}case"OK":{const f=n[2],g=n[3],b=this.openEventPublishes.get(o),_=b?.pop();if(!b||!_){this.debug("Received OK for unknown event publish",o);return}f?(_.resolve(g),this.pendingAuthPublishes.delete(o)):g&&(g.toLowerCase().includes("auth-required")||g.toLowerCase().includes("not authorized")||g.toLowerCase().includes("blocked: not authorized"))?this.pendingAuthPublishes.get(o)?(this.debug("Publish failed due to auth-required, will retry after auth",o),b.push(_),this.openEventPublishes.set(o,b)):_.reject(new Error(g)):(_.reject(new Error(g)),this.pendingAuthPublishes.delete(o)),b.length===0?this.openEventPublishes.delete(o):!f&&!(g?.toLowerCase().includes("auth-required")||g?.toLowerCase().includes("not authorized")||g?.toLowerCase().includes("blocked: not authorized"))&&this.openEventPublishes.set(o,b);return}case"CLOSED":{const f=this.openSubs.get(o);if(!f)return;f.onclosed(n[2]);return}case"NOTICE":this.onNotice(n[1]);return;case"AUTH":{this.onAuthRequested(n[1]);return}}}catch(n){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${n.message}`,n?.stack);return}}async onAuthRequested(t){const n=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!n}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,n){if(this._status>=5){this._status=7;let s;try{s=await n(this.ndkRelay,t)}catch(o){this.debug("Authentication policy threw an error",o),s=!1}if(this.debug("Authentication policy returned",!!s),s instanceof NDKEvent$1||s===!0){s instanceof NDKEvent$1&&await this.auth(s);const o=async()=>{if(this._status>=5&&this._status<8){const a=new NDKEvent$1(this.ndk);a.kind=22242,a.tags=[["relay",this.ndkRelay.url],["challenge",t]],await a.sign(),this.auth(a).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful"),this.retryPendingAuthPublishes()}).catch(c=>{this._status=6,this.ndkRelay.emit("auth:failed",c),this.debug("Authentication failed",c),this.rejectPendingAuthPublishes(c)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};s===!0&&(this.ndk?.signer?o().catch(a=>{console.error("Error authenticating",a)}):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",o))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t)}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!==0)return!1;const s=t.reduce((f,g)=>f+g,0)/t.length,o=t.map(f=>(f-s)**2).reduce((f,g)=>f+g,0)/t.length;return Math.sqrt(o)<FLAPPING_THRESHOLD_MS$1}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let n;if(this.wasIdle){const s=[0,1e3,2e3,5e3,1e4,3e4];n=s[Math.min(t,s.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${t}, delay ${n}ms`)}else this.connectedAt?n=Math.max(0,6e4-(Date.now()-this.connectedAt)):(n=Math.min(1e3*2**t,3e4),this.debug(`Using standard backoff, attempt ${t}, delay ${n}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(s=>{t<MAX_RECONNECT_ATTEMPTS$1?this.handleReconnection(t+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},n),this.ndkRelay.emit("delayed-connect",n),this.debug("Reconnecting in",n),this._connectionStats.nextReconnectAt=Date.now()+n}async send(t){Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(t),this.netDebug?.(t,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status),this._status>=5&&this.ws?.readyState!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${this.ws?.readyState}`),this.handleStaleConnection()))}async auth(t){const n=new Promise((s,o)=>{const a=this.openEventPublishes.get(t.id)??[];a.push({resolve:s,reject:o}),this.openEventPublishes.set(t.id,a)});return this.send(`["AUTH",${JSON.stringify(t.rawEvent())}]`),n}clearPendingPublishes(t){this.rejectPendingAuthPublishes(t);for(const[n,s]of this.openEventPublishes.entries()){for(;s.length>0;){const o=s.shift();o&&o.reject(t)}this.openEventPublishes.delete(n)}}retryPendingAuthPublishes(){if(this.pendingAuthPublishes.size!==0){this.debug(`Retrying ${this.pendingAuthPublishes.size} pending publishes after auth`);for(const[t,n]of this.pendingAuthPublishes.entries())this.debug(`Retrying publish for event ${t}`),this.send(`["EVENT",${JSON.stringify(n)}]`);this.pendingAuthPublishes.clear()}}rejectPendingAuthPublishes(t){if(this.pendingAuthPublishes.size!==0){this.debug(`Rejecting ${this.pendingAuthPublishes.size} pending publishes due to auth failure`);for(const[n]of this.pendingAuthPublishes.entries()){const s=this.openEventPublishes.get(n);if(s&&s.length>0){const o=s.pop();o&&o.reject(new Error(`Authentication failed: ${t.message}`)),s.length===0&&this.openEventPublishes.delete(n)}}this.pendingAuthPublishes.clear()}}async publish(t){const n=new Promise((s,o)=>{const a=this.openEventPublishes.get(t.id)??[];a.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${t.id} twice`),a.push({resolve:s,reject:o}),this.openEventPublishes.set(t.id,a)});return this.pendingAuthPublishes.set(t.id,t),this.send(`["EVENT",${JSON.stringify(t)}]`),n}async count(t,n){this.serial++;const s=n?.id||`count:${this.serial}`,o=new Promise((a,c)=>{this.openCountRequests.set(s,{resolve:a,reject:c})});return this.send(`["COUNT","${s}",${JSON.stringify(t).substring(1)}`),o}close(t,n){this.send(`["CLOSE","${t}"]`);const s=this.openSubs.get(t);this.openSubs.delete(t),s&&s.onclose(n)}req(t){`${this.send(`["REQ","${t.subId}",${JSON.stringify(t.executeFilters).substring(1)}`)}`,this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}};async function fetchRelayInformation$2(r){const t=r.replace(/^wss:\/\//,"https://").replace(/^ws:\/\//,"http://"),n=await fetch(t,{headers:{Accept:"application/nostr+json"}});if(!n.ok)throw new Error(`Failed to fetch relay information: ${n.status} ${n.statusText}`);return await n.json()}var NDKRelayPublisher$1=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,n=2500){let s;const o=()=>new Promise((L,q)=>{try{this.publishEvent(t).then(X=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),L(!0)}).catch(q)}catch(X){q(X)}}),a=new Promise((L,q)=>{s=setTimeout(()=>{s=void 0,q(new Error(`Timeout: ${n}ms`))},n)}),c=()=>{o().then(L=>f(L)).catch(L=>g(L))};let f,g;const b=L=>{throw this.ndkRelay.debug("Publish failed",L,t.id),this.ndkRelay.emit("publish:failed",t,L),t.emit("relay:publish:failed",this.ndkRelay,L),L},_=()=>{s&&clearTimeout(s),this.ndkRelay.removeListener("connect",c)};return this.ndkRelay.status>=5?Promise.race([o(),a]).catch(b).finally(_):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((L,q)=>{f=L,g=q,this.ndkRelay.on("connect",c)}),a]).catch(b).finally(_))}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function filterFingerprint$1(r,t){const n=[];for(const o of r){const a=Object.entries(o||{}).map(([c,f])=>["since","until"].includes(c)?`${c}:${f}`:c).sort().join("-");n.push(a)}let s=t?"+":"";return s+=n.join("|"),s}function mergeFilters$1(r){const t=[],n={};return r.filter(s=>!!s.limit).forEach(s=>t.push(s)),r=r.filter(s=>!s.limit),r.length===0?t:(r.forEach(s=>{Object.entries(s).forEach(([o,a])=>{Array.isArray(a)?n[o]===void 0?n[o]=[...a]:n[o]=Array.from(new Set([...n[o],...a])):n[o]=a})}),[...t,n])}var MAX_ITEMS$1=3;function formatArray$1(r,t){const s=(t?r.slice(0,MAX_ITEMS$1).map(t):r.slice(0,MAX_ITEMS$1)).join(",");return r.length>MAX_ITEMS$1?`${s}+${r.length-MAX_ITEMS$1}`:s}function formatFilters$1(r){return r.map(t=>{const n=[];t.ids?.length&&n.push(`ids:[${formatArray$1(t.ids,s=>String(s).slice(0,8))}]`),t.kinds?.length&&n.push(`kinds:[${formatArray$1(t.kinds)}]`),t.authors?.length&&n.push(`authors:[${formatArray$1(t.authors,s=>String(s).slice(0,8))}]`),t.since&&n.push(`since:${t.since}`),t.until&&n.push(`until:${t.until}`),t.limit&&n.push(`limit:${t.limit}`),t.search&&n.push(`search:"${String(t.search).slice(0,20)}"`);for(const[s,o]of Object.entries(t))s.startsWith("#")&&Array.isArray(o)&&o.length>0&&n.push(`${s}:[${formatArray$1(o,a=>String(a).slice(0,8))}]`);return`{${n.join(" ")}}`}).join(", ")}var NDKRelaySubscription$1=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(t,n,s){this.relay=t,this.topSubManager=s,this.debug=t.debug.extend(`sub[${this.id}]`),this.fingerprint=n||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,n){if(this.debug("Adding item",{filters:formatFilters$1(n),internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,itemsSize:this.items.size}),!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:n}),this.status!==3&&t.subId&&(!this._subId||this._subId.length<25)&&(this.status===0||this.status===1)&&this.addSubIdPart(t.subId),this.status){case 0:this.evaluateExecutionPlan(t);break;case 3:break;case 1:this.evaluateExecutionPlan(t);break;case 4:throw this.debug("Subscription is closed, cannot add new items",{filters:formatFilters$1(n),subId:t.subId,internalId:t.internalId}),new Error("Cannot add new items to a closed subscription")}}removeItem(t){if(this.items.delete(t.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const t=this.status;if(this.status=4,t===3)try{this.relay.close(this.subId)}catch(n){this.debug("Error closing subscription",n,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(t){if(!t.isGroupable()){this.status=1,this.execute();return}if(t.filters.find(o=>!!o.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const n=t.groupableDelay,s=t.groupableDelayType;if(!n)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(n,s);else{const o=this.delayType,a=this.fireTime-Date.now();if(o==="at-least"&&s==="at-least")a<n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-least"&&s==="at-most")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-most"&&s==="at-most")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else if(o==="at-most"&&s==="at-least")a>n&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(n,s));else throw new Error(`Unknown delay type combination ${o} ${s}`)}}schedule(t,n){this.status=1;const s=Date.now();this.fireTime=s+t,this.delayType=n;const o=setTimeout(this.execute.bind(this),t);n==="at-least"&&(this.executionTimer=o)}executeOnRelayReady=()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size,filters:formatFilters$1(this.compileFilters())}),this.status=1,this.execute()}};finalizeSubId(){if(this.subIdParts.size>0){let n=Array.from(this.subIdParts).map(s=>s.substring(0,10)).join("-");n.length>20&&(n=n.substring(0,20)),this._subId=n}else this._subId=this.fingerprint.slice(0,15);this._subId+=`-${Math.random().toString(36).substring(2,7)}`}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:t}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",t,this.subId)}).bind(this);execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubManager.dispatchEvent(t,this.relay)}oneose(t){if(this.eosed=!0,t!==this.subId){this.debug("Received EOSE for an abandoned subscription",t,this.subId),this.relay.close(t);return}this.items.size===0&&this.close();for(const{subscription:n}of this.items.values())n.eoseReceived(this.relay),n.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:formatFilters$1(n.filters),internalId:n.internalId,status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.removeItem(n))}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:n}of this.items.values())n.closedReceived(this.relay,t)}compileFilters(){const t=[],n=Array.from(this.items.values()).map(o=>o.filters);if(!n[0])return this.debug(" No filters to merge",{itemsSize:this.items.size}),[];const s=n[0].length;for(let o=0;o<s;o++){const a=n.map(f=>f[o]),c=mergeFilters$1(a);t.push(...c)}return t}},NDKRelaySubscriptionManager$1=class{relay;subscriptions;generalSubManager;constructor(t,n){this.relay=t,this.subscriptions=new Map,this.generalSubManager=n}addSubscription(t,n){let s;if(!t.isGroupable())s=this.createSubscription(t,n);else{const o=filterFingerprint$1(n,t.closeOnEose);o&&(s=(this.subscriptions.get(o)||[]).find(c=>c.status<3)),s??=this.createSubscription(t,n,o)}s.addItem(t,n)}createSubscription(t,n,s){const o=new NDKRelaySubscription$1(this.relay,s||null,this.generalSubManager);o.onClose=this.onRelaySubscriptionClose.bind(this);const a=this.subscriptions.get(o.fingerprint)??[];return this.subscriptions.set(o.fingerprint,[...a,o]),o}onRelaySubscriptionClose(t){let n=this.subscriptions.get(t.fingerprint)??[];n?n.length===1?this.subscriptions.delete(t.fingerprint):(n=n.filter(s=>s.id!==t.id),this.subscriptions.set(t.fingerprint,n)):console.warn("Unexpectedly did not find a subscription with fingerprint",t.fingerprint)}},NDKRelayStatus=(r=>(r[r.DISCONNECTING=0]="DISCONNECTING",r[r.DISCONNECTED=1]="DISCONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.FLAPPING=3]="FLAPPING",r[r.CONNECTING=4]="CONNECTING",r[r.CONNECTED=5]="CONNECTED",r[r.AUTH_REQUESTED=6]="AUTH_REQUESTED",r[r.AUTHENTICATING=7]="AUTHENTICATING",r[r.AUTHENTICATED=8]="AUTHENTICATED",r))(NDKRelayStatus||{}),NDKRelay$1=class Os extends libExports$1.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;protocolHandlers=new Map;_relayInfo;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,n,s)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let o=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const a=n/100;o=Math.max(t.lowestValidationRatio,t.validationRatio-a)}return o<t.validationRatio?o:t.validationRatio};constructor(t,n,s){super(),this.url=normalizeRelayUrl$1(t),this.scores=new Map,this.debug=createDebug2(`ndk:relay:${t}`),this.connectivity=new NDKRelayConnectivity$1(this,s),this.connectivity.netDebug=s?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager$1(this,s.subManager),this.publisher=new NDKRelayPublisher$1(this),this.authPolicy=n,this.targetValidationRatio=s?.initialValidationRatio,this.lowestValidationRatio=s?.lowestValidationRatio,this.validationRatioFn=(s?.validationRatioFn??Os.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const t=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=t}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,n=!0){return this.connectivity.connect(t,n)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,n){this.subs.addSubscription(t,n)}async publish(t,n=2500){return this.publisher.publish(t,n)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}req;close;registerProtocolHandler(t,n){this.protocolHandlers.set(t,n)}unregisterProtocolHandler(t){this.protocolHandlers.delete(t)}getProtocolHandler(t){return this.protocolHandlers.get(t)}async fetchInfo(t=!1){const s=this.connectivity.ndk;if(!t&&s?.cacheAdapter?.getRelayStatus){const o=await s.cacheAdapter.getRelayStatus(this.url);if(o?.nip11&&Date.now()-o.nip11.fetchedAt<864e5)return this._relayInfo=o.nip11.data,o.nip11.data}return!t&&this._relayInfo?this._relayInfo:(this._relayInfo=await fetchRelayInformation$2(this.url),s?.cacheAdapter?.updateRelayStatus&&await s.cacheAdapter.updateRelayStatus(this.url,{nip11:{data:this._relayInfo,fetchedAt:Date.now()}}),this._relayInfo)}get info(){return this._relayInfo}},NDKPublishError$1=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,n,s,o){super(t),this.errors=n,this.publishedToRelays=s,this.intendedRelaySet=o}get relayErrors(){const t=[];for(const[n,s]of this.errors)t.push(`${n.url}: ${s}`);return t.join(`
`)}},NDKRelaySet$1=class Fs{relays;debug;ndk;pool;constructor(t,n,s){this.relays=t,this.ndk=n,this.pool=s??n.pool,this.debug=n.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,n,s=!0,o){if(o=o??n.pool,!o)throw new Error("No pool provided");const a=new Set;for(const c of t){const f=o.relays.get(normalizeRelayUrl$1(c));if(f)f.status<5&&s&&f.connect(),a.add(f);else{const g=new NDKRelay$1(normalizeRelayUrl$1(c),n?.relayAuthDefaultPolicy,n);o.useTemporaryRelay(g,void 0,`requested from fromRelayUrls ${t}`),a.add(g)}}return new Fs(new Set(a),n,o)}async publish(t,n,s=1){const o=new Set,a=new Map,c=t.isEphemeral();t.publishStatus="pending";const f=g=>{o.add(g)};t.on("relay:published",f);try{const g=Array.from(this.relays).map(b=>new Promise(_=>{const L=n?setTimeout(()=>{o.has(b)||(a.set(b,new Error(`Publish timeout after ${n}ms`)),_(!1))},n):null;b.publish(t,n).then(q=>{L&&clearTimeout(L),q?(o.add(b),_(!0)):_(!1)}).catch(q=>{L&&clearTimeout(L),c||a.set(b,q),_(!1)})}));if(await Promise.all(g),o.size<s){if(!c){const b=new NDKPublishError$1("Not enough relays received the event ("+o.size+" published, "+s+" required)",a,o,this);throw t.publishStatus="error",t.publishError=b,this.ndk?.emit("event:publish-failed",t,b,this.relayUrls),b}}else t.publishStatus="success",t.emit("published",{relaySet:this,publishedToRelays:o});return o}finally{t.off("relay:published",f)}}get size(){return this.relays.size}},d$5=createDebug2("ndk:outbox:calculate");async function calculateRelaySetFromEvent$1(r,t,n){const s=new Set,o=await getWriteRelaysFor$1(r,t.pubkey);o&&o.forEach(f=>{const g=r.pool?.getRelay(f);g&&s.add(g)});let a=t.tags.filter(f=>["a","e"].includes(f[0])).map(f=>f[2]).filter(f=>f?.startsWith("wss://")).filter(f=>{try{return new URL(f),!0}catch{return!1}}).map(f=>normalizeRelayUrl$1(f));a=Array.from(new Set(a)).slice(0,5),a.forEach(f=>{const g=r.pool?.getRelay(f,!0,!0);g&&(d$5("Adding relay hint %s",f),s.add(g))});const c=t.getMatchingTags("p").map(f=>f[1]);return c.length<5?Array.from(chooseRelayCombinationForPubkeys$1(r,c,"read",{preferredRelays:new Set(o)}).keys()).forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d$5("Adding p-tagged relay %s",g),s.add(b))}):d$5("Too many p-tags to consider %d",c.length),r.pool?.permanentAndConnectedRelays().forEach(f=>s.add(f)),n&&s.size<n&&r.explicitRelayUrls?.filter(g=>!Array.from(s).some(b=>b.url===g)).slice(0,n-s.size)?.forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d$5("Adding explicit relay %s",g),s.add(b))}),new NDKRelaySet$1(s,r)}function calculateRelaySetsFromFilter(r,t,n,s){const o=new Map,a=new Set;if(t.forEach(c=>{c.authors&&c.authors.forEach(f=>a.add(f))}),a.size>0){const c=getRelaysForFilterWithAuthors(r,Array.from(a),s);for(const f of c.keys())o.set(f,[]);for(const f of t)if(f.authors)for(const[g,b]of c.entries()){const _=f.authors.filter(L=>b.includes(L));o.set(g,[...o.get(g),{...f,authors:_}])}else for(const g of c.keys())o.set(g,[...o.get(g),f])}else r.explicitRelayUrls&&r.explicitRelayUrls.forEach(c=>{o.set(c,t)});return o.size===0&&n.permanentAndConnectedRelays().slice(0,5).forEach(c=>{o.set(c.url,t)}),o}function calculateRelaySetsFromFilters(r,t,n,s){return calculateRelaySetsFromFilter(r,t,n,s)}function isValidHex64$1(r){if(typeof r!="string"||r.length!==64)return!1;for(let t=0;t<64;t++){const n=r.charCodeAt(t);if(!(n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70))return!1}return!0}function isValidPubkey$1(r){return isValidHex64$1(r)}function isValidNip05(r){if(typeof r!="string")return!1;for(let t=0;t<r.length;t++)if(r.charCodeAt(t)===46)return!0;return!1}function mergeTags$1(r,t){const n=new Map,s=c=>c.join(","),o=(c,f)=>c.every((g,b)=>g===f[b]),a=c=>{for(const[f,g]of n)if(o(g,c)||o(c,g)){c.length>=g.length&&n.set(f,c);return}n.set(s(c),c)};return r.concat(t).forEach(a),Array.from(n.values())}var hashtagRegex$1=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags$1(r){const t=r.match(hashtagRegex$1),n=new Set,s=new Set;if(t)for(const o of t)n.has(o.slice(1))||(s.add(o.slice(1)),n.add(o.slice(1)));return Array.from(s)}async function generateContentTags$1(r,t=[],n,s){if(n?.skipContentTagging)return{content:r,tags:t};const o=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,a=[],c=f=>{t.find(g=>["q",f[0]].includes(g[0])&&g[1]===f[1])||t.push(f)};if(r=r.replace(o,f=>{try{const g=f.split(/(@|nostr:)/)[2],{type:b,data:_}=nip19_exports$3.decode(g);let L;if(n?.filters){const q=!n.filters.includeTypes||n.filters.includeTypes.includes(b),X=n.filters.excludeTypes?.includes(b);if(!q||X)return f}switch(b){case"npub":n?.pTags!==!1&&(L=["p",_]);break;case"nprofile":n?.pTags!==!1&&(L=["p",_.pubkey]);break;case"note":a.push(new Promise(async q=>{const X=await maybeGetEventRelayUrl$1(g);c(["q",_,X]),q()}));break;case"nevent":a.push(new Promise(async q=>{const{id:X,author:te}=_;let{relays:ne}=_;(!ne||ne.length===0)&&(ne=[await maybeGetEventRelayUrl$1(g)]),c(["q",X,ne[0]]),te&&n?.pTags!==!1&&n?.pTagOnQTags!==!1&&c(["p",te]),q()}));break;case"naddr":a.push(new Promise(async q=>{const X=[_.kind,_.pubkey,_.identifier].join(":");let te=_.relays??[];te.length===0&&(te=[await maybeGetEventRelayUrl$1(g)]),c(["q",X,te[0]]),n?.pTags!==!1&&n?.pTagOnQTags!==!1&&n?.pTagOnATags!==!1&&c(["p",_.pubkey]),q()}));break;default:return f}return L&&c(L),`nostr:${g}`}catch{return f}}),await Promise.all(a),!n?.filters?.excludeTypes?.includes("hashtag")){const f=generateHashtags$1(r).map(g=>["t",g]);t=mergeTags$1(t,f)}if(n?.pTags!==!1&&n?.copyPTagsFromTarget&&s){const f=s.getMatchingTags("p");for(const g of f)!g[1]||!isValidPubkey$1(g[1])||t.find(b=>b[0]==="p"&&b[1]===g[1])||t.push(g)}return{content:r,tags:t}}async function maybeGetEventRelayUrl$1(r){return""}async function encrypt$4(r,t,n="nip44"){let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||(()=>{const c=this.getMatchingTags("p");if(c.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:c[0][1]})})();if(n==="nip44"&&await isEncryptionEnabled$1(o,"nip44")&&(s=await o.encrypt(a,this.content,"nip44")),(!s||n==="nip04")&&await isEncryptionEnabled$1(o,"nip04")&&(s=await o.encrypt(a,this.content,"nip04")),!s)throw new Error("Failed to encrypt event.");this.content=s}async function decrypt$4(r,t,n){if(this.ndk?.cacheAdapter?.getDecryptedEvent){const f=await this.ndk.cacheAdapter.getDecryptedEvent(this.id);if(f){this.content=f.content;return}}let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||this.author;if(!a)throw new Error("No sender provided and no author available");const c=n||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((c==="nip04"||this.kind===4)&&await isEncryptionEnabled$1(o,"nip04")&&this.content.search("\\?iv=")&&(s=await o.decrypt(a,this.content,"nip04")),!s&&c==="nip44"&&await isEncryptionEnabled$1(o,"nip44")&&(s=await o.decrypt(a,this.content,"nip44")),!s)throw new Error("Failed to decrypt event.");this.content=s,this.ndk?.cacheAdapter?.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this.id,this)}async function isEncryptionEnabled$1(r,t){return r.encryptionEnabled?t?!!await r.encryptionEnabled(t):!0:!1}function eventHasETagMarkers$1(r){for(const t of r.tags)if(t[0]==="e"&&(t[3]??"").length>0)return!0;return!1}function getRootTag$1(r,t){t??=r.tagType();const n=r.tags.find(isTagRootTag$1);if(!n){if(eventHasETagMarkers$1(r))return;const s=r.getMatchingTags(t);if(s.length<3)return s[0]}return n}var nip22RootTags$1=new Set(["A","E","I"]),nip22ReplyTags$1=new Set(["a","e","i"]);function getReplyTag$1(r,t){if(r.kind===1111){let o;for(const a of r.tags)if(nip22RootTags$1.has(a[0]))o=a;else if(nip22ReplyTags$1.has(a[0])){o=a;break}return o}t??=r.tagType();let n=!1,s;for(const o of r.tags)if(o[0]===t){if((o[3]??"").length>0&&(n=!0),n&&o[3]==="reply")return o;n&&o[3]==="root"&&(s=o),n||(s=o)}return s}function isTagRootTag$1(r){return r[0]==="E"||r[3]==="root"}async function fetchTaggedEvent$1(r,t){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(r,t);if(n.length===0)return;const[s,o,a]=n[0],c=a!==""?this.ndk.pool.getRelay(a):void 0;return await this.ndk.fetchEvent(o,{},c)}async function fetchRootEvent$1(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getRootTag$1(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}async function fetchReplyEvent$1(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getReplyTag$1(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}function isReplaceable$1(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral$1(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable$1(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT$1=2;function encode$3(r=DEFAULT_RELAY_COUNT$1){let t=[];return this.onRelays.length>0?t=this.onRelays.map(n=>n.url):this.relay&&(t=[this.relay.url]),t.length>r&&(t=t.slice(0,r)),this.isParamReplaceable()?nip19_exports$3.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?nip19_exports$3.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):nip19_exports$3.noteEncode(this.tagId())}async function repost$1(r=!0,t){if(!t&&r){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const n=new NDKEvent$1(this.ndk,{kind:getKind$1(this)});return this.isProtected||(n.content=JSON.stringify(this.rawEvent())),n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),t&&await n.sign(t),r&&await n.publish(),n}function getKind$1(r){return r.kind===1?6:16}function getEventDetails$1(r){return"inspect"in r&&typeof r.inspect=="string"?r.inspect:JSON.stringify(r)}function validateForSerialization$1(r){if(typeof r.kind!="number")throw new Error(`Can't serialize event with invalid properties: kind (must be number, got ${typeof r.kind}). Event: ${getEventDetails$1(r)}`);if(typeof r.content!="string")throw new Error(`Can't serialize event with invalid properties: content (must be string, got ${typeof r.content}). Event: ${getEventDetails$1(r)}`);if(typeof r.created_at!="number")throw new Error(`Can't serialize event with invalid properties: created_at (must be number, got ${typeof r.created_at}). Event: ${getEventDetails$1(r)}`);if(typeof r.pubkey!="string")throw new Error(`Can't serialize event with invalid properties: pubkey (must be string, got ${typeof r.pubkey}). Event: ${getEventDetails$1(r)}`);if(!Array.isArray(r.tags))throw new Error(`Can't serialize event with invalid properties: tags (must be array, got ${typeof r.tags}). Event: ${getEventDetails$1(r)}`);for(let t=0;t<r.tags.length;t++){const n=r.tags[t];if(!Array.isArray(n))throw new Error(`Can't serialize event with invalid properties: tags[${t}] (must be array, got ${typeof n}). Event: ${getEventDetails$1(r)}`);for(let s=0;s<n.length;s++)if(typeof n[s]!="string")throw new Error(`Can't serialize event with invalid properties: tags[${t}][${s}] (must be string, got ${typeof n[s]}). Event: ${getEventDetails$1(r)}`)}}function serialize$1(r=!1,t=!1){validateForSerialization$1(this);const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return r&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}function deserialize$1(r){const t=JSON.parse(r),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};if(t.length>=7){const s=t[6],o=t[7];s&&s.length===128?(n.sig=s,o&&o.length===64&&(n.id=o)):s&&s.length===64&&(n.id=s,o&&o.length===128&&(n.sig=o))}return n}var worker,processingQueue$1={};function signatureVerificationInit(r){worker=r,worker.onmessage=t=>{if(!Array.isArray(t.data)||t.data.length!==2){console.error("[NDK]  Signature verification worker received incompatible message format.",`

 Expected format: [eventId, boolean]`,`
 Received:`,t.data,`

 This likely means:`,`
  1. You have a STALE worker.js file that needs updating`,`
  2. Version mismatch between @nostr-dev-kit/ndk and deployed worker`,`
  3. Wrong worker is being used for signature verification`,`

 Solution: Update your worker files:`,`
  cp node_modules/@nostr-dev-kit/ndk/dist/workers/sig-verification.js public/`,`
  cp node_modules/@nostr-dev-kit/cache-sqlite-wasm/dist/worker.js public/`,`

 Or use Vite/bundler imports instead of static files:`,`
  import SigWorker from "@nostr-dev-kit/ndk/workers/sig-verification?worker"`);return}const[n,s]=t.data,o=processingQueue$1[n];if(!o){console.error("No record found for event",n);return}delete processingQueue$1[n];for(const a of o.resolves)a(s)}}async function verifySignatureAsync$1(r,t,n){const s=r.ndk,o=Date.now();let a;return s.signatureVerificationFunction?a=await s.signatureVerificationFunction(r):a=await new Promise(c=>{const f=r.serialize();let g=!1;processingQueue$1[r.id]||(processingQueue$1[r.id]={event:r,resolves:[],relay:n},g=!0),processingQueue$1[r.id].resolves.push(c),g&&worker?.postMessage({serialized:f,id:r.id,sig:r.sig,pubkey:r.pubkey})}),s.signatureVerificationTimeMs+=Date.now()-o,a}var PUBKEY_REGEX$1=/^[a-f0-9]{64}$/;function validate$1(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX$1)||!Array.isArray(this.tags))return!1;for(let r=0;r<this.tags.length;r++){const t=this.tags[r];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]=="object")return!1}return!0}var verifiedSignatures$1=new distExports$1.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature$1(r){if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const t=verifiedSignatures$1.get(this.id);if(t!==null)return this.signatureVerified=!!t,this.signatureVerified;try{if(this.ndk?.asyncSigVerification){const n=this.relay;verifySignatureAsync$1(this,r,n).then(s=>{r&&(this.signatureVerified=s,s&&verifiedSignatures$1.set(this.id,this.sig)),s?n&&n.addValidatedEvent():(n?this.ndk?.reportInvalidSignature(this,n):this.ndk?.reportInvalidSignature(this),verifiedSignatures$1.set(this.id,!1))}).catch(s=>{console.error("signature verification error",this.id,s)})}else{const n=sha256$4(new TextEncoder().encode(this.serialize())),s=schnorr$2.verify(this.sig,n,this.pubkey);return s?verifiedSignatures$1.set(this.id,this.sig):verifiedSignatures$1.set(this.id,!1),this.signatureVerified=s,s}}catch{return this.signatureVerified=!1,!1}}function getEventHash$2(){return getEventHashFromSerializedEvent$1(this.serialize())}function getEventHashFromSerializedEvent$1(r){const t=sha256$4(new TextEncoder().encode(r));return bytesToHex$4(t)}var skipClientTagOnKinds$1=new Set([0,4,1059,13,3,9734,5]),NDKEvent$1=class ci extends libExports$1.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(t,n){super(),this.ndk=t,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof ci&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(t,n){return new ci(t,deserialize$1(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,n,s){const o=["i"],a=["k"];switch(n){case"url":{const c=new URL(t);c.hash="",o.push(c.toString()),a.push(`${c.protocol}//${c.host}`);break}case"hashtag":o.push(`#${t.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${t.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${t.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${t}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${t}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${t}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${t.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${t.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${n}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(t,n,s,o,a){let c=[];if(t.fetchProfile!==void 0){if(o??="p",o==="p"&&a?.pTags===!1)return;const g=[o,t.pubkey];n&&g.push("",n),c.push(g)}else if(t instanceof ci){const g=t;if(s??=g?.pubkey===this.pubkey,c=g.referenceTags(n,s,o,a),a?.pTags!==!1)for(const b of g.getMatchingTags("p"))!b[1]||!isValidPubkey$1(b[1])||b[1]!==this.pubkey&&(this.tags.find(_=>_[0]==="p"&&_[1]===b[1])||this.tags.push(["p",b[1]]))}else if(Array.isArray(t))c=[t];else throw new Error("Invalid argument",t);this.tags=mergeTags$1(this.tags,c)}async toNostrEvent(t,n){if(!t&&this.pubkey===""){const a=await this.ndk?.signer?.user();this.pubkey=a?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:s,tags:o}=await this.generateTags(n);this.content=s||"",this.tags=o;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}serialize=serialize$1.bind(this);getEventHash=getEventHash$2.bind(this);validate=validate$1.bind(this);verifySignature=verifySignature$1.bind(this);isReplaceable=isReplaceable$1.bind(this);isEphemeral=isEphemeral$1.bind(this);isDvm=()=>this.kind&&this.kind>=5e3&&this.kind<=7e3;isParamReplaceable=isParamReplaceable$1.bind(this);encode=encode$3.bind(this);encrypt=encrypt$4.bind(this);decrypt=decrypt$4.bind(this);getMatchingTags(t,n){const s=this.tags.filter(o=>o[0]===t);return n===void 0?s:s.filter(o=>o[3]===n)}hasTag(t,n){return this.tags.some(s=>s[0]===t&&(!n||s[3]===n))}tagValue(t,n){const s=this.getMatchingTags(t,n);if(s.length!==0)return s[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t,n){const s=Array.isArray(t)?t:[t];this.tags=this.tags.filter(o=>{const a=s.includes(o[0]),c=n?o[3]===n:!0;return!(a&&c)})}replaceTag(t){this.removeTag(t[0]),this.tags.push(t)}async sign(t,n){this.ndk?.aiGuardrails?.event?.signing(this),t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk?.signer);const s=await this.toNostrEvent(void 0,n);return this.sig=await t.sign(s),this.sig}async publishReplaceable(t,n,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,n,s)}async publish(t,n,s,o){if(s||(s=1),this.sig||await this.sign(void 0,o),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(this.ndk.aiGuardrails?.event?.publishing(this),(!t||t.size===0)&&(t=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent$1(this.ndk,this,s)),this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds){const f=this.getMatchingTags("e").map(g=>g[1]);this.ndk.cacheAdapter.deleteEventIds(f)}const a=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent&&shouldTrackUnpublishedEvent$1(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(f){console.error("Error adding unpublished event to cache",f)}this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(f=>f[1])),this.ndk.subManager.dispatchEvent(a,void 0,!0);const c=await t.publish(this,n,s);return c.forEach(f=>this.ndk?.subManager.seenEvent(this.id,f)),c}async generateTags(t){let n=[];const s=await generateContentTags$1(this.content,this.tags,t,this),o=s.content;if(n=s.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const c=this.tagValue("title");let g=[...Array(c?6:16)].map(()=>Math.random().toString(36)[2]).join("");c&&c.length>0&&(g=`${c.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${g}`),n.push(["d",g])}if(this.shouldAddClientTag){const a=["client",this.ndk?.clientName??""];this.ndk?.clientNip89&&a.push(this.ndk?.clientNip89),n.push(a)}else this.shouldStripClientTag&&(n=n.filter(a=>a[0]!=="client"));return{content:o||"",tags:n}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||skipClientTagOnKinds$1.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds$1.has(this.kind)}muted(){return this.ndk?.muteFilter&&this.ndk.muteFilter(this)?"muted":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const t=this.dTag??"";return`${this.kind}:${this.pubkey}:${t}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let n;return this.isParamReplaceable()?n=["a",this.tagAddress()]:n=["e",this.tagId()],this.relay?n.push(this.relay.url):n.push(""),n.push(t??""),this.isParamReplaceable()||n.push(this.pubkey),n}referenceTags(t,n,s,o){let a=[];return this.isParamReplaceable()?a=[[s??"a",this.tagAddress()],[s??"e",this.id]]:a=[[s??"e",this.id]],a=a.map(c=>(c[0]==="e"||t?c.push(this.relay?.url??""):this.relay?.url&&c.push(this.relay?.url),c)),a.forEach(c=>{c[0]==="e"?(c.push(t??""),c.push(this.pubkey)):t&&c.push(t)}),a=[...a,...this.getMatchingTags("h")],!n&&o?.pTags!==!1&&a.push(...this.author.referenceTags()),a}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ci(this.ndk,{kind:5,content:t||""});return s.tag(this,void 0,!0),s.tags.push(["k",this.kind?.toString()]),n&&(this.emit("deleted"),await s.publish()),s}set isProtected(t){this.removeTag("-"),t&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}fetchTaggedEvent=fetchTaggedEvent$1.bind(this);fetchRootEvent=fetchRootEvent$1.bind(this);fetchReplyEvent=fetchReplyEvent$1.bind(this);repost=repost$1.bind(this);async react(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ci(this.ndk,{kind:7,content:t});return s.tag(this),this.kind!==1&&s.tags.push(["k",`${this.kind}`]),n&&await s.publish(),s}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(t=>t.url).join(", "))}reply(t,n){const s=new ci(this.ndk);if(this.ndk?.aiGuardrails?.event?.creatingReply(s),this.kind===1&&!t)s.kind=1,this.hasTag("e")?s.tags=[...s.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,n)]:s.tag(this,"root",!1,void 0,n);else{s.kind=1111;const o=["A","E","I","P"],a=this.tags.filter(c=>o.includes(c[0]));if(a.length>0){const c=this.tagValue("K");s.tags.push(...a),c&&s.tags.push(["K",c]);let f;if(this.isParamReplaceable()){f=["a",this.tagAddress()];const g=this.relay?.url??"";g&&f.push(g)}else{f=["e",this.tagId()];const g=this.relay?.url??"";f.push(g),f.push(this.pubkey)}s.tags.push(f)}else{let c,f;const g=this.relay?.url??"";this.isParamReplaceable()?(c=["a",this.tagAddress(),g],f=["A",this.tagAddress(),g]):(c=["e",this.tagId(),g,this.pubkey],f=["E",this.tagId(),g,this.pubkey]),s.tags.push(c),s.tags.push(f),s.tags.push(["K",this.kind?.toString()]),n?.pTags!==!1&&n?.pTagOnATags!==!1&&s.tags.push(["P",this.pubkey])}s.tags.push(["k",this.kind?.toString()]),n?.pTags!==!1&&(s.tags.push(...this.getMatchingTags("p")),s.tags.push(["p",this.pubkey]))}return s}},untrackedUnpublishedEvents$1=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent$1(r){return!untrackedUnpublishedEvents$1.has(r.kind)}var NDKPool$1=class extends libExports$1.EventEmitter{_relays=new Map;status="idle";autoConnectRelays=new Set;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;disconnectionTimes=new Map;systemEventDetector;constructor(t,n,{debug:s,name:o}={}){super(),this.debug=s??n.debug.extend("pool"),o&&(this._name=o),this.ndk=n,this.relayUrls=t,this.ndk.pools&&this.ndk.pools.push(this)}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const n of t){const s=new NDKRelay$1(n,void 0,this.ndk);s.connectivity.netDebug=this.ndk.netDebug,this.addRelay(s)}}_name="unnamed";get name(){return this._name}set name(t){this._name=t,this.debug=this.debug.extend(t)}useTemporaryRelay(t,n=3e4,s){const o=this.relays.has(t.url);o||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,s));const a=this.temporaryRelayTimers.get(t.url);if(a&&clearTimeout(a),!o||a){const c=setTimeout(()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)},n);this.temporaryRelayTimers.set(t.url,c)}}addRelay(t,n=!0){const s=this.relays.has(t.url),o=t.url.includes("/npub1");let a=!0;const c=t.url;if(s)return;if(this.ndk.relayConnectionFilter&&!this.ndk.relayConnectionFilter(c)){this.debug(`Refusing to add relay ${c}: blocked by relayConnectionFilter`);return}if(o){this.debug(`Refusing to add relay ${c}: is a filter relay`);return}if(this.ndk.cacheAdapter?.getRelayStatus){const te=this.ndk.cacheAdapter.getRelayStatus(c),ne=te instanceof Promise?void 0:te;if(ne?.dontConnectBefore){if(ne.dontConnectBefore>Date.now()){const Ce=ne.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${c}: delayed connect for ${Ce}ms`),setTimeout(()=>{this.addRelay(t,n)},Ce);return}a=!1}}const f=te=>this.emit("notice",t,te),g=()=>this.handleRelayConnect(c),b=()=>this.handleRelayReady(t),_=()=>{this.recordDisconnection(t),this.emit("relay:disconnect",t)},L=()=>this.handleFlapping(t),q=te=>this.emit("relay:auth",t,te),X=()=>this.emit("relay:authed",t);t.off("notice",f),t.off("connect",g),t.off("ready",b),t.off("disconnect",_),t.off("flapping",L),t.off("auth",q),t.off("authed",X),t.on("notice",f),t.on("connect",g),t.on("ready",b),t.on("disconnect",_),t.on("flapping",L),t.on("auth",q),t.on("authed",X),t.on("delayed-connect",te=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+te})}),this._relays.set(c,t),n&&this.autoConnectRelays.add(c),n&&this.status==="active"&&(this.emit("relay:connecting",t),t.connect(void 0,a).catch(te=>{this.debug(`Failed to connect to relay ${c}`,te)}))}removeRelay(t){const n=this.relays.get(t);if(n)return n.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",n),!0;const s=this.temporaryRelayTimers.get(t);return s&&(clearTimeout(s),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const n=normalizeRelayUrl$1(t),s=this.relays.get(n);return s?s.status===5:!1}getRelay(t,n=!0,s=!1,o){let a=this.relays.get(normalizeRelayUrl$1(t));return a||(a=new NDKRelay$1(t,void 0,this.ndk),a.connectivity.netDebug=this.ndk.netDebug,s?this.useTemporaryRelay(a,3e4,o):this.addRelay(a,n)),a}handleRelayConnect(t){const n=this.relays.get(t);if(!n){console.error("NDK BUG: relay not found in pool",{relayUrl:t});return}this.emit("relay:connect",n),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}ms`:""}...`);const n=Array.from(this.autoConnectRelays.keys()).map(c=>this.relays.get(c)).filter(c=>!!c);for(const c of n)c.status!==5&&c.status!==4&&(this.emit("relay:connecting",c),c.connect().catch(f=>{this.debug(`Failed to connect to relay ${c.url}: ${f??"No reason specified"}`)}));const s=()=>n.every(c=>c.status===5),o=new Promise(c=>{if(s()){c();return}const f=[];for(const g of n){const b=()=>{if(s()){for(let _=0;_<n.length;_++)n[_].off("connect",f[_]);c()}};f.push(b),g.on("connect",b)}}),a=typeof t=="number"?new Promise(c=>setTimeout(c,t)):new Promise(()=>{});await Promise.race([o,a])}checkOnFlappingRelays(){const t=this.flappingRelays.size,n=this.relays.size;if(t/n>=.8)for(const s of this.flappingRelays)this.backoffTimes.set(s,0)}recordDisconnection(t){const n=Date.now();this.disconnectionTimes.set(t.url,n);for(const[s,o]of this.disconnectionTimes.entries())n-o>1e4&&this.disconnectionTimes.delete(s);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const t=Date.now(),n=[];for(const s of this.disconnectionTimes.values())t-s<5e3&&n.push(s);n.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${n.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){if(this.systemEventDetector){this.debug("System-wide reconnection already in progress, skipping");return}this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const t of this.relays.values())t.connectivity&&(t.connectivity.resetReconnectionState(),t.status!==5&&t.status!==4&&t.connect().catch(n=>{this.debug(`Failed to reconnect relay ${t.url} after system event: ${n}`)}));this.disconnectionTimes.clear()}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let n=this.backoffTimes.get(t.url)||5e3;n=n*2,this.backoffTimes.set(t.url,n),this.debug(`Backoff time for ${t.url} is ${n}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()},n),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const n of this.relays.values())t.total++,n.status===5?t.connected++:n.status===1?t.disconnected++:n.status===4&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url))}urls(){return Array.from(this.relays.keys())}},NDKDVMJobFeedback$1=class Us extends NDKEvent$1{static kinds=[7e3];constructor(t,n){super(t,n),this.kind??=7e3}static async from(t){const n=new Us(t.ndk,t.rawEvent());return n.encrypted&&await n.dvmDecrypt(),n}get status(){return this.tagValue("status")}set status(t){this.removeTag("status"),t!==void 0&&this.tags.push(["status",t])}get encrypted(){return!!this.getMatchingTags("encrypted")[0]}async dvmDecrypt(){await this.decrypt();const t=JSON.parse(this.content);this.tags.push(...t)}},NDKCashuMintList$1=class Hs extends NDKEvent$1{static kind=10019;static kinds=[10019];_p2pk;constructor(t,n){super(t,n),this.kind??=10019}static from(t){return new Hs(t.ndk,t)}set relays(t){this.tags=this.tags.filter(n=>n[0]!=="relay");for(const n of t)this.tags.push(["relay",n])}get relays(){const t=[];for(const n of this.tags)n[0]==="relay"&&t.push(n[1]);return t}set mints(t){this.tags=this.tags.filter(n=>n[0]!=="mint");for(const n of t)this.tags.push(["mint",n])}get mints(){const t=[];for(const n of this.tags)n[0]==="mint"&&t.push(n[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return NDKRelaySet$1.fromRelayUrls(this.relays,this.ndk)}},NDKArticle$1=class qs extends NDKEvent$1{static kind=30023;static kinds=[30023];constructor(t,n){super(t,n),this.kind??=30023}static from(t){return new qs(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t){let n=Number.parseInt(t);return n>1e12&&(n=Math.floor(n/1e3)),n}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},NDKBlossomList$1=class zs extends NDKEvent$1{static kinds=[10063];constructor(t,n){super(t,n),this.kind??=10063}static from(t){return new zs(t.ndk,t.rawEvent())}get servers(){return this.tags.filter(t=>t[0]==="server").map(t=>t[1])}set servers(t){this.tags=this.tags.filter(n=>n[0]!=="server");for(const n of t)this.tags.push(["server",n])}get default(){const t=this.servers;return t.length>0?t[0]:void 0}set default(t){if(!t)return;const s=this.servers.filter(o=>o!==t);this.servers=[t,...s]}addServer(t){if(!t)return;const n=this.servers;n.includes(t)||(this.servers=[...n,t])}removeServer(t){if(!t)return;const n=this.servers;this.servers=n.filter(s=>s!==t)}},NDKFedimintMint$1=class Vs extends NDKEvent$1{static kind=38173;static kinds=[38173];constructor(t,n){super(t,n),this.kind??=38173}static async from(t){return new Vs(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get inviteCodes(){return this.getMatchingTags("u").map(t=>t[1])}set inviteCodes(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get modules(){return this.getMatchingTags("modules").map(t=>t[1])}set modules(t){this.removeTag("modules");for(const n of t)this.tags.push(["modules",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKCashuMintAnnouncement$1=class Ws extends NDKEvent$1{static kind=38172;static kinds=[38172];constructor(t,n){super(t,n),this.kind??=38172}static async from(t){return new Ws(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get url(){return this.tagValue("u")}set url(t){this.removeTag("u"),t&&this.tags.push(["u",t])}get nuts(){return this.getMatchingTags("nuts").map(t=>t[1])}set nuts(t){this.removeTag("nuts");for(const n of t)this.tags.push(["nuts",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKMintRecommendation$1=class js extends NDKEvent$1{static kind=38e3;static kinds=[38e3];constructor(t,n){super(t,n),this.kind??=38e3}static async from(t){return new js(t.ndk,t)}get recommendedKind(){const t=this.tagValue("k");return t?Number(t):void 0}set recommendedKind(t){this.removeTag("k"),t&&this.tags.push(["k",t.toString()])}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get urls(){return this.getMatchingTags("u").map(t=>t[1])}set urls(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get mintEventPointers(){return this.getMatchingTags("a").map(t=>({kind:Number(t[1].split(":")[0]),identifier:t[1].split(":")[2],relay:t[2]}))}addMintEventPointer(t,n,s,o){const a=["a",`${t}:${n}:${s}`];o&&a.push(o),this.tags.push(a)}get review(){return this.content}set review(t){this.content=t}},NDKClassified$1=class Ks extends NDKEvent$1{static kinds=[30402];constructor(t,n){super(t,n),this.kind??=30402}static from(t){return new Ks(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}get location(){return this.tagValue("location")}set location(t){this.removeTag("location"),t&&this.tags.push(["location",t])}get price(){const t=this.tags.find(n=>n[0]==="price");if(t)return{amount:Number.parseFloat(t[1]),currency:t[2],frequency:t[3]}}set price(t){if(typeof t=="string"&&(t={amount:Number.parseFloat(t)}),t?.amount){const n=["price",t.amount.toString()];t.currency&&n.push(t.currency),t.frequency&&n.push(t.frequency),this.tags.push(n)}else this.removeTag("price")}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}},NDKDraft$1=class Gs extends NDKEvent$1{_event;static kind=31234;static kinds=[31234,1234];counterparty;constructor(t,n){super(t,n),this.kind??=31234}static from(t){return new Gs(t.ndk,t)}set identifier(t){this.removeTag("d"),this.tags.push(["d",t])}get identifier(){return this.dTag}set event(t){t instanceof NDKEvent$1?this._event=t:this._event=new NDKEvent$1(void 0,t),this.prepareEvent()}set checkpoint(t){t?(this.tags.push(t.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const t=this.tagValue("p");return!!t&&t!==this.pubkey}async getEvent(t){if(this._event)return this._event;if(t??=this.ndk?.signer,!t)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const n=t.pubkey,o=[this.tagValue("p"),this.pubkey].filter(Boolean).find(f=>f!==n);let a;a=new NDKUser$1({pubkey:o??n}),await this.decrypt(a,t);const c=JSON.parse(this.content);return this._event=await wrapEvent$2(new NDKEvent$1(this.ndk,c)),this._event}catch(n){console.error(n);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:t,publish:n,relaySet:s}){if(t??=this.ndk?.signer,!t)throw new Error("No signer available");const o=this.counterparty||await t.user();if(await this.encrypt(o,t),this.counterparty){const a=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",a])}if(n!==!1)return this.publishReplaceable(s)}};function mapImetaTag$1(r){const t={};if(r.length===2){const s=r[1].split(" ");for(let o=0;o<s.length;o+=2){const a=s[o],c=s[o+1];a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}const n=r.slice(1);for(const s of n){const o=s.split(" "),a=o[0],c=o.slice(1).join(" ");a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}function imetaTagToTag$1(r){const t=["imeta"];for(const[n,s]of Object.entries(r))if(Array.isArray(s))for(const o of s)t.push(`${n} ${o}`);else s&&t.push(`${n} ${s}`);return t}var NDKFollowPack$1=class Js extends NDKEvent$1{static kind=39089;static kinds=[39089,39092];constructor(t,n){super(t,n),this.kind??=39089}static from(t){return new Js(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){const t=this.tags.find(n=>n[0]==="imeta");if(t){const n=mapImetaTag$1(t);if(n.url)return n.url}return this.tagValue("image")}set image(t){this.tags=this.tags.filter(n=>n[0]!=="imeta"&&n[0]!=="image"),typeof t=="string"?t!==void 0&&this.tags.push(["image",t]):t&&typeof t=="object"&&(this.tags.push(imetaTagToTag$1(t)),t.url&&this.tags.push(["image",t.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(t=>t[0]==="p"&&t[1]&&isValidPubkey$1(t[1])).map(t=>t[1])))}set pubkeys(t){this.tags=this.tags.filter(n=>n[0]!=="p");for(const n of t)this.tags.push(["p",n])}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}},NDKHighlight$1=class Zs extends NDKEvent$1{_article;static kind=9802;static kinds=[9802];constructor(t,n){super(t,n),this.kind??=9802}static from(t){return new Zs(t.ndk,t)}get url(){return this.tagValue("r")}set context(t){t===void 0?this.tags=this.tags.filter(([n,s])=>n!=="context"):(this.tags=this.tags.filter(([n,s])=>n!=="context"),this.tags.push(["context",t]))}get context(){return this.tags.find(([t,n])=>t==="context")?.[1]??void 0}get article(){return this._article}set article(t){this._article=t,typeof t=="string"?this.tags.push(["r",t]):this.tag(t)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){if(this._article!==void 0)return this._article;let t;const n=this.getArticleTag();if(n){switch(n[0]){case"a":{const[s,o,a]=n[1].split(":");t=nip19_exports$3.naddrEncode({kind:Number.parseInt(s),pubkey:o,identifier:a});break}case"e":t=nip19_exports$3.noteEncode(n[1]);break;case"r":this._article=n[1];break}if(t){let s=await this.ndk?.fetchEvent(t);s&&(s.kind===30023&&(s=NDKArticle$1.from(s)),this._article=s)}return this._article}}},NDKImage$1=class Ys extends NDKEvent$1{static kind=20;static kinds=[20];_imetas;constructor(t,n){super(t,n),this.kind??=20}static from(t){return new Ys(t.ndk,t.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag$1).filter(t=>!!t.url),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag$1))}},NDKList$1=class Xs extends NDKEvent$1{_encryptedTags;static kinds=[30001,10004,10050,10030,10015,10001,10002,10007,10006,10003];encryptedTagsLength;constructor(t,n){super(t,n),this.kind??=30001}static from(t){return new Xs(t.ndk,t)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(n,this.content),o=JSON.parse(s);return o?.[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(n=>n[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,n=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(t instanceof NDKEvent$1)a=[t.tagReference(n)];else if(t instanceof NDKUser$1)a=t.referenceTags();else if(t instanceof NDKRelay$1)a=t.referenceTags();else if(Array.isArray(t))a=[t];else throw new Error("Invalid object type");if(n&&a[0].push(n),s){const c=await this.ndk.signer.user(),f=await this.encryptedTags();o==="top"?f.unshift(...a):f.push(...a),this._encryptedTags=f,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(f),await this.encrypt(c)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,n=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(f=>f[1]===t);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),c=a.findIndex(f=>f[1]===t);if(c>=0&&(a.splice(c,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),n)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,n){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(n){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(t,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(n=>n[1]===t)}filterForItems(){const t=new Set,n=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])t.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,c,f]=o[1].split(":");if(!a||!c)continue;const g=`${a}:${c}`,b=n.get(g)||[];b.push(f||""),n.set(g,b)}if(t.size>0&&s.push({ids:Array.from(t)}),n.size>0)for(const[o,a]of n.entries()){const[c,f]=o.split(":");s.push({kinds:[Number.parseInt(c)],authors:[f],"#d":a})}return s}},NDKAppHandlerEvent$1=class Qs extends NDKEvent$1{profile;static kinds=[31990];constructor(t,n){super(t,n),this.kind??=31990}static from(t){const n=new Qs(t.ndk,t.rawEvent());return n.isValid?n:null}get isValid(){const t=new Map,n=o=>[o[0],o[2]].join(":").toLowerCase(),s=["web","android","ios"];for(const o of this.tags)if(s.includes(o[0])){const a=n(o);if(t.has(a)&&t.get(a)!==o[1].toLowerCase())return!1;t.set(a,o[1].toLowerCase())}return!0}async fetchProfile(){if(this.profile===void 0&&this.content.length>0)try{const t=JSON.parse(this.content);if(t?.name)return t;this.profile=null}catch{this.profile=null}return new Promise((t,n)=>{const s=this.author;s.fetchProfile().then(()=>{t(s.profile)}).catch(n)})}},NDKNutzap$1=class Pi extends NDKEvent$1{debug;_proofs=[];static kind=9321;static kinds=[Pi.kind];constructor(t,n){super(t,n),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??createDebug2("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const s=this.getMatchingTags("proof");s.length?this._proofs=s.map(o=>JSON.parse(o[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(t){const n=new Pi(t.ndk,t);if(!(!n._proofs||!n._proofs.length))return n}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(n=>n[0]!=="proof");for(const n of t)this.tags.push(["proof",JSON.stringify(n)])}get proofs(){return this._proofs}get rawP2pk(){const t=this.proofs[0];try{const n=JSON.parse(t.secret);let s;if(typeof n=="string"?(s=JSON.parse(n),this.debug("stringified payload",t.secret)):typeof n=="object"&&(s=n),Array.isArray(s)&&s[0]==="P2PK"&&s.length>1&&typeof s[1]=="object"&&s[1]!==null||typeof s=="object"&&s!==null&&typeof s[1]?.data=="string")return s[1].data}catch(n){this.debug("error parsing p2pk pubkey",n,this.proofs[0])}}get p2pk(){const t=this.rawP2pk;if(t)return t.startsWith("02")?t.slice(2):t}get mint(){return this.tagValue("u")}set mint(t){this.replaceTag(["u",t])}get unit(){let t=this.tagValue("unit")??"sat";return t?.startsWith("msat")&&(t="sat"),t}set unit(t){if(this.removeTag("unit"),t?.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((n,s)=>n+s.amount,0)}sender=this.author;set target(t){this.tags=this.tags.filter(n=>n[0]!=="p"),t instanceof NDKEvent$1&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new NDKUser$1({pubkey:t})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const t=await super.toNostrEvent();return t.content=this.comment,t}get isValid(){let t=0,n=0,s=0;for(const o of this.tags)o[0]==="e"&&t++,o[0]==="p"&&n++,o[0]==="u"&&s++;return n===1&&s===1&&t<=1&&this.proofs.length>0}};function proofP2pk(r){try{const t=JSON.parse(r.secret);let n={};if(typeof t=="string"?n=JSON.parse(t):typeof t=="object"&&(n=t),n[0]==="P2PK"&&n[1]?.data)return n[1].data}catch(t){console.error("error parsing p2pk pubkey",t,r)}}function cashuPubkeyToNostrPubkey(r){if(r.startsWith("02")&&r.length===66)return r.slice(2)}var NDKProject$1=class eo extends NDKEvent$1{static kind=31933;static kinds=[31933];_signer;constructor(t,n){super(t,n),this.kind=31933}static from(t){return new eo(t.ndk,t.rawEvent())}set repo(t){this.removeTag("repo"),t&&this.tags.push(["repo",t])}set hashtags(t){this.removeTag("hashtags"),t.filter(n=>n.length>0).length&&this.tags.push(["hashtags",...t])}get hashtags(){const t=this.tags.find(n=>n[0]==="hashtags");return t?t.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get picture(){return this.tagValue("picture")}set picture(t){this.removeTag("picture"),t&&this.tags.push(["picture",t])}set description(t){this.content=t}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){if(this._signer)return this._signer;const t=this.tagValue("key");if(!t)this._signer=NDKPrivateKeySigner$1.generate(),await this.encryptAndSaveNsec();else{const n=await this.ndk?.signer?.decrypt(this.ndk.activeUser,t);if(!n)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner$1(n)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(t){this._signer=new NDKPrivateKeySigner$1(t),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){if(!this._signer)throw new Error("Signer is not set.");const t=this._signer.privateKey,n=await this.ndk?.signer?.encrypt(this.ndk.activeUser,t);n&&(this.removeTag("key"),this.tags.push(["key",n]))}},NDKProjectTemplate$1=class to extends NDKEvent$1{static kind=30717;static kinds=[30717];constructor(t,n){super(t,n),this.kind=30717}static from(t){return new to(t.ndk,t.rawEvent())}get templateId(){return this.dTag??""}set templateId(t){this.dTag=t}get name(){return this.tagValue("title")??""}set name(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get description(){return this.tagValue("description")??""}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(t){this.removeTag("uri"),t&&this.tags.push(["uri",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get command(){return this.tagValue("command")}set command(t){this.removeTag("command"),t&&this.tags.push(["command",t])}get agentConfig(){const t=this.tagValue("agent");if(t)try{return JSON.parse(t)}catch{return}}set agentConfig(t){this.removeTag("agent"),t&&this.tags.push(["agent",JSON.stringify(t)])}get templateTags(){return this.getMatchingTags("t").map(t=>t[1]).filter(Boolean)}set templateTags(t){this.tags=this.tags.filter(n=>n[0]!=="t"),t.forEach(n=>{n&&this.tags.push(["t",n])})}},READ_MARKER$1="read",WRITE_MARKER$1="write",NDKRelayList$1=class ro extends NDKEvent$1{static kinds=[10002];constructor(t,n){super(t,n),this.kind??=10002}static from(t){return new ro(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===READ_MARKER$1).map(t=>tryNormalizeRelayUrl$1(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(const n of t)this.tags.push(["r",n,READ_MARKER$1])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===WRITE_MARKER$1).map(t=>tryNormalizeRelayUrl$1(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(const n of t)this.tags.push(["r",n,WRITE_MARKER$1])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(const n of t)this.tags.push(["r",n])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet$1(new Set(this.relays.map(t=>this.ndk?.pool.getRelay(t)).filter(t=>!!t)),this.ndk)}};function relayListFromKind3(r,t){try{const n=JSON.parse(t.content),s=new NDKRelayList$1(r),o=new Set,a=new Set;for(let[c,f]of Object.entries(n)){try{c=normalizeRelayUrl$1(c)}catch{continue}if(!f)o.add(c),a.add(c);else{const g=f;g.write&&a.add(c),g.read&&o.add(c)}}return s.readRelayUrls=Array.from(o),s.writeRelayUrls=Array.from(a),s}catch{}}var NDKRepost$1=class no extends NDKEvent$1{_repostedEvents;static kinds=[6,16];static from(t){return new no(t.ndk,t.rawEvent())}async repostedEvents(t,n){const s=[];if(!this.ndk)throw new Error("NDK instance not set");if(this._repostedEvents!==void 0)return this._repostedEvents;for(const o of this.repostedEventIds()){const a=filterForId$1(o),c=await this.ndk.fetchEvent(a,n);c&&s.push(t?t.from(c):c)}return s}repostedEventIds(){return this.tags.filter(t=>t[0]==="e"||t[0]==="a").map(t=>t[1])}};function filterForId$1(r){if(r.match(/:/)){const[t,n,s]=r.split(":");return{kinds:[Number.parseInt(t)],authors:[n],"#d":[s]}}return{ids:[r]}}var NDKSimpleGroupMemberList$1=class io extends NDKEvent$1{relaySet;memberSet=new Set;static kind=39002;static kinds=[39002];constructor(t,n){super(t,n),this.kind??=39002,this.memberSet=new Set(this.members)}static from(t){return new io(t.ndk,t)}get members(){return this.getMatchingTags("p").map(t=>t[1])}hasMember(t){return this.memberSet.has(t)}async publish(t,n,s){return t??=this.relaySet,super.publishReplaceable(t,n,s)}},NDKSimpleGroupMetadata$1=class so extends NDKEvent$1{static kind=39e3;static kinds=[39e3];constructor(t,n){super(t,n),this.kind??=39e3}static from(t){return new so(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}};function strToPosition$1(r){const[t,n]=r.split(",").map(Number);return{x:t,y:n}}function strToDimension$1(r){const[t,n]=r.split("x").map(Number);return{width:t,height:n}}var NDKStorySticker$1=class oo{static Text="text";static Pubkey="pubkey";static Event="event";static Prompt="prompt";static Countdown="countdown";type;value;position;dimension;properties;constructor(t){if(Array.isArray(t)){const n=t;if(n[0]!=="sticker"||n.length<5)throw new Error("Invalid sticker tag");this.type=n[1],this.value=n[2],this.position=strToPosition$1(n[3]),this.dimension=strToDimension$1(n[4]);const s={};for(let o=5;o<n.length;o++){const[a,...c]=n[o].split(" ");s[a]=c.join(" ")}Object.keys(s).length>0&&(this.properties=s)}else this.type=t,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(t){try{return new oo(t)}catch{return null}}get style(){return this.properties?.style}set style(t){t?this.properties={...this.properties,style:t}:delete this.properties?.style}get rotation(){return this.properties?.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(t){t!==void 0?this.properties={...this.properties,rot:t.toString()}:delete this.properties?.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}hasValidDimensions=()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height);hasValidPosition=()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y);toTag(){if(!this.isValid){const s=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${s.join(", ")}`)}let t;switch(this.type){case"event":t=this.value.tagId();break;case"pubkey":t=this.value.pubkey;break;default:t=this.value}const n=["sticker",this.type,t,coordinates$1(this.position),dimension$1(this.dimension)];if(this.properties)for(const[s,o]of Object.entries(this.properties))n.push(`${s} ${o}`);return n}},NDKStory$1=class ao extends NDKEvent$1{static kind=23;static kinds=[23];_imeta;_dimensions;constructor(t,n){if(super(t,n),this.kind??=23,n)for(const s of n.tags)switch(s[0]){case"imeta":this._imeta=mapImetaTag$1(s);break;case"dim":this.dimensions=strToDimension$1(s[1]);break}}static from(t){return new ao(t.ndk,t)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(t){this._imeta=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),t&&this.tags.push(imetaTagToTag$1(t))}get dimensions(){const t=this.tagValue("dim");if(t)return strToDimension$1(t)}set dimensions(t){this.removeTag("dim"),t&&this.tags.push(["dim",`${t.width}x${t.height}`])}get duration(){const t=this.tagValue("dur");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("dur"),t!==void 0&&this.tags.push(["dur",t.toString()])}get stickers(){const t=[];for(const n of this.tags){if(n[0]!=="sticker"||n.length<5)continue;const s=NDKStorySticker$1.fromTag(n);s&&t.push(s)}return t}addSticker(t){let n;if(t instanceof NDKStorySticker$1)n=t;else{const s=["sticker",t.type,typeof t.value=="string"?t.value:"",coordinates$1(t.position),dimension$1(t.dimension)];if(t.properties)for(const[o,a]of Object.entries(t.properties))s.push(`${o} ${a}`);n=new NDKStorySticker$1(s),n.value=t.value}n.type==="pubkey"?this.tag(n.value):n.type==="event"&&this.tag(n.value),this.tags.push(n.toTag())}removeSticker(t){const n=this.stickers;if(t<0||t>=n.length)return;let s=0;for(let o=0;o<this.tags.length;o++)if(this.tags[o][0]==="sticker"){if(s===t){this.tags.splice(o,1);break}s++}}},coordinates$1=r=>`${r.x},${r.y}`,dimension$1=r=>`${r.width}x${r.height}`,NDKSubscriptionReceipt$1=class uo extends NDKEvent$1{debug;static kinds=[7003];constructor(t,n){super(t,n),this.kind??=7003,this.debug=t?.debug.extend("subscription-start")??createDebug2("ndk:subscription-start")}static from(t){return new uo(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser$1({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get subscriber(){const t=this.getMatchingTags("P")?.[0];return t?new NDKUser$1({pubkey:t[1]}):void 0}set subscriber(t){this.removeTag("P"),t&&this.tags.push(["P",t.pubkey])}set subscriptionStart(t){this.debug(`before setting subscription start: ${this.rawEvent}`),this.removeTag("e"),this.tag(t,"subscription",!0),this.debug(`after setting subscription start: ${this.rawEvent}`)}get tierName(){return this.getMatchingTags("tier")?.[0]?.[1]}get isValid(){const t=this.validPeriod;if(!t||t.start>t.end)return!1;const n=this.getMatchingTags("p"),s=this.getMatchingTags("P");return!(n.length!==1||s.length!==1)}get validPeriod(){const t=this.getMatchingTags("valid")?.[0];if(t)try{return{start:new Date(Number.parseInt(t[1])*1e3),end:new Date(Number.parseInt(t[2])*1e3)}}catch{return}}set validPeriod(t){this.removeTag("valid"),t&&this.tags.push(["valid",Math.floor(t.start.getTime()/1e3).toString(),Math.floor(t.end.getTime()/1e3).toString()])}get startPeriod(){return this.validPeriod?.start}get endPeriod(){return this.validPeriod?.end}isActive(t){t??=new Date;const n=this.validPeriod;return!(!n||t<n.start||t>n.end)}},possibleIntervalFrequencies$1=["daily","weekly","monthly","quarterly","yearly"];function newAmount$1(r,t,n){return["amount",r.toString(),t,n]}function parseTagToSubscriptionAmount$1(r){const t=Number.parseInt(r[1]);if(Number.isNaN(t)||t===void 0||t===null||t<=0)return;const n=r[2];if(n===void 0||n==="")return;const s=r[3];if(s!==void 0&&possibleIntervalFrequencies$1.includes(s))return{amount:t,currency:n,term:s}}var NDKSubscriptionTier$1=class lo extends NDKArticle$1{static kind=37001;static kinds=[37001];constructor(t,n){const s=n?.kind??37001;super(t,n),this.kind=s}static from(t){return new lo(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>parseTagToSubscriptionAmount$1(t)).filter(t=>t!==void 0)}addAmount(t,n,s){this.tags.push(newAmount$1(t,n,s))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},NDKSubscriptionStart$1=class co extends NDKEvent$1{debug;static kinds=[7001];constructor(t,n){super(t,n),this.kind??=7001,this.debug=t?.debug.extend("subscription-start")??createDebug2("ndk:subscription-start")}static from(t){return new co(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser$1({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get amount(){const t=this.getMatchingTags("amount")?.[0];if(t)return parseTagToSubscriptionAmount$1(t)}set amount(t){this.removeTag("amount"),t&&this.tags.push(newAmount$1(t.amount,t.currency,t.term))}get tierId(){const t=this.getMatchingTags("e")?.[0],n=this.getMatchingTags("a")?.[0];if(!(!t||!n))return t[1]??n[1]}set tier(t){this.removeTag("e"),this.removeTag("a"),this.removeTag("event"),t&&(this.tag(t),this.removeTag("p"),this.tags.push(["p",t.pubkey]),this.tags.push(["event",JSON.stringify(t.rawEvent())]))}async fetchTier(){const t=this.tagValue("event");if(t)try{const o=JSON.parse(t);return new NDKSubscriptionTier$1(this.ndk,o)}catch{this.debug("Failed to parse event tag")}const n=this.tierId;if(!n)return;const s=await this.ndk?.fetchEvent(n);if(s)return NDKSubscriptionTier$1.from(s)}get isValid(){return this.getMatchingTags("amount").length!==1?(this.debug("Invalid # of amount tag"),!1):this.amount?this.getMatchingTags("p").length!==1?(this.debug("Invalid # of p tag"),!1):this.recipient?!0:(this.debug("Invalid p tag"),!1):(this.debug("Invalid amount tag"),!1)}},NDKTask$1=class ho extends NDKEvent$1{static kind=1934;static kinds=[1934];constructor(t,n){super(t,n),this.kind=1934}static from(t){return new ho(t.ndk,t.rawEvent())}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get title(){return this.tagValue("title")}set project(t){this.removeTag("a"),this.tags.push(t.tagReference())}get projectSlug(){const t=this.getMatchingTags("a")[0];return t?t[1].split(/:/)?.[2]:void 0}},NDKThread$1=class fo extends NDKEvent$1{static kind=11;static kinds=[11];constructor(t,n){super(t,n),this.kind??=11}static from(t){return new fo(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}},NDKVideo$1=class po extends NDKEvent$1{static kind=21;static kinds=[34235,34236,22,21];_imetas;static from(t){return new po(t.ndk,t.rawEvent())}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get thumbnail(){let t;return this.imetas&&this.imetas.length>0&&(t=this.imetas[0].image?.[0]),t??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag$1),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag$1))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}async generateTags(){if(super.generateTags(),!this.kind&&this.imetas?.[0]?.dim){const[t,n]=this.imetas[0].dim.split("x"),s=t&&n&&Number.parseInt(t)<Number.parseInt(n);this.duration&&this.duration<120&&s?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const t=this.tagValue("duration");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("duration"),t!==void 0&&this.tags.push(["duration",Math.floor(t).toString()])}},NDKWiki$1=class go extends NDKArticle$1{static kind=30818;static kinds=[30818];static from(t){return new go(t.ndk,t.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(t){this.removeTag("a","defer"),this.tag(t,"defer")}},NDKWikiMergeRequest$1=class yo extends NDKEvent$1{static kinds=[818];static from(t){return new yo(t.ndk,t.rawEvent())}get targetId(){return this.tagValue("a")}set target(t){this.tags=this.tags.filter(n=>{if(n[0]==="a"||n[0]==="e"&&n[3]!=="source")return!0}),this.tag(t)}get sourceId(){return this.tagValue("e","source")}set source(t){this.removeTag("e","source"),this.tag(t,"source",!1,"e")}},registeredEventClasses$1=new Set;function wrapEvent$2(r){const t=new Map,s=[...[NDKImage$1,NDKVideo$1,NDKCashuMintList$1,NDKArticle$1,NDKHighlight$1,NDKDraft$1,NDKWiki$1,NDKWikiMergeRequest$1,NDKNutzap$1,NDKProject$1,NDKTask$1,NDKProjectTemplate$1,NDKSimpleGroupMemberList$1,NDKSimpleGroupMetadata$1,NDKSubscriptionTier$1,NDKSubscriptionStart$1,NDKSubscriptionReceipt$1,NDKList$1,NDKRelayList$1,NDKStory$1,NDKBlossomList$1,NDKFollowPack$1,NDKThread$1,NDKRepost$1,NDKClassified$1,NDKAppHandlerEvent$1,NDKDVMJobFeedback$1,NDKCashuMintAnnouncement$1,NDKFedimintMint$1,NDKMintRecommendation$1],...registeredEventClasses$1];for(const a of s)for(const c of a.kinds)t.set(c,a);const o=t.get(r.kind);return o?o.from(r):r}function checkMissingKind(r,t){(r.kind===void 0||r.kind===null)&&t("event-missing-kind",`Cannot sign event without 'kind'.

 Event data:
    content: ${r.content?`"${r.content.substring(0,50)}${r.content.length>50?"...":""}"`:"(empty)"}
    tags: ${r.tags.length} tag${r.tags.length!==1?"s":""}
    kind: ${r.kind} 

Set event.kind before signing.`,"Example: event.kind = 1; // for text note",!1)}function checkContentIsObject(r,t){if(typeof r.content=="object"){const n=JSON.stringify(r.content,null,2).substring(0,200);t("event-content-is-object",`Event content is an object. Content must be a string.

 Your content (${typeof r.content}):
${n}${JSON.stringify(r.content).length>200?"...":""}

 event.content = { ... }  // WRONG
 event.content = JSON.stringify({ ... })  // CORRECT`,"Use JSON.stringify() for structured data: event.content = JSON.stringify(data)",!1)}}function checkCreatedAtMilliseconds(r,t){if(r.created_at&&r.created_at>1e10){const n=Math.floor(r.created_at/1e3),s=new Date(r.created_at).toISOString();t("event-created-at-milliseconds",`Event created_at is in milliseconds, not seconds.

 Your value:
    created_at: ${r.created_at} 
    Interpreted as: ${s}
    Should be: ${n} 

Nostr timestamps MUST be in seconds since Unix epoch.`,"Use Math.floor(Date.now() / 1000) instead of Date.now()",!1)}}function checkInvalidPTags(r,t){r.getMatchingTags("p").forEach((s,o)=>{if(s[1]&&!/^[0-9a-f]{64}$/i.test(s[1])){const a=JSON.stringify(s);t("tag-invalid-p-tag",`p-tag[${o}] has invalid pubkey.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"
    Length: ${s[1].length} (expected 64)
    Format: ${s[1].startsWith("npub")?"bech32 (npub)":"unknown"}

p-tags MUST contain 64-character hex pubkeys.`,s[1].startsWith("npub")?`Use ndkUser.pubkey instead of npub:
    event.tags.push(['p', ndkUser.pubkey])
    event.tags.push(['p', 'npub1...'])`:"p-tags must contain valid hex pubkeys (64 characters, 0-9a-f)",!1)}})}function checkInvalidETags(r,t){r.getMatchingTags("e").forEach((s,o)=>{if(s[1]&&!/^[0-9a-f]{64}$/i.test(s[1])){const a=JSON.stringify(s),c=s[1].startsWith("note")||s[1].startsWith("nevent");t("tag-invalid-e-tag",`e-tag[${o}] has invalid event ID.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"
    Length: ${s[1].length} (expected 64)
    Format: ${c?"bech32 (note/nevent)":"unknown"}

e-tags MUST contain 64-character hex event IDs.`,c?`Use event.id instead of bech32:
    event.tags.push(['e', referencedEvent.id])
    event.tags.push(['e', 'note1...'])`:"e-tags must contain valid hex event IDs (64 characters, 0-9a-f)",!1)}})}function checkManualReplyMarkers(r,t,n){if(r.kind!==1||n.has(r))return;const s=r.tags.filter(o=>o[0]==="e"&&(o[3]==="reply"||o[3]==="root"));if(s.length>0){const o=s.map((a,c)=>`   ${c+1}. ${JSON.stringify(a)}`).join(`
`);t("event-manual-reply-markers",`Event has ${s.length} e-tag(s) with manual reply/root markers.

 Your tags with markers:
${o}

  Manual reply markers detected! This will cause incorrect threading.`,`Reply events MUST be created using .reply():

    CORRECT:
   const replyEvent = originalEvent.reply();
   replyEvent.content = 'good point!';
   await replyEvent.publish();

    WRONG:
   event.tags.push(['e', eventId, '', 'reply']);

NDK handles all reply threading automatically - never add reply/root markers manually.`)}}function checkHashtagsWithPrefix(r,t){r.getMatchingTags("t").forEach((s,o)=>{if(s[1]&&s[1].startsWith("#")){const a=JSON.stringify(s);t("tag-hashtag-with-prefix",`t-tag[${o}] contains hashtag with # prefix.

 Your tag:
   ${a}

 Invalid value: "${s[1]}"

Hashtag tags should NOT include the # symbol.`,`Remove the # prefix from hashtag tags:
    event.tags.push(['t', 'nostr'])
    event.tags.push(['t', '#nostr'])`,!1)}})}function checkReplaceableWithOldTimestamp(r,t){if(r.kind===void 0||r.kind===null||!r.created_at||!r.isReplaceable())return;const n=Math.floor(Date.now()/1e3),s=n-r.created_at;if(s>10){const a=Math.floor(s/60),c=a>0?`${a} minute${a!==1?"s":""}`:`${s} seconds`;t("event-replaceable-old-timestamp",`Publishing a replaceable event with an old created_at timestamp.

 Event details:
    kind: ${r.kind} (replaceable)
    created_at: ${r.created_at}
    age: ${c} old
    current time: ${n}

  This is wrong and will be rejected by relays.`,`For replaceable events, use publishReplaceable():

    CORRECT:
   await event.publishReplaceable();
   // Automatically updates created_at to now

    WRONG:
   await event.publish();
   // Uses old created_at`)}}function signing(r,t,n,s){checkMissingKind(r,t),checkContentIsObject(r,t),checkCreatedAtMilliseconds(r,t),checkInvalidPTags(r,t),checkInvalidETags(r,t),checkHashtagsWithPrefix(r,t),checkManualReplyMarkers(r,n,s)}function publishing(r,t){checkReplaceableWithOldTimestamp(r,t)}function isNip33Pattern(r){const t=Array.isArray(r)?r:[r];if(t.length!==1)return!1;const n=t[0];return n.kinds&&Array.isArray(n.kinds)&&n.kinds.length===1&&n.authors&&Array.isArray(n.authors)&&n.authors.length===1&&n["#d"]&&Array.isArray(n["#d"])&&n["#d"].length===1}function isReplaceableEventFilter(r){const t=Array.isArray(r)?r:[r];return t.length===0?!1:t.every(n=>!n.kinds||!Array.isArray(n.kinds)||n.kinds.length===0||!n.authors||!Array.isArray(n.authors)||n.authors.length===0?!1:n.kinds.every(o=>o===0||o===3||o>=1e4&&o<=19999))}function formatFilter(r){return JSON.stringify(r,null,2).split(`
`).map((n,s)=>s===0?n:`   ${n}`).join(`
`)}function fetchingEvents(r,t,n,s,o){if(o(),t?.cacheUsage==="ONLY_CACHE")return;const a=Array.isArray(r)?r:[r],c=a.map(formatFilter).join(`

   ---

   `);if(isNip33Pattern(r))a[0],n("fetch-events-usage",`For fetching a NIP-33 addressable event, use fetchEvent() with the naddr directly.

 Your filter:
   `+c+`

   BAD:  const decoded = nip19.decode(naddr);
           const events = await ndk.fetchEvents({
             kinds: [decoded.data.kind],
             authors: [decoded.data.pubkey],
             "#d": [decoded.data.identifier]
           });
           const event = Array.from(events)[0];

   GOOD: const event = await ndk.fetchEvent(naddr);
   GOOD: const event = await ndk.fetchEvent('naddr1...');

fetchEvent() handles naddr decoding automatically and returns the event directly.`);else{if(isReplaceableEventFilter(r))return;{if(!s())return;let f="";const g=a.some(L=>L.limit!==void 0),b=new Set(a.flatMap(L=>L.kinds||[])).size,_=new Set(a.flatMap(L=>L.authors||[])).size;if(g){const L=Math.max(...a.map(q=>q.limit||0));f+=`
    Limit: ${L} event${L!==1?"s":""}`}b>0&&(f+=`
    Kinds: ${b} type${b!==1?"s":""}`),_>0&&(f+=`
    Authors: ${_} author${_!==1?"s":""}`),n("fetch-events-usage",`fetchEvents() is a BLOCKING operation that waits for EOSE.
In most cases, you should use subscribe() instead.

 Your filter`+(a.length>1?"s":"")+`:
   `+c+(f?`

 Filter analysis:`+f:"")+`

   BAD:  const events = await ndk.fetchEvents(filter);
   GOOD: ndk.subscribe(filter, { onEvent: (e) => ... });

Only use fetchEvents() when you MUST block until data arrives.`,"For one-time queries, use fetchEvent() instead of fetchEvents() when expecting a single result.")}}}var GuardrailCheckId={NDK_NO_CACHE:"ndk-no-cache",FILTER_BECH32_IN_ARRAY:"filter-bech32-in-array",FILTER_INVALID_HEX:"filter-invalid-hex",FILTER_ONLY_LIMIT:"filter-only-limit",FILTER_EMPTY:"filter-empty",FILTER_SINCE_AFTER_UNTIL:"filter-since-after-until",FILTER_INVALID_A_TAG:"filter-invalid-a-tag",FILTER_HASHTAG_WITH_PREFIX:"filter-hashtag-with-prefix"};function checkCachePresence(r,t){t(GuardrailCheckId.NDK_NO_CACHE)&&setTimeout(()=>{if(!r.cacheAdapter){const o=`
 AI_GUARDRAILS WARNING: NDK initialized without a cache adapter. Apps perform significantly better with caching.

 ${typeof window<"u"?"Consider using @nostr-dev-kit/ndk-cache-dexie or @nostr-dev-kit/ndk-cache-sqlite-wasm":"Consider using @nostr-dev-kit/ndk-cache-redis or @nostr-dev-kit/ndk-cache-sqlite"}

 To disable this check:
   ndk.aiGuardrails.skip('${GuardrailCheckId.NDK_NO_CACHE}')
   or set: ndk.aiGuardrails = { skip: new Set(['${GuardrailCheckId.NDK_NO_CACHE}']) }`;console.warn(o)}},2500)}var AIGuardrails=class{enabled=!1;skipSet=new Set;extensions=new Map;_nextCallDisabled=null;_replyEvents=new WeakSet;_fetchEventsCount=0;_subscribeCount=0;constructor(r=!1){this.setMode(r)}register(r,t){this.extensions.has(r)&&console.warn(`AIGuardrails: Extension '${r}' already registered, overwriting`);const n={};for(const[s,o]of Object.entries(t))typeof o=="function"&&(n[s]=(...a)=>{this.enabled&&o(...a,this.shouldCheck.bind(this),this.error.bind(this),this.warn.bind(this))});this.extensions.set(r,n),this[r]=n}setMode(r){typeof r=="boolean"?(this.enabled=r,this.skipSet.clear()):r&&typeof r=="object"&&(this.enabled=!0,this.skipSet=r.skip||new Set)}isEnabled(){return this.enabled}shouldCheck(r){return!(!this.enabled||this.skipSet.has(r)||this._nextCallDisabled==="all"||this._nextCallDisabled&&this._nextCallDisabled.has(r))}skip(r){this.skipSet.add(r)}enable(r){this.skipSet.delete(r)}getSkipped(){return Array.from(this.skipSet)}captureAndClearNextCallDisabled(){const r=this._nextCallDisabled;return this._nextCallDisabled=null,r}incrementFetchEventsCount(){this._fetchEventsCount++}incrementSubscribeCount(){this._subscribeCount++}shouldWarnAboutFetchEventsRatio(){const r=this._fetchEventsCount+this._subscribeCount;return r<=6?!1:this._fetchEventsCount/r>.5}error(r,t,n,s=!0){if(!this.shouldCheck(r))return;const o=this.formatMessage(r,"ERROR",t,n,s);throw console.error(o),new Error(o)}warn(r,t,n){if(!this.shouldCheck(r))return;const s=this.formatMessage(r,"WARNING",t,n,!0);throw console.error(s),new Error(s)}formatMessage(r,t,n,s,o=!0){let a=`
 AI_GUARDRAILS ${t}: ${n}`;return s&&(a+=`

 ${s}`),o&&(a+=`

 To disable this check:
   ndk.guardrailOff('${r}').yourMethod()  // For one call`,a+=`
   ndk.aiGuardrails.skip('${r}')  // Permanently`,a+=`
   or set: ndk.aiGuardrails = { skip: new Set(['${r}']) }`),a}ndkInstantiated(r){this.enabled&&checkCachePresence(r,this.shouldCheck.bind(this))}ndk={fetchingEvents:(r,t)=>{this.enabled&&fetchingEvents(r,t,this.warn.bind(this),this.shouldWarnAboutFetchEventsRatio.bind(this),this.incrementFetchEventsCount.bind(this))}};event={signing:r=>{this.enabled&&signing(r,this.error.bind(this),this.warn.bind(this),this._replyEvents)},publishing:r=>{this.enabled&&publishing(r,this.warn.bind(this))},received:(r,t)=>{this.enabled},creatingReply:r=>{this.enabled&&this._replyEvents.add(r)}};subscription={created:(r,t)=>{this.enabled&&this.incrementSubscribeCount()}};relay={connected:r=>{this.enabled}}};function processFilters(r,t="validate",n,s){if(t==="ignore")return r;const o=[],a=r.map((c,f)=>(s?.aiGuardrails.isEnabled()&&runAIGuardrailsForFilter(c,f,s),processFilter(c,t,f,o,n)));if(t==="validate"&&o.length>0)throw new Error(`Invalid filter(s) detected:
${o.join(`
`)}`);return a}function processFilter(r,t,n,s,o){const a=t==="validate",c=a?r:{...r};if(r.ids){const f=[];r.ids.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].ids[${b}] is undefined`):o?.(`Fixed: Removed undefined value at ids[${b}]`):typeof g!="string"?a?s.push(`Filter[${n}].ids[${b}] is not a string (got ${typeof g})`):o?.(`Fixed: Removed non-string value at ids[${b}] (was ${typeof g})`):isValidHex64$1(g)?f.push(g):a?s.push(`Filter[${n}].ids[${b}] is not a valid 64-char hex string: "${g}"`):o?.(`Fixed: Removed invalid hex string at ids[${b}]`)}),a||(c.ids=f.length>0?f:void 0)}if(r.authors){const f=[];r.authors.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].authors[${b}] is undefined`):o?.(`Fixed: Removed undefined value at authors[${b}]`):typeof g!="string"?a?s.push(`Filter[${n}].authors[${b}] is not a string (got ${typeof g})`):o?.(`Fixed: Removed non-string value at authors[${b}] (was ${typeof g})`):isValidHex64$1(g)?f.push(g):a?s.push(`Filter[${n}].authors[${b}] is not a valid 64-char hex pubkey: "${g}"`):o?.(`Fixed: Removed invalid hex pubkey at authors[${b}]`)}),a||(c.authors=f.length>0?f:void 0)}if(r.kinds){const f=[];r.kinds.forEach((g,b)=>{g===void 0?a?s.push(`Filter[${n}].kinds[${b}] is undefined`):o?.(`Fixed: Removed undefined value at kinds[${b}]`):typeof g!="number"?a?s.push(`Filter[${n}].kinds[${b}] is not a number (got ${typeof g})`):o?.(`Fixed: Removed non-number value at kinds[${b}] (was ${typeof g})`):Number.isInteger(g)?g<0||g>65535?a?s.push(`Filter[${n}].kinds[${b}] is out of valid range (0-65535): ${g}`):o?.(`Fixed: Removed out-of-range kind at kinds[${b}]: ${g}`):f.push(g):a?s.push(`Filter[${n}].kinds[${b}] is not an integer: ${g}`):o?.(`Fixed: Removed non-integer value at kinds[${b}]: ${g}`)}),a||(c.kinds=f.length>0?f:void 0)}for(const f in r)if(f.startsWith("#")&&f.length===2){const g=r[f];if(Array.isArray(g)){const b=[];g.forEach((_,L)=>{_===void 0?a?s.push(`Filter[${n}].${f}[${L}] is undefined`):o?.(`Fixed: Removed undefined value at ${f}[${L}]`):typeof _!="string"?a?s.push(`Filter[${n}].${f}[${L}] is not a string (got ${typeof _})`):o?.(`Fixed: Removed non-string value at ${f}[${L}] (was ${typeof _})`):(f==="#e"||f==="#p")&&!isValidHex64$1(_)?a?s.push(`Filter[${n}].${f}[${L}] is not a valid 64-char hex string: "${_}"`):o?.(`Fixed: Removed invalid hex string at ${f}[${L}]`):b.push(_)}),a||(c[f]=b.length>0?b:void 0)}}return a||Object.keys(c).forEach(f=>{c[f]===void 0&&delete c[f]}),c}function runAIGuardrailsForFilter(r,t,n){const s=n.aiGuardrails,o=JSON.stringify(r,null,2);if(Object.keys(r).length===1&&r.limit!==void 0&&s.error(GuardrailCheckId.FILTER_ONLY_LIMIT,`Filter[${t}] contains only 'limit' without any filtering criteria.

 Your filter:
${o}

  This will fetch random events from relays without any criteria.`,`Add filtering criteria:
    { kinds: [1], limit: 10 }
    { authors: [pubkey], limit: 10 }
    { limit: 10 }`),Object.keys(r).length===0&&s.error(GuardrailCheckId.FILTER_EMPTY,`Filter[${t}] is empty.

 Your filter:
${o}

  This will request ALL events from relays, which is never what you want.`,"Add filtering criteria like 'kinds', 'authors', or tags.",!1),r.since!==void 0&&r.until!==void 0&&r.since>r.until){const c=new Date(r.since*1e3).toISOString(),f=new Date(r.until*1e3).toISOString();s.error(GuardrailCheckId.FILTER_SINCE_AFTER_UNTIL,`Filter[${t}] has 'since' AFTER 'until'.

 Your filter:
${o}

 since: ${r.since} (${c})
 until: ${r.until} (${f})

No events can match this time range!`,"'since' must be BEFORE 'until'. Both are Unix timestamps in seconds.",!1)}const a=/^n(addr|event|ote|pub|profile)1/;r.ids&&r.ids.forEach((c,f)=>{typeof c=="string"&&(a.test(c)?s.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${t}].ids[${f}] contains bech32: "${c}". IDs must be hex, not bech32.`,'Use filterFromId() to decode bech32 first: import { filterFromId } from "@nostr-dev-kit/ndk"',!1):isValidHex64$1(c)||s.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${t}].ids[${f}] is not a valid 64-char hex string: "${c}"`,`Event IDs must be 64-character hexadecimal strings. Invalid IDs often come from corrupted data in user-generated lists. Always validate hex strings before using them in filters:

   const validIds = ids.filter(id => /^[0-9a-f]{64}$/i.test(id));`,!1))}),r.authors&&r.authors.forEach((c,f)=>{typeof c=="string"&&(a.test(c)?s.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${t}].authors[${f}] contains bech32: "${c}". Authors must be hex pubkeys, not npub.`,"Use ndkUser.pubkey instead. Example: { authors: [ndkUser.pubkey] }",!1):isValidHex64$1(c)||s.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${t}].authors[${f}] is not a valid 64-char hex pubkey: "${c}"`,`Kind:3 follow lists can contain invalid entries like labels ("Follow List"), partial strings ("highlig"), or other corrupted data. You MUST validate all pubkeys before using them in filters.

   Example:
   const validPubkeys = pubkeys.filter(p => /^[0-9a-f]{64}$/i.test(p));
   ndk.subscribe({ authors: validPubkeys, kinds: [1] });`,!1))});for(const c in r)if(c.startsWith("#")&&c.length===2){const f=r[c];Array.isArray(f)&&f.forEach((g,b)=>{typeof g=="string"&&(c==="#e"||c==="#p")&&(a.test(g)?s.error(GuardrailCheckId.FILTER_BECH32_IN_ARRAY,`Filter[${t}].${c}[${b}] contains bech32: "${g}". Tag values must be decoded.`,"Use filterFromId() or nip19.decode() to get the hex value first.",!1):isValidHex64$1(g)||s.error(GuardrailCheckId.FILTER_INVALID_HEX,`Filter[${t}].${c}[${b}] is not a valid 64-char hex string: "${g}"`,`${c==="#e"?"Event IDs":"Public keys"} in tag filters must be 64-character hexadecimal strings. Kind:3 follow lists and other user-generated content can contain invalid data. Always filter before using:

   const validValues = values.filter(v => /^[0-9a-f]{64}$/i.test(v));`,!1))})}r["#a"]&&r["#a"]?.forEach((f,g)=>{if(typeof f=="string")if(!/^\d+:[0-9a-f]{64}:.*$/.test(f))s.error(GuardrailCheckId.FILTER_INVALID_A_TAG,`Filter[${t}].#a[${g}] has invalid format: "${f}". Must be "kind:pubkey:d-tag".`,'Example: "30023:fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52:my-article"',!1);else{const b=Number.parseInt(f.split(":")[0],10);(b<3e4||b>39999)&&s.error(GuardrailCheckId.FILTER_INVALID_A_TAG,`Filter[${t}].#a[${g}] uses non-addressable kind ${b}: "${f}". #a filters are only for addressable events (kinds 30000-39999).`,`Addressable events include:
    30000-30039: Parameterized Replaceable Events (profiles, settings, etc.)
    30040-39999: Other addressable events

For regular events (kind ${b}), use:
    #e filter for specific event IDs
    kinds + authors filters for event queries`,!1)}}),r["#t"]&&r["#t"]?.forEach((f,g)=>{typeof f=="string"&&f.startsWith("#")&&s.error(GuardrailCheckId.FILTER_HASHTAG_WITH_PREFIX,`Filter[${t}].#t[${g}] contains hashtag with # prefix: "${f}". Hashtag values should NOT include the # symbol.`,`Remove the # prefix from hashtag filters:
    { "#t": ["nostr"] }
    { "#t": ["#nostr"] }`,!1)})}function queryFullyFilled(r){return!!(filterIncludesIds(r.filter)&&resultHasAllRequestedIds(r))}function filterIncludesIds(r){return!!r.ids}function resultHasAllRequestedIds(r){const t=r.filter.ids;return!!t&&t.length===r.eventFirstSeen.size}function filterFromId(r){let t;if(r.match(NIP33_A_REGEX)){const[n,s,o]=r.split(":"),a={authors:[s],kinds:[Number.parseInt(n)]};return o&&(a["#d"]=[o]),a}if(r.match(BECH32_REGEX$2))try{switch(t=nip19_exports$3.decode(r),t.type){case"nevent":{const n={ids:[t.data.id]};return t.data.author&&(n.authors=[t.data.author]),t.data.kind&&(n.kinds=[t.data.kind]),n}case"note":return{ids:[t.data]};case"naddr":{const n={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(n["#d"]=[t.data.identifier]),n}}}catch(n){console.error("Error decoding",r,n)}return{ids:[r]}}function isNip33AValue(r){return r.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX$2=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(r,t){try{const n=nip19_exports$3.decode(r);if(["naddr","nevent"].includes(n?.type)){const s=n.data;if(s?.relays)return s.relays.map(o=>new NDKRelay$1(o,t.relayAuthDefaultPolicy,t))}}catch{}return[]}var NDKSubscriptionCacheUsage$1=(r=>(r.ONLY_CACHE="ONLY_CACHE",r.CACHE_FIRST="CACHE_FIRST",r.PARALLEL="PARALLEL",r.ONLY_RELAY="ONLY_RELAY",r))(NDKSubscriptionCacheUsage$1||{}),defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"],includeMuted:!1},NDKSubscription=class extends libExports$1.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;exclusiveRelay=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;mostRecentCacheEventTimestamp;internalId;closeOnEose;poolMonitor;skipOptimisticPublishEvent=!1;cacheUnconstrainFilter;constructor(r,t,n,s){super(),this.ndk=r,this.opts={...defaultOpts,...n||{}},this.pool=this.opts.pool||r.pool;const o=Array.isArray(t)?t:[t],a=r.filterValidationMode==="validate"?"validate":r.filterValidationMode==="fix"?"fix":"ignore";if(this.filters=processFilters(o,a,r.debug,r),this.filters.length===0)throw new Error("Subscription must have at least one filter");this.subId=s||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=r.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet$1.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter,this.exclusiveRelay=this.opts.exclusiveRelay||!1,this.opts.onEvent&&this.on("event",this.opts.onEvent),this.opts.onEose&&this.on("eose",this.opts.onEose),this.opts.onClose&&this.on("close",this.opts.onClose)}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters?.keys()).filter(t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return this.opts.addSinceFromCache?!0:this.opts?.cacheUsage==="ONLY_RELAY"?!1:(this.filters.some(t=>t.kinds?.some(n=>kindIsEphemeral(n))),!0)}shouldQueryRelays(){return this.opts?.cacheUsage!=="ONLY_CACHE"}shouldWaitForCache(){return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&this.opts.cacheUsage!=="PARALLEL"}start(r=!0){let t;const n=o=>{for(const a of o)a.created_at&&(!this.mostRecentCacheEventTimestamp||a.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=a.created_at),this.eventReceived(a,void 0,!0,!1);r||(t=o)},s=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(t=this.startWithCache(),t instanceof Promise?this.shouldWaitForCache()?(t.then(o=>{if(n(o),queryFullyFilled(this)){this.emit("eose",this);return}s()}),null):(t.then(o=>{n(o),this.shouldQueryRelays()||this.emit("eose",this)}),this.shouldQueryRelays()&&s(),null):(n(t),queryFullyFilled(this)?this.emit("eose",this):s(),t)):(s(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=r=>{if(this.relayFilters?.has(r.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor).get(r.url)&&(this.relayFilters?.set(r.url,this.filters),r.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}onStopped;stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.onStopped?.()}hasAuthorsFilter(){return this.filters.some(r=>r.authors?.length)}startWithCache(){return this.ndk.cacheAdapter?.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let r=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const t=this.mostRecentCacheEventTimestamp+1;r=r.map(n=>({...n,since:Math.max(n.since||0,t)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,r,this.pool,this.opts.relayGoalPerAuthor);else{this.relayFilters=new Map;for(const t of this.relaySet.relays)this.relayFilters.set(t.url,r)}for(const[t,n]of this.relayFilters)this.pool.getRelay(t,!0,!0,n).subscribe(this,n)}refreshRelayConnections(){if(this.relaySet&&this.relaySet.relays.size>0)return;const r=calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool,this.opts.relayGoalPerAuthor);for(const[t,n]of r)this.relayFilters?.has(t)||(this.relayFilters?.set(t,n),this.pool.getRelay(t,!0,!0,n).subscribe(this,n))}eventReceived(r,t,n=!1,s=!1){const o=r.id,a=this.eventFirstSeen.has(o);let c;if(r instanceof NDKEvent$1&&(c=r),a){const f=Date.now()-(this.eventFirstSeen.get(o)||0);if(this.emit("event:dup",r,t,f,this,n,s),this.opts?.onEventDup&&this.opts.onEventDup(r,t,f,this,n,s),!n&&!s&&t&&this.ndk.cacheAdapter?.setEventDup&&!this.opts.dontSaveToCache&&(c??=r instanceof NDKEvent$1?r:new NDKEvent$1(this.ndk,r),this.ndk.cacheAdapter.setEventDup(c,t)),t){const g=verifiedSignatures$1.get(o);if(g&&typeof g=="string")if(r.sig===g)t.addValidatedEvent();else{const b=r instanceof NDKEvent$1?r:new NDKEvent$1(this.ndk,r);this.ndk.reportInvalidSignature(b,t)}}}else{if(c??=new NDKEvent$1(this.ndk,r),c.ndk=this.ndk,c.relay=t,!n&&!s){if(!this.skipValidation&&!c.isValid){this.debug("Event failed validation %s from relay %s",o,t?.url);return}if(t)if(t.shouldValidateEvent()&&!this.skipVerification)if(c.relay=t,this.ndk.asyncSigVerification)c.verifySignature(!0);else{if(!c.verifySignature(!0)){this.debug("Event failed signature validation",r),this.ndk.reportInvalidSignature(c,t);return}t.addValidatedEvent()}else t.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(c,this.filters,t)}if(!this.opts.includeMuted&&this.ndk.muteFilter&&this.ndk.muteFilter(c)){this.debug("Event muted, skipping");return}(!s||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(this.opts?.wrap??!1,c,t,n,s),this.eventFirstSeen.set(o,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(r,t,n,s,o){const a=r?wrapEvent$2(t):t;a instanceof Promise?a.then(c=>this.emitEvent(!1,c,n,s,o)):a&&this.emit("event",a,n,this,s,o)}closedReceived(r,t){this.emit("closed",r,t)}eoseTimeout;eosed=!1;eoseReceived(r){this.debug("EOSE received from %s",r.url),this.eosesSeen.add(r);let t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const n=this.eosesSeen.size===this.relayFilters?.size,s=queryFullyFilled(this),o=a=>{this.debug("Performing EOSE: %s %d",a,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,this.opts?.closeOnEose&&this.stop())};if(s||n)o("query filled or seen all");else if(this.relayFilters){let a=1e3;const c=new Set(this.pool.connectedRelays().map(b=>b.url)),f=Array.from(this.relayFilters.keys()).filter(b=>c.has(b));if(f.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const g=this.eosesSeen.size/f.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:g,seen:this.eosesSeen.size,total:f.length}),this.eosesSeen.size>=2&&g>=.5){if(a=a*(1-g),a===0){o("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const b=()=>{t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,t!==void 0&&t<20?this.eoseTimeout=setTimeout(b,a):o(`send eose timeout: ${a}`)};this.eoseTimeout=setTimeout(b,a)}}}},kindIsEphemeral=r=>r>=2e4&&r<3e4;async function follows$1(r,t,n=3){if(!this.ndk)throw new Error("NDK not set");const s=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},r||{groupable:!1});if(s){const o=new Set;return s.tags.forEach(a=>{a[0]==="p"&&a[1]&&isValidPubkey$1(a[1])&&o.add(a[1])}),t&&this.ndk?.outboxTracker?.trackUsers(Array.from(o)),[...o].reduce((a,c)=>{const f=new NDKUser$1({pubkey:c});return f.ndk=this.ndk,a.add(f),a},new Set)}return new Set}var NIP05_REGEX$2=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For$1(r,t,n=fetch,s={}){return await r.queuesNip05.add({id:t,func:async()=>{if(r.cacheAdapter?.loadNip05){const g=await r.cacheAdapter.loadNip05(t);if(g!=="missing"){if(g){const b=new NDKUser$1({pubkey:g.pubkey,relayUrls:g.relays,nip46Urls:g.nip46});return b.ndk=r,b}if(s.cache!=="no-cache")return null}}const o=t.match(NIP05_REGEX$2);if(!o)return null;const[a,c="_",f]=o;try{const g=await n(`https://${f}/.well-known/nostr.json?name=${c}`,s),{names:b,relays:_,nip46:L}=parseNIP05Result$1(await g.json()),q=b[c.toLowerCase()];let X=null;return q&&(X={pubkey:q,relays:_?.[q],nip46:L?.[q]}),r?.cacheAdapter?.saveNip05&&r.cacheAdapter.saveNip05(t,X),X}catch(g){return r?.cacheAdapter?.saveNip05&&r?.cacheAdapter.saveNip05(t,null),console.error("Failed to fetch NIP05 for",t,g),null}}})}function parseNIP05Result$1(r){const t={names:{}};for(const[n,s]of Object.entries(r.names))typeof n=="string"&&typeof s=="string"&&(t.names[n.toLowerCase()]=s);if(r.relays){t.relays={};for(const[n,s]of Object.entries(r.relays))typeof n=="string"&&Array.isArray(s)&&(t.relays[n]=s.filter(o=>typeof o=="string"))}if(r.nip46){t.nip46={};for(const[n,s]of Object.entries(r.nip46))typeof n=="string"&&Array.isArray(s)&&(t.nip46[n]=s.filter(o=>typeof o=="string"))}return t}function profileFromEvent$1(r){const t={};let n;try{n=JSON.parse(r.content)}catch(s){throw new Error(`Failed to parse profile event: ${s}`)}t.profileEvent=JSON.stringify(r.rawEvent());for(const s of Object.keys(n))switch(s){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.picture=n.picture||n.image,t.image=t.picture;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"website":t.website=n.website;break;default:t[s]=n[s];break}return t.created_at=r.created_at,t}function serializeProfile$1(r){const t={};for(const[n,s]of Object.entries(r))switch(n){case"username":case"name":t.name=s;break;case"displayName":t.display_name=s;break;case"image":case"picture":t.picture=s;break;case"bio":case"about":t.about=s;break;default:t[n]=s;break}return JSON.stringify(t)}var NDKUser$1=class mo{ndk;profile;profileEvent;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){if(t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls),t.nprofile)try{const n=nip19_exports$3.decode(t.nprofile);n.type==="nprofile"&&(this._pubkey=n.data.pubkey,n.data.relays&&n.data.relays.length>0&&this.relayUrls.push(...n.data.relays))}catch(n){console.error("Failed to decode nprofile",n)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports$3.npubEncode(this.pubkey)}return this._npub}get nprofile(){const t=this.profileEvent?.onRelays?.map(n=>n.url);return nip19_exports$3.nprofileEncode({pubkey:this.pubkey,relays:t})}set npub(t){this._npub=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports$3.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}filter(){return{"#p":[this.pubkey]}}async getZapInfo(t){if(!this.ndk)throw new Error("No NDK instance found");const n=async c=>{if(!t)return c;let f;const g=new Promise((b,_)=>{f=setTimeout(()=>_(new Error("Timeout")),t)});try{const b=await Promise.race([c,g]);return f&&clearTimeout(f),b}catch(b){if(b instanceof Error&&b.message==="Timeout")try{return await c}catch{return}return}},[s,o]=await Promise.all([n(this.fetchProfile()),n(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),a=new Map;if(o){const c=NDKCashuMintList$1.from(o);c.mints.length>0&&a.set("nip61",{mints:c.mints,relays:c.relays,p2pk:c.p2pk})}if(s){const{lud06:c,lud16:f}=s;a.set("nip57",{lud06:c,lud16:f})}return a}static async fromNip05(t,n,s=!1){if(!n)throw new Error("No NDK instance found");const o={};s&&(o.cache="no-cache");const a=await getNip05For$1(n,t,n?.httpFetch,o);if(a){const c=new mo({pubkey:a.pubkey,relayUrls:a.relays,nip46Urls:a.nip46});return c.ndk=n,c}}async fetchProfile(t,n=!1){if(!this.ndk)throw new Error("NDK not set");let s=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&t?.cacheUsage!=="ONLY_RELAY"){let o=null;if(this.ndk.cacheAdapter.fetchProfileSync?o=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(o=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),o)return this.profile=o,o}return t??={},t.cacheUsage??="ONLY_RELAY",t.closeOnEose??=!0,t.groupable??=!0,t.groupableDelay??=250,s||(s=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},t)),s?(this.profile=profileFromEvent$1(s),n&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}follows=follows$1.bind(this);async followSet(t,n,s=3){const o=await this.follows(t,n,s);return new Set(Array.from(o).map(a=>a.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){const n=[["p",this.pubkey]];return t&&n[0].push("",t),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent$1(this.ndk,{kind:0,content:serializeProfile$1(this.profile)}).publish()}async follow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey;if(Array.from(n).some(f=>typeof f=="string"?f===o:f.pubkey===o))return!1;n.add(t);const c=new NDKEvent$1(this.ndk,{kind:s});for(const f of n)typeof f=="string"?c.tags.push(["p",f]):c.tag(f);return await c.publish(),!0}async unfollow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey,a=new Set;let c=!1;for(const g of n)(typeof g=="string"?g:g.pubkey)!==o?a.add(g):c=!0;if(!c)return!1;const f=new NDKEvent$1(this.ndk,{kind:s});for(const g of a)typeof g=="string"?f.tags.push(["p",g]):f.tag(g);return await f.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const n=await getNip05For$1(this.ndk,t);return n===null?null:n.pubkey===this.pubkey}},signerRegistry$1=new Map;function registerSigner$1(r,t){signerRegistry$1.set(r,t)}var NDKPrivateKeySigner$1=class Si{_user;_privateKey;_pubkey;constructor(t,n){if(typeof t=="string")if(t.startsWith("nsec1")){const{type:s,data:o}=nip19_exports$3.decode(t);if(s==="nsec")this._privateKey=o;else throw new Error("Invalid private key provided.")}else if(t.length===64)this._privateKey=hexToBytes$4(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._pubkey=getPublicKey$1(this._privateKey),n&&(this._user=n.getUser({pubkey:this._pubkey})),this._user??=new NDKUser$1({pubkey:this._pubkey})}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex$4(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports$3.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports$3.npubEncode(this._pubkey)}encryptToNcryptsec(t,n=16,s=2){if(!this._privateKey)throw new Error("Private key not available");return encrypt$5(this._privateKey,t,n,s)}static generate(){const t=generateSecretKey$1();return new Si(t)}static fromNcryptsec(t,n,s){const o=decrypt$5(t,n);return new Si(o,s)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent$1(t,this._privateKey).sig}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&n.push("nip04"),(!t||t==="nip44")&&n.push("nip44"),n}async encrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports$1.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports$1.v2.encrypt(n,a)}return await nip04_exports$1.encrypt(this._privateKey,o,n)}async decrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports$1.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports$1.v2.decrypt(n,a)}return await nip04_exports$1.decrypt(this._privateKey,o,n)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const t={type:"private-key",payload:this.privateKey};return JSON.stringify(t)}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${s.type}`);if(!s.payload||typeof s.payload!="string")throw new Error("Invalid payload content for private-key signer");return new Si(s.payload,n)}};registerSigner$1("private-key",NDKPrivateKeySigner$1);function proofsTotalBalance$1(r){return r.reduce((t,n)=>{if(n.amount<0)throw new Error("proof amount is negative");return t+n.amount},0)}var NDKCashuToken$1=class bo extends NDKEvent$1{_proofs=[];_mint;static kind=7375;static kinds=[7375];_deletes=[];original;constructor(t,n){super(t,n),this.kind??=7375}static async from(t){const n=new bo(t.ndk,t);n.original=t;try{await n.decrypt()}catch{n.content=n.original.content}try{const s=JSON.parse(n.content);if(n.proofs=s.proofs,n.mint=s.mint??n.tagValue("mint"),n.deletedTokens=s.del??[],!Array.isArray(n.proofs))return}catch{return}return n}get proofs(){return this._proofs}set proofs(t){const n=new Set;this._proofs=t.filter(s=>n.has(s.C)?(console.warn("Passed in proofs had duplicates, ignoring",s.C),!1):s.amount<0?(console.warn("Invalid proof with negative amount",s),!1):(n.add(s.C),!0)).map(this.cleanProof)}cleanProof(t){return{id:t.id,amount:t.amount,C:t.C,secret:t.secret}}async toNostrEvent(t){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const n={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(n);const s=await this.ndk.signer.user();return await this.encrypt(s,void 0,"nip44"),super.toNostrEvent(t)}set mint(t){this._mint=t}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(t){this._deletes=t}get amount(){return proofsTotalBalance$1(this.proofs)}async publish(t,n,s){return this.original?this.original.publish(t,n,s):super.publish(t,n,s)}},MARKERS$1={REDEEMED:"redeemed",CREATED:"created",DESTROYED:"destroyed",RESERVED:"reserved"},NDKCashuWalletTx$1=class wo extends NDKEvent$1{static MARKERS=MARKERS$1;static kind=7376;static kinds=[7376];constructor(t,n){super(t,n),this.kind??=7376}static async from(t){const n=new wo(t.ndk,t),s=n.content;try{await n.decrypt()}catch{n.content??=s}try{const o=JSON.parse(n.content);n.tags=[...o,...n.tags]}catch{return}return n}set direction(t){this.removeTag("direction"),t&&this.tags.push(["direction",t])}get direction(){return this.tagValue("direction")}set amount(t){this.removeTag("amount"),this.tags.push(["amount",t.toString()])}get amount(){const t=this.tagValue("amount");if(t!==void 0)return Number(t)}set fee(t){this.removeTag("fee"),this.tags.push(["fee",t.toString()])}get fee(){const t=this.tagValue("fee");if(t!==void 0)return Number(t)}set unit(t){this.removeTag("unit"),t&&this.tags.push(["unit",t.toString()])}get unit(){return this.tagValue("unit")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t.toString()])}get description(){return this.tagValue("description")}set mint(t){this.removeTag("mint"),t&&this.tags.push(["mint",t.toString()])}get mint(){return this.tagValue("mint")}set destroyedTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS$1.DESTROYED))}set destroyedTokenIds(t){for(const n of t)this.tags.push(["e",n,"",MARKERS$1.DESTROYED])}set createdTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS$1.CREATED))}set reservedTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS$1.RESERVED))}addRedeemedNutzap(t){this.tag(t,MARKERS$1.REDEEMED)}async toNostrEvent(t){const n=[],s=[];for(const a of this.tags)this.shouldEncryptTag(a)?n.push(a):s.push(a);this.tags=s.filter(a=>a[0]!=="client"),this.content=JSON.stringify(n);const o=await this.ndk?.signer?.user();if(o){const a=o.pubkey;this.tags=this.tags.filter(c=>c[0]!=="p"||c[1]!==a)}return await this.encrypt(o,void 0,"nip44"),super.toNostrEvent(t)}get hasNutzapRedemption(){return this.getMatchingTags("e",MARKERS$1.REDEEMED).length>0}shouldEncryptTag(t){return!(["client"].includes(t[0])||t[0]==="e"&&t[3]===MARKERS$1.REDEEMED||t[0]==="p")}};function dedup(r,t){return r.created_at>t.created_at?r:t}async function getRelayListForUser(r,t){return(await getRelayListForUsers([r],t)).get(r)}async function getRelayListForUsers(r,t,n=!1,s=1e3,o){const a=t.outboxPool||t.pool,c=new Set;for(const q of a.relays.values())c.add(q);if(o)for(const q of o.values())for(const X of q){const te=a.getRelay(X,!0,!0);te&&c.add(te)}const f=new Map,g=new Map,b=new NDKRelaySet$1(c,t);if(t.cacheAdapter?.locking&&!n){const q=await t.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(r))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const X of q)X.kind===10002&&f.set(X.pubkey,NDKRelayList$1.from(X));for(const X of q)if(X.kind===3){if(f.has(X.pubkey))continue;const te=relayListFromKind3(t,X);te&&g.set(X.pubkey,te)}r=r.filter(X=>!f.has(X)&&!g.has(X))}if(r.length===0)return f;const _=new Map,L=new Map;return new Promise(q=>{let X=!1;(async()=>{const ne={closeOnEose:!0,pool:a,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:b};b&&(ne.relaySet=b),t.subscribe({kinds:[3,10002],authors:r},ne,{onEvent:ze=>{if(ze.kind===10002){const Xe=_.get(ze.pubkey);if(Xe&&Xe.created_at>ze.created_at)return;_.set(ze.pubkey,ze)}else if(ze.kind===3){const Xe=L.get(ze.pubkey);if(Xe&&Xe.created_at>ze.created_at)return;L.set(ze.pubkey,ze)}},onEose:()=>{if(!X){X=!0,t.debug(`[getRelayListForUsers] EOSE - relayListEvents: ${_.size}, contactListEvents: ${L.size}`);for(const ze of _.values())f.set(ze.pubkey,NDKRelayList$1.from(ze));for(const ze of r){if(f.has(ze))continue;const Xe=L.get(ze);if(!Xe)continue;const He=relayListFromKind3(t,Xe);He&&f.set(ze,He)}t.debug(`[getRelayListForUsers] Returning ${f.size} relay lists for ${r.length} pubkeys`),q(f)}}});const Ce=Array.from(c).some(ze=>ze.status<=2),Le=Array.from(c).some(ze=>ze.status===4);let Ge=s;(Ce||Le)&&(Ge=s+3e3),t.debug(`[getRelayListForUsers] Setting fallback timeout to ${Ge}ms (disconnected: ${Ce}, connecting: ${Le})`,{pubkeys:r}),setTimeout(()=>{X||(X=!0,t.debug(`[getRelayListForUsers] Timeout reached, returning ${f.size} relay lists`),q(f))},Ge)})()})}var OutboxItem=class{type;relayUrlScores;readRelays;writeRelays;constructor(r){this.type=r,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends libExports$1.EventEmitter{data;ndk;debug;constructor(r){super(),this.ndk=r,this.debug=r.debug.extend("outbox-tracker"),this.data=new distExports$1.LRUCache({maxSize:1e5,entryExpirationTimeInMS:120*1e3})}async trackUsers(r,t=!1){const n=[];for(let s=0;s<r.length;s+=400){const o=r.slice(s,s+400),a=o.map(f=>getKeyFromItem(f)).filter(f=>!this.data.has(f));if(a.length===0)continue;for(const f of a)this.data.set(f,new OutboxItem("user"));const c=new Map;for(const f of o)f instanceof NDKUser$1&&f.relayUrls.length>0&&c.set(f.pubkey,f.relayUrls);n.push(new Promise(f=>{getRelayListForUsers(a,this.ndk,t,1e3,c).then(g=>{this.debug(`Received relay lists for ${g.size} pubkeys out of ${a.length} requested`);for(const[b,_]of g){let L=this.data.get(b);if(L??=new OutboxItem("user"),_){if(L.readRelays=new Set(normalize$3(_.readRelayUrls)),L.writeRelays=new Set(normalize$3(_.writeRelayUrls)),this.ndk.relayConnectionFilter){for(const q of L.readRelays)this.ndk.relayConnectionFilter(q)||L.readRelays.delete(q);for(const q of L.writeRelays)this.ndk.relayConnectionFilter(q)||L.writeRelays.delete(q)}this.data.set(b,L),this.emit("user:relay-list-updated",b,L),this.debug(`Adding ${L.readRelays.size} read relays and ${L.writeRelays.size} write relays for ${b}`,_?.rawEvent())}}}).finally(f)}))}return Promise.all(n)}track(r,t,n=!0){const s=getKeyFromItem(r);t??=getTypeFromItem(r);let o=this.data.get(s);return o||(o=new OutboxItem(t),r instanceof NDKUser$1&&this.trackUsers([r])),o}};function getKeyFromItem(r){return r instanceof NDKUser$1?r.pubkey:r}function getTypeFromItem(r){return r instanceof NDKUser$1?"user":"kind"}function correctRelaySet(r,t){const n=t.connectedRelays();if(!Array.from(r.relays).some(o=>n.map(a=>a.url).includes(o.url)))for(const o of n)r.addRelay(o);if(n.length===0)for(const o of t.relays.values())r.addRelay(o);return r}var NDKSubscriptionManager=class{subscriptions;seenEvents=new distExports$1.LRUCache({maxSize:1e4,entryExpirationTimeInMS:300*1e3});constructor(){this.subscriptions=new Map}add(r){this.subscriptions.set(r.internalId,r),r.onStopped,r.onStopped=()=>{this.subscriptions.delete(r.internalId)},r.on("close",()=>{this.subscriptions.delete(r.internalId)})}seenEvent(r,t){const n=this.seenEvents.get(r)||[];n.some(s=>s.url===t.url)||n.push(t),this.seenEvents.set(r,n)}dispatchEvent(r,t,n=!1){t&&this.seenEvent(r.id,t);const s=this.subscriptions.values(),o=[];for(const a of s)matchFilters(a.filters,r)&&o.push(a);for(const a of o){if(a.exclusiveRelay&&a.relaySet){let c=!1;if(n?c=!a.skipOptimisticPublishEvent:t?c=a.relaySet.relays.has(t):c=(this.seenEvents.get(r.id)||[]).some(g=>a.relaySet.relays.has(g)),!c){a.debug.extend("exclusive-relay")("Rejected event %s from %s (relay not in exclusive set)",r.id,t?.url||(n?"optimistic":"cache"));continue}}a.eventReceived(r,t,!1,n)}}},debug6=createDebug2("ndk:active-user");async function getUserRelayList(r){if(!this.autoConnectUserRelays)return;const t=await getRelayListForUser(r.pubkey,this);if(t){for(const n of t.relays){let s=this.pool.relays.get(n);s||(s=new NDKRelay$1(n,this.relayAuthDefaultPolicy,this),this.pool.addRelay(s))}return debug6("Connected to %d user relays",t.relays.length),t}}async function setActiveUser(r){if(!this.autoConnectUserRelays)return;const t=this.outboxPool||this.pool;t.connectedRelays.length>0?await getUserRelayList.call(this,r):t.once("connect",async()=>{await getUserRelayList.call(this,r)})}function getEntity(r){try{const t=nip19_exports$3.decode(r);return t.type==="npub"?npub(this,t.data):t.type==="nprofile"?nprofile(this,t.data):t}catch{return null}}function npub(r,t){return r.getUser({pubkey:t})}function nprofile(r,t){const n=r.getUser({pubkey:t.pubkey});return t.relays&&(n.relayUrls=t.relays),n}function isValidHint(r){if(!r||r==="")return!1;try{return new URL(r),!0}catch{return!1}}async function fetchEventFromTag(r,t,n,s={type:"timeout"}){const o=this.debug.extend("fetch-event-from-tag"),[a,c,f]=r;n={},o("fetching event from tag",r,n,s);const g=getRelaysForSync$1(this,t.pubkey);if(g&&g.size>0){o("fetching event from author relays %o",Array.from(g));const ne=NDKRelaySet$1.fromRelayUrls(Array.from(g),this),Ce=await this.fetchEvent(c,n,ne);if(Ce)return Ce}else o("no author relays found for %s",t.pubkey,t);const b=calculateRelaySetsFromFilters(this,[{ids:[c]}],this.pool);o("fetching event without relay hint",b);const _=await this.fetchEvent(c,n);if(_)return _;if(f&&f!==""){const ne=await this.fetchEvent(c,n,this.pool.getRelay(f,!0,!0,[{ids:[c]}]));if(ne)return ne}let L;const q=isValidHint(f)?this.pool.getRelay(f,!1,!0,[{ids:[c]}]):void 0,X=new Promise(ne=>{this.fetchEvent(c,n,q).then(ne)});if(!isValidHint(f)||s.type==="none")return X;const te=new Promise(async ne=>{const Ce=s.relaySet,Le=s.timeout??1500,Ge=new Promise(ze=>setTimeout(ze,Le));if(s.type==="timeout"&&await Ge,L)ne(L);else{o("fallback fetch triggered");const ze=await this.fetchEvent(c,n,Ce);ne(ze)}});switch(s.type){case"timeout":return Promise.race([X,te]);case"eose":return L=await X,L||te}}var Queue$1=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(t,n){this.maxConcurrency=n}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const n=new Promise((s,o)=>{this.queue.push({...t,func:()=>t.func().then(a=>(s(a),a),a=>{throw o(a),a})}),this.process()});return this.promises.set(t.id,n),n.finally(()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()}),n}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const t=this.queue.shift();!t||this.processing.has(t.id)||(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],NDK=class extends libExports$1.EventEmitter{_explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;muteFilter;relayConnectionFilter;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=.1;validationRatioFn;filterValidationMode="validate";subManager;aiGuardrails;_signatureVerificationFunction;_signatureVerificationWorker;signatureVerificationTimeMs=0;publishingFailureHandled=!1;pools=[];relayAuthDefaultPolicy;httpFetch;netDebug;autoConnectUserRelays=!0;_wallet;walletConfig;constructor(r={}){super(),this.debug=r.debug||createDebug2("ndk"),this.netDebug=r.netDebug,this._explicitRelayUrls=r.explicitRelayUrls||[],this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool$1(r.explicitRelayUrls||[],this),this.pool.name="Main",this.pool.on("relay:auth",async(t,n)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,n)}),this.autoConnectUserRelays=r.autoConnectUserRelays??!0,this.clientName=r.clientName,this.clientNip89=r.clientNip89,this.relayAuthDefaultPolicy=r.relayAuthDefaultPolicy,r.enableOutboxModel!==!1&&(this.outboxPool=new NDKPool$1(r.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this),this.outboxTracker.on("user:relay-list-updated",(t,n)=>{this.debug(`Outbox relay list updated for ${t}`);for(const s of this.subManager.subscriptions.values())s.filters.some(a=>a.authors?.includes(t))&&typeof s.refreshRelayConnections=="function"&&(this.debug(`Refreshing relay connections for subscription ${s.internalId}`),s.refreshRelayConnections())})),this.signer=r.signer,this.cacheAdapter=r.cacheAdapter,this.muteFilter=r.muteFilter,this.relayConnectionFilter=r.relayConnectionFilter,r.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet$1.fromRelayUrls(r.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue$1("zaps",3),this.queuesNip05=new Queue$1("nip05",10),r.signatureVerificationWorker&&(this.signatureVerificationWorker=r.signatureVerificationWorker),r.signatureVerificationFunction&&(this.signatureVerificationFunction=r.signatureVerificationFunction),this.initialValidationRatio=r.initialValidationRatio||1,this.lowestValidationRatio=r.lowestValidationRatio||.1,this.validationRatioFn=r.validationRatioFn||this.defaultValidationRatioFn,this.filterValidationMode=r.filterValidationMode||"validate",this.aiGuardrails=new AIGuardrails(r.aiGuardrails||!1),this.aiGuardrails.ndkInstantiated(this);try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(r){this._explicitRelayUrls=r.map(normalizeRelayUrl$1),this.pool.relayUrls=r}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(r){this._signatureVerificationWorker=r,r?(signatureVerificationInit(r),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(r){this._signatureVerificationFunction=r,this.asyncSigVerification=!!r}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(r,t,n=!0){let s;return typeof r=="string"?s=new NDKRelay$1(r,t,this):s=r,this.pool.addRelay(s,n),this.explicitRelayUrls?.push(s.url),s}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(r){const t=this._activeUser?.pubkey!==r?.pubkey;this._activeUser=r,t&&this.emit("activeUser:change",r),r&&t&&setActiveUser.call(this,r)}get signer(){return this._signer}set signer(r){this._signer=r,r&&this.emit("signer:ready",r),r?.user().then(t=>{t.ndk=this,this.activeUser=t})}async connect(r){this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await this._signer.relays?.(this)),this._signer.relays&&(await this._signer.relays(this)).forEach(s=>this.pool.addRelay(s)));const t=[this.pool.connect(r)];return this.outboxPool&&t.push(this.outboxPool.connect(r)),this.cacheAdapter?.initializeAsync&&t.push(this.cacheAdapter.initializeAsync(this)),Promise.allSettled(t).then(()=>{})}reportInvalidSignature(r,t){this.debug(`Invalid signature detected for event ${r.id}${t?` from relay ${t.url}`:""}`),this.emit("event:invalid-sig",r,t)}defaultValidationRatioFn(r,t,n){if(t<10)return this.initialValidationRatio;const s=Math.min(t/100,1),o=this.initialValidationRatio*(1-s)+this.lowestValidationRatio*s;return Math.max(o,this.lowestValidationRatio)}getUser(r){if(typeof r=="string")if(r.startsWith("npub1")){const{type:n,data:s}=nip19_exports$3.decode(r);if(n!=="npub")throw new Error(`Invalid npub: ${r}`);return this.getUser({pubkey:s})}else if(r.startsWith("nprofile1")){const{type:n,data:s}=nip19_exports$3.decode(r);if(n!=="nprofile")throw new Error(`Invalid nprofile: ${r}`);return this.getUser({pubkey:s.pubkey,relayUrls:s.relays})}else return this.getUser({pubkey:r});const t=new NDKUser$1(r);return t.ndk=this,t}async getUserFromNip05(r,t=!1){return NDKUser$1.fromNip05(r,this,t)}async fetchUser(r,t=!1){if(isValidNip05(r))return NDKUser$1.fromNip05(r,this,t);if(r.startsWith("npub1")){const{type:n,data:s}=nip19_exports$3.decode(r);if(n!=="npub")throw new Error(`Invalid npub: ${r}`);const o=new NDKUser$1({pubkey:s});return o.ndk=this,o}else if(r.startsWith("nprofile1")){const{type:n,data:s}=nip19_exports$3.decode(r);if(n!=="nprofile")throw new Error(`Invalid nprofile: ${r}`);const o=new NDKUser$1({pubkey:s.pubkey,relayUrls:s.relays});return o.ndk=this,o}else{const n=new NDKUser$1({pubkey:r});return n.ndk=this,n}}subscribe(r,t,n=!0,s=!0){let o=t?.relaySet,a=s;n instanceof NDKRelaySet$1?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),o=n,a=s):(typeof n=="boolean"||typeof n=="object")&&(a=n);let c;const f={relaySet:o,...t};a&&typeof a=="object"&&(a.onEvent&&(f.onEvent=a.onEvent),a.onEose&&(f.onEose=a.onEose),a.onClose&&(f.onClose=a.onClose),a.onEvents&&(c=a.onEvents));const g=new NDKSubscription(this,r,f);this.subManager.add(g),this.aiGuardrails?.subscription?.created(Array.isArray(r)?r:[r],f);const b=g.pool;if(g.relaySet)for(const _ of g.relaySet.relays)b.useTemporaryRelay(_,void 0,g.filters);if(this.outboxPool&&g.hasAuthorsFilter()){const _=g.filters.filter(L=>L.authors&&L.authors?.length>0).flatMap(L=>L.authors);this.outboxTracker?.trackUsers(_)}return a&&setTimeout(async()=>{this.cacheAdapter?.initializeAsync&&!this.cacheAdapter.ready&&await this.cacheAdapter.initializeAsync(this);const _=g.start(!c);_&&_.length>0&&c&&c(_)},0),g}fetchEventFromTag=fetchEventFromTag.bind(this);fetchEventSync(r){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let t;typeof r=="string"?t=[filterFromId(r)]:t=r;const n=new NDKSubscription(this,t),s=this.cacheAdapter.query(n);if(s instanceof Promise)throw new Error("Cache adapter is async");return s.map(o=>(o.ndk=this,o))}async fetchEvent(r,t,n){let s,o;if(n instanceof NDKRelay$1?o=new NDKRelaySet$1(new Set([n]),this):n instanceof NDKRelaySet$1&&(o=n),!n&&typeof r=="string"&&!isNip33AValue(r)){const a=relaysFromBech32(r,this);a.length>0&&(o=new NDKRelaySet$1(new Set(a),this),o=correctRelaySet(o,this.pool))}if(typeof r=="string"?s=[filterFromId(r)]:Array.isArray(r)?s=r:s=[r],typeof r!="string"&&this.aiGuardrails?.ndk?.fetchingEvents(s),s.length===0)throw new Error(`Invalid filter: ${JSON.stringify(r)}`);return new Promise((a,c)=>{let f=null;const g={...t||{},closeOnEose:!0};o&&(g.relaySet=o);const b=setTimeout(()=>{_.stop(),this.aiGuardrails._nextCallDisabled=null,a(f)},1e4),_=this.subscribe(s,g,{onEvent:L=>{L.ndk=this,L.isReplaceable()?(!f||f.created_at<L.created_at)&&(f=L):(clearTimeout(b),this.aiGuardrails._nextCallDisabled=null,a(L))},onEose:()=>{clearTimeout(b),this.aiGuardrails._nextCallDisabled=null,a(f)}})})}async fetchEvents(r,t,n){return this.aiGuardrails?.ndk?.fetchingEvents(r,t),new Promise(s=>{const o=new Map,a={...t||{},closeOnEose:!0};n&&(a.relaySet=n);const c=f=>{let g;f instanceof NDKEvent$1?g=f:g=new NDKEvent$1(void 0,f);const b=g.deduplicationKey(),_=o.get(b);_&&(g=dedup(_,g)),g.ndk=this,o.set(b,g)};this.subscribe(r,{...a,onEvent:c,onEose:()=>{this.aiGuardrails._nextCallDisabled=null,s(new Set(o.values()))}})})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getEntity=getEntity.bind(this);guardrailOff(r){return r?typeof r=="string"?this.aiGuardrails._nextCallDisabled=new Set([r]):this.aiGuardrails._nextCallDisabled=new Set(r):this.aiGuardrails._nextCallDisabled="all",this}set wallet(r){if(!r){this._wallet=void 0,this.walletConfig=void 0;return}this._wallet=r,this.walletConfig??={},this.walletConfig.lnPay=r?.lnPay?.bind(r),this.walletConfig.cashuPay=r?.cashuPay?.bind(r)}get wallet(){return this._wallet}},nip19_exports$2={};__reExport$1(nip19_exports$2,nip19_star$1);var nip49_exports$1={};__reExport$1(nip49_exports$1,nip49_star$1);function disconnect$1(r,t){return t??=createDebug2("ndk:relay:auth-policies:disconnect"),async n=>{t?.(`Relay ${n.url} requested authentication, disconnecting`),r.removeRelay(n.url)}}async function signAndAuth$1(r,t,n,s,o,a){try{await r.sign(n),o(r)}catch(c){s?.(`Failed to publish auth event to relay ${t.url}`,c),a(r)}}function signIn$1({ndk:r,signer:t,debug:n}={}){return n??=createDebug2("ndk:auth-policies:signIn"),async(s,o)=>{n?.(`Relay ${s.url} requested authentication, signing in`);const a=new NDKEvent$1(r);return a.kind=22242,a.tags=[["relay",s.url],["challenge",o]],t??=r?.signer,new Promise(async(c,f)=>{t?await signAndAuth$1(a,s,t,n,c,f):r?.once("signer:ready",async g=>{await signAndAuth$1(a,s,g,n,c,f)})})}}var NDKRelayAuthPolicies$1={disconnect:disconnect$1,signIn:signIn$1};async function ndkSignerFromPayload$1(r,t){let n;try{n=JSON.parse(r)}catch(o){console.error("Failed to parse signer payload string",r,o);return}if(!n||typeof n.type!="string"){console.error("Failed to parse signer payload string",r,new Error("Missing type field"));return}const s=signerRegistry$1.get(n.type);if(!s)throw new Error(`Unknown signer type: ${n.type}`);try{return await s.fromPayload(r,t)}catch(o){const a=o instanceof Error?o.message:String(o);throw new Error(`Failed to deserialize signer type ${n.type}: ${a}`)}}var NDKNip07Signer$1=class vo{_userPromise;encryptionQueue=[];encryptionProcessing=!1;debug;waitTimeout;_pubkey;ndk;_user;constructor(t=1e3,n){this.debug=createDebug2("ndk:nip07"),this.waitTimeout=t,this.ndk=n}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr?.getPublicKey();if(!t)throw new Error("User rejected access");this._pubkey=t;let n;return this.ndk?n=this.ndk.getUser({pubkey:t}):n=new NDKUser$1({pubkey:t}),this._user=n,n}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(t){await this.waitForExtension();const n=await window.nostr?.signEvent(t);if(!n)throw new Error("Failed to sign event");return n.sig}async relays(t){await this.waitForExtension();const n=await window.nostr?.getRelays?.()||{},s=[];for(const o of Object.keys(n))n[o].read&&n[o].write&&s.push(o);return s.map(o=>new NDKRelay$1(o,t?.relayAuthDefaultPolicy,t))}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&window.nostr?.nip04&&n.push("nip04"),(!t||t==="nip44")&&window.nostr?.nip44&&n.push("nip44"),n}async encrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"encrypt",o,n)}async decrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"decrypt",o,n)}async queueEncryption(t,n,s,o){return new Promise((a,c)=>{this.encryptionQueue.push({scheme:t,method:n,counterpartyHexpubkey:s,value:o,resolve:a,reject:c}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(t,n=0){if(!t&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const s=t||this.encryptionQueue.shift();if(!s){this.encryptionProcessing=!1;return}const{scheme:o,method:a,counterpartyHexpubkey:c,value:f,resolve:g,reject:b}=s;this.debug("Processing encryption queue item",{method:a,counterpartyHexpubkey:c,value:f});try{const _=await window.nostr?.[o]?.[a](c,f);if(!_)throw new Error("Failed to encrypt/decrypt");g(_)}catch(_){const L=_ instanceof Error?_.message:String(_);if(L.includes("call already executing")&&n<5){this.debug("Retrying encryption queue item",{method:a,counterpartyHexpubkey:c,value:f,retries:n}),setTimeout(()=>{this.processEncryptionQueue(s,n+1)},50*n);return}b(_ instanceof Error?_:new Error(L))}this.processEncryptionQueue()}waitForExtension(){return new Promise((t,n)=>{if(window.nostr){t();return}let s;const o=setInterval(()=>{window.nostr&&(clearTimeout(s),clearInterval(o),t())},100);s=setTimeout(()=>{clearInterval(o),n(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${s.type}`);return new vo(void 0,n)}};registerSigner$1("nip07",NDKNip07Signer$1);var NDKNostrRpc$1=class extends libExports$1.EventEmitter{ndk;signer;relaySet;debug;encryptionType="nip04";pool;constructor(t,n,s,o){if(super(),this.ndk=t,this.signer=n,o){this.pool=new NDKPool$1(o,t,{debug:s.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet$1(new Set,t,this.pool);for(const a of o){const c=this.pool.getRelay(a,!1,!1);c.authPolicy=NDKRelayAuthPolicies$1.signIn({ndk:t,signer:n,debug:s}),this.relaySet.addRelay(c),c.connect()}}this.debug=s.extend("rpc")}subscribe(t){return new Promise(n=>{const s=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet,onEvent:async o=>{try{const a=await this.parseEvent(o);a.method?this.emit("request",a):(this.emit(`response-${a.id}`,a),this.emit("response",a))}catch(a){this.debug("error parsing event",a,o.rawEvent())}},onEose:()=>{this.debug("eosed"),n(s)}})})}async parseEvent(t){this.encryptionType==="nip44"&&t.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!t.content.includes("?iv=")&&(this.encryptionType="nip44");const n=this.ndk.getUser({pubkey:t.pubkey});n.ndk=this.ndk;let s;try{s=await this.signer.decrypt(n,t.content,this.encryptionType)}catch{const L=this.encryptionType==="nip04"?"nip44":"nip04";s=await this.signer.decrypt(n,t.content,L),this.encryptionType=L}const o=JSON.parse(s),{id:a,method:c,params:f,result:g,error:b}=o;return c?{id:a,pubkey:t.pubkey,method:c,params:f,event:t}:{id:a,result:g,error:b,event:t}}async sendResponse(t,n,s,o=24133,a){const c={id:t,result:s};a&&(c.error=a);const f=await this.signer.user(),g=this.ndk.getUser({pubkey:n}),b=new NDKEvent$1(this.ndk,{kind:o,content:JSON.stringify(c),tags:[["p",n]],pubkey:f.pubkey});b.content=await this.signer.encrypt(g,b.content,this.encryptionType),await b.sign(this.signer),await b.publish(this.relaySet)}async sendRequest(t,n,s=[],o=24133,a){const c=Math.random().toString(36).substring(7),f=await this.signer.user(),g=this.ndk.getUser({pubkey:t}),b={id:c,method:n,params:s},_=new Promise(()=>{const q=X=>{X.result==="auth_url"?(this.once(`response-${c}`,q),this.emit("authUrl",X.error)):a&&a(X)};this.once(`response-${c}`,q)}),L=new NDKEvent$1(this.ndk,{kind:o,content:JSON.stringify(b),tags:[["p",t]],pubkey:f.pubkey});return L.content=await this.signer.encrypt(g,L.content,this.encryptionType),await L.sign(this.signer),await L.publish(this.relaySet),_}};function nostrConnectGenerateSecret$1(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri$1(r,t,n,s){const o={name:s?.name?encodeURIComponent(s.name):"",url:s?.url?encodeURIComponent(s.url):"",image:s?.image?encodeURIComponent(s.image):"",perms:s?.perms?encodeURIComponent(s.perms):""};let a=`nostrconnect://${r}?image=${o.image}&url=${o.url}&name=${o.name}&perms=${o.perms}&secret=${encodeURIComponent(t)}`;return n&&(a+=`&relay=${encodeURIComponent(n)}`),a}var NDKNip46Signer$1=class xi extends libExports$1.EventEmitter{ndk;_user;bunkerPubkey;userPubkey;get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}secret;localSigner;nip05;rpc;debug;relayUrls;subscription;nostrConnectUri;nostrConnectSecret;constructor(t,n,s,o,a){super(),this.ndk=t,this.debug=t.debug.extend("nip46:signer"),this.relayUrls=o,s?typeof s=="string"?this.localSigner=new NDKPrivateKeySigner$1(s):this.localSigner=s:this.localSigner=NDKPrivateKeySigner$1.generate(),n===!1||(n?n.startsWith("bunker://")?this.bunkerFlowInit(n):this.nip05Init(n):this.nostrconnectFlowInit(a)),this.rpc=new NDKNostrRpc$1(this.ndk,this.localSigner,this.debug,this.relayUrls)}static bunker(t,n,s){return new xi(t,n,s)}static nostrconnect(t,n,s,o){return new xi(t,void 0,s,[n],o)}nostrconnectFlowInit(t){this.nostrConnectSecret=nostrConnectGenerateSecret$1();const n=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri$1(n,this.nostrConnectSecret,this.relayUrls?.[0],t)}bunkerFlowInit(t){const n=new URL(t),s=n.hostname||n.pathname.replace(/^\/\//,""),o=n.searchParams.get("pubkey"),a=n.searchParams.getAll("relay"),c=n.searchParams.get("secret");this.bunkerPubkey=s,this.userPubkey=o,this.relayUrls=a,this.secret=c}nip05Init(t){this.nip05=t}async startListening(){if(this.subscription)return;const t=await this.localSigner.user();if(!t)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[t.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((t,n)=>{const s=o=>{o.result===this.nostrConnectSecret&&(this._user=o.event.author,this.userPubkey=o.event.pubkey,this.bunkerPubkey=o.event.pubkey,this.rpc.off("response",s),t(this._user))};this.startListening(),this.rpc.on("response",s)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const t=await NDKUser$1.fromNip05(this.nip05,this.ndk);t&&(this._user=t,this.userPubkey=t.pubkey,this.relayUrls=t.nip46Urls,this.rpc=new NDKNostrRpc$1(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...t)=>{this.emit("authUrl",...t)}),new Promise((t,n)=>{const s=[this.userPubkey??""];if(this.secret&&s.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",s,24133,o=>{o.result==="ack"?this.getPublicKey().then(a=>{this.userPubkey=a,this._user=this.ndk.getUser({pubkey:a}),t(this._user)}):n(o.error)})})}stop(){this.subscription?.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((t,n)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,s=>{t(s.result)})})}async encryptionEnabled(t){return t?[t]:Promise.resolve(["nip04","nip44"])}async encrypt(t,n,s="nip04"){return this.encryption(t,n,s,"encrypt")}async decrypt(t,n,s="nip04"){return this.encryption(t,n,s,"decrypt")}async encryption(t,n,s,o){return new Promise((c,f)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${s}_${o}`,[t.pubkey,n],24133,g=>{g.error?f(g.error):c(g.result)})})}async sign(t){return new Promise((s,o)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(t)],24133,a=>{if(a.error)o(a.error);else{const c=JSON.parse(a.result);s(c.sig)}})})}async createAccount(t,n,s){await this.startListening();const o=[];return t&&o.push(t),n&&o.push(n),s&&o.push(s),new Promise((a,c)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",o,24133,f=>{if(f.error)c(f.error);else{const g=f.result;a(g)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const t={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(t)}static async fromPayload(t,n){if(!n)throw new Error("NDK instance is required to deserialize NIP-46 signer");const s=JSON.parse(t);if(s.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${s.type}`);const o=s.payload;if(!o||typeof o!="object"||!o.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const a=await ndkSignerFromPayload$1(o.localSignerPayload,n);if(!a)throw new Error("Failed to deserialize local signer for NIP-46");if(!(a instanceof NDKPrivateKeySigner$1))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let c;return c=new xi(n,!1,a,o.relayUrls),c.userPubkey=o.userPubkey,c.bunkerPubkey=o.bunkerPubkey,c.relayUrls=o.relayUrls,c.secret=o.secret,o.userPubkey&&(c._user=new NDKUser$1({pubkey:o.userPubkey}),c._user&&(c._user.ndk=n)),c}};registerSigner$1("nip46",NDKNip46Signer$1);function zapInvoiceFromEvent(r){const t=r.getMatchingTags("description")[0],n=r.getMatchingTags("bolt11")[0];let s,o;if(!t||!n||!n[1])return null;try{let te=t[1];if(te.startsWith("%")&&(te=decodeURIComponent(te)),te==="")return null;o=JSON.parse(te),s=bolt11Exports$1.decode(n[1])}catch{return null}const a=s.sections.find(te=>te.name==="amount");if(!a)return null;const c=Number.parseInt(a.value);if(!c)return null;const f=o.content,g=o.pubkey,_=r.getMatchingTags("p")[0][1];let L=r.getMatchingTags("e")[0];L||(L=r.getMatchingTags("a")[0]);const q=L?L[1]:void 0;return{id:r.id,zapper:r.pubkey,zappee:g,zapped:_,zappedEvent:q,amount:c,comment:f}}var d2$2=createDebug2("ndk:zapper:ln");async function getNip57ZapSpecFromLud({lud06:r,lud16:t},n){let s;if(t&&!t.startsWith("LNURL")){const[o,a]=t.split("@");s=`https://${a}/.well-known/lnurlp/${o}`}else if(r){const{words:o}=bech32$2.decode(r,1e3),a=bech32$2.fromWords(o);s=new TextDecoder("utf-8").decode(a)}if(!s)throw d2$2("No zap endpoint found %o",{lud06:r,lud16:t}),new Error("No zap endpoint found");try{const a=await(n.httpFetch||fetch)(s);if(a.status!==200){const c=await a.text();throw new Error(`Unable to fetch zap endpoint ${s}: ${c}`)}return await a.json()}catch(o){throw new Error(`Unable to fetch zap endpoint ${s}: ${o}`)}}async function generateZapRequest(r,t,n,s,o,a,c,f,g){const b=n.callback,_=new NDKEvent$1(t);if(_.kind=9734,_.content=c||"",_.tags=[["relays",...a.slice(0,4)],["amount",o.toString()],["lnurl",b],["p",s]],r instanceof NDKEvent$1){const te=r.referenceTags().filter(ne=>ne[0]!=="p");_.tags.push(...te),r.kind!==void 0&&_.tags.push(["k",r.kind.toString()])}f&&(_.tags=_.tags.concat(f));const L=new Set,q=new Set;for(const X of _.tags)X[0]==="e"?L.add(X[1]):X[0]==="a"&&q.add(X[1]);if(L.size>1)throw new Error("Only one e-tag is allowed");if(q.size>1)throw new Error("Only one a-tag is allowed");return _.tags=_.tags.filter(X=>X[0]!=="p"),_.tags.push(["p",s]),await _.sign(g),_}var d3=createDebug2("ndk:zapper"),NDKZapper=class extends libExports$1.EventEmitter{target;ndk;comment;amount;unit;tags;signer;zapMethod;nutzapAsFallback;lnPay;cashuPay;onComplete;maxRelays=3;constructor(r,t,n="msat",s={}){if(super(),this.target=r,this.ndk=s.ndk||r.ndk,!this.ndk)throw new Error("No NDK instance provided");this.amount=t,this.comment=s.comment,this.unit=n,this.tags=s.tags,this.signer=s.signer,this.nutzapAsFallback=s.nutzapAsFallback??!1,this.lnPay=s.lnPay||this.ndk.walletConfig?.lnPay,this.cashuPay=s.cashuPay||this.ndk.walletConfig?.cashuPay,this.onComplete=s.onComplete||this.ndk.walletConfig?.onPaymentComplete}async zap(r){d3("Starting zap process",{target:this.target,amount:this.amount,unit:this.unit,methods:r,nutzapAsFallback:this.nutzapAsFallback});const t=this.getZapSplits();d3("Calculated zap splits",t);const n=new Map;await Promise.all(t.map(async a=>{let c;d3("Processing split",a);try{c=await this.zapSplit(a,r),d3("Split completed successfully",{split:a,result:c})}catch(f){d3("Split failed",{split:a,error:f.message}),c=new Error(f.message)}this.emit("split:complete",a,c),n.set(a,c)})),d3("All splits completed",n);const s=Array.from(n.values()).every(a=>a===void 0||a instanceof Error),o=Array.from(n.values()).some(a=>a instanceof Error);if(this.emit("complete",n),this.onComplete&&this.onComplete(n),s){const c=Array.from(n.values()).filter(f=>f instanceof Error).map(f=>f.message).join(", ")||"All zap attempts failed";throw d3("All splits failed",c),new Error(c)}return o&&d3("Some splits failed, but at least one succeeded"),n}async zapNip57(r,t){if(!this.lnPay)throw new Error("No lnPay function available");const n=await getNip57ZapSpecFromLud(t,this.ndk);if(!n)throw new Error("No zap spec available for recipient");const s=await this.relays(r.pubkey),o=await generateZapRequest(this.target,this.ndk,n,r.pubkey,r.amount,s,this.comment,this.tags,this.signer);if(!o)throw d3("Unable to generate zap request"),new Error("Unable to generate zap request");const a=await this.getLnInvoice(o,r.amount,n);if(!a)throw d3("Unable to get payment request"),new Error("Unable to get payment request");this.emit("ln_invoice",{amount:r.amount,recipientPubkey:r.pubkey,unit:this.unit,nip57ZapRequest:o,pr:a,type:"nip57"});const c=await this.lnPay({target:this.target,recipientPubkey:r.pubkey,paymentDescription:"NIP-57 Zap",pr:a,amount:r.amount,unit:this.unit,nip57ZapRequest:o});return c?.preimage&&this.emit("ln_payment",{preimage:c.preimage,amount:r.amount,recipientPubkey:r.pubkey,pr:a,unit:this.unit,nip57ZapRequest:o,type:"nip57"}),c}async zapNip61(r,t){if(d3("Starting NIP-61 zap",{split:r,data:t}),!this.cashuPay)throw d3("No cashuPay function available"),new Error("No cashuPay function available");d3("Calling cashuPay function",{target:this.target,recipientPubkey:r.pubkey,amount:r.amount,unit:this.unit,data:t});let n;if(n=await this.cashuPay({target:this.target,recipientPubkey:r.pubkey,paymentDescription:"NIP-61 Zap",amount:r.amount,unit:this.unit,...t??{}},s=>{d3("LN invoice generated for NIP-61",s),this.emit("ln_invoice",{pr:s,amount:r.amount,recipientPubkey:r.pubkey,unit:this.unit,type:"nip61"})}),d3("NIP-61 Zap result: %o",n),n instanceof Error)return d3("cashuPay returned error",n),n;if(n){const{proofs:s,mint:o}=n;if(!s||!o)throw d3("Invalid zap confirmation: missing proofs or mint",n),new Error(`Invalid zap confirmation: missing proofs or mint: ${n}`);d3("Creating nutzap event",{proofsCount:s.length,mint:o});const a=await this.relays(r.pubkey);d3("Publishing to relays",a);const c=NDKRelaySet$1.fromRelayUrls(a,this.ndk),f=new NDKNutzap$1(this.ndk);return f.tags=[...f.tags,...this.tags||[]],f.proofs=s,f.mint=o,f.target=this.target,f.comment=this.comment,f.unit="sat",f.recipientPubkey=r.pubkey,await f.sign(this.signer),d3("Nutzap signed, publishing",f.id),f.publish(c),f}d3("cashuPay returned undefined")}async zapSplit(r,t){d3("Starting zapSplit",{split:r,methods:t});const n=this.ndk.getUser({pubkey:r.pubkey});d3("Fetching zap info for recipient",n.pubkey);const s=await n.getZapInfo(2500);d3("Recipient zap methods",{methods:Array.from(s.keys()),nip61Data:s.get("nip61"),nip57Data:s.get("nip57")});let o;const a=this.nutzapAsFallback&&this.cashuPay;if(d3("Fallback configuration",{canFallbackToNip61:a,nutzapAsFallback:this.nutzapAsFallback,hasCashuPay:!!this.cashuPay}),s.size===0&&!a)throw d3("No zap methods available and fallback disabled"),new Error("No zap method available for recipient and NIP-61 fallback is disabled");const c=async()=>{if(d3("Executing NIP-61 fallback"),!this.nutzapAsFallback)return;let q=(await getRelayListForUsers([r.pubkey],this.ndk)).get(r.pubkey)?.readRelayUrls;return q=this.ndk.pool.connectedRelays().map(X=>X.url),d3("NIP-61 fallback relay URLs",q),await this.zapNip61(r,{relays:q,p2pk:r.pubkey,allowIntramintFallback:!!a})},f=!t||t.includes("nip61"),g=!t||t.includes("nip57");d3("Method filters",{canUseNip61:f,canUseNip57:g});const b=s.get("nip61");if(b&&f){d3("Attempting NIP-61 zap",b);try{if(o=await this.zapNip61(r,b),o instanceof NDKNutzap$1)return d3("NIP-61 zap succeeded",o),o}catch(L){d3("NIP-61 attempt failed",L),this.emit("notice",`NIP-61 attempt failed: ${L.message}`)}}const _=s.get("nip57");if(_&&g){d3("Attempting NIP-57 zap",_);try{if(o=await this.zapNip57(r,_),!(o instanceof Error))return d3("NIP-57 zap succeeded",o),o}catch(L){d3("NIP-57 attempt failed",L),this.emit("notice",`NIP-57 attempt failed: ${L.message}`)}}if(a){if(d3("Attempting NIP-61 fallback"),o=await c(),o instanceof Error)throw d3("NIP-61 fallback failed",o),o;return d3("NIP-61 fallback succeeded",o),o}if(d3("All zap methods exhausted"),this.emit("notice","Zap methods exhausted and there was no fallback to NIP-61"),o instanceof Error)throw o;return o}async getLnInvoice(r,t,n){const s=n.callback,o=JSON.stringify(r.rawEvent());d3(`Fetching invoice from ${s}?${new URLSearchParams({amount:t.toString(),nostr:o})}`);const a=new URL(s);a.searchParams.append("amount",t.toString()),a.searchParams.append("nostr",o),d3(`Fetching invoice from ${a.toString()}`);const c=await fetch(a.toString());if(d3(`Got response from zap endpoint: ${s}`,{status:c.status}),c.status!==200){d3(`Received non-200 status from zap endpoint: ${s}`,{status:c.status,amount:t,nostr:o});const g=await c.text();throw new Error(`Unable to fetch zap endpoint ${s}: ${g}`)}return(await c.json()).pr}getZapSplits(){if(this.target instanceof NDKUser$1)return[{pubkey:this.target.pubkey,amount:this.amount}];const r=this.target.getMatchingTags("zap");if(r.length===0)return[{pubkey:this.target.pubkey,amount:this.amount}];const t=[],n=r.reduce((s,o)=>s+Number.parseInt(o[2]),0);for(const s of r){const o=s[1],a=Math.floor(Number.parseInt(s[2])/n*this.amount);t.push({pubkey:o,amount:a})}return t}async getRecipientZapMethods(r=2500){const t=this.getZapSplits(),n=new Map;return await Promise.all(t.map(async s=>{const a=await this.ndk.getUser({pubkey:s.pubkey}).getZapInfo(r);n.set(s.pubkey,a)})),n}async getZapMethods(r,t,n=2500){return await r.getUser({pubkey:t}).getZapInfo(n)}async relays(r){let t=[];if(this.ndk?.activeUser){const n=await getRelayListForUsers([this.ndk.activeUser.pubkey,r],this.ndk),s=new Map;for(const o of n.values())for(const a of o.readRelayUrls){const c=s.get(a)||0;s.set(a,c+1)}t=Array.from(s.entries()).sort((o,a)=>a[1]-o[1]).map(([o])=>o).slice(0,this.maxRelays)}return this.ndk?.pool?.permanentAndConnectedRelays().length&&(t=this.ndk.pool.permanentAndConnectedRelays().map(n=>n.url)),t.length||(t=[]),t}};const createStoreImpl=r=>{let t;const n=new Set,s=(b,_)=>{const L=typeof b=="function"?b(t):b;if(!Object.is(L,t)){const q=t;t=_??(typeof L!="object"||L===null)?L:Object.assign({},t,L),n.forEach(X=>X(t,q))}},o=()=>t,f={setState:s,getState:o,getInitialState:()=>g,subscribe:b=>(n.add(b),()=>n.delete(b))},g=t=r(s,o,f);return f},createStore=(r=>r?createStoreImpl(r):createStoreImpl),bytesToHex$3=bytesToHex$4,hexToBytes$3=hexToBytes$4;var fr={},G$1={};G$1.byteLength=Dr;G$1.toByteArray=Pr;G$1.fromByteArray=Wr;var S$2=[],R$1=[],br=typeof Uint8Array<"u"?Uint8Array:Array,z$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var D$1=0,kr=z$1.length;D$1<kr;++D$1)S$2[D$1]=z$1[D$1],R$1[z$1.charCodeAt(D$1)]=D$1;R$1[45]=62;R$1[95]=63;function pr(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=r.indexOf("=");n===-1&&(n=t);var s=n===t?0:4-n%4;return[n,s]}function Dr(r){var t=pr(r),n=t[0],s=t[1];return(n+s)*3/4-s}function $r(r,t,n){return(t+n)*3/4-n}function Pr(r){var t,n=pr(r),s=n[0],o=n[1],a=new br($r(r,s,o)),c=0,f=o>0?s-4:s,g;for(g=0;g<f;g+=4)t=R$1[r.charCodeAt(g)]<<18|R$1[r.charCodeAt(g+1)]<<12|R$1[r.charCodeAt(g+2)]<<6|R$1[r.charCodeAt(g+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=t&255;return o===2&&(t=R$1[r.charCodeAt(g)]<<2|R$1[r.charCodeAt(g+1)]>>4,a[c++]=t&255),o===1&&(t=R$1[r.charCodeAt(g)]<<10|R$1[r.charCodeAt(g+1)]<<4|R$1[r.charCodeAt(g+2)]>>2,a[c++]=t>>8&255,a[c++]=t&255),a}function Or(r){return S$2[r>>18&63]+S$2[r>>12&63]+S$2[r>>6&63]+S$2[r&63]}function Gr(r,t,n){for(var s,o=[],a=t;a<n;a+=3)s=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),o.push(Or(s));return o.join("")}function Wr(r){for(var t,n=r.length,s=n%3,o=[],a=16383,c=0,f=n-s;c<f;c+=a)o.push(Gr(r,c,c+a>f?f:c+a));return s===1?(t=r[n-1],o.push(S$2[t>>2]+S$2[t<<4&63]+"==")):s===2&&(t=(r[n-2]<<8)+r[n-1],o.push(S$2[t>>10]+S$2[t>>4&63]+S$2[t<<2&63]+"=")),o.join("")}var J={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */J.read=function(r,t,n,s,o){var a,c,f=o*8-s-1,g=(1<<f)-1,b=g>>1,_=-7,L=n?o-1:0,q=n?-1:1,X=r[t+L];for(L+=q,a=X&(1<<-_)-1,X>>=-_,_+=f;_>0;a=a*256+r[t+L],L+=q,_-=8);for(c=a&(1<<-_)-1,a>>=-_,_+=s;_>0;c=c*256+r[t+L],L+=q,_-=8);if(a===0)a=1-b;else{if(a===g)return c?NaN:(X?-1:1)*(1/0);c=c+Math.pow(2,s),a=a-b}return(X?-1:1)*c*Math.pow(2,a-s)};J.write=function(r,t,n,s,o,a){var c,f,g,b=a*8-o-1,_=(1<<b)-1,L=_>>1,q=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=s?0:a-1,te=s?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,c=_):(c=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-c))<1&&(c--,g*=2),c+L>=1?t+=q/g:t+=q*Math.pow(2,1-L),t*g>=2&&(c++,g/=2),c+L>=_?(f=0,c=_):c+L>=1?(f=(t*g-1)*Math.pow(2,o),c=c+L):(f=t*Math.pow(2,L-1)*Math.pow(2,o),c=0));o>=8;r[n+X]=f&255,X+=te,f/=256,o-=8);for(c=c<<o|f,b+=o;b>0;r[n+X]=c&255,X+=te,c/=256,b-=8);r[n+X-te]|=ne*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const t=G$1,n=J,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=_,r.SlowBuffer=He,r.INSPECT_MAX_BYTES=50;const o=2147483647;r.kMaxLength=o;const{Uint8Array:a,ArrayBuffer:c,SharedArrayBuffer:f}=globalThis;_.TYPED_ARRAY_SUPPORT=g(),!_.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function g(){try{const Qe=new a(1),nt={foo:function(){return 42}};return Object.setPrototypeOf(nt,a.prototype),Object.setPrototypeOf(Qe,nt),Qe.foo()===42}catch{return!1}}Object.defineProperty(_.prototype,"parent",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.buffer}}),Object.defineProperty(_.prototype,"offset",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.byteOffset}});function b(Qe){if(Qe>o)throw new RangeError('The value "'+Qe+'" is invalid for option "size"');const nt=new a(Qe);return Object.setPrototypeOf(nt,_.prototype),nt}function _(Qe,nt,_t){if(typeof Qe=="number"){if(typeof nt=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return te(Qe)}return L(Qe,nt,_t)}_.poolSize=8192;function L(Qe,nt,_t){if(typeof Qe=="string")return ne(Qe,nt);if(c.isView(Qe))return Le(Qe);if(Qe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Qe);if(ur(Qe,c)||Qe&&ur(Qe.buffer,c)||typeof f<"u"&&(ur(Qe,f)||Qe&&ur(Qe.buffer,f)))return Ge(Qe,nt,_t);if(typeof Qe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Bt=Qe.valueOf&&Qe.valueOf();if(Bt!=null&&Bt!==Qe)return _.from(Bt,nt,_t);const Jt=ze(Qe);if(Jt)return Jt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Qe[Symbol.toPrimitive]=="function")return _.from(Qe[Symbol.toPrimitive]("string"),nt,_t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Qe)}_.from=function(Qe,nt,_t){return L(Qe,nt,_t)},Object.setPrototypeOf(_.prototype,a.prototype),Object.setPrototypeOf(_,a);function q(Qe){if(typeof Qe!="number")throw new TypeError('"size" argument must be of type number');if(Qe<0)throw new RangeError('The value "'+Qe+'" is invalid for option "size"')}function X(Qe,nt,_t){return q(Qe),Qe<=0?b(Qe):nt!==void 0?typeof _t=="string"?b(Qe).fill(nt,_t):b(Qe).fill(nt):b(Qe)}_.alloc=function(Qe,nt,_t){return X(Qe,nt,_t)};function te(Qe){return q(Qe),b(Qe<0?0:Xe(Qe)|0)}_.allocUnsafe=function(Qe){return te(Qe)},_.allocUnsafeSlow=function(Qe){return te(Qe)};function ne(Qe,nt){if((typeof nt!="string"||nt==="")&&(nt="utf8"),!_.isEncoding(nt))throw new TypeError("Unknown encoding: "+nt);const _t=Ve(Qe,nt)|0;let Bt=b(_t);const Jt=Bt.write(Qe,nt);return Jt!==_t&&(Bt=Bt.slice(0,Jt)),Bt}function Ce(Qe){const nt=Qe.length<0?0:Xe(Qe.length)|0,_t=b(nt);for(let Bt=0;Bt<nt;Bt+=1)_t[Bt]=Qe[Bt]&255;return _t}function Le(Qe){if(ur(Qe,a)){const nt=new a(Qe);return Ge(nt.buffer,nt.byteOffset,nt.byteLength)}return Ce(Qe)}function Ge(Qe,nt,_t){if(nt<0||Qe.byteLength<nt)throw new RangeError('"offset" is outside of buffer bounds');if(Qe.byteLength<nt+(_t||0))throw new RangeError('"length" is outside of buffer bounds');let Bt;return nt===void 0&&_t===void 0?Bt=new a(Qe):_t===void 0?Bt=new a(Qe,nt):Bt=new a(Qe,nt,_t),Object.setPrototypeOf(Bt,_.prototype),Bt}function ze(Qe){if(_.isBuffer(Qe)){const nt=Xe(Qe.length)|0,_t=b(nt);return _t.length===0||Qe.copy(_t,0,0,nt),_t}if(Qe.length!==void 0)return typeof Qe.length!="number"||ar(Qe.length)?b(0):Ce(Qe);if(Qe.type==="Buffer"&&Array.isArray(Qe.data))return Ce(Qe.data)}function Xe(Qe){if(Qe>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return Qe|0}function He(Qe){return+Qe!=Qe&&(Qe=0),_.alloc(+Qe)}_.isBuffer=function(Qe){return Qe!=null&&Qe._isBuffer===!0&&Qe!==_.prototype},_.compare=function(Qe,nt){if(ur(Qe,a)&&(Qe=_.from(Qe,Qe.offset,Qe.byteLength)),ur(nt,a)&&(nt=_.from(nt,nt.offset,nt.byteLength)),!_.isBuffer(Qe)||!_.isBuffer(nt))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Qe===nt)return 0;let _t=Qe.length,Bt=nt.length;for(let Jt=0,xt=Math.min(_t,Bt);Jt<xt;++Jt)if(Qe[Jt]!==nt[Jt]){_t=Qe[Jt],Bt=nt[Jt];break}return _t<Bt?-1:Bt<_t?1:0},_.isEncoding=function(Qe){switch(String(Qe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.concat=function(Qe,nt){if(!Array.isArray(Qe))throw new TypeError('"list" argument must be an Array of Buffers');if(Qe.length===0)return _.alloc(0);let _t;if(nt===void 0)for(nt=0,_t=0;_t<Qe.length;++_t)nt+=Qe[_t].length;const Bt=_.allocUnsafe(nt);let Jt=0;for(_t=0;_t<Qe.length;++_t){let xt=Qe[_t];if(ur(xt,a))Jt+xt.length>Bt.length?(_.isBuffer(xt)||(xt=_.from(xt)),xt.copy(Bt,Jt)):a.prototype.set.call(Bt,xt,Jt);else if(_.isBuffer(xt))xt.copy(Bt,Jt);else throw new TypeError('"list" argument must be an Array of Buffers');Jt+=xt.length}return Bt};function Ve(Qe,nt){if(_.isBuffer(Qe))return Qe.length;if(c.isView(Qe)||ur(Qe,c))return Qe.byteLength;if(typeof Qe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Qe);const _t=Qe.length,Bt=arguments.length>2&&arguments[2]===!0;if(!Bt&&_t===0)return 0;let Jt=!1;for(;;)switch(nt){case"ascii":case"latin1":case"binary":return _t;case"utf8":case"utf-8":return qr(Qe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _t*2;case"hex":return _t>>>1;case"base64":return gr(Qe).length;default:if(Jt)return Bt?-1:qr(Qe).length;nt=(""+nt).toLowerCase(),Jt=!0}}_.byteLength=Ve;function We(Qe,nt,_t){let Bt=!1;if((nt===void 0||nt<0)&&(nt=0),nt>this.length||((_t===void 0||_t>this.length)&&(_t=this.length),_t<=0)||(_t>>>=0,nt>>>=0,_t<=nt))return"";for(Qe||(Qe="utf8");;)switch(Qe){case"hex":return oe(this,nt,_t);case"utf8":case"utf-8":return Q(this,nt,_t);case"ascii":return re(this,nt,_t);case"latin1":case"binary":return B(this,nt,_t);case"base64":return Y(this,nt,_t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ue(this,nt,_t);default:if(Bt)throw new TypeError("Unknown encoding: "+Qe);Qe=(Qe+"").toLowerCase(),Bt=!0}}_.prototype._isBuffer=!0;function rt(Qe,nt,_t){const Bt=Qe[nt];Qe[nt]=Qe[_t],Qe[_t]=Bt}_.prototype.swap16=function(){const Qe=this.length;if(Qe%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let nt=0;nt<Qe;nt+=2)rt(this,nt,nt+1);return this},_.prototype.swap32=function(){const Qe=this.length;if(Qe%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let nt=0;nt<Qe;nt+=4)rt(this,nt,nt+3),rt(this,nt+1,nt+2);return this},_.prototype.swap64=function(){const Qe=this.length;if(Qe%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let nt=0;nt<Qe;nt+=8)rt(this,nt,nt+7),rt(this,nt+1,nt+6),rt(this,nt+2,nt+5),rt(this,nt+3,nt+4);return this},_.prototype.toString=function(){const Qe=this.length;return Qe===0?"":arguments.length===0?Q(this,0,Qe):We.apply(this,arguments)},_.prototype.toLocaleString=_.prototype.toString,_.prototype.equals=function(Qe){if(!_.isBuffer(Qe))throw new TypeError("Argument must be a Buffer");return this===Qe?!0:_.compare(this,Qe)===0},_.prototype.inspect=function(){let Qe="";const nt=r.INSPECT_MAX_BYTES;return Qe=this.toString("hex",0,nt).replace(/(.{2})/g,"$1 ").trim(),this.length>nt&&(Qe+=" ... "),"<Buffer "+Qe+">"},s&&(_.prototype[s]=_.prototype.inspect),_.prototype.compare=function(Qe,nt,_t,Bt,Jt){if(ur(Qe,a)&&(Qe=_.from(Qe,Qe.offset,Qe.byteLength)),!_.isBuffer(Qe))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Qe);if(nt===void 0&&(nt=0),_t===void 0&&(_t=Qe?Qe.length:0),Bt===void 0&&(Bt=0),Jt===void 0&&(Jt=this.length),nt<0||_t>Qe.length||Bt<0||Jt>this.length)throw new RangeError("out of range index");if(Bt>=Jt&&nt>=_t)return 0;if(Bt>=Jt)return-1;if(nt>=_t)return 1;if(nt>>>=0,_t>>>=0,Bt>>>=0,Jt>>>=0,this===Qe)return 0;let xt=Jt-Bt,mr=_t-nt;const xr=Math.min(xt,mr),wr=this.slice(Bt,Jt),nn=Qe.slice(nt,_t);for(let Cr=0;Cr<xr;++Cr)if(wr[Cr]!==nn[Cr]){xt=wr[Cr],mr=nn[Cr];break}return xt<mr?-1:mr<xt?1:0};function st(Qe,nt,_t,Bt,Jt){if(Qe.length===0)return-1;if(typeof _t=="string"?(Bt=_t,_t=0):_t>2147483647?_t=2147483647:_t<-2147483648&&(_t=-2147483648),_t=+_t,ar(_t)&&(_t=Jt?0:Qe.length-1),_t<0&&(_t=Qe.length+_t),_t>=Qe.length){if(Jt)return-1;_t=Qe.length-1}else if(_t<0)if(Jt)_t=0;else return-1;if(typeof nt=="string"&&(nt=_.from(nt,Bt)),_.isBuffer(nt))return nt.length===0?-1:ht(Qe,nt,_t,Bt,Jt);if(typeof nt=="number")return nt=nt&255,typeof a.prototype.indexOf=="function"?Jt?a.prototype.indexOf.call(Qe,nt,_t):a.prototype.lastIndexOf.call(Qe,nt,_t):ht(Qe,[nt],_t,Bt,Jt);throw new TypeError("val must be string, number or Buffer")}function ht(Qe,nt,_t,Bt,Jt){let xt=1,mr=Qe.length,xr=nt.length;if(Bt!==void 0&&(Bt=String(Bt).toLowerCase(),Bt==="ucs2"||Bt==="ucs-2"||Bt==="utf16le"||Bt==="utf-16le")){if(Qe.length<2||nt.length<2)return-1;xt=2,mr/=2,xr/=2,_t/=2}function wr(Cr,Zr){return xt===1?Cr[Zr]:Cr.readUInt16BE(Zr*xt)}let nn;if(Jt){let Cr=-1;for(nn=_t;nn<mr;nn++)if(wr(Qe,nn)===wr(nt,Cr===-1?0:nn-Cr)){if(Cr===-1&&(Cr=nn),nn-Cr+1===xr)return Cr*xt}else Cr!==-1&&(nn-=nn-Cr),Cr=-1}else for(_t+xr>mr&&(_t=mr-xr),nn=_t;nn>=0;nn--){let Cr=!0;for(let Zr=0;Zr<xr;Zr++)if(wr(Qe,nn+Zr)!==wr(nt,Zr)){Cr=!1;break}if(Cr)return nn}return-1}_.prototype.includes=function(Qe,nt,_t){return this.indexOf(Qe,nt,_t)!==-1},_.prototype.indexOf=function(Qe,nt,_t){return st(this,Qe,nt,_t,!0)},_.prototype.lastIndexOf=function(Qe,nt,_t){return st(this,Qe,nt,_t,!1)};function je(Qe,nt,_t,Bt){_t=Number(_t)||0;const Jt=Qe.length-_t;Bt?(Bt=Number(Bt),Bt>Jt&&(Bt=Jt)):Bt=Jt;const xt=nt.length;Bt>xt/2&&(Bt=xt/2);let mr;for(mr=0;mr<Bt;++mr){const xr=parseInt(nt.substr(mr*2,2),16);if(ar(xr))return mr;Qe[_t+mr]=xr}return mr}function se(Qe,nt,_t,Bt){return en(qr(nt,Qe.length-_t),Qe,_t,Bt)}function m(Qe,nt,_t,Bt){return en(dn(nt),Qe,_t,Bt)}function A(Qe,nt,_t,Bt){return en(gr(nt),Qe,_t,Bt)}function k(Qe,nt,_t,Bt){return en(Mr(nt,Qe.length-_t),Qe,_t,Bt)}_.prototype.write=function(Qe,nt,_t,Bt){if(nt===void 0)Bt="utf8",_t=this.length,nt=0;else if(_t===void 0&&typeof nt=="string")Bt=nt,_t=this.length,nt=0;else if(isFinite(nt))nt=nt>>>0,isFinite(_t)?(_t=_t>>>0,Bt===void 0&&(Bt="utf8")):(Bt=_t,_t=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Jt=this.length-nt;if((_t===void 0||_t>Jt)&&(_t=Jt),Qe.length>0&&(_t<0||nt<0)||nt>this.length)throw new RangeError("Attempt to write outside buffer bounds");Bt||(Bt="utf8");let xt=!1;for(;;)switch(Bt){case"hex":return je(this,Qe,nt,_t);case"utf8":case"utf-8":return se(this,Qe,nt,_t);case"ascii":case"latin1":case"binary":return m(this,Qe,nt,_t);case"base64":return A(this,Qe,nt,_t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,Qe,nt,_t);default:if(xt)throw new TypeError("Unknown encoding: "+Bt);Bt=(""+Bt).toLowerCase(),xt=!0}},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Y(Qe,nt,_t){return nt===0&&_t===Qe.length?t.fromByteArray(Qe):t.fromByteArray(Qe.slice(nt,_t))}function Q(Qe,nt,_t){_t=Math.min(Qe.length,_t);const Bt=[];let Jt=nt;for(;Jt<_t;){const xt=Qe[Jt];let mr=null,xr=xt>239?4:xt>223?3:xt>191?2:1;if(Jt+xr<=_t){let wr,nn,Cr,Zr;switch(xr){case 1:xt<128&&(mr=xt);break;case 2:wr=Qe[Jt+1],(wr&192)===128&&(Zr=(xt&31)<<6|wr&63,Zr>127&&(mr=Zr));break;case 3:wr=Qe[Jt+1],nn=Qe[Jt+2],(wr&192)===128&&(nn&192)===128&&(Zr=(xt&15)<<12|(wr&63)<<6|nn&63,Zr>2047&&(Zr<55296||Zr>57343)&&(mr=Zr));break;case 4:wr=Qe[Jt+1],nn=Qe[Jt+2],Cr=Qe[Jt+3],(wr&192)===128&&(nn&192)===128&&(Cr&192)===128&&(Zr=(xt&15)<<18|(wr&63)<<12|(nn&63)<<6|Cr&63,Zr>65535&&Zr<1114112&&(mr=Zr))}}mr===null?(mr=65533,xr=1):mr>65535&&(mr-=65536,Bt.push(mr>>>10&1023|55296),mr=56320|mr&1023),Bt.push(mr),Jt+=xr}return ve(Bt)}const $e=4096;function ve(Qe){const nt=Qe.length;if(nt<=$e)return String.fromCharCode.apply(String,Qe);let _t="",Bt=0;for(;Bt<nt;)_t+=String.fromCharCode.apply(String,Qe.slice(Bt,Bt+=$e));return _t}function re(Qe,nt,_t){let Bt="";_t=Math.min(Qe.length,_t);for(let Jt=nt;Jt<_t;++Jt)Bt+=String.fromCharCode(Qe[Jt]&127);return Bt}function B(Qe,nt,_t){let Bt="";_t=Math.min(Qe.length,_t);for(let Jt=nt;Jt<_t;++Jt)Bt+=String.fromCharCode(Qe[Jt]);return Bt}function oe(Qe,nt,_t){const Bt=Qe.length;(!nt||nt<0)&&(nt=0),(!_t||_t<0||_t>Bt)&&(_t=Bt);let Jt="";for(let xt=nt;xt<_t;++xt)Jt+=Nr[Qe[xt]];return Jt}function Ue(Qe,nt,_t){const Bt=Qe.slice(nt,_t);let Jt="";for(let xt=0;xt<Bt.length-1;xt+=2)Jt+=String.fromCharCode(Bt[xt]+Bt[xt+1]*256);return Jt}_.prototype.slice=function(Qe,nt){const _t=this.length;Qe=~~Qe,nt=nt===void 0?_t:~~nt,Qe<0?(Qe+=_t,Qe<0&&(Qe=0)):Qe>_t&&(Qe=_t),nt<0?(nt+=_t,nt<0&&(nt=0)):nt>_t&&(nt=_t),nt<Qe&&(nt=Qe);const Bt=this.subarray(Qe,nt);return Object.setPrototypeOf(Bt,_.prototype),Bt};function Ze(Qe,nt,_t){if(Qe%1!==0||Qe<0)throw new RangeError("offset is not uint");if(Qe+nt>_t)throw new RangeError("Trying to access beyond buffer length")}_.prototype.readUintLE=_.prototype.readUIntLE=function(Qe,nt,_t){Qe=Qe>>>0,nt=nt>>>0,_t||Ze(Qe,nt,this.length);let Bt=this[Qe],Jt=1,xt=0;for(;++xt<nt&&(Jt*=256);)Bt+=this[Qe+xt]*Jt;return Bt},_.prototype.readUintBE=_.prototype.readUIntBE=function(Qe,nt,_t){Qe=Qe>>>0,nt=nt>>>0,_t||Ze(Qe,nt,this.length);let Bt=this[Qe+--nt],Jt=1;for(;nt>0&&(Jt*=256);)Bt+=this[Qe+--nt]*Jt;return Bt},_.prototype.readUint8=_.prototype.readUInt8=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,1,this.length),this[Qe]},_.prototype.readUint16LE=_.prototype.readUInt16LE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,2,this.length),this[Qe]|this[Qe+1]<<8},_.prototype.readUint16BE=_.prototype.readUInt16BE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,2,this.length),this[Qe]<<8|this[Qe+1]},_.prototype.readUint32LE=_.prototype.readUInt32LE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),(this[Qe]|this[Qe+1]<<8|this[Qe+2]<<16)+this[Qe+3]*16777216},_.prototype.readUint32BE=_.prototype.readUInt32BE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),this[Qe]*16777216+(this[Qe+1]<<16|this[Qe+2]<<8|this[Qe+3])},_.prototype.readBigUInt64LE=Yt(function(Qe){Qe=Qe>>>0,Xt(Qe,"offset");const nt=this[Qe],_t=this[Qe+7];(nt===void 0||_t===void 0)&&nr(Qe,this.length-8);const Bt=nt+this[++Qe]*2**8+this[++Qe]*2**16+this[++Qe]*2**24,Jt=this[++Qe]+this[++Qe]*2**8+this[++Qe]*2**16+_t*2**24;return BigInt(Bt)+(BigInt(Jt)<<BigInt(32))}),_.prototype.readBigUInt64BE=Yt(function(Qe){Qe=Qe>>>0,Xt(Qe,"offset");const nt=this[Qe],_t=this[Qe+7];(nt===void 0||_t===void 0)&&nr(Qe,this.length-8);const Bt=nt*2**24+this[++Qe]*2**16+this[++Qe]*2**8+this[++Qe],Jt=this[++Qe]*2**24+this[++Qe]*2**16+this[++Qe]*2**8+_t;return(BigInt(Bt)<<BigInt(32))+BigInt(Jt)}),_.prototype.readIntLE=function(Qe,nt,_t){Qe=Qe>>>0,nt=nt>>>0,_t||Ze(Qe,nt,this.length);let Bt=this[Qe],Jt=1,xt=0;for(;++xt<nt&&(Jt*=256);)Bt+=this[Qe+xt]*Jt;return Jt*=128,Bt>=Jt&&(Bt-=Math.pow(2,8*nt)),Bt},_.prototype.readIntBE=function(Qe,nt,_t){Qe=Qe>>>0,nt=nt>>>0,_t||Ze(Qe,nt,this.length);let Bt=nt,Jt=1,xt=this[Qe+--Bt];for(;Bt>0&&(Jt*=256);)xt+=this[Qe+--Bt]*Jt;return Jt*=128,xt>=Jt&&(xt-=Math.pow(2,8*nt)),xt},_.prototype.readInt8=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,1,this.length),this[Qe]&128?(255-this[Qe]+1)*-1:this[Qe]},_.prototype.readInt16LE=function(Qe,nt){Qe=Qe>>>0,nt||Ze(Qe,2,this.length);const _t=this[Qe]|this[Qe+1]<<8;return _t&32768?_t|4294901760:_t},_.prototype.readInt16BE=function(Qe,nt){Qe=Qe>>>0,nt||Ze(Qe,2,this.length);const _t=this[Qe+1]|this[Qe]<<8;return _t&32768?_t|4294901760:_t},_.prototype.readInt32LE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),this[Qe]|this[Qe+1]<<8|this[Qe+2]<<16|this[Qe+3]<<24},_.prototype.readInt32BE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),this[Qe]<<24|this[Qe+1]<<16|this[Qe+2]<<8|this[Qe+3]},_.prototype.readBigInt64LE=Yt(function(Qe){Qe=Qe>>>0,Xt(Qe,"offset");const nt=this[Qe],_t=this[Qe+7];(nt===void 0||_t===void 0)&&nr(Qe,this.length-8);const Bt=this[Qe+4]+this[Qe+5]*2**8+this[Qe+6]*2**16+(_t<<24);return(BigInt(Bt)<<BigInt(32))+BigInt(nt+this[++Qe]*2**8+this[++Qe]*2**16+this[++Qe]*2**24)}),_.prototype.readBigInt64BE=Yt(function(Qe){Qe=Qe>>>0,Xt(Qe,"offset");const nt=this[Qe],_t=this[Qe+7];(nt===void 0||_t===void 0)&&nr(Qe,this.length-8);const Bt=(nt<<24)+this[++Qe]*2**16+this[++Qe]*2**8+this[++Qe];return(BigInt(Bt)<<BigInt(32))+BigInt(this[++Qe]*2**24+this[++Qe]*2**16+this[++Qe]*2**8+_t)}),_.prototype.readFloatLE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),n.read(this,Qe,!0,23,4)},_.prototype.readFloatBE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,4,this.length),n.read(this,Qe,!1,23,4)},_.prototype.readDoubleLE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,8,this.length),n.read(this,Qe,!0,52,8)},_.prototype.readDoubleBE=function(Qe,nt){return Qe=Qe>>>0,nt||Ze(Qe,8,this.length),n.read(this,Qe,!1,52,8)};function lt(Qe,nt,_t,Bt,Jt,xt){if(!_.isBuffer(Qe))throw new TypeError('"buffer" argument must be a Buffer instance');if(nt>Jt||nt<xt)throw new RangeError('"value" argument is out of bounds');if(_t+Bt>Qe.length)throw new RangeError("Index out of range")}_.prototype.writeUintLE=_.prototype.writeUIntLE=function(Qe,nt,_t,Bt){if(Qe=+Qe,nt=nt>>>0,_t=_t>>>0,!Bt){const mr=Math.pow(2,8*_t)-1;lt(this,Qe,nt,_t,mr,0)}let Jt=1,xt=0;for(this[nt]=Qe&255;++xt<_t&&(Jt*=256);)this[nt+xt]=Qe/Jt&255;return nt+_t},_.prototype.writeUintBE=_.prototype.writeUIntBE=function(Qe,nt,_t,Bt){if(Qe=+Qe,nt=nt>>>0,_t=_t>>>0,!Bt){const mr=Math.pow(2,8*_t)-1;lt(this,Qe,nt,_t,mr,0)}let Jt=_t-1,xt=1;for(this[nt+Jt]=Qe&255;--Jt>=0&&(xt*=256);)this[nt+Jt]=Qe/xt&255;return nt+_t},_.prototype.writeUint8=_.prototype.writeUInt8=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,1,255,0),this[nt]=Qe&255,nt+1},_.prototype.writeUint16LE=_.prototype.writeUInt16LE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,2,65535,0),this[nt]=Qe&255,this[nt+1]=Qe>>>8,nt+2},_.prototype.writeUint16BE=_.prototype.writeUInt16BE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,2,65535,0),this[nt]=Qe>>>8,this[nt+1]=Qe&255,nt+2},_.prototype.writeUint32LE=_.prototype.writeUInt32LE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,4,4294967295,0),this[nt+3]=Qe>>>24,this[nt+2]=Qe>>>16,this[nt+1]=Qe>>>8,this[nt]=Qe&255,nt+4},_.prototype.writeUint32BE=_.prototype.writeUInt32BE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,4,4294967295,0),this[nt]=Qe>>>24,this[nt+1]=Qe>>>16,this[nt+2]=Qe>>>8,this[nt+3]=Qe&255,nt+4};function St(Qe,nt,_t,Bt,Jt){er(nt,Bt,Jt,Qe,_t,7);let xt=Number(nt&BigInt(4294967295));Qe[_t++]=xt,xt=xt>>8,Qe[_t++]=xt,xt=xt>>8,Qe[_t++]=xt,xt=xt>>8,Qe[_t++]=xt;let mr=Number(nt>>BigInt(32)&BigInt(4294967295));return Qe[_t++]=mr,mr=mr>>8,Qe[_t++]=mr,mr=mr>>8,Qe[_t++]=mr,mr=mr>>8,Qe[_t++]=mr,_t}function Mt(Qe,nt,_t,Bt,Jt){er(nt,Bt,Jt,Qe,_t,7);let xt=Number(nt&BigInt(4294967295));Qe[_t+7]=xt,xt=xt>>8,Qe[_t+6]=xt,xt=xt>>8,Qe[_t+5]=xt,xt=xt>>8,Qe[_t+4]=xt;let mr=Number(nt>>BigInt(32)&BigInt(4294967295));return Qe[_t+3]=mr,mr=mr>>8,Qe[_t+2]=mr,mr=mr>>8,Qe[_t+1]=mr,mr=mr>>8,Qe[_t]=mr,_t+8}_.prototype.writeBigUInt64LE=Yt(function(Qe,nt=0){return St(this,Qe,nt,BigInt(0),BigInt("0xffffffffffffffff"))}),_.prototype.writeBigUInt64BE=Yt(function(Qe,nt=0){return Mt(this,Qe,nt,BigInt(0),BigInt("0xffffffffffffffff"))}),_.prototype.writeIntLE=function(Qe,nt,_t,Bt){if(Qe=+Qe,nt=nt>>>0,!Bt){const xr=Math.pow(2,8*_t-1);lt(this,Qe,nt,_t,xr-1,-xr)}let Jt=0,xt=1,mr=0;for(this[nt]=Qe&255;++Jt<_t&&(xt*=256);)Qe<0&&mr===0&&this[nt+Jt-1]!==0&&(mr=1),this[nt+Jt]=(Qe/xt>>0)-mr&255;return nt+_t},_.prototype.writeIntBE=function(Qe,nt,_t,Bt){if(Qe=+Qe,nt=nt>>>0,!Bt){const xr=Math.pow(2,8*_t-1);lt(this,Qe,nt,_t,xr-1,-xr)}let Jt=_t-1,xt=1,mr=0;for(this[nt+Jt]=Qe&255;--Jt>=0&&(xt*=256);)Qe<0&&mr===0&&this[nt+Jt+1]!==0&&(mr=1),this[nt+Jt]=(Qe/xt>>0)-mr&255;return nt+_t},_.prototype.writeInt8=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,1,127,-128),Qe<0&&(Qe=255+Qe+1),this[nt]=Qe&255,nt+1},_.prototype.writeInt16LE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,2,32767,-32768),this[nt]=Qe&255,this[nt+1]=Qe>>>8,nt+2},_.prototype.writeInt16BE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,2,32767,-32768),this[nt]=Qe>>>8,this[nt+1]=Qe&255,nt+2},_.prototype.writeInt32LE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,4,2147483647,-2147483648),this[nt]=Qe&255,this[nt+1]=Qe>>>8,this[nt+2]=Qe>>>16,this[nt+3]=Qe>>>24,nt+4},_.prototype.writeInt32BE=function(Qe,nt,_t){return Qe=+Qe,nt=nt>>>0,_t||lt(this,Qe,nt,4,2147483647,-2147483648),Qe<0&&(Qe=4294967295+Qe+1),this[nt]=Qe>>>24,this[nt+1]=Qe>>>16,this[nt+2]=Qe>>>8,this[nt+3]=Qe&255,nt+4},_.prototype.writeBigInt64LE=Yt(function(Qe,nt=0){return St(this,Qe,nt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),_.prototype.writeBigInt64BE=Yt(function(Qe,nt=0){return Mt(this,Qe,nt,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ft(Qe,nt,_t,Bt,Jt,xt){if(_t+Bt>Qe.length)throw new RangeError("Index out of range");if(_t<0)throw new RangeError("Index out of range")}function Zt(Qe,nt,_t,Bt,Jt){return nt=+nt,_t=_t>>>0,Jt||Ft(Qe,nt,_t,4),n.write(Qe,nt,_t,Bt,23,4),_t+4}_.prototype.writeFloatLE=function(Qe,nt,_t){return Zt(this,Qe,nt,!0,_t)},_.prototype.writeFloatBE=function(Qe,nt,_t){return Zt(this,Qe,nt,!1,_t)};function Ut(Qe,nt,_t,Bt,Jt){return nt=+nt,_t=_t>>>0,Jt||Ft(Qe,nt,_t,8),n.write(Qe,nt,_t,Bt,52,8),_t+8}_.prototype.writeDoubleLE=function(Qe,nt,_t){return Ut(this,Qe,nt,!0,_t)},_.prototype.writeDoubleBE=function(Qe,nt,_t){return Ut(this,Qe,nt,!1,_t)},_.prototype.copy=function(Qe,nt,_t,Bt){if(!_.isBuffer(Qe))throw new TypeError("argument should be a Buffer");if(_t||(_t=0),!Bt&&Bt!==0&&(Bt=this.length),nt>=Qe.length&&(nt=Qe.length),nt||(nt=0),Bt>0&&Bt<_t&&(Bt=_t),Bt===_t||Qe.length===0||this.length===0)return 0;if(nt<0)throw new RangeError("targetStart out of bounds");if(_t<0||_t>=this.length)throw new RangeError("Index out of range");if(Bt<0)throw new RangeError("sourceEnd out of bounds");Bt>this.length&&(Bt=this.length),Qe.length-nt<Bt-_t&&(Bt=Qe.length-nt+_t);const Jt=Bt-_t;return this===Qe&&typeof a.prototype.copyWithin=="function"?this.copyWithin(nt,_t,Bt):a.prototype.set.call(Qe,this.subarray(_t,Bt),nt),Jt},_.prototype.fill=function(Qe,nt,_t,Bt){if(typeof Qe=="string"){if(typeof nt=="string"?(Bt=nt,nt=0,_t=this.length):typeof _t=="string"&&(Bt=_t,_t=this.length),Bt!==void 0&&typeof Bt!="string")throw new TypeError("encoding must be a string");if(typeof Bt=="string"&&!_.isEncoding(Bt))throw new TypeError("Unknown encoding: "+Bt);if(Qe.length===1){const xt=Qe.charCodeAt(0);(Bt==="utf8"&&xt<128||Bt==="latin1")&&(Qe=xt)}}else typeof Qe=="number"?Qe=Qe&255:typeof Qe=="boolean"&&(Qe=Number(Qe));if(nt<0||this.length<nt||this.length<_t)throw new RangeError("Out of range index");if(_t<=nt)return this;nt=nt>>>0,_t=_t===void 0?this.length:_t>>>0,Qe||(Qe=0);let Jt;if(typeof Qe=="number")for(Jt=nt;Jt<_t;++Jt)this[Jt]=Qe;else{const xt=_.isBuffer(Qe)?Qe:_.from(Qe,Bt),mr=xt.length;if(mr===0)throw new TypeError('The value "'+Qe+'" is invalid for argument "value"');for(Jt=0;Jt<_t-nt;++Jt)this[Jt+nt]=xt[Jt%mr]}return this};const vr={};function zr(Qe,nt,_t){vr[Qe]=class extends _t{constructor(){super(),Object.defineProperty(this,"message",{value:nt.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Qe}]`,this.stack,delete this.name}get code(){return Qe}set code(Bt){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Bt,writable:!0})}toString(){return`${this.name} [${Qe}]: ${this.message}`}}}zr("ERR_BUFFER_OUT_OF_BOUNDS",function(Qe){return Qe?`${Qe} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),zr("ERR_INVALID_ARG_TYPE",function(Qe,nt){return`The "${Qe}" argument must be of type number. Received type ${typeof nt}`},TypeError),zr("ERR_OUT_OF_RANGE",function(Qe,nt,_t){let Bt=`The value of "${Qe}" is out of range.`,Jt=_t;return Number.isInteger(_t)&&Math.abs(_t)>2**32?Jt=or(String(_t)):typeof _t=="bigint"&&(Jt=String(_t),(_t>BigInt(2)**BigInt(32)||_t<-(BigInt(2)**BigInt(32)))&&(Jt=or(Jt)),Jt+="n"),Bt+=` It must be ${nt}. Received ${Jt}`,Bt},RangeError);function or(Qe){let nt="",_t=Qe.length;const Bt=Qe[0]==="-"?1:0;for(;_t>=Bt+4;_t-=3)nt=`_${Qe.slice(_t-3,_t)}${nt}`;return`${Qe.slice(0,_t)}${nt}`}function sr(Qe,nt,_t){Xt(nt,"offset"),(Qe[nt]===void 0||Qe[nt+_t]===void 0)&&nr(nt,Qe.length-(_t+1))}function er(Qe,nt,_t,Bt,Jt,xt){if(Qe>_t||Qe<nt){const mr=typeof nt=="bigint"?"n":"";let xr;throw nt===0||nt===BigInt(0)?xr=`>= 0${mr} and < 2${mr} ** ${(xt+1)*8}${mr}`:xr=`>= -(2${mr} ** ${(xt+1)*8-1}${mr}) and < 2 ** ${(xt+1)*8-1}${mr}`,new vr.ERR_OUT_OF_RANGE("value",xr,Qe)}sr(Bt,Jt,xt)}function Xt(Qe,nt){if(typeof Qe!="number")throw new vr.ERR_INVALID_ARG_TYPE(nt,"number",Qe)}function nr(Qe,nt,_t){throw Math.floor(Qe)!==Qe?(Xt(Qe,_t),new vr.ERR_OUT_OF_RANGE("offset","an integer",Qe)):nt<0?new vr.ERR_BUFFER_OUT_OF_BOUNDS:new vr.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${nt}`,Qe)}const Fr=/[^+/0-9A-Za-z-_]/g;function Ar(Qe){if(Qe=Qe.split("=")[0],Qe=Qe.trim().replace(Fr,""),Qe.length<2)return"";for(;Qe.length%4!==0;)Qe=Qe+"=";return Qe}function qr(Qe,nt){nt=nt||1/0;let _t;const Bt=Qe.length;let Jt=null;const xt=[];for(let mr=0;mr<Bt;++mr){if(_t=Qe.charCodeAt(mr),_t>55295&&_t<57344){if(!Jt){if(_t>56319){(nt-=3)>-1&&xt.push(239,191,189);continue}else if(mr+1===Bt){(nt-=3)>-1&&xt.push(239,191,189);continue}Jt=_t;continue}if(_t<56320){(nt-=3)>-1&&xt.push(239,191,189),Jt=_t;continue}_t=(Jt-55296<<10|_t-56320)+65536}else Jt&&(nt-=3)>-1&&xt.push(239,191,189);if(Jt=null,_t<128){if((nt-=1)<0)break;xt.push(_t)}else if(_t<2048){if((nt-=2)<0)break;xt.push(_t>>6|192,_t&63|128)}else if(_t<65536){if((nt-=3)<0)break;xt.push(_t>>12|224,_t>>6&63|128,_t&63|128)}else if(_t<1114112){if((nt-=4)<0)break;xt.push(_t>>18|240,_t>>12&63|128,_t>>6&63|128,_t&63|128)}else throw new Error("Invalid code point")}return xt}function dn(Qe){const nt=[];for(let _t=0;_t<Qe.length;++_t)nt.push(Qe.charCodeAt(_t)&255);return nt}function Mr(Qe,nt){let _t,Bt,Jt;const xt=[];for(let mr=0;mr<Qe.length&&!((nt-=2)<0);++mr)_t=Qe.charCodeAt(mr),Bt=_t>>8,Jt=_t%256,xt.push(Jt),xt.push(Bt);return xt}function gr(Qe){return t.toByteArray(Ar(Qe))}function en(Qe,nt,_t,Bt){let Jt;for(Jt=0;Jt<Bt&&!(Jt+_t>=nt.length||Jt>=Qe.length);++Jt)nt[Jt+_t]=Qe[Jt];return Jt}function ur(Qe,nt){return Qe instanceof nt||Qe!=null&&Qe.constructor!=null&&Qe.constructor.name!=null&&Qe.constructor.name===nt.name}function ar(Qe){return Qe!==Qe}const Nr=(function(){const Qe="0123456789abcdef",nt=new Array(256);for(let _t=0;_t<16;++_t){const Bt=_t*16;for(let Jt=0;Jt<16;++Jt)nt[Bt+Jt]=Qe[_t]+Qe[Jt]}return nt})();function Yt(Qe){return typeof BigInt>"u"?Ir:Qe}function Ir(){throw new Error("BigInt not supported")}})(fr);const O=fr.Buffer;class Yr{static fromHex(t){if(t=t.trim(),t.length===0)return new Uint8Array(0);if(t.length<2||t.length&1)throw new Error("Invalid hex string: odd length.");if((t.startsWith("0x")||t.startsWith("0X"))&&(t=t.slice(2)),!t.match(/^[0-9a-fA-F]*$/))throw new Error("Invalid hex string: contains non-hex characters");const n=t.match(/.{1,2}/g);if(!n)throw new Error("Invalid hex string");return new Uint8Array(n.map(s=>parseInt(s,16)))}static toHex(t){return Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}static fromString(t){return t=t.trim(),new TextEncoder().encode(t)}static toString(t){return new TextDecoder("utf-8").decode(t)}static concat(...t){const n=t.reduce((a,c)=>a+c.length,0),s=new Uint8Array(n);let o=0;for(const a of t)s.set(a,o),o+=a.length;return s}static alloc(t){return new Uint8Array(t)}static writeBigUint64BE(t){const n=new ArrayBuffer(8);return new DataView(n).setBigUint64(0,t,!1),new Uint8Array(n)}static toBase64(t){if(typeof O<"u")return O.from(t).toString("base64");if(t.length>32768){let n="";for(let s=0;s<t.length;s+=32768){const o=t.slice(s,s+32768);n+=btoa(String.fromCharCode(...o))}return n}return btoa(String.fromCharCode(...t))}static fromBase64(t){if(t=t.trim(),typeof O<"u")return new Uint8Array(O.from(t,"base64"));let n=t.replace(/-/g,"+").replace(/_/g,"/");for(;n.length%4;)n+="=";return new Uint8Array([...atob(n)].map(s=>s.charCodeAt(0)))}static equals(t,n){if(t.length!==n.length)return!1;let s=0;for(let o=0;o<t.length;o++)s|=t[o]^n[o];return s===0}static compare(t,n){const s=Math.min(t.length,n.length);for(let o=0;o<s;o++){if(t[o]<n[o])return-1;if(t[o]>n[o])return 1}return t.length-n.length}}function Vr(r){return Hr(bytesToHex$3(r))}function Hr(r){return BigInt(`0x${r}`)}function Xr(r){return Yr.fromBase64(r)}const d$4=hexToBytes$3("536563703235366b315f48617368546f43757276655f43617368755f");function T$2(r){const t=sha256$4(Yr.concat(d$4,r)),n=new Uint32Array(1),s=2**16;for(let o=0;o<s;o++){const a=new Uint8Array(n.buffer),c=sha256$4(Yr.concat(t,a));try{return l$1(bytesToHex$3(Yr.concat(new Uint8Array([2]),c)))}catch{n[0]++}}throw new Error("No valid point found")}function H(r){const t=r.map(n=>n.toHex(!1)).join("");return sha256$4(new TextEncoder().encode(t))}function l$1(r){return secp256k1$2.ProjectivePoint.fromHex(r)}const K$1=r=>{let t;return/^[a-fA-F0-9]+$/.test(r)?t=Hr(r)%BigInt(2**31-1):t=Vr(Xr(r))%BigInt(2**31-1),t};function p$3(r,t){if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}const v$2=(r,t,n,s)=>{const o=secp256k1$2.ProjectivePoint.fromPrivateKey(bytesToHex$3(r.s)),a=s.multiply(Vr(r.e)),c=t.multiply(Vr(r.s)),f=n.multiply(Vr(r.e)),g=o.subtract(a),b=c.subtract(f),_=H([g,b,s,n]);return p$3(_,r.e)},d$3=(r,t,n,s)=>{if(t.r===void 0)throw new Error("verifyDLEQProof_reblind: Undefined blinding factor");const o=T$2(r),a=n.add(s.multiply(t.r)),c=secp256k1$2.ProjectivePoint.fromPrivateKey(t.r),f=o.add(c);return v$2(t,f,a,s)},Rho160=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id160=Uint8Array.from(new Array(16).fill(0).map((r,t)=>t)),Pi160=Id160.map(r=>(9*r+5)%16),idxLR=(()=>{const n=[[Id160],[Pi160]];for(let s=0;s<4;s++)for(let o of n)o.push(o[s].map(a=>Rho160[a]));return n})(),idxL=idxLR[0],idxR=idxLR[1],shifts160=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(r=>Uint8Array.from(r)),shiftsL160=idxL.map((r,t)=>r.map(n=>shifts160[t][n])),shiftsR160=idxR.map((r,t)=>r.map(n=>shifts160[t][n])),Kl160=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),Kr160=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function ripemd_f(r,t,n,s){return r===0?t^n^s:r===1?t&n|~t&s:r===2?(t|~n)^s:r===3?t&s|n&~s:t^(n|~s)}const BUF_160=new Uint32Array(16);class RIPEMD160 extends HashMD$1{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:n,h2:s,h3:o,h4:a}=this;return[t,n,s,o,a]}set(t,n,s,o,a){this.h0=t|0,this.h1=n|0,this.h2=s|0,this.h3=o|0,this.h4=a|0}process(t,n){for(let X=0;X<16;X++,n+=4)BUF_160[X]=t.getUint32(n,!0);let s=this.h0|0,o=s,a=this.h1|0,c=a,f=this.h2|0,g=f,b=this.h3|0,_=b,L=this.h4|0,q=L;for(let X=0;X<5;X++){const te=4-X,ne=Kl160[X],Ce=Kr160[X],Le=idxL[X],Ge=idxR[X],ze=shiftsL160[X],Xe=shiftsR160[X];for(let He=0;He<16;He++){const Ve=rotl$4(s+ripemd_f(X,a,f,b)+BUF_160[Le[He]]+ne,ze[He])+L|0;s=L,L=b,b=rotl$4(f,10)|0,f=a,a=Ve}for(let He=0;He<16;He++){const Ve=rotl$4(o+ripemd_f(te,c,g,_)+BUF_160[Ge[He]]+Ce,Xe[He])+q|0;o=q,q=_,_=rotl$4(g,10)|0,g=c,c=Ve}}this.set(this.h1+f+_|0,this.h2+b+q|0,this.h3+L+o|0,this.h4+s+c|0,this.h0+a+g|0)}roundClean(){clean$1(BUF_160)}destroy(){this.destroyed=!0,clean$1(this.buffer),this.set(0,0,0,0,0)}}const ripemd160=createHasher$1(()=>new RIPEMD160);/*! scure-bip32 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const Point$1=secp256k1$2.ProjectivePoint,base58check=createBase58check(sha256$5);function bytesToNumber(r){abytes$1(r);const t=r.length===0?"0":bytesToHex$4(r);return BigInt("0x"+t)}function numberToBytes(r){if(typeof r!="bigint")throw new Error("bigint expected");return hexToBytes$4(r.toString(16).padStart(64,"0"))}const MASTER_SECRET=utf8ToBytes$5("Bitcoin seed"),BITCOIN_VERSIONS={private:76066276,public:76067358},HARDENED_OFFSET=2147483648,hash160=r=>ripemd160(sha256$5(r)),fromU32=r=>createView$4(r).getUint32(0,!1),toU32=r=>{if(!Number.isSafeInteger(r)||r<0||r>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+r);const t=new Uint8Array(4);return createView$4(t).setUint32(0,r,!1),t};class HDKey{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return fromU32(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const t=this.privateKey;if(!t)throw new Error("No private key");return base58check.encode(this.serialize(this.versions.private,concatBytes$4(new Uint8Array([0]),t)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return base58check.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(t,n=BITCOIN_VERSIONS){if(abytes$1(t),8*t.length<128||8*t.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+t.length);const s=hmac$3(sha512$1,MASTER_SECRET,t);return new HDKey({versions:n,chainCode:s.slice(32),privateKey:s.slice(0,32)})}static fromExtendedKey(t,n=BITCOIN_VERSIONS){const s=base58check.decode(t),o=createView$4(s),a=o.getUint32(0,!1),c={versions:n,depth:s[4],parentFingerprint:o.getUint32(5,!1),index:o.getUint32(9,!1),chainCode:s.slice(13,45)},f=s.slice(45),g=f[0]===0;if(a!==n[g?"private":"public"])throw new Error("Version mismatch");return g?new HDKey({...c,privateKey:f.slice(1)}):new HDKey({...c,publicKey:f})}static fromJSON(t){return HDKey.fromExtendedKey(t.xpriv)}constructor(t){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!t||typeof t!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=t.versions||BITCOIN_VERSIONS,this.depth=t.depth||0,this.chainCode=t.chainCode||null,this.index=t.index||0,this.parentFingerprint=t.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(t.publicKey&&t.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(t.privateKey){if(!secp256k1$2.utils.isValidPrivateKey(t.privateKey))throw new Error("Invalid private key");this.privKey=typeof t.privateKey=="bigint"?t.privateKey:bytesToNumber(t.privateKey),this.privKeyBytes=numberToBytes(this.privKey),this.pubKey=secp256k1$2.getPublicKey(t.privateKey,!0)}else if(t.publicKey)this.pubKey=Point$1.fromHex(t.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=hash160(this.pubKey)}derive(t){if(!/^[mM]'?/.test(t))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(t))return this;const n=t.replace(/^[mM]'?\//,"").split("/");let s=this;for(const o of n){const a=/^(\d+)('?)$/.exec(o),c=a&&a[1];if(!a||a.length!==3||typeof c!="string")throw new Error("invalid child index: "+o);let f=+c;if(!Number.isSafeInteger(f)||f>=HARDENED_OFFSET)throw new Error("Invalid index");a[2]==="'"&&(f+=HARDENED_OFFSET),s=s.deriveChild(f)}return s}deriveChild(t){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let n=toU32(t);if(t>=HARDENED_OFFSET){const f=this.privateKey;if(!f)throw new Error("Could not derive hardened child key");n=concatBytes$4(new Uint8Array([0]),f,n)}else n=concatBytes$4(this.pubKey,n);const s=hmac$3(sha512$1,this.chainCode,n),o=bytesToNumber(s.slice(0,32)),a=s.slice(32);if(!secp256k1$2.utils.isValidPrivateKey(o))throw new Error("Tweak bigger than curve order");const c={versions:this.versions,chainCode:a,depth:this.depth+1,parentFingerprint:this.fingerprint,index:t};try{if(this.privateKey){const f=mod$2(this.privKey+o,secp256k1$2.CURVE.n);if(!secp256k1$2.utils.isValidPrivateKey(f))throw new Error("The tweak was out of range or the resulted private key is invalid");c.privateKey=f}else{const f=Point$1.fromHex(this.pubKey).add(Point$1.fromPrivateKey(o));if(f.equals(Point$1.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");c.publicKey=f.toRawBytes(!0)}return new HDKey(c)}catch{return this.deriveChild(t+1)}}sign(t){if(!this.privateKey)throw new Error("No privateKey set!");return abytes$1(t,32),secp256k1$2.sign(t,this.privKey).toCompactRawBytes()}verify(t,n){if(abytes$1(t,32),abytes$1(n,64),!this.publicKey)throw new Error("No publicKey set!");let s;try{s=secp256k1$2.Signature.fromCompact(n)}catch{return!1}return secp256k1$2.verify(s,t,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(t,n){if(!this.chainCode)throw new Error("No chainCode set");return abytes$1(n,33),concatBytes$4(toU32(t),new Uint8Array([this.depth]),toU32(this.parentFingerprint),toU32(this.index),this.chainCode,n)}}function D(r){return Yr.toBase64(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function U(r){return Yr.fromBase64(r)}function j(r){const t=JSON.stringify(r);return v$1(Yr.toBase64(Yr.fromString(t)))}function x$1(r){const t=Yr.toString(Yr.fromBase64($(r)));return JSON.parse(t)}function $(r){return r.replace(/-/g,"+").replace(/_/g,"/").split("=")[0]}function v$1(r){return r.replace(/\+/g,"-").replace(/\//g,"_").split("=")[0]}function u$1(r){if(typeof r!="string"||r.length===0)return!1;const t=/^[A-Za-z0-9\-_]+={0,2}$/,n=/^[A-Za-z0-9+/]+={0,2}$/;if(!t.test(r)&&!n.test(r))return!1;const s=r.replace(/-/g,"+").replace(/_/g,"/"),o=(4-s.length%4)%4;if(o>2)return!1;const a=s+"=".repeat(o);try{const c=Yr.fromBase64(a),f=Yr.toBase64(c),g=f.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),b=s.replace(/=+$/,"");return f.replace(/=+$/,"")===b||g===b}catch{return!1}}const S$1="m/129372'/0'",T$1=(r,t,n)=>{const s=/^[a-fA-F0-9]+$/.test(t);if(!s&&u$1(t)||s&&t.startsWith("00"))return i$2(r,t,n,0);if(s&&t.startsWith("01"))return p$2(r,t,n,0);throw new Error(`Unrecognized keyset ID version ${t.slice(0,2)}`)},z=(r,t,n)=>{const s=/^[a-fA-F0-9]+$/.test(t);if(!s&&u$1(t)||s&&t.startsWith("00"))return i$2(r,t,n,1);if(s&&t.startsWith("01"))return p$2(r,t,n,1);throw new Error(`Unrecognized keyset ID version ${t.slice(0,2)}`)},p$2=(r,t,n,s)=>{let o=Yr.concat(Yr.fromString("Cashu_KDF_HMAC_SHA256"),Yr.fromHex(t),Yr.writeBigUint64BE(BigInt(n)));switch(s){case 0:o=Yr.concat(o,Yr.fromHex("00"));break;case 1:o=Yr.concat(o,Yr.fromHex("01"))}return hmac$3(sha256$5,r,o)},i$2=(r,t,n,s)=>{const o=HDKey.fromMasterSeed(r),a=K$1(t),c=`${S$1}/${a}'/${n}'/${s}`,f=o.derive(c);if(f.privateKey===null)throw new Error("Could not derive private key");return f.privateKey},e=r=>{try{return r instanceof Uint8Array&&(r=new TextDecoder().decode(r)),JSON.parse(r)}catch{throw new Error("can't parse secret")}},p$1=(r,t)=>{const n=sha256$4(r),s=schnorr$2.sign(n,t);return bytesToHex$3(s)},h=(r,t,n)=>{try{const s=sha256$4(t),o=n.length===66?n.slice(2):n;if(schnorr$2.verify(r,s,hexToBytes$3(o)))return!0}catch(s){console.error("verifyP2PKsecret error:",s)}return!1};function d$2(r){try{const t=typeof r=="string"?e(r):r;if(t[0]!=="P2PK")throw new Error('Invalid P2PK secret: must start with "P2PK"');const n=Math.floor(Date.now()/1e3);return w(t)>n?E(t):I$1(t)}catch{}return[]}function E(r){const t=typeof r=="string"?e(r):r;if(t[0]!=="P2PK")throw new Error('Invalid P2PK secret: must start with "P2PK"');const{data:n,tags:s}=t[1],o=s&&s.find(c=>c[0]==="pubkeys"),a=o&&o.length>1?o.slice(1):[];return[n,...a].filter(Boolean)}function I$1(r){const t=typeof r=="string"?e(r):r;if(t[0]!=="P2PK")throw new Error('Invalid P2PK secret: must start with "P2PK"');const{tags:n}=t[1],s=n&&n.find(o=>o[0]==="refund");return s&&s.length>1?s.slice(1).filter(Boolean):[]}function w(r){const t=typeof r=="string"?e(r):r;if(t[0]!=="P2PK")throw new Error('Invalid P2PK secret: must start with "P2PK"');const{tags:n}=t[1],s=n&&n.find(o=>o[0]==="locktime");return s&&s.length>1?parseInt(s[1],10):1/0}const K=r=>{if(!r)return[];if(typeof r=="string")try{return JSON.parse(r).signatures||[]}catch(t){return console.error("Failed to parse witness string:",t),[]}return r.signatures||[]},W$1=(r,t,n=!1)=>{const s=Array.isArray(t)?t:[t];return r.map((o,a)=>{let c=o;for(const f of s)try{c=T(c,f)}catch(g){const b=g instanceof Error?g.message:"Unknown error";if(n)throw new Error(`Failed signing proof #${a+1}: ${b}`);console.warn(`Proof #${a+1}: ${b}`)}return c})},T=(r,t)=>{const n=e(r.secret);if(n[0]!=="P2PK")throw new Error("not a P2PK secret");const s=bytesToHex$3(schnorr$2.getPublicKey(t)),o=d$2(n);if(!o.length||!o.some(f=>f.includes(s)))throw new Error(`Signature not required from [02|03]${s}`);const a=K(r.witness);if(a.some(f=>{try{return h(f,r.secret,s)}catch{return!1}}))throw new Error(`Proof already signed by [02|03]${s}`);const c=p$1(r.secret,t);return a.push(c),{...r,witness:{signatures:a}}};function u(r,t){let n=r;for(const o of t)n+=o.B_;const s=new TextEncoder().encode(n);return sha256$4(s)}function p(r,t,n){const s=u(t,n),o=hexToBytes$4(r),a=schnorr$2.sign(s,o);return bytesToHex$4(a)}function l(r,t,n){const s=T$2(r);t||(t=Vr(secp256k1$2.utils.randomPrivateKey()));const o=secp256k1$2.ProjectivePoint.BASE.multiply(t);return{B_:s.add(o),r:t,secret:r}}function C(r,t,n){return r.subtract(n.multiply(t))}function y(r,t,n,s){const o=s,a=C(r.C_,t,o);return{id:r.id,amount:r.amount,secret:n,C:a}}const v=r=>({amount:r.amount,C:r.C.toHex(!0),id:r.id,secret:new TextDecoder().decode(r.secret),witness:JSON.stringify(r.witness)});function ie$2(r){return typeof r=="number"||typeof r=="string"}function wt(r){const t=[];return kt(r,t),new Uint8Array(t)}function kt(r,t){if(r===null)t.push(246);else if(r===void 0)t.push(247);else if(typeof r=="boolean")t.push(r?245:244);else if(typeof r=="number")Ot(r,t);else if(typeof r=="string")Nt(r,t);else if(Array.isArray(r))ce(r,t);else if(r instanceof Uint8Array)ae(r,t);else if(typeof r=="object"&&r!==null&&!Array.isArray(r))ue(r,t);else throw new Error("Unsupported type")}function Ot(r,t){if(r<24)t.push(r);else if(r<256)t.push(24,r);else if(r<65536)t.push(25,r>>8,r&255);else if(r<4294967296)t.push(26,r>>24,r>>16&255,r>>8&255,r&255);else throw new Error("Unsupported integer size")}function ae(r,t){const n=r.length;if(n<24)t.push(64+n);else if(n<256)t.push(88,n);else if(n<65536)t.push(89,n>>8&255,n&255);else if(n<4294967296)t.push(90,n>>24&255,n>>16&255,n>>8&255,n&255);else throw new Error("Byte string too long to encode");for(let s=0;s<r.length;s++)t.push(r[s])}function Nt(r,t){const n=new TextEncoder().encode(r),s=n.length;if(s<24)t.push(96+s);else if(s<256)t.push(120,s);else if(s<65536)t.push(121,s>>8&255,s&255);else if(s<4294967296)t.push(122,s>>24&255,s>>16&255,s>>8&255,s&255);else throw new Error("String too long to encode");for(let o=0;o<n.length;o++)t.push(n[o])}function ce(r,t){const n=r.length;if(n<24)t.push(128|n);else if(n<256)t.push(152,n);else if(n<65536)t.push(153,n>>8,n&255);else throw new Error("Unsupported array length");for(const s of r)kt(s,t)}function ue(r,t){const n=Object.keys(r);Ot(n.length,t),t[t.length-1]|=160;for(const s of n)Nt(s,t),kt(r[s],t)}function bt(r){const t=new DataView(r.buffer,r.byteOffset,r.byteLength);return it(t,0).value}function it(r,t){if(t>=r.byteLength)throw new Error("Unexpected end of data");const n=r.getUint8(t++),s=n>>5,o=n&31;switch(s){case 0:return he(r,t,o);case 1:return le(r,t,o);case 2:return de(r,t,o);case 3:return fe$1(r,t,o);case 4:return me(r,t,o);case 5:return pe(r,t,o);case 7:return ge$1(r,t,o);default:throw new Error(`Unsupported major type: ${s}`)}}function V(r,t,n){if(n<24)return{value:n,offset:t};if(n===24)return{value:r.getUint8(t++),offset:t};if(n===25){const s=r.getUint16(t,!1);return t+=2,{value:s,offset:t}}if(n===26){const s=r.getUint32(t,!1);return t+=4,{value:s,offset:t}}if(n===27){const s=r.getUint32(t,!1),o=r.getUint32(t+4,!1);return t+=8,{value:s*2**32+o,offset:t}}throw new Error(`Unsupported length: ${n}`)}function he(r,t,n){const{value:s,offset:o}=V(r,t,n);return{value:s,offset:o}}function le(r,t,n){const{value:s,offset:o}=V(r,t,n);return{value:-1-s,offset:o}}function de(r,t,n){const{value:s,offset:o}=V(r,t,n);if(o+s>r.byteLength)throw new Error("Byte string length exceeds data length");return{value:new Uint8Array(r.buffer,r.byteOffset+o,s),offset:o+s}}function fe$1(r,t,n){const{value:s,offset:o}=V(r,t,n);if(o+s>r.byteLength)throw new Error("String length exceeds data length");const a=new Uint8Array(r.buffer,r.byteOffset+o,s);return{value:new TextDecoder().decode(a),offset:o+s}}function me(r,t,n){const{value:s,offset:o}=V(r,t,n),a=[];let c=o;for(let f=0;f<s;f++){const g=it(r,c);a.push(g.value),c=g.offset}return{value:a,offset:c}}function pe(r,t,n){const{value:s,offset:o}=V(r,t,n),a={};let c=o;for(let f=0;f<s;f++){const g=it(r,c);if(!ie$2(g.value))throw new Error("Invalid key type");const b=it(r,g.offset);a[g.value]=b.value,c=b.offset}return{value:a,offset:c}}function ye(r){const t=(r&31744)>>10,n=r&1023,s=r&32768?-1:1;return t===0?s*2**-14*(n/1024):t===31?n?NaN:s*(1/0):s*2**(t-15)*(1+n/1024)}function ge$1(r,t,n){if(n<24)switch(n){case 20:return{value:!1,offset:t};case 21:return{value:!0,offset:t};case 22:return{value:null,offset:t};case 23:return{value:void 0,offset:t};default:throw new Error(`Unknown simple value: ${n}`)}if(n===24)return{value:r.getUint8(t++),offset:t};if(n===25){const s=ye(r.getUint16(t,!1));return t+=2,{value:s,offset:t}}if(n===26){const s=r.getFloat32(t,!1);return t+=4,{value:s,offset:t}}if(n===27){const s=r.getFloat64(t,!1);return t+=8,{value:s,offset:t}}throw new Error(`Unknown simple or float value: ${n}`)}const we="A",ke="cashu";function R(r,t,n,s){if(n){const a=Rt(n);if(r===0&&a===0)return n;const c=n.filter(g=>g>0),f=Rt(c);if(f>r)throw new Error(`Split is greater than total amount: ${f} > ${r}`);if(c.some(g=>!Lt(g,t)))throw new Error("Provided amount preferences do not match the amounts of the mint keyset.");if(f===r)return c;n=c,r-=f}else n=[];const o=Qt(t,"desc");if(!o||o.length===0)throw new Error("Cannot split amount, keyset is inactive or contains no keys");if(o.forEach(a=>{if(r<=0||a<=0)return;const c=Math.floor(r/a);for(let f=0;f<c;++f)n.push(a);r%=a}),r!==0)throw new Error(`Unable to split remaining amount: ${r}`);return n.sort((a,c)=>a-c)}function vt(r,t,n,s){const o=[],a=r.map(f=>f.amount);Qt(n,"asc").forEach(f=>{const g=a.filter(_=>_===f).length,b=Math.max(s-g,0);for(let _=0;_<b&&!(o.reduce((L,q)=>L+q,0)+f>t);++_)o.push(f)});const c=t-o.reduce((f,g)=>f+g,0);return c&&R(c,n).forEach(f=>{o.push(f)}),o.sort((f,g)=>f-g)}function Qt(r,t="desc"){return t=="desc"?Object.keys(r).map(n=>parseInt(n)).sort((n,s)=>s-n):Object.keys(r).map(n=>parseInt(n)).sort((n,s)=>n-s)}function Lt(r,t){return r in t}function be(r){return Ct(bytesToHex$3(r))}function Ct(r){return BigInt(`0x${r}`)}function _e(r){return r.toString(16).padStart(64,"0")}function Tt(r){return/^[a-f0-9]*$/i.test(r)}function Et(r){return Array.isArray(r)?r.some(t=>!Tt(t.id)):!Tt(r.id)}function Ee(r,t){Et(r.proofs)||(r.proofs=Wt(r.proofs));const n={token:[{mint:r.mint,proofs:r.proofs}]};return r.unit&&(n.unit=r.unit),r.memo&&(n.memo=r.memo),ke+we+j(n)}function Wt(r){return r.map(t=>{const n={...t};return n.id=n.id.slice(0,16),n})}function Ye(r,t){return Et(r.proofs)||t?.version===3?Ee(r):Ae(r)}function Ae(r,t){if(r.proofs.forEach(f=>{if(f.dleq&&f.dleq.r==null)throw new Error("Missing blinding factor in included DLEQ proof")}),Et(r.proofs))throw new Error("can not encode to v4 token if proofs contain non-hex keyset id");r.proofs=Wt(r.proofs);const n=jt(r),s=wt(n),o="cashu",a="B",c=D(s);return o+a+c}function jt(r){const t={},n=r.mint;for(let o=0;o<r.proofs.length;o++){const a=r.proofs[o];t[a.id]?t[a.id].push(a):t[a.id]=[a]}const s={m:n,u:r.unit||"sat",t:Object.keys(t).map(o=>({i:hexToBytes$3(o),p:t[o].map(a=>({a:a.amount,s:a.secret,c:hexToBytes$3(a.C),...a.dleq&&{d:{e:hexToBytes$3(a.dleq.e),s:hexToBytes$3(a.dleq.s),r:hexToBytes$3(a.dleq.r??"00")}},...a.witness&&{w:JSON.stringify(a.witness)}}))}))};return r.memo&&(s.d=r.memo),s}function $t(r){const t=[];r.t.forEach(s=>s.p.forEach(o=>{t.push({secret:o.s,C:bytesToHex$3(o.c),amount:o.a,id:bytesToHex$3(s.i),...o.d&&{dleq:{r:bytesToHex$3(o.d.r),s:bytesToHex$3(o.d.s),e:bytesToHex$3(o.d.e)}},...o.w&&{witness:o.w}})}));const n={mint:r.m,proofs:t,unit:r.u||"sat"};return r.d&&(n.memo=r.d),n}function Pe(r,t){["web+cashu://","cashu://","cashu:","cashu"].forEach(s=>{r.startsWith(s)&&(r=r.slice(s.length))});const n=Se(r);return n.proofs=Be(n.proofs,t),n}function Se(r){const t=r.slice(0,1),n=r.slice(1);if(t==="A"){const s=x$1(n);if(s.token.length>1)throw new Error("Multi entry token are not supported");const o=s.token[0],a={mint:o.mint,proofs:o.proofs,unit:s.unit||"sat"};return s.memo&&(a.memo=s.memo),a}else if(t==="B"){const s=U(n),o=bt(s);return $t(o)}throw new Error("Token version is not supported")}function Ie(r,t,n,s=0,o=!1){let a=Object.entries(r).sort((g,b)=>+g[0]-+b[0]).map(([,g])=>hexToBytes$3(g)).reduce((g,b)=>dt(g,b),new Uint8Array);if(o){const g=sha256$5(a);return Yr.toBase64(g).slice(0,12)}let c,f;switch(s){case 0:return c=sha256$5(a),f=Yr.toHex(c).slice(0,14),"00"+f;case 1:if(!t)throw new Error("Cannot compute keyset ID version 01: unit is required.");return a=dt(a,Yr.fromString("unit:"+t)),n&&(a=dt(a,Yr.fromString("final_expiry:"+n.toString()))),c=sha256$5(a),f=Yr.toHex(c),"01"+f;default:throw new Error(`Unrecognized keyset ID version: ${s}`)}}function dt(r,t){const n=new Uint8Array(r.length+t.length);return n.set(r),n.set(t,r.length),n}function x(r){return typeof r=="object"}function S(...r){return r.map(t=>t.replace(/(^\/+|\/+$)/g,"")).join("/")}function zt(r){return r.replace(/\/$/,"")}function W(r){return r.reduce((t,n)=>t+n.amount,0)}class Me{get value(){return this._value}set value(t){this._value=t}get next(){return this._next}set next(t){this._next=t}constructor(t){this._value=t,this._next=null}}class qe{get first(){return this._first}set first(t){this._first=t}get last(){return this._last}set last(t){this._last=t}get size(){return this._size}set size(t){this._size=t}constructor(){this._first=null,this._last=null,this._size=0}enqueue(t){const n=new Me(t);return this._size===0||!this._last?(this._first=n,this._last=n):(this._last.next=n,this._last=n),this._size++,!0}dequeue(){if(this._size===0||!this._first)return null;const t=this._first;return this._first=t.next,t.next=null,this._size--,t.value}}function at(r){return r.map(t=>{const n={...t};return delete n.dleq,n})}function Dt(r){const t=u$1(r.id),n=/^[a-fA-F0-9]+$/.test(r.id),s=n?hexToBytes$3(r.id)[0]:0;return Ie(r.keys,r.unit,r.final_expiry,s,t&&!n)===r.id}function Be(r,t){const n=[];for(const s of r){let o;try{o=hexToBytes$3(s.id)}catch{n.push(s);continue}if(o[0]===0)n.push(s);else if(o[0]===1){if(!t)throw new Error("A short keyset ID v2 was encountered, but got no keysets to map it to.");let a=!1;for(const c of t)if(s.id===c.id.slice(0,s.id.length)){s.id=c.id,n.push(s),a=!0;break}if(!a)throw new Error(`Couldn't map short keyset ID ${s.id} to any known keysets of the current Mint`)}else throw new Error(`Unknown keyset ID version: ${o[0]}`)}return n}function Ht(r,t){if(r.dleq==null)return!1;const n={e:hexToBytes$3(r.dleq.e),s:hexToBytes$3(r.dleq.s),r:Ct(r.dleq.r??"00")};if(!Lt(r.amount,t.keys))throw new Error(`undefined key for amount ${r.amount}`);const s=t.keys[r.amount];return d$3(new TextEncoder().encode(r.secret),n,l$1(r.C),l$1(s))}function Rt(r){return r.reduce((t,n)=>t+n,0)}let ct;typeof WebSocket<"u"&&(ct=WebSocket);function Te(){if(ct===void 0)throw new Error("WebSocket implementation not initialized");return ct}const F={fatal(){},error(){},warn(){},info(){},debug(){},trace(){},log(){}};function De(){const r=Date.now();return{elapsed:()=>Date.now()-r}}class G{constructor(){this.connectionMap=new Map}static getInstance(){return G.instance||(G.instance=new G),G.instance}getConnection(t,n){if(this.connectionMap.has(t))return this.connectionMap.get(t);const s=new Re(t,n);return this.connectionMap.set(t,s),s}}class Re{constructor(t,n){this.subListeners={},this.rpcListeners={},this.rpcId=0,this.onCloseCallbacks=[],this._WS=Te(),this.url=new URL(t),this.messageQueue=new qe,this._logger=n??F}connect(){return this.connectionPromise||(this.connectionPromise=new Promise((t,n)=>{try{this.ws=new this._WS(this.url.toString()),this.onCloseCallbacks=[]}catch(s){n(s instanceof Error?s:new Error(String(s)));return}this.ws.onopen=()=>{t()},this.ws.onerror=()=>{n(new Error("Failed to open WebSocket"))},this.ws.onmessage=s=>{this.messageQueue.enqueue(s.data),this.handlingInterval||(this.handlingInterval=setInterval(this.handleNextMessage.bind(this),0))},this.ws.onclose=s=>{this.connectionPromise=void 0,this.onCloseCallbacks.forEach(o=>o(s))}})),this.connectionPromise}sendRequest(t,n){if(this.ws?.readyState!==1){if(t==="unsubscribe")return;throw this._logger.error("Attempted sendRequest, but socket was not open"),new Error("Socket not open")}const s=this.rpcId;this.rpcId++;const o=JSON.stringify({jsonrpc:"2.0",method:t,params:n,id:s});this.ws?.send(o)}closeSubscription(t){this.ws?.send(JSON.stringify(["CLOSE",t]))}addSubListener(t,n){(this.subListeners[t]=this.subListeners[t]||[]).push(n)}addRpcListener(t,n,s){this.rpcListeners[s]={callback:t,errorCallback:n}}removeRpcListener(t){delete this.rpcListeners[t]}removeListener(t,n){if(this.subListeners[t]){if(this.subListeners[t].length===1){delete this.subListeners[t];return}this.subListeners[t]=this.subListeners[t].filter(s=>s!==n)}}async ensureConnection(){this.ws?.readyState!==1&&await this.connect()}handleNextMessage(){if(this.messageQueue.size===0){clearInterval(this.handlingInterval),this.handlingInterval=void 0;return}const t=this.messageQueue.dequeue();let n;try{if(n=JSON.parse(t),"result"in n&&n.id!=null)this.rpcListeners[n.id]&&(this.rpcListeners[n.id].callback(),this.removeRpcListener(n.id));else if("error"in n&&n.id!=null)this.rpcListeners[n.id]&&(this.rpcListeners[n.id].errorCallback(new Error(n.error.message)),this.removeRpcListener(n.id));else if("method"in n&&!("id"in n)){const s=n.params?.subId;if(!s)return;if(this.subListeners[s]?.length>0){const o=n;this.subListeners[s].forEach(a=>a(o.params?.payload))}}}catch(s){this._logger.error("Error doing handleNextMessage",{e:s});return}}createSubscription(t,n,s){if(this.ws?.readyState!==1)throw this._logger.error("Attempted createSubscription, but socket was not open"),new Error("Socket is not open");const o=(Math.random()+1).toString(36).substring(7);return this.addRpcListener(()=>{this.addSubListener(o,n)},s,this.rpcId),this.sendRequest("subscribe",{...t,subId:o}),this.rpcId++,o}cancelSubscription(t,n,s){this.removeListener(t,n),this.addRpcListener(()=>{this._logger.info("Unsubscribed {subId}",{subId:t})},s||(o=>this._logger.error("Unsubscribe failed",{e:o})),this.rpcId),this.sendRequest("unsubscribe",{subId:t})}get activeSubscriptions(){return Object.keys(this.subListeners)}close(){this.ws&&this.ws?.close()}onClose(t){this.onCloseCallbacks.push(t)}}const ns={UNSPENT:"UNSPENT",SPENT:"SPENT"},tt$1={UNPAID:"UNPAID",PENDING:"PENDING",PAID:"PAID"},yt={UNPAID:"UNPAID",PAID:"PAID"};class et extends Error{constructor(t,n){super(t),this.status=n,this.name="HttpResponseError",Object.setPrototypeOf(this,et.prototype)}}class At extends Error{constructor(t){super(t),this.name="NetworkError",Object.setPrototypeOf(this,At.prototype)}}class Pt extends et{constructor(t,n){super(n||"Unknown mint operation error",400),this.code=t,this.name="MintOperationError",Object.setPrototypeOf(this,Pt.prototype)}}let Gt={},Vt=F;function Ke(r){Vt=r}async function xe({endpoint:r,requestBody:t,headers:n,...s}){const o=t?JSON.stringify(t):void 0,a={Accept:"application/json, text/plain, */*",...o?{"Content-Type":"application/json"}:void 0,...n};let c;try{c=await fetch(r,{body:o,headers:a,...s})}catch(f){throw new At(f instanceof Error?f.message:"Network request failed")}if(!c.ok){let f;try{f=await c.json()}catch{f={error:"bad response"}}if(c.status===400&&"code"in f&&typeof f.code=="number"&&"detail"in f&&typeof f.detail=="string")throw new Pt(f.code,f.detail);let g="HTTP request failed";throw"error"in f&&typeof f.error=="string"?g=f.error:"detail"in f&&typeof f.detail=="string"&&(g=f.detail),new et(g,c.status)}try{return await c.json()}catch(f){throw Vt.error("Failed to parse HTTP response",{err:f}),new et("bad response",c.status)}}async function I(r){return await xe({...r,...Gt})}function ft(r,t){return r.state||(t.warn("Field 'state' not found in MeltQuoteResponse. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),typeof r.paid=="boolean"&&(r.state=r.paid?tt$1.PAID:tt$1.UNPAID)),r}function Kt(r,t){return r.state||(t.warn("Field 'state' not found in MintQuoteResponse. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),typeof r.paid=="boolean"&&(r.state=r.paid?yt.PAID:yt.UNPAID)),r}function Fe(r,t){return Array.isArray(r?.contact)&&r?.contact.length>0&&(r.contact=r.contact.map(n=>Array.isArray(n)&&n.length===2&&typeof n[0]=="string"&&typeof n[1]=="string"?(t.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:n[0],info:n[1]}):n)),r}class gt{constructor(t){this._mintInfo=t,t.nuts[22]&&(this._protectedEnpoints={cache:{},apiReturn:t.nuts[22].protected_endpoints.map(n=>({method:n.method,regex:new RegExp(n.path)}))})}isSupported(t){switch(t){case 4:case 5:return this.checkMintMelt(t);case 7:case 8:case 9:case 10:case 11:case 12:case 14:case 20:return this.checkGenericNut(t);case 17:return this.checkNut17();case 15:return this.checkNut15();default:throw new Error("nut is not supported by cashu-ts")}}requiresBlindAuthToken(t){if(!this._protectedEnpoints)return!1;if(typeof this._protectedEnpoints.cache[t]=="boolean")return this._protectedEnpoints.cache[t];const n=this._protectedEnpoints.apiReturn.some(s=>s.regex.test(t));return this._protectedEnpoints.cache[t]=n,n}checkGenericNut(t){return this._mintInfo.nuts[t]?.supported?{supported:!0}:{supported:!1}}checkMintMelt(t){const n=this._mintInfo.nuts[t];return n&&n.methods.length>0&&!n.disabled?{disabled:!1,params:n.methods}:{disabled:!0,params:n.methods}}checkNut17(){return this._mintInfo.nuts[17]&&this._mintInfo.nuts[17].supported.length>0?{supported:!0,params:this._mintInfo.nuts[17].supported}:{supported:!1}}checkNut15(){return this._mintInfo.nuts[15]&&this._mintInfo.nuts[15].methods.length>0?{supported:!0,params:this._mintInfo.nuts[15].methods}:{supported:!1}}get contact(){return this._mintInfo.contact}get description(){return this._mintInfo.description}get description_long(){return this._mintInfo.description_long}get name(){return this._mintInfo.name}get pubkey(){return this._mintInfo.pubkey}get nuts(){return this._mintInfo.nuts}get version(){return this._mintInfo.version}get motd(){return this._mintInfo.motd}get supportsBolt12Description(){return this._mintInfo.nuts[4]?.methods.some(t=>t.method==="bolt12"&&t.options?.description===!0)}}class M{constructor(t,n,s,o){this._mintUrl=t,this._customRequest=n,this._checkNut22=!1,this._mintUrl=zt(t),this._customRequest=n,s&&(this._checkNut22=!0,this._authTokenGetter=s),this._logger=o?.logger??F,Ke(this._logger)}get mintUrl(){return this._mintUrl}static async getInfo(t,n,s){const o=s??F,a=await(n||I)({endpoint:S(t,"/v1/info")});return Fe(a,o)}async getInfo(){return M.getInfo(this._mintUrl,this._customRequest,this._logger)}async getLazyMintInfo(){if(this._mintInfo)return this._mintInfo;const t=await M.getInfo(this._mintUrl,this._customRequest);return this._mintInfo=new gt(t),this._mintInfo}static async swap(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{},f=await a({endpoint:S(t,"/v1/swap"),method:"POST",requestBody:n,headers:c});if(!x(f)||!Array.isArray(f?.signatures))throw new Error(f.detail??"bad response");return f}async swap(t){const n=await this.handleBlindAuth("/v1/swap");return M.swap(this._mintUrl,t,this._customRequest,n)}static async createMintQuote(t,n,s,o,a){const c=a??F,f=s||I,g=o?{"Blind-auth":o}:{},b=await f({endpoint:S(t,"/v1/mint/quote/bolt11"),method:"POST",requestBody:n,headers:g});return Kt(b,c)}async createMintQuote(t){const n=await this.handleBlindAuth("/v1/mint/quote/bolt11");return M.createMintQuote(this._mintUrl,t,this._customRequest,n)}static async createMintQuoteBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{};return await a({endpoint:S(t,"/v1/mint/quote/bolt12"),method:"POST",requestBody:n,headers:c})}async createMintQuoteBolt12(t){const n=await this.handleBlindAuth("/v1/mint/quote/bolt12");return M.createMintQuoteBolt12(this._mintUrl,t,this._customRequest,n)}static async checkMintQuote(t,n,s,o,a){const c=a??F,f=s||I,g=o?{"Blind-auth":o}:{},b=await f({endpoint:S(t,"/v1/mint/quote/bolt11",n),method:"GET",headers:g});return Kt(b,c)}async checkMintQuote(t){const n=await this.handleBlindAuth(`/v1/mint/quote/bolt11/${t}`);return M.checkMintQuote(this._mintUrl,t,this._customRequest,n)}static async checkMintQuoteBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{};return await a({endpoint:S(t,"/v1/mint/quote/bolt12",n),method:"GET",headers:c})}async checkMintQuoteBolt12(t){const n=await this.handleBlindAuth(`/v1/mint/quote/bolt12/${t}`);return M.checkMintQuoteBolt12(this._mintUrl,t,this._customRequest,n)}static async mint(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{},f=await a({endpoint:S(t,"/v1/mint/bolt11"),method:"POST",requestBody:n,headers:c});if(!x(f)||!Array.isArray(f?.signatures))throw new Error("bad response");return f}async mint(t){const n=await this.handleBlindAuth("/v1/mint/bolt11");return M.mint(this._mintUrl,t,this._customRequest,n)}static async mintBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{},f=await a({endpoint:S(t,"/v1/mint/bolt12"),method:"POST",requestBody:n,headers:c});if(!x(f)||!Array.isArray(f?.signatures))throw new Error("bad response");return f}async mintBolt12(t){const n=await this.handleBlindAuth("/v1/mint/bolt12");return M.mintBolt12(this._mintUrl,t,this._customRequest,n)}static async createMeltQuote(t,n,s,o,a){const c=a??F,f=s||I,g=o?{"Blind-auth":o}:{},b=await f({endpoint:S(t,"/v1/melt/quote/bolt11"),method:"POST",requestBody:n,headers:g}),_=ft(b,c);if(!x(_)||typeof _?.amount!="number"||typeof _?.fee_reserve!="number"||typeof _?.quote!="string")throw new Error("bad response");return _}async createMeltQuote(t){const n=await this.handleBlindAuth("/v1/melt/quote/bolt11");return M.createMeltQuote(this._mintUrl,t,this._customRequest,n)}static async createMeltQuoteBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{};return await a({endpoint:S(t,"/v1/melt/quote/bolt12"),method:"POST",requestBody:n,headers:c})}async createMeltQuoteBolt12(t){const n=await this.handleBlindAuth("/v1/melt/quote/bolt12");return M.createMeltQuoteBolt12(this._mintUrl,t,this._customRequest,n)}static async checkMeltQuote(t,n,s,o,a){const c=a??F,f=s||I,g=o?{"Blind-auth":o}:{},b=await f({endpoint:S(t,"/v1/melt/quote/bolt11",n),method:"GET",headers:g}),_=ft(b,c);if(!x(_)||typeof _?.amount!="number"||typeof _?.fee_reserve!="number"||typeof _?.quote!="string"||typeof _?.state!="string"||!Object.values(tt$1).includes(_.state))throw new Error("bad response");return _}async checkMeltQuote(t){const n=await this.handleBlindAuth(`/v1/melt/quote/bolt11/${t}`);return M.checkMeltQuote(this._mintUrl,t,this._customRequest,n)}static async checkMeltQuoteBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{};return await a({endpoint:S(t,"/v1/melt/quote/bolt12",n),method:"GET",headers:c})}async checkMeltQuoteBolt12(t){const n=await this.handleBlindAuth(`/v1/melt/quote/bolt12/${t}`);return M.checkMeltQuoteBolt12(this._mintUrl,t,this._customRequest,n)}static async melt(t,n,s,o,a){const c=a??F,f=s||I,g=o?{"Blind-auth":o}:{},b=await f({endpoint:S(t,"/v1/melt/bolt11"),method:"POST",requestBody:n,headers:g}),_=ft(b,c);if(!x(_)||typeof _?.state!="string"||!Object.values(tt$1).includes(_.state))throw new Error("bad response");return _}async melt(t){const n=await this.handleBlindAuth("/v1/melt/bolt11");return M.melt(this._mintUrl,t,this._customRequest,n)}static async meltBolt12(t,n,s,o){const a=s||I,c=o?{"Blind-auth":o}:{};return await a({endpoint:S(t,"/v1/melt/bolt12"),method:"POST",requestBody:n,headers:c})}async meltBolt12(t){const n=await this.handleBlindAuth("/v1/melt/bolt12");return M.meltBolt12(this._mintUrl,t,this._customRequest,n)}static async check(t,n,s){const o=await(s||I)({endpoint:S(t,"/v1/checkstate"),method:"POST",requestBody:n});if(!x(o)||!Array.isArray(o?.states))throw new Error("bad response");return o}static async getKeys(t,n,s){n&&(n=n.replace(/\//g,"_").replace(/\+/g,"-"));const o=await(s||I)({endpoint:n?S(t,"/v1/keys",n):S(t,"/v1/keys")});if(!x(o)||!Array.isArray(o.keysets))throw new Error("bad response");return o}async getKeys(t,n){return await M.getKeys(n||this._mintUrl,t,this._customRequest)}static async getKeySets(t,n){return(n||I)({endpoint:S(t,"/v1/keysets")})}async getKeySets(){return M.getKeySets(this._mintUrl,this._customRequest)}async check(t){return M.check(this._mintUrl,t,this._customRequest)}static async restore(t,n,s){const o=await(s||I)({endpoint:S(t,"/v1/restore"),method:"POST",requestBody:n});if(!x(o)||!Array.isArray(o?.outputs)||!Array.isArray(o?.signatures))throw new Error("bad response");return o}async restore(t){return M.restore(this._mintUrl,t,this._customRequest)}async connectWebSocket(){if(this.ws)await this.ws.ensureConnection();else{const t=new URL(this._mintUrl),n="v1/ws";t.pathname&&(t.pathname.endsWith("/")?t.pathname+=n:t.pathname+="/"+n),this.ws=G.getInstance().getConnection(`${t.protocol==="https:"?"wss":"ws"}://${t.host}${t.pathname}`);try{await this.ws.connect()}catch(s){throw this._logger.error("Failed to connect to WebSocket...",{e:s}),new Error("Failed to connect to WebSocket...")}}}disconnectWebSocket(){this.ws&&this.ws.close()}get webSocketConnection(){return this.ws}async handleBlindAuth(t){if(this._checkNut22&&(await this.getLazyMintInfo()).requiresBlindAuthToken(t)){if(!this._authTokenGetter)throw new Error("Can not call a protected endpoint without authProofGetter");return this._authTokenGetter()}}}class mt{constructor(t,n,s){this.amount=t,this.B_=n,this.id=s}getSerializedBlindedMessage(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}}}function pt(r){return typeof r=="function"}class N{constructor(t,n,s){this.secret=s,this.blindingFactor=n,this.blindedMessage=t}toProof(t,n){let s;t.dleq&&(s={s:hexToBytes$4(t.dleq.s),e:hexToBytes$4(t.dleq.e),r:this.blindingFactor});const o={id:t.id,amount:t.amount,C_:l$1(t.C_)},a=l$1(n.keys[t.amount]),c=y(o,this.blindingFactor,this.secret,a);return{...v(c),...s&&{dleq:{s:bytesToHex$4(s.s),e:bytesToHex$4(s.e),r:_e(s.r??BigInt(0))}}}}static createP2PKData(t,n,s,o){return R(n,s.keys,o).map(a=>this.createSingleP2PKData(t,a,s.id))}static createSingleP2PKData(t,n,s){const o=Array.isArray(t.pubkey)?t.pubkey:[t.pubkey],a=Math.max(1,Math.min(t.requiredSignatures||1,o.length)),c=Math.max(1,Math.min(t.requiredRefundSignatures||1,t.refundKeys?t.refundKeys.length:1)),f=["P2PK",{nonce:bytesToHex$4(randomBytes$3(32)),data:o[0],tags:[]}];t.locktime&&f[1].tags.push(["locktime",String(t.locktime)]),o.length>1&&(f[1].tags.push(["pubkeys",...o.slice(1)]),a>1&&f[1].tags.push(["n_sigs",String(a)])),t.refundKeys&&(f[1].tags.push(["refund",...t.refundKeys]),c>1&&f[1].tags.push(["n_sigs_refund",String(c)]));const g=JSON.stringify(f),b=new TextEncoder().encode(g),{r:_,B_:L}=l(b);return new N(new mt(n,L,s).getSerializedBlindedMessage(),_,b)}static createRandomData(t,n,s){return R(t,n.keys,s).map(o=>this.createSingleRandomData(o,n.id))}static createSingleRandomData(t,n){const s=bytesToHex$4(randomBytes$3(32)),o=new TextEncoder().encode(s),{r:a,B_:c}=l(o);return new N(new mt(t,c,n).getSerializedBlindedMessage(),a,o)}static createDeterministicData(t,n,s,o,a){return R(t,o.keys,a).map((c,f)=>this.createSingleDeterministicData(c,n,s+f,o.id))}static createSingleDeterministicData(t,n,s,o){const a=T$1(n,o,s),c=bytesToHex$4(a),f=new TextEncoder().encode(c),g=be(z(n,o,s)),{r:b,B_:_}=l(f,g);return new N(new mt(t,_,o).getSerializedBlindedMessage(),b,f)}}const Oe=3,Ne="sat";class rs{constructor(t,n){this._keys=new Map,this._keysets=[],this._seed=void 0,this._unit=Ne,this._mintInfo=void 0,this._denominationTarget=Oe,this.mint=t,this._logger=n?.logger??F;let s=[];if(n?.keys&&!Array.isArray(n.keys)?s=[n.keys]:n?.keys&&Array.isArray(n?.keys)&&(s=n?.keys),s&&s.forEach(o=>this._keys.set(o.id,o)),n?.unit&&(this._unit=n?.unit),n?.keysets&&(this._keysets=n.keysets),n?.mintInfo&&(this._mintInfo=new gt(n.mintInfo)),n?.denominationTarget&&(this._denominationTarget=n.denominationTarget),n?.bip39seed){if(n.bip39seed instanceof Uint8Array){this._seed=n.bip39seed;return}throw new Error("bip39seed must be a valid UInt8Array")}n?.keepFactory&&(this._keepFactory=n.keepFactory)}get unit(){return this._unit}get keys(){return this._keys}get keysetId(){if(!this._keysetId)throw new Error("No keysetId set");return this._keysetId}set keysetId(t){this._keysetId=t}get keysets(){return this._keysets}get mintInfo(){if(!this._mintInfo)throw new Error("Mint info not loaded");return this._mintInfo}async getMintInfo(){const t=await this.mint.getInfo();return this._mintInfo=new gt(t),this._mintInfo}async lazyGetMintInfo(){return this._mintInfo?this._mintInfo:await this.getMintInfo()}async loadMint(){await Promise.all([this.getMintInfo(),this.getKeys()])}getActiveKeyset(t){let n=t.filter(o=>o.active&&o.unit===this._unit);n=n.filter(o=>o.id.startsWith("00"));const s=n.sort((o,a)=>(o.input_fee_ppk??0)-(a.input_fee_ppk??0))[0];if(!s)throw new Error("No active keyset found");return s}async getKeySets(){const t=(await this.mint.getKeySets()).keysets.filter(n=>n.unit===this._unit);return this._keysets=t,this._keysets}async getAllKeys(){const t=await this.mint.getKeys();return t.keysets.forEach(n=>{if(!Dt(n))throw new Error(`Couldn't verify keyset ID ${n.id}`)}),this._keys=new Map(t.keysets.map(n=>[n.id,n])),this.keysetId=this.getActiveKeyset(this._keysets).id,t.keysets}async getKeys(t,n){if((!(this._keysets.length>0)||n)&&await this.getKeySets(),t||(t=this.getActiveKeyset(this._keysets).id),!this._keysets.find(s=>s.id===t)&&(await this.getKeySets(),!this._keysets.find(s=>s.id===t)))throw new Error(`could not initialize keys. No keyset with id '${t}' found`);if(!this._keys.get(t)){const s=await this.mint.getKeys(t);if(!Dt(s.keysets[0]))throw new Error(`Couldn't verify keyset ID ${s.keysets[0].id}`);this._keys.set(t,s.keysets[0])}return this.keysetId=t,this._keys.get(t)}async receive(t,n){const{requireDleq:s,keysetId:o,outputAmounts:a,counter:c,pubkey:f,privkey:g,outputData:b,p2pk:_}=n||{};this._keysets.length===0&&await this.getKeySets(),typeof t=="string"&&(t=Pe(t,this._keysets));const L=await this.getKeys(o);if(s&&t.proofs.some(Ge=>!Ht(Ge,L)))throw new Error("Token contains proofs with invalid DLEQ");const q=W(t.proofs)-this.getFeesForProofs(t.proofs);let X;b?X={send:b}:this._keepFactory&&(X={send:this._keepFactory});const te=this.createSwapPayload(q,t.proofs,L,a,c,f,g,X,_),{signatures:ne}=await this.mint.swap(te.payload),Ce=te.outputData.map((Ge,ze)=>Ge.toProof(ne[ze],L)),Le=[];return te.sortedIndices.forEach((Ge,ze)=>{Le[Ge]=Ce[ze]}),Le}async send(t,n,s){const{offline:o,includeFees:a,includeDleq:c,keysetId:f,outputAmounts:g,pubkey:b,privkey:_,outputData:L}=s||{};if(c&&(n=n.filter(ne=>ne.dleq!=null)),W(n)<t)throw new Error("Not enough funds available to send");const{keep:q,send:X}=this.selectProofsToSend(n,t,s?.includeFees),te=a?this.getFeesForProofs(X):0;if(!o&&(W(X)!=t+te||g||b||_||f||L)){const ne=await this.swap(t,n,s),{keep:Ce,send:Le}=ne,Ge=ne.serialized;return{keep:Ce,send:Le,serialized:Ge}}if(W(X)<t+te)throw new Error("Not enough funds available to send");return{keep:q,send:X}}selectProofsToSend(t,n,s=!1){const o=De();let a=null,c=1/0,f=0,g=0;const b=(Xe,He)=>Xe-(s?Math.ceil(He/1e3):0),_=Xe=>{const He=[...Xe];for(let Ve=He.length-1;Ve>0;Ve--){const We=Math.floor(Math.random()*(Ve+1));[He[Ve],He[We]]=[He[We],He[Ve]]}return He},L=(Xe,He,Ve)=>{let We=0,rt=Xe.length-1,st=null;for(;We<=rt;){const ht=Math.floor((We+rt)/2),je=Xe[ht].exFee;(Ve?je<=He:je>=He)?(st=ht,Ve?We=ht+1:rt=ht-1):Ve?rt=ht-1:We=ht+1}return Ve?st:We<Xe.length?We:null},q=(Xe,He)=>{const Ve=He.exFee;let We=0,rt=Xe.length;for(;We<rt;){const st=Math.floor((We+rt)/2);Xe[st].exFee<Ve?We=st+1:rt=st}Xe.splice(We,0,He)},X=(Xe,He)=>b(Xe,He)<n?1/0:Xe+He/1e3-n;let te=0,ne=0;const Ce=t.map(Xe=>{const He=this.getProofFeePPK(Xe),Ve=s?Xe.amount-He/1e3:Xe.amount,We={proof:Xe,exFee:Ve,ppkfee:He};return(!s||Ve>0)&&(te+=Xe.amount,ne+=He),We});let Le=s?Ce.filter(Xe=>Xe.exFee>0):Ce;if(Le.sort((Xe,He)=>Xe.exFee-He.exFee),Le.length>0){let Xe;{const He=L(Le,n,!1);if(He!==null){const Ve=Le[He].exFee,We=L(Le,Ve,!0);if(We===null)throw new Error("Unexpected null rightIndex in binary search");Xe=We+1}else Xe=Le.length}for(let He=Xe;He<Le.length;He++)te-=Le[He].proof.amount,ne-=Le[He].ppkfee;Le=Le.slice(0,Xe)}const Ge=b(te,ne);if(n<=0||n>Ge)return{keep:t,send:[]};const ze=Math.min(Math.ceil(n*(1+0/100)),n+0,Ge);for(let Xe=0;Xe<60;Xe++){const He=[];let Ve=0,We=0;for(const se of _(Le)){const m=Ve+se.proof.amount,A=We+se.ppkfee,k=b(m,A);if(He.push(se),Ve=m,We=A,k>=n)break}const rt=new Set(He),st=Le.filter(se=>!rt.has(se)),ht=_(Array.from({length:He.length},(se,m)=>m)).slice(0,5e3);for(const se of ht){const m=b(Ve,We);if(m===n||m>=n&&m<=ze)break;const A=He[se],k=Ve-A.proof.amount,Y=We-A.ppkfee,Q=b(k,Y),$e=n-Q,ve=L(st,$e,!1);if(ve!==null){const re=st[ve];($e>=0||re.exFee<=A.exFee)&&(He[se]=re,Ve=k+re.proof.amount,We=Y+re.ppkfee,st.splice(ve,1),q(st,A))}}const je=X(Ve,We);if(je<c){this._logger.debug("selectProofsToSend: best solution found in trial #{trial} - amount: {amount}, delta: {delta}",{trial:Xe,amount:Ve,delta:je}),a=[...He].sort((m,A)=>A.exFee-m.exFee),c=je,f=Ve,g=We;const se=[...a];for(;se.length>1&&c>0;){const m=se.pop(),A=Ve-m.proof.amount,k=We-m.ppkfee,Y=X(A,k);if(Y==1/0)break;Y<c&&(a=[...se],c=Y,f=A,g=k,Ve=A,We=k)}}if(a&&c<1/0){const se=b(f,g);if(se===n||se>=n&&se<=ze)break}if(o.elapsed()>1e3){this._logger.warn("Proof selection took too long. Returning best selection so far.");break}}if(a&&c<1/0){const Xe=a.map(We=>We.proof),He=new Set(Xe),Ve=t.filter(We=>!He.has(We));return this._logger.info("Proof selection took {time}ms",{time:o.elapsed()}),{keep:Ve,send:Xe}}return{keep:t,send:[]}}getFeesForProofs(t){const n=t.reduce((s,o)=>s+this.getProofFeePPK(o),0);return Math.ceil(n/1e3)}getProofFeePPK(t){const n=this._keysets.find(s=>s.id===t.id);if(!n)throw new Error(`Could not get fee. No keyset found for keyset id: ${t.id}`);return n?.input_fee_ppk||0}getFeesForKeyset(t,n){return Math.floor(Math.max((t*(this._keysets.find(s=>s.id===n)?.input_fee_ppk||0)+999)/1e3,0))}async swap(t,n,s){let{outputAmounts:o}=s||{};const{includeFees:a,keysetId:c,counter:f,pubkey:g,privkey:b,proofsWeHave:_,outputData:L,p2pk:q}=s||{},X=await this.getKeys(c);let te=t;const ne=W(n);let Ce=o?.sendAmounts||R(te,X.keys);if(a){let A=this.getFeesForKeyset(Ce.length,X.id),k=R(A,X.keys);for(;this.getFeesForKeyset(Ce.concat(k).length,X.id)>A;)A++,k=R(A,X.keys);Ce=Ce.concat(k),te+=A}const{keep:Le,send:Ge}=this.selectProofsToSend(n,te,!0),ze=W(Ge)-this.getFeesForProofs(Ge)-te;if(ze<0)throw new Error("Not enough balance to send");let Xe;if(!o?.keepAmounts&&!_)Xe=R(ze,X.keys);else if(!o?.keepAmounts&&_)Xe=vt(_,ze,X.keys,this._denominationTarget);else if(o){if(o.keepAmounts?.reduce((A,k)=>A+k,0)!=ze)throw new Error("Keep amounts do not match amount to keep");Xe=o.keepAmounts}if(te+this.getFeesForProofs(Ge)>ne)throw this._logger.error(`Not enough funds available (${ne}) for swap amountToSend: ${te} + fee: ${this.getFeesForProofs(Ge)} | length: ${Ge.length}`),new Error("Not enough funds available for swap");o={keepAmounts:Xe,sendAmounts:Ce};const He=L?.keep||this._keepFactory,Ve=L?.send,We=this.createSwapPayload(te,Ge,X,o,f,g,b,{keep:He,send:Ve},q),{signatures:rt}=await this.mint.swap(We.payload),st=We.outputData.map((A,k)=>A.toProof(rt[k],X)),ht=[],je=[],se=Array(We.keepVector.length),m=Array(st.length);return We.sortedIndices.forEach((A,k)=>{se[A]=We.keepVector[k],m[A]=st[k]}),m.forEach((A,k)=>{se[k]?ht.push(A):je.push(A)}),{keep:[...ht,...Le],send:je}}async batchRestore(t=300,n=100,s=0,o){const a=Math.ceil(t/n),c=[];let f,g=0;for(;g<a;){const b=await this.restore(s,n,{keysetId:o});b.proofs.length>0?(g=0,c.push(...b.proofs),f=b.lastCounterWithSignature):g++,s+=n}return{proofs:c,lastCounterWithSignature:f}}async restore(t,n,s){const{keysetId:o}=s||{},a=await this.getKeys(o);if(!this._seed)throw new Error("CashuWallet must be initialized with a seed to use restore");const c=Array(n).fill(0),f=N.createDeterministicData(0,this._seed,t,a,c),{outputs:g,signatures:b}=await this.mint.restore({outputs:f.map(X=>X.blindedMessage)}),_={};g.forEach((X,te)=>_[X.B_]=b[te]);const L=[];let q;for(let X=0;X<f.length;X++){const te=_[f[X].blindedMessage.B_];te&&(q=t+X,f[X].blindedMessage.amount=te.amount,L.push(f[X].toProof(te,a)))}return{proofs:L,lastCounterWithSignature:q}}async createMintQuote(t,n){const s={unit:this._unit,amount:t,description:n},o=await this.mint.createMintQuote(s);return{...o,amount:o.amount||t,unit:o.unit||this.unit}}async createLockedMintQuote(t,n,s){const{supported:o}=(await this.lazyGetMintInfo()).isSupported(20);if(!o)throw new Error("Mint does not support NUT-20");const a={unit:this._unit,amount:t,description:s,pubkey:n},c=await this.mint.createMintQuote(a);if(typeof c.pubkey!="string")throw new Error("Mint returned unlocked mint quote");{const f=c.pubkey;return{...c,pubkey:f,amount:c.amount||t,unit:c.unit||this.unit}}}async createMintQuoteBolt12(t,n){const s=await this.lazyGetMintInfo();if(n?.description&&!s.supportsBolt12Description)throw new Error("Mint does not support description for bolt12");const o={pubkey:t,unit:this._unit,amount:n?.amount,description:n?.description};return this.mint.createMintQuoteBolt12(o)}async checkMintQuote(t){const n=typeof t=="string"?t:t.quote,s=await this.mint.checkMintQuote(n);return typeof t=="string"?s:{...s,amount:s.amount||t.amount,unit:s.unit||t.unit}}async checkMintQuoteBolt12(t){return this.mint.checkMintQuoteBolt12(t)}async mintProofs(t,n,s){return this._mintProofs("bolt11",t,n,s)}async mintProofsBolt12(t,n,s,o){return this._mintProofs("bolt12",t,n,{...o,privateKey:s})}async createMeltQuote(t){const n={unit:this._unit,request:t},s=await this.mint.createMeltQuote(n);return{...s,unit:s.unit||this.unit,request:s.request||t}}async createMeltQuoteBolt12(t,n){return this.mint.createMeltQuoteBolt12({unit:this._unit,request:t,options:n?{amountless:{amount_msat:n}}:void 0})}async createMultiPathMeltQuote(t,n){const{supported:s,params:o}=(await this.lazyGetMintInfo()).isSupported(15);if(!s)throw new Error("Mint does not support NUT-15");if(!o?.some(f=>f.method==="bolt11"&&f.unit===this.unit))throw new Error(`Mint does not support MPP for bolt11 and ${this.unit}`);const a={mpp:{amount:n}},c={unit:this._unit,request:t,options:a};return{...await this.mint.createMeltQuote(c),request:t,unit:this._unit}}async checkMeltQuote(t){const n=typeof t=="string"?t:t.quote,s=await this.mint.checkMeltQuote(n);return typeof t=="string"?s:{...s,request:t.request,unit:t.unit}}async checkMeltQuoteBolt12(t){return this.mint.checkMeltQuoteBolt12(t)}async meltProofs(t,n,s){return this._meltProofs("bolt11",t,n,s)}async meltProofsBolt12(t,n,s){return this._meltProofs("bolt12",t,n,s)}createSwapPayload(t,n,s,o,a,c,f,g,b){const _=n.reduce((ze,Xe)=>ze+Xe.amount,0);o&&o.sendAmounts&&!o.keepAmounts&&(o.keepAmounts=R(_-t-this.getFeesForProofs(n),s.keys));const L=_-t-this.getFeesForProofs(n);let q=[],X=[];if(g?.keep)if(pt(g.keep)){const ze=g.keep;R(L,s.keys).forEach(Xe=>{q.push(ze(Xe,s))})}else q=g.keep;else q=this.createOutputData(L,s,a,void 0,o?.keepAmounts,void 0,this._keepFactory);if(g?.send)if(pt(g.send)){const ze=g.send;R(t,s.keys).forEach(Xe=>{X.push(ze(Xe,s))})}else X=g.send;else X=this.createOutputData(t,s,a?a+q.length:void 0,c,o?.sendAmounts,b);f&&(n=W$1(n,f)),n=at(n),n=n.map(ze=>{const Xe=ze.witness&&typeof ze.witness!="string"?JSON.stringify(ze.witness):ze.witness;return{...ze,witness:Xe}});const te=[...q,...X],ne=te.map((ze,Xe)=>Xe).sort((ze,Xe)=>te[ze].blindedMessage.amount-te[Xe].blindedMessage.amount),Ce=[...Array.from({length:q.length},()=>!0),...Array.from({length:X.length},()=>!1)],Le=ne.map(ze=>te[ze]),Ge=ne.map(ze=>Ce[ze]);return{payload:{inputs:n,outputs:Le.map(ze=>ze.blindedMessage)},outputData:Le,keepVector:Ge,sortedIndices:ne}}async checkProofsStates(t){const n=new TextEncoder,s=t.map(c=>T$2(n.encode(c.secret)).toHex(!0)),o=100,a=[];for(let c=0;c<s.length;c+=o){const f=s.slice(c,c+o),{states:g}=await this.mint.check({Ys:f}),b={};g.forEach(_=>{b[_.Y]=_});for(let _=0;_<f.length;_++){const L=b[f[_]];if(!L)throw new Error("Could not find state for proof with Y: "+f[_]);a.push(L)}}return a}async onMintQuoteUpdates(t,n,s){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const o=this.mint.webSocketConnection.createSubscription({kind:"bolt11_mint_quote",filters:t},n,s);return()=>{this.mint.webSocketConnection?.cancelSubscription(o,n)}}async onMeltQuotePaid(t,n,s){return this.onMeltQuoteUpdates([t],o=>{o.state===tt$1.PAID&&n(o)},s)}async onMintQuotePaid(t,n,s){return this.onMintQuoteUpdates([t],o=>{o.state===yt.PAID&&n(o)},s)}async onMeltQuoteUpdates(t,n,s){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const o=this.mint.webSocketConnection.createSubscription({kind:"bolt11_melt_quote",filters:t},n,s);return()=>{this.mint.webSocketConnection?.cancelSubscription(o,n)}}async onProofStateUpdates(t,n,s){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw new Error("failed to establish WebSocket connection.");const o=new TextEncoder,a={};for(let g=0;g<t.length;g++){const b=T$2(o.encode(t[g].secret)).toHex(!0);a[b]=t[g]}const c=Object.keys(a),f=this.mint.webSocketConnection.createSubscription({kind:"proof_state",filters:c},g=>{n({...g,proof:a[g.Y]})},s);return()=>{this.mint.webSocketConnection?.cancelSubscription(f,n)}}createOutputData(t,n,s,o,a,c,f){let g;if(o)g=N.createP2PKData({pubkey:o},t,n,a);else if(s||s===0){if(!this._seed)throw new Error("cannot create deterministic messages without seed");g=N.createDeterministicData(t,this._seed,s,n,a)}else c?g=N.createP2PKData(c,t,n,a):f?g=R(t,n.keys).map(b=>f(b,n)):g=N.createRandomData(t,n,a);return g}createBlankOutputs(t,n,s,o){let a=Math.ceil(Math.log2(t))||1;a<0&&(a=0);const c=a?Array(a).fill(0):[];return this.createOutputData(0,n,s,void 0,c,void 0,o)}async _mintProofs(t,n,s,o){let{outputAmounts:a}=o||{};const{counter:c,pubkey:f,p2pk:g,keysetId:b,proofsWeHave:_,outputData:L,privateKey:q}=o||{},X=await this.getKeys(b);!a&&_&&(a={keepAmounts:vt(_,n,X.keys,this._denominationTarget),sendAmounts:[]});let te=[];if(L)if(pt(L)){const Le=R(n,X.keys,a?.keepAmounts);for(let Ge=0;Ge<Le.length;Ge++)te.push(L(Le[Ge],X))}else te=L;else if(this._keepFactory){const Le=R(n,X.keys,a?.keepAmounts);for(let Ge=0;Ge<Le.length;Ge++)te.push(this._keepFactory(Le[Ge],X))}else te=this.createOutputData(n,X,c,f,a?.keepAmounts,g);let ne;if(typeof s!="string"){if(!q)throw new Error("Can not sign locked quote without private key");const Le=te.map(ze=>ze.blindedMessage),Ge=p(q,s.quote,Le);ne={outputs:Le,quote:s.quote,signature:Ge}}else ne={outputs:te.map(Le=>Le.blindedMessage),quote:s};if(t==="bolt12"){const{signatures:Le}=await this.mint.mintBolt12(ne);return te.map((Ge,ze)=>Ge.toProof(Le[ze],X))}const{signatures:Ce}=await this.mint.mint(ne);return te.map((Le,Ge)=>Le.toProof(Ce[Ge],X))}async _meltProofs(t,n,s,o){const{keysetId:a,counter:c,privkey:f}=o||{},g=await this.getKeys(a),b=this.createBlankOutputs(W(s)-n.amount,g,c,this._keepFactory);f!=null&&(s=W$1(s,f)),s=at(s),s=s.map(q=>{const X=q.witness&&typeof q.witness!="string"?JSON.stringify(q.witness):q.witness;return{...q,witness:X}});const _={quote:n.quote,inputs:s,outputs:b.map(q=>q.blindedMessage)};if(t==="bolt12"){const q=await this.mint.meltBolt12(_);return{quote:{...q,unit:n.unit,request:n.request},change:q.change?.map((X,te)=>b[te].toProof(X,g))??[]}}const L=await this.mint.melt(_);return{quote:{...L,unit:n.unit,request:n.request},change:L.change?.map((q,X)=>b[X].toProof(q,g))??[]}}}var FRAME_SIZE_LIMITS={MINIMUM:4096,DEFAULT:5e4},TIMEOUTS={SYNC_SESSION:5e3,CACHE_QUERY:5e3,EVENT_FETCH:1e4,RELAY_CONNECTION:3e4},RANGE_SPLITTING={BUCKET_COUNT:16,MIN_ELEMENTS_FOR_BUCKETS:32},BUFFER_SIZES={DEFAULT_WRAPPED_BUFFER_SIZE:512,FRAME_SIZE_SAFETY_MARGIN:200};function isWrappedBuffer(r){return r instanceof WrappedBuffer}function isUint8Array(r){return r instanceof Uint8Array&&!isWrappedBuffer(r)}var PROTOCOL_VERSION=97,ID_SIZE=32,FINGERPRINT_SIZE=16;function encodeVarInt(r){if(r===0)return new Uint8Array([0]);const t=[];for(;r!==0;)t.push(r&127),r>>>=7;t.reverse();for(let n=0;n<t.length-1;n++)t[n]|=128;return new Uint8Array(t)}function decodeVarInt(r){if(!isWrappedBuffer(r)&&!isUint8Array(r))throw new Error("Invalid buffer type: expected Uint8Array or WrappedBuffer");let t=0;for(;;){if(r.length===0)throw new Error("VarInt decoding: unexpected end of buffer");const n=shiftByte(r);if(t=t<<7|n&127,(n&128)===0)break}return t}function getByte(r){return getBytes(r,1)[0]}function getBytes(r,t){if(!isWrappedBuffer(r)&&!isUint8Array(r))throw new Error("Invalid buffer type: expected Uint8Array or WrappedBuffer");if(r.length<t)throw new Error("getBytes: unexpected end of buffer");return isWrappedBuffer(r)?r.shiftN(t):r.slice(0,t)}function shiftByte(r){if(!isWrappedBuffer(r)&&!isUint8Array(r))throw new Error("Invalid buffer type: expected Uint8Array or WrappedBuffer");return isWrappedBuffer(r)?r.shift():r[0]}function compareUint8Array(r,t){const n=Math.min(r.length,t.length);for(let s=0;s<n;s++){if(r[s]<t[s])return-1;if(r[s]>t[s])return 1}return r.length<t.length?-1:r.length>t.length?1:0}function hexToUint8Array(r){if(r.startsWith("0x")&&(r=r.slice(2)),r.length%2!==0)throw new Error("Hex string has odd length");const t=new Uint8Array(r.length/2);for(let n=0;n<t.length;n++)t[n]=Number.parseInt(r.slice(n*2,n*2+2),16);return t}var hexLookupTable=new Array(256);{const r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];for(let t=0;t<256;t++)hexLookupTable[t]=r[t>>>4&15]+r[t&15]}function uint8ArrayToHex(r){let t="";for(let n=0;n<r.length;n++)t+=hexLookupTable[r[n]];return t}var WrappedBuffer=class Eo{constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(BUFFER_SIZES.DEFAULT_WRAPPED_BUFFER_SIZE),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}append(t){const n=t instanceof Eo?t.unwrap():t,s=n.length+this.length;if(this.capacity<s){const o=this._raw,a=Math.max(this.capacity*2,s);this._raw=new Uint8Array(a),this._raw.set(o)}this._raw.set(n,this.length),this.length+=n.length}set(t){const n=t instanceof Uint8Array?t:new Uint8Array(t);this.capacity<n.length&&(this._raw=new Uint8Array(Math.max(this.capacity*2,n.length))),this._raw.set(n),this.length=n.length}shift(){if(this.length===0)throw new Error("Cannot shift from empty buffer");const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t){if(this.length<t)throw new Error("Cannot shift more bytes than available");const n=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,n}clear(){this.length=0}},Accumulator=class{constructor(){this.buf=new Uint8Array(ID_SIZE),this.setToZero()}setToZero(){this.buf=new Uint8Array(ID_SIZE)}add(r){let t=0,n=0;const s=new DataView(this.buf.buffer),o=new DataView(r.buffer);for(let a=0;a<8;a++){const c=a*4,f=s.getUint32(c,!0),g=o.getUint32(c,!0);let b=f;b+=t,b+=g,b>4294967295&&(n=1),s.setUint32(c,b&4294967295,!0),t=n,n=0}}negate(){const r=new DataView(this.buf.buffer);for(let n=0;n<8;n++){const s=n*4;r.setUint32(s,~r.getUint32(s,!0),!0)}const t=new Uint8Array(ID_SIZE);t[0]=1,this.add(t)}async getFingerprint(r){const t=new Uint8Array(this.buf.length+encodeVarInt(r).length);return t.set(this.buf),t.set(encodeVarInt(r),this.buf.length),(await this.sha256(t)).subarray(0,FINGERPRINT_SIZE)}async sha256(r){if(crypto?.subtle){const t=await crypto.subtle.digest("SHA-256",r.buffer);return new Uint8Array(t)}try{const t=await __vitePreload(()=>import("./BIHI7g3E.js"),[],import.meta.url);return new Uint8Array(t.createHash("sha256").update(r).digest())}catch{throw new Error("No SHA256 implementation available")}}};function itemCompare(r,t){return r.timestamp!==t.timestamp?r.timestamp-t.timestamp:compareUint8Array(r.id,t.id)}var NegentropyStorage=class _o{constructor(){this.items=[],this.sealed=!1}static fromEvents(t){const n=new _o;for(const s of t)n.insert(s.created_at||0,s.id);return n.seal(),n}insert(t,n){if(this.sealed)throw new Error("Storage is sealed, cannot insert");const s=typeof n=="string"?hexToUint8Array(n):n;if(s.length!==ID_SIZE)throw new Error(`Invalid ID size: expected ${ID_SIZE}, got ${s.length}`);this.items.push({timestamp:t,id:s})}seal(){if(this.sealed)throw new Error("Storage is already sealed");this.sealed=!0,this.items.sort(itemCompare);for(let t=1;t<this.items.length;t++)if(itemCompare(this.items[t-1],this.items[t])===0)throw new Error("Duplicate item in storage")}unseal(){this.sealed=!1}size(){return this.checkSealed(),this.items.length}getItem(t){if(this.checkSealed(),t>=this.items.length)throw new Error("Index out of range");return this.items[t]}iterate(t,n,s){this.checkSealed(),this.checkBounds(t,n);for(let o=t;o<n&&s(this.items[o],o);o++);}findLowerBound(t,n,s){return this.checkSealed(),this.checkBounds(t,n),this.binarySearch(this.items,t,n,o=>itemCompare(o,s)<0)}async fingerprint(t,n){const s=new Accumulator;return s.setToZero(),this.iterate(t,n,o=>(s.add(o.id),!0)),await s.getFingerprint(n-t)}checkSealed(){if(!this.sealed)throw new Error("Storage is not sealed")}checkBounds(t,n){if(t>n||n>this.items.length)throw new Error("Invalid range")}binarySearch(t,n,s,o){let a=s-n;for(;a>0;){let c=n;const f=Math.floor(a/2);c+=f,o(t[c])?(n=++c,a-=f+1):a=f}return n}},Negentropy=class{constructor(r,t=0){if(this.lastTimestampIn=0,this.lastTimestampOut=0,this.isInitiator=!1,t!==0&&t<FRAME_SIZE_LIMITS.MINIMUM)throw new Error(`frameSizeLimit too small (minimum ${FRAME_SIZE_LIMITS.MINIMUM} bytes)`);this.storage=r,this.frameSizeLimit=t}bound(r,t){return{timestamp:r,id:t||new Uint8Array(0)}}async initiate(){if(this.isInitiator)throw new Error("Already initiated");this.isInitiator=!0;const r=new WrappedBuffer;return r.set([PROTOCOL_VERSION]),await this.splitRange(0,this.storage.size(),this.bound(Number.MAX_VALUE),r),r.unwrap()}setInitiator(){this.isInitiator=!0}async reconcile(r){const t=[],n=[],s=new WrappedBuffer(r);this.lastTimestampIn=this.lastTimestampOut=0;const o=new WrappedBuffer;o.set([PROTOCOL_VERSION]);const a=this.validateProtocolVersion(s);if(!a.isValid)return{nextMessage:a.output.unwrap(),have:t,need:n};const c=this.storage.size();let f=this.bound(0),g=0,b=!1;for(;s.length!==0;){const _=new WrappedBuffer,L=()=>{b&&(b=!1,_.append(this.encodeBound(f)),_.append(encodeVarInt(0)))},q=this.decodeBound(s),X=s.length===0?0:decodeVarInt(s),te=g,ne=this.storage.findLowerBound(g,c,q),Ce=await this.processByMode(X,te,ne,q,s,_,o,L,t,n);if(Ce.shouldSkip&&(b=!0),this.exceededFrameSizeLimit(o.length+_.length)){const Le=await this.storage.fingerprint(ne,c);o.append(this.encodeBound(this.bound(Number.MAX_VALUE))),o.append(encodeVarInt(1)),o.append(Le);break}Ce.outputAlreadyAppended||o.append(_.unwrap()),g=ne,f=q}return{nextMessage:o.length===1&&this.isInitiator?void 0:o.unwrap(),have:t,need:n}}validateProtocolVersion(r){const t=new WrappedBuffer;t.set([PROTOCOL_VERSION]);const n=getByte(r);if(n<96||n>111)throw new Error("Invalid negentropy protocol version byte");if(n!==PROTOCOL_VERSION){if(this.isInitiator)throw new Error(`Unsupported negentropy protocol version requested: ${n-96}`);return{isValid:!1,output:t}}return{isValid:!0,output:t}}async processByMode(r,t,n,s,o,a,c,f,g,b){if(r===0)return this.handleModeSkip();if(r===1)return await this.handleModeFingerprint(t,n,s,o,a,f);if(r===2)return await this.handleModeIdList(t,n,s,o,a,c,f,g,b);throw new Error("Unexpected mode")}handleModeSkip(){return{shouldSkip:!0,outputAlreadyAppended:!1}}async handleModeFingerprint(r,t,n,s,o,a){const c=getBytes(s,FINGERPRINT_SIZE),f=await this.storage.fingerprint(r,t);return compareUint8Array(c,f)!==0?(a(),await this.splitRange(r,t,n,o),{shouldSkip:!1,outputAlreadyAppended:!1}):{shouldSkip:!0,outputAlreadyAppended:!1}}async handleModeIdList(r,t,n,s,o,a,c,f,g){const b=decodeVarInt(s),_=new Map;for(let L=0;L<b;L++){const q=getBytes(s,ID_SIZE),X=Array.from(q).join(",");_.set(X,q)}return this.isInitiator?this.handleIdListAsInitiator(r,t,_,f,g):await this.handleIdListAsResponder(r,t,n,o,a,c)}handleIdListAsInitiator(r,t,n,s,o){this.storage.iterate(r,t,a=>{const c=Array.from(a.id).join(",");return n.has(c)?n.delete(c):s.push(a.id),!0});for(const a of n.values())o.push(a);return{shouldSkip:!0,outputAlreadyAppended:!1}}async handleIdListAsResponder(r,t,n,s,o,a){a();const c=new WrappedBuffer;let f=0,g=n;return this.storage.iterate(r,t,(b,_)=>this.exceededFrameSizeLimit(o.length+c.length)?(g=b,!1):(c.append(b.id),f++,!0)),s.append(this.encodeBound(g)),s.append(encodeVarInt(2)),s.append(encodeVarInt(f)),s.append(c.unwrap()),o.append(s.unwrap()),s.clear(),{shouldSkip:!1,outputAlreadyAppended:!0}}async splitRange(r,t,n,s){const o=t-r,a=RANGE_SPLITTING.BUCKET_COUNT;if(o<RANGE_SPLITTING.MIN_ELEMENTS_FOR_BUCKETS)s.append(this.encodeBound(n)),s.append(encodeVarInt(2)),s.append(encodeVarInt(o)),this.storage.iterate(r,t,c=>(s.append(c.id),!0));else{const c=Math.floor(o/a),f=o%a;let g=r;for(let b=0;b<a;b++){const _=c+(b<f?1:0),L=await this.storage.fingerprint(g,g+_);g+=_;let q;if(g===t)q=n;else{let X,te;if(this.storage.iterate(g-1,g+1,(ne,Ce)=>(Ce===g-1?X=ne:te=ne,!0)),!X||!te)throw new Error(`Failed to get items at index ${g-1} and ${g} for bound calculation`);q=this.getMinimalBound(X,te)}s.append(this.encodeBound(q)),s.append(encodeVarInt(1)),s.append(L)}}}exceededFrameSizeLimit(r){return this.frameSizeLimit>0&&r>this.frameSizeLimit-BUFFER_SIZES.FRAME_SIZE_SAFETY_MARGIN}decodeTimestampIn(r){let t=decodeVarInt(r);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(r){const t=this.decodeTimestampIn(r),n=decodeVarInt(r);if(n>ID_SIZE)throw new Error("Bound key too long");const s=new Uint8Array(ID_SIZE),o=getBytes(r,Math.min(n,r.length));return s.set(o),{timestamp:t,id:s}}encodeTimestampOut(r){if(r===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,encodeVarInt(0);const t=r;return r-=this.lastTimestampOut,this.lastTimestampOut=t,encodeVarInt(r+1)}encodeBound(r){const t=this.encodeTimestampOut(r.timestamp),n=encodeVarInt(r.id.length),s=new Uint8Array(t.length+n.length+r.id.length);return s.set(t),s.set(n,t.length),s.set(r.id,t.length+n.length),s}getMinimalBound(r,t){if(t.timestamp!==r.timestamp)return this.bound(t.timestamp);let n=0;for(let s=0;s<ID_SIZE&&t.id[s]===r.id[s];s++)n++;return this.bound(t.timestamp,t.id.subarray(0,n+1))}};function isNegMessage(r){return Array.isArray(r)&&r.length>=2&&typeof r[0]=="string"&&typeof r[1]=="string"}function isNegMsgWithPayload(r){return isNegMessage(r)&&r.length===3&&typeof r[2]=="string"}function hasWebSocketConnectivity(r){return"connectivity"in r&&r.connectivity&&typeof r.connectivity.send=="function"}var SyncSession=class extends libExports$1.EventEmitter{constructor(r,t,n,s){super(),this.need=new Set,this.have=new Set,this.active=!1,this.relay=r,this.filters=t,this.sessionId=this.generateSessionId(),this.opts=s,this.negentropy=new Negentropy(n,s.frameSizeLimit||FRAME_SIZE_LIMITS.DEFAULT),this.setupRelayMonitoring()}async start(){if(this.active)throw new Error("Sync session already active");this.active=!0,this.relay.registerProtocolHandler("NEG-MSG",this.handleNegMsg.bind(this)),this.relay.registerProtocolHandler("NEG-ERR",this.handleNegErr.bind(this)),this.relay.registerProtocolHandler("NEG-CLOSE",this.handleNegClose.bind(this)),this.relay.on("notice",this.handleNotice.bind(this));try{const r=await this.negentropy.initiate(),t=JSON.stringify(["NEG-OPEN",this.sessionId,this.filters,uint8ArrayToHex(r)]);return await this.sendRaw(t),await new Promise((n,s)=>{this.once("complete",n),this.once("error",s),setTimeout(()=>{this.active&&(this.cleanup(),s(new Error("Sync session timeout")))},this.opts.timeout||TIMEOUTS.SYNC_SESSION)})}catch(r){throw this.cleanup(),r}}async handleNegMsg(r,t){try{if(!isNegMsgWithPayload(t))throw new Error("Invalid NEG-MSG format: expected [string, string, string]");const[,n,s]=t;if(n!==this.sessionId)return;const o=hexToUint8Array(s),a=await this.negentropy.reconcile(o);for(const c of a.need)this.need.add(uint8ArrayToHex(c));for(const c of a.have)this.have.add(uint8ArrayToHex(c));if(a.nextMessage){const c=JSON.stringify(["NEG-MSG",this.sessionId,uint8ArrayToHex(a.nextMessage)]);await this.sendRaw(c)}else{const c=JSON.stringify(["NEG-CLOSE",this.sessionId]);await this.sendRaw(c),this.complete()}}catch(n){this.error(n instanceof Error?n:new Error(String(n)))}}handleNegErr(r,t){if(!isNegMsgWithPayload(t)){this.error(new Error("Invalid NEG-ERR format: expected [string, string, string]"));return}const[,n,s]=t;n===this.sessionId&&this.error(new Error(`Relay sync error: ${s}`))}handleNegClose(r,t){if(!isNegMessage(t)){this.error(new Error("Invalid NEG-CLOSE format: expected [string, string]"));return}const[,n]=t;n===this.sessionId&&this.complete()}handleNotice(r){if(typeof r!="string")return;const t=r.toLowerCase();(t.includes("negentropy")||t.includes("bad msg")||t.includes("bad message")||t.includes("unknown")&&t.includes("msg")||t.includes("unsupported")&&t.includes("protocol"))&&this.error(new Error(`Relay does not support negentropy: ${r}`))}complete(){this.active&&(this.cleanup(),this.emit("complete",{need:this.need,have:this.have}))}error(r){this.active&&(this.cleanup(),this.emit("error",r))}cleanup(){this.active=!1,this.relay.unregisterProtocolHandler("NEG-MSG"),this.relay.unregisterProtocolHandler("NEG-ERR"),this.relay.unregisterProtocolHandler("NEG-CLOSE"),this.relay.off("notice",this.handleNotice),this.relay.off("disconnect",this.handleRelayDisconnect)}setupRelayMonitoring(){this.relay.once("disconnect",this.handleRelayDisconnect.bind(this))}handleRelayDisconnect(){this.active&&this.error(new Error("Relay disconnected during sync session"))}async sendRaw(r){const t=this.relay.url;if(!this.relay.connected)throw new Error(`Relay ${t} is not connected`);if(!hasWebSocketConnectivity(this.relay))throw new Error(`Relay ${t} does not support direct message sending`);try{await this.relay.connectivity.send(r)}catch(n){throw new Error(`Failed to send message to relay ${t}: ${n instanceof Error?n.message:String(n)}`)}}generateSessionId(){return`neg-${Math.random().toString(36).substring(2,15)}`}};async function ndkSync(r,t={}){if(!this.cacheAdapter)throw new Error("NDK sync requires a cache adapter. Configure NDK with cacheAdapter option.");const n=Array.isArray(r)?r:[r],s=getRelaySet.call(this,t),o=Array.from(s.relays),a={events:[],need:new Set,have:new Set},c=o.map(async f=>{if(f.connected||await new Promise(g=>{const b=()=>{f.off("ready",b),g()};f.once("ready",b),setTimeout(()=>{f.off("ready",b),g()},TIMEOUTS.RELAY_CONNECTION)}),!f.connected){console.warn(`[NDK Sync] Relay ${f.url} did not connect in time, skipping`);return}try{await syncWithRelay.call(this,f,n,t,a)}catch(g){const b=g instanceof Error?g.message:String(g);console.error(`[NDK Sync] Failed to sync with relay ${f.url}: ${b}`),t.onRelayError&&await t.onRelayError(f,g instanceof Error?g:new Error(String(g)))}});return await Promise.all(c),a}function getRelaySet(r){if(r.relaySet)return r.relaySet;if(r.relayUrls)return NDKRelaySet$1.fromRelayUrls(r.relayUrls,this);const t=this.pool?.relays;if(!t||t.size===0)throw new Error("No relays available for sync");const n=new Set(t.values());return new NDKRelaySet$1(n,this)}async function syncWithRelay(r,t,n,s){try{const o=await queryCache.call(this,t),a=NegentropyStorage.fromEvents(o),c=new SyncSession(r,t,a,n),{need:f,have:g}=await c.start();for(const b of f)s.need.add(b);for(const b of g)s.have.add(b);if(n.autoFetch!==!1&&f.size>0){const b=await fetchNeededEvents.call(this,r,f);s.events.push(...b),this.cacheAdapter&&await saveFetchedEventsToCache.call(this,b,t,r)}}catch(o){const a=o instanceof Error?o.message:String(o);throw new Error(`Sync failed with relay ${r.url}: ${a}`)}}async function saveFetchedEventsToCache(r,t,n){if(this.cacheAdapter)for(const s of r)await this.cacheAdapter.setEvent(s,t,n)}async function queryCache(r){if(!this.cacheAdapter)return[];const t=[];return new Promise(n=>{const s=this.subscribe(r,{cacheUsage:NDKSubscriptionCacheUsage$1.ONLY_CACHE,closeOnEose:!0,onEvent:o=>{t.push(o)},onEose:()=>{n(t)}});setTimeout(()=>{s.stop(),n(t)},TIMEOUTS.CACHE_QUERY)})}async function fetchNeededEvents(r,t){const n=[],s=new NDKRelaySet$1(new Set([r]),this);return new Promise(o=>{const a=this.subscribe({ids:Array.from(t)},{closeOnEose:!0,relaySet:s,exclusiveRelay:!0,groupable:!1,onEvent:c=>{n.push(c)},onEose:()=>{o(n)}});setTimeout(()=>{a.stop(),o(n)},TIMEOUTS.EVENT_FETCH)})}async function supportsNegentropy(r){try{return(typeof r=="string"?await fetchRelayInformation$2(r):await r.fetchInfo()).supported_nips?.includes(77)??!1}catch{return!1}}var NDKSync=class Li{constructor(t){this.CAPABILITY_CACHE_TTL=36e5,this.ndk=t}async checkRelaySupport(t){const s=(await this.ndk.cacheAdapter?.getRelayStatus?.(t.url))?.metadata?.sync,o=Date.now();if(s?.lastChecked&&o-s.lastChecked<this.CAPABILITY_CACHE_TTL)return s.supportsNegentropy??!1;try{const a=await supportsNegentropy(t);return await this.ndk.cacheAdapter?.updateRelayStatus?.(t.url,{metadata:{sync:{supportsNegentropy:a,lastChecked:o}}}),a}catch(a){return await this.ndk.cacheAdapter?.updateRelayStatus?.(t.url,{metadata:{sync:{supportsNegentropy:!1,lastChecked:o,lastError:a instanceof Error?a.message:"Unknown error"}}}),!1}}async getNegentropyRelays(t){const n=t||Array.from(this.ndk.pool?.relays?.values()||[]);return(await Promise.all(n.map(async o=>({relay:o,supports:await this.checkRelaySupport(o)})))).filter(o=>o.supports).map(o=>o.relay)}async getRelayCapability(t){return(await this.ndk.cacheAdapter?.getRelayStatus?.(t))?.metadata?.sync}async clearCapabilityCache(t){t?await this.ndk.cacheAdapter?.updateRelayStatus?.(t,{metadata:{sync:void 0}}):console.warn("clearCapabilityCache() without relayUrl is not supported with persistent cache")}async markRelayAsNotSupporting(t,n){await this.ndk.cacheAdapter?.updateRelayStatus?.(t,{metadata:{sync:{supportsNegentropy:!1,lastChecked:Date.now(),lastError:n.message}}})}createErrorHandler(t){return async(n,s)=>{await t?.(n,s),await this.markRelayAsNotSupporting(n.url,s)}}async syncSingleRelay(t,n,s={}){if(await this.checkRelaySupport(t))return await ndkSync.call(this.ndk,n,{...s,relaySet:new NDKRelaySet$1(new Set([t]),this.ndk)});const a=await this.ndk.guardrailOff("fetch-events-usage").fetchEvents(n,{relaySet:new NDKRelaySet$1(new Set([t]),this.ndk),subId:"sync-fetch-fallback",groupable:!1});return{events:Array.from(a),need:new Set,have:new Set}}async sync(t,n){const s=Array.isArray(t)?t:[t],o=n?.relaySet||(n?.relayUrls?NDKRelaySet$1.fromRelayUrls(n.relayUrls,this.ndk):void 0),a=o?Array.from(o.relays):Array.from(this.ndk.pool?.relays?.values()||[]);if(a.length===0)return console.warn("[NDK Sync] No relays available for sync"),{events:[],need:new Set,have:new Set};const c={events:[],need:new Set,have:new Set},f={...n,onRelayError:this.createErrorHandler(n?.onRelayError)};return await Promise.all(a.map(async g=>{try{const b=await this.syncSingleRelay(g,s,f);c.events.push(...b.events);for(const _ of b.need)c.need.add(_);for(const _ of b.have)c.have.add(_)}catch(b){console.error(`[NDK Sync] Failed to sync with relay ${g.url}:`,b)}})),c}async syncAndSubscribe(t,n={}){this.ndk.cacheAdapter||console.warn("[NDKSync] No cache adapter - sync will not work, using subscription only");const s=Array.isArray(t)?t:[t],o=n.relaySet||(n.relayUrls?NDKRelaySet$1.fromRelayUrls(n.relayUrls,this.ndk):void 0),a=o?Array.from(o.relays):Array.from(this.ndk.pool?.relays?.values()||[]);if(a.length===0)throw new Error("No relays available for syncAndSubscribe");const c=s.map(g=>({...g,limit:0})),f=this.ndk.subscribe(c,{...n,relaySet:o,closeOnEose:!1});if(this.ndk.cacheAdapter){let g=0;const b=a.length,_=async L=>{try{const q=await this.syncSingleRelay(L,s,{autoFetch:!0,onRelayError:this.createErrorHandler(n.onRelayError)});n.onRelaySynced?.(L,q.events.length)}catch(q){console.error(`[NDKSync] Failed to sync from ${L.url}:`,q)}finally{g++,g===b&&n.onSyncComplete?.()}};for(const L of a)if(L.connected)_(L);else{let q=!1;const X=()=>{q||(q=!0,L.off("ready",X),_(L))};L.once("ready",X),setTimeout(()=>{q||(q=!0,L.off("ready",X),g++,g===b&&n.onSyncComplete?.())},TIMEOUTS.RELAY_CONNECTION)}}else setTimeout(()=>n.onSyncComplete?.(),0);return f}static sync(t,n,s){return new Li(t).sync(n,s)}static syncAndSubscribe(t,n,s){return new Li(t).syncAndSubscribe(n,s)}},mintWallets=new Map,mintWalletPromises=new Map;function mintKey(r,t,n){if(n){const s=new TextDecoder().decode(n);return`${r}-${t}-${s}`}return`${r}-${t}`}async function walletForMint(r,{pk:t,timeout:n=5e3,mintInfo:s,mintKeys:o,onMintInfoNeeded:a,onMintInfoLoaded:c,onMintKeysNeeded:f,onMintKeysLoaded:g}={}){const b=Date.now(),_=()=>`+${Date.now()-b}ms`;if(a){console.log(`[MINT-CACHE ${_()}] Querying cache for mint info: ${r}`);const ne=Date.now();s??=await a(r);const Ce=Date.now()-ne;s?console.log(`[MINT-CACHE ${_()}]  Cache HIT for mint info: ${r} (${Ce}ms)`,{name:s.name}):console.log(`[MINT-CACHE ${_()}]  Cache MISS for mint info: ${r} (${Ce}ms)`)}if(f){console.log(`[MINT-CACHE ${_()}] Querying cache for mint keys: ${r}`);const ne=Date.now();o??=await f(r);const Ce=Date.now()-ne;o?console.log(`[MINT-CACHE ${_()}]  Cache HIT for mint keys: ${r} (${Ce}ms)`,{count:o.length}):console.log(`[MINT-CACHE ${_()}]  Cache MISS for mint keys: ${r} (${Ce}ms)`)}if(!s&&c){console.log(`[MINT-CACHE ${_()}] Fetching mint info from ${r}/v1/info`);const ne=Date.now();s=await M.getInfo(r);const Ce=Date.now()-ne;console.log(`[MINT-CACHE ${_()}] Caching mint info: ${r} (fetched in ${Ce}ms)`,{name:s.name}),c?.(r,s)}const L="sat",q=mintKey(r,L,t);if(mintWallets.has(q))return console.log(`[MINT-CACHE ${_()}] Returning cached wallet instance: ${r}`),mintWallets.get(q);if(mintWalletPromises.has(q))return console.log(`[MINT-CACHE ${_()}] Wallet loading in progress, returning existing promise: ${r}`),mintWalletPromises.get(q);if(!s){if(a){console.log(`[MINT-CACHE ${_()}] Querying cache for mint info (second check): ${r}`);const ne=Date.now();s=await a(r);const Ce=Date.now()-ne;s?console.log(`[MINT-CACHE ${_()}]  Cache HIT for mint info (second check): ${r} (${Ce}ms)`,{name:s.name}):console.log(`[MINT-CACHE ${_()}]  Cache MISS for mint info (second check): ${r} (${Ce}ms)`)}if(!s&&c){console.log(`[MINT-CACHE ${_()}] Fetching mint info from ${r}/v1/info (second check)`);const ne=Date.now();s=await M.getInfo(r);const Ce=Date.now()-ne;console.log(`[MINT-CACHE ${_()}] Caching mint info (second check): ${r} (fetched in ${Ce}ms)`,{name:s.name}),c(r,s)}}if(!o&&f){console.log(`[MINT-CACHE ${_()}] Querying cache for mint keys (second check): ${r}`);const ne=Date.now();o=await f(r);const Ce=Date.now()-ne;o?console.log(`[MINT-CACHE ${_()}]  Cache HIT for mint keys (second check): ${r} (${Ce}ms)`,{count:o.length}):console.log(`[MINT-CACHE ${_()}]  Cache MISS for mint keys (second check): ${r} (${Ce}ms)`)}const X=new rs(new M(r),{unit:L,bip39seed:t,mintInfo:s,keys:o}),te=new Promise(async ne=>{try{console.log(`[MINT-CACHE ${_()}] Loading mint wallet: ${r}`);const Ce=Date.now(),Le=new Promise((ze,Xe)=>{setTimeout(()=>{Xe(new Error("timeout loading mint"))},n)});await Promise.race([X.loadMint(),Le]);const Ge=Date.now()-Ce;console.log(`[MINT-CACHE ${_()}] Mint wallet loaded: ${r} (${Ge}ms)`),mintWallets.set(q,X),mintWalletPromises.delete(q),X.keys&&(console.log(`[MINT-CACHE ${_()}] Caching mint keys after loadMint: ${r}`,{count:X.keys.size}),g?.(r,X.keys)),ne(X)}catch(Ce){console.error(`[WALLET ${_()}] error loading mint`,r,Ce.message),mintWalletPromises.delete(q),ne(null)}});return mintWalletPromises.set(q,te),te}function createMintCacheCallbacks(r){return{onMintInfoNeeded:async t=>{if(r.getCacheData)return r.getCacheData("wallet:mint:info",t)},onMintInfoLoaded:async(t,n)=>{r.setCacheData&&await r.setCacheData("wallet:mint:info",t,n)},onMintKeysNeeded:async t=>{if(r.getCacheData)return r.getCacheData("wallet:mint:keys",t)},onMintKeysLoaded:async(t,n)=>{if(!r.setCacheData)return;const s=Array.from(n.values());await r.setCacheData("wallet:mint:keys",t,s)}}}async function getCashuWallet(r){if(this.cashuWallets.has(r))return this.cashuWallets.get(r);const t=await walletForMint(r,{onMintInfoNeeded:this.onMintInfoNeeded,onMintInfoLoaded:this.onMintInfoLoaded,onMintKeysNeeded:this.onMintKeysNeeded,onMintKeysLoaded:this.onMintKeysLoaded});if(!t)throw new Error(`unable to load wallet for mint ${r}`);return this.cashuWallets.set(r,t),t}var NDKWalletStatus=(r=>(r.INITIAL="initial",r.LOADING="loading",r.READY="ready",r.FAILED="failed",r))(NDKWalletStatus||{}),NDKWallet=class extends libExports$1.EventEmitter{cashuWallets=new Map;onMintInfoNeeded;onMintInfoLoaded;onMintKeysNeeded;onMintKeysLoaded;getCashuWallet=getCashuWallet.bind(this);ndk;constructor(r){super(),this.ndk=r}status="initial";get type(){throw new Error("Not implemented")}walletId="unknown";get balance(){throw new Error("Not implemented")}redeemNutzaps(r,t,n){throw new Error("Not implemented")}};function getBolt11ExpiresAt(r){const t=bolt11Exports$1.decode(r),n=t.expiry,s=t.sections.find(o=>o.name==="timestamp").value;if(typeof n=="number"&&typeof s=="number")return n+s}function getBolt11Amount(r){const s=bolt11Exports$1.decode(r).sections.find(o=>o.name==="amount")?.value;return Number(s)}function getBolt11Description(r){return bolt11Exports$1.decode(r).sections.find(o=>o.name==="description")?.value}var NDKCashuQuote=class $o extends NDKEvent$1{quoteId;mint;amount;unit;_wallet;static kind=NDKKind$1.CashuQuote;constructor(t,n){super(t,n),this.kind??=NDKKind$1.CashuQuote}static async from(t){const n=new $o(t.ndk,t),s=t;try{await n.decrypt()}catch{n.content=s.content}try{const o=JSON.parse(n.content);n.quoteId=o.quoteId,n.mint=o.mint,n.amount=o.amount,n.unit=o.unit}catch{return}return n}set wallet(t){this._wallet=t}set invoice(t){const n=getBolt11ExpiresAt(t);n&&this.tags.push(["expiration",n.toString()])}async save(){if(!this.ndk)throw new Error("NDK is required");this.content=JSON.stringify({quoteId:this.quoteId,mint:this.mint,amount:this.amount,unit:this.unit}),await this.encrypt(this.ndk.activeUser,void 0,"nip44"),await this.sign(),await this.publish(this._wallet?.relaySet)}};async function createOutTxEvent(r,t,n,s,{nutzaps:o}={}){let a=t.paymentDescription,c;t.pr?(c=getBolt11Amount(t.pr),a??=getBolt11Description(t.pr),c&&(c/=1e3)):c=t.amount,c||console.error("BUG: Unable to find amount for paymentRequest",t);const f=new NDKCashuWalletTx$1(r);if(f.direction="out",f.amount=c??0,f.mint=n.mint,f.description=a,n.fee&&(f.fee=n.fee),t.target&&(f.tags.push(t.target.tagReference()),t.target instanceof NDKUser$1||f.tags.push(["p",t.target.pubkey])),o){f.description??="nutzap redeem";for(const g of o)f.addRedeemedNutzap(g)}return n.stateUpdate?.created&&(f.createdTokens=[n.stateUpdate.created]),n.stateUpdate?.deleted&&(f.destroyedTokenIds=n.stateUpdate.deleted),n.stateUpdate?.reserved&&(f.reservedTokens=[n.stateUpdate.reserved]),await f.sign(),f.publish(s),f}async function createInTxEvent(r,t,n,s,{nutzaps:o,fee:a,description:c},f){const g=new NDKCashuWalletTx$1(r),b=proofsTotalBalance$1(t);if(g.direction="in",g.amount=b,g.mint=n,g.description=c,s.created&&(g.createdTokens=[s.created]),s.deleted&&(g.destroyedTokenIds=s.deleted),s.reserved&&(g.reservedTokens=[s.reserved]),o)for(const _ of o)g.addRedeemedNutzap(_);return a&&(g.fee=a),await g.sign(),g.publish(f),g}var d$1=createDebug2("ndk-wallet:cashu:deposit");function randomMint(r){const t=r.mints;return t[Math.floor(Math.random()*t.length)]}var NDKCashuDeposit=class ko extends libExports$1.EventEmitter{mint;amount;quoteId;wallet;checkTimeout;checkIntervalLength=2500;finalized=!1;quoteEvent;constructor(t,n,s){super(),this.wallet=t,this.mint=s||randomMint(t),this.amount=n}static fromQuoteEvent(t,n){if(!n.amount)throw new Error("quote has no amount");if(!n.mint)throw new Error("quote has no mint");const s=new ko(t,n.amount,n.mint);return s.quoteId=n.quoteId,s}async start(t=2500){const s=await(await this.wallet.getCashuWallet(this.mint)).createMintQuote(this.amount);return d$1("created quote %s for %d %s",s.quote,this.amount,this.mint),this.quoteId=s.quote,this.wallet.depositMonitor.addDeposit(this),setTimeout(this.check.bind(this,t),t),this.createQuoteEvent(s.quote,s.request).then(o=>this.quoteEvent=o),s.request}async createQuoteEvent(t,n){const{ndk:s}=this.wallet,o=new NDKCashuQuote(s);o.quoteId=t,o.mint=this.mint,o.amount=this.amount,o.wallet=this.wallet,o.invoice=n;try{await o.save(),d$1("saved quote on event %s",o.rawEvent())}catch(a){d$1("error saving quote on event %s",a.relayErrors)}return o}async runCheck(){this.finalized||await this.finalize(),this.finalized||this.delayCheck()}delayCheck(){setTimeout(()=>{this.runCheck(),this.checkIntervalLength+=500},this.checkIntervalLength)}async check(t){this.runCheck(),t&&setTimeout(()=>{clearTimeout(this.checkTimeout)},t)}async finalize(){if(!this.quoteId)throw new Error("No quoteId set.");let t;try{d$1("Checking for minting status of %s",this.quoteId);const n=await this.wallet.getCashuWallet(this.mint),s=await this.wallet.state.getProofs({mint:this.mint});if(t=await n.mintProofs(this.amount,this.quoteId,{proofsWeHave:s}),t.length===0)return}catch(n){if(n.message.match(/not paid/i))return;if(n.message.match(/already issued/i)){d$1("Mint is saying the quote has already been issued, destroying quote event: %s",n.message),this.destroyQuoteEvent(),this.finalized=!0;return}if(n.message.match(/rate limit/i)){d$1("Mint seems to be rate limiting, lowering check interval"),this.checkIntervalLength+=5e3;return}d$1(n.message);return}try{this.finalized=!0;const n=await this.wallet.state.update({store:t,mint:this.mint},"Deposit"),s=n.created;if(!s)throw new Error("no token event created");createInTxEvent(this.wallet.ndk,t,this.mint,n,{description:"Deposit"},this.wallet.relaySet),this.emit("success",s),this.destroyQuoteEvent()}catch(n){this.emit("error",n.message),console.error(n)}}async destroyQuoteEvent(){if(!this.quoteEvent)return;(await this.quoteEvent.delete(void 0,!1)).publish(this.wallet.relaySet)}},NDKCashuDepositMonitor=class extends libExports$1.EventEmitter{deposits=new Map;addDeposit(r){const{quoteId:t}=r;if(!t)throw new Error("deposit has no quote ID");return this.deposits.has(t)?!1:(r.once("success",n=>{this.removeDeposit(t)}),this.deposits.set(t,r),this.emit("change"),!0)}removeDeposit(r){this.deposits.delete(r),this.emit("change")}};async function handleEventDeletion(r){const t=r.getMatchingTags("e").map(n=>n[1]);for(const n of t)this.state.removeTokenId(n)}async function handleQuote(r){const t=await NDKCashuQuote.from(r);if(!t)return;const n=Date.now()/1e3-3600;if(r.created_at&&r.created_at<n)return;const s=NDKCashuDeposit.fromQuoteEvent(this,t);this.depositMonitor.addDeposit(s)&&s.finalize()}async function handleToken(r){if(this.state.tokens.has(r.id))return;const t=await NDKCashuToken$1.from(r);if(t){for(const n of t.deletedTokens)this.state.removeTokenId(n);this.state.addToken(t)}}setInterval(()=>{},5e3);var handlers$1={[NDKKind$1.CashuToken]:handleToken,[NDKKind$1.CashuQuote]:handleQuote,[NDKKind$1.EventDeletion]:handleEventDeletion},balanceUpdateTimer=null;async function eventHandler(r){const t=handlers$1[r.kind];t&&(balanceUpdateTimer&&clearTimeout(balanceUpdateTimer),await t.call(this,r),balanceUpdateTimer=setTimeout(()=>{this.emit("balance_updated")},100))}async function eventDupHandler(r,t,n,s,o){}var d2$1=createDebug2("ndk-wallet:cashu:validate");async function consolidateTokens(){d2$1("checking %d tokens for spent proofs",this.state.tokens.size);const r=new Set(this.state.getMintsProofs({validStates:new Set(["available","reserved","deleted"])}).keys());d2$1("found %d mints",r.size),r.forEach(t=>{consolidateMintTokens(t,this)})}async function consolidateMintTokens(r,t,n,s,o){n??=t.state.getProofs({mint:r,includeDeleted:!0,onlyAvailable:!1});const a=await walletForMint(r);if(!a)return;let c=[];try{c=await a.checkProofsStates(n)}catch{return}const f=[],g=[],b=[];n.forEach((q,X)=>{const{state:te}=c[X];te===ns.SPENT?f.push(q):te===ns.UNSPENT?g.push(q):b.push(q)});const _={mint:r,store:g,destroy:f};if(f.reduce((q,X)=>q+X.amount,0),_.destroy?.length===0)return;_.store?.push(...b);const L=b.reduce((q,X)=>q+X.amount,0);return t.state.reserveProofs(b,L),t.state.update(_,"Consolidate")}function calculateFee(r,t,n){const s=t.reduce((c,f)=>c+f.amount,0),o=n.reduce((c,f)=>c+f.amount,0),a=s-r-o;if(a<0)throw new Error("Invalid fee calculation: received more proofs than sent to mint");return a}async function withProofReserve(r,t,n,s,o,a){t??=await r.getCashuWallet(n);const c=r.state.getProofs({mint:n,onlyAvailable:!0}),f=t.selectProofsToSend(c,s);if(f.send.reduce((q,X)=>q+X.amount,0)<s)return null;r.state.reserveProofs(f.send,s);let b=null,_=null,L=null;try{if(b=await a(f.send,c),!b)return null;_={mint:n,store:b.change,destroy:f.send},L=await r.state.update(_)}catch(q){throw r.state.unreserveProofs(f.send,s,"available"),q}return b?{result:b.result,proofsChange:_,stateUpdate:L,mint:n,fee:calculateFee(o,f.send,b.change)}:null}async function payLn(r,t,{amount:n,unit:s}={}){let o=getBolt11Amount(t);if(!o)throw new Error("invoice amount is required");o=o/1e3,n&&s&&s==="msat"&&(n=n/1e3);const a=r.getMintsWithBalance(o+3);if(!a.length)return null;for(const c of a)try{const f=await executePayment(c,t,n??o,r);if(f)return n&&(f.fee=calculateFee(n,f.proofsChange?.destroy??[],f.proofsChange?.store??[])),f}catch(f){r.warn(`Failed to execute payment with min ${c}: ${f}`)}return null}async function executePayment(r,t,n,s){const o=await s.getCashuWallet(r);try{const a=await o.createMeltQuote(t),c=a.amount+a.fee_reserve;return await withProofReserve(s,o,r,c,n,async(g,b)=>{const _=await o.meltProofs(a,g);return _.quote.state===tt$1.PAID?{result:{preimage:_.quote.payment_preimage??""},change:_.change}:null})}catch(a){if(a instanceof Error)if(a.message.match(/already spent/i))setTimeout(()=>{consolidateMintTokens(r,s)},2500);else throw a;return null}}function ensureIsCashuPubkey(r){if(!r)return;let t=r;if(t.length===64&&(t=`02${t}`),t.length!==66)throw new Error("Invalid pubkey");return t}async function mintProofs(r,t,n,s,o){const a=(c,f,g)=>{const b=ensureIsCashuPubkey(o);r.mintProofs(n,t.quote,{pubkey:b}).then(_=>{console.debug("minted tokens",_),c({proofs:_,mint:s})}).catch(_=>{g++,g<=3?(console.error("error minting tokens",_),setTimeout(()=>a(c,f,g),g*1500)):f(_)})};return new Promise((c,f)=>{a(c,f,0)})}async function createToken(r,t,n,s){console.log("[createToken] Starting token creation",{amount:t,recipientMints:n,p2pk:s}),s=ensureIsCashuPubkey(s);const o=r.getMintsWithBalance(t);console.log("[createToken] My mints with enough balance",o);const a=n&&n.length>0,c=a?findMintsInCommon([n,o]):o;console.log("[createToken] Mints in common",{hasRecipientMints:a,mintsInCommon:c});for(const f of c){console.log("[createToken] Attempting to create token in mint",f);try{const g=await createTokenInMint(r,f,t,s);if(g)return console.log("[createToken] Successfully created token in mint",f),g;console.log("[createToken] Failed to create token in mint",f)}catch(g){console.error("[createToken] Error creating token in mint",f,g)}}return a?(console.log("[createToken] Attempting cross-mint transfer"),await createTokenWithMintTransfer(r,t,n,s)):(console.error("[createToken] All token creation attempts failed"),null)}async function createTokenInMint(r,t,n,s){console.log("[createTokenInMint] Starting",{mint:t,amount:n,p2pk:s});const o=await r.getCashuWallet(t);console.log("[createTokenInMint] Got cashu wallet for mint",t);try{const a=await withProofReserve(r,o,t,n,n,async(c,f)=>{console.log("[createTokenInMint] Inside withProofReserve callback",{proofsToUseCount:c.length,allOurProofsCount:f.length});const g=await o.send(n,c,{pubkey:s,proofsWeHave:f});return console.log("[createTokenInMint] Send result",{sendCount:g.send.length,keepCount:g.keep.length}),{result:{proofs:g.send,mint:t},change:g.keep,mint:t}});return console.log("[createTokenInMint] Success",a),a}catch(a){console.error("[createTokenInMint] Error",{mint:t,error:a.message,stack:a.stack})}return null}async function createTokenWithMintTransfer(r,t,n,s){const o=async()=>{const X=async Ge=>{const ze=await walletForMint(Ge);if(!ze)throw new Error(`unable to load wallet for mint ${Ge}`);return{quote:await ze.createMintQuote(t),mint:Ge,targetMintWallet:ze}},te=n.map(X),{quote:ne,mint:Ce,targetMintWallet:Le}=await Promise.any(te);if(!ne)throw new Error("failed to get quote from any mint");return{quote:ne,mint:Ce,targetMintWallet:Le}},{quote:a,mint:c,targetMintWallet:f}=await o();if(!a)return null;const g=getBolt11Amount(a.request);if(!g)throw new Error("invoice amount is required");const b=g/1e3;if(b>t)throw new Error(`invoice amount is more than the amount passed in (${b} vs ${t})`);const _=await payLn(r,a.request,{amount:t});if(!_)return null;const{proofs:L,mint:q}=await mintProofs(f,a,t,c,s);return{..._,result:{proofs:L,mint:q},fee:_.fee}}function findMintsInCommon(r){const t=new Map;for(const s of r)for(const o of s){const a=normalizeUrl$1(o);t.has(a)?t.set(a,t.get(a)+1):t.set(a,1)}const n=[];for(const[s,o]of t.entries())o===r.length&&n.push(s);return n}var PaymentHandler=class{wallet;constructor(r){this.wallet=r}async lnPay(r,t=!0){if(!r.pr)throw new Error("pr is required");const n=getBolt11Amount(r.pr);if(!n)throw new Error("invoice amount is required");if(r.amount&&n>r.amount)throw new Error("invoice amount is more than the amount passed in");const s=await payLn(this.wallet,r.pr,{amount:r.amount,unit:r.unit});if(s?.result?.preimage)return t&&createOutTxEvent(this.wallet.ndk,r,s,this.wallet.relaySet),s.result}async cashuPay(r){console.log("[PaymentHandler.cashuPay] Starting cashu payment",{originalAmount:r.amount,unit:r.unit,mints:r.mints,p2pk:r.p2pk,allowIntramintFallback:r.allowIntramintFallback});const t={...r};t.unit?.startsWith("msat")&&(t.amount=t.amount/1e3,t.unit="sat",console.log("[PaymentHandler.cashuPay] Converted msat to sat",{newAmount:t.amount,newUnit:t.unit})),console.log("[PaymentHandler.cashuPay] Creating token with mints",r.mints);let n=await createToken(this.wallet,t.amount,r.mints,r.p2pk);if(!n?.result&&(console.log("[PaymentHandler.cashuPay] Token creation failed with specified mints"),r.allowIntramintFallback&&(console.log("[PaymentHandler.cashuPay] Attempting intramint fallback"),n=await createToken(this.wallet,t.amount,void 0,r.p2pk)),!n?.result)){console.error("[PaymentHandler.cashuPay] Token creation failed completely");return}return console.log("[PaymentHandler.cashuPay] Token created successfully",{proofsCount:n.result.proofs.length,mint:n.result.mint}),createOutTxEvent(this.wallet.ndk,t,n,this.wallet.relaySet),n.result}};function getBalance(r){return this.getProofEntries(r).reduce((n,s)=>n+s.proof.amount,0)}function getMintsBalances({onlyAvailable:r}={onlyAvailable:!0}){const t={},n=this.getProofEntries({onlyAvailable:r});for(const s of n)s.mint&&(t[s.mint]??=0,t[s.mint]+=s.proof.amount);return t}function addProof(r){this.proofs.set(r.proof.C,r),this.journal.push({memo:"Added proof",timestamp:Date.now(),metadata:{type:"proof",id:r.proof.C,amount:r.proof.amount,mint:r.mint}})}function reserveProofs(r,t){for(const n of r)this.updateProof(n,{state:"reserved"});this.reserveAmounts.push(t)}function unreserveProofs(r,t,n){for(const o of r)this.updateProof(o,{state:n});const s=this.reserveAmounts.indexOf(t);if(s!==-1)this.reserveAmounts.splice(s,1);else throw new Error(`BUG: Amount ${t} not found in reserveAmounts`)}function getProofEntries(r={}){const t=new Map,n=new Set(["available"]);let{mint:s,onlyAvailable:o,includeDeleted:a}=r;o??=!0,o||n.add("reserved"),a&&n.add("deleted");for(const c of this.proofs.values())s&&c.mint!==s||n.has(c.state)&&c.proof&&t.set(c.proof.C,c);return Array.from(t.values())}function updateProof(r,t){const n=r.C,s=this.proofs.get(n);if(!s)throw new Error("Proof not found");const o={...s,...t};this.proofs.set(n,o),this.journal.push({memo:`Updated proof state: ${JSON.stringify(t)}`,timestamp:Date.now(),metadata:{type:"proof",id:n,amount:r.amount,mint:s.mint}})}function addToken(r){if(!r.mint)throw new Error("BUG: Token has no mint");const n=this.tokens.get(r.id)?.state??"available";this.tokens.set(r.id,{token:r,state:n});for(const s of r.proofs)maybeAssociateProofWithToken(this,s,r,n)}function maybeAssociateProofWithToken(r,t,n,s){const o=t.C,a=r.proofs.get(o);if(!a)return r.addProof({mint:n.mint,state:s,tokenId:n.id,timestamp:n.created_at,proof:t}),!0;if(a.tokenId){if(a.tokenId===n.id)return null;const c=r.tokens.get(a.tokenId);if(!c)throw new Error(`BUG: Token id ${a.tokenId} not found, was expected to be associated with proof ${o}`);const f=c.token;return f&&f.created_at&&(!n.created_at||n.created_at<f.created_at)?!1:(r.updateProof(t,{tokenId:n.id,state:s}),!0)}return r.updateProof(t,{tokenId:n.id,state:s}),!0}function removeTokenId(r){const t=this.tokens.get(r)||{};this.tokens.set(r,{...t,state:"deleted"});for(const n of this.proofs.values()){const{proof:s}=n;if(n.tokenId===r){if(!s)throw new Error("BUG: Proof entry has no proof");this.updateProof(s,{state:"deleted"})}}}async function update(r,t){return updateInternalState(this,r),this.wallet.emit("balance_updated"),updateExternalState(this,r)}function updateInternalState(r,t){if(t.store&&t.store.length>0)for(const n of t.store)r.addProof({mint:t.mint,state:"available",proof:n,timestamp:Date.now()});if(t.destroy&&t.destroy.length>0)for(const n of t.destroy)r.updateProof(n,{state:"deleted"});if(t.reserve&&t.reserve.length>0)throw new Error("BUG: Proofs should not be reserved via update")}async function updateExternalState(r,t){const n=calculateNewState(r,t);if(n.deletedTokenIds.size>0){const o=new NDKEvent$1(r.wallet.ndk,{kind:NDKKind$1.EventDeletion,tags:[["k",NDKKind$1.CashuToken.toString()],...Array.from(n.deletedTokenIds).map(a=>["e",a])]});await o.sign(),publishWithRetry(r,o,r.wallet.relaySet);for(const a of n.deletedTokenIds)r.removeTokenId(a)}const s={};if(n.saveProofs.length>0){const o=await createTokenEvent(r,t.mint,n);s.created=o}return s}async function publishWithRetry(r,t,n,s=10*1e3){let o;o=await t.publish(n);let a;t.kind===NDKKind$1.EventDeletion&&(a="deletion"),t.kind===NDKKind$1.CashuToken&&(a="token"),t.kind===NDKKind$1.CashuWallet&&(a="wallet");const c={type:a,id:t.id,relayUrl:n?.relayUrls.join(",")};if(o)return r.journal.push({memo:`Publish kind:${t.kind} succeesfully`,timestamp:Date.now(),metadata:c}),o;r.journal.push({memo:"Publish failed",timestamp:Date.now(),metadata:c}),setTimeout(()=>{publishWithRetry(r,t,n,s)},s)}async function createTokenEvent(r,t,n){const s=new NDKCashuToken$1(r.wallet.ndk);return s.mint=t,s.proofs=n.saveProofs,await s.toNostrEvent(),r.addToken(s),s.deletedTokens=Array.from(n.deletedTokenIds),await s.sign(),r.addToken(s),publishWithRetry(r,s,r.wallet.relaySet),s}function calculateNewState(r,t){const n=new Set;for(const a of t.destroy||[])n.add(a.C);const s=new Map;let o;for(const a of t.store||[])s.set(a.C,a);o=getAffectedTokens(r,t);for(const a of o.values())for(const c of a.proofs)n.has(c.C)||s.set(c.C,c);return{deletedTokenIds:new Set(o.keys()),deletedProofs:n,reserveProofs:[],saveProofs:Array.from(s.values())}}function getAffectedTokens(r,t){const n=new Map;for(const s of t.destroy||[]){const o=r.proofs.get(s.C);if(!o)continue;const a=o.tokenId;if(!a)continue;const c=r.tokens.get(a);c?.token&&n.set(a,c.token)}return n}var WalletState=class{constructor(r,t=new Set){this.wallet=r,this.reservedProofCs=t}reserveAmounts=[];proofs=new Map;tokens=new Map;journal=[];dump(){return{proofs:Array.from(this.proofs.values()),balances:this.getMintsBalance(),totalBalance:this.getBalance(),tokens:Array.from(this.tokens.values())}}addToken=addToken.bind(this);removeTokenId=removeTokenId.bind(this);addProof=addProof.bind(this);reserveProofs=reserveProofs.bind(this);unreserveProofs=unreserveProofs.bind(this);getProofEntries=getProofEntries.bind(this);updateProof=updateProof.bind(this);getProofs(r){return this.getProofEntries(r).map(t=>t.proof)}getTokens(r={onlyAvailable:!0}){const t=this.getProofEntries(r),n=new Map;for(const s of t){const o=s.tokenId??null,a=n.get(o)??{tokenId:o,mint:s.mint,proofEntries:[]};a.token??=o?this.tokens.get(o)?.token:void 0,a.proofEntries.push(s),n.set(o,a)}return n}getMintsProofs({validStates:r=new Set(["available"])}={}){const t=new Map;for(const n of this.proofs.values()){if(!n.mint||!n.proof||!r.has(n.state))continue;const s=t.get(n.mint)||[];s.push(n.proof),t.set(n.mint,s)}return t}getBalance=getBalance.bind(this);getMintsBalance=getMintsBalances.bind(this);update=update.bind(this)},NDKCashuWallet=class Di extends NDKWallet{get type(){return"nip-60"}_p2pk;sub;status="initial";static kind=NDKKind$1.CashuWallet;static kinds=[NDKKind$1.CashuWallet];mints=[];privkeys=new Map;signer;walletId="nip-60";depositMonitor=new NDKCashuDepositMonitor;warnings=[];paymentHandler;state;relaySet;_walletRelays=[];constructor(t){if(super(t),this.ndk=t,this.paymentHandler=new PaymentHandler(this),this.state=new WalletState(this),t.cacheAdapter?.getCacheData&&t.cacheAdapter?.setCacheData){const n=createMintCacheCallbacks(t.cacheAdapter);this.onMintInfoNeeded=n.onMintInfoNeeded,this.onMintInfoLoaded=n.onMintInfoLoaded,this.onMintKeysNeeded=n.onMintKeysNeeded,this.onMintKeysLoaded=n.onMintKeysLoaded}}async backup(t=!0){if(this.privkeys.size===0)throw new Error("no privkey to backup");const n=new NDKCashuWalletBackup(this.ndk),s=[];for(const[o,a]of this.privkeys.entries())s.push(a.privateKey);return n.privkeys=s,n.mints=this.mints,t&&n.save(this.relaySet),n}consolidateTokens=consolidateTokens.bind(this);async mintNuts(t){let n;const s=t.reduce((o,a)=>o+a,0);for(const o of this.mints){const a=await this.getCashuWallet(o),c=await this.state.getProofs({mint:o});if(n=await a.send(s,c,{proofsWeHave:c,includeFees:!0,outputAmounts:{sendAmounts:t}}),n.send.length>0){const f={store:n?.keep??[],destroy:n.send,mint:o},g=await this.state.update(f);return createOutTxEvent(this.ndk,{paymentDescription:"minted nuts",amount:t.reduce((b,_)=>b+_,0)},{result:{proofs:n.send},stateUpdate:g,mint:o,fee:0},this.relaySet),this.emit("balance_updated"),n}}}async send(t,n){if(this.mints.length===0)throw new Error("No mints configured");const s=await this.mintNuts([t]);if(!s)throw new Error("Failed to create token");return Ye({mint:this.mints[0],proofs:s.send,memo:n})}async loadFromEvent(t){const n=new NDKEvent$1(t.ndk,t.rawEvent());await n.decrypt();const s=JSON.parse(n.content);for(const o of s)o[0]==="mint"?this.mints.push(o[1]):o[0]==="privkey"?await this.addPrivkey(o[1]):o[0]==="relay"&&this._walletRelays.push(o[1]);await this.getP2pk()}static async from(t){if(!t.ndk)throw new Error("no ndk instance on event");const n=new Di(t.ndk);return await n.loadFromEvent(t),n}static async create(t,n,s){const o=new Di(t),a=NDKPrivateKeySigner$1.generate();return await o.addPrivkey(a.privateKey),o.mints=n,s&&s.length>0&&(o.relaySet=NDKRelaySet$1.fromRelayUrls(s,t)),await o.publish(),await o.backup(!0),o}async fetchWalletRelays(t){if(this._walletRelays.length>0)return NDKRelaySet$1.fromRelayUrls(this._walletRelays,this.ndk);const n=await this.ndk.fetchEvent({kinds:[NDKKind$1.RelayList],authors:[t]},{cacheUsage:NDKSubscriptionCacheUsage$1.PARALLEL});if(n)return NDKRelayList$1.from(n).relaySet}async start(t){const n=this.ndk?.activeUser;if(this.status==="ready")return Promise.resolve();this.setStatus("loading");const s=t?.pubkey??n?.pubkey;if(!s)throw new Error("no pubkey");this.relaySet||(this.relaySet=await this.fetchWalletRelays(s));const o=[{kinds:[NDKKind$1.CashuToken],authors:[s]},{kinds:[NDKKind$1.CashuQuote],authors:[s]},{kinds:[NDKKind$1.EventDeletion],authors:[s],"#k":[NDKKind$1.CashuToken.toString()]}];if(t?.since&&(o[0].since=t.since,o[1].since=t.since,o[2].since=t.since),this.ndk.cacheAdapter){const a=[],c=await this.ndk.fetchEvents([{kinds:[NDKKind$1.CashuToken],authors:[s]}],{cacheUsage:NDKSubscriptionCacheUsage$1.ONLY_CACHE});a.push(...c);for(const f of a)eventHandler.call(this,f);this.emit("balance_updated")}if(this.ndk.cacheAdapter)try{const a=await NDKSync.sync(this.ndk,o,{relaySet:this.relaySet,autoFetch:!0});for(const g of a.events)eventHandler.call(this,g);const c=t??{};c.subId??="cashu-wallet-state";const f=o.map(g=>({...g,since:Math.floor(Date.now()/1e3)-60}));this.sub=this.ndk.subscribe(f,{...c,relaySet:this.relaySet,closeOnEose:!1,onEvent:g=>{eventHandler.call(this,g)},onEventDup:eventDupHandler.bind(this)}),this.emit("ready"),this.setStatus("ready")}catch(a){console.error("[NDKCashuWallet] Sync failed, falling back to subscription:",a),await this.startWithSubscription(o,t)}else await this.startWithSubscription(o,t)}async startWithSubscription(t,n){const s=n??{};return s.subId??="cashu-wallet-state",new Promise(o=>{this.sub=this.ndk.subscribe(t,{...s,relaySet:this.relaySet,onEvent:a=>{eventHandler.call(this,a)},onEose:async()=>{this.emit("ready"),this.setStatus("ready"),o()},onEventDup:eventDupHandler.bind(this)})})}stop(){this.sub?.stop(),this.setStatus("initial")}setStatus(t){this.status!==t&&(this.status=t,this.emit("status_changed",t))}async getP2pk(){if(this._p2pk)return this._p2pk;if(this.privkeys.size===0){const t=NDKPrivateKeySigner$1.generate();await this.addPrivkey(t.privateKey)}return this.p2pk}get p2pks(){return Array.from(this.privkeys.keys())}async addPrivkey(t){const n=new NDKPrivateKeySigner$1(t),s=await n.user();return this.privkeys.set(s.pubkey,n),this._p2pk??=s.pubkey,this._p2pk}get p2pk(){if(!this._p2pk)throw new Error("p2pk not set");return this._p2pk}set p2pk(t){if(this.privkeys.has(t))this.signer=this.privkeys.get(t),this.p2pk=t;else throw new Error(`privkey for ${t} not found`)}walletPayload(){const t=Array.from(this.privkeys.values()).map(s=>s.privateKey),n=payloadForEvent(t,this.mints);return this._walletRelays.length>0&&n.push(...this._walletRelays.map(s=>["relay",s])),n}async publish(){this.relaySet&&(this._walletRelays=Array.from(this.relaySet.relays).map(s=>s.url));const t=new NDKEvent$1(this.ndk,{content:JSON.stringify(this.walletPayload()),kind:NDKKind$1.CashuWallet}),n=await this.ndk?.signer?.user();return await t.encrypt(n,void 0,"nip44"),t.publish(this.relaySet)}async publishMintList(){const t=new NDKCashuMintList$1(this.ndk);return t.mints=this.mints,this.relaySet&&(t.relays=Array.from(this.relaySet.relays).map(n=>n.url)),t.p2pk=this.p2pk,t.publishReplaceable(this.relaySet)}async update(t){this.mints=t.mints,t.relays&&t.relays.length>0?(this.relaySet=NDKRelaySet$1.fromRelayUrls(t.relays,this.ndk),this._walletRelays=t.relays):(this.relaySet=void 0,this._walletRelays=[]);const n=new NDKEvent$1(this.ndk,{content:JSON.stringify(this.walletPayload()),kind:NDKKind$1.CashuWallet}),s=await this.ndk?.signer?.user();return await n.encrypt(s,void 0,"nip44"),n.publishReplaceable(this.relaySet)}deposit(t,n){const s=new NDKCashuDeposit(this,t,n);return s.on("success",o=>{this.state.addToken(o)}),s}async receiveToken(t,n){const{mint:s}=Pe(t),a=await(await this.getCashuWallet(s)).receive(t),c=await this.state.update({store:a,mint:s}),f=c.created;return createInTxEvent(this.ndk,a,s,c,{description:n},this.relaySet),f}async lnPay(t,n=!0){return this.paymentHandler.lnPay(t,n)}async cashuPay(t){return this.paymentHandler.cashuPay(t)}wallets=new Map;async redeemNutzaps(t,n,{mint:s,proofs:o,cashuWallet:a}){if(a)s??=a.mint.mintUrl;else{if(!s)throw new Error("mint not set");a=await this.getCashuWallet(s)}if(!s)throw new Error("mint not set");if(!o)throw new Error("proofs not set");try{const c=this.state.getProofs({mint:s}),f=await a.receive({proofs:o,mint:s},{proofsWeHave:c,privkey:n}),g=o.reduce((q,X)=>q+X.amount,0),b=f.reduce((q,X)=>q+X.amount,0),_=g-b,L=await this.state.update({store:f,mint:s});return createInTxEvent(this.ndk,f,s,L,{nutzaps:t,fee:_},this.relaySet),g}catch(c){throw console.error("error redeeming nutzaps",t.map(f=>f.encode()),c),c}}warn(t,n,s){s??=n?.onRelays,this.warnings.push({msg:t,event:n,relays:s}),this.emit("warning",{msg:t,event:n,relays:s})}get balance(){return{amount:this.state.getBalance({onlyAvailable:!0})}}mintBalance(t){return this.mintBalances[t]||0}get mintBalances(){return this.state.getMintsBalance({onlyAvailable:!0})}getMintsWithBalance(t){const n=this.state.getMintsBalance({onlyAvailable:!0});return Object.entries(n).filter(([s,o])=>o>=t).map(([s])=>s)}async getMintInfo(t){return await(await this.getCashuWallet(t)).mint.getInfo()}},NDKCashuWalletBackup=class So extends NDKEvent$1{privkeys=[];mints=[];constructor(t,n){super(t,n),this.kind??=NDKKind$1.CashuWalletBackup}static async from(t){if(!t.ndk)throw new Error("no ndk instance on event");const n=new So(t.ndk,t);try{await n.decrypt();const s=JSON.parse(n.content);for(const o of s)o[0]==="mint"?n.mints.push(o[1]):o[0]==="privkey"&&n.privkeys.push(o[1])}catch(s){console.error("error decrypting backup event",n.encode(),s);return}return n}async save(t){if(!this.ndk)throw new Error("no ndk instance");if(!this.privkeys.length)throw new Error("no privkeys");return this.content=JSON.stringify(payloadForEvent(this.privkeys,this.mints)),await this.encrypt(this.ndk.activeUser,void 0,"nip44"),this.publish(t)}};function payloadForEvent(r,t){if(r.length===0)throw new Error("privkey not set");return[...t.map(s=>["mint",s]),...r.map(s=>["privkey",s])]}createDebug2("ndk-wallet:nwc");createDebug2("ndk-wot:filter");function rankByWoT(r,t,n={}){const{algorithm:s="distance",unknownsLast:o=!1,comparator:a}=n;return a?[...t].sort(a):[...t].sort((c,f)=>{const g=c.pubkey,b=f.pubkey,_=r.includes(g),L=r.includes(b);if(o){if(!_&&L)return 1;if(_&&!L)return-1;if(!_&&!L)return 0}switch(s){case"distance":{const q=r.getDistance(g)??1/0,X=r.getDistance(b)??1/0;return q-X}case"score":{const q=r.getScore(g);return r.getScore(b)-q}case"followers":{const q=r.getNode(g),X=r.getNode(b),te=q?.followedBy.size??0;return(X?.followedBy.size??0)-te}default:return 0}})}var d2=createDebug2("ndk-wot"),NDKWoT=class{ndk;rootPubkey;nodes=new Map;loaded=!1;constructor(r,t){if(!this.isValidPubkey(t))throw new Error(`Invalid root pubkey: ${t}`);this.ndk=r,this.rootPubkey=t,this.nodes.set(t,{pubkey:t,depth:0,followedBy:new Set})}async load(r){const{depth:t,maxFollows:n=1e3,timeout:s,useNegentropy:o=!0,negentropyMinAuthors:a=5,relayUrls:c}=r;d2("Building WOT graph for %s with depth %d (negentropy: %s, minAuthors: %d)",this.rootPubkey,t,o,a);const f=Date.now(),g=new Set;for(let b=0;b<t;b++){if(s&&Date.now()-f>s){d2("Timeout reached while building WOT graph");break}const _=Array.from(this.nodes.values()).filter(q=>q.depth===b).map(q=>q.pubkey);if(_.length===0)break;d2("Processing %d users at depth %d",_.length,b);const L=await this.fetchContactLists({authors:_,useNegentropy:o&&_.length>=a,relayUrls:c});for(const q of L){if(g.has(q.pubkey))continue;g.add(q.pubkey);const te=this.extractFollows(q).slice(0,n);for(const ne of te){let Ce=this.nodes.get(ne);Ce?(b+1<Ce.depth&&(Ce.depth=b+1),Ce.followedBy.add(q.pubkey)):(Ce={pubkey:ne,depth:b+1,followedBy:new Set([q.pubkey])},this.nodes.set(ne,Ce))}}}this.loaded=!0,d2("WOT graph built with %d nodes in %dms",this.nodes.size,Date.now()-f)}async fetchContactLists(r){const{authors:t,useNegentropy:n,relayUrls:s}=r;if(!n)return d2("Fetching %d contact lists using subscription",t.length),await this.fetchViaSubscription(t);d2("Attempting negentropy sync for %d contact lists",t.length);try{const o={autoFetch:!0,subId:"wot-sync"};s&&(o.relayUrls=s);const a=await NDKSync.sync(this.ndk,{kinds:[NDKKind$1.Contacts],authors:t},o);return d2("Negentropy sync completed: %d events, %d needed, %d we have",a.events.length,a.need.size,a.have.size),new Set(a.events)}catch(o){return d2("Negentropy sync failed, falling back to subscription: %s",o),await this.fetchViaSubscription(t)}}async fetchViaSubscription(r){return new Promise((t,n)=>{const s=new Set,o=setTimeout(()=>{a.stop(),n(new Error(`Timeout fetching contact lists for ${r.length} authors`))},3e4),a=this.ndk.subscribe({kinds:[NDKKind$1.Contacts],authors:r},{closeOnEose:!0,subId:"wot-fetch",addSinceFromCache:!0});a.on("event",c=>{s.add(c)}),a.on("eose",()=>{clearTimeout(o),a.stop(),d2("Subscription fetch completed: %d events",s.size),t(s)})})}isValidPubkey(r){return/^[0-9a-f]{64}$/i.test(r)}extractFollows(r){const t=[];for(const n of r.tags)if(n[0]==="p"){const s=n[1];s&&typeof s=="string"&&this.isValidPubkey(s)?t.push(s):s&&d2("Skipping invalid p-tag pubkey: %s",s)}return t}getScore(r){const t=this.nodes.get(r);return t?1/(t.depth+1):0}getDistance(r){const t=this.nodes.get(r);return t?t.depth:null}includes(r,t){const n=this.nodes.get(r);return n?t?.maxDepth!==void 0?n.depth<=t.maxDepth:!0:!1}getAllPubkeys(r){let t=Array.from(this.nodes.values());if(r?.maxDepth!==void 0){const n=r.maxDepth;t=t.filter(s=>s.depth<=n)}return t.map(n=>n.pubkey)}getScores(r){const t=new Map;for(const n of r)t.set(n,this.getScore(n));return t}getNode(r){return this.nodes.get(r)||null}isLoaded(){return this.loaded}get size(){return this.nodes.size}},root_1$6=from_html("<img/>"),root_2$5=from_html("<div> </div>");function Avatar(r,t){push(t,!0);let n=prop(t,"size",3,40),s=prop(t,"class",3,""),o=prop(t,"style",3,"");const a=t.ndk.$fetchProfile(()=>t.pubkey),c=user_derived(()=>{const te=a?.name;return te?te[0]?.toUpperCase():t.pubkey?.slice(0,2).toUpperCase()}),f=user_derived(()=>a?.picture),g=user_derived(()=>a?.name||`${t.pubkey?.slice(0,8)}...`),b=user_derived(()=>{if(!t.pubkey)return"linear-gradient(135deg, #667eea 0%, #764ba2 100%)";const te=parseInt(t.pubkey.slice(0,8),16),ne=parseInt(t.pubkey.slice(8,16),16),Ce=te%360,Le=60+te%20,Ge=50+te%15,ze=ne%360,Xe=60+ne%20,He=50+ne%15;return`linear-gradient(135deg, hsl(${Ce}, ${Le}%, ${Ge}%) 0%, hsl(${ze}, ${Xe}%, ${He}%) 100%)`});var _=comment$1(),L=first_child(_);{var q=te=>{var ne=root_1$6();template_effect(()=>{set_attribute(ne,"src",get(f)),set_attribute(ne,"alt",get(g)),set_class(ne,1,`avatar ${s()??""}`,"svelte-g6k56d"),set_style(ne,`width: ${n()??""}px; height: ${n()??""}px; ${o()??""}`)}),append(te,ne)},X=te=>{var ne=root_2$5(),Ce=child(ne,!0);reset$1(ne),template_effect(()=>{set_class(ne,1,`avatar-placeholder ${s()??""}`,"svelte-g6k56d"),set_style(ne,`width: ${n()??""}px; height: ${n()??""}px; font-size: ${n()*.4}px; background: ${get(b)??""}; ${o()??""}`),set_text(Ce,get(c))}),append(te,ne)};if_block(L,te=>{get(f)?te(q):te(X,!1)})}append(r,_),pop()}function number$2(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bytes$2(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash$1(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(r.outputLen),number$2(r.blockLen)}function exists$2(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$2(r,t){bytes$2(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const crypto$3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=r=>r instanceof Uint8Array,createView$3=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr$2=(r,t)=>r<<32-t|r>>>t,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$4(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$3(r){if(typeof r=="string"&&(r=utf8ToBytes$4(r)),!u8a$2(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes$3(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$2(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$1(r){const t=s=>r().update(toBytes$3(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$2(r=32){if(crypto$3&&typeof crypto$3.getRandomValues=="function")return crypto$3.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$3(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}let SHA2$1=class extends Hash$2{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$3(this.buffer)}update(t){exists$2(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes$3(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$3(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){exists$2(this),output$2(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$3(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$3(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}};const Chi$2=(r,t,n)=>r&t^~r&n,Maj$2=(r,t,n)=>r&t^r&n^t&n,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$2[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$2[L-15],X=SHA256_W$2[L-2],te=rotr$2(q,7)^rotr$2(q,18)^q>>>3,ne=rotr$2(X,17)^rotr$2(X,19)^X>>>10;SHA256_W$2[L]=ne+SHA256_W$2[L-7]+te+SHA256_W$2[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$2(f,6)^rotr$2(f,11)^rotr$2(f,25),X=_+q+Chi$2(f,g,b)+SHA256_K$2[L]+SHA256_W$2[L]|0,ne=(rotr$2(s,2)^rotr$2(s,13)^rotr$2(s,22))+Maj$2(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$3=wrapConstructor$1(()=>new SHA256$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),u8a$1=r=>r instanceof Uint8Array,hexes$2=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$2(r){if(!u8a$1(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes$2[r[n]];return t}function numberToHexUnpadded$1(r){const t=r.toString(16);return t.length&1?`0${t}`:t}function hexToNumber$1(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function hexToBytes$2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function bytesToNumberBE$1(r){return hexToNumber$1(bytesToHex$2(r))}function bytesToNumberLE$1(r){if(!u8a$1(r))throw new Error("Uint8Array expected");return hexToNumber$1(bytesToHex$2(Uint8Array.from(r).reverse()))}function numberToBytesBE$1(r,t){return hexToBytes$2(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE$1(r,t){return numberToBytesBE$1(r,t).reverse()}function numberToVarBytesBE(r){return hexToBytes$2(numberToHexUnpadded$1(r))}function ensureBytes$1(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes$2(t)}catch(a){throw new Error(`${r} must be valid hex string, got "${t}". Cause: ${a}`)}else if(u8a$1(t))s=Uint8Array.from(t);else throw new Error(`${r} must be hex string or Uint8Array`);const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(`${r} expected ${n} bytes, got ${o}`);return s}function concatBytes$2(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a$1(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}function equalBytes$1(r,t){if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function utf8ToBytes$3(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function bitLen$1(r){let t;for(t=0;r>_0n$9;r>>=_1n$9,t+=1);return t}function bitGet(r,t){return r>>BigInt(t)&_1n$9}const bitSet=(r,t,n)=>r|(n?_1n$9:_0n$9)<<BigInt(t),bitMask$1=r=>(_2n$5<<BigInt(r-1))-_1n$9,u8n=r=>new Uint8Array(r),u8fr=r=>Uint8Array.from(r);function createHmacDrbg$1(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let s=u8n(r),o=u8n(r),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...L)=>n(o,s,...L),g=(L=u8n())=>{o=f(u8fr([0]),L),s=f(),L.length!==0&&(o=f(u8fr([1]),L),s=f())},b=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let L=0;const q=[];for(;L<t;){s=f();const X=s.slice();q.push(X),L+=s.length}return concatBytes$2(...q)};return(L,q)=>{c(),g(L);let X;for(;!(X=q(b()));)g();return c(),X}}const validatorFns={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function validateObject(r,t,n={}){const s=(o,a,c)=>{const f=validatorFns[a];if(typeof f!="function")throw new Error(`Invalid validator "${a}", expected function`);const g=r[o];if(!(c&&g===void 0)&&!f(g,r))throw new Error(`Invalid param ${String(o)}=${g} (${typeof g}), expected ${a}`)};for(const[o,a]of Object.entries(t))s(o,a,!1);for(const[o,a]of Object.entries(n))s(o,a,!0);return r}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen:bitLen$1,bitMask:bitMask$1,bitSet,bytesToHex:bytesToHex$2,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$2,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$1,hexToBytes:hexToBytes$2,hexToNumber:hexToNumber$1,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$3,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$2=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(r,t){const n=r%t;return n>=_0n$8?n:t+n}function pow(r,t,n){if(n<=_0n$8||t<_0n$8)throw new Error("Expected power/modulo > 0");if(n===_1n$8)return _0n$8;let s=_1n$8;for(;t>_0n$8;)t&_1n$8&&(s=s*r%n),r=r*r%n,t>>=_1n$8;return s}function pow2$1(r,t,n){let s=r;for(;t-- >_0n$8;)s*=s,s%=n;return s}function invert$1(r,t){if(r===_0n$8||t<=_0n$8)throw new Error(`invert: expected positive integers, got n=${r} mod=${t}`);let n=mod$1(r,t),s=t,o=_0n$8,a=_1n$8;for(;n!==_0n$8;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n$8)throw new Error("invert: does not exist");return mod$1(o,t)}function tonelliShanks$1(r){const t=(r-_1n$8)/_2n$4;let n,s,o;for(n=r-_1n$8,s=0;n%_2n$4===_0n$8;n/=_2n$4,s++);for(o=_2n$4;o<r&&pow(o,t,r)!==r-_1n$8;o++);if(s===1){const c=(r+_1n$8)/_4n$2;return function(g,b){const _=g.pow(b,c);if(!g.eql(g.sqr(_),b))throw new Error("Cannot find square root");return _}}const a=(n+_1n$8)/_2n$4;return function(f,g){if(f.pow(g,t)===f.neg(f.ONE))throw new Error("Cannot find square root");let b=s,_=f.pow(f.mul(f.ONE,o),n),L=f.pow(g,a),q=f.pow(g,n);for(;!f.eql(q,f.ONE);){if(f.eql(q,f.ZERO))return f.ZERO;let X=1;for(let ne=f.sqr(q);X<b&&!f.eql(ne,f.ONE);X++)ne=f.sqr(ne);const te=f.pow(_,_1n$8<<BigInt(b-X-1));_=f.sqr(te),L=f.mul(L,te),q=f.mul(q,_),b=X}return L}}function FpSqrt$1(r){if(r%_4n$2===_3n$3){const t=(r+_1n$8)/_4n$2;return function(s,o){const a=s.pow(o,t);if(!s.eql(s.sqr(a),o))throw new Error("Cannot find square root");return a}}if(r%_8n$1===_5n$1){const t=(r-_5n$1)/_8n$1;return function(s,o){const a=s.mul(o,_2n$4),c=s.pow(a,t),f=s.mul(o,c),g=s.mul(s.mul(f,_2n$4),c),b=s.mul(f,s.sub(g,s.ONE));if(!s.eql(s.sqr(b),o))throw new Error("Cannot find square root");return b}}return tonelliShanks$1(r)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS$1.reduce((s,o)=>(s[o]="function",s),t);return validateObject(r,n)}function FpPow$1(r,t,n){if(n<_0n$8)throw new Error("Expected power > 0");if(n===_0n$8)return r.ONE;if(n===_1n$8)return t;let s=r.ONE,o=t;for(;n>_0n$8;)n&_1n$8&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n$8;return s}function FpInvertBatch$1(r,t){const n=new Array(t.length),s=t.reduce((a,c,f)=>r.is0(c)?a:(n[f]=a,r.mul(a,c)),r.ONE),o=r.inv(s);return t.reduceRight((a,c,f)=>r.is0(c)?a:(n[f]=r.mul(a,n[f]),r.mul(a,c)),o),n}function nLength$1(r,t){const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field$1(r,t,n=!1,s={}){if(r<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:o,nByteLength:a}=nLength$1(r,t);if(a>2048)throw new Error("Field lengths over 2048 bytes are not supported");const c=FpSqrt$1(r),f=Object.freeze({ORDER:r,BITS:o,BYTES:a,MASK:bitMask$1(o),ZERO:_0n$8,ONE:_1n$8,create:g=>mod$1(g,r),isValid:g=>{if(typeof g!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof g}`);return _0n$8<=g&&g<r},is0:g=>g===_0n$8,isOdd:g=>(g&_1n$8)===_1n$8,neg:g=>mod$1(-g,r),eql:(g,b)=>g===b,sqr:g=>mod$1(g*g,r),add:(g,b)=>mod$1(g+b,r),sub:(g,b)=>mod$1(g-b,r),mul:(g,b)=>mod$1(g*b,r),pow:(g,b)=>FpPow$1(f,g,b),div:(g,b)=>mod$1(g*invert$1(b,r),r),sqrN:g=>g*g,addN:(g,b)=>g+b,subN:(g,b)=>g-b,mulN:(g,b)=>g*b,inv:g=>invert$1(g,r),sqrt:s.sqrt||(g=>c(f,g)),invertBatch:g=>FpInvertBatch$1(f,g),cmov:(g,b,_)=>_?b:g,toBytes:g=>n?numberToBytesLE$1(g,a):numberToBytesBE$1(g,a),fromBytes:g=>{if(g.length!==a)throw new Error(`Fp.fromBytes: expected ${a}, got ${g.length}`);return n?bytesToNumberLE$1(g):bytesToNumberBE$1(g)}});return Object.freeze(f)}function getFieldBytesLength$1(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$1(r){const t=getFieldBytesLength$1(r);return t+Math.ceil(t/2)}function mapHashToField$1(r,t,n=!1){const s=r.length,o=getFieldBytesLength$1(t),a=getMinHashLength$1(t);if(s<16||s<a||s>1024)throw new Error(`expected ${a}-1024 bytes of input, got ${s}`);const c=n?bytesToNumberBE$1(r):bytesToNumberLE$1(r),f=mod$1(c,t-_1n$8)+_1n$8;return n?numberToBytesLE$1(f,o):numberToBytesBE$1(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(r,t){const n=(o,a)=>{const c=a.negate();return o?c:a},s=o=>{const a=Math.ceil(t/o)+1,c=2**(o-1);return{windows:a,windowSize:c}};return{constTimeNegate:n,unsafeLadder(o,a){let c=r.ZERO,f=o;for(;a>_0n$7;)a&_1n$7&&(c=c.add(f)),f=f.double(),a>>=_1n$7;return c},precomputeWindow(o,a){const{windows:c,windowSize:f}=s(a),g=[];let b=o,_=b;for(let L=0;L<c;L++){_=b,g.push(_);for(let q=1;q<f;q++)_=_.add(b),g.push(_);b=_.double()}return g},wNAF(o,a,c){const{windows:f,windowSize:g}=s(o);let b=r.ZERO,_=r.BASE;const L=BigInt(2**o-1),q=2**o,X=BigInt(o);for(let te=0;te<f;te++){const ne=te*g;let Ce=Number(c&L);c>>=X,Ce>g&&(Ce-=q,c+=_1n$7);const Le=ne,Ge=ne+Math.abs(Ce)-1,ze=te%2!==0,Xe=Ce<0;Ce===0?_=_.add(n(ze,a[Le])):b=b.add(n(Xe,a[Ge]))}return{p:b,f:_}},wNAFCached(o,a,c,f){const g=o._WINDOW_SIZE||1;let b=a.get(o);return b||(b=this.precomputeWindow(o,g),g!==1&&a.set(o,f(b))),this.wNAF(g,b,c)}}}function validateBasic(r){return validateField$1(r.Fp),validateObject(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(r){const t=validateBasic(r);validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:s,a:o}=t;if(n){if(!s.eql(o,s.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER$1={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(r){const{Err:t}=DER$1;if(r.length<2||r[0]!==2)throw new t("Invalid signature integer tag");const n=r[1],s=r.subarray(2,n+2);if(!n||s.length!==n)throw new t("Invalid signature integer: wrong length");if(s[0]&128)throw new t("Invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:b2n(s),l:r.subarray(n+2)}},toSig(r){const{Err:t}=DER$1,n=typeof r=="string"?h2b(r):r;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let s=n.length;if(s<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==s-2)throw new t("Invalid signature: incorrect length");const{d:o,l:a}=DER$1._parseInt(n.subarray(2)),{d:c,l:f}=DER$1._parseInt(a);if(f.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:c}},hexFromSig(r){const t=b=>Number.parseInt(b[0],16)&8?"00"+b:b,n=b=>{const _=b.toString(16);return _.length&1?`0${_}`:_},s=t(n(r.s)),o=t(n(r.r)),a=s.length/2,c=o.length/2,f=n(a),g=n(c);return`30${n(c+a+4)}02${g}${o}02${f}${s}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints(r){const t=validatePointOpts(r),{Fp:n}=t,s=t.toBytes||((te,ne,Ce)=>{const Le=ne.toAffine();return concatBytes$2(Uint8Array.from([4]),n.toBytes(Le.x),n.toBytes(Le.y))}),o=t.fromBytes||(te=>{const ne=te.subarray(1),Ce=n.fromBytes(ne.subarray(0,n.BYTES)),Le=n.fromBytes(ne.subarray(n.BYTES,2*n.BYTES));return{x:Ce,y:Le}});function a(te){const{a:ne,b:Ce}=t,Le=n.sqr(te),Ge=n.mul(Le,te);return n.add(n.add(Ge,n.mul(te,ne)),Ce)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw new Error("bad generator point: equation left != right");function c(te){return typeof te=="bigint"&&_0n$6<te&&te<t.n}function f(te){if(!c(te))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function g(te){const{allowedPrivateKeyLengths:ne,nByteLength:Ce,wrapPrivateKey:Le,n:Ge}=t;if(ne&&typeof te!="bigint"){if(te instanceof Uint8Array&&(te=bytesToHex$2(te)),typeof te!="string"||!ne.includes(te.length))throw new Error("Invalid key");te=te.padStart(Ce*2,"0")}let ze;try{ze=typeof te=="bigint"?te:bytesToNumberBE$1(ensureBytes$1("private key",te,Ce))}catch{throw new Error(`private key must be ${Ce} bytes, hex or bigint, not ${typeof te}`)}return Le&&(ze=mod$1(ze,Ge)),f(ze),ze}const b=new Map;function _(te){if(!(te instanceof L))throw new Error("ProjectivePoint expected")}class L{constructor(ne,Ce,Le){if(this.px=ne,this.py=Ce,this.pz=Le,ne==null||!n.isValid(ne))throw new Error("x required");if(Ce==null||!n.isValid(Ce))throw new Error("y required");if(Le==null||!n.isValid(Le))throw new Error("z required")}static fromAffine(ne){const{x:Ce,y:Le}=ne||{};if(!ne||!n.isValid(Ce)||!n.isValid(Le))throw new Error("invalid affine point");if(ne instanceof L)throw new Error("projective point not allowed");const Ge=ze=>n.eql(ze,n.ZERO);return Ge(Ce)&&Ge(Le)?L.ZERO:new L(Ce,Le,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(ne){const Ce=n.invertBatch(ne.map(Le=>Le.pz));return ne.map((Le,Ge)=>Le.toAffine(Ce[Ge])).map(L.fromAffine)}static fromHex(ne){const Ce=L.fromAffine(o(ensureBytes$1("pointHex",ne)));return Ce.assertValidity(),Ce}static fromPrivateKey(ne){return L.BASE.multiply(g(ne))}_setWindowSize(ne){this._WINDOW_SIZE=ne,b.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:ne,y:Ce}=this.toAffine();if(!n.isValid(ne)||!n.isValid(Ce))throw new Error("bad point: x or y not FE");const Le=n.sqr(Ce),Ge=a(ne);if(!n.eql(Le,Ge))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:ne}=this.toAffine();if(n.isOdd)return!n.isOdd(ne);throw new Error("Field doesn't support isOdd")}equals(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne,Ve=n.eql(n.mul(Ce,He),n.mul(ze,Ge)),We=n.eql(n.mul(Le,He),n.mul(Xe,Ge));return Ve&&We}negate(){return new L(this.px,n.neg(this.py),this.pz)}double(){const{a:ne,b:Ce}=t,Le=n.mul(Ce,_3n$2),{px:Ge,py:ze,pz:Xe}=this;let He=n.ZERO,Ve=n.ZERO,We=n.ZERO,rt=n.mul(Ge,Ge),st=n.mul(ze,ze),ht=n.mul(Xe,Xe),je=n.mul(Ge,ze);return je=n.add(je,je),We=n.mul(Ge,Xe),We=n.add(We,We),He=n.mul(ne,We),Ve=n.mul(Le,ht),Ve=n.add(He,Ve),He=n.sub(st,Ve),Ve=n.add(st,Ve),Ve=n.mul(He,Ve),He=n.mul(je,He),We=n.mul(Le,We),ht=n.mul(ne,ht),je=n.sub(rt,ht),je=n.mul(ne,je),je=n.add(je,We),We=n.add(rt,rt),rt=n.add(We,rt),rt=n.add(rt,ht),rt=n.mul(rt,je),Ve=n.add(Ve,rt),ht=n.mul(ze,Xe),ht=n.add(ht,ht),rt=n.mul(ht,je),He=n.sub(He,rt),We=n.mul(ht,st),We=n.add(We,We),We=n.add(We,We),new L(He,Ve,We)}add(ne){_(ne);const{px:Ce,py:Le,pz:Ge}=this,{px:ze,py:Xe,pz:He}=ne;let Ve=n.ZERO,We=n.ZERO,rt=n.ZERO;const st=t.a,ht=n.mul(t.b,_3n$2);let je=n.mul(Ce,ze),se=n.mul(Le,Xe),m=n.mul(Ge,He),A=n.add(Ce,Le),k=n.add(ze,Xe);A=n.mul(A,k),k=n.add(je,se),A=n.sub(A,k),k=n.add(Ce,Ge);let Y=n.add(ze,He);return k=n.mul(k,Y),Y=n.add(je,m),k=n.sub(k,Y),Y=n.add(Le,Ge),Ve=n.add(Xe,He),Y=n.mul(Y,Ve),Ve=n.add(se,m),Y=n.sub(Y,Ve),rt=n.mul(st,k),Ve=n.mul(ht,m),rt=n.add(Ve,rt),Ve=n.sub(se,rt),rt=n.add(se,rt),We=n.mul(Ve,rt),se=n.add(je,je),se=n.add(se,je),m=n.mul(st,m),k=n.mul(ht,k),se=n.add(se,m),m=n.sub(je,m),m=n.mul(st,m),k=n.add(k,m),je=n.mul(se,k),We=n.add(We,je),je=n.mul(Y,k),Ve=n.mul(A,Ve),Ve=n.sub(Ve,je),je=n.mul(A,se),rt=n.mul(Y,rt),rt=n.add(rt,je),new L(Ve,We,rt)}subtract(ne){return this.add(ne.negate())}is0(){return this.equals(L.ZERO)}wNAF(ne){return X.wNAFCached(this,b,ne,Ce=>{const Le=n.invertBatch(Ce.map(Ge=>Ge.pz));return Ce.map((Ge,ze)=>Ge.toAffine(Le[ze])).map(L.fromAffine)})}multiplyUnsafe(ne){const Ce=L.ZERO;if(ne===_0n$6)return Ce;if(f(ne),ne===_1n$6)return this;const{endo:Le}=t;if(!Le)return X.unsafeLadder(this,ne);let{k1neg:Ge,k1:ze,k2neg:Xe,k2:He}=Le.splitScalar(ne),Ve=Ce,We=Ce,rt=this;for(;ze>_0n$6||He>_0n$6;)ze&_1n$6&&(Ve=Ve.add(rt)),He&_1n$6&&(We=We.add(rt)),rt=rt.double(),ze>>=_1n$6,He>>=_1n$6;return Ge&&(Ve=Ve.negate()),Xe&&(We=We.negate()),We=new L(n.mul(We.px,Le.beta),We.py,We.pz),Ve.add(We)}multiply(ne){f(ne);let Ce=ne,Le,Ge;const{endo:ze}=t;if(ze){const{k1neg:Xe,k1:He,k2neg:Ve,k2:We}=ze.splitScalar(Ce);let{p:rt,f:st}=this.wNAF(He),{p:ht,f:je}=this.wNAF(We);rt=X.constTimeNegate(Xe,rt),ht=X.constTimeNegate(Ve,ht),ht=new L(n.mul(ht.px,ze.beta),ht.py,ht.pz),Le=rt.add(ht),Ge=st.add(je)}else{const{p:Xe,f:He}=this.wNAF(Ce);Le=Xe,Ge=He}return L.normalizeZ([Le,Ge])[0]}multiplyAndAddUnsafe(ne,Ce,Le){const Ge=L.BASE,ze=(He,Ve)=>Ve===_0n$6||Ve===_1n$6||!He.equals(Ge)?He.multiplyUnsafe(Ve):He.multiply(Ve),Xe=ze(this,Ce).add(ze(ne,Le));return Xe.is0()?void 0:Xe}toAffine(ne){const{px:Ce,py:Le,pz:Ge}=this,ze=this.is0();ne==null&&(ne=ze?n.ONE:n.inv(Ge));const Xe=n.mul(Ce,ne),He=n.mul(Le,ne),Ve=n.mul(Ge,ne);if(ze)return{x:n.ZERO,y:n.ZERO};if(!n.eql(Ve,n.ONE))throw new Error("invZ was invalid");return{x:Xe,y:He}}isTorsionFree(){const{h:ne,isTorsionFree:Ce}=t;if(ne===_1n$6)return!0;if(Ce)return Ce(L,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:ne,clearCofactor:Ce}=t;return ne===_1n$6?this:Ce?Ce(L,this):this.multiplyUnsafe(t.h)}toRawBytes(ne=!0){return this.assertValidity(),s(L,this,ne)}toHex(ne=!0){return bytesToHex$2(this.toRawBytes(ne))}}L.BASE=new L(t.Gx,t.Gy,n.ONE),L.ZERO=new L(n.ZERO,n.ONE,n.ZERO);const q=t.nBitLength,X=wNAF$1(L,t.endo?Math.ceil(q/2):q);return{CURVE:t,ProjectivePoint:L,normPrivateKeyToScalar:g,weierstrassEquation:a,isWithinCurveOrder:c}}function validateOpts(r){const t=validateBasic(r);return validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$1(r){const t=validateOpts(r),{Fp:n,n:s}=t,o=n.BYTES+1,a=2*n.BYTES+1;function c(k){return _0n$6<k&&k<n.ORDER}function f(k){return mod$1(k,s)}function g(k){return invert$1(k,s)}const{ProjectivePoint:b,normPrivateKeyToScalar:_,weierstrassEquation:L,isWithinCurveOrder:q}=weierstrassPoints({...t,toBytes(k,Y,Q){const $e=Y.toAffine(),ve=n.toBytes($e.x),re=concatBytes$2;return Q?re(Uint8Array.from([Y.hasEvenY()?2:3]),ve):re(Uint8Array.from([4]),ve,n.toBytes($e.y))},fromBytes(k){const Y=k.length,Q=k[0],$e=k.subarray(1);if(Y===o&&(Q===2||Q===3)){const ve=bytesToNumberBE$1($e);if(!c(ve))throw new Error("Point is not on curve");const re=L(ve);let B=n.sqrt(re);const oe=(B&_1n$6)===_1n$6;return(Q&1)===1!==oe&&(B=n.neg(B)),{x:ve,y:B}}else if(Y===a&&Q===4){const ve=n.fromBytes($e.subarray(0,n.BYTES)),re=n.fromBytes($e.subarray(n.BYTES,2*n.BYTES));return{x:ve,y:re}}else throw new Error(`Point of length ${Y} was invalid. Expected ${o} compressed bytes or ${a} uncompressed bytes`)}}),X=k=>bytesToHex$2(numberToBytesBE$1(k,t.nByteLength));function te(k){const Y=s>>_1n$6;return k>Y}function ne(k){return te(k)?f(-k):k}const Ce=(k,Y,Q)=>bytesToNumberBE$1(k.slice(Y,Q));class Le{constructor(Y,Q,$e){this.r=Y,this.s=Q,this.recovery=$e,this.assertValidity()}static fromCompact(Y){const Q=t.nByteLength;return Y=ensureBytes$1("compactSignature",Y,Q*2),new Le(Ce(Y,0,Q),Ce(Y,Q,2*Q))}static fromDER(Y){const{r:Q,s:$e}=DER$1.toSig(ensureBytes$1("DER",Y));return new Le(Q,$e)}assertValidity(){if(!q(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!q(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Y){return new Le(this.r,this.s,Y)}recoverPublicKey(Y){const{r:Q,s:$e,recovery:ve}=this,re=We(ensureBytes$1("msgHash",Y));if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");const B=ve===2||ve===3?Q+t.n:Q;if(B>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const oe=(ve&1)===0?"02":"03",Ue=b.fromHex(oe+X(B)),Ze=g(B),lt=f(-re*Ze),St=f($e*Ze),Mt=b.BASE.multiplyAndAddUnsafe(Ue,lt,St);if(!Mt)throw new Error("point at infinify");return Mt.assertValidity(),Mt}hasHighS(){return te(this.s)}normalizeS(){return this.hasHighS()?new Le(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$2(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$2(this.toCompactHex())}toCompactHex(){return X(this.r)+X(this.s)}}const Ge={isValidPrivateKey(k){try{return _(k),!0}catch{return!1}},normPrivateKeyToScalar:_,randomPrivateKey:()=>{const k=getMinHashLength$1(t.n);return mapHashToField$1(t.randomBytes(k),t.n)},precompute(k=8,Y=b.BASE){return Y._setWindowSize(k),Y.multiply(BigInt(3)),Y}};function ze(k,Y=!0){return b.fromPrivateKey(k).toRawBytes(Y)}function Xe(k){const Y=k instanceof Uint8Array,Q=typeof k=="string",$e=(Y||Q)&&k.length;return Y?$e===o||$e===a:Q?$e===2*o||$e===2*a:k instanceof b}function He(k,Y,Q=!0){if(Xe(k))throw new Error("first arg must be private key");if(!Xe(Y))throw new Error("second arg must be public key");return b.fromHex(Y).multiply(_(k)).toRawBytes(Q)}const Ve=t.bits2int||function(k){const Y=bytesToNumberBE$1(k),Q=k.length*8-t.nBitLength;return Q>0?Y>>BigInt(Q):Y},We=t.bits2int_modN||function(k){return f(Ve(k))},rt=bitMask$1(t.nBitLength);function st(k){if(typeof k!="bigint")throw new Error("bigint expected");if(!(_0n$6<=k&&k<rt))throw new Error(`bigint expected < 2^${t.nBitLength}`);return numberToBytesBE$1(k,t.nByteLength)}function ht(k,Y,Q=je){if(["recovered","canonical"].some(Zt=>Zt in Q))throw new Error("sign() legacy options not supported");const{hash:$e,randomBytes:ve}=t;let{lowS:re,prehash:B,extraEntropy:oe}=Q;re==null&&(re=!0),k=ensureBytes$1("msgHash",k),B&&(k=ensureBytes$1("prehashed msgHash",$e(k)));const Ue=We(k),Ze=_(Y),lt=[st(Ze),st(Ue)];if(oe!=null){const Zt=oe===!0?ve(n.BYTES):oe;lt.push(ensureBytes$1("extraEntropy",Zt))}const St=concatBytes$2(...lt),Mt=Ue;function Ft(Zt){const Ut=Ve(Zt);if(!q(Ut))return;const vr=g(Ut),zr=b.BASE.multiply(Ut).toAffine(),or=f(zr.x);if(or===_0n$6)return;const sr=f(vr*f(Mt+or*Ze));if(sr===_0n$6)return;let er=(zr.x===or?0:2)|Number(zr.y&_1n$6),Xt=sr;return re&&te(sr)&&(Xt=ne(sr),er^=1),new Le(or,Xt,er)}return{seed:St,k2sig:Ft}}const je={lowS:t.lowS,prehash:!1},se={lowS:t.lowS,prehash:!1};function m(k,Y,Q=je){const{seed:$e,k2sig:ve}=ht(k,Y,Q),re=t;return createHmacDrbg$1(re.hash.outputLen,re.nByteLength,re.hmac)($e,ve)}b.BASE._setWindowSize(8);function A(k,Y,Q,$e=se){const ve=k;if(Y=ensureBytes$1("msgHash",Y),Q=ensureBytes$1("publicKey",Q),"strict"in $e)throw new Error("options.strict was renamed to lowS");const{lowS:re,prehash:B}=$e;let oe,Ue;try{if(typeof ve=="string"||ve instanceof Uint8Array)try{oe=Le.fromDER(ve)}catch(zr){if(!(zr instanceof DER$1.Err))throw zr;oe=Le.fromCompact(ve)}else if(typeof ve=="object"&&typeof ve.r=="bigint"&&typeof ve.s=="bigint"){const{r:zr,s:or}=ve;oe=new Le(zr,or)}else throw new Error("PARSE");Ue=b.fromHex(Q)}catch(zr){if(zr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(re&&oe.hasHighS())return!1;B&&(Y=t.hash(Y));const{r:Ze,s:lt}=oe,St=We(Y),Mt=g(lt),Ft=f(St*Mt),Zt=f(Ze*Mt),Ut=b.BASE.multiplyAndAddUnsafe(Ue,Ft,Zt)?.toAffine();return Ut?f(Ut.x)===Ze:!1}return{CURVE:t,getPublicKey:ze,getSharedSecret:He,sign:m,verify:A,ProjectivePoint:b,Signature:Le,utils:Ge}}let HMAC$2=class extends Hash$2{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,hash$1(t);const s=toBytes$3(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return exists$2(this),this.iHash.update(t),this}digestInto(t){exists$2(this),bytes$2(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(r,t,n)=>new HMAC$2(r,t).update(n).digest();hmac$2.create=(r,t)=>new HMAC$2(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(r){return{hash:r,hmac:(t,...n)=>hmac$2(r,t,concatBytes$3(...n)),randomBytes:randomBytes$2}}function createCurve$1(r,t){const n=s=>weierstrass$1({...r,...getHash(s)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$3=BigInt(2),divNearest$1=(r,t)=>(r+t/_2n$3)/t;function sqrtMod$1(r){const t=secp256k1P,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow2$1(_,n,t)*_%t,q=pow2$1(L,n,t)*_%t,X=pow2$1(q,_2n$3,t)*b%t,te=pow2$1(X,o,t)*X%t,ne=pow2$1(te,a,t)*te%t,Ce=pow2$1(ne,f,t)*ne%t,Le=pow2$1(Ce,g,t)*Ce%t,Ge=pow2$1(Le,f,t)*ne%t,ze=pow2$1(Ge,n,t)*_%t,Xe=pow2$1(ze,c,t)*te%t,He=pow2$1(Xe,s,t)*b%t,Ve=pow2$1(He,_2n$3,t);if(!Fp.eql(Fp.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}const Fp=Field$1(secp256k1P,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const t=secp256k1N,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,c=BigInt("0x100000000000000000000000000000000"),f=divNearest$1(a*r,t),g=divNearest$1(-s*r,t);let b=mod$1(r-f*n-g*o,t),_=mod$1(-f*s-g*a,t);const L=b>c,q=_>c;if(L&&(b=t-b),q&&(_=t-_),b>c||_>c)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}}},sha256$3),_0n$5=BigInt(0),fe=r=>typeof r=="bigint"&&_0n$5<r&&r<secp256k1P,ge=r=>typeof r=="bigint"&&_0n$5<r&&r<secp256k1N,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(r,...t){let n=TAGGED_HASH_PREFIXES$1[r];if(n===void 0){const s=sha256$3(Uint8Array.from(r,o=>o.charCodeAt(0)));n=concatBytes$2(s,s),TAGGED_HASH_PREFIXES$1[r]=n}return sha256$3(concatBytes$2(n,...t))}const pointToBytes$1=r=>r.toRawBytes(!0).slice(1),numTo32b=r=>numberToBytesBE$1(r,32),modP=r=>mod$1(r,secp256k1P),modN=r=>mod$1(r,secp256k1N),Point=secp256k1$1.ProjectivePoint,GmulAdd=(r,t,n)=>Point.BASE.multiplyAndAddUnsafe(r,t,n);function schnorrGetExtPubKey$1(r){let t=secp256k1$1.utils.normPrivateKeyToScalar(r),n=Point.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:modN(-t),bytes:pointToBytes$1(n)}}function lift_x$1(r){if(!fe(r))throw new Error("bad x: need 0 < x < p");const t=modP(r*r),n=modP(t*r+BigInt(7));let s=sqrtMod$1(n);s%_2n$3!==_0n$5&&(s=modP(-s));const o=new Point(r,s,_1n$5);return o.assertValidity(),o}function challenge$1(...r){return modN(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...r)))}function schnorrGetPublicKey$1(r){return schnorrGetExtPubKey$1(r).bytes}function schnorrSign$1(r,t,n=randomBytes$2(32)){const s=ensureBytes$1("message",r),{bytes:o,scalar:a}=schnorrGetExtPubKey$1(t),c=ensureBytes$1("auxRand",n,32),f=numTo32b(a^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",c))),g=taggedHash$1("BIP0340/nonce",f,o,s),b=modN(bytesToNumberBE$1(g));if(b===_0n$5)throw new Error("sign failed: k is zero");const{bytes:_,scalar:L}=schnorrGetExtPubKey$1(b),q=challenge$1(_,o,s),X=new Uint8Array(64);if(X.set(_,0),X.set(numTo32b(modN(L+q*a)),32),!schnorrVerify$1(X,s,o))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify$1(r,t,n){const s=ensureBytes$1("signature",r,64),o=ensureBytes$1("message",t),a=ensureBytes$1("publicKey",n,32);try{const c=lift_x$1(bytesToNumberBE$1(a)),f=bytesToNumberBE$1(s.subarray(0,32));if(!fe(f))return!1;const g=bytesToNumberBE$1(s.subarray(32,64));if(!ge(g))return!1;const b=challenge$1(numTo32b(f),pointToBytes$1(c),o),_=GmulAdd(c,g,modN(-b));return!(!_||!_.hasEvenY()||_.toAffine().x!==f)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=r=>r instanceof Uint8Array,u32$1=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView$2=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),rotr$1=(r,t)=>r<<32-t|r>>>t,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$1=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$1(r){if(!u8a(r))throw new Error("Uint8Array expected");let t="";for(let n=0;n<r.length;n++)t+=hexes$1[r[n]];return t}function hexToBytes$1(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const t=r.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const o=s*2,a=r.slice(o,o+2),c=Number.parseInt(a,16);if(Number.isNaN(c)||c<0)throw new Error("Invalid byte sequence");n[s]=c}return n}function utf8ToBytes$2(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$2(r){if(typeof r=="string"&&(r=utf8ToBytes$2(r)),!u8a(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function concatBytes$1(...r){const t=new Uint8Array(r.reduce((s,o)=>s+o.length,0));let n=0;return r.forEach(s=>{if(!u8a(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$1=class{clone(){return this._cloneInto()}};const isPlainObject$1=r=>Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object;function checkOpts$1(r,t){if(t!==void 0&&(typeof t!="object"||!isPlainObject$1(t)))throw new Error("Options should be object or undefined");return Object.assign(r,t)}function wrapConstructor(r){const t=s=>r().update(toBytes$2(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes$1(r=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function number$1(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function bool$1(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function bytes$1(r,...t){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(r.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${r.length}`)}function hash(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(r.outputLen),number$1(r.blockLen)}function exists$1(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output$1(r,t){bytes$1(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists:exists$1,output:output$1};function setBigUint64$2(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}class SHA2 extends Hash$1{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$2(this.buffer)}update(t){assert.exists(this);const{view:n,buffer:s,blockLen:o}=this;t=toBytes$2(t);const a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView$2(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){assert.exists(this),assert.output(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64$2(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView$2(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.length=o,t.pos=f,t.finished=a,t.destroyed=c,o%n&&t.buffer.set(s),t}}const Chi$1=(r,t,n)=>r&t^~r&n,Maj$1=(r,t,n)=>r&t^r&n^t&n,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W$1[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W$1[L-15],X=SHA256_W$1[L-2],te=rotr$1(q,7)^rotr$1(q,18)^q>>>3,ne=rotr$1(X,17)^rotr$1(X,19)^X>>>10;SHA256_W$1[L]=ne+SHA256_W$1[L-7]+te+SHA256_W$1[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr$1(f,6)^rotr$1(f,11)^rotr$1(f,25),X=_+q+Chi$1(f,g,b)+SHA256_K$1[L]+SHA256_W$1[L]|0,ne=(rotr$1(s,2)^rotr$1(s,13)^rotr$1(s,22))+Maj$1(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$2=wrapConstructor(()=>new SHA256$1);wrapConstructor(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(r){if(!Number.isSafeInteger(r))throw new Error(`Wrong integer: ${r}`)}function chain(...r){const t=(o,a)=>c=>o(a(c)),n=Array.from(r).reverse().reduce((o,a)=>o?t(o,a.encode):a.encode,void 0),s=r.reduce((o,a)=>o?t(o,a.decode):a.decode,void 0);return{encode:n,decode:s}}function alphabet(r){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(assertNumber(n),n<0||n>=r.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${r.length})`);return r[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=r.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${r}`);return s})}}}function join$1(r=""){if(typeof r!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(r)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(r)}}}function padding(r,t="="){if(assertNumber(r),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;n.length*r%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let s=n.length;if(s*r%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&n[s-1]===t;s--)if(!((s-1)*r%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,s)}}}function normalize$2(r){if(typeof r!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>r(t)}}function convertRadix(r,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(r))throw new Error("convertRadix: data should be array");if(!r.length)return[];let s=0;const o=[],a=Array.from(r);for(a.forEach(c=>{if(assertNumber(c),c<0||c>=t)throw new Error(`Wrong integer: ${c}`)});;){let c=0,f=!0;for(let g=s;g<a.length;g++){const b=a[g],_=t*c+b;if(!Number.isSafeInteger(_)||t*c/t!==c||_-b!==t*c)throw new Error("convertRadix: carry overflow");if(c=_%n,a[g]=Math.floor(_/n),!Number.isSafeInteger(a[g])||a[g]*n+c!==_)throw new Error("convertRadix: carry overflow");if(f)a[g]?f=!1:s=g;else continue}if(o.push(c),f)break}for(let c=0;c<r.length-1&&r[c]===0;c++)o.push(0);return o.reverse()}const gcd=(r,t)=>t?gcd(t,r%t):r,radix2carry=(r,t)=>r+(t-gcd(r,t));function convertRadix2(r,t,n,s){if(!Array.isArray(r))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${radix2carry(t,n)}`);let o=0,a=0;const c=2**n-1,f=[];for(const g of r){if(assertNumber(g),g>=2**t)throw new Error(`convertRadix2: invalid data word=${g} from=${t}`);if(o=o<<t|g,a+t>32)throw new Error(`convertRadix2: carry overflow pos=${a} from=${t}`);for(a+=t;a>=n;a-=n)f.push((o>>a-n&c)>>>0);o&=2**a-1}if(o=o<<n-a&c,!s&&a>=t)throw new Error("Excess padding");if(!s&&o)throw new Error(`Non-zero padding: ${o}`);return s&&a>0&&f.push(o>>>0),f}function radix(r){return assertNumber(r),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(t),2**8,r)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(t,r,2**8))}}}function radix2(r,t=!1){if(assertNumber(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,r)>32||radix2carry(r,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(n),8,r,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(n,r,8,t))}}}function unsafeWrapper(r){if(typeof r!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return r.apply(null,t)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join$1("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join$1(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join$1(""));chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join$1(""),normalize$2(r=>r.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join$1("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join$1("")),genBase58=r=>chain(radix(58),alphabet(r),join$1("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(r){let t="";for(let n=0;n<r.length;n+=8){const s=r.subarray(n,n+8);t+=base58.encode(s).padStart(XMR_BLOCK_LEN[s.length],"1")}return t},decode(r){let t=[];for(let n=0;n<r.length;n+=11){const s=r.slice(n,n+11),o=XMR_BLOCK_LEN.indexOf(s.length),a=base58.decode(s);for(let c=0;c<a.length-o;c++)if(a[c]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(a.slice(a.length-o)))}return Uint8Array.from(t)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$1("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(r){const t=r>>25;let n=(r&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS.length;s++)(t>>s&1)===1&&(n^=POLYMOD_GENERATORS[s]);return n}function bechChecksum(r,t,n=1){const s=r.length;let o=1;for(let a=0;a<s;a++){const c=r.charCodeAt(a);if(c<33||c>126)throw new Error(`Invalid prefix (${r})`);o=bech32Polymod(o)^c>>5}o=bech32Polymod(o);for(let a=0;a<s;a++)o=bech32Polymod(o)^r.charCodeAt(a)&31;for(let a of t)o=bech32Polymod(o)^a;for(let a=0;a<6;a++)o=bech32Polymod(o);return o^=n,BECH_ALPHABET.encode(convertRadix2([o%2**30],30,5,!1))}function genBech32(r){const t=r==="bech32"?1:734539939,n=radix2(5),s=n.decode,o=n.encode,a=unsafeWrapper(s);function c(_,L,q=90){if(typeof _!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof _}`);if(!Array.isArray(L)||L.length&&typeof L[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof L}`);const X=_.length+7+L.length;if(q!==!1&&X>q)throw new TypeError(`Length ${X} exceeds limit ${q}`);return _=_.toLowerCase(),`${_}1${BECH_ALPHABET.encode(L)}${bechChecksum(_,L,t)}`}function f(_,L=90){if(typeof _!="string")throw new Error(`bech32.decode input should be string, not ${typeof _}`);if(_.length<8||L!==!1&&_.length>L)throw new TypeError(`Wrong string length: ${_.length} (${_}). Expected (8..${L})`);const q=_.toLowerCase();if(_!==q&&_!==_.toUpperCase())throw new Error("String must be lowercase or uppercase");_=q;const X=_.lastIndexOf("1");if(X===0||X===-1)throw new Error('Letter "1" must be present between prefix and data only');const te=_.slice(0,X),ne=_.slice(X+1);if(ne.length<6)throw new Error("Data must be at least 6 characters long");const Ce=BECH_ALPHABET.decode(ne).slice(0,-6),Le=bechChecksum(te,Ce,t);if(!ne.endsWith(Le))throw new Error(`Invalid checksum in ${_}: expected "${Le}"`);return{prefix:te,words:Ce}}const g=unsafeWrapper(f);function b(_){const{prefix:L,words:q}=f(_,!1);return{prefix:L,words:q,bytes:s(q)}}return{encode:c,decode:f,decodeToBytes:b,decodeUnsafe:g,fromWords:s,fromWordsUnsafe:a,toWords:o}}const bech32$1=genBech32("bech32");genBech32("bech32m");const utf8$1={encode:r=>new TextDecoder().decode(r),decode:r=>new TextEncoder().encode(r)},hex$1=chain(radix2(4),alphabet("0123456789abcdef"),join$1(""),normalize$2(r=>{if(typeof r!="string"||r.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof r} with length ${r.length}`);return r.toLowerCase()})),CODERS={utf8:utf8$1,hex:hex$1,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function bool(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function isBytes$1(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function bytes(r,...t){if(!isBytes$1(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${r.length}`)}function exists(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function output(r,t){bytes(r);const n=t.outputLen;if(r.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),createView$1=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$1(r){if(typeof r!="string")throw new Error(`string expected, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function toBytes$1(r){if(typeof r=="string")r=utf8ToBytes$1(r);else if(isBytes$1(r))r=r.slice();else throw new Error(`Uint8Array expected, got ${typeof r}`);return r}function checkOpts(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function equalBytes(r,t){if(r.length!==t.length)return!1;let n=0;for(let s=0;s<r.length;s++)n|=r[s]^t[s];return n===0}const wrapCipher=(r,t)=>(Object.assign(t,r),t);function setBigUint64$1(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=4,b=0;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}const BLOCK_SIZE=16,POLY=283;function mul2(r){return r<<1^POLY&-(r>>7)}function mul(r,t){let n=0;for(;t>0;t>>=1)n^=r&-(t&1),r=mul2(r);return n}const sbox=(()=>{let r=new Uint8Array(256);for(let n=0,s=1;n<256;n++,s^=mul2(s))r[n]=s;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let s=r[255-n];s|=s<<8,t[r[n]]=(s^s>>4^s>>5^s>>6^s>>7^99)&255}return t})(),invSbox=sbox.map((r,t)=>sbox.indexOf(t)),rotr32_8=r=>r<<24|r>>>8,rotl32_8=r=>r<<8|r>>>24;function genTtable(r,t){if(r.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((b,_)=>t(r[_])),s=n.map(rotl32_8),o=s.map(rotl32_8),a=o.map(rotl32_8),c=new Uint32Array(256*256),f=new Uint32Array(256*256),g=new Uint16Array(256*256);for(let b=0;b<256;b++)for(let _=0;_<256;_++){const L=b*256+_;c[L]=n[b]^s[_],f[L]=o[b]^a[_],g[L]=r[b]<<8|r[_]}return{sbox:r,sbox2:g,T0:n,T1:s,T2:o,T3:a,T01:c,T23:f}}const tableEncoding=genTtable(sbox,r=>mul(r,3)<<24|r<<16|r<<8|mul(r,2)),tableDecoding=genTtable(invSbox,r=>mul(r,11)<<24|mul(r,13)<<16|mul(r,9)<<8|mul(r,14)),xPowers=(()=>{const r=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=mul2(n))r[t]=n;return r})();function expandKeyLE(r){bytes(r);const t=r.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=tableEncoding,s=u32(r),o=s.length,a=f=>applySbox(n,f,f,f,f),c=new Uint32Array(t+28);c.set(s);for(let f=o;f<c.length;f++){let g=c[f-1];f%o===0?g=a(rotr32_8(g))^xPowers[f/o-1]:o>6&&f%o===4&&(g=a(g)),c[f]=c[f-o]^g}return c}function expandKeyDecLE(r){const t=expandKeyLE(r),n=t.slice(),s=t.length,{sbox2:o}=tableEncoding,{T0:a,T1:c,T2:f,T3:g}=tableDecoding;for(let b=0;b<s;b+=4)for(let _=0;_<4;_++)n[b+_]=t[s-b-4+_];t.fill(0);for(let b=4;b<s-4;b++){const _=n[b],L=applySbox(o,_,_,_,_);n[b]=a[L&255]^c[L>>>8&255]^f[L>>>16&255]^g[L>>>24]}return n}function apply0123(r,t,n,s,o,a){return r[n<<8&65280|s>>>8&255]^t[o>>>8&65280|a>>>24&255]}function applySbox(r,t,n,s,o){return r[t&255|n&65280]|r[s>>>16&255|o>>>16&65280]<<16}function encrypt$3(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableEncoding;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123(c,f,t,n,s,o),Ce=r[g++]^apply0123(c,f,n,s,o,t),Le=r[g++]^apply0123(c,f,s,o,t,n),Ge=r[g++]^apply0123(c,f,o,t,n,s);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox(a,t,n,s,o),L=r[g++]^applySbox(a,n,s,o,t),q=r[g++]^applySbox(a,s,o,t,n),X=r[g++]^applySbox(a,o,t,n,s);return{s0:_,s1:L,s2:q,s3:X}}function decrypt$3(r,t,n,s,o){const{sbox2:a,T01:c,T23:f}=tableDecoding;let g=0;t^=r[g++],n^=r[g++],s^=r[g++],o^=r[g++];const b=r.length/4-2;for(let te=0;te<b;te++){const ne=r[g++]^apply0123(c,f,t,o,s,n),Ce=r[g++]^apply0123(c,f,n,t,o,s),Le=r[g++]^apply0123(c,f,s,n,t,o),Ge=r[g++]^apply0123(c,f,o,s,n,t);t=ne,n=Ce,s=Le,o=Ge}const _=r[g++]^applySbox(a,t,o,s,n),L=r[g++]^applySbox(a,n,t,o,s),q=r[g++]^applySbox(a,s,n,t,o),X=r[g++]^applySbox(a,o,s,n,t);return{s0:_,s1:L,s2:q,s3:X}}function getDst(r,t){if(!t)return new Uint8Array(r);if(bytes(t),t.length<r)throw new Error(`aes: wrong destination length, expected at least ${r}, got: ${t.length}`);return t}function validateBlockDecrypt(r){if(bytes(r),r.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(r,t,n){let s=r.length;const o=s%BLOCK_SIZE;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const a=u32(r);if(t){let g=BLOCK_SIZE-o;g||(g=BLOCK_SIZE),s=s+g}const c=getDst(s,n),f=u32(c);return{b:a,o:f,out:c}}function validatePCKS(r,t){if(!t)return r;const n=r.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const s=r[n-1];if(s<=0||s>16)throw new Error(`aes/pcks5: wrong padding byte: ${s}`);const o=r.subarray(0,-s);for(let a=0;a<s;a++)if(r[n-a-1]!==s)throw new Error("aes/pcks5: wrong padding");return o}function padPCKS(r){const t=new Uint8Array(16),n=u32(t);t.set(r);const s=BLOCK_SIZE-r.length;for(let o=BLOCK_SIZE-s;o<BLOCK_SIZE;o++)t[o]=s;return n}const cbc=wrapCipher({blockSize:16,nonceLength:16},function r(t,n,s={}){bytes(t),bytes(n,16);const o=!s.disablePadding;return{encrypt:(a,c)=>{const f=expandKeyLE(t),{b:g,o:b,out:_}=validateBlockEncrypt(a,o,c),L=u32(n);let q=L[0],X=L[1],te=L[2],ne=L[3],Ce=0;for(;Ce+4<=g.length;)q^=g[Ce+0],X^=g[Ce+1],te^=g[Ce+2],ne^=g[Ce+3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$3(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne;if(o){const Le=padPCKS(a.subarray(Ce*4));q^=Le[0],X^=Le[1],te^=Le[2],ne^=Le[3],{s0:q,s1:X,s2:te,s3:ne}=encrypt$3(f,q,X,te,ne),b[Ce++]=q,b[Ce++]=X,b[Ce++]=te,b[Ce++]=ne}return f.fill(0),_},decrypt:(a,c)=>{validateBlockDecrypt(a);const f=expandKeyDecLE(t),g=u32(n),b=getDst(a.length,c),_=u32(a),L=u32(b);let q=g[0],X=g[1],te=g[2],ne=g[3];for(let Ce=0;Ce+4<=_.length;){const Le=q,Ge=X,ze=te,Xe=ne;q=_[Ce+0],X=_[Ce+1],te=_[Ce+2],ne=_[Ce+3];const{s0:He,s1:Ve,s2:We,s3:rt}=decrypt$3(f,q,X,te,ne);L[Ce++]=He^Le,L[Ce++]=Ve^Ge,L[Ce++]=We^ze,L[Ce++]=rt^Xe}return f.fill(0),validatePCKS(b,o)}}}),u8to16=(r,t)=>r[t++]&255|(r[t++]&255)<<8;class Poly1305{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=toBytes$1(t),bytes(t,32);const n=u8to16(t,0),s=u8to16(t,2),o=u8to16(t,4),a=u8to16(t,6),c=u8to16(t,8),f=u8to16(t,10),g=u8to16(t,12),b=u8to16(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|s<<3)&8191,this.r[2]=(s>>>10|o<<6)&7939,this.r[3]=(o>>>7|a<<9)&8191,this.r[4]=(a>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|f<<2)&8191,this.r[7]=(f>>>11|g<<5)&8065,this.r[8]=(g>>>8|b<<8)&8191,this.r[9]=b>>>5&127;for(let _=0;_<8;_++)this.pad[_]=u8to16(t,16+2*_)}process(t,n,s=!1){const o=s?0:2048,{h:a,r:c}=this,f=c[0],g=c[1],b=c[2],_=c[3],L=c[4],q=c[5],X=c[6],te=c[7],ne=c[8],Ce=c[9],Le=u8to16(t,n+0),Ge=u8to16(t,n+2),ze=u8to16(t,n+4),Xe=u8to16(t,n+6),He=u8to16(t,n+8),Ve=u8to16(t,n+10),We=u8to16(t,n+12),rt=u8to16(t,n+14);let st=a[0]+(Le&8191),ht=a[1]+((Le>>>13|Ge<<3)&8191),je=a[2]+((Ge>>>10|ze<<6)&8191),se=a[3]+((ze>>>7|Xe<<9)&8191),m=a[4]+((Xe>>>4|He<<12)&8191),A=a[5]+(He>>>1&8191),k=a[6]+((He>>>14|Ve<<2)&8191),Y=a[7]+((Ve>>>11|We<<5)&8191),Q=a[8]+((We>>>8|rt<<8)&8191),$e=a[9]+(rt>>>5|o),ve=0,re=ve+st*f+ht*(5*Ce)+je*(5*ne)+se*(5*te)+m*(5*X);ve=re>>>13,re&=8191,re+=A*(5*q)+k*(5*L)+Y*(5*_)+Q*(5*b)+$e*(5*g),ve+=re>>>13,re&=8191;let B=ve+st*g+ht*f+je*(5*Ce)+se*(5*ne)+m*(5*te);ve=B>>>13,B&=8191,B+=A*(5*X)+k*(5*q)+Y*(5*L)+Q*(5*_)+$e*(5*b),ve+=B>>>13,B&=8191;let oe=ve+st*b+ht*g+je*f+se*(5*Ce)+m*(5*ne);ve=oe>>>13,oe&=8191,oe+=A*(5*te)+k*(5*X)+Y*(5*q)+Q*(5*L)+$e*(5*_),ve+=oe>>>13,oe&=8191;let Ue=ve+st*_+ht*b+je*g+se*f+m*(5*Ce);ve=Ue>>>13,Ue&=8191,Ue+=A*(5*ne)+k*(5*te)+Y*(5*X)+Q*(5*q)+$e*(5*L),ve+=Ue>>>13,Ue&=8191;let Ze=ve+st*L+ht*_+je*b+se*g+m*f;ve=Ze>>>13,Ze&=8191,Ze+=A*(5*Ce)+k*(5*ne)+Y*(5*te)+Q*(5*X)+$e*(5*q),ve+=Ze>>>13,Ze&=8191;let lt=ve+st*q+ht*L+je*_+se*b+m*g;ve=lt>>>13,lt&=8191,lt+=A*f+k*(5*Ce)+Y*(5*ne)+Q*(5*te)+$e*(5*X),ve+=lt>>>13,lt&=8191;let St=ve+st*X+ht*q+je*L+se*_+m*b;ve=St>>>13,St&=8191,St+=A*g+k*f+Y*(5*Ce)+Q*(5*ne)+$e*(5*te),ve+=St>>>13,St&=8191;let Mt=ve+st*te+ht*X+je*q+se*L+m*_;ve=Mt>>>13,Mt&=8191,Mt+=A*b+k*g+Y*f+Q*(5*Ce)+$e*(5*ne),ve+=Mt>>>13,Mt&=8191;let Ft=ve+st*ne+ht*te+je*X+se*q+m*L;ve=Ft>>>13,Ft&=8191,Ft+=A*_+k*b+Y*g+Q*f+$e*(5*Ce),ve+=Ft>>>13,Ft&=8191;let Zt=ve+st*Ce+ht*ne+je*te+se*X+m*q;ve=Zt>>>13,Zt&=8191,Zt+=A*L+k*_+Y*b+Q*g+$e*f,ve+=Zt>>>13,Zt&=8191,ve=(ve<<2)+ve|0,ve=ve+re|0,re=ve&8191,ve=ve>>>13,B+=ve,a[0]=re,a[1]=B,a[2]=oe,a[3]=Ue,a[4]=Ze,a[5]=lt,a[6]=St,a[7]=Mt,a[8]=Ft,a[9]=Zt}finalize(){const{h:t,pad:n}=this,s=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let f=2;f<10;f++)t[f]+=o,o=t[f]>>>13,t[f]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,s[0]=t[0]+5,o=s[0]>>>13,s[0]&=8191;for(let f=1;f<10;f++)s[f]=t[f]+o,o=s[f]>>>13,s[f]&=8191;s[9]-=8192;let a=(o^1)-1;for(let f=0;f<10;f++)s[f]&=a;a=~a;for(let f=0;f<10;f++)t[f]=t[f]&a|s[f];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let c=t[0]+n[0];t[0]=c&65535;for(let f=1;f<8;f++)c=(t[f]+n[f]|0)+(c>>>16)|0,t[f]=c&65535}update(t){exists(this);const{buffer:n,blockLen:s}=this;t=toBytes$1(t);const o=t.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){for(;s<=o-a;a+=s)this.process(t,a);continue}n.set(t.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){exists(this),output(t,this),this.finished=!0;const{buffer:n,h:s}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let a=0;for(let c=0;c<8;c++)t[a++]=s[c]>>>0,t[a++]=s[c]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}}function wrapConstructorWithKey(r){const t=(s,o)=>r(o).update(toBytes$1(s)).digest(),n=r(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>r(s),t}const poly1305=wrapConstructorWithKey(r=>new Poly1305(r)),_utf8ToBytes=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl$2(r,t){return r<<t|r>>>32-t}function isAligned32(r){return r.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(r,t,n,s,o,a,c,f){const g=o.length,b=new Uint8Array(BLOCK_LEN),_=u32(b),L=isAligned32(o)&&isAligned32(a),q=L?u32(o):U32_EMPTY,X=L?u32(a):U32_EMPTY;for(let te=0;te<g;c++){if(r(t,n,s,_,c,f),c>=MAX_COUNTER)throw new Error("arx: counter overflow");const ne=Math.min(BLOCK_LEN,g-te);if(L&&ne===BLOCK_LEN){const Ce=te/4;if(te%4!==0)throw new Error("arx: invalid block position");for(let Le=0,Ge;Le<BLOCK_LEN32;Le++)Ge=Ce+Le,X[Ge]=q[Ge]^_[Le];te+=BLOCK_LEN;continue}for(let Ce=0,Le;Ce<ne;Ce++)Le=te+Ce,a[Le]=o[Le]^b[Ce];te+=ne}}function createCipher(r,t){const{allowShortKeys:n,extendNonceFn:s,counterLength:o,counterRight:a,rounds:c}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return number(o),number(c),bool(a),bool(n),(f,g,b,_,L=0)=>{bytes(f),bytes(g),bytes(b);const q=b.length;if(_||(_=new Uint8Array(q)),bytes(_),number(L),L<0||L>=MAX_COUNTER)throw new Error("arx: counter overflow");if(_.length<q)throw new Error(`arx: output (${_.length}) is shorter than data (${q})`);const X=[];let te=f.length,ne,Ce;if(te===32)ne=f.slice(),X.push(ne),Ce=sigma32_32;else if(te===16&&n)ne=new Uint8Array(32),ne.set(f),ne.set(f,16),Ce=sigma16_32,X.push(ne);else throw new Error(`arx: invalid 32-byte key, got length=${te}`);isAligned32(g)||(g=g.slice(),X.push(g));const Le=u32(ne);if(s){if(g.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(Ce,Le,u32(g.subarray(0,16)),Le),g=g.subarray(16)}const Ge=16-o;if(Ge!==g.length)throw new Error(`arx: nonce must be ${Ge} or 16 bytes`);if(Ge!==12){const Xe=new Uint8Array(12);Xe.set(g,a?0:12-g.length),g=Xe,X.push(g)}const ze=u32(g);for(runCipher(r,Ce,Le,ze,b,_,L,c);X.length>0;)X.pop().fill(0);return _}}function chachaCore(r,t,n,s,o,a=20){let c=r[0],f=r[1],g=r[2],b=r[3],_=t[0],L=t[1],q=t[2],X=t[3],te=t[4],ne=t[5],Ce=t[6],Le=t[7],Ge=o,ze=n[0],Xe=n[1],He=n[2],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let Ue=0;Ue<a;Ue+=2)Ve=Ve+ht|0,$e=rotl$2($e^Ve,16),A=A+$e|0,ht=rotl$2(ht^A,12),Ve=Ve+ht|0,$e=rotl$2($e^Ve,8),A=A+$e|0,ht=rotl$2(ht^A,7),We=We+je|0,ve=rotl$2(ve^We,16),k=k+ve|0,je=rotl$2(je^k,12),We=We+je|0,ve=rotl$2(ve^We,8),k=k+ve|0,je=rotl$2(je^k,7),rt=rt+se|0,re=rotl$2(re^rt,16),Y=Y+re|0,se=rotl$2(se^Y,12),rt=rt+se|0,re=rotl$2(re^rt,8),Y=Y+re|0,se=rotl$2(se^Y,7),st=st+m|0,B=rotl$2(B^st,16),Q=Q+B|0,m=rotl$2(m^Q,12),st=st+m|0,B=rotl$2(B^st,8),Q=Q+B|0,m=rotl$2(m^Q,7),Ve=Ve+je|0,B=rotl$2(B^Ve,16),Y=Y+B|0,je=rotl$2(je^Y,12),Ve=Ve+je|0,B=rotl$2(B^Ve,8),Y=Y+B|0,je=rotl$2(je^Y,7),We=We+se|0,$e=rotl$2($e^We,16),Q=Q+$e|0,se=rotl$2(se^Q,12),We=We+se|0,$e=rotl$2($e^We,8),Q=Q+$e|0,se=rotl$2(se^Q,7),rt=rt+m|0,ve=rotl$2(ve^rt,16),A=A+ve|0,m=rotl$2(m^A,12),rt=rt+m|0,ve=rotl$2(ve^rt,8),A=A+ve|0,m=rotl$2(m^A,7),st=st+ht|0,re=rotl$2(re^st,16),k=k+re|0,ht=rotl$2(ht^k,12),st=st+ht|0,re=rotl$2(re^st,8),k=k+re|0,ht=rotl$2(ht^k,7);let oe=0;s[oe++]=c+Ve|0,s[oe++]=f+We|0,s[oe++]=g+rt|0,s[oe++]=b+st|0,s[oe++]=_+ht|0,s[oe++]=L+je|0,s[oe++]=q+se|0,s[oe++]=X+m|0,s[oe++]=te+A|0,s[oe++]=ne+k|0,s[oe++]=Ce+Y|0,s[oe++]=Le+Q|0,s[oe++]=Ge+$e|0,s[oe++]=ze+ve|0,s[oe++]=Xe+re|0,s[oe++]=He+B|0}function hchacha(r,t,n,s){let o=r[0],a=r[1],c=r[2],f=r[3],g=t[0],b=t[1],_=t[2],L=t[3],q=t[4],X=t[5],te=t[6],ne=t[7],Ce=n[0],Le=n[1],Ge=n[2],ze=n[3];for(let He=0;He<20;He+=2)o=o+g|0,Ce=rotl$2(Ce^o,16),q=q+Ce|0,g=rotl$2(g^q,12),o=o+g|0,Ce=rotl$2(Ce^o,8),q=q+Ce|0,g=rotl$2(g^q,7),a=a+b|0,Le=rotl$2(Le^a,16),X=X+Le|0,b=rotl$2(b^X,12),a=a+b|0,Le=rotl$2(Le^a,8),X=X+Le|0,b=rotl$2(b^X,7),c=c+_|0,Ge=rotl$2(Ge^c,16),te=te+Ge|0,_=rotl$2(_^te,12),c=c+_|0,Ge=rotl$2(Ge^c,8),te=te+Ge|0,_=rotl$2(_^te,7),f=f+L|0,ze=rotl$2(ze^f,16),ne=ne+ze|0,L=rotl$2(L^ne,12),f=f+L|0,ze=rotl$2(ze^f,8),ne=ne+ze|0,L=rotl$2(L^ne,7),o=o+b|0,ze=rotl$2(ze^o,16),te=te+ze|0,b=rotl$2(b^te,12),o=o+b|0,ze=rotl$2(ze^o,8),te=te+ze|0,b=rotl$2(b^te,7),a=a+_|0,Ce=rotl$2(Ce^a,16),ne=ne+Ce|0,_=rotl$2(_^ne,12),a=a+_|0,Ce=rotl$2(Ce^a,8),ne=ne+Ce|0,_=rotl$2(_^ne,7),c=c+L|0,Le=rotl$2(Le^c,16),q=q+Le|0,L=rotl$2(L^q,12),c=c+L|0,Le=rotl$2(Le^c,8),q=q+Le|0,L=rotl$2(L^q,7),f=f+g|0,Ge=rotl$2(Ge^f,16),X=X+Ge|0,g=rotl$2(g^X,12),f=f+g|0,Ge=rotl$2(Ge^f,8),X=X+Ge|0,g=rotl$2(g^X,7);let Xe=0;s[Xe++]=o,s[Xe++]=a,s[Xe++]=c,s[Xe++]=f,s[Xe++]=Ce,s[Xe++]=Le,s[Xe++]=Ge,s[Xe++]=ze}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xchacha20=createCipher(chachaCore,{counterRight:!1,counterLength:8,extendNonceFn:hchacha,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(r,t)=>{r.update(t);const n=t.length%16;n&&r.update(ZEROS16.subarray(n))},ZEROS32=new Uint8Array(32);function computeTag(r,t,n,s,o){const a=r(t,n,ZEROS32),c=poly1305.create(a);o&&updatePadded(c,o),updatePadded(c,s);const f=new Uint8Array(16),g=createView$1(f);setBigUint64$1(g,0,BigInt(o?o.length:0),!0),setBigUint64$1(g,8,BigInt(s.length),!0),c.update(f);const b=c.digest();return a.fill(0),b}const _poly1305_aead=r=>(t,n,s)=>(bytes(t,32),bytes(n),{encrypt:(a,c)=>{const f=a.length,g=f+16;c?bytes(c,g):c=new Uint8Array(g),r(t,n,a,c,1);const b=computeTag(r,t,n,c.subarray(0,-16),s);return c.set(b,f),c},decrypt:(a,c)=>{const f=a.length,g=f-16;if(f<16)throw new Error("encrypted data must be at least 16 bytes");c?bytes(c,g):c=new Uint8Array(g);const b=a.subarray(0,-16),_=a.subarray(-16),L=computeTag(r,t,n,b,s);if(!equalBytes(_,L))throw new Error("invalid tag");return r(t,n,b,c,1),c}}),xchacha20poly1305=wrapCipher({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead(xchacha20));let HMAC$1=class extends Hash$1{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,assert.hash(t);const s=toBytes$2(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),a.fill(0)}update(t){return assert.exists(this),this.iHash.update(t),this}digestInto(t){assert.exists(this),assert.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(r,t,n)=>new HMAC$1(r,t).update(n).digest();hmac$1.create=(r,t)=>new HMAC$1(r,t);function extract(r,t,n){return assert.hash(r),hmac$1(r,toBytes$2(n),toBytes$2(t))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(r,t,n,s=32){if(assert.hash(r),assert.number(s),s>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(s/r.outputLen);n===void 0&&(n=EMPTY_BUFFER);const a=new Uint8Array(o*r.outputLen),c=hmac$1.create(r,t),f=c._cloneInto(),g=new Uint8Array(c.outputLen);for(let b=0;b<o;b++)HKDF_COUNTER[0]=b+1,f.update(b===0?EMPTY_BUFFER:g).update(n).update(HKDF_COUNTER).digestInto(g),a.set(g,r.outputLen*b),c._cloneInto(f);return c.destroy(),f.destroy(),g.fill(0),HKDF_COUNTER.fill(0),a.slice(0,s)}var __defProp$1=Object.defineProperty,__export=(r,t)=>{for(var n in t)__defProp$1(r,n,{get:t[n],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=r=>r instanceof Object;function validateEvent(r){if(!isRecord(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let t=0;t<r.tags.length;t++){let n=r.tags[t];if(!Array.isArray(n))return!1;for(let s=0;s<n.length;s++)if(typeof n[s]!="string")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,bytesToHex:()=>bytesToHex$1,hexToBytes:()=>hexToBytes$1,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder$1,utf8Encoder:()=>utf8Encoder$1});var utf8Decoder$1=new TextDecoder("utf-8"),utf8Encoder$1=new TextEncoder;function normalizeURL(r){try{r.indexOf("://")===-1&&(r="wss://"+r);let t=new URL(r);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${r}`)}}function insertEventIntoDescendingList(r,t){const[n,s]=binarySearch(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return s||r.splice(n,0,t),r}function insertEventIntoAscendingList(r,t){const[n,s]=binarySearch(r,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return s||r.splice(n,0,t),r}function binarySearch(r,t){let n=0,s=r.length-1;for(;n<=s;){const o=Math.floor((n+s)/2),a=t(r[o]);if(a===0)return[o,!0];a<0?s=o-1:n=o+1}return[n,!1]}var QueueNode=class{value;next=null;prev=null;constructor(r){this.value=r}},Queue=class{first;last;constructor(){this.first=null,this.last=null}enqueue(r){const t=new QueueNode(r);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const r=this.first;return this.first=r.next,this.first&&(this.first.prev=null),r.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(r){return bytesToHex$1(schnorr$1.getPublicKey(r))}finalizeEvent(r,t){const n=r;return n.pubkey=bytesToHex$1(schnorr$1.getPublicKey(t)),n.id=getEventHash$1(n),n.sig=bytesToHex$1(schnorr$1.sign(getEventHash$1(n),t)),n[verifiedSymbol]=!0,n}verifyEvent(r){if(typeof r[verifiedSymbol]=="boolean")return r[verifiedSymbol];const t=getEventHash$1(r);if(t!==r.id)return r[verifiedSymbol]=!1,!1;try{const n=schnorr$1.verify(r.sig,t,r.pubkey);return r[verifiedSymbol]=n,n}catch{return r[verifiedSymbol]=!1,!1}}};function serializeEvent(r){if(!validateEvent(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function getEventHash$1(r){let t=sha256$2(utf8Encoder$1.encode(serializeEvent(r)));return bytesToHex$1(t)}var i$1=new JS,generateSecretKey=i$1.generateSecretKey,getPublicKey=i$1.getPublicKey,finalizeEvent=i$1.finalizeEvent,verifyEvent=i$1.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(r){return 1e3<=r&&r<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(r)}function isReplaceableKind(r){return[0,3].includes(r)||1e4<=r&&r<2e4}function isEphemeralKind(r){return 2e4<=r&&r<3e4}function isAddressableKind(r){return 3e4<=r&&r<4e4}function classifyKind(r){return isRegularKind(r)?"regular":isReplaceableKind(r)?"replaceable":isEphemeralKind(r)?"ephemeral":isAddressableKind(r)?"parameterized":"unknown"}function isKind(r,t){const n=t instanceof Array?t:[t];return validateEvent(r)&&n.includes(r.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550,fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(r,t){let n=t.length+3,s=r.indexOf(`"${t}":`)+n,o=r.slice(s).indexOf('"')+s+1;return r.slice(o,o+64)}function getInt(r,t){let n=t.length,s=r.indexOf(`"${t}":`)+n+3,o=r.slice(s),a=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,a),10)}function getSubscriptionId(r){let t=r.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=r.slice(t+7+1).indexOf('"');if(n===-1)return null;let s=t+7+1+n,o=r.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return r.slice(s+1,a)}function matchEventId(r,t){return t===getHex64(r,"id")}function matchEventPubkey(r,t){return t===getHex64(r,"pubkey")}function matchEventKind(r,t){return t===getInt(r,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(r,t){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",t]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports$1={};__export(nip19_exports$1,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize$2,NostrTypeGuard:()=>NostrTypeGuard$1,decode:()=>decode$4,decodeNostrURI:()=>decodeNostrURI$1,encodeBytes:()=>encodeBytes$2,naddrEncode:()=>naddrEncode$1,neventEncode:()=>neventEncode$1,noteEncode:()=>noteEncode$1,nprofileEncode:()=>nprofileEncode$1,npubEncode:()=>npubEncode$1,nsecEncode:()=>nsecEncode$1});var NostrTypeGuard$1={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize$2=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array$1(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI$1(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode$4(r)}catch{return{type:"invalid",data:null}}}function decode$4(r){let{prefix:t,words:n}=bech32$1.decode(r,Bech32MaxSize$2),s=new Uint8Array(bech32$1.fromWords(n));switch(t){case"nprofile":{let o=parseTLV$1(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$1(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$1.decode(a)):[]}}}case"nevent":{let o=parseTLV$1(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$1(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder$1.decode(a)):[],author:o[2]?.[0]?bytesToHex$1(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex$1(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV$1(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder$1.decode(o[0][0]),pubkey:bytesToHex$1(o[2][0]),kind:parseInt(bytesToHex$1(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder$1.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex$1(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV$1(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode$1(r){return encodeBytes$2("nsec",r)}function npubEncode$1(r){return encodeBytes$2("npub",hexToBytes$1(r))}function noteEncode$1(r){return encodeBytes$2("note",hexToBytes$1(r))}function encodeBech32$2(r,t){let n=bech32$1.toWords(t);return bech32$1.encode(r,n,Bech32MaxSize$2)}function encodeBytes$2(r,t){return encodeBech32$2(r,t)}function nprofileEncode$1(r){let t=encodeTLV$1({0:[hexToBytes$1(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder$1.encode(n))});return encodeBech32$2("nprofile",t)}function neventEncode$1(r){let t;r.kind!==void 0&&(t=integerToUint8Array$1(r.kind));let n=encodeTLV$1({0:[hexToBytes$1(r.id)],1:(r.relays||[]).map(s=>utf8Encoder$1.encode(s)),2:r.author?[hexToBytes$1(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32$2("nevent",n)}function naddrEncode$1(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV$1({0:[utf8Encoder$1.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder$1.encode(s)),2:[hexToBytes$1(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech32$2("naddr",n)}function encodeTLV$1(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes$1(...t)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$2,encrypt:()=>encrypt$2});function encrypt$2(r,t,n){const s=r instanceof Uint8Array?bytesToHex$1(r):r,o=secp256k1$1.getSharedSecret(s,"02"+t),a=getNormalizedX(o);let c=Uint8Array.from(randomBytes$1(16)),f=utf8Encoder$1.encode(n),g=cbc(a,c).encrypt(f),b=base64.encode(new Uint8Array(g)),_=base64.encode(new Uint8Array(c.buffer));return`${b}?iv=${_}`}function decrypt$2(r,t,n){const s=r instanceof Uint8Array?bytesToHex$1(r):r;let[o,a]=n.split("?iv="),c=secp256k1$1.getSharedSecret(s,"02"+t),f=getNormalizedX(c),g=base64.decode(a),b=base64.decode(o),_=cbc(f,g).decrypt(b);return utf8Decoder$1.decode(_)}function getNormalizedX(r){return r.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=r=>NIP05_REGEX$1.test(r||""),_fetch;try{_fetch=fetch}catch(r){}function useFetchImplementation(r){_fetch=r}async function searchDomain(r,t=""){try{const n=`https://${r}/.well-known/nostr.json?name=${t}`,s=await _fetch(n,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");return(await s.json()).names}catch{return{}}}async function queryProfile(r){const t=r.match(NIP05_REGEX$1);if(!t)return null;const[,n="_",s]=t;try{const o=`https://${s}/.well-known/nostr.json?name=${n}`,a=await _fetch(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const c=await a.json(),f=c.names[n];return f?{pubkey:f,relays:c.relays?.[f]}:null}catch{return null}}async function isValid(r,t){const n=await queryProfile(t);return n?n.pubkey===r:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(r){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,s;for(let o=r.tags.length-1;o>=0;o--){const a=r.tags[o];if(a[0]==="e"&&a[1]){const[c,f,g,b,_]=a,L={id:f,relays:g?[g]:[],author:_};if(b==="root"){t.root=L;continue}if(b==="reply"){t.reply=L;continue}if(b==="mention"){t.mentions.push(L);continue}n?s=L:n=L,t.mentions.push(L);continue}if(a[0]==="q"&&a[1]){const[c,f,g]=a;t.quotes.push({id:f,relays:g?[g]:[]})}if(a[0]==="p"&&a[1]){t.profiles.push({pubkey:a[1],relays:a[2]?[a[2]]:[]});continue}}return t.root||(t.root=s||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let a=t.mentions.indexOf(o);if(a!==-1&&t.mentions.splice(a,1),o.author){let c=t.profiles.find(f=>f.pubkey===o.author);c&&c.relays&&(o.relays||(o.relays=[]),c.relays.forEach(f=>{o.relays?.indexOf(f)===-1&&o.relays.push(f)}),c.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let a=t.profiles.find(c=>c.pubkey===o.author);a&&a.relays&&(o.relays||(o.relays=[]),a.relays.forEach(c=>{o.relays.indexOf(c)===-1&&o.relays.push(c)}),a.relays=o.relays)}}),t}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation$1,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(r){_fetch2=r}async function fetchRelayInformation$1(r){return await(await fetch(r.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(r){let t=0;for(let n=0;n<64;n+=8){const s=parseInt(r.substring(n,n+8),16);if(s===0)t+=32;else{t+=Math.clz32(s);break}}return t}function minePow(r,t){let n=0;const s=r,o=["nonce",n.toString(),t.toString()];for(s.tags.push(o);;){const a=Math.floor(new Date().getTime()/1e3);if(a!==s.created_at&&(n=0,s.created_at=a),o[1]=(++n).toString(),s.id=fastEventHash(s),getPow(s.id)>=t)break}return s}function fastEventHash(r){return bytesToHex$1(sha256$2(utf8Encoder$1.encode(JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(r,t){const n=secp256k1$1.getSharedSecret(r,"02"+t).subarray(1,33);return extract(sha256$2,n,"nip44-v2")}function getMessageKeys(r,t){const n=expand(sha256$2,r,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function calcPaddedLen(r){if(!Number.isSafeInteger(r)||r<1)throw new Error("expected positive integer");if(r<=32)return 32;const t=1<<Math.floor(Math.log2(r-1))+1,n=t<=256?32:t/8;return n*(Math.floor((r-1)/n)+1)}function writeU16BE(r){if(!Number.isSafeInteger(r)||r<minPlaintextSize||r>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,r,!1),t}function pad(r){const t=utf8Encoder$1.encode(r),n=t.length,s=writeU16BE(n),o=new Uint8Array(calcPaddedLen(n)-n);return concatBytes$1(s,t,o)}function unpad(r){const t=new DataView(r.buffer).getUint16(0),n=r.subarray(2,2+t);if(t<minPlaintextSize||t>maxPlaintextSize||n.length!==t||r.length!==2+calcPaddedLen(t))throw new Error("invalid padding");return utf8Decoder$1.decode(n)}function hmacAad(r,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const s=concatBytes$1(n,t);return hmac$1(sha256$2,r,s)}function decodePayload(r){if(typeof r!="string")throw new Error("payload must be a valid string");const t=r.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(r[0]==="#")throw new Error("unknown encryption version");let n;try{n=base64.decode(r)}catch(a){throw new Error("invalid base64: "+a.message)}const s=n.length;if(s<99||s>65603)throw new Error("invalid data length: "+s);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function encrypt2(r,t,n=randomBytes$1(32)){const{chacha_key:s,chacha_nonce:o,hmac_key:a}=getMessageKeys(t,n),c=pad(r),f=chacha20(s,o,c),g=hmacAad(a,f,n);return base64.encode(concatBytes$1(new Uint8Array([2]),n,f,g))}function decrypt2(r,t){const{nonce:n,ciphertext:s,mac:o}=decodePayload(r),{chacha_key:a,chacha_nonce:c,hmac_key:f}=getMessageKeys(t,n),g=hmacAad(f,s,n);if(!equalBytes(g,o))throw new Error("invalid MAC");const b=chacha20(a,c,s);return unpad(b)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2880*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(r,t)=>getConversationKey(r,t),nip44Encrypt=(r,t,n)=>encrypt2(JSON.stringify(r),nip44ConversationKey(t,n)),nip44Decrypt=(r,t)=>JSON.parse(decrypt2(r.content,nip44ConversationKey(t,r.pubkey)));function createRumor(r,t){const n={created_at:now(),content:"",tags:[],...r,pubkey:getPublicKey(t)};return n.id=getEventHash$1(n),n}function createSeal(r,t,n){return finalizeEvent({kind:Seal,content:nip44Encrypt(r,t,n),created_at:randomNow(),tags:[]},t)}function createWrap(r,t){const n=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(r,n,t),created_at:randomNow(),tags:[["p",t]]},n)}function wrapEvent$1(r,t,n){const s=createRumor(r,t),o=createSeal(s,t,n);return createWrap(o,n)}function wrapManyEvents(r,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const s=getPublicKey(t),o=[wrapEvent$1(r,t,s)];return n.forEach(a=>{o.push(wrapEvent$1(r,t,a))}),o}function unwrapEvent(r,t){const n=nip44Decrypt(r,t);return nip44Decrypt(n,t)}function unwrapManyEvents(r,t){let n=[];return r.forEach(s=>{n.push(unwrapEvent(s,t))}),n.sort((s,o)=>s.created_at-o.created_at),n}function createEvent(r,t,n,s){const o={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:t};return(Array.isArray(r)?r:[r]).forEach(({publicKey:c,relayUrl:f})=>{o.tags.push(f?["p",c,f]:["p",c])}),s&&o.tags.push(["e",s.eventId,s.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function wrapEvent2(r,t,n,s,o){const a=createEvent(t,n,s,o);return wrapEvent$1(a,r,t.publicKey)}function wrapManyEvents2(r,t,n,s,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(r)},...t].map(c=>wrapEvent2(r,c,n,s,o))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(r,t,n,s){let o;const a=[...r.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===ShortTextNote?o=Repost:(o=GenericRepost,a.push(["k",String(t.kind)])),finalizeEvent({kind:o,tags:a,content:r.content===""||t.tags?.find(c=>c[0]==="-")?"":JSON.stringify(t),created_at:r.created_at},s)}function getRepostedEventPointer(r){if(![Repost,GenericRepost].includes(r.kind))return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(s=>typeof s=="string"),author:n?.[1]}}function getRepostedEvent(r,{skipVerification:t}={}){const n=getRepostedEventPointer(r);if(n===void 0||r.content==="")return;let s;try{s=JSON.parse(r.content)}catch{return}if(s.id===n.id&&!(!t&&!verifyEvent(s)))return s}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(r){return typeof r=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(r)}function parse2(r){const t=r.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${r}`);return{uri:t[0],value:t[1],decoded:decode$4(t[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(r,t,n){const s=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return finalizeEvent({...r,kind:Reaction,tags:[...r.tags??[],...s,["e",t.id],["p",t.pubkey]],content:r.content??"+"},n)}function getReactedEventPointer(r){if(r.kind!==Reaction)return;let t,n;for(let s=r.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const o=r.tags[s];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(s=>s!==void 0),author:n[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m;function*parse3(r){const t=r.length;let n=0,s=0;for(;s<t;){let o=r.indexOf(":",s);if(o===-1)break;if(r.substring(o-5,o)==="nostr"){const a=r.substring(o+60).match(noCharacter),c=a?o+60+a.index:t;try{let f,{data:g,type:b}=decode$4(r.substring(o+1,c));switch(b){case"npub":f={pubkey:g};break;case"nsec":case"note":s=c+1;continue;default:f=g}n!==o-5&&(yield{type:"text",text:r.substring(n,o-5)}),yield{type:"reference",pointer:f},s=c,n=s;continue}catch{s=o+1;continue}}else if(r.substring(o-5,o)==="https"||r.substring(o-4,o)==="http"){const a=r.substring(o+4).match(noURLCharacter),c=a?o+4+a.index:t,f=r[o-1]==="s"?5:4;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),/\.(png|jpe?g|gif|webp)$/i.test(g.pathname)){yield{type:"image",url:g.toString()},s=c,n=s;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(g.pathname)){yield{type:"video",url:g.toString()},s=c,n=s;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(g.pathname)){yield{type:"audio",url:g.toString()},s=c,n=s;continue}yield{type:"url",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else if(r.substring(o-3,o)==="wss"||r.substring(o-2,o)==="ws"){const a=r.substring(o+4).match(noURLCharacter),c=a?o+4+a.index:t,f=r[o-1]==="s"?3:2;try{let g=new URL(r.substring(o-f,c));if(g.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-f&&(yield{type:"text",text:r.substring(n,o-f)}),yield{type:"relay",url:g.toString()},s=c,n=s;continue}catch{s=c+1;continue}}else{s=o+1;continue}}n!==t&&(yield{type:"text",text:r.substring(n)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...r.tags??[]],content:n,created_at:r.created_at},t)},channelMetadataEvent=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",r.channel_create_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMessageEvent=(r,t)=>{const n=[["e",r.channel_create_event_id,r.relay_url,"root"]];return r.reply_to_channel_message_event_id&&n.push(["e",r.reply_to_channel_message_event_id,r.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...n,...r.tags??[]],content:r.content,created_at:r.created_at},t)},channelHideMessageEvent=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",r.channel_message_event_id],...r.tags??[]],content:n,created_at:r.created_at},t)},channelMuteUserEvent=(r,t)=>{let n;if(typeof r.content=="object")n=JSON.stringify(r.content);else if(typeof r.content=="string")n=r.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",r.pubkey_to_mute],...r.tags??[]],content:n,created_at:r.created_at},t)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll,regex:()=>regex$2,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex$2=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll(r){const t=r.matchAll(regex$2());for(const n of t)try{const[s,o]=n;yield{shortcode:s,name:o,start:n.index,end:n.index+s.length}}catch{}}function replaceAll(r,t){return r.replaceAll(regex$2(),(n,s)=>t({shortcode:n,name:s}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(r){_fetch3=r}async function validateGithub(r,t,n){try{return await(await _fetch3(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${r}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(r){const{host:t,pathname:n,searchParams:s}=new URL(r),o=n||t,a=s.get("relay"),c=s.get("secret");if(!o||!a||!c)throw new Error("invalid connection string");return{pubkey:o,relay:a,secret:c}}async function makeNwcRequestEvent(r,t,n){const o=encrypt$2(t,r,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),a={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",r]]};return finalizeEvent(a,t)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(r){return r=r.trim().toLowerCase(),r=r.normalize("NFKC"),Array.from(r).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nip57_exports={};__export(nip57_exports,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11,getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(r){_fetch4=r}async function getZapEndpoint(r){try{let t="",{lud06:n,lud16:s}=JSON.parse(r.content);if(n){let{words:c}=bech32$1.decode(n,1e3),f=bech32$1.fromWords(c);t=utf8Decoder$1.decode(f)}else if(s){let[c,f]=s.split("@");t=new URL(`/.well-known/lnurlp/${c}`,`https://${f}`).toString()}else return null;let a=await(await _fetch4(t)).json();if(a.allowsNostr&&a.nostrPubkey)return a.callback}catch{}return null}function makeZapRequest(r){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:r.comment||"",tags:[["p","pubkey"in r?r.pubkey:r.event.pubkey],["amount",r.amount.toString()],["relays",...r.relays]]};if("event"in r){if(t.tags.push(["e",r.event.id]),isReplaceableKind(r.event.kind)){const n=["a",`${r.event.kind}:${r.event.pubkey}:`];t.tags.push(n)}else if(isAddressableKind(r.event.kind)){let n=r.event.tags.find(([o,a])=>o==="d"&&a);if(!n)throw new Error("d tag not found or is empty");const s=["a",`${r.event.kind}:${r.event.pubkey}:${n[1]}`];t.tags.push(s)}t.tags.push(["k",r.event.kind.toString()])}return t}function validateZapRequest(r){let t;try{t=JSON.parse(r)}catch{return"Invalid zap request JSON."}if(!validateEvent(t))return"Zap request is not a valid Nostr event.";if(!verifyEvent(t))return"Invalid signature on zap request.";let n=t.tags.find(([a,c])=>a==="p"&&c);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let s=t.tags.find(([a,c])=>a==="e"&&c);return s&&!s[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([a,c])=>a==="relays"&&c)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:r,preimage:t,bolt11:n,paidAt:s}){let o=JSON.parse(r),a=o.tags.filter(([f])=>f==="e"||f==="p"||f==="a"),c={kind:9735,created_at:Math.round(s.getTime()/1e3),content:"",tags:[...a,["P",o.pubkey],["bolt11",n],["description",r]]};return t&&c.tags.push(["preimage",t]),c}function getSatoshisAmountFromBolt11(r){if(r.length<50)return 0;r=r.substring(0,50);const t=r.lastIndexOf("1");if(t===-1)return 0;const n=r.substring(0,t);if(!n.startsWith("lnbc"))return 0;const s=n.substring(4);if(s.length<1)return 0;const o=s[s.length-1],a=o.charCodeAt(0)-48,c=a>=0&&a<=9;let f=s.length-1;if(c&&f++,f<1)return 0;const g=parseInt(s.substring(0,f));switch(o){case"m":return g*1e5;case"u":return g*100;case"n":return g/10;case"p":return g/1e4;default:return g*1e8}}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(r,t,n,s=!1,o){const a={kind:HTTPAuth,tags:[["u",r],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&a.tags.push(["payload",hashPayload(o)]);const c=await n(a);return(s?_authorizationScheme:"")+base64.encode(utf8Encoder$1.encode(JSON.stringify(c)))}async function validateToken(r,t,n){const s=await unpackEventFromToken(r).catch(a=>{throw a});return await validateEvent2(s,t,n).catch(a=>{throw a})}async function unpackEventFromToken(r){if(!r)throw new Error("Missing token");r=r.replace(_authorizationScheme,"");const t=utf8Decoder$1.decode(base64.decode(r));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function validateEventTimestamp(r){return r.created_at?Math.round(new Date().getTime()/1e3)-r.created_at<60:!1}function validateEventKind(r){return r.kind===HTTPAuth}function validateEventUrlTag(r,t){const n=r.tags.find(s=>s[0]==="u");return n?n.length>0&&n[1]===t:!1}function validateEventMethodTag(r,t){const n=r.tags.find(s=>s[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function hashPayload(r){const t=sha256$2(utf8Encoder$1.encode(JSON.stringify(r)));return bytesToHex$1(t)}function validateEventPayloadTag(r,t){const n=r.tags.find(o=>o[0]==="payload");if(!n)return!1;const s=hashPayload(t);return n.length>0&&n[1]===s}async function validateEvent2(r,t,n,s){if(!verifyEvent(r))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(r))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(r))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(r,t))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(r,n))throw new Error("Invalid nostr event, method tag invalid");if(s&&typeof s=="object"&&Object.keys(s).length>0&&!validateEventPayloadTag(r,s))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var root_1$5=from_html('<span class="separator svelte-odwmri"></span> <span class="reading-time"> </span>',1),root_2$4=from_html('<div class="article-image svelte-odwmri"><img class="svelte-odwmri"/></div>'),root$4=from_html('<article class="article-preview svelte-odwmri"><div class="article-content svelte-odwmri"><div class="article-meta svelte-odwmri"><div class="author-info svelte-odwmri"><!> <div class="author-details svelte-odwmri"><span class="author-name svelte-odwmri"> </span> <div class="article-stats svelte-odwmri"><span class="publish-date"> </span> <!></div></div></div></div> <div class="article-body svelte-odwmri"><h2 class="article-title svelte-odwmri"> </h2> <p class="article-summary svelte-odwmri"> </p></div></div> <!></article>');function ArticlePreview(r,t){push(t,!0);const n=user_derived(()=>t.event.tagValue("title")||"Untitled Article"),s=user_derived(()=>t.event.tagValue("summary")||t.event.content.slice(0,200)),o=user_derived(()=>t.event.tagValue("image")),a=user_derived(()=>t.event.tagValue("published_at")||t.event.created_at?.toString()),c=user_derived(()=>()=>{const m=t.event.content.split(/\s+/).length;return`${Math.ceil(m/200)} min read`}),f=user_derived(()=>()=>{const m=parseInt(get(a)||"0");return m?new Date(m*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""}),g=user_derived(()=>t.author?.name||`${t.event.pubkey.slice(0,8)}...`);var b=root$4();b.__click=function(...m){t.onClick?.apply(this,m)};var _=child(b),L=child(_),q=child(L),X=child(q);Avatar(X,{get ndk(){return t.ndk},get pubkey(){return t.event.pubkey},size:40});var te=sibling(X,2),ne=child(te),Ce=child(ne,!0);reset$1(ne);var Le=sibling(ne,2),Ge=child(Le),ze=child(Ge,!0);reset$1(Ge);var Xe=sibling(Ge,2);{var He=m=>{var A=root_1$5(),k=sibling(first_child(A),2),Y=child(k,!0);reset$1(k),template_effect(Q=>set_text(Y,Q),[()=>get(c)()]),append(m,A)};if_block(Xe,m=>{get(c)&&m(He)})}reset$1(Le),reset$1(te),reset$1(q),reset$1(L);var Ve=sibling(L,2),We=child(Ve),rt=child(We,!0);reset$1(We);var st=sibling(We,2),ht=child(st,!0);reset$1(st),reset$1(Ve),reset$1(_);var je=sibling(_,2);{var se=m=>{var A=root_2$4(),k=child(A);reset$1(A),template_effect(()=>{set_attribute(k,"src",get(o)),set_attribute(k,"alt",get(n))}),append(m,A)};if_block(je,m=>{get(o)&&m(se)})}reset$1(b),template_effect(()=>{set_attribute(b,"role",t.onClick?"button":void 0),set_attribute(b,"tabindex",t.onClick?0:void 0),set_text(Ce,get(g)),set_text(ze,get(f)),set_text(rt,get(n)),set_text(ht,get(s))}),append(r,b),pop()}delegate(["click"]);var root_2$3=from_html('<button class="interaction-btn svelte-rz1qd8"><span class="interaction-icon svelte-rz1qd8"></span> <span class="interaction-count svelte-rz1qd8"></span></button>'),root_3$1=from_html('<button class="interaction-btn svelte-rz1qd8"><span class="interaction-icon svelte-rz1qd8"></span> <span class="interaction-count svelte-rz1qd8"></span></button>'),root_4$1=from_html('<button class="interaction-btn svelte-rz1qd8"><span class="interaction-icon svelte-rz1qd8"></span> <span class="interaction-count svelte-rz1qd8"></span></button>'),root_5=from_html('<button class="interaction-btn svelte-rz1qd8"><span class="interaction-icon svelte-rz1qd8"></span> <span class="interaction-count svelte-rz1qd8"></span></button>'),root_1$4=from_html('<div class="note-interactions svelte-rz1qd8"><!> <!> <!> <!></div>'),root$3=from_html('<article class="note-preview svelte-rz1qd8"><div class="note-avatar svelte-rz1qd8"><!></div> <div class="note-content svelte-rz1qd8"><div class="note-header svelte-rz1qd8"><div class="author-info svelte-rz1qd8"><span class="author-name svelte-rz1qd8"> </span> <span class="author-handle svelte-rz1qd8"> </span></div> <span class="timestamp svelte-rz1qd8"> </span></div> <div class="note-body svelte-rz1qd8"><!></div> <!></div></article>');function NotePreview(r,t){push(t,!0);let n=prop(t,"maxContentLength",3,280);const s=user_derived(()=>t.author?.name||`${t.event.pubkey.slice(0,8)}...`),o=user_derived(()=>`@${t.event.pubkey.slice(0,8)}`);function a(m){const k=Date.now()/1e3-m;return k<60?"now":k<3600?`${Math.floor(k/60)}m`:k<86400?`${Math.floor(k/3600)}h`:k<604800?`${Math.floor(k/86400)}d`:new Date(m*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})}const c=user_derived(()=>a(t.event.created_at||0)),f=user_derived(()=>()=>!n()||t.event.content.length<=n()?t.event.content:t.event.content.slice(0,n())+"..."),g=user_derived(()=>0),b=user_derived(()=>0),_=user_derived(()=>0),L=user_derived(()=>0),q=user_derived(()=>get(g)>0||get(b)>0||get(_)>0||get(L)>0);var X=root$3();X.__click=function(...m){t.onClick?.apply(this,m)};var te=child(X),ne=child(te);Avatar(ne,{get ndk(){return t.ndk},get pubkey(){return t.event.pubkey},size:48}),reset$1(te);var Ce=sibling(te,2),Le=child(Ce),Ge=child(Le),ze=child(Ge),Xe=child(ze,!0);reset$1(ze);var He=sibling(ze,2),Ve=child(He,!0);reset$1(He),reset$1(Ge);var We=sibling(Ge,2),rt=child(We,!0);reset$1(We),reset$1(Le);var st=sibling(Le,2),ht=child(st);{let m=user_derived(()=>get(f)()),A=user_derived(()=>t.event.tags.filter(k=>k[0]==="emoji"));EventContent(ht,{get ndk(){return t.ndk},get content(){return get(m)},get emojiTags(){return get(A)}})}reset$1(st);var je=sibling(st,2);{var se=m=>{var A=root_1$4(),k=child(A);{var Y=Ue=>{var Ze=root_2$3(),lt=sibling(child(Ze),2);lt.textContent=get(g),reset$1(Ze),append(Ue,Ze)};if_block(k,Ue=>{get(g)>0&&Ue(Y)})}var Q=sibling(k,2);{var $e=Ue=>{var Ze=root_3$1(),lt=sibling(child(Ze),2);lt.textContent=get(b),reset$1(Ze),append(Ue,Ze)};if_block(Q,Ue=>{get(b)>0&&Ue($e)})}var ve=sibling(Q,2);{var re=Ue=>{var Ze=root_4$1(),lt=sibling(child(Ze),2);lt.textContent=get(_),reset$1(Ze),append(Ue,Ze)};if_block(ve,Ue=>{get(_)>0&&Ue(re)})}var B=sibling(ve,2);{var oe=Ue=>{var Ze=root_5(),lt=sibling(child(Ze),2);lt.textContent=get(L),reset$1(Ze),append(Ue,Ze)};if_block(B,Ue=>{get(L)>0&&Ue(oe)})}reset$1(A),append(m,A)};if_block(je,m=>{get(q)&&m(se)})}reset$1(Ce),reset$1(X),template_effect(()=>{set_attribute(X,"role",t.onClick?"button":void 0),set_attribute(X,"tabindex",t.onClick?0:void 0),set_text(Xe,get(s)),set_text(Ve,get(o)),set_text(rt,get(c))}),append(r,X),pop()}delegate(["click"]);var root_1$3=from_html('<div class="preview-content svelte-3cjf7l"><pre class="content-text svelte-3cjf7l"> </pre></div>'),root$2=from_html('<article class="generic-preview svelte-3cjf7l"><div class="preview-header svelte-3cjf7l"><div class="author-section svelte-3cjf7l"><!> <div class="author-info svelte-3cjf7l"><span class="author-name svelte-3cjf7l"> </span> <span class="event-kind svelte-3cjf7l"> </span></div></div> <span class="timestamp svelte-3cjf7l"> </span></div> <!></article>');function GenericPreview(r,t){push(t,!0);const n=user_derived(()=>t.author?.name||`${t.event.pubkey.slice(0,8)}...`),s=user_derived(()=>t.kindLabel||`Event (kind ${t.event.kind})`);function o(Xe){const He=new Date(Xe*1e3),We=new Date().getTime()-He.getTime(),rt=Math.floor(We/(1e3*60*60*24));if(rt>7)return He.toLocaleDateString();if(rt>0)return`${rt}d ago`;{const st=Math.floor(We/36e5);if(st>0)return`${st}h ago`;const ht=Math.floor(We/(1e3*60));return ht>0?`${ht}m ago`:"just now"}}const a=user_derived(()=>o(t.event.created_at||0)),c=user_derived(()=>()=>{if(t.event.content)return t.event.content.slice(0,150)+(t.event.content.length>150?"...":"");const Xe=t.event.tags.filter(He=>["title","name","description","summary"].includes(He[0])).map(He=>`${He[0]}: ${He[1]}`).slice(0,2);return Xe.length>0?Xe.join(`
`):t.event.tags.length>0?`${t.event.tags.length} tags`:"No content"});var f=root$2();f.__click=function(...Xe){t.onClick?.apply(this,Xe)};var g=child(f),b=child(g),_=child(b);Avatar(_,{get ndk(){return t.ndk},get pubkey(){return t.event.pubkey},size:32});var L=sibling(_,2),q=child(L),X=child(q,!0);reset$1(q);var te=sibling(q,2),ne=child(te,!0);reset$1(te),reset$1(L),reset$1(b);var Ce=sibling(b,2),Le=child(Ce,!0);reset$1(Ce),reset$1(g);var Ge=sibling(g,2);{var ze=Xe=>{var He=root_1$3(),Ve=child(He),We=child(Ve,!0);reset$1(Ve),reset$1(He),template_effect(rt=>set_text(We,rt),[()=>get(c)()]),append(Xe,He)};if_block(Ge,Xe=>{get(c)()&&Xe(ze)})}reset$1(f),template_effect(()=>{set_attribute(f,"role",t.onClick?"button":void 0),set_attribute(f,"tabindex",t.onClick?0:void 0),set_text(X,get(n)),set_text(ne,get(s)),set_text(Le,get(a))}),append(r,f),pop()}delegate(["click"]);var root_1$2=from_html('<div class="loading svelte-1qdxrbe"><span class="loading-spinner svelte-1qdxrbe"></span> <span>Loading event...</span></div>'),root_3=from_html('<div class="error svelte-1qdxrbe"><span class="error-icon svelte-1qdxrbe"></span> <span> </span></div>'),root_6=from_html('<div class="error svelte-1qdxrbe"><span class="error-icon svelte-1qdxrbe"></span> <span>No event to display</span></div>'),root$1=from_html("<div><!></div>");function EmbeddedEvent(r,t){push(t,!0);let n=prop(t,"class",3,""),s=state(null),o=state(null),a=state(!0),c=state(null);async function f(Ge){const ze=t.ndk.getUser({pubkey:Ge.pubkey});ze.profile||await ze.fetchProfile(),set(o,ze.profile||null,!0)}async function g(Ge,ze){Ge?(set(s,Ge,!0),await f(Ge)):set(c,ze,!0),set(a,!1)}user_effect(()=>{if(!(!t.bech32||!t.ndk)){set(a,!0),set(c,null);try{const Ge=nip19_exports$1.decode(t.bech32);if(Ge.type==="note"){const ze=Ge.data;t.ndk.fetchEvent(ze).then(Xe=>g(Xe,"Event not found")).catch(Xe=>{console.error("Failed to fetch event:",Xe),set(c,"Failed to load event"),set(a,!1)})}else if(Ge.type==="nevent"){const ze=Ge.data;t.ndk.fetchEvent(ze.id).then(Xe=>g(Xe,"Event not found")).catch(Xe=>{console.error("Failed to fetch event:",Xe),set(c,"Failed to load event"),set(a,!1)})}else if(Ge.type==="naddr"){const ze=Ge.data,Xe={kinds:[ze.kind],authors:[ze.pubkey],"#d":[ze.identifier]};t.ndk.fetchEvent(Xe,{closeOnEose:!0}).then(He=>g(He,"Event not found")).catch(He=>{console.error("Failed to fetch event by address:",He),set(c,"Failed to load event"),set(a,!1)})}else set(c,"Invalid event reference"),set(a,!1)}catch(Ge){console.error("Failed to decode bech32:",Ge),set(c,"Invalid bech32 format"),set(a,!1)}}});function b(){t.onEventClick&&get(s)&&t.onEventClick(t.bech32,get(s))}function _(Ge){const ze=Ge.kind;return{[NDKKind$1.Text]:NotePreview,[NDKKind$1.GenericReply]:NotePreview,[NDKKind$1.Article]:ArticlePreview,[NDKKind$1.Image]:GenericPreview,[NDKKind$1.Video]:GenericPreview,[NDKKind$1.ShortVideo]:GenericPreview,[NDKKind$1.HorizontalVideo]:GenericPreview,[NDKKind$1.VerticalVideo]:GenericPreview,[NDKKind$1.Repost]:GenericPreview,[NDKKind$1.GenericRepost]:GenericPreview,[NDKKind$1.Reaction]:GenericPreview,[NDKKind$1.Zap]:GenericPreview,[NDKKind$1.MuteList]:GenericPreview,[NDKKind$1.PinList]:GenericPreview,[NDKKind$1.BookmarkList]:GenericPreview,[NDKKind$1.FollowSet]:GenericPreview,[NDKKind$1.RelaySet]:GenericPreview,[NDKKind$1.MarketStall]:GenericPreview,[NDKKind$1.MarketProduct]:GenericPreview,[NDKKind$1.Classified]:GenericPreview}[ze]||GenericPreview}function L(Ge){return{[NDKKind$1.Metadata]:"Profile",[NDKKind$1.Text]:"Note",[NDKKind$1.Contacts]:"Contact List",[NDKKind$1.EncryptedDirectMessage]:"Encrypted Message",[NDKKind$1.EventDeletion]:"Event Deletion",[NDKKind$1.Repost]:"Repost",[NDKKind$1.Reaction]:"Reaction",[NDKKind$1.BadgeAward]:"Badge Award",[NDKKind$1.GenericRepost]:"Generic Repost",[NDKKind$1.ChannelCreation]:"Channel Creation",[NDKKind$1.ChannelMetadata]:"Channel Metadata",[NDKKind$1.ChannelMessage]:"Channel Message",[NDKKind$1.Image]:"Image",[NDKKind$1.Video]:"Video",[NDKKind$1.ShortVideo]:"Short Video",[NDKKind$1.Story]:"Story",[NDKKind$1.Article]:"Article",[NDKKind$1.HorizontalVideo]:"Horizontal Video",[NDKKind$1.VerticalVideo]:"Vertical Video",[NDKKind$1.Media]:"Media",[NDKKind$1.GenericReply]:"Reply",[NDKKind$1.Highlight]:"Highlight",[NDKKind$1.ZapRequest]:"Zap Request",[NDKKind$1.Zap]:"Zap",[NDKKind$1.MuteList]:"Mute List",[NDKKind$1.PinList]:"Pin List",[NDKKind$1.RelayList]:"Relay List",[NDKKind$1.BookmarkList]:"Bookmark List",[NDKKind$1.CommunityList]:"Community List",[NDKKind$1.PublicChatList]:"Public Chat List",[NDKKind$1.FollowSet]:"Follow Set",[NDKKind$1.RelaySet]:"Relay Set",[NDKKind$1.BookmarkSet]:"Bookmark Set",[NDKKind$1.ArticleCurationSet]:"Article Curation",[NDKKind$1.VideoCurationSet]:"Video Curation",[NDKKind$1.ProfileBadge]:"Profile Badge",[NDKKind$1.BadgeDefinition]:"Badge Definition",[NDKKind$1.MarketStall]:"Market Stall",[NDKKind$1.MarketProduct]:"Product",[NDKKind$1.Classified]:"Classified",[NDKKind$1.Wiki]:"Wiki",[NDKKind$1.AppRecommendation]:"App Recommendation",[NDKKind$1.AppHandler]:"App Handler"}[Ge]}const q=user_derived(()=>get(s)?_(get(s)):null),X=user_derived(()=>get(s)?L(get(s).kind):void 0);var te=root$1(),ne=child(te);{var Ce=Ge=>{var ze=root_1$2();append(Ge,ze)},Le=Ge=>{var ze=comment$1(),Xe=first_child(ze);{var He=We=>{var rt=root_3(),st=sibling(child(rt),2),ht=child(st,!0);reset$1(st),reset$1(rt),template_effect(()=>set_text(ht,get(c))),append(We,rt)},Ve=We=>{var rt=comment$1(),st=first_child(rt);{var ht=se=>{var m=comment$1(),A=first_child(m);component(A,()=>get(q),(k,Y)=>{Y(k,{get ndk(){return t.ndk},get event(){return get(s)},get author(){return get(o)},onClick:b,get kindLabel(){return get(X)}})}),append(se,m)},je=se=>{var m=root_6();append(se,m)};if_block(st,se=>{get(s)&&get(q)?se(ht):se(je,!1)},!0)}append(We,rt)};if_block(Xe,We=>{get(c)?We(He):We(Ve,!1)},!0)}append(Ge,ze)};if_block(ne,Ge=>{get(a)?Ge(Ce):Ge(Le,!1)})}reset$1(te),template_effect(()=>set_class(te,1,`embedded-event-wrapper ${n()??""}`,"svelte-1qdxrbe")),append(r,te),pop()}function handleClick$2(r,t){t.onClick&&(r.preventDefault(),r.stopPropagation(),t.onClick(t.hashtag))}var root_1$1=from_html('<button type="button"><span class="hashtag-prefix svelte-173uvig">#</span> <span class="hashtag-text svelte-173uvig"> </span></button>'),root_2$2=from_html("<a> </a>");function HashtagPreview(r,t){push(t,!0);let n=prop(t,"class",3,""),s=prop(t,"format",3,"inline");var o=comment$1(),a=first_child(o);{var c=g=>{var b=root_1$1();b.__click=[handleClick$2,t];var _=sibling(child(b),2),L=child(_,!0);reset$1(_),reset$1(b),template_effect(()=>{set_class(b,1,`hashtag-pill ${n()??""}`,"svelte-173uvig"),set_text(L,t.hashtag)}),append(g,b)},f=g=>{var b=root_2$2();b.__click=[handleClick$2,t];var _=child(b);reset$1(b),template_effect(()=>{set_attribute(b,"href",`#/hashtag/${t.hashtag}`),set_class(b,1,`hashtag-inline ${n()??""}`,"svelte-173uvig"),set_text(_,`#${t.hashtag??""}`)}),append(g,b)};if_block(a,g=>{s()==="pill"?g(c):g(f,!1)})}append(r,o),pop()}delegate(["click"]);function handleClick$1(r,t){t.onClick&&(r.preventDefault(),r.stopPropagation(),t.onClick(t.bech32))}var root_1=from_html("<span> </span>"),root_2$1=from_html('<a><!> <span class="mention-name svelte-1e34lpq"> </span></a>');function MentionPreview(r,t){push(t,!0);let n=prop(t,"class",3,"");const s=t.ndk.$fetchUser(()=>t.bech32),o=t.ndk.$fetchProfile(()=>s?.pubkey),a=user_derived(()=>o?.displayName?o.displayName.slice(0,48):o?.name?o.name.slice(0,48):`${t.bech32.slice(0,12)}...`);var c=comment$1(),f=first_child(c);{var g=_=>{var L=root_1(),q=child(L,!0);reset$1(L),template_effect(X=>{set_class(L,1,`mention-inline ${n()??""}`,"svelte-1e34lpq"),set_text(q,X)},[()=>t.bech32.slice(0,12)]),append(_,L)},b=_=>{var L=root_2$1();L.__click=[handleClick$1,t];var q=child(L);{let ne=user_derived(()=>s?.pubkey);Avatar(q,{get ndk(){return t.ndk},get pubkey(){return get(ne)},size:16,class:"mention-avatar"})}var X=sibling(q,2),te=child(X,!0);reset$1(X),reset$1(L),template_effect(()=>{set_attribute(L,"href",`/p/${t.bech32}`),set_class(L,1,`mention-inline ${n()??""}`,"svelte-1e34lpq"),set_text(te,get(a))}),append(_,L)};if_block(f,_=>{s?.pubkey?_(b,!1):_(g)})}append(r,c),pop()}delegate(["click"]);const defaultComponents={mention:MentionPreview,embeddedEvent:EmbeddedEvent,hashtag:HashtagPreview};let globalComponents={...defaultComponents};function setEventContentComponents(r){globalComponents={...globalComponents,...r}}function mergeComponentRegistries(...r){return Object.assign({},defaultComponents,globalComponents,...r)}const globalHandlers={};function mergeHandlerRegistries(...r){const t=r.map(n=>{const s={};for(const[o,a]of Object.entries(n))a!==void 0&&(s[o]=a);return s});return Object.assign({},globalHandlers,...t)}const EventContentHandlersProxy=new Proxy({},{get(r,t){return globalHandlers[t]},set(r,t,n){return globalHandlers[t]=n,!0}}),PATTERNS={EMOJI_SHORTCODE:/:([a-zA-Z0-9_]+):/g,NOSTR_URI:/nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,HASHTAG:/(^|\s)#([a-zA-Z0-9_\u0080-\uFFFF]+)(?=\s|$|[^\w])/g,MEDIA_FILE:/https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov)(\?[^\s<>"]*)?/gi,YOUTUBE:/https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,URL:/https?:\/\/[^\s<>"]+/gi};function buildEmojiMap(r){const t=new Map;for(const[n,s,o]of r)n==="emoji"&&s&&o&&t.set(s,o);return t}function createEmojiSegment(r,t){const n=t.get(r);return n?{type:"emoji",content:r,data:n}:{type:"text",content:`:${r}:`}}function decodeNostrUri(r){try{const t=r.substring(0,r.indexOf("1")+1);if(nip19_exports$1.decode(r),t==="npub1")return{type:"npub",content:r,data:r};if(t==="nprofile1")return{type:"nprofile",content:r,data:r};if(t==="note1"||t==="nevent1"||t==="naddr1")return{type:"event-ref",content:r,data:r}}catch{console.warn("[EventContent] Failed to decode Nostr URI:",r)}return{type:"text",content:`nostr:${r}`}}function isImage(r){return/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(r)}function isVideo(r){return/\.(mp4|webm|mov)(\?|$)/i.test(r)}function isYouTube(r){return/youtube\.com|youtu\.be/i.test(r)}function extractYouTubeId(r){return r.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/)?.[1]||null}function classifyMatch(r,t){const n=r.match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(n){const[,s,o]=n;return s?{type:"hashtag",content:o,data:o}:{type:"hashtag",content:o,data:o}}if(r.startsWith(":")&&r.endsWith(":")){const s=r.slice(1,-1);return createEmojiSegment(s,t)}return r.startsWith("nostr:")?decodeNostrUri(r.slice(6)):isImage(r)||isVideo(r)||isYouTube(r)?{type:"media",content:r}:r.startsWith("http")?{type:"link",content:r}:{type:"text",content:r}}function collectMatches(r){const t=[];for(const n of Object.values(PATTERNS)){n.lastIndex=0;let s=n.exec(r);for(;s!==null;)t.push({match:s,index:s.index}),s=n.exec(r)}return t.sort((n,s)=>n.index-s.index)}function parseContentToSegments(r,t){const n=[],s=collectMatches(r);let o=0;for(const{match:a,index:c}of s)if(!(c<o)){if(c>o&&n.push({type:"text",content:r.slice(o,c)}),a[0].match(/^\s?#[a-zA-Z0-9_\u0080-\uFFFF]+$/)){const f=a[0].match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(f){const[,g,b]=f;g&&n.push({type:"text",content:g}),n.push({type:"hashtag",content:b,data:b})}}else n.push(classifyMatch(a[0],t));o=c+a[0].length}return o<r.length&&n.push({type:"text",content:r.slice(o)}),n}function groupConsecutiveImages(r){const t=[];let n=[];function s(){n.length!==0&&(n.length===1?t.push({type:"media",content:n[0]}):t.push({type:"image-grid",content:"",data:n}),n=[])}for(const o of r)o.type==="media"&&isImage(o.content)?n.push(o.content):(s(),t.push(o));return s(),t}var root_2=from_html('<span class="whitespace-pre-wrap break-words svelte-wqb641"> </span>'),root_4=from_html('<img class="custom-emoji svelte-wqb641" loading="lazy"/>'),on_click=(r,t,n)=>t(r,get(n).content),root_12=from_html('<a target="_blank" rel="noopener noreferrer" class="link svelte-wqb641"> </a>'),root_15=from_html('<img alt="" loading="lazy" class="grid-image svelte-wqb641"/>'),root_14=from_html("<div></div>"),root_19=from_html('<iframe title="YouTube video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" class="youtube-embed svelte-wqb641"></iframe>'),root_21=from_html('<video controls class="video-embed svelte-wqb641"><track kind="captions"/></video>',2),root_22=from_html('<img alt="" loading="lazy" class="image-embed svelte-wqb641"/>'),root_17=from_html('<div class="media-embed svelte-wqb641"><!></div>'),root=from_html("<div></div>");function EventContent(r,t){push(t,!0);let n=prop(t,"content",3,""),s=prop(t,"class",3,""),o=prop(t,"emojiTags",19,()=>[]),a=prop(t,"components",19,()=>({})),c=prop(t,"handlers",19,()=>({}));const f=user_derived(()=>t.event?.content??n()),g=user_derived(()=>t.event?t.event.tags.filter(Le=>Le[0]==="emoji"):o()),b=user_derived(()=>mergeComponentRegistries(a())),_=user_derived(()=>mergeHandlerRegistries(c()));function L(Le,Ge){get(_).onLinkClick&&(Le.preventDefault(),Le.stopPropagation(),get(_).onLinkClick(Ge))}const q=user_derived(()=>get(f).replace(/\[Image #\d+\]/gi,"").trim()),X=user_derived(()=>buildEmojiMap(get(g))),te=user_derived(()=>parseContentToSegments(get(q),get(X))),ne=user_derived(()=>groupConsecutiveImages(get(te)));var Ce=root();each(Ce,21,()=>get(ne),index$1,(Le,Ge)=>{var ze=comment$1(),Xe=first_child(ze);{var He=We=>{var rt=root_2(),st=child(rt,!0);reset$1(rt),template_effect(ht=>set_text(st,ht),[()=>get(Ge).content.trim()]),append(We,rt)},Ve=We=>{var rt=comment$1(),st=first_child(rt);{var ht=se=>{var m=root_4();template_effect(()=>{set_attribute(m,"src",get(Ge).data),set_attribute(m,"alt",`:${get(Ge).content}:`),set_attribute(m,"title",`:${get(Ge).content}:`)}),append(se,m)},je=se=>{var m=comment$1(),A=first_child(m);{var k=Q=>{const $e=user_derived(()=>get(b).hashtag);var ve=comment$1(),re=first_child(ve);component(re,()=>get($e),(B,oe)=>{oe(B,{get hashtag(){return get(Ge).content},get onClick(){return get(_).onHashtagClick}})}),append(Q,ve)},Y=Q=>{var $e=comment$1(),ve=first_child($e);{var re=oe=>{const Ue=user_derived(()=>get(Ge).data),Ze=user_derived(()=>get(b).mention);var lt=comment$1(),St=first_child(lt);component(St,()=>get(Ze),(Mt,Ft)=>{Ft(Mt,{get ndk(){return t.ndk},get bech32(){return get(Ue)},get onClick(){return get(_).onMentionClick}})}),append(oe,lt)},B=oe=>{var Ue=comment$1(),Ze=first_child(Ue);{var lt=Mt=>{const Ft=user_derived(()=>get(Ge).data),Zt=user_derived(()=>get(b).embeddedEvent);var Ut=comment$1(),vr=first_child(Ut);component(vr,()=>get(Zt),(zr,or)=>{or(zr,{get ndk(){return t.ndk},get bech32(){return get(Ft)},get onEventClick(){return get(_).onEventClick}})}),append(Mt,Ut)},St=Mt=>{var Ft=comment$1(),Zt=first_child(Ft);{var Ut=zr=>{var or=root_12();or.__click=[on_click,L,Ge];var sr=child(or,!0);reset$1(or),template_effect(()=>{set_attribute(or,"href",get(Ge).content),set_text(sr,get(Ge).content)}),append(zr,or)},vr=zr=>{var or=comment$1(),sr=first_child(or);{var er=nr=>{const Fr=user_derived(()=>get(Ge).data);var Ar=root_14();each(Ar,20,()=>get(Fr),qr=>qr,(qr,dn)=>{var Mr=root_15();template_effect(()=>set_attribute(Mr,"src",dn)),append(qr,Mr)}),reset$1(Ar),template_effect(qr=>set_class(Ar,1,`image-grid grid-${qr??""}`,"svelte-wqb641"),[()=>Math.min(get(Fr).length,3)]),append(nr,Ar)},Xt=nr=>{var Fr=comment$1(),Ar=first_child(Fr);{var qr=dn=>{const Mr=user_derived(()=>get(Ge).content);var gr=root_17(),en=child(gr);{var ur=Nr=>{const Yt=user_derived(()=>extractYouTubeId(get(Mr)));var Ir=comment$1(),Qe=first_child(Ir);{var nt=_t=>{var Bt=root_19();template_effect(()=>set_attribute(Bt,"src",`https://www.youtube.com/embed/${get(Yt)}`)),append(_t,Bt)};if_block(Qe,_t=>{get(Yt)&&_t(nt)})}append(Nr,Ir)},ar=Nr=>{var Yt=comment$1(),Ir=first_child(Yt);{var Qe=_t=>{var Bt=root_21();template_effect(()=>set_attribute(Bt,"src",get(Mr))),append(_t,Bt)},nt=_t=>{var Bt=root_22();template_effect(()=>set_attribute(Bt,"src",get(Mr))),append(_t,Bt)};if_block(Ir,_t=>{isVideo(get(Mr))?_t(Qe):_t(nt,!1)},!0)}append(Nr,Yt)};if_block(en,Nr=>{isYouTube(get(Mr))?Nr(ur):Nr(ar,!1)})}reset$1(gr),append(dn,gr)};if_block(Ar,dn=>{get(Ge).type==="media"&&dn(qr)},!0)}append(nr,Fr)};if_block(sr,nr=>{get(Ge).type==="image-grid"?nr(er):nr(Xt,!1)},!0)}append(zr,or)};if_block(Zt,zr=>{get(Ge).type==="link"?zr(Ut):zr(vr,!1)},!0)}append(Mt,Ft)};if_block(Ze,Mt=>{get(Ge).type==="event-ref"?Mt(lt):Mt(St,!1)},!0)}append(oe,Ue)};if_block(ve,oe=>{get(Ge).type==="npub"||get(Ge).type==="nprofile"?oe(re):oe(B,!1)},!0)}append(Q,$e)};if_block(A,Q=>{get(Ge).type==="hashtag"?Q(k):Q(Y,!1)},!0)}append(se,m)};if_block(st,se=>{get(Ge).type==="emoji"?se(ht):se(je,!1)},!0)}append(We,rt)};if_block(Xe,We=>{get(Ge).type==="text"?We(He):We(Ve,!1)})}append(Le,ze)}),reset$1(Ce),template_effect(()=>set_class(Ce,1,`content-renderer ${s()??""}`,"svelte-wqb641")),append(r,Ce),pop()}delegate(["click"]);function OrderedMap(r){this.content=r}OrderedMap.prototype={constructor:OrderedMap,find:function(r){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===r)return t;return-1},get:function(r){var t=this.find(r);return t==-1?void 0:this.content[t+1]},update:function(r,t,n){var s=n&&n!=r?this.remove(n):this,o=s.find(r),a=s.content.slice();return o==-1?a.push(n||r,t):(a[o+1]=t,n&&(a[o]=n)),new OrderedMap(a)},remove:function(r){var t=this.find(r);if(t==-1)return this;var n=this.content.slice();return n.splice(t,2),new OrderedMap(n)},addToStart:function(r,t){return new OrderedMap([r,t].concat(this.remove(r).content))},addToEnd:function(r,t){var n=this.remove(r).content.slice();return n.push(r,t),new OrderedMap(n)},addBefore:function(r,t,n){var s=this.remove(t),o=s.content.slice(),a=s.find(r);return o.splice(a==-1?o.length:a,0,t,n),new OrderedMap(o)},forEach:function(r){for(var t=0;t<this.content.length;t+=2)r(this.content[t],this.content[t+1])},prepend:function(r){return r=OrderedMap.from(r),r.size?new OrderedMap(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=OrderedMap.from(r),r.size?new OrderedMap(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var t=this;r=OrderedMap.from(r);for(var n=0;n<r.content.length;n+=2)t=t.remove(r.content[n]);return t},toObject:function(){var r={};return this.forEach(function(t,n){r[t]=n}),r},get size(){return this.content.length>>1}};OrderedMap.from=function(r){if(r instanceof OrderedMap)return r;var t=[];if(r)for(var n in r)t.push(n,r[n]);return new OrderedMap(t)};function findDiffStart(r,t,n){for(let s=0;;s++){if(s==r.childCount||s==t.childCount)return r.childCount==t.childCount?null:n;let o=r.child(s),a=t.child(s);if(o==a){n+=o.nodeSize;continue}if(!o.sameMarkup(a))return n;if(o.isText&&o.text!=a.text){for(let c=0;o.text[c]==a.text[c];c++)n++;return n}if(o.content.size||a.content.size){let c=findDiffStart(o.content,a.content,n+1);if(c!=null)return c}n+=o.nodeSize}}function findDiffEnd(r,t,n,s){for(let o=r.childCount,a=t.childCount;;){if(o==0||a==0)return o==a?null:{a:n,b:s};let c=r.child(--o),f=t.child(--a),g=c.nodeSize;if(c==f){n-=g,s-=g;continue}if(!c.sameMarkup(f))return{a:n,b:s};if(c.isText&&c.text!=f.text){let b=0,_=Math.min(c.text.length,f.text.length);for(;b<_&&c.text[c.text.length-b-1]==f.text[f.text.length-b-1];)b++,n--,s--;return{a:n,b:s}}if(c.content.size||f.content.size){let b=findDiffEnd(c.content,f.content,n-1,s-1);if(b)return b}n-=g,s-=g}}class Fragment{constructor(t,n){if(this.content=t,this.size=n||0,n==null)for(let s=0;s<t.length;s++)this.size+=t[s].nodeSize}nodesBetween(t,n,s,o=0,a){for(let c=0,f=0;f<n;c++){let g=this.content[c],b=f+g.nodeSize;if(b>t&&s(g,o+f,a||null,c)!==!1&&g.content.size){let _=f+1;g.nodesBetween(Math.max(0,t-_),Math.min(g.content.size,n-_),s,o+_)}f=b}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,n,s,o){let a="",c=!0;return this.nodesBetween(t,n,(f,g)=>{let b=f.isText?f.text.slice(Math.max(t,g)-g,n-g):f.isLeaf?o?typeof o=="function"?o(f):o:f.type.spec.leafText?f.type.spec.leafText(f):"":"";f.isBlock&&(f.isLeaf&&b||f.isTextblock)&&s&&(c?c=!1:a+=s),a+=b},0),a}append(t){if(!t.size)return this;if(!this.size)return t;let n=this.lastChild,s=t.firstChild,o=this.content.slice(),a=0;for(n.isText&&n.sameMarkup(s)&&(o[o.length-1]=n.withText(n.text+s.text),a=1);a<t.content.length;a++)o.push(t.content[a]);return new Fragment(o,this.size+t.size)}cut(t,n=this.size){if(t==0&&n==this.size)return this;let s=[],o=0;if(n>t)for(let a=0,c=0;c<n;a++){let f=this.content[a],g=c+f.nodeSize;g>t&&((c<t||g>n)&&(f.isText?f=f.cut(Math.max(0,t-c),Math.min(f.text.length,n-c)):f=f.cut(Math.max(0,t-c-1),Math.min(f.content.size,n-c-1))),s.push(f),o+=f.nodeSize),c=g}return new Fragment(s,o)}cutByIndex(t,n){return t==n?Fragment.empty:t==0&&n==this.content.length?this:new Fragment(this.content.slice(t,n))}replaceChild(t,n){let s=this.content[t];if(s==n)return this;let o=this.content.slice(),a=this.size+n.nodeSize-s.nodeSize;return o[t]=n,new Fragment(o,a)}addToStart(t){return new Fragment([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new Fragment(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(t.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let n=this.content[t];if(!n)throw new RangeError("Index "+t+" out of range for "+this);return n}maybeChild(t){return this.content[t]||null}forEach(t){for(let n=0,s=0;n<this.content.length;n++){let o=this.content[n];t(o,s,n),s+=o.nodeSize}}findDiffStart(t,n=0){return findDiffStart(this,t,n)}findDiffEnd(t,n=this.size,s=t.size){return findDiffEnd(this,t,n,s)}findIndex(t){if(t==0)return retIndex(0,t);if(t==this.size)return retIndex(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,s=0;;n++){let o=this.child(n),a=s+o.nodeSize;if(a>=t)return a==t?retIndex(n+1,a):retIndex(n,s);s=a}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,n){if(!n)return Fragment.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(n.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return Fragment.empty;let n,s=0;for(let o=0;o<t.length;o++){let a=t[o];s+=a.nodeSize,o&&a.isText&&t[o-1].sameMarkup(a)?(n||(n=t.slice(0,o)),n[n.length-1]=a.withText(n[n.length-1].text+a.text)):n&&n.push(a)}return new Fragment(n||t,s)}static from(t){if(!t)return Fragment.empty;if(t instanceof Fragment)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new Fragment([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(r,t){return found.index=r,found.offset=t,found}function compareDeep(r,t){if(r===t)return!0;if(!(r&&typeof r=="object")||!(t&&typeof t=="object"))return!1;let n=Array.isArray(r);if(Array.isArray(t)!=n)return!1;if(n){if(r.length!=t.length)return!1;for(let s=0;s<r.length;s++)if(!compareDeep(r[s],t[s]))return!1}else{for(let s in r)if(!(s in t)||!compareDeep(r[s],t[s]))return!1;for(let s in t)if(!(s in r))return!1}return!0}let Mark$1=class Oi{constructor(t,n){this.type=t,this.attrs=n}addToSet(t){let n,s=!1;for(let o=0;o<t.length;o++){let a=t[o];if(this.eq(a))return t;if(this.type.excludes(a.type))n||(n=t.slice(0,o));else{if(a.type.excludes(this.type))return t;!s&&a.type.rank>this.type.rank&&(n||(n=t.slice(0,o)),n.push(this),s=!0),n&&n.push(a)}}return n||(n=t.slice()),s||n.push(this),n}removeFromSet(t){for(let n=0;n<t.length;n++)if(this.eq(t[n]))return t.slice(0,n).concat(t.slice(n+1));return t}isInSet(t){for(let n=0;n<t.length;n++)if(this.eq(t[n]))return!0;return!1}eq(t){return this==t||this.type==t.type&&compareDeep(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let n in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let s=t.marks[n.type];if(!s)throw new RangeError(`There is no mark type ${n.type} in this schema`);let o=s.create(n.attrs);return s.checkAttrs(o.attrs),o}static sameSet(t,n){if(t==n)return!0;if(t.length!=n.length)return!1;for(let s=0;s<t.length;s++)if(!t[s].eq(n[s]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return Oi.none;if(t instanceof Oi)return[t];let n=t.slice();return n.sort((s,o)=>s.type.rank-o.type.rank),n}};Mark$1.none=[];class ReplaceError extends Error{}class Slice{constructor(t,n,s){this.content=t,this.openStart=n,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,n){let s=insertInto(this.content,t+this.openStart,n);return s&&new Slice(s,this.openStart,this.openEnd)}removeBetween(t,n){return new Slice(removeRange(this.content,t+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,n){if(!n)return Slice.empty;let s=n.openStart||0,o=n.openEnd||0;if(typeof s!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(t,n.content),s,o)}static maxOpen(t,n=!0){let s=0,o=0;for(let a=t.firstChild;a&&!a.isLeaf&&(n||!a.type.spec.isolating);a=a.firstChild)s++;for(let a=t.lastChild;a&&!a.isLeaf&&(n||!a.type.spec.isolating);a=a.lastChild)o++;return new Slice(t,s,o)}}Slice.empty=new Slice(Fragment.empty,0,0);function removeRange(r,t,n){let{index:s,offset:o}=r.findIndex(t),a=r.maybeChild(s),{index:c,offset:f}=r.findIndex(n);if(o==t||a.isText){if(f!=n&&!r.child(c).isText)throw new RangeError("Removing non-flat range");return r.cut(0,t).append(r.cut(n))}if(s!=c)throw new RangeError("Removing non-flat range");return r.replaceChild(s,a.copy(removeRange(a.content,t-o-1,n-o-1)))}function insertInto(r,t,n,s){let{index:o,offset:a}=r.findIndex(t),c=r.maybeChild(o);if(a==t||c.isText)return s&&!s.canReplace(o,o,n)?null:r.cut(0,t).append(n).append(r.cut(t));let f=insertInto(c.content,t-a-1,n,c);return f&&r.replaceChild(o,c.copy(f))}function replace$1(r,t,n){if(n.openStart>r.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(r.depth-n.openStart!=t.depth-n.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter(r,t,n,0)}function replaceOuter(r,t,n,s){let o=r.index(s),a=r.node(s);if(o==t.index(s)&&s<r.depth-n.openStart){let c=replaceOuter(r,t,n,s+1);return a.copy(a.content.replaceChild(o,c))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&r.depth==s&&t.depth==s){let c=r.parent,f=c.content;return close(c,f.cut(0,r.parentOffset).append(n.content).append(f.cut(t.parentOffset)))}else{let{start:c,end:f}=prepareSliceForReplace(n,r);return close(a,replaceThreeWay(r,c,f,t,s))}else return close(a,replaceTwoWay(r,t,s))}function checkJoin(r,t){if(!t.type.compatibleContent(r.type))throw new ReplaceError("Cannot join "+t.type.name+" onto "+r.type.name)}function joinable$1(r,t,n){let s=r.node(n);return checkJoin(s,t.node(n)),s}function addNode(r,t){let n=t.length-1;n>=0&&r.isText&&r.sameMarkup(t[n])?t[n]=r.withText(t[n].text+r.text):t.push(r)}function addRange(r,t,n,s){let o=(t||r).node(n),a=0,c=t?t.index(n):o.childCount;r&&(a=r.index(n),r.depth>n?a++:r.textOffset&&(addNode(r.nodeAfter,s),a++));for(let f=a;f<c;f++)addNode(o.child(f),s);t&&t.depth==n&&t.textOffset&&addNode(t.nodeBefore,s)}function close(r,t){return r.type.checkContent(t),r.copy(t)}function replaceThreeWay(r,t,n,s,o){let a=r.depth>o&&joinable$1(r,t,o+1),c=s.depth>o&&joinable$1(n,s,o+1),f=[];return addRange(null,r,o,f),a&&c&&t.index(o)==n.index(o)?(checkJoin(a,c),addNode(close(a,replaceThreeWay(r,t,n,s,o+1)),f)):(a&&addNode(close(a,replaceTwoWay(r,t,o+1)),f),addRange(t,n,o,f),c&&addNode(close(c,replaceTwoWay(n,s,o+1)),f)),addRange(s,null,o,f),new Fragment(f)}function replaceTwoWay(r,t,n){let s=[];if(addRange(null,r,n,s),r.depth>n){let o=joinable$1(r,t,n+1);addNode(close(o,replaceTwoWay(r,t,n+1)),s)}return addRange(t,null,n,s),new Fragment(s)}function prepareSliceForReplace(r,t){let n=t.depth-r.openStart,o=t.node(n).copy(r.content);for(let a=n-1;a>=0;a--)o=t.node(a).copy(Fragment.from(o));return{start:o.resolveNoCache(r.openStart+n),end:o.resolveNoCache(o.content.size-r.openEnd-n)}}class ResolvedPos{constructor(t,n,s){this.pos=t,this.path=n,this.parentOffset=s,this.depth=n.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,n=this.index(this.depth);if(n==t.childCount)return null;let s=this.pos-this.path[this.path.length-1],o=t.child(n);return s?t.child(n).cut(s):o}get nodeBefore(){let t=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(t).cut(0,n):t==0?null:this.parent.child(t-1)}posAtIndex(t,n){n=this.resolveDepth(n);let s=this.path[n*3],o=n==0?0:this.path[n*3-1]+1;for(let a=0;a<t;a++)o+=s.child(a).nodeSize;return o}marks(){let t=this.parent,n=this.index();if(t.content.size==0)return Mark$1.none;if(this.textOffset)return t.child(n).marks;let s=t.maybeChild(n-1),o=t.maybeChild(n);if(!s){let f=s;s=o,o=f}let a=s.marks;for(var c=0;c<a.length;c++)a[c].type.spec.inclusive===!1&&(!o||!a[c].isInSet(o.marks))&&(a=a[c--].removeFromSet(a));return a}marksAcross(t){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let s=n.marks,o=t.parent.maybeChild(t.index());for(var a=0;a<s.length;a++)s[a].type.spec.inclusive===!1&&(!o||!s[a].isInSet(o.marks))&&(s=s[a--].removeFromSet(s));return s}sharedDepth(t){for(let n=this.depth;n>0;n--)if(this.start(n)<=t&&this.end(n)>=t)return n;return 0}blockRange(t=this,n){if(t.pos<this.pos)return t.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);s>=0;s--)if(t.pos<=this.end(s)&&(!n||n(this.node(s))))return new NodeRange(this,t,s);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let n=1;n<=this.depth;n++)t+=(t?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return t+":"+this.parentOffset}static resolve(t,n){if(!(n>=0&&n<=t.content.size))throw new RangeError("Position "+n+" out of range");let s=[],o=0,a=n;for(let c=t;;){let{index:f,offset:g}=c.content.findIndex(a),b=a-g;if(s.push(c,f,o+g),!b||(c=c.child(f),c.isText))break;a=b-1,o+=g+1}return new ResolvedPos(n,s,a)}static resolveCached(t,n){let s=resolveCache.get(t);if(s)for(let a=0;a<s.elts.length;a++){let c=s.elts[a];if(c.pos==n)return c}else resolveCache.set(t,s=new ResolveCache);let o=s.elts[s.i]=ResolvedPos.resolve(t,n);return s.i=(s.i+1)%resolveCacheSize,o}}class ResolveCache{constructor(){this.elts=[],this.i=0}}const resolveCacheSize=12,resolveCache=new WeakMap;class NodeRange{constructor(t,n,s){this.$from=t,this.$to=n,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);let Node$1=class Fi{constructor(t,n,s,o=Mark$1.none){this.type=t,this.attrs=n,this.marks=o,this.content=s||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,n,s,o=0){this.content.nodesBetween(t,n,s,o,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,n,s,o){return this.content.textBetween(t,n,s,o)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,n,s){return this.type==t&&compareDeep(this.attrs,n||t.defaultAttrs||emptyAttrs)&&Mark$1.sameSet(this.marks,s||Mark$1.none)}copy(t=null){return t==this.content?this:new Fi(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new Fi(this.type,this.attrs,this.content,t)}cut(t,n=this.content.size){return t==0&&n==this.content.size?this:this.copy(this.content.cut(t,n))}slice(t,n=this.content.size,s=!1){if(t==n)return Slice.empty;let o=this.resolve(t),a=this.resolve(n),c=s?0:o.sharedDepth(n),f=o.start(c),b=o.node(c).content.cut(o.pos-f,a.pos-f);return new Slice(b,o.depth-c,a.depth-c)}replace(t,n,s){return replace$1(this.resolve(t),this.resolve(n),s)}nodeAt(t){for(let n=this;;){let{index:s,offset:o}=n.content.findIndex(t);if(n=n.maybeChild(s),!n)return null;if(o==t||n.isText)return n;t-=o+1}}childAfter(t){let{index:n,offset:s}=this.content.findIndex(t);return{node:this.content.maybeChild(n),index:n,offset:s}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:n,offset:s}=this.content.findIndex(t);if(s<t)return{node:this.content.child(n),index:n,offset:s};let o=this.content.child(n-1);return{node:o,index:n-1,offset:s-o.nodeSize}}resolve(t){return ResolvedPos.resolveCached(this,t)}resolveNoCache(t){return ResolvedPos.resolve(this,t)}rangeHasMark(t,n,s){let o=!1;return n>t&&this.nodesBetween(t,n,a=>(s.isInSet(a.marks)&&(o=!0),!o)),o}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,t)}contentMatchAt(t){let n=this.type.contentMatch.matchFragment(this.content,0,t);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(t,n,s=Fragment.empty,o=0,a=s.childCount){let c=this.contentMatchAt(t).matchFragment(s,o,a),f=c&&c.matchFragment(this.content,n);if(!f||!f.validEnd)return!1;for(let g=o;g<a;g++)if(!this.type.allowsMarks(s.child(g).marks))return!1;return!0}canReplaceWith(t,n,s,o){if(o&&!this.type.allowsMarks(o))return!1;let a=this.contentMatchAt(t).matchType(s),c=a&&a.matchFragment(this.content,n);return c?c.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=Mark$1.none;for(let n=0;n<this.marks.length;n++){let s=this.marks[n];s.type.checkAttrs(s.attrs),t=s.addToSet(t)}if(!Mark$1.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let t={type:this.type.name};for(let n in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(n=>n.toJSON())),t}static fromJSON(t,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let s;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=n.marks.map(t.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(n.text,s)}let o=Fragment.fromJSON(t,n.content),a=t.nodeType(n.type).create(n.attrs,o,s);return a.type.checkAttrs(a.attrs),a}};Node$1.prototype.text=void 0;class TextNode extends Node$1{constructor(t,n,s,o){if(super(t,n,null,o),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,n){return this.text.slice(t,n)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new TextNode(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new TextNode(this.type,this.attrs,t,this.marks)}cut(t=0,n=this.text.length){return t==0&&n==this.text.length?this:this.withText(this.text.slice(t,n))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function wrapMarks(r,t){for(let n=r.length-1;n>=0;n--)t=r[n].type.name+"("+t+")";return t}class ContentMatch{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,n){let s=new TokenStream(t,n);if(s.next==null)return ContentMatch.empty;let o=parseExpr(s);s.next&&s.err("Unexpected trailing text");let a=dfa(nfa(o));return checkForDeadEnds(a,s),a}matchType(t){for(let n=0;n<this.next.length;n++)if(this.next[n].type==t)return this.next[n].next;return null}matchFragment(t,n=0,s=t.childCount){let o=this;for(let a=n;o&&a<s;a++)o=o.matchType(t.child(a).type);return o}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:n}=this.next[t];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(t){for(let n=0;n<this.next.length;n++)for(let s=0;s<t.next.length;s++)if(this.next[n].type==t.next[s].type)return!0;return!1}fillBefore(t,n=!1,s=0){let o=[this];function a(c,f){let g=c.matchFragment(t,s);if(g&&(!n||g.validEnd))return Fragment.from(f.map(b=>b.createAndFill()));for(let b=0;b<c.next.length;b++){let{type:_,next:L}=c.next[b];if(!(_.isText||_.hasRequiredAttrs())&&o.indexOf(L)==-1){o.push(L);let q=a(L,f.concat(_));if(q)return q}}return null}return a(this,[])}findWrapping(t){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==t)return this.wrapCache[s+1];let n=this.computeWrapping(t);return this.wrapCache.push(t,n),n}computeWrapping(t){let n=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let o=s.shift(),a=o.match;if(a.matchType(t)){let c=[];for(let f=o;f.type;f=f.via)c.push(f.type);return c.reverse()}for(let c=0;c<a.next.length;c++){let{type:f,next:g}=a.next[c];!f.isLeaf&&!f.hasRequiredAttrs()&&!(f.name in n)&&(!o.type||g.validEnd)&&(s.push({match:f.contentMatch,type:f,via:o}),n[f.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function n(s){t.push(s);for(let o=0;o<s.next.length;o++)t.indexOf(s.next[o].next)==-1&&n(s.next[o].next)}return n(this),t.map((s,o)=>{let a=o+(s.validEnd?"*":" ")+" ";for(let c=0;c<s.next.length;c++)a+=(c?", ":"")+s.next[c].type.name+"->"+t.indexOf(s.next[c].next);return a}).join(`
`)}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(t,n){this.string=t,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function parseExpr(r){let t=[];do t.push(parseExprSeq(r));while(r.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function parseExprSeq(r){let t=[];do t.push(parseExprSubscript(r));while(r.next&&r.next!=")"&&r.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function parseExprSubscript(r){let t=parseExprAtom(r);for(;;)if(r.eat("+"))t={type:"plus",expr:t};else if(r.eat("*"))t={type:"star",expr:t};else if(r.eat("?"))t={type:"opt",expr:t};else if(r.eat("{"))t=parseExprRange(r,t);else break;return t}function parseNum(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let t=Number(r.next);return r.pos++,t}function parseExprRange(r,t){let n=parseNum(r),s=n;return r.eat(",")&&(r.next!="}"?s=parseNum(r):s=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:t}}function resolveName(r,t){let n=r.nodeTypes,s=n[t];if(s)return[s];let o=[];for(let a in n){let c=n[a];c.isInGroup(t)&&o.push(c)}return o.length==0&&r.err("No node type or group '"+t+"' found"),o}function parseExprAtom(r){if(r.eat("(")){let t=parseExpr(r);return r.eat(")")||r.err("Missing closing paren"),t}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let t=resolveName(r,r.next).map(n=>(r.inline==null?r.inline=n.isInline:r.inline!=n.isInline&&r.err("Mixing inline and block content"),{type:"name",value:n}));return r.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function nfa(r){let t=[[]];return o(a(r,0),n()),t;function n(){return t.push([])-1}function s(c,f,g){let b={term:g,to:f};return t[c].push(b),b}function o(c,f){c.forEach(g=>g.to=f)}function a(c,f){if(c.type=="choice")return c.exprs.reduce((g,b)=>g.concat(a(b,f)),[]);if(c.type=="seq")for(let g=0;;g++){let b=a(c.exprs[g],f);if(g==c.exprs.length-1)return b;o(b,f=n())}else if(c.type=="star"){let g=n();return s(f,g),o(a(c.expr,g),g),[s(g)]}else if(c.type=="plus"){let g=n();return o(a(c.expr,f),g),o(a(c.expr,g),g),[s(g)]}else{if(c.type=="opt")return[s(f)].concat(a(c.expr,f));if(c.type=="range"){let g=f;for(let b=0;b<c.min;b++){let _=n();o(a(c.expr,g),_),g=_}if(c.max==-1)o(a(c.expr,g),g);else for(let b=c.min;b<c.max;b++){let _=n();s(g,_),o(a(c.expr,g),_),g=_}return[s(g)]}else{if(c.type=="name")return[s(f,void 0,c.value)];throw new Error("Unknown expr type")}}}}function cmp(r,t){return t-r}function nullFrom(r,t){let n=[];return s(t),n.sort(cmp);function s(o){let a=r[o];if(a.length==1&&!a[0].term)return s(a[0].to);n.push(o);for(let c=0;c<a.length;c++){let{term:f,to:g}=a[c];!f&&n.indexOf(g)==-1&&s(g)}}}function dfa(r){let t=Object.create(null);return n(nullFrom(r,0));function n(s){let o=[];s.forEach(c=>{r[c].forEach(({term:f,to:g})=>{if(!f)return;let b;for(let _=0;_<o.length;_++)o[_][0]==f&&(b=o[_][1]);nullFrom(r,g).forEach(_=>{b||o.push([f,b=[]]),b.indexOf(_)==-1&&b.push(_)})})});let a=t[s.join(",")]=new ContentMatch(s.indexOf(r.length-1)>-1);for(let c=0;c<o.length;c++){let f=o[c][1].sort(cmp);a.next.push({type:o[c][0],next:t[f.join(",")]||n(f)})}return a}}function checkForDeadEnds(r,t){for(let n=0,s=[r];n<s.length;n++){let o=s[n],a=!o.validEnd,c=[];for(let f=0;f<o.next.length;f++){let{type:g,next:b}=o.next[f];c.push(g.name),a&&!(g.isText||g.hasRequiredAttrs())&&(a=!1),s.indexOf(b)==-1&&s.push(b)}a&&t.err("Only non-generatable nodes ("+c.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(r){let t=Object.create(null);for(let n in r){let s=r[n];if(!s.hasDefault)return null;t[n]=s.default}return t}function computeAttrs(r,t){let n=Object.create(null);for(let s in r){let o=t&&t[s];if(o===void 0){let a=r[s];if(a.hasDefault)o=a.default;else throw new RangeError("No value supplied for attribute "+s)}n[s]=o}return n}function checkAttrs(r,t,n,s){for(let o in t)if(!(o in r))throw new RangeError(`Unsupported attribute ${o} for ${n} of type ${o}`);for(let o in r){let a=r[o];a.validate&&a.validate(t[o])}}function initAttrs(r,t){let n=Object.create(null);if(t)for(let s in t)n[s]=new Attribute(r,s,t[s]);return n}let NodeType$1=class xo{constructor(t,n,s){this.name=t,this.schema=n,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=initAttrs(t,s.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,t)}create(t=null,n,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node$1(this,this.computeAttrs(t),Fragment.from(n),Mark$1.setFrom(s))}createChecked(t=null,n,s){return n=Fragment.from(n),this.checkContent(n),new Node$1(this,this.computeAttrs(t),n,Mark$1.setFrom(s))}createAndFill(t=null,n,s){if(t=this.computeAttrs(t),n=Fragment.from(n),n.size){let c=this.contentMatch.fillBefore(n);if(!c)return null;n=c.append(n)}let o=this.contentMatch.matchFragment(n),a=o&&o.fillBefore(Fragment.empty,!0);return a?new Node$1(this,t,n.append(a),Mark$1.setFrom(s)):null}validContent(t){let n=this.contentMatch.matchFragment(t);if(!n||!n.validEnd)return!1;for(let s=0;s<t.childCount;s++)if(!this.allowsMarks(t.child(s).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){checkAttrs(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let n=0;n<t.length;n++)if(!this.allowsMarkType(t[n].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let n;for(let s=0;s<t.length;s++)this.allowsMarkType(t[s].type)?n&&n.push(t[s]):n||(n=t.slice(0,s));return n?n.length?n:Mark$1.none:t}static compile(t,n){let s=Object.create(null);t.forEach((a,c)=>s[a]=new xo(a,n,c));let o=n.spec.topNode||"doc";if(!s[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let a in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function validateType(r,t,n){let s=n.split("|");return o=>{let a=o===null?"null":typeof o;if(s.indexOf(a)<0)throw new RangeError(`Expected value of type ${s} for attribute ${t} on type ${r}, got ${a}`)}}class Attribute{constructor(t,n,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?validateType(t,n,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class MarkType{constructor(t,n,s,o){this.name=t,this.rank=n,this.schema=s,this.spec=o,this.attrs=initAttrs(t,o.attrs),this.excluded=null;let a=defaultAttrs(this.attrs);this.instance=a?new Mark$1(this,a):null}create(t=null){return!t&&this.instance?this.instance:new Mark$1(this,computeAttrs(this.attrs,t))}static compile(t,n){let s=Object.create(null),o=0;return t.forEach((a,c)=>s[a]=new MarkType(a,o++,n,c)),s}removeFromSet(t){for(var n=0;n<t.length;n++)t[n].type==this&&(t=t.slice(0,n).concat(t.slice(n+1)),n--);return t}isInSet(t){for(let n=0;n<t.length;n++)if(t[n].type==this)return t[n]}checkAttrs(t){checkAttrs(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class Schema{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let o in t)n[o]=t[o];n.nodes=OrderedMap.from(t.nodes),n.marks=OrderedMap.from(t.marks||{}),this.nodes=NodeType$1.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let s=Object.create(null);for(let o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");let a=this.nodes[o],c=a.spec.content||"",f=a.spec.marks;if(a.contentMatch=s[c]||(s[c]=ContentMatch.parse(c,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=f=="_"?null:f?gatherMarks(this,f.split(" ")):f==""||!a.inlineContent?[]:null}for(let o in this.marks){let a=this.marks[o],c=a.spec.excludes;a.excluded=c==null?[a]:c==""?[]:gatherMarks(this,c.split(" "))}this.nodeFromJSON=o=>Node$1.fromJSON(this,o),this.markFromJSON=o=>Mark$1.fromJSON(this,o),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,n=null,s,o){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof NodeType$1){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(n,s,o)}text(t,n){let s=this.nodes.text;return new TextNode(s,s.defaultAttrs,t,Mark$1.setFrom(n))}mark(t,n){return typeof t=="string"&&(t=this.marks[t]),t.create(n)}nodeType(t){let n=this.nodes[t];if(!n)throw new RangeError("Unknown node type: "+t);return n}}function gatherMarks(r,t){let n=[];for(let s=0;s<t.length;s++){let o=t[s],a=r.marks[o],c=a;if(a)n.push(a);else for(let f in r.marks){let g=r.marks[f];(o=="_"||g.spec.group&&g.spec.group.split(" ").indexOf(o)>-1)&&n.push(c=g)}if(!c)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return n}function isTagRule(r){return r.tag!=null}function isStyleRule(r){return r.style!=null}class DOMParser{constructor(t,n){this.schema=t,this.rules=n,this.tags=[],this.styles=[];let s=this.matchedStyles=[];n.forEach(o=>{if(isTagRule(o))this.tags.push(o);else if(isStyleRule(o)){let a=/[^=]*/.exec(o.style)[0];s.indexOf(a)<0&&s.push(a),this.styles.push(o)}}),this.normalizeLists=!this.tags.some(o=>{if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;let a=t.nodes[o.node];return a.contentMatch.matchType(a)})}parse(t,n={}){let s=new ParseContext(this,n,!1);return s.addAll(t,Mark$1.none,n.from,n.to),s.finish()}parseSlice(t,n={}){let s=new ParseContext(this,n,!0);return s.addAll(t,Mark$1.none,n.from,n.to),Slice.maxOpen(s.finish())}matchTag(t,n,s){for(let o=s?this.tags.indexOf(s)+1:0;o<this.tags.length;o++){let a=this.tags[o];if(matches(t,a.tag)&&(a.namespace===void 0||t.namespaceURI==a.namespace)&&(!a.context||n.matchesContext(a.context))){if(a.getAttrs){let c=a.getAttrs(t);if(c===!1)continue;a.attrs=c||void 0}return a}}}matchStyle(t,n,s,o){for(let a=o?this.styles.indexOf(o)+1:0;a<this.styles.length;a++){let c=this.styles[a],f=c.style;if(!(f.indexOf(t)!=0||c.context&&!s.matchesContext(c.context)||f.length>t.length&&(f.charCodeAt(t.length)!=61||f.slice(t.length+1)!=n))){if(c.getAttrs){let g=c.getAttrs(n);if(g===!1)continue;c.attrs=g||void 0}return c}}}static schemaRules(t){let n=[];function s(o){let a=o.priority==null?50:o.priority,c=0;for(;c<n.length;c++){let f=n[c];if((f.priority==null?50:f.priority)<a)break}n.splice(c,0,o)}for(let o in t.marks){let a=t.marks[o].spec.parseDOM;a&&a.forEach(c=>{s(c=copy(c)),c.mark||c.ignore||c.clearMark||(c.mark=o)})}for(let o in t.nodes){let a=t.nodes[o].spec.parseDOM;a&&a.forEach(c=>{s(c=copy(c)),c.node||c.ignore||c.mark||(c.node=o)})}return n}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new DOMParser(t,DOMParser.schemaRules(t)))}}const blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(r,t,n){return t!=null?(t?OPT_PRESERVE_WS:0)|(t==="full"?OPT_PRESERVE_WS_FULL:0):r&&r.whitespace=="pre"?OPT_PRESERVE_WS|OPT_PRESERVE_WS_FULL:n&~OPT_OPEN_LEFT}class NodeContext{constructor(t,n,s,o,a,c){this.type=t,this.attrs=n,this.marks=s,this.solid=o,this.options=c,this.content=[],this.activeMarks=Mark$1.none,this.match=a||(c&OPT_OPEN_LEFT?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Fragment.from(t));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let s=this.type.contentMatch,o;return(o=s.findWrapping(t.type))?(this.match=s,o):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&OPT_PRESERVE_WS)){let s=this.content[this.content.length-1],o;if(s&&s.isText&&(o=/[ \t\r\n\u000c]+$/.exec(s.text))){let a=s;s.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-o[0].length))}}let n=Fragment.from(this.content);return!t&&this.match&&(n=n.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!blockTags.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class ParseContext{constructor(t,n,s){this.parser=t,this.options=n,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let o=n.topNode,a,c=wsOptionsFor(null,n.preserveWhitespace,0)|(s?OPT_OPEN_LEFT:0);o?a=new NodeContext(o.type,o.attrs,Mark$1.none,!0,n.topMatch||o.type.contentMatch,c):s?a=new NodeContext(null,null,Mark$1.none,!0,null,c):a=new NodeContext(t.schema.topNodeType,null,Mark$1.none,!0,null,c),this.nodes=[a],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,n){t.nodeType==3?this.addTextNode(t,n):t.nodeType==1&&this.addElement(t,n)}addTextNode(t,n){let s=t.nodeValue,o=this.top,a=o.options&OPT_PRESERVE_WS_FULL?"full":this.localPreserveWS||(o.options&OPT_PRESERVE_WS)>0,{schema:c}=this.parser;if(a==="full"||o.inlineContext(t)||/[^ \t\r\n\u000c]/.test(s)){if(a)if(a==="full")s=s.replace(/\r\n?/g,`
`);else if(c.linebreakReplacement&&/[\r\n]/.test(s)&&this.top.findWrapping(c.linebreakReplacement.create())){let f=s.split(/\r?\n|\r/);for(let g=0;g<f.length;g++)g&&this.insertNode(c.linebreakReplacement.create(),n,!0),f[g]&&this.insertNode(c.text(f[g]),n,!/\S/.test(f[g]));s=""}else s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let f=o.content[o.content.length-1],g=t.previousSibling;(!f||g&&g.nodeName=="BR"||f.isText&&/[ \t\r\n\u000c]$/.test(f.text))&&(s=s.slice(1))}s&&this.insertNode(c.text(s),n,!/\S/.test(s)),this.findInText(t)}else this.findInside(t)}addElement(t,n,s){let o=this.localPreserveWS,a=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let c=t.nodeName.toLowerCase(),f;listTags.hasOwnProperty(c)&&this.parser.normalizeLists&&normalizeList(t);let g=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(f=this.parser.matchTag(t,this,s));e:if(g?g.ignore:ignoreTags.hasOwnProperty(c))this.findInside(t),this.ignoreFallback(t,n);else if(!g||g.skip||g.closeParent){g&&g.closeParent?this.open=Math.max(0,this.open-1):g&&g.skip.nodeType&&(t=g.skip);let b,_=this.needsBlock;if(blockTags.hasOwnProperty(c))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),b=!0,a.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,n);break e}let L=g&&g.skip?n:this.readStyles(t,n);L&&this.addAll(t,L),b&&this.sync(a),this.needsBlock=_}else{let b=this.readStyles(t,n);b&&this.addElementByRule(t,g,b,g.consuming===!1?f:void 0)}this.localPreserveWS=o}leafFallback(t,n){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),n)}ignoreFallback(t,n){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(t,n){let s=t.style;if(s&&s.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let a=this.parser.matchedStyles[o],c=s.getPropertyValue(a);if(c)for(let f=void 0;;){let g=this.parser.matchStyle(a,c,this,f);if(!g)break;if(g.ignore)return null;if(g.clearMark?n=n.filter(b=>!g.clearMark(b)):n=n.concat(this.parser.schema.marks[g.mark].create(g.attrs)),g.consuming===!1)f=g;else break}}return n}addElementByRule(t,n,s,o){let a,c;if(n.node)if(c=this.parser.schema.nodes[n.node],c.isLeaf)this.insertNode(c.create(n.attrs),s,t.nodeName=="BR")||this.leafFallback(t,s);else{let g=this.enter(c,n.attrs||null,s,n.preserveWhitespace);g&&(a=!0,s=g)}else{let g=this.parser.schema.marks[n.mark];s=s.concat(g.create(n.attrs))}let f=this.top;if(c&&c.isLeaf)this.findInside(t);else if(o)this.addElement(t,s,o);else if(n.getContent)this.findInside(t),n.getContent(t,this.parser.schema).forEach(g=>this.insertNode(g,s,!1));else{let g=t;typeof n.contentElement=="string"?g=t.querySelector(n.contentElement):typeof n.contentElement=="function"?g=n.contentElement(t):n.contentElement&&(g=n.contentElement),this.findAround(t,g,!0),this.addAll(g,s),this.findAround(t,g,!1)}a&&this.sync(f)&&this.open--}addAll(t,n,s,o){let a=s||0;for(let c=s?t.childNodes[s]:t.firstChild,f=o==null?null:t.childNodes[o];c!=f;c=c.nextSibling,++a)this.findAtPoint(t,a),this.addDOM(c,n);this.findAtPoint(t,a)}findPlace(t,n,s){let o,a;for(let c=this.open,f=0;c>=0;c--){let g=this.nodes[c],b=g.findWrapping(t);if(b&&(!o||o.length>b.length+f)&&(o=b,a=g,!b.length))break;if(g.solid){if(s)break;f+=2}}if(!o)return null;this.sync(a);for(let c=0;c<o.length;c++)n=this.enterInner(o[c],null,n,!1);return n}insertNode(t,n,s){if(t.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(n=this.enterInner(a,null,n))}let o=this.findPlace(t,n,s);if(o){this.closeExtra();let a=this.top;a.match&&(a.match=a.match.matchType(t.type));let c=Mark$1.none;for(let f of o.concat(t.marks))(a.type?a.type.allowsMarkType(f.type):markMayApply(f.type,t.type))&&(c=f.addToSet(c));return a.content.push(t.mark(c)),!0}return!1}enter(t,n,s,o){let a=this.findPlace(t.create(n),s,!1);return a&&(a=this.enterInner(t,n,s,!0,o)),a}enterInner(t,n,s,o=!1,a){this.closeExtra();let c=this.top;c.match=c.match&&c.match.matchType(t);let f=wsOptionsFor(t,a,c.options);c.options&OPT_OPEN_LEFT&&c.content.length==0&&(f|=OPT_OPEN_LEFT);let g=Mark$1.none;return s=s.filter(b=>(c.type?c.type.allowsMarkType(b.type):markMayApply(b.type,t))?(g=b.addToSet(g),!1):!0),this.nodes.push(new NodeContext(t,n,g,o,null,f)),this.open++,s}closeExtra(t=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let n=this.open;n>=0;n--){if(this.nodes[n]==t)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=OPT_PRESERVE_WS)}return!1}get currentPos(){this.closeExtra();let t=0;for(let n=this.open;n>=0;n--){let s=this.nodes[n].content;for(let o=s.length-1;o>=0;o--)t+=s[o].nodeSize;n&&t++}return t}findAtPoint(t,n){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==t&&this.find[s].offset==n&&(this.find[s].pos=this.currentPos)}findInside(t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&t.nodeType==1&&t.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(t,n,s){if(t!=n&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&t.nodeType==1&&t.contains(this.find[o].node)&&n.compareDocumentPosition(this.find[o].node)&(s?2:4)&&(this.find[o].pos=this.currentPos)}findInText(t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&(this.find[n].pos=this.currentPos-(t.nodeValue.length-this.find[n].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let n=t.split("/"),s=this.options.context,o=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),a=-(s?s.depth+1:0)+(o?0:1),c=(f,g)=>{for(;f>=0;f--){let b=n[f];if(b==""){if(f==n.length-1||f==0)continue;for(;g>=a;g--)if(c(f-1,g))return!0;return!1}else{let _=g>0||g==0&&o?this.nodes[g].type:s&&g>=a?s.node(g-a).type:null;if(!_||_.name!=b&&!_.isInGroup(b))return!1;g--}}return!0};return c(n.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let n=t.depth;n>=0;n--){let s=t.node(n).contentMatchAt(t.indexAfter(n)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let n in this.parser.schema.nodes){let s=this.parser.schema.nodes[n];if(s.isTextblock&&s.defaultAttrs)return s}}}function normalizeList(r){for(let t=r.firstChild,n=null;t;t=t.nextSibling){let s=t.nodeType==1?t.nodeName.toLowerCase():null;s&&listTags.hasOwnProperty(s)&&n?(n.appendChild(t),t=n):s=="li"?n=t:s&&(n=null)}}function matches(r,t){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,t)}function copy(r){let t={};for(let n in r)t[n]=r[n];return t}function markMayApply(r,t){let n=t.schema.nodes;for(let s in n){let o=n[s];if(!o.allowsMarkType(r))continue;let a=[],c=f=>{a.push(f);for(let g=0;g<f.edgeCount;g++){let{type:b,next:_}=f.edge(g);if(b==t||a.indexOf(_)<0&&c(_))return!0}};if(c(o.contentMatch))return!0}}class DOMSerializer{constructor(t,n){this.nodes=t,this.marks=n}serializeFragment(t,n={},s){s||(s=doc$1(n).createDocumentFragment());let o=s,a=[];return t.forEach(c=>{if(a.length||c.marks.length){let f=0,g=0;for(;f<a.length&&g<c.marks.length;){let b=c.marks[g];if(!this.marks[b.type.name]){g++;continue}if(!b.eq(a[f][0])||b.type.spec.spanning===!1)break;f++,g++}for(;f<a.length;)o=a.pop()[1];for(;g<c.marks.length;){let b=c.marks[g++],_=this.serializeMark(b,c.isInline,n);_&&(a.push([b,o]),o.appendChild(_.dom),o=_.contentDOM||_.dom)}}o.appendChild(this.serializeNodeInner(c,n))}),s}serializeNodeInner(t,n){let{dom:s,contentDOM:o}=renderSpec(doc$1(n),this.nodes[t.type.name](t),null,t.attrs);if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,n,o)}return s}serializeNode(t,n={}){let s=this.serializeNodeInner(t,n);for(let o=t.marks.length-1;o>=0;o--){let a=this.serializeMark(t.marks[o],t.isInline,n);a&&((a.contentDOM||a.dom).appendChild(s),s=a.dom)}return s}serializeMark(t,n,s={}){let o=this.marks[t.type.name];return o&&renderSpec(doc$1(s),o(t,n),null,t.attrs)}static renderSpec(t,n,s=null,o){return renderSpec(t,n,s,o)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let n=gatherToDOM(t.nodes);return n.text||(n.text=s=>s.text),n}static marksFromSchema(t){return gatherToDOM(t.marks)}}function gatherToDOM(r){let t={};for(let n in r){let s=r[n].spec.toDOM;s&&(t[n]=s)}return t}function doc$1(r){return r.document||window.document}const suspiciousAttributeCache=new WeakMap;function suspiciousAttributes(r){let t=suspiciousAttributeCache.get(r);return t===void 0&&suspiciousAttributeCache.set(r,t=suspiciousAttributesInner(r)),t}function suspiciousAttributesInner(r){let t=null;function n(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")t||(t=[]),t.push(s);else for(let o=0;o<s.length;o++)n(s[o]);else for(let o in s)n(s[o])}return n(r),t}function renderSpec(r,t,n,s){if(typeof t=="string")return{dom:r.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let o=t[0],a;if(typeof o!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(a=suspiciousAttributes(s))&&a.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let c=o.indexOf(" ");c>0&&(n=o.slice(0,c),o=o.slice(c+1));let f,g=n?r.createElementNS(n,o):r.createElement(o),b=t[1],_=1;if(b&&typeof b=="object"&&b.nodeType==null&&!Array.isArray(b)){_=2;for(let L in b)if(b[L]!=null){let q=L.indexOf(" ");q>0?g.setAttributeNS(L.slice(0,q),L.slice(q+1),b[L]):L=="style"&&g.style?g.style.cssText=b[L]:g.setAttribute(L,b[L])}}for(let L=_;L<t.length;L++){let q=t[L];if(q===0){if(L<t.length-1||L>_)throw new RangeError("Content hole must be the only child of its parent node");return{dom:g,contentDOM:g}}else{let{dom:X,contentDOM:te}=renderSpec(r,q,n,s);if(g.appendChild(X),te){if(f)throw new RangeError("Multiple content holes");f=te}}}return{dom:g,contentDOM:f}}const lower16=65535,factor16=Math.pow(2,16);function makeRecover(r,t){return r+t*factor16}function recoverIndex(r){return r&lower16}function recoverOffset(r){return(r-(r&lower16))/factor16}const DEL_BEFORE=1,DEL_AFTER=2,DEL_ACROSS=4,DEL_SIDE=8;class MapResult{constructor(t,n,s){this.pos=t,this.delInfo=n,this.recover=s}get deleted(){return(this.delInfo&DEL_SIDE)>0}get deletedBefore(){return(this.delInfo&(DEL_BEFORE|DEL_ACROSS))>0}get deletedAfter(){return(this.delInfo&(DEL_AFTER|DEL_ACROSS))>0}get deletedAcross(){return(this.delInfo&DEL_ACROSS)>0}}class StepMap{constructor(t,n=!1){if(this.ranges=t,this.inverted=n,!t.length&&StepMap.empty)return StepMap.empty}recover(t){let n=0,s=recoverIndex(t);if(!this.inverted)for(let o=0;o<s;o++)n+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[s*3]+n+recoverOffset(t)}mapResult(t,n=1){return this._map(t,n,!1)}map(t,n=1){return this._map(t,n,!0)}_map(t,n,s){let o=0,a=this.inverted?2:1,c=this.inverted?1:2;for(let f=0;f<this.ranges.length;f+=3){let g=this.ranges[f]-(this.inverted?o:0);if(g>t)break;let b=this.ranges[f+a],_=this.ranges[f+c],L=g+b;if(t<=L){let q=b?t==g?-1:t==L?1:n:n,X=g+o+(q<0?0:_);if(s)return X;let te=t==(n<0?g:L)?null:makeRecover(f/3,t-g),ne=t==g?DEL_AFTER:t==L?DEL_BEFORE:DEL_ACROSS;return(n<0?t!=g:t!=L)&&(ne|=DEL_SIDE),new MapResult(X,ne,te)}o+=_-b}return s?t+o:new MapResult(t+o,0,null)}touches(t,n){let s=0,o=recoverIndex(n),a=this.inverted?2:1,c=this.inverted?1:2;for(let f=0;f<this.ranges.length;f+=3){let g=this.ranges[f]-(this.inverted?s:0);if(g>t)break;let b=this.ranges[f+a],_=g+b;if(t<=_&&f==o*3)return!0;s+=this.ranges[f+c]-b}return!1}forEach(t){let n=this.inverted?2:1,s=this.inverted?1:2;for(let o=0,a=0;o<this.ranges.length;o+=3){let c=this.ranges[o],f=c-(this.inverted?a:0),g=c+(this.inverted?0:a),b=this.ranges[o+n],_=this.ranges[o+s];t(f,f+b,g,g+_),a+=_-b}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?StepMap.empty:new StepMap(t<0?[0,-t,0]:[0,0,t])}}StepMap.empty=new StepMap([]);class Mapping{constructor(t,n,s=0,o=t?t.length:0){this.mirror=n,this.from=s,this.to=o,this._maps=t||[],this.ownData=!(t||n)}get maps(){return this._maps}slice(t=0,n=this.maps.length){return new Mapping(this._maps,this.mirror,t,n)}appendMap(t,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(t){for(let n=0,s=this._maps.length;n<t._maps.length;n++){let o=t.getMirror(n);this.appendMap(t._maps[n],o!=null&&o<n?s+o:void 0)}}getMirror(t){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==t)return this.mirror[n+(n%2?-1:1)]}}setMirror(t,n){this.mirror||(this.mirror=[]),this.mirror.push(t,n)}appendMappingInverted(t){for(let n=t.maps.length-1,s=this._maps.length+t._maps.length;n>=0;n--){let o=t.getMirror(n);this.appendMap(t._maps[n].invert(),o!=null&&o>n?s-o-1:void 0)}}invert(){let t=new Mapping;return t.appendMappingInverted(this),t}map(t,n=1){if(this.mirror)return this._map(t,n,!0);for(let s=this.from;s<this.to;s++)t=this._maps[s].map(t,n);return t}mapResult(t,n=1){return this._map(t,n,!1)}_map(t,n,s){let o=0;for(let a=this.from;a<this.to;a++){let c=this._maps[a],f=c.mapResult(t,n);if(f.recover!=null){let g=this.getMirror(a);if(g!=null&&g>a&&g<this.to){a=g,t=this._maps[g].recover(f.recover);continue}}o|=f.delInfo,t=f.pos}return s?t:new MapResult(t,o,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(t){return null}static fromJSON(t,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=stepsByID[n.stepType];if(!s)throw new RangeError(`No step type ${n.stepType} defined`);return s.fromJSON(t,n)}static jsonID(t,n){if(t in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+t);return stepsByID[t]=n,n.prototype.jsonID=t,n}}class StepResult{constructor(t,n){this.doc=t,this.failed=n}static ok(t){return new StepResult(t,null)}static fail(t){return new StepResult(null,t)}static fromReplace(t,n,s,o){try{return StepResult.ok(t.replace(n,s,o))}catch(a){if(a instanceof ReplaceError)return StepResult.fail(a.message);throw a}}}function mapFragment(r,t,n){let s=[];for(let o=0;o<r.childCount;o++){let a=r.child(o);a.content.size&&(a=a.copy(mapFragment(a.content,t,a))),a.isInline&&(a=t(a,n,o)),s.push(a)}return Fragment.fromArray(s)}class AddMarkStep extends Step{constructor(t,n,s){super(),this.from=t,this.to=n,this.mark=s}apply(t){let n=t.slice(this.from,this.to),s=t.resolve(this.from),o=s.node(s.sharedDepth(this.to)),a=new Slice(mapFragment(n.content,(c,f)=>!c.isAtom||!f.type.allowsMarkType(this.mark.type)?c:c.mark(this.mark.addToSet(c.marks)),o),n.openStart,n.openEnd);return StepResult.fromReplace(t,this.from,this.to,a)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new AddMarkStep(n.pos,s.pos,this.mark)}merge(t){return t instanceof AddMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new AddMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(n.from,n.to,t.markFromJSON(n.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(t,n,s){super(),this.from=t,this.to=n,this.mark=s}apply(t){let n=t.slice(this.from,this.to),s=new Slice(mapFragment(n.content,o=>o.mark(this.mark.removeFromSet(o.marks)),t),n.openStart,n.openEnd);return StepResult.fromReplace(t,this.from,this.to,s)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new RemoveMarkStep(n.pos,s.pos,this.mark)}merge(t){return t instanceof RemoveMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new RemoveMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(n.from,n.to,t.markFromJSON(n.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(t,n){super(),this.pos=t,this.mark=n}apply(t){let n=t.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return StepResult.fromReplace(t,this.pos,this.pos+1,new Slice(Fragment.from(s),0,n.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);if(n){let s=this.mark.addToSet(n.marks);if(s.length==n.marks.length){for(let o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(s))return new AddNodeMarkStep(this.pos,n.marks[o]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new AddNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(n.pos,t.markFromJSON(n.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(t,n){super(),this.pos=t,this.mark=n}apply(t){let n=t.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return StepResult.fromReplace(t,this.pos,this.pos+1,new Slice(Fragment.from(s),0,n.isLeaf?0:1))}invert(t){let n=t.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new AddNodeMarkStep(this.pos,this.mark)}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new RemoveNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(n.pos,t.markFromJSON(n.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(t,n,s,o=!1){super(),this.from=t,this.to=n,this.slice=s,this.structure=o}apply(t){return this.structure&&contentBetween(t,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(t){return new ReplaceStep(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new ReplaceStep(n.pos,Math.max(n.pos,s.pos),this.slice,this.structure)}merge(t){if(!(t instanceof ReplaceStep)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let n=this.slice.size+t.slice.size==0?Slice.empty:new Slice(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ReplaceStep(this.from,this.to+(t.to-t.from),n,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let n=this.slice.size+t.slice.size==0?Slice.empty:new Slice(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ReplaceStep(t.from,this.to,n,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(n.from,n.to,Slice.fromJSON(t,n.slice),!!n.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(t,n,s,o,a,c,f=!1){super(),this.from=t,this.to=n,this.gapFrom=s,this.gapTo=o,this.slice=a,this.insert=c,this.structure=f}apply(t){if(this.structure&&(contentBetween(t,this.from,this.gapFrom)||contentBetween(t,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let n=t.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return StepResult.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,n.content);return s?StepResult.fromReplace(t,this.from,this.to,s):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let n=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let n=t.mapResult(this.from,1),s=t.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),a=this.to==this.gapTo?s.pos:t.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||o<n.pos||a>s.pos?null:new ReplaceAroundStep(n.pos,s.pos,o,a,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(n.from,n.to,n.gapFrom,n.gapTo,Slice.fromJSON(t,n.slice),n.insert,!!n.structure)}}Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(r,t,n){let s=r.resolve(t),o=n-t,a=s.depth;for(;o>0&&a>0&&s.indexAfter(a)==s.node(a).childCount;)a--,o--;if(o>0){let c=s.node(a).maybeChild(s.indexAfter(a));for(;o>0;){if(!c||c.isLeaf)return!0;c=c.firstChild,o--}}return!1}function addMark(r,t,n,s){let o=[],a=[],c,f;r.doc.nodesBetween(t,n,(g,b,_)=>{if(!g.isInline)return;let L=g.marks;if(!s.isInSet(L)&&_.type.allowsMarkType(s.type)){let q=Math.max(b,t),X=Math.min(b+g.nodeSize,n),te=s.addToSet(L);for(let ne=0;ne<L.length;ne++)L[ne].isInSet(te)||(c&&c.to==q&&c.mark.eq(L[ne])?c.to=X:o.push(c=new RemoveMarkStep(q,X,L[ne])));f&&f.to==q?f.to=X:a.push(f=new AddMarkStep(q,X,s))}}),o.forEach(g=>r.step(g)),a.forEach(g=>r.step(g))}function removeMark(r,t,n,s){let o=[],a=0;r.doc.nodesBetween(t,n,(c,f)=>{if(!c.isInline)return;a++;let g=null;if(s instanceof MarkType){let b=c.marks,_;for(;_=s.isInSet(b);)(g||(g=[])).push(_),b=_.removeFromSet(b)}else s?s.isInSet(c.marks)&&(g=[s]):g=c.marks;if(g&&g.length){let b=Math.min(f+c.nodeSize,n);for(let _=0;_<g.length;_++){let L=g[_],q;for(let X=0;X<o.length;X++){let te=o[X];te.step==a-1&&L.eq(o[X].style)&&(q=te)}q?(q.to=b,q.step=a):o.push({style:L,from:Math.max(f,t),to:b,step:a})}}}),o.forEach(c=>r.step(new RemoveMarkStep(c.from,c.to,c.style)))}function clearIncompatible(r,t,n,s=n.contentMatch,o=!0){let a=r.doc.nodeAt(t),c=[],f=t+1;for(let g=0;g<a.childCount;g++){let b=a.child(g),_=f+b.nodeSize,L=s.matchType(b.type);if(!L)c.push(new ReplaceStep(f,_,Slice.empty));else{s=L;for(let q=0;q<b.marks.length;q++)n.allowsMarkType(b.marks[q].type)||r.step(new RemoveMarkStep(f,_,b.marks[q]));if(o&&b.isText&&n.whitespace!="pre"){let q,X=/\r?\n|\r/g,te;for(;q=X.exec(b.text);)te||(te=new Slice(Fragment.from(n.schema.text(" ",n.allowedMarks(b.marks))),0,0)),c.push(new ReplaceStep(f+q.index,f+q.index+q[0].length,te))}}f=_}if(!s.validEnd){let g=s.fillBefore(Fragment.empty,!0);r.replace(f,f,new Slice(g,0,0))}for(let g=c.length-1;g>=0;g--)r.step(c[g])}function canCut(r,t,n){return(t==0||r.canReplace(t,r.childCount))&&(n==r.childCount||r.canReplace(0,n))}function liftTarget(r){let n=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let s=r.depth;;--s){let o=r.$from.node(s),a=r.$from.index(s),c=r.$to.indexAfter(s);if(s<r.depth&&o.canReplace(a,c,n))return s;if(s==0||o.type.spec.isolating||!canCut(o,a,c))break}return null}function lift$2(r,t,n){let{$from:s,$to:o,depth:a}=t,c=s.before(a+1),f=o.after(a+1),g=c,b=f,_=Fragment.empty,L=0;for(let te=a,ne=!1;te>n;te--)ne||s.index(te)>0?(ne=!0,_=Fragment.from(s.node(te).copy(_)),L++):g--;let q=Fragment.empty,X=0;for(let te=a,ne=!1;te>n;te--)ne||o.after(te+1)<o.end(te)?(ne=!0,q=Fragment.from(o.node(te).copy(q)),X++):b++;r.step(new ReplaceAroundStep(g,b,c,f,new Slice(_.append(q),L,X),_.size-L,!0))}function findWrapping(r,t,n=null,s=r){let o=findWrappingOutside(r,t),a=o&&findWrappingInside(s,t);return a?o.map(withAttrs).concat({type:t,attrs:n}).concat(a.map(withAttrs)):null}function withAttrs(r){return{type:r,attrs:null}}function findWrappingOutside(r,t){let{parent:n,startIndex:s,endIndex:o}=r,a=n.contentMatchAt(s).findWrapping(t);if(!a)return null;let c=a.length?a[0]:t;return n.canReplaceWith(s,o,c)?a:null}function findWrappingInside(r,t){let{parent:n,startIndex:s,endIndex:o}=r,a=n.child(s),c=t.contentMatch.findWrapping(a.type);if(!c)return null;let g=(c.length?c[c.length-1]:t).contentMatch;for(let b=s;g&&b<o;b++)g=g.matchType(n.child(b).type);return!g||!g.validEnd?null:c}function wrap(r,t,n){let s=Fragment.empty;for(let c=n.length-1;c>=0;c--){if(s.size){let f=n[c].type.contentMatch.matchFragment(s);if(!f||!f.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Fragment.from(n[c].type.create(n[c].attrs,s))}let o=t.start,a=t.end;r.step(new ReplaceAroundStep(o,a,o,a,new Slice(s,0,0),n.length,!0))}function setBlockType$1(r,t,n,s,o){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=r.steps.length;r.doc.nodesBetween(t,n,(c,f)=>{let g=typeof o=="function"?o(c):o;if(c.isTextblock&&!c.hasMarkup(s,g)&&canChangeType(r.doc,r.mapping.slice(a).map(f),s)){let b=null;if(s.schema.linebreakReplacement){let X=s.whitespace=="pre",te=!!s.contentMatch.matchType(s.schema.linebreakReplacement);X&&!te?b=!1:!X&&te&&(b=!0)}b===!1&&replaceLinebreaks(r,c,f,a),clearIncompatible(r,r.mapping.slice(a).map(f,1),s,void 0,b===null);let _=r.mapping.slice(a),L=_.map(f,1),q=_.map(f+c.nodeSize,1);return r.step(new ReplaceAroundStep(L,q,L+1,q-1,new Slice(Fragment.from(s.create(g,null,c.marks)),0,0),1,!0)),b===!0&&replaceNewlines(r,c,f,a),!1}})}function replaceNewlines(r,t,n,s){t.forEach((o,a)=>{if(o.isText){let c,f=/\r?\n|\r/g;for(;c=f.exec(o.text);){let g=r.mapping.slice(s).map(n+1+a+c.index);r.replaceWith(g,g+1,t.type.schema.linebreakReplacement.create())}}})}function replaceLinebreaks(r,t,n,s){t.forEach((o,a)=>{if(o.type==o.type.schema.linebreakReplacement){let c=r.mapping.slice(s).map(n+1+a);r.replaceWith(c,c+1,t.type.schema.text(`
`))}})}function canChangeType(r,t,n){let s=r.resolve(t),o=s.index();return s.parent.canReplaceWith(o,o+1,n)}function setNodeMarkup(r,t,n,s,o){let a=r.doc.nodeAt(t);if(!a)throw new RangeError("No node at given position");n||(n=a.type);let c=n.create(s,null,o||a.marks);if(a.isLeaf)return r.replaceWith(t,t+a.nodeSize,c);if(!n.validContent(a.content))throw new RangeError("Invalid content for node type "+n.name);r.step(new ReplaceAroundStep(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new Slice(Fragment.from(c),0,0),1,!0))}function canSplit(r,t,n=1,s){let o=r.resolve(t),a=o.depth-n,c=s&&s[s.length-1]||o.parent;if(a<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!c.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let b=o.depth-1,_=n-2;b>a;b--,_--){let L=o.node(b),q=o.index(b);if(L.type.spec.isolating)return!1;let X=L.content.cutByIndex(q,L.childCount),te=s&&s[_+1];te&&(X=X.replaceChild(0,te.type.create(te.attrs)));let ne=s&&s[_]||L;if(!L.canReplace(q+1,L.childCount)||!ne.type.validContent(X))return!1}let f=o.indexAfter(a),g=s&&s[0];return o.node(a).canReplaceWith(f,f,g?g.type:o.node(a+1).type)}function split$1(r,t,n=1,s){let o=r.doc.resolve(t),a=Fragment.empty,c=Fragment.empty;for(let f=o.depth,g=o.depth-n,b=n-1;f>g;f--,b--){a=Fragment.from(o.node(f).copy(a));let _=s&&s[b];c=Fragment.from(_?_.type.create(_.attrs,c):o.node(f).copy(c))}r.step(new ReplaceStep(t,t,new Slice(a.append(c),n,n),!0))}function canJoin(r,t){let n=r.resolve(t),s=n.index();return joinable(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function canAppendWithSubstitutedLinebreaks(r,t){t.content.size||r.type.compatibleContent(t.type);let n=r.contentMatchAt(r.childCount),{linebreakReplacement:s}=r.type.schema;for(let o=0;o<t.childCount;o++){let a=t.child(o),c=a.type==s?r.type.schema.nodes.text:a.type;if(n=n.matchType(c),!n||!r.type.allowsMarks(a.marks))return!1}return n.validEnd}function joinable(r,t){return!!(r&&t&&!r.isLeaf&&canAppendWithSubstitutedLinebreaks(r,t))}function joinPoint(r,t,n=-1){let s=r.resolve(t);for(let o=s.depth;;o--){let a,c,f=s.index(o);if(o==s.depth?(a=s.nodeBefore,c=s.nodeAfter):n>0?(a=s.node(o+1),f++,c=s.node(o).maybeChild(f)):(a=s.node(o).maybeChild(f-1),c=s.node(o+1)),a&&!a.isTextblock&&joinable(a,c)&&s.node(o).canReplace(f,f+1))return t;if(o==0)break;t=n<0?s.before(o):s.after(o)}}function join(r,t,n){let s=null,{linebreakReplacement:o}=r.doc.type.schema,a=r.doc.resolve(t-n),c=a.node().type;if(o&&c.inlineContent){let _=c.whitespace=="pre",L=!!c.contentMatch.matchType(o);_&&!L?s=!1:!_&&L&&(s=!0)}let f=r.steps.length;if(s===!1){let _=r.doc.resolve(t+n);replaceLinebreaks(r,_.node(),_.before(),f)}c.inlineContent&&clearIncompatible(r,t+n-1,c,a.node().contentMatchAt(a.index()),s==null);let g=r.mapping.slice(f),b=g.map(t-n);if(r.step(new ReplaceStep(b,g.map(t+n,-1),Slice.empty,!0)),s===!0){let _=r.doc.resolve(b);replaceNewlines(r,_.node(),_.before(),r.steps.length)}return r}function insertPoint(r,t,n){let s=r.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(s.parentOffset==0)for(let o=s.depth-1;o>=0;o--){let a=s.index(o);if(s.node(o).canReplaceWith(a,a,n))return s.before(o+1);if(a>0)return null}if(s.parentOffset==s.parent.content.size)for(let o=s.depth-1;o>=0;o--){let a=s.indexAfter(o);if(s.node(o).canReplaceWith(a,a,n))return s.after(o+1);if(a<s.node(o).childCount)return null}return null}function dropPoint(r,t,n){let s=r.resolve(t);if(!n.content.size)return t;let o=n.content;for(let a=0;a<n.openStart;a++)o=o.firstChild.content;for(let a=1;a<=(n.openStart==0&&n.size?2:1);a++)for(let c=s.depth;c>=0;c--){let f=c==s.depth?0:s.pos<=(s.start(c+1)+s.end(c+1))/2?-1:1,g=s.index(c)+(f>0?1:0),b=s.node(c),_=!1;if(a==1)_=b.canReplace(g,g,o);else{let L=b.contentMatchAt(g).findWrapping(o.firstChild.type);_=L&&b.canReplaceWith(g,g,L[0])}if(_)return f==0?s.pos:f<0?s.before(c+1):s.after(c+1)}return null}function replaceStep(r,t,n=t,s=Slice.empty){if(t==n&&!s.size)return null;let o=r.resolve(t),a=r.resolve(n);return fitsTrivially(o,a,s)?new ReplaceStep(t,n,s):new Fitter(o,a,s).fit()}function fitsTrivially(r,t,n){return!n.openStart&&!n.openEnd&&r.start()==t.start()&&r.parent.canReplace(r.index(),t.index(),n.content)}class Fitter{constructor(t,n,s){this.$from=t,this.$to=n,this.unplaced=s,this.frontier=[],this.placed=Fragment.empty;for(let o=0;o<=t.depth;o++){let a=t.node(o);this.frontier.push({type:a.type,match:a.contentMatchAt(t.indexAfter(o))})}for(let o=t.depth;o>0;o--)this.placed=Fragment.from(t.node(o).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let b=this.findFittable();b?this.placeNodes(b):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,s=this.$from,o=this.close(t<0?this.$to:s.doc.resolve(t));if(!o)return null;let a=this.placed,c=s.depth,f=o.depth;for(;c&&f&&a.childCount==1;)a=a.firstChild.content,c--,f--;let g=new Slice(a,c,f);return t>-1?new ReplaceAroundStep(s.pos,t,this.$to.pos,this.$to.end(),g,n):g.size||s.pos!=this.$to.pos?new ReplaceStep(s.pos,o.pos,g):null}findFittable(){let t=this.unplaced.openStart;for(let n=this.unplaced.content,s=0,o=this.unplaced.openEnd;s<t;s++){let a=n.firstChild;if(n.childCount>1&&(o=0),a.type.spec.isolating&&o<=s){t=s;break}n=a.content}for(let n=1;n<=2;n++)for(let s=n==1?t:this.unplaced.openStart;s>=0;s--){let o,a=null;s?(a=contentAt(this.unplaced.content,s-1).firstChild,o=a.content):o=this.unplaced.content;let c=o.firstChild;for(let f=this.depth;f>=0;f--){let{type:g,match:b}=this.frontier[f],_,L=null;if(n==1&&(c?b.matchType(c.type)||(L=b.fillBefore(Fragment.from(c),!1)):a&&g.compatibleContent(a.type)))return{sliceDepth:s,frontierDepth:f,parent:a,inject:L};if(n==2&&c&&(_=b.findWrapping(c.type)))return{sliceDepth:s,frontierDepth:f,parent:a,wrap:_};if(a&&b.matchType(a.type))break}}}openMore(){let{content:t,openStart:n,openEnd:s}=this.unplaced,o=contentAt(t,n);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new Slice(t,n+1,Math.max(s,o.size+n>=t.size-s?n+1:0)),!0)}dropNode(){let{content:t,openStart:n,openEnd:s}=this.unplaced,o=contentAt(t,n);if(o.childCount<=1&&n>0){let a=t.size-n<=n+o.size;this.unplaced=new Slice(dropFromFragment(t,n-1,1),n-1,a?n-1:s)}else this.unplaced=new Slice(dropFromFragment(t,n,1),n,s)}placeNodes({sliceDepth:t,frontierDepth:n,parent:s,inject:o,wrap:a}){for(;this.depth>n;)this.closeFrontierNode();if(a)for(let ne=0;ne<a.length;ne++)this.openFrontierNode(a[ne]);let c=this.unplaced,f=s?s.content:c.content,g=c.openStart-t,b=0,_=[],{match:L,type:q}=this.frontier[n];if(o){for(let ne=0;ne<o.childCount;ne++)_.push(o.child(ne));L=L.matchFragment(o)}let X=f.size+t-(c.content.size-c.openEnd);for(;b<f.childCount;){let ne=f.child(b),Ce=L.matchType(ne.type);if(!Ce)break;b++,(b>1||g==0||ne.content.size)&&(L=Ce,_.push(closeNodeStart(ne.mark(q.allowedMarks(ne.marks)),b==1?g:0,b==f.childCount?X:-1)))}let te=b==f.childCount;te||(X=-1),this.placed=addToFragment(this.placed,n,Fragment.from(_)),this.frontier[n].match=L,te&&X<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let ne=0,Ce=f;ne<X;ne++){let Le=Ce.lastChild;this.frontier.push({type:Le.type,match:Le.contentMatchAt(Le.childCount)}),Ce=Le.content}this.unplaced=te?t==0?Slice.empty:new Slice(dropFromFragment(c.content,t-1,1),t-1,X<0?c.openEnd:t-1):new Slice(dropFromFragment(c.content,t,b),c.openStart,c.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],n;if(!t.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:s}=this.$to,o=this.$to.after(s);for(;s>1&&o==this.$to.end(--s);)++o;return o}findCloseLevel(t){e:for(let n=Math.min(this.depth,t.depth);n>=0;n--){let{match:s,type:o}=this.frontier[n],a=n<t.depth&&t.end(n+1)==t.pos+(t.depth-(n+1)),c=contentAfterFits(t,n,o,s,a);if(c){for(let f=n-1;f>=0;f--){let{match:g,type:b}=this.frontier[f],_=contentAfterFits(t,f,b,g,!0);if(!_||_.childCount)continue e}return{depth:n,fit:c,move:a?t.doc.resolve(t.after(n+1)):t}}}}close(t){let n=this.findCloseLevel(t);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=addToFragment(this.placed,n.depth,n.fit)),t=n.move;for(let s=n.depth+1;s<=t.depth;s++){let o=t.node(s),a=o.type.contentMatch.fillBefore(o.content,!0,t.index(s));this.openFrontierNode(o.type,o.attrs,a)}return t}openFrontierNode(t,n=null,s){let o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=addToFragment(this.placed,this.depth,Fragment.from(t.create(n,s))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Fragment.empty,!0);n.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,n))}}function dropFromFragment(r,t,n){return t==0?r.cutByIndex(n,r.childCount):r.replaceChild(0,r.firstChild.copy(dropFromFragment(r.firstChild.content,t-1,n)))}function addToFragment(r,t,n){return t==0?r.append(n):r.replaceChild(r.childCount-1,r.lastChild.copy(addToFragment(r.lastChild.content,t-1,n)))}function contentAt(r,t){for(let n=0;n<t;n++)r=r.firstChild.content;return r}function closeNodeStart(r,t,n){if(t<=0)return r;let s=r.content;return t>1&&(s=s.replaceChild(0,closeNodeStart(s.firstChild,t-1,s.childCount==1?n-1:0))),t>0&&(s=r.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(r.type.contentMatch.matchFragment(s).fillBefore(Fragment.empty,!0)))),r.copy(s)}function contentAfterFits(r,t,n,s,o){let a=r.node(t),c=o?r.indexAfter(t):r.index(t);if(c==a.childCount&&!n.compatibleContent(a.type))return null;let f=s.fillBefore(a.content,!0,c);return f&&!invalidMarks(n,a.content,c)?f:null}function invalidMarks(r,t,n){for(let s=n;s<t.childCount;s++)if(!r.allowsMarks(t.child(s).marks))return!0;return!1}function definesContent(r){return r.spec.defining||r.spec.definingForContent}function replaceRange(r,t,n,s){if(!s.size)return r.deleteRange(t,n);let o=r.doc.resolve(t),a=r.doc.resolve(n);if(fitsTrivially(o,a,s))return r.step(new ReplaceStep(t,n,s));let c=coveredDepths(o,r.doc.resolve(n));c[c.length-1]==0&&c.pop();let f=-(o.depth+1);c.unshift(f);for(let q=o.depth,X=o.pos-1;q>0;q--,X--){let te=o.node(q).type.spec;if(te.defining||te.definingAsContext||te.isolating)break;c.indexOf(q)>-1?f=q:o.before(q)==X&&c.splice(1,0,-q)}let g=c.indexOf(f),b=[],_=s.openStart;for(let q=s.content,X=0;;X++){let te=q.firstChild;if(b.push(te),X==s.openStart)break;q=te.content}for(let q=_-1;q>=0;q--){let X=b[q],te=definesContent(X.type);if(te&&!X.sameMarkup(o.node(Math.abs(f)-1)))_=q;else if(te||!X.type.isTextblock)break}for(let q=s.openStart;q>=0;q--){let X=(q+_+1)%(s.openStart+1),te=b[X];if(te)for(let ne=0;ne<c.length;ne++){let Ce=c[(ne+g)%c.length],Le=!0;Ce<0&&(Le=!1,Ce=-Ce);let Ge=o.node(Ce-1),ze=o.index(Ce-1);if(Ge.canReplaceWith(ze,ze,te.type,te.marks))return r.replace(o.before(Ce),Le?a.after(Ce):n,new Slice(closeFragment(s.content,0,s.openStart,X),X,s.openEnd))}}let L=r.steps.length;for(let q=c.length-1;q>=0&&(r.replace(t,n,s),!(r.steps.length>L));q--){let X=c[q];X<0||(t=o.before(X),n=a.after(X))}}function closeFragment(r,t,n,s,o){if(t<n){let a=r.firstChild;r=r.replaceChild(0,a.copy(closeFragment(a.content,t+1,n,s,a)))}if(t>s){let a=o.contentMatchAt(0),c=a.fillBefore(r).append(r);r=c.append(a.matchFragment(c).fillBefore(Fragment.empty,!0))}return r}function replaceRangeWith(r,t,n,s){if(!s.isInline&&t==n&&r.doc.resolve(t).parent.content.size){let o=insertPoint(r.doc,t,s.type);o!=null&&(t=n=o)}r.replaceRange(t,n,new Slice(Fragment.from(s),0,0))}function deleteRange$1(r,t,n){let s=r.doc.resolve(t),o=r.doc.resolve(n),a=coveredDepths(s,o);for(let c=0;c<a.length;c++){let f=a[c],g=c==a.length-1;if(g&&f==0||s.node(f).type.contentMatch.validEnd)return r.delete(s.start(f),o.end(f));if(f>0&&(g||s.node(f-1).canReplace(s.index(f-1),o.indexAfter(f-1))))return r.delete(s.before(f),o.after(f))}for(let c=1;c<=s.depth&&c<=o.depth;c++)if(t-s.start(c)==s.depth-c&&n>s.end(c)&&o.end(c)-n!=o.depth-c&&s.start(c-1)==o.start(c-1)&&s.node(c-1).canReplace(s.index(c-1),o.index(c-1)))return r.delete(s.before(c),n);r.delete(t,n)}function coveredDepths(r,t){let n=[],s=Math.min(r.depth,t.depth);for(let o=s;o>=0;o--){let a=r.start(o);if(a<r.pos-(r.depth-o)||t.end(o)>t.pos+(t.depth-o)||r.node(o).type.spec.isolating||t.node(o).type.spec.isolating)break;(a==t.start(o)||o==r.depth&&o==t.depth&&r.parent.inlineContent&&t.parent.inlineContent&&o&&t.start(o-1)==a-1)&&n.push(o)}return n}class AttrStep extends Step{constructor(t,n,s){super(),this.pos=t,this.attr=n,this.value=s}apply(t){let n=t.nodeAt(this.pos);if(!n)return StepResult.fail("No node at attribute step's position");let s=Object.create(null);for(let a in n.attrs)s[a]=n.attrs[a];s[this.attr]=this.value;let o=n.type.create(s,null,n.marks);return StepResult.fromReplace(t,this.pos,this.pos+1,new Slice(Fragment.from(o),0,n.isLeaf?0:1))}getMap(){return StepMap.empty}invert(t){return new AttrStep(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let n=t.mapResult(this.pos,1);return n.deletedAfter?null:new AttrStep(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(n.pos,n.attr,n.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(t,n){super(),this.attr=t,this.value=n}apply(t){let n=Object.create(null);for(let o in t.attrs)n[o]=t.attrs[o];n[this.attr]=this.value;let s=t.type.create(n,t.content,t.marks);return StepResult.ok(s)}getMap(){return StepMap.empty}invert(t){return new DocAttrStep(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(n.attr,n.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function r(t){let n=Error.call(this,t);return n.__proto__=r.prototype,n};TransformError.prototype=Object.create(Error.prototype);TransformError.prototype.constructor=TransformError;TransformError.prototype.name="TransformError";class Transform{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let n=this.maybeStep(t);if(n.failed)throw new TransformError(n.failed);return this}maybeStep(t){let n=t.apply(this.doc);return n.failed||this.addStep(t,n.doc),n}get docChanged(){return this.steps.length>0}addStep(t,n){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=n}replace(t,n=t,s=Slice.empty){let o=replaceStep(this.doc,t,n,s);return o&&this.step(o),this}replaceWith(t,n,s){return this.replace(t,n,new Slice(Fragment.from(s),0,0))}delete(t,n){return this.replace(t,n,Slice.empty)}insert(t,n){return this.replaceWith(t,t,n)}replaceRange(t,n,s){return replaceRange(this,t,n,s),this}replaceRangeWith(t,n,s){return replaceRangeWith(this,t,n,s),this}deleteRange(t,n){return deleteRange$1(this,t,n),this}lift(t,n){return lift$2(this,t,n),this}join(t,n=1){return join(this,t,n),this}wrap(t,n){return wrap(this,t,n),this}setBlockType(t,n=t,s,o=null){return setBlockType$1(this,t,n,s,o),this}setNodeMarkup(t,n,s=null,o){return setNodeMarkup(this,t,n,s,o),this}setNodeAttribute(t,n,s){return this.step(new AttrStep(t,n,s)),this}setDocAttribute(t,n){return this.step(new DocAttrStep(t,n)),this}addNodeMark(t,n){return this.step(new AddNodeMarkStep(t,n)),this}removeNodeMark(t,n){let s=this.doc.nodeAt(t);if(!s)throw new RangeError("No node at position "+t);if(n instanceof Mark$1)n.isInSet(s.marks)&&this.step(new RemoveNodeMarkStep(t,n));else{let o=s.marks,a,c=[];for(;a=n.isInSet(o);)c.push(new RemoveNodeMarkStep(t,a)),o=a.removeFromSet(o);for(let f=c.length-1;f>=0;f--)this.step(c[f])}return this}split(t,n=1,s){return split$1(this,t,n,s),this}addMark(t,n,s){return addMark(this,t,n,s),this}removeMark(t,n,s){return removeMark(this,t,n,s),this}clearIncompatible(t,n,s){return clearIncompatible(this,t,n,s),this}}const classesById=Object.create(null);class Selection{constructor(t,n,s){this.$anchor=t,this.$head=n,this.ranges=s||[new SelectionRange(t.min(n),t.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let n=0;n<t.length;n++)if(t[n].$from.pos!=t[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,n=Slice.empty){let s=n.content.lastChild,o=null;for(let f=0;f<n.openEnd;f++)o=s,s=s.lastChild;let a=t.steps.length,c=this.ranges;for(let f=0;f<c.length;f++){let{$from:g,$to:b}=c[f],_=t.mapping.slice(a);t.replaceRange(_.map(g.pos),_.map(b.pos),f?Slice.empty:n),f==0&&selectionToInsertionEnd$1(t,a,(s?s.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(t,n){let s=t.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:c,$to:f}=o[a],g=t.mapping.slice(s),b=g.map(c.pos),_=g.map(f.pos);a?t.deleteRange(b,_):(t.replaceRangeWith(b,_,n),selectionToInsertionEnd$1(t,s,n.isInline?-1:1))}}static findFrom(t,n,s=!1){let o=t.parent.inlineContent?new TextSelection(t):findSelectionIn(t.node(0),t.parent,t.pos,t.index(),n,s);if(o)return o;for(let a=t.depth-1;a>=0;a--){let c=n<0?findSelectionIn(t.node(0),t.node(a),t.before(a+1),t.index(a),n,s):findSelectionIn(t.node(0),t.node(a),t.after(a+1),t.index(a)+1,n,s);if(c)return c}return null}static near(t,n=1){return this.findFrom(t,n)||this.findFrom(t,-n)||new AllSelection(t.node(0))}static atStart(t){return findSelectionIn(t,t,0,0,1)||new AllSelection(t)}static atEnd(t){return findSelectionIn(t,t,t.content.size,t.childCount,-1)||new AllSelection(t)}static fromJSON(t,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=classesById[n.type];if(!s)throw new RangeError(`No selection type ${n.type} defined`);return s.fromJSON(t,n)}static jsonID(t,n){if(t in classesById)throw new RangeError("Duplicate use of selection JSON ID "+t);return classesById[t]=n,n.prototype.jsonID=t,n}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;class SelectionRange{constructor(t,n){this.$from=t,this.$to=n}}let warnedAboutTextSelection=!1;function checkTextSelection(r){!warnedAboutTextSelection&&!r.parent.inlineContent&&(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class TextSelection extends Selection{constructor(t,n=t){checkTextSelection(t),checkTextSelection(n),super(t,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,n){let s=t.resolve(n.map(this.head));if(!s.parent.inlineContent)return Selection.near(s);let o=t.resolve(n.map(this.anchor));return new TextSelection(o.parent.inlineContent?o:s,s)}replace(t,n=Slice.empty){if(super.replace(t,n),n==Slice.empty){let s=this.$from.marksAcross(this.$to);s&&t.ensureMarks(s)}}eq(t){return t instanceof TextSelection&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,s=n){let o=t.resolve(n);return new this(o,s==n?o:t.resolve(s))}static between(t,n,s){let o=t.pos-n.pos;if((!s||o)&&(s=o>=0?1:-1),!n.parent.inlineContent){let a=Selection.findFrom(n,s,!0)||Selection.findFrom(n,-s,!0);if(a)n=a.$head;else return Selection.near(n,s)}return t.parent.inlineContent||(o==0?t=n:(t=(Selection.findFrom(t,-s,!0)||Selection.findFrom(t,s,!0)).$anchor,t.pos<n.pos!=o<0&&(t=n))),new TextSelection(t,n)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(t,n){this.anchor=t,this.head=n}map(t){return new TextBookmark(t.map(this.anchor),t.map(this.head))}resolve(t){return TextSelection.between(t.resolve(this.anchor),t.resolve(this.head))}}class NodeSelection extends Selection{constructor(t){let n=t.nodeAfter,s=t.node(0).resolve(t.pos+n.nodeSize);super(t,s),this.node=n}map(t,n){let{deleted:s,pos:o}=n.mapResult(this.anchor),a=t.resolve(o);return s?Selection.near(a):new NodeSelection(a)}content(){return new Slice(Fragment.from(this.node),0,0)}eq(t){return t instanceof NodeSelection&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(t,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(t.resolve(n.anchor))}static create(t,n){return new NodeSelection(t.resolve(n))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}NodeSelection.prototype.visible=!1;Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(t){this.anchor=t}map(t){let{deleted:n,pos:s}=t.mapResult(this.anchor);return n?new TextBookmark(s,s):new NodeBookmark(s)}resolve(t){let n=t.resolve(this.anchor),s=n.nodeAfter;return s&&NodeSelection.isSelectable(s)?new NodeSelection(n):Selection.near(n)}}class AllSelection extends Selection{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,n=Slice.empty){if(n==Slice.empty){t.delete(0,t.doc.content.size);let s=Selection.atStart(t.doc);s.eq(t.selection)||t.setSelection(s)}else super.replace(t,n)}toJSON(){return{type:"all"}}static fromJSON(t){return new AllSelection(t)}map(t){return new AllSelection(t)}eq(t){return t instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve(r){return new AllSelection(r)}};function findSelectionIn(r,t,n,s,o,a=!1){if(t.inlineContent)return TextSelection.create(r,n);for(let c=s-(o>0?0:1);o>0?c<t.childCount:c>=0;c+=o){let f=t.child(c);if(f.isAtom){if(!a&&NodeSelection.isSelectable(f))return NodeSelection.create(r,n-(o<0?f.nodeSize:0))}else{let g=findSelectionIn(r,f,n+o,o<0?f.childCount:0,o,a);if(g)return g}n+=f.nodeSize*o}return null}function selectionToInsertionEnd$1(r,t,n){let s=r.steps.length-1;if(s<t)return;let o=r.steps[s];if(!(o instanceof ReplaceStep||o instanceof ReplaceAroundStep))return;let a=r.mapping.maps[s],c;a.forEach((f,g,b,_)=>{c==null&&(c=_)}),r.setSelection(Selection.near(r.doc.resolve(c),n))}function bind(r,t){return!t||!r?r:r.bind(t)}class FieldDesc{constructor(t,n,s){this.name=t,this.init=bind(n.init,s),this.apply=bind(n.apply,s)}}new FieldDesc("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new FieldDesc("selection",{init(r,t){return r.selection||Selection.atStart(t.doc)},apply(r){return r.selection}}),new FieldDesc("storedMarks",{init(r){return r.storedMarks||null},apply(r,t,n,s){return s.selection.$cursor?r.storedMarks:null}}),new FieldDesc("scrollToSelection",{init(){return 0},apply(r,t){return r.scrolledIntoView?t+1:t}});function bindProps(r,t,n){for(let s in r){let o=r[s];o instanceof Function?o=o.bind(t):s=="handleDOMEvents"&&(o=bindProps(o,t,{})),n[s]=o}return n}class Plugin{constructor(t){this.spec=t,this.props={},t.props&&bindProps(t.props,this,this.props),this.key=t.key?t.key.key:createKey("plugin")}getState(t){return t[this.key]}}const keys=Object.create(null);function createKey(r){return r in keys?r+"$"+ ++keys[r]:(keys[r]=0,r+"$")}class PluginKey{constructor(t="key"){this.key=createKey(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const domIndex=function(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t},isEquivalentPosition=function(r,t,n,s){return n&&(scanFor(r,t,n,s,-1)||scanFor(r,t,n,s,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(r,t,n,s,o){for(var a;;){if(r==n&&t==s)return!0;if(t==(o<0?0:nodeSize(r))){let c=r.parentNode;if(!c||c.nodeType!=1||hasBlockDesc(r)||atomElements.test(r.nodeName)||r.contentEditable=="false")return!1;t=domIndex(r)+(o<0?0:1),r=c}else if(r.nodeType==1){let c=r.childNodes[t+(o<0?-1:0)];if(c.nodeType==1&&c.contentEditable=="false")if(!((a=c.pmViewDesc)===null||a===void 0)&&a.ignoreForSelection)t+=o;else return!1;else r=c,t=o<0?nodeSize(r):0}else return!1}}function nodeSize(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function isOnEdge(r,t,n){for(let s=t==0,o=t==nodeSize(r);s||o;){if(r==n)return!0;let a=domIndex(r);if(r=r.parentNode,!r)return!1;s=s&&a==0,o=o&&a==nodeSize(r)}}function hasBlockDesc(r){let t;for(let n=r;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==r||t.contentDOM==r)}const selectionCollapsed=function(r){return r.focusNode&&isEquivalentPosition(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function keyEvent(r,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=r,n.key=n.code=t,n}const nav=typeof navigator<"u"?navigator:null,doc=typeof document<"u"?document:null,agent=nav&&nav.userAgent||"",ie_edge=/Edge\/(\d+)/.exec(agent),ie_upto10=/MSIE \d/.exec(agent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$1=!!(ie_upto10||ie_11up||ie_edge),ie_version=ie_upto10?document.documentMode:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko=!ie$1&&/gecko\/(\d+)/i.test(agent);gecko&&+(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie$1&&/Chrome\/(\d+)/.exec(agent),chrome=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari=!ie$1&&!!nav&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(agent)||!!nav&&nav.maxTouchPoints>2),mac$2=ios||(nav?/Mac/.test(nav.platform):!1),windows$1=nav?/Win/.test(nav.platform):!1,android=/Android \d/.test(agent),webkit=!!doc&&"webkitFontSmoothing"in doc.documentElement.style,webkit_version=webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function selectionFromDOM(r,t=null){let n=r.domSelectionRange(),s=r.state.doc;if(!n.focusNode)return null;let o=r.docView.nearestDesc(n.focusNode),a=o&&o.size==0,c=r.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(c<0)return null;let f=s.resolve(c),g,b;if(selectionCollapsed(n)){for(g=c;o&&!o.node;)o=o.parent;let L=o.node;if(o&&L.isAtom&&NodeSelection.isSelectable(L)&&o.parent&&!(L.isInline&&isOnEdge(n.focusNode,n.focusOffset,o.dom))){let q=o.posBefore;b=new NodeSelection(c==q?f:s.resolve(q))}}else{if(n instanceof r.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let L=c,q=c;for(let X=0;X<n.rangeCount;X++){let te=n.getRangeAt(X);L=Math.min(L,r.docView.posFromDOM(te.startContainer,te.startOffset,1)),q=Math.max(q,r.docView.posFromDOM(te.endContainer,te.endOffset,-1))}if(L<0)return null;[g,c]=q==r.state.selection.anchor?[q,L]:[L,q],f=s.resolve(c)}else g=r.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(g<0)return null}let _=s.resolve(g);if(!b){let L=t=="pointer"||r.state.selection.head<f.pos&&!a?1:-1;b=selectionBetween(r,_,f,L)}return b}function editorOwnsSelection(r){return r.editable?r.hasFocus():hasSelection(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function selectionToDOM(r,t=!1){let n=r.state.selection;if(syncNodeSelection(r,n),!!editorOwnsSelection(r)){if(!t&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&chrome){let s=r.domSelectionRange(),o=r.domObserver.currentSelection;if(s.anchorNode&&o.anchorNode&&isEquivalentPosition(s.anchorNode,s.anchorOffset,o.anchorNode,o.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)selectCursorWrapper(r);else{let{anchor:s,head:o}=n,a,c;brokenSelectBetweenUneditable&&!(n instanceof TextSelection)&&(n.$from.parent.inlineContent||(a=temporarilyEditableNear(r,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(c=temporarilyEditableNear(r,n.to))),r.docView.setSelection(s,o,r,t),brokenSelectBetweenUneditable&&(a&&resetEditable(a),c&&resetEditable(c)),n.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&removeClassOnSelectionChange(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari||chrome&&chrome_version<63;function temporarilyEditableNear(r,t){let{node:n,offset:s}=r.docView.domFromPos(t,0),o=s<n.childNodes.length?n.childNodes[s]:null,a=s?n.childNodes[s-1]:null;if(safari&&o&&o.contentEditable=="false")return setEditable(o);if((!o||o.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(o)return setEditable(o);if(a)return setEditable(a)}}function setEditable(r){return r.contentEditable="true",safari&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function resetEditable(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function removeClassOnSelectionChange(r){let t=r.dom.ownerDocument;t.removeEventListener("selectionchange",r.input.hideSelectionGuard);let n=r.domSelectionRange(),s=n.anchorNode,o=n.anchorOffset;t.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(n.anchorNode!=s||n.anchorOffset!=o)&&(t.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!editorOwnsSelection(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function selectCursorWrapper(r){let t=r.domSelection();if(!t)return;let n=r.cursorWrapper.dom,s=n.nodeName=="IMG";s?t.collapse(n.parentNode,domIndex(n)+1):t.collapse(n,0),!s&&!r.state.selection.visible&&ie$1&&ie_version<=11&&(n.disabled=!0,n.disabled=!1)}function syncNodeSelection(r,t){if(t instanceof NodeSelection){let n=r.docView.descAt(t.from);n!=r.lastSelectedViewDesc&&(clearNodeSelection(r),n&&n.selectNode(),r.lastSelectedViewDesc=n)}else clearNodeSelection(r)}function clearNodeSelection(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function selectionBetween(r,t,n,s){return r.someProp("createSelectionBetween",o=>o(r,t,n))||TextSelection.between(t,n,s)}function hasSelection(r){let t=r.domSelectionRange();if(!t.anchorNode)return!1;try{return r.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(r.editable||r.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function moveSelectionBlock(r,t){let{$anchor:n,$head:s}=r.selection,o=t>0?n.max(s):n.min(s),a=o.parent.inlineContent?o.depth?r.doc.resolve(t>0?o.after():o.before()):null:o;return a&&Selection.findFrom(a,t)}function apply(r,t){return r.dispatch(r.state.tr.setSelection(t).scrollIntoView()),!0}function selectHorizontally(r,t,n){let s=r.state.selection;if(s instanceof TextSelection)if(n.indexOf("s")>-1){let{$head:o}=s,a=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let c=r.state.doc.resolve(o.pos+a.nodeSize*(t<0?-1:1));return apply(r,new TextSelection(s.$anchor,c))}else if(s.empty){if(r.endOfTextblock(t>0?"forward":"backward")){let o=moveSelectionBlock(r.state,t);return o&&o instanceof NodeSelection?apply(r,o):!1}else if(!(mac$2&&n.indexOf("m")>-1)){let o=s.$head,a=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter,c;if(!a||a.isText)return!1;let f=t<0?o.pos-a.nodeSize:o.pos;return a.isAtom||(c=r.docView.descAt(f))&&!c.contentDOM?NodeSelection.isSelectable(a)?apply(r,new NodeSelection(t<0?r.state.doc.resolve(o.pos-a.nodeSize):o)):webkit?apply(r,new TextSelection(r.state.doc.resolve(t<0?f:f+a.nodeSize))):!1:!1}}else return!1;else{if(s instanceof NodeSelection&&s.node.isInline)return apply(r,new TextSelection(t>0?s.$to:s.$from));{let o=moveSelectionBlock(r.state,t);return o?apply(r,o):!1}}}function nodeLen(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function isIgnorable(r,t){let n=r.pmViewDesc;return n&&n.size==0&&(t<0||r.nextSibling||r.nodeName!="BR")}function skipIgnoredNodes(r,t){return t<0?skipIgnoredNodesBefore(r):skipIgnoredNodesAfter(r)}function skipIgnoredNodesBefore(r){let t=r.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let o,a,c=!1;for(gecko&&n.nodeType==1&&s<nodeLen(n)&&isIgnorable(n.childNodes[s],-1)&&(c=!0);;)if(s>0){if(n.nodeType!=1)break;{let f=n.childNodes[s-1];if(isIgnorable(f,-1))o=n,a=--s;else if(f.nodeType==3)n=f,s=n.nodeValue.length;else break}}else{if(isBlockNode(n))break;{let f=n.previousSibling;for(;f&&isIgnorable(f,-1);)o=n.parentNode,a=domIndex(f),f=f.previousSibling;if(f)n=f,s=nodeLen(n);else{if(n=n.parentNode,n==r.dom)break;s=0}}}c?setSelFocus(r,n,s):o&&setSelFocus(r,o,a)}function skipIgnoredNodesAfter(r){let t=r.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let o=nodeLen(n),a,c;for(;;)if(s<o){if(n.nodeType!=1)break;let f=n.childNodes[s];if(isIgnorable(f,1))a=n,c=++s;else break}else{if(isBlockNode(n))break;{let f=n.nextSibling;for(;f&&isIgnorable(f,1);)a=f.parentNode,c=domIndex(f)+1,f=f.nextSibling;if(f)n=f,s=0,o=nodeLen(n);else{if(n=n.parentNode,n==r.dom)break;s=o=0}}}a&&setSelFocus(r,a,c)}function isBlockNode(r){let t=r.pmViewDesc;return t&&t.node&&t.node.isBlock}function textNodeAfter(r,t){for(;r&&t==r.childNodes.length&&!hasBlockDesc(r);)t=domIndex(r)+1,r=r.parentNode;for(;r&&t<r.childNodes.length;){let n=r.childNodes[t];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;r=n,t=0}}function textNodeBefore(r,t){for(;r&&!t&&!hasBlockDesc(r);)t=domIndex(r),r=r.parentNode;for(;r&&t;){let n=r.childNodes[t-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;r=n,t=r.childNodes.length}}function setSelFocus(r,t,n){if(t.nodeType!=3){let a,c;(c=textNodeAfter(t,n))?(t=c,n=0):(a=textNodeBefore(t,n))&&(t=a,n=a.nodeValue.length)}let s=r.domSelection();if(!s)return;if(selectionCollapsed(s)){let a=document.createRange();a.setEnd(t,n),a.setStart(t,n),s.removeAllRanges(),s.addRange(a)}else s.extend&&s.extend(t,n);r.domObserver.setCurSelection();let{state:o}=r;setTimeout(()=>{r.state==o&&selectionToDOM(r)},50)}function findDirection(r,t){let n=r.state.doc.resolve(t);if(!(chrome||windows$1)&&n.parent.inlineContent){let o=r.coordsAtPos(t);if(t>n.start()){let a=r.coordsAtPos(t-1),c=(a.top+a.bottom)/2;if(c>o.top&&c<o.bottom&&Math.abs(a.left-o.left)>1)return a.left<o.left?"ltr":"rtl"}if(t<n.end()){let a=r.coordsAtPos(t+1),c=(a.top+a.bottom)/2;if(c>o.top&&c<o.bottom&&Math.abs(a.left-o.left)>1)return a.left>o.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function selectVertically(r,t,n){let s=r.state.selection;if(s instanceof TextSelection&&!s.empty||n.indexOf("s")>-1||mac$2&&n.indexOf("m")>-1)return!1;let{$from:o,$to:a}=s;if(!o.parent.inlineContent||r.endOfTextblock(t<0?"up":"down")){let c=moveSelectionBlock(r.state,t);if(c&&c instanceof NodeSelection)return apply(r,c)}if(!o.parent.inlineContent){let c=t<0?o:a,f=s instanceof AllSelection?Selection.near(c,t):Selection.findFrom(c,t);return f?apply(r,f):!1}return!1}function stopNativeHorizontalDelete(r,t){if(!(r.state.selection instanceof TextSelection))return!0;let{$head:n,$anchor:s,empty:o}=r.state.selection;if(!n.sameParent(s))return!0;if(!o)return!1;if(r.endOfTextblock(t>0?"forward":"backward"))return!0;let a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){let c=r.state.tr;return t<0?c.delete(n.pos-a.nodeSize,n.pos):c.delete(n.pos,n.pos+a.nodeSize),r.dispatch(c),!0}return!1}function switchEditable(r,t,n){r.domObserver.stop(),t.contentEditable=n,r.domObserver.start()}function safariDownArrowBug(r){if(!safari||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=r.domSelectionRange();if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let s=t.firstChild;switchEditable(r,s,"true"),setTimeout(()=>switchEditable(r,s,"false"),20)}return!1}function getMods(r){let t="";return r.ctrlKey&&(t+="c"),r.metaKey&&(t+="m"),r.altKey&&(t+="a"),r.shiftKey&&(t+="s"),t}function captureKeyDown(r,t){let n=t.keyCode,s=getMods(t);if(n==8||mac$2&&n==72&&s=="c")return stopNativeHorizontalDelete(r,-1)||skipIgnoredNodes(r,-1);if(n==46&&!t.shiftKey||mac$2&&n==68&&s=="c")return stopNativeHorizontalDelete(r,1)||skipIgnoredNodes(r,1);if(n==13||n==27)return!0;if(n==37||mac$2&&n==66&&s=="c"){let o=n==37?findDirection(r,r.state.selection.from)=="ltr"?-1:1:-1;return selectHorizontally(r,o,s)||skipIgnoredNodes(r,o)}else if(n==39||mac$2&&n==70&&s=="c"){let o=n==39?findDirection(r,r.state.selection.from)=="ltr"?1:-1:1;return selectHorizontally(r,o,s)||skipIgnoredNodes(r,o)}else{if(n==38||mac$2&&n==80&&s=="c")return selectVertically(r,-1,s)||skipIgnoredNodes(r,-1);if(n==40||mac$2&&n==78&&s=="c")return safariDownArrowBug(r)||selectVertically(r,1,s)||skipIgnoredNodes(r,1);if(s==(mac$2?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function serializeForClipboard(r,t){r.someProp("transformCopied",X=>{t=X(t,r)});let n=[],{content:s,openStart:o,openEnd:a}=t;for(;o>1&&a>1&&s.childCount==1&&s.firstChild.childCount==1;){o--,a--;let X=s.firstChild;n.push(X.type.name,X.attrs!=X.type.defaultAttrs?X.attrs:null),s=X.content}let c=r.someProp("clipboardSerializer")||DOMSerializer.fromSchema(r.state.schema),f=detachedDoc(),g=f.createElement("div");g.appendChild(c.serializeFragment(s,{document:f}));let b=g.firstChild,_,L=0;for(;b&&b.nodeType==1&&(_=wrapMap[b.nodeName.toLowerCase()]);){for(let X=_.length-1;X>=0;X--){let te=f.createElement(_[X]);for(;g.firstChild;)te.appendChild(g.firstChild);g.appendChild(te),L++}b=g.firstChild}b&&b.nodeType==1&&b.setAttribute("data-pm-slice",`${o} ${a}${L?` -${L}`:""} ${JSON.stringify(n)}`);let q=r.someProp("clipboardTextSerializer",X=>X(t,r))||t.content.textBetween(0,t.content.size,`

`);return{dom:g,text:q,slice:t}}function parseFromClipboard(r,t,n,s,o){let a=o.parent.type.spec.code,c,f;if(!n&&!t)return null;let g=!!t&&(s||a||!n);if(g){if(r.someProp("transformPastedText",q=>{t=q(t,a||s,r)}),a)return f=new Slice(Fragment.from(r.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0),r.someProp("transformPasted",q=>{f=q(f,r,!0)}),f;let L=r.someProp("clipboardTextParser",q=>q(t,o,s,r));if(L)f=L;else{let q=o.marks(),{schema:X}=r.state,te=DOMSerializer.fromSchema(X);c=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(ne=>{let Ce=c.appendChild(document.createElement("p"));ne&&Ce.appendChild(te.serializeNode(X.text(ne,q)))})}}else r.someProp("transformPastedHTML",L=>{n=L(n,r)}),c=readHTML(n),webkit&&restoreReplacedSpaces(c);let b=c&&c.querySelector("[data-pm-slice]"),_=b&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(b.getAttribute("data-pm-slice")||"");if(_&&_[3])for(let L=+_[3];L>0;L--){let q=c.firstChild;for(;q&&q.nodeType!=1;)q=q.nextSibling;if(!q)break;c=q}if(f||(f=(r.someProp("clipboardParser")||r.someProp("domParser")||DOMParser.fromSchema(r.state.schema)).parseSlice(c,{preserveWhitespace:!!(g||_),context:o,ruleFromNode(q){return q.nodeName=="BR"&&!q.nextSibling&&q.parentNode&&!inlineParents.test(q.parentNode.nodeName)?{ignore:!0}:null}})),_)f=addContext(closeSlice(f,+_[1],+_[2]),_[4]);else if(f=Slice.maxOpen(normalizeSiblings(f.content,o),!0),f.openStart||f.openEnd){let L=0,q=0;for(let X=f.content.firstChild;L<f.openStart&&!X.type.spec.isolating;L++,X=X.firstChild);for(let X=f.content.lastChild;q<f.openEnd&&!X.type.spec.isolating;q++,X=X.lastChild);f=closeSlice(f,L,q)}return r.someProp("transformPasted",L=>{f=L(f,r,g)}),f}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function normalizeSiblings(r,t){if(r.childCount<2)return r;for(let n=t.depth;n>=0;n--){let o=t.node(n).contentMatchAt(t.index(n)),a,c=[];if(r.forEach(f=>{if(!c)return;let g=o.findWrapping(f.type),b;if(!g)return c=null;if(b=c.length&&a.length&&addToSibling(g,a,f,c[c.length-1],0))c[c.length-1]=b;else{c.length&&(c[c.length-1]=closeRight(c[c.length-1],a.length));let _=withWrappers(f,g);c.push(_),o=o.matchType(_.type),a=g}}),c)return Fragment.from(c)}return r}function withWrappers(r,t,n=0){for(let s=t.length-1;s>=n;s--)r=t[s].create(null,Fragment.from(r));return r}function addToSibling(r,t,n,s,o){if(o<r.length&&o<t.length&&r[o]==t[o]){let a=addToSibling(r,t,n,s.lastChild,o+1);if(a)return s.copy(s.content.replaceChild(s.childCount-1,a));if(s.contentMatchAt(s.childCount).matchType(o==r.length-1?n.type:r[o+1]))return s.copy(s.content.append(Fragment.from(withWrappers(n,r,o+1))))}}function closeRight(r,t){if(t==0)return r;let n=r.content.replaceChild(r.childCount-1,closeRight(r.lastChild,t-1)),s=r.contentMatchAt(r.childCount).fillBefore(Fragment.empty,!0);return r.copy(n.append(s))}function closeRange(r,t,n,s,o,a){let c=t<0?r.firstChild:r.lastChild,f=c.content;return r.childCount>1&&(a=0),o<s-1&&(f=closeRange(f,t,n,s,o+1,a)),o>=n&&(f=t<0?c.contentMatchAt(0).fillBefore(f,a<=o).append(f):f.append(c.contentMatchAt(c.childCount).fillBefore(Fragment.empty,!0))),r.replaceChild(t<0?0:r.childCount-1,c.copy(f))}function closeSlice(r,t,n){return t<r.openStart&&(r=new Slice(closeRange(r.content,-1,t,r.openStart,0,r.openEnd),t,r.openEnd)),n<r.openEnd&&(r=new Slice(closeRange(r.content,1,n,r.openEnd,0,0),r.openStart,n)),r}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let _policy=null;function maybeWrapTrusted(r){let t=window.trustedTypes;return t?(_policy||(_policy=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),_policy.createHTML(r)):r}function readHTML(r){let t=/^(\s*<meta [^>]*>)*/.exec(r);t&&(r=r.slice(t[0].length));let n=detachedDoc().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(r),o;if((o=s&&wrapMap[s[1].toLowerCase()])&&(r=o.map(a=>"<"+a+">").join("")+r+o.map(a=>"</"+a+">").reverse().join("")),n.innerHTML=maybeWrapTrusted(r),o)for(let a=0;a<o.length;a++)n=n.querySelector(o[a])||n;return n}function restoreReplacedSpaces(r){let t=r.querySelectorAll(chrome?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let s=t[n];s.childNodes.length==1&&s.textContent==""&&s.parentNode&&s.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),s)}}function addContext(r,t){if(!r.size)return r;let n=r.content.firstChild.type.schema,s;try{s=JSON.parse(t)}catch{return r}let{content:o,openStart:a,openEnd:c}=r;for(let f=s.length-2;f>=0;f-=2){let g=n.nodes[s[f]];if(!g||g.hasRequiredAttrs())break;o=Fragment.from(g.create(s[f+1],o)),a++,c++}return new Slice(o,a,c)}const handlers={},editHandlers={};function setSelectionOrigin(r,t){r.input.lastSelectionOrigin=t,r.input.lastSelectionTime=Date.now()}editHandlers.keydown=(r,t)=>{let n=t;if(r.input.shiftKey=n.keyCode==16||n.shiftKey,!inOrNearComposition(r,n)&&(r.input.lastKeyCode=n.keyCode,r.input.lastKeyCodeTime=Date.now(),!(android&&chrome&&n.keyCode==13)))if(n.keyCode!=229&&r.domObserver.forceFlush(),ios&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let s=Date.now();r.input.lastIOSEnter=s,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==s&&(r.someProp("handleKeyDown",o=>o(r,keyEvent(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",s=>s(r,n))||captureKeyDown(r,n)?n.preventDefault():setSelectionOrigin(r,"key")};editHandlers.keyup=(r,t)=>{t.keyCode==16&&(r.input.shiftKey=!1)};editHandlers.keypress=(r,t)=>{let n=t;if(inOrNearComposition(r,n)||!n.charCode||n.ctrlKey&&!n.altKey||mac$2&&n.metaKey)return;if(r.someProp("handleKeyPress",o=>o(r,n))){n.preventDefault();return}let s=r.state.selection;if(!(s instanceof TextSelection)||!s.$from.sameParent(s.$to)){let o=String.fromCharCode(n.charCode),a=()=>r.state.tr.insertText(o).scrollIntoView();!/[\r\n]/.test(o)&&!r.someProp("handleTextInput",c=>c(r,s.$from.pos,s.$to.pos,o,a))&&r.dispatch(a()),n.preventDefault()}};function eventCoords(r){return{left:r.clientX,top:r.clientY}}function isNear(r,t){let n=t.x-r.clientX,s=t.y-r.clientY;return n*n+s*s<100}function runHandlerOnContext(r,t,n,s,o){if(s==-1)return!1;let a=r.state.doc.resolve(s);for(let c=a.depth+1;c>0;c--)if(r.someProp(t,f=>c>a.depth?f(r,n,a.nodeAfter,a.before(c),o,!0):f(r,n,a.node(c),a.before(c),o,!1)))return!0;return!1}function updateSelection(r,t,n){if(r.focused||r.focus(),r.state.selection.eq(t))return;let s=r.state.tr.setSelection(t);s.setMeta("pointer",!0),r.dispatch(s)}function selectClickedLeaf(r,t){if(t==-1)return!1;let n=r.state.doc.resolve(t),s=n.nodeAfter;return s&&s.isAtom&&NodeSelection.isSelectable(s)?(updateSelection(r,new NodeSelection(n)),!0):!1}function selectClickedNode(r,t){if(t==-1)return!1;let n=r.state.selection,s,o;n instanceof NodeSelection&&(s=n.node);let a=r.state.doc.resolve(t);for(let c=a.depth+1;c>0;c--){let f=c>a.depth?a.nodeAfter:a.node(c);if(NodeSelection.isSelectable(f)){s&&n.$from.depth>0&&c>=n.$from.depth&&a.before(n.$from.depth+1)==n.$from.pos?o=a.before(n.$from.depth):o=a.before(c);break}}return o!=null?(updateSelection(r,NodeSelection.create(r.state.doc,o)),!0):!1}function handleSingleClick(r,t,n,s,o){return runHandlerOnContext(r,"handleClickOn",t,n,s)||r.someProp("handleClick",a=>a(r,t,s))||(o?selectClickedNode(r,n):selectClickedLeaf(r,n))}function handleDoubleClick(r,t,n,s){return runHandlerOnContext(r,"handleDoubleClickOn",t,n,s)||r.someProp("handleDoubleClick",o=>o(r,t,s))}function handleTripleClick(r,t,n,s){return runHandlerOnContext(r,"handleTripleClickOn",t,n,s)||r.someProp("handleTripleClick",o=>o(r,t,s))||defaultTripleClick(r,n,s)}function defaultTripleClick(r,t,n){if(n.button!=0)return!1;let s=r.state.doc;if(t==-1)return s.inlineContent?(updateSelection(r,TextSelection.create(s,0,s.content.size)),!0):!1;let o=s.resolve(t);for(let a=o.depth+1;a>0;a--){let c=a>o.depth?o.nodeAfter:o.node(a),f=o.before(a);if(c.inlineContent)updateSelection(r,TextSelection.create(s,f+1,f+1+c.content.size));else if(NodeSelection.isSelectable(c))updateSelection(r,NodeSelection.create(s,f));else continue;return!0}}function forceDOMFlush(r){return endComposition(r)}const selectNodeModifier=mac$2?"metaKey":"ctrlKey";handlers.mousedown=(r,t)=>{let n=t;r.input.shiftKey=n.shiftKey;let s=forceDOMFlush(r),o=Date.now(),a="singleClick";o-r.input.lastClick.time<500&&isNear(n,r.input.lastClick)&&!n[selectNodeModifier]&&r.input.lastClick.button==n.button&&(r.input.lastClick.type=="singleClick"?a="doubleClick":r.input.lastClick.type=="doubleClick"&&(a="tripleClick")),r.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:a,button:n.button};let c=r.posAtCoords(eventCoords(n));c&&(a=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new MouseDown(r,c,n,!!s)):(a=="doubleClick"?handleDoubleClick:handleTripleClick)(r,c.pos,c.inside,n)?n.preventDefault():setSelectionOrigin(r,"pointer"))};class MouseDown{constructor(t,n,s,o){this.view=t,this.pos=n,this.event=s,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!s[selectNodeModifier],this.allowDefault=s.shiftKey;let a,c;if(n.inside>-1)a=t.state.doc.nodeAt(n.inside),c=n.inside;else{let _=t.state.doc.resolve(n.pos);a=_.parent,c=_.depth?_.before():0}const f=o?null:s.target,g=f?t.docView.nearestDesc(f,!0):null;this.target=g&&g.nodeDOM.nodeType==1?g.nodeDOM:null;let{selection:b}=t.state;(s.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||b instanceof NodeSelection&&b.from<=c&&b.to>c)&&(this.mightDrag={node:a,pos:c,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gecko&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>selectionToDOM(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(eventCoords(t))),this.updateAllowDefault(t),this.allowDefault||!n?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||safari&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(n.pos))),t.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(t){this.updateAllowDefault(t),setSelectionOrigin(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}handlers.touchstart=r=>{r.input.lastTouch=Date.now(),forceDOMFlush(r),setSelectionOrigin(r,"pointer")};handlers.touchmove=r=>{r.input.lastTouch=Date.now(),setSelectionOrigin(r,"pointer")};handlers.contextmenu=r=>forceDOMFlush(r);function inOrNearComposition(r,t){return r.composing?!0:safari&&Math.abs(t.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const timeoutComposition=android?5e3:-1;editHandlers.compositionstart=editHandlers.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:t}=r,n=t.selection.$to;if(t.selection instanceof TextSelection&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||n.marks(),endComposition(r,!0),r.markCursor=null;else if(endComposition(r,!t.selection.empty),gecko&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let s=r.domSelectionRange();for(let o=s.focusNode,a=s.focusOffset;o&&o.nodeType==1&&a!=0;){let c=a<0?o.lastChild:o.childNodes[a-1];if(!c)break;if(c.nodeType==3){let f=r.domSelection();f&&f.collapse(c,c.nodeValue.length);break}else o=c,a=-1}}r.input.composing=!0}scheduleComposeEnd(r,timeoutComposition)};editHandlers.compositionend=(r,t)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=t.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,scheduleComposeEnd(r,20))};function scheduleComposeEnd(r,t){clearTimeout(r.input.composingTimeout),t>-1&&(r.input.composingTimeout=setTimeout(()=>endComposition(r),t))}function clearComposition(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=timestampFromCustomEvent());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function timestampFromCustomEvent(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function endComposition(r,t=!1){if(!(android&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),clearComposition(r),t||r.docView&&r.docView.dirty){let n=selectionFromDOM(r),s=r.state.selection;return n&&!n.eq(s)?r.dispatch(r.state.tr.setSelection(n)):(r.markCursor||t)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function captureCopy(r,t){if(!r.dom.parentNode)return;let n=r.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),o=document.createRange();o.selectNodeContents(t),r.dom.blur(),s.removeAllRanges(),s.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),r.focus()},50)}const brokenClipboardAPI=ie$1&&ie_version<15||ios&&webkit_version<604;handlers.copy=editHandlers.cut=(r,t)=>{let n=t,s=r.state.selection,o=n.type=="cut";if(s.empty)return;let a=brokenClipboardAPI?null:n.clipboardData,c=s.content(),{dom:f,text:g}=serializeForClipboard(r,c);a?(n.preventDefault(),a.clearData(),a.setData("text/html",f.innerHTML),a.setData("text/plain",g)):captureCopy(r,f),o&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function sliceSingleNode(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function capturePaste(r,t){if(!r.dom.parentNode)return;let n=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,s=r.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let o=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),s.parentNode&&s.parentNode.removeChild(s),n?doPaste(r,s.value,null,o,t):doPaste(r,s.textContent,s.innerHTML,o,t)},50)}function doPaste(r,t,n,s,o){let a=parseFromClipboard(r,t,n,s,r.state.selection.$from);if(r.someProp("handlePaste",g=>g(r,o,a||Slice.empty)))return!0;if(!a)return!1;let c=sliceSingleNode(a),f=c?r.state.tr.replaceSelectionWith(c,s):r.state.tr.replaceSelection(a);return r.dispatch(f.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText(r){let t=r.getData("text/plain")||r.getData("Text");if(t)return t;let n=r.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}editHandlers.paste=(r,t)=>{let n=t;if(r.composing&&!android)return;let s=brokenClipboardAPI?null:n.clipboardData,o=r.input.shiftKey&&r.input.lastKeyCode!=45;s&&doPaste(r,getText(s),s.getData("text/html"),o,n)?n.preventDefault():capturePaste(r,n)};class Dragging{constructor(t,n,s){this.slice=t,this.move=n,this.node=s}}const dragCopyModifier=mac$2?"altKey":"ctrlKey";function dragMoves(r,t){let n=r.someProp("dragCopies",s=>!s(t));return n??!t[dragCopyModifier]}handlers.dragstart=(r,t)=>{let n=t,s=r.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let o=r.state.selection,a=o.empty?null:r.posAtCoords(eventCoords(n)),c;if(!(a&&a.pos>=o.from&&a.pos<=(o instanceof NodeSelection?o.to-1:o.to))){if(s&&s.mightDrag)c=NodeSelection.create(r.state.doc,s.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let L=r.docView.nearestDesc(n.target,!0);L&&L.node.type.spec.draggable&&L!=r.docView&&(c=NodeSelection.create(r.state.doc,L.posBefore))}}let f=(c||r.state.selection).content(),{dom:g,text:b,slice:_}=serializeForClipboard(r,f);(!n.dataTransfer.files.length||!chrome||chrome_version>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",g.innerHTML),n.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||n.dataTransfer.setData("text/plain",b),r.dragging=new Dragging(_,dragMoves(r,n),c)};handlers.dragend=r=>{let t=r.dragging;window.setTimeout(()=>{r.dragging==t&&(r.dragging=null)},50)};editHandlers.dragover=editHandlers.dragenter=(r,t)=>t.preventDefault();editHandlers.drop=(r,t)=>{let n=t,s=r.dragging;if(r.dragging=null,!n.dataTransfer)return;let o=r.posAtCoords(eventCoords(n));if(!o)return;let a=r.state.doc.resolve(o.pos),c=s&&s.slice;c?r.someProp("transformPasted",te=>{c=te(c,r,!1)}):c=parseFromClipboard(r,getText(n.dataTransfer),brokenClipboardAPI?null:n.dataTransfer.getData("text/html"),!1,a);let f=!!(s&&dragMoves(r,n));if(r.someProp("handleDrop",te=>te(r,n,c||Slice.empty,f))){n.preventDefault();return}if(!c)return;n.preventDefault();let g=c?dropPoint(r.state.doc,a.pos,c):a.pos;g==null&&(g=a.pos);let b=r.state.tr;if(f){let{node:te}=s;te?te.replace(b):b.deleteSelection()}let _=b.mapping.map(g),L=c.openStart==0&&c.openEnd==0&&c.content.childCount==1,q=b.doc;if(L?b.replaceRangeWith(_,_,c.content.firstChild):b.replaceRange(_,_,c),b.doc.eq(q))return;let X=b.doc.resolve(_);if(L&&NodeSelection.isSelectable(c.content.firstChild)&&X.nodeAfter&&X.nodeAfter.sameMarkup(c.content.firstChild))b.setSelection(new NodeSelection(X));else{let te=b.mapping.map(g);b.mapping.maps[b.mapping.maps.length-1].forEach((ne,Ce,Le,Ge)=>te=Ge),b.setSelection(selectionBetween(r,X,b.doc.resolve(te)))}r.focus(),r.dispatch(b.setMeta("uiEvent","drop"))};handlers.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&selectionToDOM(r)},20))};handlers.blur=(r,t)=>{let n=t;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),n.relatedTarget&&r.dom.contains(n.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};handlers.beforeinput=(r,t)=>{if(chrome&&android&&t.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:s}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=s||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",a=>a(r,keyEvent(8,"Backspace")))))return;let{$cursor:o}=r.state.selection;o&&o.pos>0&&r.dispatch(r.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let r in editHandlers)handlers[r]=editHandlers[r];function compareObjs(r,t){if(r==t)return!0;for(let n in r)if(r[n]!==t[n])return!1;for(let n in t)if(!(n in r))return!1;return!0}class WidgetType{constructor(t,n){this.toDOM=t,this.spec=n||noSpec,this.side=this.spec.side||0}map(t,n,s,o){let{pos:a,deleted:c}=t.mapResult(n.from+o,this.side<0?-1:1);return c?null:new Decoration(a-s,a-s,this)}valid(){return!0}eq(t){return this==t||t instanceof WidgetType&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&compareObjs(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class InlineType{constructor(t,n){this.attrs=t,this.spec=n||noSpec}map(t,n,s,o){let a=t.map(n.from+o,this.spec.inclusiveStart?-1:1)-s,c=t.map(n.to+o,this.spec.inclusiveEnd?1:-1)-s;return a>=c?null:new Decoration(a,c,this)}valid(t,n){return n.from<n.to}eq(t){return this==t||t instanceof InlineType&&compareObjs(this.attrs,t.attrs)&&compareObjs(this.spec,t.spec)}static is(t){return t.type instanceof InlineType}destroy(){}}class NodeType{constructor(t,n){this.attrs=t,this.spec=n||noSpec}map(t,n,s,o){let a=t.mapResult(n.from+o,1);if(a.deleted)return null;let c=t.mapResult(n.to+o,-1);return c.deleted||c.pos<=a.pos?null:new Decoration(a.pos-s,c.pos-s,this)}valid(t,n){let{index:s,offset:o}=t.content.findIndex(n.from),a;return o==n.from&&!(a=t.child(s)).isText&&o+a.nodeSize==n.to}eq(t){return this==t||t instanceof NodeType&&compareObjs(this.attrs,t.attrs)&&compareObjs(this.spec,t.spec)}destroy(){}}class Decoration{constructor(t,n,s){this.from=t,this.to=n,this.type=s}copy(t,n){return new Decoration(t,n,this.type)}eq(t,n=0){return this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to}map(t,n,s){return this.type.map(t,this,n,s)}static widget(t,n,s){return new Decoration(t,t,new WidgetType(n,s))}static inline(t,n,s,o){return new Decoration(t,n,new InlineType(s,o))}static node(t,n,s,o){return new Decoration(t,n,new NodeType(s,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType}}const none=[],noSpec={};class DecorationSet{constructor(t,n){this.local=t.length?t:none,this.children=n.length?n:none}static create(t,n){return n.length?buildTree(n,t,0,noSpec):empty}find(t,n,s){let o=[];return this.findInner(t??0,n??1e9,o,0,s),o}findInner(t,n,s,o,a){for(let c=0;c<this.local.length;c++){let f=this.local[c];f.from<=n&&f.to>=t&&(!a||a(f.spec))&&s.push(f.copy(f.from+o,f.to+o))}for(let c=0;c<this.children.length;c+=3)if(this.children[c]<n&&this.children[c+1]>t){let f=this.children[c]+1;this.children[c+2].findInner(t-f,n-f,s,o+f,a)}}map(t,n,s){return this==empty||t.maps.length==0?this:this.mapInner(t,n,0,0,s||noSpec)}mapInner(t,n,s,o,a){let c;for(let f=0;f<this.local.length;f++){let g=this.local[f].map(t,s,o);g&&g.type.valid(n,g)?(c||(c=[])).push(g):a.onRemove&&a.onRemove(this.local[f].spec)}return this.children.length?mapChildren(this.children,c||[],t,n,s,o,a):c?new DecorationSet(c.sort(byPos),none):empty}add(t,n){return n.length?this==empty?DecorationSet.create(t,n):this.addInner(t,n,0):this}addInner(t,n,s){let o,a=0;t.forEach((f,g)=>{let b=g+s,_;if(_=takeSpansForNode(n,f,b)){for(o||(o=this.children.slice());a<o.length&&o[a]<g;)a+=3;o[a]==g?o[a+2]=o[a+2].addInner(f,_,b+1):o.splice(a,0,g,g+f.nodeSize,buildTree(_,f,b+1,noSpec)),a+=3}});let c=moveSpans(a?withoutNulls(n):n,-s);for(let f=0;f<c.length;f++)c[f].type.valid(t,c[f])||c.splice(f--,1);return new DecorationSet(c.length?this.local.concat(c).sort(byPos):this.local,o||this.children)}remove(t){return t.length==0||this==empty?this:this.removeInner(t,0)}removeInner(t,n){let s=this.children,o=this.local;for(let a=0;a<s.length;a+=3){let c,f=s[a]+n,g=s[a+1]+n;for(let _=0,L;_<t.length;_++)(L=t[_])&&L.from>f&&L.to<g&&(t[_]=null,(c||(c=[])).push(L));if(!c)continue;s==this.children&&(s=this.children.slice());let b=s[a+2].removeInner(c,f+1);b!=empty?s[a+2]=b:(s.splice(a,3),a-=3)}if(o.length){for(let a=0,c;a<t.length;a++)if(c=t[a])for(let f=0;f<o.length;f++)o[f].eq(c,n)&&(o==this.local&&(o=this.local.slice()),o.splice(f--,1))}return s==this.children&&o==this.local?this:o.length||s.length?new DecorationSet(o,s):empty}forChild(t,n){if(this==empty)return this;if(n.isLeaf)return DecorationSet.empty;let s,o;for(let f=0;f<this.children.length;f+=3)if(this.children[f]>=t){this.children[f]==t&&(s=this.children[f+2]);break}let a=t+1,c=a+n.content.size;for(let f=0;f<this.local.length;f++){let g=this.local[f];if(g.from<c&&g.to>a&&g.type instanceof InlineType){let b=Math.max(a,g.from)-a,_=Math.min(c,g.to)-a;b<_&&(o||(o=[])).push(g.copy(b,_))}}if(o){let f=new DecorationSet(o.sort(byPos),none);return s?new DecorationGroup([f,s]):f}return s||empty}eq(t){if(this==t)return!0;if(!(t instanceof DecorationSet)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0}locals(t){return removeOverlap(this.localsInner(t))}localsInner(t){if(this==empty)return none;if(t.inlineContent||!this.local.some(InlineType.is))return this.local;let n=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof InlineType||n.push(this.local[s]);return n}forEachSet(t){t(this)}}DecorationSet.empty=new DecorationSet([],[]);DecorationSet.removeOverlap=removeOverlap;const empty=DecorationSet.empty;class DecorationGroup{constructor(t){this.members=t}map(t,n){const s=this.members.map(o=>o.map(t,n,noSpec));return DecorationGroup.from(s)}forChild(t,n){if(n.isLeaf)return DecorationSet.empty;let s=[];for(let o=0;o<this.members.length;o++){let a=this.members[o].forChild(t,n);a!=empty&&(a instanceof DecorationGroup?s=s.concat(a.members):s.push(a))}return DecorationGroup.from(s)}eq(t){if(!(t instanceof DecorationGroup)||t.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0}locals(t){let n,s=!0;for(let o=0;o<this.members.length;o++){let a=this.members[o].localsInner(t);if(a.length)if(!n)n=a;else{s&&(n=n.slice(),s=!1);for(let c=0;c<a.length;c++)n.push(a[c])}}return n?removeOverlap(s?n:n.sort(byPos)):none}static from(t){switch(t.length){case 0:return empty;case 1:return t[0];default:return new DecorationGroup(t.every(n=>n instanceof DecorationSet)?t:t.reduce((n,s)=>n.concat(s instanceof DecorationSet?s:s.members),[]))}}forEachSet(t){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(t)}}function mapChildren(r,t,n,s,o,a,c){let f=r.slice();for(let b=0,_=a;b<n.maps.length;b++){let L=0;n.maps[b].forEach((q,X,te,ne)=>{let Ce=ne-te-(X-q);for(let Le=0;Le<f.length;Le+=3){let Ge=f[Le+1];if(Ge<0||q>Ge+_-L)continue;let ze=f[Le]+_-L;X>=ze?f[Le+1]=q<=ze?-2:-1:q>=_&&Ce&&(f[Le]+=Ce,f[Le+1]+=Ce)}L+=Ce}),_=n.maps[b].map(_,-1)}let g=!1;for(let b=0;b<f.length;b+=3)if(f[b+1]<0){if(f[b+1]==-2){g=!0,f[b+1]=-1;continue}let _=n.map(r[b]+a),L=_-o;if(L<0||L>=s.content.size){g=!0;continue}let q=n.map(r[b+1]+a,-1),X=q-o,{index:te,offset:ne}=s.content.findIndex(L),Ce=s.maybeChild(te);if(Ce&&ne==L&&ne+Ce.nodeSize==X){let Le=f[b+2].mapInner(n,Ce,_+1,r[b]+a+1,c);Le!=empty?(f[b]=L,f[b+1]=X,f[b+2]=Le):(f[b+1]=-2,g=!0)}else g=!0}if(g){let b=mapAndGatherRemainingDecorations(f,r,t,n,o,a,c),_=buildTree(b,s,0,c);t=_.local;for(let L=0;L<f.length;L+=3)f[L+1]<0&&(f.splice(L,3),L-=3);for(let L=0,q=0;L<_.children.length;L+=3){let X=_.children[L];for(;q<f.length&&f[q]<X;)q+=3;f.splice(q,0,_.children[L],_.children[L+1],_.children[L+2])}}return new DecorationSet(t.sort(byPos),f)}function moveSpans(r,t){if(!t||!r.length)return r;let n=[];for(let s=0;s<r.length;s++){let o=r[s];n.push(new Decoration(o.from+t,o.to+t,o.type))}return n}function mapAndGatherRemainingDecorations(r,t,n,s,o,a,c){function f(g,b){for(let _=0;_<g.local.length;_++){let L=g.local[_].map(s,o,b);L?n.push(L):c.onRemove&&c.onRemove(g.local[_].spec)}for(let _=0;_<g.children.length;_+=3)f(g.children[_+2],g.children[_]+b+1)}for(let g=0;g<r.length;g+=3)r[g+1]==-1&&f(r[g+2],t[g]+a+1);return n}function takeSpansForNode(r,t,n){if(t.isLeaf)return null;let s=n+t.nodeSize,o=null;for(let a=0,c;a<r.length;a++)(c=r[a])&&c.from>n&&c.to<s&&((o||(o=[])).push(c),r[a]=null);return o}function withoutNulls(r){let t=[];for(let n=0;n<r.length;n++)r[n]!=null&&t.push(r[n]);return t}function buildTree(r,t,n,s){let o=[],a=!1;t.forEach((f,g)=>{let b=takeSpansForNode(r,f,g+n);if(b){a=!0;let _=buildTree(b,f,n+g+1,s);_!=empty&&o.push(g,g+f.nodeSize,_)}});let c=moveSpans(a?withoutNulls(r):r,-n).sort(byPos);for(let f=0;f<c.length;f++)c[f].type.valid(t,c[f])||(s.onRemove&&s.onRemove(c[f].spec),c.splice(f--,1));return c.length||o.length?new DecorationSet(c,o):empty}function byPos(r,t){return r.from-t.from||r.to-t.to}function removeOverlap(r){let t=r;for(let n=0;n<t.length-1;n++){let s=t[n];if(s.from!=s.to)for(let o=n+1;o<t.length;o++){let a=t[o];if(a.from==s.from){a.to!=s.to&&(t==r&&(t=r.slice()),t[o]=a.copy(a.from,s.to),insertAhead(t,o+1,a.copy(s.to,a.to)));continue}else{a.from<s.to&&(t==r&&(t=r.slice()),t[n]=s.copy(s.from,a.from),insertAhead(t,o,s.copy(a.from,s.to)));break}}}return t}function insertAhead(r,t,n){for(;t<r.length&&byPos(n,r[t])>0;)t++;r.splice(t,0,n)}var base$1={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i=0;i<10;i++)base$1[48+i]=base$1[96+i]=String(i);for(var i=1;i<=24;i++)base$1[i+111]="F"+i;for(var i=65;i<=90;i++)base$1[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code$1 in base$1)shift.hasOwnProperty(code$1)||(shift[code$1]=base$1[code$1]);function keyName(r){var t=mac$1&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||ie&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",n=!t&&r.key||(r.shiftKey?shift:base$1)[r.keyCode]||r.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const mac=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),windows=typeof navigator<"u"&&/Win/.test(navigator.platform);function normalizeKeyName$1(r){let t=r.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");let s,o,a,c;for(let f=0;f<t.length-1;f++){let g=t[f];if(/^(cmd|meta|m)$/i.test(g))c=!0;else if(/^a(lt)?$/i.test(g))s=!0;else if(/^(c|ctrl|control)$/i.test(g))o=!0;else if(/^s(hift)?$/i.test(g))a=!0;else if(/^mod$/i.test(g))mac?c=!0:o=!0;else throw new Error("Unrecognized modifier name: "+g)}return s&&(n="Alt-"+n),o&&(n="Ctrl-"+n),c&&(n="Meta-"+n),a&&(n="Shift-"+n),n}function normalize$1(r){let t=Object.create(null);for(let n in r)t[normalizeKeyName$1(n)]=r[n];return t}function modifiers(r,t,n=!0){return t.altKey&&(r="Alt-"+r),t.ctrlKey&&(r="Ctrl-"+r),t.metaKey&&(r="Meta-"+r),n&&t.shiftKey&&(r="Shift-"+r),r}function keydownHandler(r){let t=normalize$1(r);return function(n,s){let o=keyName(s),a,c=t[modifiers(o,s)];if(c&&c(n.state,n.dispatch,n))return!0;if(o.length==1&&o!=" "){if(s.shiftKey){let f=t[modifiers(o,s,!1)];if(f&&f(n.state,n.dispatch,n))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(windows&&s.ctrlKey&&s.altKey)&&(a=base$1[s.keyCode])&&a!=o){let f=t[modifiers(a,s)];if(f&&f(n.state,n.dispatch,n))return!0}}return!1}}const deleteSelection$1=(r,t)=>r.selection.empty?!1:(t&&t(r.tr.deleteSelection().scrollIntoView()),!0);function atBlockStart(r,t){let{$cursor:n}=r.selection;return!n||(t?!t.endOfTextblock("backward",r):n.parentOffset>0)?null:n}const joinBackward$1=(r,t,n)=>{let s=atBlockStart(r,n);if(!s)return!1;let o=findCutBefore(s);if(!o){let c=s.blockRange(),f=c&&liftTarget(c);return f==null?!1:(t&&t(r.tr.lift(c,f).scrollIntoView()),!0)}let a=o.nodeBefore;if(deleteBarrier(r,o,t,-1))return!0;if(s.parent.content.size==0&&(textblockAt(a,"end")||NodeSelection.isSelectable(a)))for(let c=s.depth;;c--){let f=replaceStep(r.doc,s.before(c),s.after(c),Slice.empty);if(f&&f.slice.size<f.to-f.from){if(t){let g=r.tr.step(f);g.setSelection(textblockAt(a,"end")?Selection.findFrom(g.doc.resolve(g.mapping.map(o.pos,-1)),-1):NodeSelection.create(g.doc,o.pos-a.nodeSize)),t(g.scrollIntoView())}return!0}if(c==1||s.node(c-1).childCount>1)break}return a.isAtom&&o.depth==s.depth-1?(t&&t(r.tr.delete(o.pos-a.nodeSize,o.pos).scrollIntoView()),!0):!1},joinTextblockBackward$1=(r,t,n)=>{let s=atBlockStart(r,n);if(!s)return!1;let o=findCutBefore(s);return o?joinTextblocksAround(r,o,t):!1},joinTextblockForward$1=(r,t,n)=>{let s=atBlockEnd(r,n);if(!s)return!1;let o=findCutAfter(s);return o?joinTextblocksAround(r,o,t):!1};function joinTextblocksAround(r,t,n){let s=t.nodeBefore,o=s,a=t.pos-1;for(;!o.isTextblock;a--){if(o.type.spec.isolating)return!1;let _=o.lastChild;if(!_)return!1;o=_}let c=t.nodeAfter,f=c,g=t.pos+1;for(;!f.isTextblock;g++){if(f.type.spec.isolating)return!1;let _=f.firstChild;if(!_)return!1;f=_}let b=replaceStep(r.doc,a,g,Slice.empty);if(!b||b.from!=a||b instanceof ReplaceStep&&b.slice.size>=g-a)return!1;if(n){let _=r.tr.step(b);_.setSelection(TextSelection.create(_.doc,a)),n(_.scrollIntoView())}return!0}function textblockAt(r,t,n=!1){for(let s=r;s;s=t=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&s.childCount!=1)return!1}return!1}const selectNodeBackward$1=(r,t,n)=>{let{$head:s,empty:o}=r.selection,a=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",r):s.parentOffset>0)return!1;a=findCutBefore(s)}let c=a&&a.nodeBefore;return!c||!NodeSelection.isSelectable(c)?!1:(t&&t(r.tr.setSelection(NodeSelection.create(r.doc,a.pos-c.nodeSize)).scrollIntoView()),!0)};function findCutBefore(r){if(!r.parent.type.spec.isolating)for(let t=r.depth-1;t>=0;t--){if(r.index(t)>0)return r.doc.resolve(r.before(t+1));if(r.node(t).type.spec.isolating)break}return null}function atBlockEnd(r,t){let{$cursor:n}=r.selection;return!n||(t?!t.endOfTextblock("forward",r):n.parentOffset<n.parent.content.size)?null:n}const joinForward$1=(r,t,n)=>{let s=atBlockEnd(r,n);if(!s)return!1;let o=findCutAfter(s);if(!o)return!1;let a=o.nodeAfter;if(deleteBarrier(r,o,t,1))return!0;if(s.parent.content.size==0&&(textblockAt(a,"start")||NodeSelection.isSelectable(a))){let c=replaceStep(r.doc,s.before(),s.after(),Slice.empty);if(c&&c.slice.size<c.to-c.from){if(t){let f=r.tr.step(c);f.setSelection(textblockAt(a,"start")?Selection.findFrom(f.doc.resolve(f.mapping.map(o.pos)),1):NodeSelection.create(f.doc,f.mapping.map(o.pos))),t(f.scrollIntoView())}return!0}}return a.isAtom&&o.depth==s.depth-1?(t&&t(r.tr.delete(o.pos,o.pos+a.nodeSize).scrollIntoView()),!0):!1},selectNodeForward$1=(r,t,n)=>{let{$head:s,empty:o}=r.selection,a=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",r):s.parentOffset<s.parent.content.size)return!1;a=findCutAfter(s)}let c=a&&a.nodeAfter;return!c||!NodeSelection.isSelectable(c)?!1:(t&&t(r.tr.setSelection(NodeSelection.create(r.doc,a.pos)).scrollIntoView()),!0)};function findCutAfter(r){if(!r.parent.type.spec.isolating)for(let t=r.depth-1;t>=0;t--){let n=r.node(t);if(r.index(t)+1<n.childCount)return r.doc.resolve(r.after(t+1));if(n.type.spec.isolating)break}return null}const joinUp$1=(r,t)=>{let n=r.selection,s=n instanceof NodeSelection,o;if(s){if(n.node.isTextblock||!canJoin(r.doc,n.from))return!1;o=n.from}else if(o=joinPoint(r.doc,n.from,-1),o==null)return!1;if(t){let a=r.tr.join(o);s&&a.setSelection(NodeSelection.create(a.doc,o-r.doc.resolve(o).nodeBefore.nodeSize)),t(a.scrollIntoView())}return!0},joinDown$1=(r,t)=>{let n=r.selection,s;if(n instanceof NodeSelection){if(n.node.isTextblock||!canJoin(r.doc,n.to))return!1;s=n.to}else if(s=joinPoint(r.doc,n.to,1),s==null)return!1;return t&&t(r.tr.join(s).scrollIntoView()),!0},lift$1=(r,t)=>{let{$from:n,$to:s}=r.selection,o=n.blockRange(s),a=o&&liftTarget(o);return a==null?!1:(t&&t(r.tr.lift(o,a).scrollIntoView()),!0)},newlineInCode$1=(r,t)=>{let{$head:n,$anchor:s}=r.selection;return!n.parent.type.spec.code||!n.sameParent(s)?!1:(t&&t(r.tr.insertText(`
`).scrollIntoView()),!0)};function defaultBlockAt$1(r){for(let t=0;t<r.edgeCount;t++){let{type:n}=r.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const exitCode$1=(r,t)=>{let{$head:n,$anchor:s}=r.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let o=n.node(-1),a=n.indexAfter(-1),c=defaultBlockAt$1(o.contentMatchAt(a));if(!c||!o.canReplaceWith(a,a,c))return!1;if(t){let f=n.after(),g=r.tr.replaceWith(f,f,c.createAndFill());g.setSelection(Selection.near(g.doc.resolve(f),1)),t(g.scrollIntoView())}return!0},createParagraphNear$1=(r,t)=>{let n=r.selection,{$from:s,$to:o}=n;if(n instanceof AllSelection||s.parent.inlineContent||o.parent.inlineContent)return!1;let a=defaultBlockAt$1(o.parent.contentMatchAt(o.indexAfter()));if(!a||!a.isTextblock)return!1;if(t){let c=(!s.parentOffset&&o.index()<o.parent.childCount?s:o).pos,f=r.tr.insert(c,a.createAndFill());f.setSelection(TextSelection.create(f.doc,c+1)),t(f.scrollIntoView())}return!0},liftEmptyBlock$1=(r,t)=>{let{$cursor:n}=r.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let a=n.before();if(canSplit(r.doc,a))return t&&t(r.tr.split(a).scrollIntoView()),!0}let s=n.blockRange(),o=s&&liftTarget(s);return o==null?!1:(t&&t(r.tr.lift(s,o).scrollIntoView()),!0)};function splitBlockAs(r){return(t,n)=>{let{$from:s,$to:o}=t.selection;if(t.selection instanceof NodeSelection&&t.selection.node.isBlock)return!s.parentOffset||!canSplit(t.doc,s.pos)?!1:(n&&n(t.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let a=[],c,f,g=!1,b=!1;for(let X=s.depth;;X--)if(s.node(X).isBlock){g=s.end(X)==s.pos+(s.depth-X),b=s.start(X)==s.pos-(s.depth-X),f=defaultBlockAt$1(s.node(X-1).contentMatchAt(s.indexAfter(X-1))),a.unshift(g&&f?{type:f}:null),c=X;break}else{if(X==1)return!1;a.unshift(null)}let _=t.tr;(t.selection instanceof TextSelection||t.selection instanceof AllSelection)&&_.deleteSelection();let L=_.mapping.map(s.pos),q=canSplit(_.doc,L,a.length,a);if(q||(a[0]=f?{type:f}:null,q=canSplit(_.doc,L,a.length,a)),!q)return!1;if(_.split(L,a.length,a),!g&&b&&s.node(c).type!=f){let X=_.mapping.map(s.before(c)),te=_.doc.resolve(X);f&&s.node(c-1).canReplaceWith(te.index(),te.index()+1,f)&&_.setNodeMarkup(_.mapping.map(s.before(c)),f)}return n&&n(_.scrollIntoView()),!0}}const splitBlock$1=splitBlockAs(),selectParentNode$1=(r,t)=>{let{$from:n,to:s}=r.selection,o,a=n.sharedDepth(s);return a==0?!1:(o=n.before(a),t&&t(r.tr.setSelection(NodeSelection.create(r.doc,o))),!0)};function joinMaybeClear(r,t,n){let s=t.nodeBefore,o=t.nodeAfter,a=t.index();return!s||!o||!s.type.compatibleContent(o.type)?!1:!s.content.size&&t.parent.canReplace(a-1,a)?(n&&n(r.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(a,a+1)||!(o.isTextblock||canJoin(r.doc,t.pos))?!1:(n&&n(r.tr.join(t.pos).scrollIntoView()),!0)}function deleteBarrier(r,t,n,s){let o=t.nodeBefore,a=t.nodeAfter,c,f,g=o.type.spec.isolating||a.type.spec.isolating;if(!g&&joinMaybeClear(r,t,n))return!0;let b=!g&&t.parent.canReplace(t.index(),t.index()+1);if(b&&(c=(f=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&f.matchType(c[0]||a.type).validEnd){if(n){let X=t.pos+a.nodeSize,te=Fragment.empty;for(let Le=c.length-1;Le>=0;Le--)te=Fragment.from(c[Le].create(null,te));te=Fragment.from(o.copy(te));let ne=r.tr.step(new ReplaceAroundStep(t.pos-1,X,t.pos,X,new Slice(te,1,0),c.length,!0)),Ce=ne.doc.resolve(X+2*c.length);Ce.nodeAfter&&Ce.nodeAfter.type==o.type&&canJoin(ne.doc,Ce.pos)&&ne.join(Ce.pos),n(ne.scrollIntoView())}return!0}let _=a.type.spec.isolating||s>0&&g?null:Selection.findFrom(t,1),L=_&&_.$from.blockRange(_.$to),q=L&&liftTarget(L);if(q!=null&&q>=t.depth)return n&&n(r.tr.lift(L,q).scrollIntoView()),!0;if(b&&textblockAt(a,"start",!0)&&textblockAt(o,"end")){let X=o,te=[];for(;te.push(X),!X.isTextblock;)X=X.lastChild;let ne=a,Ce=1;for(;!ne.isTextblock;ne=ne.firstChild)Ce++;if(X.canReplace(X.childCount,X.childCount,ne.content)){if(n){let Le=Fragment.empty;for(let ze=te.length-1;ze>=0;ze--)Le=Fragment.from(te[ze].copy(Le));let Ge=r.tr.step(new ReplaceAroundStep(t.pos-te.length,t.pos+a.nodeSize,t.pos+Ce,t.pos+a.nodeSize-Ce,new Slice(Le,te.length,0),0,!0));n(Ge.scrollIntoView())}return!0}}return!1}function selectTextblockSide(r){return function(t,n){let s=t.selection,o=r<0?s.$from:s.$to,a=o.depth;for(;o.node(a).isInline;){if(!a)return!1;a--}return o.node(a).isTextblock?(n&&n(t.tr.setSelection(TextSelection.create(t.doc,r<0?o.start(a):o.end(a)))),!0):!1}}const selectTextblockStart$1=selectTextblockSide(-1),selectTextblockEnd$1=selectTextblockSide(1);function wrapIn$1(r,t=null){return function(n,s){let{$from:o,$to:a}=n.selection,c=o.blockRange(a),f=c&&findWrapping(c,r,t);return f?(s&&s(n.tr.wrap(c,f).scrollIntoView()),!0):!1}}function setBlockType(r,t=null){return function(n,s){let o=!1;for(let a=0;a<n.selection.ranges.length&&!o;a++){let{$from:{pos:c},$to:{pos:f}}=n.selection.ranges[a];n.doc.nodesBetween(c,f,(g,b)=>{if(o)return!1;if(!(!g.isTextblock||g.hasMarkup(r,t)))if(g.type==r)o=!0;else{let _=n.doc.resolve(b),L=_.index();o=_.parent.canReplaceWith(L,L+1,r)}})}if(!o)return!1;if(s){let a=n.tr;for(let c=0;c<n.selection.ranges.length;c++){let{$from:{pos:f},$to:{pos:g}}=n.selection.ranges[c];a.setBlockType(f,g,r,t)}s(a.scrollIntoView())}return!0}}function chainCommands(...r){return function(t,n,s){for(let o=0;o<r.length;o++)if(r[o](t,n,s))return!0;return!1}}chainCommands(deleteSelection$1,joinBackward$1,selectNodeBackward$1);chainCommands(deleteSelection$1,joinForward$1,selectNodeForward$1);chainCommands(newlineInCode$1,createParagraphNear$1,liftEmptyBlock$1,splitBlock$1);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function wrapInList$1(r,t=null){return function(n,s){let{$from:o,$to:a}=n.selection,c=o.blockRange(a);if(!c)return!1;let f=s?n.tr:null;return wrapRangeInList(f,c,r,t)?(s&&s(f.scrollIntoView()),!0):!1}}function wrapRangeInList(r,t,n,s=null){let o=!1,a=t,c=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(n)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let g=c.resolve(t.start-2);a=new NodeRange(g,g,t.depth),t.endIndex<t.parent.childCount&&(t=new NodeRange(t.$from,c.resolve(t.$to.end(t.depth)),t.depth)),o=!0}let f=findWrapping(a,n,s,t);return f?(r&&doWrapInList(r,t,f,o,n),!0):!1}function doWrapInList(r,t,n,s,o){let a=Fragment.empty;for(let _=n.length-1;_>=0;_--)a=Fragment.from(n[_].type.create(n[_].attrs,a));r.step(new ReplaceAroundStep(t.start-(s?2:0),t.end,t.start,t.end,new Slice(a,0,0),n.length,!0));let c=0;for(let _=0;_<n.length;_++)n[_].type==o&&(c=_+1);let f=n.length-c,g=t.start+n.length-(s?2:0),b=t.parent;for(let _=t.startIndex,L=t.endIndex,q=!0;_<L;_++,q=!1)!q&&canSplit(r.doc,g,f)&&(r.split(g,f),g+=2*f),g+=b.child(_).nodeSize;return r}function liftListItem$1(r){return function(t,n){let{$from:s,$to:o}=t.selection,a=s.blockRange(o,c=>c.childCount>0&&c.firstChild.type==r);return a?n?s.node(a.depth-1).type==r?liftToOuterList(t,n,r,a):liftOutOfList(t,n,a):!0:!1}}function liftToOuterList(r,t,n,s){let o=r.tr,a=s.end,c=s.$to.end(s.depth);a<c&&(o.step(new ReplaceAroundStep(a-1,c,a,c,new Slice(Fragment.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new NodeRange(o.doc.resolve(s.$from.pos),o.doc.resolve(c),s.depth));const f=liftTarget(s);if(f==null)return!1;o.lift(s,f);let g=o.doc.resolve(o.mapping.map(a,-1)-1);return canJoin(o.doc,g.pos)&&g.nodeBefore.type==g.nodeAfter.type&&o.join(g.pos),t(o.scrollIntoView()),!0}function liftOutOfList(r,t,n){let s=r.tr,o=n.parent;for(let X=n.end,te=n.endIndex-1,ne=n.startIndex;te>ne;te--)X-=o.child(te).nodeSize,s.delete(X-1,X+1);let a=s.doc.resolve(n.start),c=a.nodeAfter;if(s.mapping.map(n.end)!=n.start+a.nodeAfter.nodeSize)return!1;let f=n.startIndex==0,g=n.endIndex==o.childCount,b=a.node(-1),_=a.index(-1);if(!b.canReplace(_+(f?0:1),_+1,c.content.append(g?Fragment.empty:Fragment.from(o))))return!1;let L=a.pos,q=L+c.nodeSize;return s.step(new ReplaceAroundStep(L-(f?1:0),q+(g?1:0),L+1,q-1,new Slice((f?Fragment.empty:Fragment.from(o.copy(Fragment.empty))).append(g?Fragment.empty:Fragment.from(o.copy(Fragment.empty))),f?0:1,g?0:1),f?0:1)),t(s.scrollIntoView()),!0}function sinkListItem$1(r){return function(t,n){let{$from:s,$to:o}=t.selection,a=s.blockRange(o,b=>b.childCount>0&&b.firstChild.type==r);if(!a)return!1;let c=a.startIndex;if(c==0)return!1;let f=a.parent,g=f.child(c-1);if(g.type!=r)return!1;if(n){let b=g.lastChild&&g.lastChild.type==f.type,_=Fragment.from(b?r.create():null),L=new Slice(Fragment.from(r.create(null,Fragment.from(f.type.create(null,_)))),b?3:1,0),q=a.start,X=a.end;n(t.tr.step(new ReplaceAroundStep(q-(b?3:1),X,q,X,L,1,!0)).scrollIntoView())}return!0}}function createChainableState(r){const{state:t,transaction:n}=r;let{selection:s}=n,{doc:o}=n,{storedMarks:a}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return a},get selection(){return s},get doc(){return o},get tr(){return s=n.selection,o=n.doc,a=n.storedMarks,n}}}class CommandManager{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:n,state:s}=this,{view:o}=n,{tr:a}=s,c=this.buildProps(a);return Object.fromEntries(Object.entries(t).map(([f,g])=>[f,(..._)=>{const L=g(..._)(c);return!a.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(a),L}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,n=!0){const{rawCommands:s,editor:o,state:a}=this,{view:c}=o,f=[],g=!!t,b=t||a.tr,_=()=>(!g&&n&&!b.getMeta("preventDispatch")&&!this.hasCustomState&&c.dispatch(b),f.every(q=>q===!0)),L={...Object.fromEntries(Object.entries(s).map(([q,X])=>[q,(...ne)=>{const Ce=this.buildProps(b,n),Le=X(...ne)(Ce);return f.push(Le),L}])),run:_};return L}createCan(t){const{rawCommands:n,state:s}=this,o=!1,a=t||s.tr,c=this.buildProps(a,o);return{...Object.fromEntries(Object.entries(n).map(([g,b])=>[g,(..._)=>b(..._)({...c,dispatch:void 0})])),chain:()=>this.createChain(a,o)}}buildProps(t,n=!0){const{rawCommands:s,editor:o,state:a}=this,{view:c}=o,f={tr:t,editor:o,view:c,state:createChainableState({state:a,transaction:t}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(t,n),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(s).map(([g,b])=>[g,(..._)=>b(..._)(f)]))}};return f}}function getExtensionField(r,t,n){return r.config[t]===void 0&&r.parent?getExtensionField(r.parent,t,n):typeof r.config[t]=="function"?r.config[t].bind({...n,parent:r.parent?getExtensionField(r.parent,t,n):null}):r.config[t]}function splitExtensions(r){const t=r.filter(o=>o.type==="extension"),n=r.filter(o=>o.type==="node"),s=r.filter(o=>o.type==="mark");return{baseExtensions:t,nodeExtensions:n,markExtensions:s}}function getNodeType(r,t){if(typeof r=="string"){if(!t.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return t.nodes[r]}return r}function mergeAttributes(...r){return r.filter(t=>!!t).reduce((t,n)=>{const s={...t};return Object.entries(n).forEach(([o,a])=>{if(!s[o]){s[o]=a;return}if(o==="class"){const f=a?String(a).split(" "):[],g=s[o]?s[o].split(" "):[],b=f.filter(_=>!g.includes(_));s[o]=[...g,...b].join(" ")}else if(o==="style"){const f=a?a.split(";").map(_=>_.trim()).filter(Boolean):[],g=s[o]?s[o].split(";").map(_=>_.trim()).filter(Boolean):[],b=new Map;g.forEach(_=>{const[L,q]=_.split(":").map(X=>X.trim());b.set(L,q)}),f.forEach(_=>{const[L,q]=_.split(":").map(X=>X.trim());b.set(L,q)}),s[o]=Array.from(b.entries()).map(([_,L])=>`${_}: ${L}`).join("; ")}else s[o]=a}),s},{})}function isFunction$1(r){return typeof r=="function"}function callOrReturn(r,t=void 0,...n){return isFunction$1(r)?t?r.bind(t)(...n):r(...n):r}function isRegExp$1(r){return Object.prototype.toString.call(r)==="[object RegExp]"}class InputRule{constructor(t){this.find=t.find,this.handler=t.handler}}function getType(r){return Object.prototype.toString.call(r).slice(8,-1)}function isPlainObject(r){return getType(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function mergeDeep(r,t){const n={...r};return isPlainObject(r)&&isPlainObject(t)&&Object.keys(t).forEach(s=>{isPlainObject(t[s])&&isPlainObject(r[s])?n[s]=mergeDeep(r[s],t[s]):n[s]=t[s]}),n}class Mark{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Mark(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new Mark(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:t,mark:n}){const{tr:s}=t.state,o=t.state.selection.$from;if(o.pos===o.end()){const c=o.marks();if(!!!c.find(b=>b?.type.name===n.name))return!1;const g=c.find(b=>b?.type.name===n.name);return g&&s.removeStoredMark(g),s.insertText(" ",o.pos),t.view.dispatch(s),!0}return!1}}class PasteRule{constructor(t){this.find=t.find,this.handler=t.handler}}class Extension{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Extension(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new Extension({...this.config,...t});return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}}function getTextBetween(r,t,n){const{from:s,to:o}=t,{blockSeparator:a=`

`,textSerializers:c={}}=n||{};let f="";return r.nodesBetween(s,o,(g,b,_,L)=>{var q;g.isBlock&&b>s&&(f+=a);const X=c?.[g.type.name];if(X)return _&&(f+=X({node:g,pos:b,parent:_,index:L,range:t})),!1;g.isText&&(f+=(q=g?.text)===null||q===void 0?void 0:q.slice(Math.max(s,b)-b,o-b))}),f}function getTextSerializersFromSchema(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,t])=>t.spec.toText).map(([t,n])=>[t,n.spec.toText]))}Extension.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:t,schema:n}=r,{doc:s,selection:o}=t,{ranges:a}=o,c=Math.min(...a.map(_=>_.$from.pos)),f=Math.max(...a.map(_=>_.$to.pos)),g=getTextSerializersFromSchema(n);return getTextBetween(s,{from:c,to:f},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:g})}}})]}});const blur=()=>({editor:r,view:t})=>(requestAnimationFrame(()=>{var n;r.isDestroyed||(t.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),clearContent=(r=!1)=>({commands:t})=>t.setContent("",r),clearNodes=()=>({state:r,tr:t,dispatch:n})=>{const{selection:s}=t,{ranges:o}=s;return n&&o.forEach(({$from:a,$to:c})=>{r.doc.nodesBetween(a.pos,c.pos,(f,g)=>{if(f.type.isText)return;const{doc:b,mapping:_}=t,L=b.resolve(_.map(g)),q=b.resolve(_.map(g+f.nodeSize)),X=L.blockRange(q);if(!X)return;const te=liftTarget(X);if(f.type.isTextblock){const{defaultType:ne}=L.parent.contentMatchAt(L.index());t.setNodeMarkup(X.start,ne)}(te||te===0)&&t.lift(X,te)})}),!0},command=r=>t=>r(t),createParagraphNear=()=>({state:r,dispatch:t})=>createParagraphNear$1(r,t),cut=(r,t)=>({editor:n,tr:s})=>{const{state:o}=n,a=o.doc.slice(r.from,r.to);s.deleteRange(r.from,r.to);const c=s.mapping.map(t);return s.insert(c,a.content),s.setSelection(new TextSelection(s.doc.resolve(Math.max(c-1,0)))),!0},deleteCurrentNode=()=>({tr:r,dispatch:t})=>{const{selection:n}=r,s=n.$anchor.node();if(s.content.size>0)return!1;const o=r.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s.type){if(t){const f=o.before(a),g=o.after(a);r.delete(f,g).scrollIntoView()}return!0}return!1},deleteNode=r=>({tr:t,state:n,dispatch:s})=>{const o=getNodeType(r,n.schema),a=t.selection.$anchor;for(let c=a.depth;c>0;c-=1)if(a.node(c).type===o){if(s){const g=a.before(c),b=a.after(c);t.delete(g,b).scrollIntoView()}return!0}return!1},deleteRange=r=>({tr:t,dispatch:n})=>{const{from:s,to:o}=r;return n&&t.delete(s,o),!0},deleteSelection=()=>({state:r,dispatch:t})=>deleteSelection$1(r,t),enter=()=>({commands:r})=>r.keyboardShortcut("Enter"),exitCode=()=>({state:r,dispatch:t})=>exitCode$1(r,t);function objectIncludes(r,t,n={strict:!0}){const s=Object.keys(t);return s.length?s.every(o=>n.strict?t[o]===r[o]:isRegExp$1(t[o])?t[o].test(r[o]):t[o]===r[o]):!0}function findMarkInSet(r,t,n={}){return r.find(s=>s.type===t&&objectIncludes(Object.fromEntries(Object.keys(n).map(o=>[o,s.attrs[o]])),n))}function isMarkInSet(r,t,n={}){return!!findMarkInSet(r,t,n)}function getMarkRange(r,t,n){var s;if(!r||!t)return;let o=r.parent.childAfter(r.parentOffset);if((!o.node||!o.node.marks.some(_=>_.type===t))&&(o=r.parent.childBefore(r.parentOffset)),!o.node||!o.node.marks.some(_=>_.type===t)||(n=n||((s=o.node.marks[0])===null||s===void 0?void 0:s.attrs),!findMarkInSet([...o.node.marks],t,n)))return;let c=o.index,f=r.start()+o.offset,g=c+1,b=f+o.node.nodeSize;for(;c>0&&isMarkInSet([...r.parent.child(c-1).marks],t,n);)c-=1,f-=r.parent.child(c).nodeSize;for(;g<r.parent.childCount&&isMarkInSet([...r.parent.child(g).marks],t,n);)b+=r.parent.child(g).nodeSize,g+=1;return{from:f,to:b}}function getMarkType(r,t){if(typeof r=="string"){if(!t.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return t.marks[r]}return r}const extendMarkRange=(r,t={})=>({tr:n,state:s,dispatch:o})=>{const a=getMarkType(r,s.schema),{doc:c,selection:f}=n,{$from:g,from:b,to:_}=f;if(o){const L=getMarkRange(g,a,t);if(L&&L.from<=b&&L.to>=_){const q=TextSelection.create(c,L.from,L.to);n.setSelection(q)}}return!0},first=r=>t=>{const n=typeof r=="function"?r(t):r;for(let s=0;s<n.length;s+=1)if(n[s](t))return!0;return!1};function isTextSelection(r){return r instanceof TextSelection}function minMax(r=0,t=0,n=0){return Math.min(Math.max(r,t),n)}function resolveFocusPosition(r,t=null){if(!t)return null;const n=Selection.atStart(r),s=Selection.atEnd(r);if(t==="start"||t===!0)return n;if(t==="end")return s;const o=n.from,a=s.to;return t==="all"?TextSelection.create(r,minMax(0,o,a),minMax(r.content.size,o,a)):TextSelection.create(r,minMax(t,o,a),minMax(t,o,a))}function isAndroid(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const focus=(r=null,t={})=>({editor:n,view:s,tr:o,dispatch:a})=>{t={scrollIntoView:!0,...t};const c=()=>{(isiOS()||isAndroid())&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),t?.scrollIntoView&&n.commands.scrollIntoView())})};if(s.hasFocus()&&r===null||r===!1)return!0;if(a&&r===null&&!isTextSelection(n.state.selection))return c(),!0;const f=resolveFocusPosition(o.doc,r)||n.state.selection,g=n.state.selection.eq(f);return a&&(g||o.setSelection(f),g&&o.storedMarks&&o.setStoredMarks(o.storedMarks),c()),!0},forEach=(r,t)=>n=>r.every((s,o)=>t(s,{...n,index:o})),insertContent=(r,t)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},r,t),removeWhitespaces=r=>{const t=r.childNodes;for(let n=t.length-1;n>=0;n-=1){const s=t[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?r.removeChild(s):s.nodeType===1&&removeWhitespaces(s)}return r};function elementFromString(r){const t=`<body>${r}</body>`,n=new window.DOMParser().parseFromString(t,"text/html").body;return removeWhitespaces(n)}function createNodeFromContent(r,t,n){if(r instanceof Node$1||r instanceof Fragment)return r;n={slice:!0,parseOptions:{},...n};const s=typeof r=="object"&&r!==null,o=typeof r=="string";if(s)try{if(Array.isArray(r)&&r.length>0)return Fragment.fromArray(r.map(f=>t.nodeFromJSON(f)));const c=t.nodeFromJSON(r);return n.errorOnInvalidContent&&c.check(),c}catch(a){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:a});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",a),createNodeFromContent("",t,n)}if(o){if(n.errorOnInvalidContent){let c=!1,f="";const g=new Schema({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:b=>(c=!0,f=typeof b=="string"?b:b.outerHTML,null)}]}})});if(n.slice?DOMParser.fromSchema(g).parseSlice(elementFromString(r),n.parseOptions):DOMParser.fromSchema(g).parse(elementFromString(r),n.parseOptions),n.errorOnInvalidContent&&c)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${f}`)})}const a=DOMParser.fromSchema(t);return n.slice?a.parseSlice(elementFromString(r),n.parseOptions).content:a.parse(elementFromString(r),n.parseOptions)}return createNodeFromContent("",t,n)}function selectionToInsertionEnd(r,t,n){const s=r.steps.length-1;if(s<t)return;const o=r.steps[s];if(!(o instanceof ReplaceStep||o instanceof ReplaceAroundStep))return;const a=r.mapping.maps[s];let c=0;a.forEach((f,g,b,_)=>{c===0&&(c=_)}),r.setSelection(Selection.near(r.doc.resolve(c),n))}const isFragment=r=>!("type"in r),insertContentAt=(r,t,n)=>({tr:s,dispatch:o,editor:a})=>{var c;if(o){n={parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let f;const g=Ce=>{a.emit("contentError",{editor:a,error:Ce,disableCollaboration:()=>{a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},b={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{createNodeFromContent(t,a.schema,{parseOptions:b,errorOnInvalidContent:!0})}catch(Ce){g(Ce)}try{f=createNodeFromContent(t,a.schema,{parseOptions:b,errorOnInvalidContent:(c=n.errorOnInvalidContent)!==null&&c!==void 0?c:a.options.enableContentCheck})}catch(Ce){return g(Ce),!1}let{from:_,to:L}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},q=!0,X=!0;if((isFragment(f)?f:[f]).forEach(Ce=>{Ce.check(),q=q?Ce.isText&&Ce.marks.length===0:!1,X=X?Ce.isBlock:!1}),_===L&&X){const{parent:Ce}=s.doc.resolve(_);Ce.isTextblock&&!Ce.type.spec.code&&!Ce.childCount&&(_-=1,L+=1)}let ne;if(q){if(Array.isArray(t))ne=t.map(Ce=>Ce.text||"").join("");else if(t instanceof Fragment){let Ce="";t.forEach(Le=>{Le.text&&(Ce+=Le.text)}),ne=Ce}else typeof t=="object"&&t&&t.text?ne=t.text:ne=t;s.insertText(ne,_,L)}else ne=f,s.replaceWith(_,L,ne);n.updateSelection&&selectionToInsertionEnd(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:_,text:ne}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:_,text:ne})}return!0},joinUp=()=>({state:r,dispatch:t})=>joinUp$1(r,t),joinDown=()=>({state:r,dispatch:t})=>joinDown$1(r,t),joinBackward=()=>({state:r,dispatch:t})=>joinBackward$1(r,t),joinForward=()=>({state:r,dispatch:t})=>joinForward$1(r,t),joinItemBackward=()=>({state:r,dispatch:t,tr:n})=>{try{const s=joinPoint(r.doc,r.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),t&&t(n),!0)}catch{return!1}},joinItemForward=()=>({state:r,dispatch:t,tr:n})=>{try{const s=joinPoint(r.doc,r.selection.$from.pos,1);return s==null?!1:(n.join(s,2),t&&t(n),!0)}catch{return!1}},joinTextblockBackward=()=>({state:r,dispatch:t})=>joinTextblockBackward$1(r,t),joinTextblockForward=()=>({state:r,dispatch:t})=>joinTextblockForward$1(r,t);function isMacOS(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function normalizeKeyName(r){const t=r.split(/-(?!$)/);let n=t[t.length-1];n==="Space"&&(n=" ");let s,o,a,c;for(let f=0;f<t.length-1;f+=1){const g=t[f];if(/^(cmd|meta|m)$/i.test(g))c=!0;else if(/^a(lt)?$/i.test(g))s=!0;else if(/^(c|ctrl|control)$/i.test(g))o=!0;else if(/^s(hift)?$/i.test(g))a=!0;else if(/^mod$/i.test(g))isiOS()||isMacOS()?c=!0:o=!0;else throw new Error(`Unrecognized modifier name: ${g}`)}return s&&(n=`Alt-${n}`),o&&(n=`Ctrl-${n}`),c&&(n=`Meta-${n}`),a&&(n=`Shift-${n}`),n}const keyboardShortcut=r=>({editor:t,view:n,tr:s,dispatch:o})=>{const a=normalizeKeyName(r).split(/-(?!$)/),c=a.find(b=>!["Alt","Ctrl","Meta","Shift"].includes(b)),f=new KeyboardEvent("keydown",{key:c==="Space"?" ":c,altKey:a.includes("Alt"),ctrlKey:a.includes("Ctrl"),metaKey:a.includes("Meta"),shiftKey:a.includes("Shift"),bubbles:!0,cancelable:!0}),g=t.captureTransaction(()=>{n.someProp("handleKeyDown",b=>b(n,f))});return g?.steps.forEach(b=>{const _=b.map(s.mapping);_&&o&&s.maybeStep(_)}),!0};function isNodeActive(r,t,n={}){const{from:s,to:o,empty:a}=r.selection,c=t?getNodeType(t,r.schema):null,f=[];r.doc.nodesBetween(s,o,(L,q)=>{if(L.isText)return;const X=Math.max(s,q),te=Math.min(o,q+L.nodeSize);f.push({node:L,from:X,to:te})});const g=o-s,b=f.filter(L=>c?c.name===L.node.type.name:!0).filter(L=>objectIncludes(L.node.attrs,n,{strict:!1}));return a?!!b.length:b.reduce((L,q)=>L+q.to-q.from,0)>=g}const lift=(r,t={})=>({state:n,dispatch:s})=>{const o=getNodeType(r,n.schema);return isNodeActive(n,o,t)?lift$1(n,s):!1},liftEmptyBlock=()=>({state:r,dispatch:t})=>liftEmptyBlock$1(r,t),liftListItem=r=>({state:t,dispatch:n})=>{const s=getNodeType(r,t.schema);return liftListItem$1(s)(t,n)},newlineInCode=()=>({state:r,dispatch:t})=>newlineInCode$1(r,t);function getSchemaTypeNameByName(r,t){return t.nodes[r]?"node":t.marks[r]?"mark":null}function deleteProps(r,t){const n=typeof t=="string"?[t]:t;return Object.keys(r).reduce((s,o)=>(n.includes(o)||(s[o]=r[o]),s),{})}const resetAttributes=(r,t)=>({tr:n,state:s,dispatch:o})=>{let a=null,c=null;const f=getSchemaTypeNameByName(typeof r=="string"?r:r.name,s.schema);return f?(f==="node"&&(a=getNodeType(r,s.schema)),f==="mark"&&(c=getMarkType(r,s.schema)),o&&n.selection.ranges.forEach(g=>{s.doc.nodesBetween(g.$from.pos,g.$to.pos,(b,_)=>{a&&a===b.type&&n.setNodeMarkup(_,void 0,deleteProps(b.attrs,t)),c&&b.marks.length&&b.marks.forEach(L=>{c===L.type&&n.addMark(_,_+b.nodeSize,c.create(deleteProps(L.attrs,t)))})})}),!0):!1},scrollIntoView=()=>({tr:r,dispatch:t})=>(t&&r.scrollIntoView(),!0),selectAll=()=>({tr:r,dispatch:t})=>{if(t){const n=new AllSelection(r.doc);r.setSelection(n)}return!0},selectNodeBackward=()=>({state:r,dispatch:t})=>selectNodeBackward$1(r,t),selectNodeForward=()=>({state:r,dispatch:t})=>selectNodeForward$1(r,t),selectParentNode=()=>({state:r,dispatch:t})=>selectParentNode$1(r,t),selectTextblockEnd=()=>({state:r,dispatch:t})=>selectTextblockEnd$1(r,t),selectTextblockStart=()=>({state:r,dispatch:t})=>selectTextblockStart$1(r,t);function createDocument(r,t,n={},s={}){return createNodeFromContent(r,t,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}const setContent=(r,t=!1,n={},s={})=>({editor:o,tr:a,dispatch:c,commands:f})=>{var g,b;const{doc:_}=a;if(n.preserveWhitespace!=="full"){const L=createDocument(r,o.schema,n,{errorOnInvalidContent:(g=s.errorOnInvalidContent)!==null&&g!==void 0?g:o.options.enableContentCheck});return c&&a.replaceWith(0,_.content.size,L).setMeta("preventUpdate",!t),!0}return c&&a.setMeta("preventUpdate",!t),f.insertContentAt({from:0,to:_.content.size},r,{parseOptions:n,errorOnInvalidContent:(b=s.errorOnInvalidContent)!==null&&b!==void 0?b:o.options.enableContentCheck})};function getMarkAttributes(r,t){const n=getMarkType(t,r.schema),{from:s,to:o,empty:a}=r.selection,c=[];a?(r.storedMarks&&c.push(...r.storedMarks),c.push(...r.selection.$head.marks())):r.doc.nodesBetween(s,o,g=>{c.push(...g.marks)});const f=c.find(g=>g.type.name===n.name);return f?{...f.attrs}:{}}function combineTransactionSteps(r,t){const n=new Transform(r);return t.forEach(s=>{s.steps.forEach(o=>{n.step(o)})}),n}function defaultBlockAt(r){for(let t=0;t<r.edgeCount;t+=1){const{type:n}=r.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function findChildrenInRange(r,t,n){const s=[];return r.nodesBetween(t.from,t.to,(o,a)=>{n(o)&&s.push({node:o,pos:a})}),s}function findParentNodeClosestToPos(r,t){for(let n=r.depth;n>0;n-=1){const s=r.node(n);if(t(s))return{pos:n>0?r.before(n):0,start:r.start(n),depth:n,node:s}}}function findParentNode(r){return t=>findParentNodeClosestToPos(t.$from,r)}function getNodeAttributes(r,t){const n=getNodeType(t,r.schema),{from:s,to:o}=r.selection,a=[];r.doc.nodesBetween(s,o,f=>{a.push(f)});const c=a.reverse().find(f=>f.type.name===n.name);return c?{...c.attrs}:{}}function getAttributes(r,t){const n=getSchemaTypeNameByName(typeof t=="string"?t:t.name,r.schema);return n==="node"?getNodeAttributes(r,t):n==="mark"?getMarkAttributes(r,t):{}}function removeDuplicates(r,t=JSON.stringify){const n={};return r.filter(s=>{const o=t(s);return Object.prototype.hasOwnProperty.call(n,o)?!1:n[o]=!0})}function simplifyChangedRanges(r){const t=removeDuplicates(r);return t.length===1?t:t.filter((n,s)=>!t.filter((a,c)=>c!==s).some(a=>n.oldRange.from>=a.oldRange.from&&n.oldRange.to<=a.oldRange.to&&n.newRange.from>=a.newRange.from&&n.newRange.to<=a.newRange.to))}function getChangedRanges(r){const{mapping:t,steps:n}=r,s=[];return t.maps.forEach((o,a)=>{const c=[];if(o.ranges.length)o.forEach((f,g)=>{c.push({from:f,to:g})});else{const{from:f,to:g}=n[a];if(f===void 0||g===void 0)return;c.push({from:f,to:g})}c.forEach(({from:f,to:g})=>{const b=t.slice(a).map(f,-1),_=t.slice(a).map(g),L=t.invert().map(b,-1),q=t.invert().map(_);s.push({oldRange:{from:L,to:q},newRange:{from:b,to:_}})})}),simplifyChangedRanges(s)}function getMarksBetween(r,t,n){const s=[];return r===t?n.resolve(r).marks().forEach(o=>{const a=n.resolve(r),c=getMarkRange(a,o.type);c&&s.push({mark:o,...c})}):n.nodesBetween(r,t,(o,a)=>{!o||o?.nodeSize===void 0||s.push(...o.marks.map(c=>({from:a,to:a+o.nodeSize,mark:c})))}),s}function getSplittedAttributes(r,t,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const o=r.find(a=>a.type===t&&a.name===s);return o?o.attribute.keepOnSplit:!1}))}function isMarkActive(r,t,n={}){const{empty:s,ranges:o}=r.selection,a=t?getMarkType(t,r.schema):null;if(s)return!!(r.storedMarks||r.selection.$from.marks()).filter(L=>a?a.name===L.type.name:!0).find(L=>objectIncludes(L.attrs,n,{strict:!1}));let c=0;const f=[];if(o.forEach(({$from:L,$to:q})=>{const X=L.pos,te=q.pos;r.doc.nodesBetween(X,te,(ne,Ce)=>{if(!ne.isText&&!ne.marks.length)return;const Le=Math.max(X,Ce),Ge=Math.min(te,Ce+ne.nodeSize),ze=Ge-Le;c+=ze,f.push(...ne.marks.map(Xe=>({mark:Xe,from:Le,to:Ge})))})}),c===0)return!1;const g=f.filter(L=>a?a.name===L.mark.type.name:!0).filter(L=>objectIncludes(L.mark.attrs,n,{strict:!1})).reduce((L,q)=>L+q.to-q.from,0),b=f.filter(L=>a?L.mark.type!==a&&L.mark.type.excludes(a):!0).reduce((L,q)=>L+q.to-q.from,0);return(g>0?g+b:g)>=c}function isList(r,t){const{nodeExtensions:n}=splitExtensions(t),s=n.find(c=>c.name===r);if(!s)return!1;const o={name:s.name,options:s.options,storage:s.storage},a=callOrReturn(getExtensionField(s,"group",o));return typeof a!="string"?!1:a.split(" ").includes("list")}function isNodeEmpty(r,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((s=r.text)!==null&&s!==void 0?s:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(t){let o=!0;return r.content.forEach(a=>{o!==!1&&(isNodeEmpty(a,{ignoreWhitespace:n,checkChildren:t})||(o=!1))}),o}return!1}function isNodeSelection(r){return r instanceof NodeSelection}function canSetMark(r,t,n){var s;const{selection:o}=t;let a=null;if(isTextSelection(o)&&(a=o.$cursor),a){const f=(s=r.storedMarks)!==null&&s!==void 0?s:a.marks();return!!n.isInSet(f)||!f.some(g=>g.type.excludes(n))}const{ranges:c}=o;return c.some(({$from:f,$to:g})=>{let b=f.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(n):!1;return r.doc.nodesBetween(f.pos,g.pos,(_,L,q)=>{if(b)return!1;if(_.isInline){const X=!q||q.type.allowsMarkType(n),te=!!n.isInSet(_.marks)||!_.marks.some(ne=>ne.type.excludes(n));b=X&&te}return!b}),b})}const setMark=(r,t={})=>({tr:n,state:s,dispatch:o})=>{const{selection:a}=n,{empty:c,ranges:f}=a,g=getMarkType(r,s.schema);if(o)if(c){const b=getMarkAttributes(s,g);n.addStoredMark(g.create({...b,...t}))}else f.forEach(b=>{const _=b.$from.pos,L=b.$to.pos;s.doc.nodesBetween(_,L,(q,X)=>{const te=Math.max(X,_),ne=Math.min(X+q.nodeSize,L);q.marks.find(Le=>Le.type===g)?q.marks.forEach(Le=>{g===Le.type&&n.addMark(te,ne,g.create({...Le.attrs,...t}))}):n.addMark(te,ne,g.create(t))})});return canSetMark(s,n,g)},setMeta=(r,t)=>({tr:n})=>(n.setMeta(r,t),!0),setNode=(r,t={})=>({state:n,dispatch:s,chain:o})=>{const a=getNodeType(r,n.schema);let c;return n.selection.$anchor.sameParent(n.selection.$head)&&(c=n.selection.$anchor.parent.attrs),a.isTextblock?o().command(({commands:f})=>setBlockType(a,{...c,...t})(n)?!0:f.clearNodes()).command(({state:f})=>setBlockType(a,{...c,...t})(f,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection=r=>({tr:t,dispatch:n})=>{if(n){const{doc:s}=t,o=minMax(r,0,s.content.size),a=NodeSelection.create(s,o);t.setSelection(a)}return!0},setTextSelection=r=>({tr:t,dispatch:n})=>{if(n){const{doc:s}=t,{from:o,to:a}=typeof r=="number"?{from:r,to:r}:r,c=TextSelection.atStart(s).from,f=TextSelection.atEnd(s).to,g=minMax(o,c,f),b=minMax(a,c,f),_=TextSelection.create(s,g,b);t.setSelection(_)}return!0},sinkListItem=r=>({state:t,dispatch:n})=>{const s=getNodeType(r,t.schema);return sinkListItem$1(s)(t,n)};function ensureMarks(r,t){const n=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(n){const s=n.filter(o=>t?.includes(o.type.name));r.tr.ensureMarks(s)}}const splitBlock=({keepMarks:r=!0}={})=>({tr:t,state:n,dispatch:s,editor:o})=>{const{selection:a,doc:c}=t,{$from:f,$to:g}=a,b=o.extensionManager.attributes,_=getSplittedAttributes(b,f.node().type.name,f.node().attrs);if(a instanceof NodeSelection&&a.node.isBlock)return!f.parentOffset||!canSplit(c,f.pos)?!1:(s&&(r&&ensureMarks(n,o.extensionManager.splittableMarks),t.split(f.pos).scrollIntoView()),!0);if(!f.parent.isBlock)return!1;const L=g.parentOffset===g.parent.content.size,q=f.depth===0?void 0:defaultBlockAt(f.node(-1).contentMatchAt(f.indexAfter(-1)));let X=L&&q?[{type:q,attrs:_}]:void 0,te=canSplit(t.doc,t.mapping.map(f.pos),1,X);if(!X&&!te&&canSplit(t.doc,t.mapping.map(f.pos),1,q?[{type:q}]:void 0)&&(te=!0,X=q?[{type:q,attrs:_}]:void 0),s){if(te&&(a instanceof TextSelection&&t.deleteSelection(),t.split(t.mapping.map(f.pos),1,X),q&&!L&&!f.parentOffset&&f.parent.type!==q)){const ne=t.mapping.map(f.before()),Ce=t.doc.resolve(ne);f.node(-1).canReplaceWith(Ce.index(),Ce.index()+1,q)&&t.setNodeMarkup(t.mapping.map(f.before()),q)}r&&ensureMarks(n,o.extensionManager.splittableMarks),t.scrollIntoView()}return te},splitListItem=(r,t={})=>({tr:n,state:s,dispatch:o,editor:a})=>{var c;const f=getNodeType(r,s.schema),{$from:g,$to:b}=s.selection,_=s.selection.node;if(_&&_.isBlock||g.depth<2||!g.sameParent(b))return!1;const L=g.node(-1);if(L.type!==f)return!1;const q=a.extensionManager.attributes;if(g.parent.content.size===0&&g.node(-1).childCount===g.indexAfter(-1)){if(g.depth===2||g.node(-3).type!==f||g.index(-2)!==g.node(-2).childCount-1)return!1;if(o){let Le=Fragment.empty;const Ge=g.index(-1)?1:g.index(-2)?2:3;for(let rt=g.depth-Ge;rt>=g.depth-3;rt-=1)Le=Fragment.from(g.node(rt).copy(Le));const ze=g.indexAfter(-1)<g.node(-2).childCount?1:g.indexAfter(-2)<g.node(-3).childCount?2:3,Xe={...getSplittedAttributes(q,g.node().type.name,g.node().attrs),...t},He=((c=f.contentMatch.defaultType)===null||c===void 0?void 0:c.createAndFill(Xe))||void 0;Le=Le.append(Fragment.from(f.createAndFill(null,He)||void 0));const Ve=g.before(g.depth-(Ge-1));n.replace(Ve,g.after(-ze),new Slice(Le,4-Ge,0));let We=-1;n.doc.nodesBetween(Ve,n.doc.content.size,(rt,st)=>{if(We>-1)return!1;rt.isTextblock&&rt.content.size===0&&(We=st+1)}),We>-1&&n.setSelection(TextSelection.near(n.doc.resolve(We))),n.scrollIntoView()}return!0}const X=b.pos===g.end()?L.contentMatchAt(0).defaultType:null,te={...getSplittedAttributes(q,L.type.name,L.attrs),...t},ne={...getSplittedAttributes(q,g.node().type.name,g.node().attrs),...t};n.delete(g.pos,b.pos);const Ce=X?[{type:f,attrs:te},{type:X,attrs:ne}]:[{type:f,attrs:te}];if(!canSplit(n.doc,g.pos,2))return!1;if(o){const{selection:Le,storedMarks:Ge}=s,{splittableMarks:ze}=a.extensionManager,Xe=Ge||Le.$to.parentOffset&&Le.$from.marks();if(n.split(g.pos,2,Ce).scrollIntoView(),!Xe||!o)return!0;const He=Xe.filter(Ve=>ze.includes(Ve.type.name));n.ensureMarks(He)}return!0},joinListBackwards=(r,t)=>{const n=findParentNode(c=>c.type===t)(r.selection);if(!n)return!0;const s=r.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const o=r.doc.nodeAt(s);return n.node.type===o?.type&&canJoin(r.doc,n.pos)&&r.join(n.pos),!0},joinListForwards=(r,t)=>{const n=findParentNode(c=>c.type===t)(r.selection);if(!n)return!0;const s=r.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const o=r.doc.nodeAt(s);return n.node.type===o?.type&&canJoin(r.doc,s)&&r.join(s),!0},toggleList=(r,t,n,s={})=>({editor:o,tr:a,state:c,dispatch:f,chain:g,commands:b,can:_})=>{const{extensions:L,splittableMarks:q}=o.extensionManager,X=getNodeType(r,c.schema),te=getNodeType(t,c.schema),{selection:ne,storedMarks:Ce}=c,{$from:Le,$to:Ge}=ne,ze=Le.blockRange(Ge),Xe=Ce||ne.$to.parentOffset&&ne.$from.marks();if(!ze)return!1;const He=findParentNode(Ve=>isList(Ve.type.name,L))(ne);if(ze.depth>=1&&He&&ze.depth-He.depth<=1){if(He.node.type===X)return b.liftListItem(te);if(isList(He.node.type.name,L)&&X.validContent(He.node.content)&&f)return g().command(()=>(a.setNodeMarkup(He.pos,X),!0)).command(()=>joinListBackwards(a,X)).command(()=>joinListForwards(a,X)).run()}return!n||!Xe||!f?g().command(()=>_().wrapInList(X,s)?!0:b.clearNodes()).wrapInList(X,s).command(()=>joinListBackwards(a,X)).command(()=>joinListForwards(a,X)).run():g().command(()=>{const Ve=_().wrapInList(X,s),We=Xe.filter(rt=>q.includes(rt.type.name));return a.ensureMarks(We),Ve?!0:b.clearNodes()}).wrapInList(X,s).command(()=>joinListBackwards(a,X)).command(()=>joinListForwards(a,X)).run()},toggleMark=(r,t={},n={})=>({state:s,commands:o})=>{const{extendEmptyMarkRange:a=!1}=n,c=getMarkType(r,s.schema);return isMarkActive(s,c,t)?o.unsetMark(c,{extendEmptyMarkRange:a}):o.setMark(c,t)},toggleNode=(r,t,n={})=>({state:s,commands:o})=>{const a=getNodeType(r,s.schema),c=getNodeType(t,s.schema),f=isNodeActive(s,a,n);let g;return s.selection.$anchor.sameParent(s.selection.$head)&&(g=s.selection.$anchor.parent.attrs),f?o.setNode(c,g):o.setNode(a,{...g,...n})},toggleWrap=(r,t={})=>({state:n,commands:s})=>{const o=getNodeType(r,n.schema);return isNodeActive(n,o,t)?s.lift(o):s.wrapIn(o,t)},undoInputRule=()=>({state:r,dispatch:t})=>{const n=r.plugins;for(let s=0;s<n.length;s+=1){const o=n[s];let a;if(o.spec.isInputRules&&(a=o.getState(r))){if(t){const c=r.tr,f=a.transform;for(let g=f.steps.length-1;g>=0;g-=1)c.step(f.steps[g].invert(f.docs[g]));if(a.text){const g=c.doc.resolve(a.from).marks();c.replaceWith(a.from,a.to,r.schema.text(a.text,g))}else c.delete(a.from,a.to)}return!0}}return!1},unsetAllMarks=()=>({tr:r,dispatch:t})=>{const{selection:n}=r,{empty:s,ranges:o}=n;return s||t&&o.forEach(a=>{r.removeMark(a.$from.pos,a.$to.pos)}),!0},unsetMark=(r,t={})=>({tr:n,state:s,dispatch:o})=>{var a;const{extendEmptyMarkRange:c=!1}=t,{selection:f}=n,g=getMarkType(r,s.schema),{$from:b,empty:_,ranges:L}=f;if(!o)return!0;if(_&&c){let{from:q,to:X}=f;const te=(a=b.marks().find(Ce=>Ce.type===g))===null||a===void 0?void 0:a.attrs,ne=getMarkRange(b,g,te);ne&&(q=ne.from,X=ne.to),n.removeMark(q,X,g)}else L.forEach(q=>{n.removeMark(q.$from.pos,q.$to.pos,g)});return n.removeStoredMark(g),!0},updateAttributes=(r,t={})=>({tr:n,state:s,dispatch:o})=>{let a=null,c=null;const f=getSchemaTypeNameByName(typeof r=="string"?r:r.name,s.schema);return f?(f==="node"&&(a=getNodeType(r,s.schema)),f==="mark"&&(c=getMarkType(r,s.schema)),o&&n.selection.ranges.forEach(g=>{const b=g.$from.pos,_=g.$to.pos;let L,q,X,te;n.selection.empty?s.doc.nodesBetween(b,_,(ne,Ce)=>{a&&a===ne.type&&(X=Math.max(Ce,b),te=Math.min(Ce+ne.nodeSize,_),L=Ce,q=ne)}):s.doc.nodesBetween(b,_,(ne,Ce)=>{Ce<b&&a&&a===ne.type&&(X=Math.max(Ce,b),te=Math.min(Ce+ne.nodeSize,_),L=Ce,q=ne),Ce>=b&&Ce<=_&&(a&&a===ne.type&&n.setNodeMarkup(Ce,void 0,{...ne.attrs,...t}),c&&ne.marks.length&&ne.marks.forEach(Le=>{if(c===Le.type){const Ge=Math.max(Ce,b),ze=Math.min(Ce+ne.nodeSize,_);n.addMark(Ge,ze,c.create({...Le.attrs,...t}))}}))}),q&&(L!==void 0&&n.setNodeMarkup(L,void 0,{...q.attrs,...t}),c&&q.marks.length&&q.marks.forEach(ne=>{c===ne.type&&n.addMark(X,te,c.create({...ne.attrs,...t}))}))}),!0):!1},wrapIn=(r,t={})=>({state:n,dispatch:s})=>{const o=getNodeType(r,n.schema);return wrapIn$1(o,t)(n,s)},wrapInList=(r,t={})=>({state:n,dispatch:s})=>{const o=getNodeType(r,n.schema);return wrapInList$1(o,t)(n,s)};var commands=Object.freeze({__proto__:null,blur,clearContent,clearNodes,command,createParagraphNear,cut,deleteCurrentNode,deleteNode,deleteRange,deleteSelection,enter,exitCode,extendMarkRange,first,focus,forEach,insertContent,insertContentAt,joinBackward,joinDown,joinForward,joinItemBackward,joinItemForward,joinTextblockBackward,joinTextblockForward,joinUp,keyboardShortcut,lift,liftEmptyBlock,liftListItem,newlineInCode,resetAttributes,scrollIntoView,selectAll,selectNodeBackward,selectNodeForward,selectParentNode,selectTextblockEnd,selectTextblockStart,setContent,setMark,setMeta,setNode,setNodeSelection,setTextSelection,sinkListItem,splitBlock,splitListItem,toggleList,toggleMark,toggleNode,toggleWrap,undoInputRule,unsetAllMarks,unsetMark,updateAttributes,wrapIn,wrapInList});Extension.create({name:"commands",addCommands(){return{...commands}}});Extension.create({name:"drop",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapDrop"),props:{handleDrop:(r,t,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:s})}}})]}});Extension.create({name:"editable",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("editable"),props:{editable:()=>this.editor.options.editable}})]}});const focusEventsPluginKey=new PluginKey("focusEvents");Extension.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new Plugin({key:focusEventsPluginKey,props:{handleDOMEvents:{focus:(t,n)=>{r.isFocused=!0;const s=r.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,n)=>{r.isFocused=!1;const s=r.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}});Extension.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:c})=>[()=>c.undoInputRule(),()=>c.command(({tr:f})=>{const{selection:g,doc:b}=f,{empty:_,$anchor:L}=g,{pos:q,parent:X}=L,te=L.parent.isTextblock&&q>0?f.doc.resolve(q-1):L,ne=te.parent.type.spec.isolating,Ce=L.pos-L.parentOffset,Le=ne&&te.parent.childCount===1?Ce===L.pos:Selection.atStart(b).from===q;return!_||!X.type.isTextblock||X.textContent.length||!Le||Le&&L.parent.type.name==="paragraph"?!1:c.clearNodes()}),()=>c.deleteSelection(),()=>c.joinBackward(),()=>c.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:c})=>[()=>c.deleteSelection(),()=>c.deleteCurrentNode(),()=>c.joinForward(),()=>c.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:c})=>[()=>c.newlineInCode(),()=>c.createParagraphNear(),()=>c.liftEmptyBlock(),()=>c.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},o={...s},a={...s,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?a:o},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clearDocument"),appendTransaction:(r,t,n)=>{if(r.some(ne=>ne.getMeta("composition")))return;const s=r.some(ne=>ne.docChanged)&&!t.doc.eq(n.doc),o=r.some(ne=>ne.getMeta("preventClearDocument"));if(!s||o)return;const{empty:a,from:c,to:f}=t.selection,g=Selection.atStart(t.doc).from,b=Selection.atEnd(t.doc).to;if(a||!(c===g&&f===b)||!isNodeEmpty(n.doc))return;const q=n.tr,X=createChainableState({state:n,transaction:q}),{commands:te}=new CommandManager({editor:this.editor,state:X});if(te.clearNodes(),!!q.steps.length)return q}})]}});Extension.create({name:"paste",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tiptapPaste"),props:{handlePaste:(r,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}});Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});function markInputRule(r){return new InputRule({find:r.find,handler:({state:t,range:n,match:s})=>{const o=callOrReturn(r.getAttributes,void 0,s);if(o===!1||o===null)return null;const{tr:a}=t,c=s[s.length-1],f=s[0];if(c){const g=f.search(/\S/),b=n.from+f.indexOf(c),_=b+c.length;if(getMarksBetween(n.from,n.to,t.doc).filter(X=>X.mark.type.excluded.find(ne=>ne===r.type&&ne!==X.mark.type)).filter(X=>X.to>b).length)return null;_<n.to&&a.delete(_,n.to),b>n.from&&a.delete(n.from+g,b);const q=n.from+g+c.length;a.addMark(n.from+g,q,r.type.create(o||{})),a.removeStoredMark(r.type)}}})}function nodeInputRule(r){return new InputRule({find:r.find,handler:({state:t,range:n,match:s})=>{const o=callOrReturn(r.getAttributes,void 0,s)||{},{tr:a}=t,c=n.from;let f=n.to;const g=r.type.create(o);if(s[1]){const b=s[0].lastIndexOf(s[1]);let _=c+b;_>f?_=f:f=_+s[1].length;const L=s[0][s[0].length-1];a.insertText(L,c+s[0].length-1),a.replaceWith(_,f,g)}else if(s[0]){const b=r.type.isInline?c:c-1;a.insert(b,r.type.create(o)).delete(a.mapping.map(c),a.mapping.map(f))}a.scrollIntoView()}})}function textblockTypeInputRule(r){return new InputRule({find:r.find,handler:({state:t,range:n,match:s})=>{const o=t.doc.resolve(n.from),a=callOrReturn(r.getAttributes,void 0,s)||{};if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),r.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,r.type,a)}})}function wrappingInputRule(r){return new InputRule({find:r.find,handler:({state:t,range:n,match:s,chain:o})=>{const a=callOrReturn(r.getAttributes,void 0,s)||{},c=t.tr.delete(n.from,n.to),g=c.doc.resolve(n.from).blockRange(),b=g&&findWrapping(g,r.type,a);if(!b)return null;if(c.wrap(g,b),r.keepMarks&&r.editor){const{selection:L,storedMarks:q}=t,{splittableMarks:X}=r.editor.extensionManager,te=q||L.$to.parentOffset&&L.$from.marks();if(te){const ne=te.filter(Ce=>X.includes(Ce.type.name));c.ensureMarks(ne)}}if(r.keepAttributes){const L=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";o().updateAttributes(L,a).run()}const _=c.doc.resolve(n.from-1).nodeBefore;_&&_.type===r.type&&canJoin(c.doc,n.from-1)&&(!r.joinPredicate||r.joinPredicate(s,_))&&c.join(n.from-1)}})}class Node{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Node(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new Node(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=callOrReturn(getExtensionField(n,"addOptions",{name:n.name})),n.storage=callOrReturn(getExtensionField(n,"addStorage",{name:n.name,options:n.options})),n}}function markPasteRule(r){return new PasteRule({find:r.find,handler:({state:t,range:n,match:s,pasteEvent:o})=>{const a=callOrReturn(r.getAttributes,void 0,s,o);if(a===!1||a===null)return null;const{tr:c}=t,f=s[s.length-1],g=s[0];let b=n.to;if(f){const _=g.search(/\S/),L=n.from+g.indexOf(f),q=L+f.length;if(getMarksBetween(n.from,n.to,t.doc).filter(te=>te.mark.type.excluded.find(Ce=>Ce===r.type&&Ce!==te.mark.type)).filter(te=>te.to>L).length)return null;q<n.to&&c.delete(q,n.to),L>n.from&&c.delete(n.from+_,L),b=n.from+_+f.length,c.addMark(n.from+_,b,r.type.create(a||{})),c.removeStoredMark(r.type)}}})}function canInsertNode(r,t){const{selection:n}=r,{$from:s}=n;if(n instanceof NodeSelection){const a=s.index();return s.parent.canReplaceWith(a,a+1,t)}let o=s.depth;for(;o>=0;){const a=s.index(o);if(s.node(o).contentMatchAt(a).matchType(t))return!0;o-=1}return!1}function nodePasteRule(r){return new PasteRule({find:r.find,handler({match:t,chain:n,range:s,pasteEvent:o}){const a=callOrReturn(r.getAttributes,void 0,t,o),c=callOrReturn(r.getContent,void 0,a);if(a===!1||a===null)return null;const f={type:r.type.name,attrs:a};c&&(f.content=c),t.input&&n().deleteRange(s).insertContentAt(s.from,f)}})}const inputRegex$5=/^\s*>\s$/,Blockquote=Node.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return["blockquote",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[wrappingInputRule({find:inputRegex$5,type:this.type})]}}),starInputRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,starPasteRegex$1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,underscoreInputRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,underscorePasteRegex$1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Bold=Mark.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return["strong",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[markInputRule({find:starInputRegex$1,type:this.type}),markInputRule({find:underscoreInputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex$1,type:this.type}),markPasteRule({find:underscorePasteRegex$1,type:this.type})]}}),ListItemName$1="listItem",TextStyleName$1="textStyle",inputRegex$4=/^\s*([-+*])\s$/,BulletList=Node.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName$1,this.editor.getAttributes(TextStyleName$1)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=wrappingInputRule({find:inputRegex$4,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=wrappingInputRule({find:inputRegex$4,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(TextStyleName$1),editor:this.editor})),[r]}}),inputRegex$3=/(^|[^`])`([^`]+)`(?!`)/,pasteRegex$1=/(^|[^`])`([^`]+)`(?!`)/g,Code=Mark.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[markInputRule({find:inputRegex$3,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex$1,type:this.type})]}}),backtickInputRegex=/^```([a-z]+)?[\s\n]$/,tildeInputRegex=/^~~~([a-z]+)?[\s\n]$/,CodeBlock=Node.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var t;const{languageClassPrefix:n}=this.options,a=[...((t=r.firstElementChild)===null||t===void 0?void 0:t.classList)||[]].filter(c=>c.startsWith(n)).map(c=>c.replace(n,""))[0];return a||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:t}){return["pre",mergeAttributes(this.options.HTMLAttributes,t),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:t})=>t.setNode(this.name,r),toggleCodeBlock:r=>({commands:t})=>t.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!r||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=r,{selection:n}=t,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type)return!1;const a=s.parentOffset===s.parent.nodeSize-2,c=s.parent.textContent.endsWith(`

`);return!a||!c?!1:r.chain().command(({tr:f})=>(f.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=r,{selection:n,doc:s}=t,{$from:o,empty:a}=n;if(!a||o.parent.type!==this.type||!(o.parentOffset===o.parent.nodeSize-2))return!1;const f=o.after();return f===void 0?!1:s.nodeAt(f)?r.commands.command(({tr:b})=>(b.setSelection(Selection.near(s.resolve(f))),!0)):r.commands.exitCode()}}},addInputRules(){return[textblockTypeInputRule({find:backtickInputRegex,type:this.type,getAttributes:r=>({language:r[1]})}),textblockTypeInputRule({find:tildeInputRegex,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("codeBlockVSCodeHandler"),props:{handlePaste:(r,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),s=t.clipboardData.getData("vscode-editor-data"),o=s?JSON.parse(s):void 0,a=o?.mode;if(!n||!a)return!1;const{tr:c,schema:f}=r.state,g=f.text(n.replace(/\r\n?/g,`
`));return c.replaceSelectionWith(this.type.create({language:a},g)),c.selection.$from.parent.type!==this.type&&c.setSelection(TextSelection.near(c.doc.resolve(Math.max(0,c.selection.from-2)))),c.setMeta("paste",!0),r.dispatch(c),!0}}})]}}),Document=Node.create({name:"doc",topNode:!0,content:"block+"});function dropCursor(r={}){return new Plugin({view(t){return new DropCursorView(t,r)}})}class DropCursorView{constructor(t,n){var s;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=n.width)!==null&&s!==void 0?s:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(o=>{let a=c=>{this[o](c)};return t.dom.addEventListener(o,a),{name:o,handler:a}})}destroy(){this.handlers.forEach(({name:t,handler:n})=>this.editorView.dom.removeEventListener(t,n))}update(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,s,o=this.editorView.dom,a=o.getBoundingClientRect(),c=a.width/o.offsetWidth,f=a.height/o.offsetHeight;if(n){let L=t.nodeBefore,q=t.nodeAfter;if(L||q){let X=this.editorView.nodeDOM(this.cursorPos-(L?L.nodeSize:0));if(X){let te=X.getBoundingClientRect(),ne=L?te.bottom:te.top;L&&q&&(ne=(ne+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let Ce=this.width/2*f;s={left:te.left,right:te.right,top:ne-Ce,bottom:ne+Ce}}}}if(!s){let L=this.editorView.coordsAtPos(this.cursorPos),q=this.width/2*c;s={left:L.left-q,right:L.left+q,top:L.top,bottom:L.bottom}}let g=this.editorView.dom.offsetParent;this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let b,_;if(!g||g==document.body&&getComputedStyle(g).position=="static")b=-pageXOffset,_=-pageYOffset;else{let L=g.getBoundingClientRect(),q=L.width/g.offsetWidth,X=L.height/g.offsetHeight;b=L.left-g.scrollLeft*q,_=L.top-g.scrollTop*X}this.element.style.left=(s.left-b)/c+"px",this.element.style.top=(s.top-_)/f+"px",this.element.style.width=(s.right-s.left)/c+"px",this.element.style.height=(s.bottom-s.top)/f+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),s=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),o=s&&s.type.spec.disableDropCursor,a=typeof o=="function"?o(this.editorView,n,t):o;if(n&&!a){let c=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let f=dropPoint(this.editorView.state.doc,c,this.editorView.dragging.slice);f!=null&&(c=f)}this.setCursor(c),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}const Dropcursor=Extension.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[dropCursor(this.options)]}});class GapCursor extends Selection{constructor(t){super(t,t)}map(t,n){let s=t.resolve(n.map(this.head));return GapCursor.valid(s)?new GapCursor(s):Selection.near(s)}content(){return Slice.empty}eq(t){return t instanceof GapCursor&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(t.resolve(n.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid(t){let n=t.parent;if(n.isTextblock||!closedBefore(t)||!closedAfter(t))return!1;let s=n.type.spec.allowGapCursor;if(s!=null)return s;let o=n.contentMatchAt(t.index()).defaultType;return o&&o.isTextblock}static findGapCursorFrom(t,n,s=!1){e:for(;;){if(!s&&GapCursor.valid(t))return t;let o=t.pos,a=null;for(let c=t.depth;;c--){let f=t.node(c);if(n>0?t.indexAfter(c)<f.childCount:t.index(c)>0){a=f.child(n>0?t.indexAfter(c):t.index(c)-1);break}else if(c==0)return null;o+=n;let g=t.doc.resolve(o);if(GapCursor.valid(g))return g}for(;;){let c=n>0?a.firstChild:a.lastChild;if(!c){if(a.isAtom&&!a.isText&&!NodeSelection.isSelectable(a)){t=t.doc.resolve(o+a.nodeSize*n),s=!1;continue e}break}a=c,o+=n;let f=t.doc.resolve(o);if(GapCursor.valid(f))return f}return null}}}GapCursor.prototype.visible=!1;GapCursor.findFrom=GapCursor.findGapCursorFrom;Selection.jsonID("gapcursor",GapCursor);class GapBookmark{constructor(t){this.pos=t}map(t){return new GapBookmark(t.map(this.pos))}resolve(t){let n=t.resolve(this.pos);return GapCursor.valid(n)?new GapCursor(n):Selection.near(n)}}function needsGap(r){return r.isAtom||r.spec.isolating||r.spec.createGapCursor}function closedBefore(r){for(let t=r.depth;t>=0;t--){let n=r.index(t),s=r.node(t);if(n==0){if(s.type.spec.isolating)return!0;continue}for(let o=s.child(n-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||needsGap(o.type))return!0;if(o.inlineContent)return!1}}return!0}function closedAfter(r){for(let t=r.depth;t>=0;t--){let n=r.indexAfter(t),s=r.node(t);if(n==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let o=s.child(n);;o=o.firstChild){if(o.childCount==0&&!o.inlineContent||needsGap(o.type))return!0;if(o.inlineContent)return!1}}return!0}function gapCursor(){return new Plugin({props:{decorations:drawGapCursor,createSelectionBetween(r,t,n){return t.pos==n.pos&&GapCursor.valid(n)?new GapCursor(n):null},handleClick,handleKeyDown,handleDOMEvents:{beforeinput}}})}const handleKeyDown=keydownHandler({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(r,t){const n=r=="vert"?t>0?"down":"up":t>0?"right":"left";return function(s,o,a){let c=s.selection,f=t>0?c.$to:c.$from,g=c.empty;if(c instanceof TextSelection){if(!a.endOfTextblock(n)||f.depth==0)return!1;g=!1,f=s.doc.resolve(t>0?f.after():f.before())}let b=GapCursor.findGapCursorFrom(f,t,g);return b?(o&&o(s.tr.setSelection(new GapCursor(b))),!0):!1}}function handleClick(r,t,n){if(!r||!r.editable)return!1;let s=r.state.doc.resolve(t);if(!GapCursor.valid(s))return!1;let o=r.posAtCoords({left:n.clientX,top:n.clientY});return o&&o.inside>-1&&NodeSelection.isSelectable(r.state.doc.nodeAt(o.inside))?!1:(r.dispatch(r.state.tr.setSelection(new GapCursor(s))),!0)}function beforeinput(r,t){if(t.inputType!="insertCompositionText"||!(r.state.selection instanceof GapCursor))return!1;let{$from:n}=r.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(r.state.schema.nodes.text);if(!s)return!1;let o=Fragment.empty;for(let c=s.length-1;c>=0;c--)o=Fragment.from(s[c].createAndFill(null,o));let a=r.state.tr.replace(n.pos,n.pos,new Slice(o,0,0));return a.setSelection(TextSelection.near(a.doc.resolve(n.pos+1))),r.dispatch(a),!1}function drawGapCursor(r){if(!(r.selection instanceof GapCursor))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",DecorationSet.create(r.doc,[Decoration.widget(r.selection.head,t,{key:"gapcursor"})])}const Gapcursor=Extension.create({name:"gapCursor",addProseMirrorPlugins(){return[gapCursor()]},extendNodeSchema(r){var t;const n={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(t=callOrReturn(getExtensionField(r,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}}),HardBreak=Node.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",mergeAttributes(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:t,state:n,editor:s})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:o,storedMarks:a}=n;if(o.$from.parent.type.spec.isolating)return!1;const{keepMarks:c}=this.options,{splittableMarks:f}=s.extensionManager,g=a||o.$to.parentOffset&&o.$from.marks();return t().insertContent({type:this.name}).command(({tr:b,dispatch:_})=>{if(_&&g&&c){const L=g.filter(q=>f.includes(q.type.name));b.ensureMarks(L)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Heading=Node.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:t}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,mergeAttributes(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:r=>({commands:t})=>this.options.levels.includes(r.level)?t.setNode(this.name,r):!1,toggleHeading:r=>({commands:t})=>this.options.levels.includes(r.level)?t.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,t)=>({...r,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(r=>textblockTypeInputRule({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}});var GOOD_LEAF_SIZE=200,RopeSequence=function r(){};RopeSequence.prototype.append=function r(t){return t.length?(t=RopeSequence.from(t),!this.length&&t||t.length<GOOD_LEAF_SIZE&&this.leafAppend(t)||this.length<GOOD_LEAF_SIZE&&t.leafPrepend(this)||this.appendInner(t)):this};RopeSequence.prototype.prepend=function r(t){return t.length?RopeSequence.from(t).append(this):this};RopeSequence.prototype.appendInner=function r(t){return new Append(this,t)};RopeSequence.prototype.slice=function r(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?RopeSequence.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};RopeSequence.prototype.get=function r(t){if(!(t<0||t>=this.length))return this.getInner(t)};RopeSequence.prototype.forEach=function r(t,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length),n<=s?this.forEachInner(t,n,s,0):this.forEachInvertedInner(t,n,s,0)};RopeSequence.prototype.map=function r(t,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length);var o=[];return this.forEach(function(a,c){return o.push(t(a,c))},n,s),o};RopeSequence.from=function r(t){return t instanceof RopeSequence?t:t&&t.length?new Leaf(t):RopeSequence.empty};var Leaf=(function(r){function t(s){r.call(this),this.values=s}r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(o,a){return o==0&&a==this.length?this:new t(this.values.slice(o,a))},t.prototype.getInner=function(o){return this.values[o]},t.prototype.forEachInner=function(o,a,c,f){for(var g=a;g<c;g++)if(o(this.values[g],f+g)===!1)return!1},t.prototype.forEachInvertedInner=function(o,a,c,f){for(var g=a-1;g>=c;g--)if(o(this.values[g],f+g)===!1)return!1},t.prototype.leafAppend=function(o){if(this.length+o.length<=GOOD_LEAF_SIZE)return new t(this.values.concat(o.flatten()))},t.prototype.leafPrepend=function(o){if(this.length+o.length<=GOOD_LEAF_SIZE)return new t(o.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t})(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=(function(r){function t(n,s){r.call(this),this.left=n,this.right=s,this.length=n.length+s.length,this.depth=Math.max(n.depth,s.depth)+1}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},t.prototype.forEachInner=function(s,o,a,c){var f=this.left.length;if(o<f&&this.left.forEachInner(s,o,Math.min(a,f),c)===!1||a>f&&this.right.forEachInner(s,Math.max(o-f,0),Math.min(this.length,a)-f,c+f)===!1)return!1},t.prototype.forEachInvertedInner=function(s,o,a,c){var f=this.left.length;if(o>f&&this.right.forEachInvertedInner(s,o-f,Math.max(a,f)-f,c+f)===!1||a<f&&this.left.forEachInvertedInner(s,Math.min(o,f),a,c)===!1)return!1},t.prototype.sliceInner=function(s,o){if(s==0&&o==this.length)return this;var a=this.left.length;return o<=a?this.left.slice(s,o):s>=a?this.right.slice(s-a,o-a):this.left.slice(s,a).append(this.right.slice(0,o-a))},t.prototype.leafAppend=function(s){var o=this.right.leafAppend(s);if(o)return new t(this.left,o)},t.prototype.leafPrepend=function(s){var o=this.left.leafPrepend(s);if(o)return new t(o,this.right)},t.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new t(this.left,new t(this.right,s)):new t(this,s)},t})(RopeSequence);const max_empty_items=500;class Branch{constructor(t,n){this.items=t,this.eventCount=n}popEvent(t,n){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let o,a;n&&(o=this.remapping(s,this.items.length),a=o.maps.length);let c=t.tr,f,g,b=[],_=[];return this.items.forEach((L,q)=>{if(!L.step){o||(o=this.remapping(s,q+1),a=o.maps.length),a--,_.push(L);return}if(o){_.push(new Item(L.map));let X=L.step.map(o.slice(a)),te;X&&c.maybeStep(X).doc&&(te=c.mapping.maps[c.mapping.maps.length-1],b.push(new Item(te,void 0,void 0,b.length+_.length))),a--,te&&o.appendMap(te,a)}else c.maybeStep(L.step);if(L.selection)return f=o?L.selection.map(o.slice(a)):L.selection,g=new Branch(this.items.slice(0,s).append(_.reverse().concat(b)),this.eventCount-1),!1},this.items.length,0),{remaining:g,transform:c,selection:f}}addTransform(t,n,s,o){let a=[],c=this.eventCount,f=this.items,g=!o&&f.length?f.get(f.length-1):null;for(let _=0;_<t.steps.length;_++){let L=t.steps[_].invert(t.docs[_]),q=new Item(t.mapping.maps[_],L,n),X;(X=g&&g.merge(q))&&(q=X,_?a.pop():f=f.slice(0,f.length-1)),a.push(q),n&&(c++,n=void 0),o||(g=q)}let b=c-s.depth;return b>DEPTH_OVERFLOW&&(f=cutOffEvents(f,b),c-=b),new Branch(f.append(a),c)}remapping(t,n){let s=new Mapping;return this.items.forEach((o,a)=>{let c=o.mirrorOffset!=null&&a-o.mirrorOffset>=t?s.maps.length-o.mirrorOffset:void 0;s.appendMap(o.map,c)},t,n),s}addMaps(t){return this.eventCount==0?this:new Branch(this.items.append(t.map(n=>new Item(n))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let s=[],o=Math.max(0,this.items.length-n),a=t.mapping,c=t.steps.length,f=this.eventCount;this.items.forEach(q=>{q.selection&&f--},o);let g=n;this.items.forEach(q=>{let X=a.getMirror(--g);if(X==null)return;c=Math.min(c,X);let te=a.maps[X];if(q.step){let ne=t.steps[X].invert(t.docs[X]),Ce=q.selection&&q.selection.map(a.slice(g+1,X));Ce&&f++,s.push(new Item(te,ne,Ce))}else s.push(new Item(te))},o);let b=[];for(let q=n;q<c;q++)b.push(new Item(a.maps[q]));let _=this.items.slice(0,o).append(b).append(s),L=new Branch(_,f);return L.emptyItemCount()>max_empty_items&&(L=L.compress(this.items.length-s.length)),L}emptyItemCount(){let t=0;return this.items.forEach(n=>{n.step||t++}),t}compress(t=this.items.length){let n=this.remapping(0,t),s=n.maps.length,o=[],a=0;return this.items.forEach((c,f)=>{if(f>=t)o.push(c),c.selection&&a++;else if(c.step){let g=c.step.map(n.slice(s)),b=g&&g.getMap();if(s--,b&&n.appendMap(b,s),g){let _=c.selection&&c.selection.map(n.slice(s));_&&a++;let L=new Item(b.invert(),g,_),q,X=o.length-1;(q=o.length&&o[X].merge(L))?o[X]=q:o.push(L)}}else c.map&&s--},this.items.length,0),new Branch(RopeSequence.from(o.reverse()),a)}}Branch.empty=new Branch(RopeSequence.empty,0);function cutOffEvents(r,t){let n;return r.forEach((s,o)=>{if(s.selection&&t--==0)return n=o,!1}),r.slice(n)}class Item{constructor(t,n,s,o){this.map=t,this.step=n,this.selection=s,this.mirrorOffset=o}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new Item(n.getMap().invert(),n,this.selection)}}}class HistoryState{constructor(t,n,s,o,a){this.done=t,this.undone=n,this.prevRanges=s,this.prevTime=o,this.prevComposition=a}}const DEPTH_OVERFLOW=20;function applyTransaction(r,t,n,s){let o=n.getMeta(historyKey),a;if(o)return o.historyState;n.getMeta(closeHistoryKey)&&(r=new HistoryState(r.done,r.undone,null,0,-1));let c=n.getMeta("appendedTransaction");if(n.steps.length==0)return r;if(c&&c.getMeta(historyKey))return c.getMeta(historyKey).redo?new HistoryState(r.done.addTransform(n,void 0,s,mustPreserveItems(t)),r.undone,rangesFor(n.mapping.maps),r.prevTime,r.prevComposition):new HistoryState(r.done,r.undone.addTransform(n,void 0,s,mustPreserveItems(t)),null,r.prevTime,r.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(c&&c.getMeta("addToHistory")===!1)){let f=n.getMeta("composition"),g=r.prevTime==0||!c&&r.prevComposition!=f&&(r.prevTime<(n.time||0)-s.newGroupDelay||!isAdjacentTo(n,r.prevRanges)),b=c?mapRanges(r.prevRanges,n.mapping):rangesFor(n.mapping.maps);return new HistoryState(r.done.addTransform(n,g?t.selection.getBookmark():void 0,s,mustPreserveItems(t)),Branch.empty,b,n.time,f??r.prevComposition)}else return(a=n.getMeta("rebased"))?new HistoryState(r.done.rebased(n,a),r.undone.rebased(n,a),mapRanges(r.prevRanges,n.mapping),r.prevTime,r.prevComposition):new HistoryState(r.done.addMaps(n.mapping.maps),r.undone.addMaps(n.mapping.maps),mapRanges(r.prevRanges,n.mapping),r.prevTime,r.prevComposition)}function isAdjacentTo(r,t){if(!t)return!1;if(!r.docChanged)return!0;let n=!1;return r.mapping.maps[0].forEach((s,o)=>{for(let a=0;a<t.length;a+=2)s<=t[a+1]&&o>=t[a]&&(n=!0)}),n}function rangesFor(r){let t=[];for(let n=r.length-1;n>=0&&t.length==0;n--)r[n].forEach((s,o,a,c)=>t.push(a,c));return t}function mapRanges(r,t){if(!r)return null;let n=[];for(let s=0;s<r.length;s+=2){let o=t.map(r[s],1),a=t.map(r[s+1],-1);o<=a&&n.push(o,a)}return n}function histTransaction(r,t,n){let s=mustPreserveItems(t),o=historyKey.get(t).spec.config,a=(n?r.undone:r.done).popEvent(t,s);if(!a)return null;let c=a.selection.resolve(a.transform.doc),f=(n?r.done:r.undone).addTransform(a.transform,t.selection.getBookmark(),o,s),g=new HistoryState(n?f:a.remaining,n?a.remaining:f,null,0,-1);return a.transform.setSelection(c).setMeta(historyKey,{redo:n,historyState:g})}let cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(r){let t=r.plugins;if(cachedPreserveItemsPlugins!=t){cachedPreserveItems=!1,cachedPreserveItemsPlugins=t;for(let n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}const historyKey=new PluginKey("history"),closeHistoryKey=new PluginKey("closeHistory");function history(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new Plugin({key:historyKey,state:{init(){return new HistoryState(Branch.empty,Branch.empty,null,0,-1)},apply(t,n,s){return applyTransaction(n,s,t,r)}},config:r,props:{handleDOMEvents:{beforeinput(t,n){let s=n.inputType,o=s=="historyUndo"?undo:s=="historyRedo"?redo:null;return o?(n.preventDefault(),o(t.state,t.dispatch)):!1}}}})}function buildCommand(r,t){return(n,s)=>{let o=historyKey.getState(n);if(!o||(r?o.undone:o.done).eventCount==0)return!1;if(s){let a=histTransaction(o,n,r);a&&s(t?a.scrollIntoView():a)}return!0}}const undo=buildCommand(!1,!0),redo=buildCommand(!0,!0),History=Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:t})=>undo(r,t),redo:()=>({state:r,dispatch:t})=>redo(r,t)}},addProseMirrorPlugins(){return[history(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),HorizontalRule=Node.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",mergeAttributes(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r,state:t})=>{if(!canInsertNode(t,t.schema.nodes[this.name]))return!1;const{selection:n}=t,{$from:s,$to:o}=n,a=r();return s.parentOffset===0?a.insertContentAt({from:Math.max(s.pos-1,0),to:o.pos},{type:this.name}):isNodeSelection(n)?a.insertContentAt(o.pos,{type:this.name}):a.insertContent({type:this.name}),a.command(({tr:c,dispatch:f})=>{var g;if(f){const{$to:b}=c.selection,_=b.end();if(b.nodeAfter)b.nodeAfter.isTextblock?c.setSelection(TextSelection.create(c.doc,b.pos+1)):b.nodeAfter.isBlock?c.setSelection(NodeSelection.create(c.doc,b.pos)):c.setSelection(TextSelection.create(c.doc,b.pos));else{const L=(g=b.parent.type.contentMatch.defaultType)===null||g===void 0?void 0:g.create();L&&(c.insert(_,L),c.setSelection(TextSelection.create(c.doc,_+1)))}c.scrollIntoView()}return!0}).run()}}},addInputRules(){return[nodeInputRule({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),starInputRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,starPasteRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,underscoreInputRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,underscorePasteRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Italic=Mark.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[markInputRule({find:starInputRegex,type:this.type}),markInputRule({find:underscoreInputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex,type:this.type}),markPasteRule({find:underscorePasteRegex,type:this.type})]}}),ListItem=Node.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",mergeAttributes(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ListItemName="listItem",TextStyleName="textStyle",inputRegex$2=/^(\d+)\.\s$/,OrderedList=Node.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:t,...n}=r;return t===1?["ol",mergeAttributes(this.options.HTMLAttributes,n),0]:["ol",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItemName,this.editor.getAttributes(TextStyleName)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=wrappingInputRule({find:inputRegex$2,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=wrappingInputRule({find:inputRegex$2,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(TextStyleName)}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1],editor:this.editor})),[r]}}),Paragraph=Node.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),inputRegex$1=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,pasteRegex=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Strike=Mark.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",mergeAttributes(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[markInputRule({find:inputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex,type:this.type})]}}),Text$1=Node.create({name:"text",group:"inline"});Extension.create({name:"starterKit",addExtensions(){const r=[];return this.options.bold!==!1&&r.push(Bold.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(Blockquote.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(BulletList.configure(this.options.bulletList)),this.options.code!==!1&&r.push(Code.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(CodeBlock.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(Document.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(Dropcursor.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(Gapcursor.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(HardBreak.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(Heading.configure(this.options.heading)),this.options.history!==!1&&r.push(History.configure(this.options.history)),this.options.horizontalRule!==!1&&r.push(HorizontalRule.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(Italic.configure(this.options.italic)),this.options.listItem!==!1&&r.push(ListItem.configure(this.options.listItem)),this.options.orderedList!==!1&&r.push(OrderedList.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(Paragraph.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(Strike.configure(this.options.strike)),this.options.text!==!1&&r.push(Text$1.configure(this.options.text)),r}});const inputRegex=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Image=Node.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:r}){return["img",mergeAttributes(this.options.HTMLAttributes,r)]},addCommands(){return{setImage:r=>({commands:t})=>t.insertContent({type:this.name,attrs:r})}},addInputRules(){return[nodeInputRule({find:inputRegex,type:this.type,getAttributes:r=>{const[,,t,n,s]=r;return{src:n,alt:t,title:s}}})]}}),decodeCache={};function getDecodeCache(r){let t=decodeCache[r];if(t)return t;t=decodeCache[r]=[];for(let n=0;n<128;n++){const s=String.fromCharCode(n);t.push(s)}for(let n=0;n<r.length;n++){const s=r.charCodeAt(n);t[s]="%"+("0"+s.toString(16).toUpperCase()).slice(-2)}return t}function decode$3(r,t){typeof t!="string"&&(t=decode$3.defaultChars);const n=getDecodeCache(t);return r.replace(/(%[a-f0-9]{2})+/gi,function(s){let o="";for(let a=0,c=s.length;a<c;a+=3){const f=parseInt(s.slice(a+1,a+3),16);if(f<128){o+=n[f];continue}if((f&224)===192&&a+3<c){const g=parseInt(s.slice(a+4,a+6),16);if((g&192)===128){const b=f<<6&1984|g&63;b<128?o+="":o+=String.fromCharCode(b),a+=3;continue}}if((f&240)===224&&a+6<c){const g=parseInt(s.slice(a+4,a+6),16),b=parseInt(s.slice(a+7,a+9),16);if((g&192)===128&&(b&192)===128){const _=f<<12&61440|g<<6&4032|b&63;_<2048||_>=55296&&_<=57343?o+="":o+=String.fromCharCode(_),a+=6;continue}}if((f&248)===240&&a+9<c){const g=parseInt(s.slice(a+4,a+6),16),b=parseInt(s.slice(a+7,a+9),16),_=parseInt(s.slice(a+10,a+12),16);if((g&192)===128&&(b&192)===128&&(_&192)===128){let L=f<<18&1835008|g<<12&258048|b<<6&4032|_&63;L<65536||L>1114111?o+="":(L-=65536,o+=String.fromCharCode(55296+(L>>10),56320+(L&1023))),a+=9;continue}}o+=""}return o})}decode$3.defaultChars=";/?:@&=+$,#";decode$3.componentChars="";const encodeCache={};function getEncodeCache(r){let t=encodeCache[r];if(t)return t;t=encodeCache[r]=[];for(let n=0;n<128;n++){const s=String.fromCharCode(n);/^[0-9a-z]$/i.test(s)?t.push(s):t.push("%"+("0"+n.toString(16).toUpperCase()).slice(-2))}for(let n=0;n<r.length;n++)t[r.charCodeAt(n)]=r[n];return t}function encode$2(r,t,n){typeof t!="string"&&(n=t,t=encode$2.defaultChars),typeof n>"u"&&(n=!0);const s=getEncodeCache(t);let o="";for(let a=0,c=r.length;a<c;a++){const f=r.charCodeAt(a);if(n&&f===37&&a+2<c&&/^[0-9a-f]{2}$/i.test(r.slice(a+1,a+3))){o+=r.slice(a,a+3),a+=2;continue}if(f<128){o+=s[f];continue}if(f>=55296&&f<=57343){if(f>=55296&&f<=56319&&a+1<c){const g=r.charCodeAt(a+1);if(g>=56320&&g<=57343){o+=encodeURIComponent(r[a]+r[a+1]),a++;continue}}o+="%EF%BF%BD";continue}o+=encodeURIComponent(r[a])}return o}encode$2.defaultChars=";/?:@&=+$,-_.!~*'()#";encode$2.componentChars="-_.!~*'()";function format(r){let t="";return t+=r.protocol||"",t+=r.slashes?"//":"",t+=r.auth?r.auth+"@":"",r.hostname&&r.hostname.indexOf(":")!==-1?t+="["+r.hostname+"]":t+=r.hostname||"",t+=r.port?":"+r.port:"",t+=r.pathname||"",t+=r.search||"",t+=r.hash||"",t}function Url$1(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(r,t){if(r&&r instanceof Url$1)return r;const n=new Url$1;return n.parse(r,t),n}Url$1.prototype.parse=function(r,t){let n,s,o,a=r;if(a=a.trim(),!t&&r.split("#").length===1){const b=simplePathPattern.exec(a);if(b)return this.pathname=b[1],b[2]&&(this.search=b[2]),this}let c=protocolPattern.exec(a);if(c&&(c=c[0],n=c.toLowerCase(),this.protocol=c,a=a.substr(c.length)),(t||c||a.match(/^\/\/[^@\/]+@[^@\/]+/))&&(o=a.substr(0,2)==="//",o&&!(c&&hostlessProtocol[c])&&(a=a.substr(2),this.slashes=!0)),!hostlessProtocol[c]&&(o||c&&!slashedProtocol[c])){let b=-1;for(let te=0;te<hostEndingChars.length;te++)s=a.indexOf(hostEndingChars[te]),s!==-1&&(b===-1||s<b)&&(b=s);let _,L;b===-1?L=a.lastIndexOf("@"):L=a.lastIndexOf("@",b),L!==-1&&(_=a.slice(0,L),a=a.slice(L+1),this.auth=_),b=-1;for(let te=0;te<nonHostChars.length;te++)s=a.indexOf(nonHostChars[te]),s!==-1&&(b===-1||s<b)&&(b=s);b===-1&&(b=a.length),a[b-1]===":"&&b--;const q=a.slice(0,b);a=a.slice(b),this.parseHost(q),this.hostname=this.hostname||"";const X=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!X){const te=this.hostname.split(/\./);for(let ne=0,Ce=te.length;ne<Ce;ne++){const Le=te[ne];if(Le&&!Le.match(hostnamePartPattern)){let Ge="";for(let ze=0,Xe=Le.length;ze<Xe;ze++)Le.charCodeAt(ze)>127?Ge+="x":Ge+=Le[ze];if(!Ge.match(hostnamePartPattern)){const ze=te.slice(0,ne),Xe=te.slice(ne+1),He=Le.match(hostnamePartStart);He&&(ze.push(He[1]),Xe.unshift(He[2])),Xe.length&&(a=Xe.join(".")+a),this.hostname=ze.join(".");break}}}}this.hostname.length>hostnameMaxLen&&(this.hostname=""),X&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const f=a.indexOf("#");f!==-1&&(this.hash=a.substr(f),a=a.slice(0,f));const g=a.indexOf("?");return g!==-1&&(this.search=a.substr(g),a=a.slice(0,g)),a&&(this.pathname=a),slashedProtocol[n]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Url$1.prototype.parseHost=function(r){let t=portPattern.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};const mdurl=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$3,encode:encode$2,format,parse:urlParse},Symbol.toStringTag,{value:"Module"})),Any=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Cc=/[\0-\x1F\x7F-\x9F]/,regex$1=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,P=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,regex=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,Z=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,ucmicro=Object.freeze(Object.defineProperty({__proto__:null,Any,Cc,Cf:regex$1,P,S:regex,Z},Symbol.toStringTag,{value:"Module"})),htmlDecodeTree=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(r=>r.charCodeAt(0))),xmlDecodeTree=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(r=>r.charCodeAt(0)));var _a;const decodeMap=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),fromCodePoint$1=(_a=String.fromCodePoint)!==null&&_a!==void 0?_a:function(r){let t="";return r>65535&&(r-=65536,t+=String.fromCharCode(r>>>10&1023|55296),r=56320|r&1023),t+=String.fromCharCode(r),t};function replaceCodePoint(r){var t;return r>=55296&&r<=57343||r>1114111?65533:(t=decodeMap.get(r))!==null&&t!==void 0?t:r}var CharCodes;(function(r){r[r.NUM=35]="NUM",r[r.SEMI=59]="SEMI",r[r.EQUALS=61]="EQUALS",r[r.ZERO=48]="ZERO",r[r.NINE=57]="NINE",r[r.LOWER_A=97]="LOWER_A",r[r.LOWER_F=102]="LOWER_F",r[r.LOWER_X=120]="LOWER_X",r[r.LOWER_Z=122]="LOWER_Z",r[r.UPPER_A=65]="UPPER_A",r[r.UPPER_F=70]="UPPER_F",r[r.UPPER_Z=90]="UPPER_Z"})(CharCodes||(CharCodes={}));const TO_LOWER_BIT=32;var BinTrieFlags;(function(r){r[r.VALUE_LENGTH=49152]="VALUE_LENGTH",r[r.BRANCH_LENGTH=16256]="BRANCH_LENGTH",r[r.JUMP_TABLE=127]="JUMP_TABLE"})(BinTrieFlags||(BinTrieFlags={}));function isNumber(r){return r>=CharCodes.ZERO&&r<=CharCodes.NINE}function isHexadecimalCharacter(r){return r>=CharCodes.UPPER_A&&r<=CharCodes.UPPER_F||r>=CharCodes.LOWER_A&&r<=CharCodes.LOWER_F}function isAsciiAlphaNumeric(r){return r>=CharCodes.UPPER_A&&r<=CharCodes.UPPER_Z||r>=CharCodes.LOWER_A&&r<=CharCodes.LOWER_Z||isNumber(r)}function isEntityInAttributeInvalidEnd(r){return r===CharCodes.EQUALS||isAsciiAlphaNumeric(r)}var EntityDecoderState;(function(r){r[r.EntityStart=0]="EntityStart",r[r.NumericStart=1]="NumericStart",r[r.NumericDecimal=2]="NumericDecimal",r[r.NumericHex=3]="NumericHex",r[r.NamedEntity=4]="NamedEntity"})(EntityDecoderState||(EntityDecoderState={}));var DecodingMode;(function(r){r[r.Legacy=0]="Legacy",r[r.Strict=1]="Strict",r[r.Attribute=2]="Attribute"})(DecodingMode||(DecodingMode={}));class EntityDecoder{constructor(t,n,s){this.decodeTree=t,this.emitCodePoint=n,this.errors=s,this.state=EntityDecoderState.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=DecodingMode.Strict}startEntity(t){this.decodeMode=t,this.state=EntityDecoderState.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(t,n){switch(this.state){case EntityDecoderState.EntityStart:return t.charCodeAt(n)===CharCodes.NUM?(this.state=EntityDecoderState.NumericStart,this.consumed+=1,this.stateNumericStart(t,n+1)):(this.state=EntityDecoderState.NamedEntity,this.stateNamedEntity(t,n));case EntityDecoderState.NumericStart:return this.stateNumericStart(t,n);case EntityDecoderState.NumericDecimal:return this.stateNumericDecimal(t,n);case EntityDecoderState.NumericHex:return this.stateNumericHex(t,n);case EntityDecoderState.NamedEntity:return this.stateNamedEntity(t,n)}}stateNumericStart(t,n){return n>=t.length?-1:(t.charCodeAt(n)|TO_LOWER_BIT)===CharCodes.LOWER_X?(this.state=EntityDecoderState.NumericHex,this.consumed+=1,this.stateNumericHex(t,n+1)):(this.state=EntityDecoderState.NumericDecimal,this.stateNumericDecimal(t,n))}addToNumericResult(t,n,s,o){if(n!==s){const a=s-n;this.result=this.result*Math.pow(o,a)+parseInt(t.substr(n,a),o),this.consumed+=a}}stateNumericHex(t,n){const s=n;for(;n<t.length;){const o=t.charCodeAt(n);if(isNumber(o)||isHexadecimalCharacter(o))n+=1;else return this.addToNumericResult(t,s,n,16),this.emitNumericEntity(o,3)}return this.addToNumericResult(t,s,n,16),-1}stateNumericDecimal(t,n){const s=n;for(;n<t.length;){const o=t.charCodeAt(n);if(isNumber(o))n+=1;else return this.addToNumericResult(t,s,n,10),this.emitNumericEntity(o,2)}return this.addToNumericResult(t,s,n,10),-1}emitNumericEntity(t,n){var s;if(this.consumed<=n)return(s=this.errors)===null||s===void 0||s.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===CharCodes.SEMI)this.consumed+=1;else if(this.decodeMode===DecodingMode.Strict)return 0;return this.emitCodePoint(replaceCodePoint(this.result),this.consumed),this.errors&&(t!==CharCodes.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(t,n){const{decodeTree:s}=this;let o=s[this.treeIndex],a=(o&BinTrieFlags.VALUE_LENGTH)>>14;for(;n<t.length;n++,this.excess++){const c=t.charCodeAt(n);if(this.treeIndex=determineBranch(s,o,this.treeIndex+Math.max(1,a),c),this.treeIndex<0)return this.result===0||this.decodeMode===DecodingMode.Attribute&&(a===0||isEntityInAttributeInvalidEnd(c))?0:this.emitNotTerminatedNamedEntity();if(o=s[this.treeIndex],a=(o&BinTrieFlags.VALUE_LENGTH)>>14,a!==0){if(c===CharCodes.SEMI)return this.emitNamedEntityData(this.treeIndex,a,this.consumed+this.excess);this.decodeMode!==DecodingMode.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var t;const{result:n,decodeTree:s}=this,o=(s[n]&BinTrieFlags.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,o,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(t,n,s){const{decodeTree:o}=this;return this.emitCodePoint(n===1?o[t]&~BinTrieFlags.VALUE_LENGTH:o[t+1],s),n===3&&this.emitCodePoint(o[t+2],s),s}end(){var t;switch(this.state){case EntityDecoderState.NamedEntity:return this.result!==0&&(this.decodeMode!==DecodingMode.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case EntityDecoderState.NumericDecimal:return this.emitNumericEntity(0,2);case EntityDecoderState.NumericHex:return this.emitNumericEntity(0,3);case EntityDecoderState.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case EntityDecoderState.EntityStart:return 0}}}function getDecoder(r){let t="";const n=new EntityDecoder(r,s=>t+=fromCodePoint$1(s));return function(o,a){let c=0,f=0;for(;(f=o.indexOf("&",f))>=0;){t+=o.slice(c,f),n.startEntity(a);const b=n.write(o,f+1);if(b<0){c=f+n.end();break}c=f+b,f=b===0?c+1:c}const g=t+o.slice(c);return t="",g}}function determineBranch(r,t,n,s){const o=(t&BinTrieFlags.BRANCH_LENGTH)>>7,a=t&BinTrieFlags.JUMP_TABLE;if(o===0)return a!==0&&s===a?n:-1;if(a){const g=s-a;return g<0||g>=o?-1:r[n+g]-1}let c=n,f=c+o-1;for(;c<=f;){const g=c+f>>>1,b=r[g];if(b<s)c=g+1;else if(b>s)f=g-1;else return r[g+o]}return-1}const htmlDecoder=getDecoder(htmlDecodeTree);getDecoder(xmlDecodeTree);function decodeHTML(r,t=DecodingMode.Legacy){return htmlDecoder(r,t)}function _class$1(r){return Object.prototype.toString.call(r)}function isString$1(r){return _class$1(r)==="[object String]"}const _hasOwnProperty=Object.prototype.hasOwnProperty;function has(r,t){return _hasOwnProperty.call(r,t)}function assign$1(r){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n){if(typeof n!="object")throw new TypeError(n+"must be object");Object.keys(n).forEach(function(s){r[s]=n[s]})}}),r}function arrayReplaceAt(r,t,n){return[].concat(r.slice(0,t),n,r.slice(t+1))}function isValidEntityCode(r){return!(r>=55296&&r<=57343||r>=64976&&r<=65007||(r&65535)===65535||(r&65535)===65534||r>=0&&r<=8||r===11||r>=14&&r<=31||r>=127&&r<=159||r>1114111)}function fromCodePoint(r){if(r>65535){r-=65536;const t=55296+(r>>10),n=56320+(r&1023);return String.fromCharCode(t,n)}return String.fromCharCode(r)}const UNESCAPE_MD_RE=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,ENTITY_RE=/&([a-z#][a-z0-9]{1,31});/gi,UNESCAPE_ALL_RE=new RegExp(UNESCAPE_MD_RE.source+"|"+ENTITY_RE.source,"gi"),DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function replaceEntityPattern(r,t){if(t.charCodeAt(0)===35&&DIGITAL_ENTITY_TEST_RE.test(t)){const s=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);return isValidEntityCode(s)?fromCodePoint(s):r}const n=decodeHTML(r);return n!==r?n:r}function unescapeMd(r){return r.indexOf("\\")<0?r:r.replace(UNESCAPE_MD_RE,"$1")}function unescapeAll(r){return r.indexOf("\\")<0&&r.indexOf("&")<0?r:r.replace(UNESCAPE_ALL_RE,function(t,n,s){return n||replaceEntityPattern(t,s)})}const HTML_ESCAPE_TEST_RE=/[&<>"]/,HTML_ESCAPE_REPLACE_RE=/[&<>"]/g,HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(r){return HTML_REPLACEMENTS[r]}function escapeHtml(r){return HTML_ESCAPE_TEST_RE.test(r)?r.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar):r}const REGEXP_ESCAPE_RE=/[.?*+^$[\]\\(){}|-]/g;function escapeRE$1(r){return r.replace(REGEXP_ESCAPE_RE,"\\$&")}function isSpace(r){switch(r){case 9:case 32:return!0}return!1}function isWhiteSpace(r){if(r>=8192&&r<=8202)return!0;switch(r){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function isPunctChar(r){return P.test(r)||regex.test(r)}function isMdAsciiPunct(r){switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function normalizeReference(r){return r=r.trim().replace(/\s+/g," "),"".toLowerCase()===""&&(r=r.replace(//g,"")),r.toLowerCase().toUpperCase()}const lib$3={mdurl,ucmicro},utils$2=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt,assign:assign$1,escapeHtml,escapeRE:escapeRE$1,fromCodePoint,has,isMdAsciiPunct,isPunctChar,isSpace,isString:isString$1,isValidEntityCode,isWhiteSpace,lib:lib$3,normalizeReference,unescapeAll,unescapeMd},Symbol.toStringTag,{value:"Module"}));function parseLinkLabel(r,t,n){let s,o,a,c;const f=r.posMax,g=r.pos;for(r.pos=t+1,s=1;r.pos<f;){if(a=r.src.charCodeAt(r.pos),a===93&&(s--,s===0)){o=!0;break}if(c=r.pos,r.md.inline.skipToken(r),a===91){if(c===r.pos-1)s++;else if(n)return r.pos=g,-1}}let b=-1;return o&&(b=r.pos),r.pos=g,b}function parseLinkDestination(r,t,n){let s,o=t;const a={ok:!1,pos:0,str:""};if(r.charCodeAt(o)===60){for(o++;o<n;){if(s=r.charCodeAt(o),s===10||s===60)return a;if(s===62)return a.pos=o+1,a.str=unescapeAll(r.slice(t+1,o)),a.ok=!0,a;if(s===92&&o+1<n){o+=2;continue}o++}return a}let c=0;for(;o<n&&(s=r.charCodeAt(o),!(s===32||s<32||s===127));){if(s===92&&o+1<n){if(r.charCodeAt(o+1)===32)break;o+=2;continue}if(s===40&&(c++,c>32))return a;if(s===41){if(c===0)break;c--}o++}return t===o||c!==0||(a.str=unescapeAll(r.slice(t,o)),a.pos=o,a.ok=!0),a}function parseLinkTitle(r,t,n,s){let o,a=t;const c={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(s)c.str=s.str,c.marker=s.marker;else{if(a>=n)return c;let f=r.charCodeAt(a);if(f!==34&&f!==39&&f!==40)return c;t++,a++,f===40&&(f=41),c.marker=f}for(;a<n;){if(o=r.charCodeAt(a),o===c.marker)return c.pos=a+1,c.str+=unescapeAll(r.slice(t,a)),c.ok=!0,c;if(o===40&&c.marker===41)return c;o===92&&a+1<n&&a++,a++}return c.can_continue=!0,c.str+=unescapeAll(r.slice(t,a)),c}const helpers=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination,parseLinkLabel,parseLinkTitle},Symbol.toStringTag,{value:"Module"})),default_rules={};default_rules.code_inline=function(r,t,n,s,o){const a=r[t];return"<code"+o.renderAttrs(a)+">"+escapeHtml(a.content)+"</code>"};default_rules.code_block=function(r,t,n,s,o){const a=r[t];return"<pre"+o.renderAttrs(a)+"><code>"+escapeHtml(r[t].content)+`</code></pre>
`};default_rules.fence=function(r,t,n,s,o){const a=r[t],c=a.info?unescapeAll(a.info).trim():"";let f="",g="";if(c){const _=c.split(/(\s+)/g);f=_[0],g=_.slice(2).join("")}let b;if(n.highlight?b=n.highlight(a.content,f,g)||escapeHtml(a.content):b=escapeHtml(a.content),b.indexOf("<pre")===0)return b+`
`;if(c){const _=a.attrIndex("class"),L=a.attrs?a.attrs.slice():[];_<0?L.push(["class",n.langPrefix+f]):(L[_]=L[_].slice(),L[_][1]+=" "+n.langPrefix+f);const q={attrs:L};return`<pre><code${o.renderAttrs(q)}>${b}</code></pre>
`}return`<pre><code${o.renderAttrs(a)}>${b}</code></pre>
`};default_rules.image=function(r,t,n,s,o){const a=r[t];return a.attrs[a.attrIndex("alt")][1]=o.renderInlineAsText(a.children,n,s),o.renderToken(r,t,n)};default_rules.hardbreak=function(r,t,n){return n.xhtmlOut?`<br />
`:`<br>
`};default_rules.softbreak=function(r,t,n){return n.breaks?n.xhtmlOut?`<br />
`:`<br>
`:`
`};default_rules.text=function(r,t){return escapeHtml(r[t].content)};default_rules.html_block=function(r,t){return r[t].content};default_rules.html_inline=function(r,t){return r[t].content};function Renderer(){this.rules=assign$1({},default_rules)}Renderer.prototype.renderAttrs=function r(t){let n,s,o;if(!t.attrs)return"";for(o="",n=0,s=t.attrs.length;n<s;n++)o+=" "+escapeHtml(t.attrs[n][0])+'="'+escapeHtml(t.attrs[n][1])+'"';return o};Renderer.prototype.renderToken=function r(t,n,s){const o=t[n];let a="";if(o.hidden)return"";o.block&&o.nesting!==-1&&n&&t[n-1].hidden&&(a+=`
`),a+=(o.nesting===-1?"</":"<")+o.tag,a+=this.renderAttrs(o),o.nesting===0&&s.xhtmlOut&&(a+=" /");let c=!1;if(o.block&&(c=!0,o.nesting===1&&n+1<t.length)){const f=t[n+1];(f.type==="inline"||f.hidden||f.nesting===-1&&f.tag===o.tag)&&(c=!1)}return a+=c?`>
`:">",a};Renderer.prototype.renderInline=function(r,t,n){let s="";const o=this.rules;for(let a=0,c=r.length;a<c;a++){const f=r[a].type;typeof o[f]<"u"?s+=o[f](r,a,t,n,this):s+=this.renderToken(r,a,t)}return s};Renderer.prototype.renderInlineAsText=function(r,t,n){let s="";for(let o=0,a=r.length;o<a;o++)switch(r[o].type){case"text":s+=r[o].content;break;case"image":s+=this.renderInlineAsText(r[o].children,t,n);break;case"html_inline":case"html_block":s+=r[o].content;break;case"softbreak":case"hardbreak":s+=`
`;break}return s};Renderer.prototype.render=function(r,t,n){let s="";const o=this.rules;for(let a=0,c=r.length;a<c;a++){const f=r[a].type;f==="inline"?s+=this.renderInline(r[a].children,t,n):typeof o[f]<"u"?s+=o[f](r,a,t,n,this):s+=this.renderToken(r,a,t,n)}return s};function Ruler(){this.__rules__=[],this.__cache__=null}Ruler.prototype.__find__=function(r){for(let t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===r)return t;return-1};Ruler.prototype.__compile__=function(){const r=this,t=[""];r.__rules__.forEach(function(n){n.enabled&&n.alt.forEach(function(s){t.indexOf(s)<0&&t.push(s)})}),r.__cache__={},t.forEach(function(n){r.__cache__[n]=[],r.__rules__.forEach(function(s){s.enabled&&(n&&s.alt.indexOf(n)<0||r.__cache__[n].push(s.fn))})})};Ruler.prototype.at=function(r,t,n){const s=this.__find__(r),o=n||{};if(s===-1)throw new Error("Parser rule not found: "+r);this.__rules__[s].fn=t,this.__rules__[s].alt=o.alt||[],this.__cache__=null};Ruler.prototype.before=function(r,t,n,s){const o=this.__find__(r),a=s||{};if(o===-1)throw new Error("Parser rule not found: "+r);this.__rules__.splice(o,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null};Ruler.prototype.after=function(r,t,n,s){const o=this.__find__(r),a=s||{};if(o===-1)throw new Error("Parser rule not found: "+r);this.__rules__.splice(o+1,0,{name:t,enabled:!0,fn:n,alt:a.alt||[]}),this.__cache__=null};Ruler.prototype.push=function(r,t,n){const s=n||{};this.__rules__.push({name:r,enabled:!0,fn:t,alt:s.alt||[]}),this.__cache__=null};Ruler.prototype.enable=function(r,t){Array.isArray(r)||(r=[r]);const n=[];return r.forEach(function(s){const o=this.__find__(s);if(o<0){if(t)return;throw new Error("Rules manager: invalid rule name "+s)}this.__rules__[o].enabled=!0,n.push(s)},this),this.__cache__=null,n};Ruler.prototype.enableOnly=function(r,t){Array.isArray(r)||(r=[r]),this.__rules__.forEach(function(n){n.enabled=!1}),this.enable(r,t)};Ruler.prototype.disable=function(r,t){Array.isArray(r)||(r=[r]);const n=[];return r.forEach(function(s){const o=this.__find__(s);if(o<0){if(t)return;throw new Error("Rules manager: invalid rule name "+s)}this.__rules__[o].enabled=!1,n.push(s)},this),this.__cache__=null,n};Ruler.prototype.getRules=function(r){return this.__cache__===null&&this.__compile__(),this.__cache__[r]||[]};function Token(r,t,n){this.type=r,this.tag=t,this.attrs=null,this.map=null,this.nesting=n,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Token.prototype.attrIndex=function r(t){if(!this.attrs)return-1;const n=this.attrs;for(let s=0,o=n.length;s<o;s++)if(n[s][0]===t)return s;return-1};Token.prototype.attrPush=function r(t){this.attrs?this.attrs.push(t):this.attrs=[t]};Token.prototype.attrSet=function r(t,n){const s=this.attrIndex(t),o=[t,n];s<0?this.attrPush(o):this.attrs[s]=o};Token.prototype.attrGet=function r(t){const n=this.attrIndex(t);let s=null;return n>=0&&(s=this.attrs[n][1]),s};Token.prototype.attrJoin=function r(t,n){const s=this.attrIndex(t);s<0?this.attrPush([t,n]):this.attrs[s][1]=this.attrs[s][1]+" "+n};function StateCore(r,t,n){this.src=r,this.env=n,this.tokens=[],this.inlineMode=!1,this.md=t}StateCore.prototype.Token=Token;const NEWLINES_RE=/\r\n?|\n/g,NULL_RE=/\0/g;function normalize(r){let t;t=r.src.replace(NEWLINES_RE,`
`),t=t.replace(NULL_RE,""),r.src=t}function block(r){let t;r.inlineMode?(t=new r.Token("inline","",0),t.content=r.src,t.map=[0,1],t.children=[],r.tokens.push(t)):r.md.block.parse(r.src,r.md,r.env,r.tokens)}function inline(r){const t=r.tokens;for(let n=0,s=t.length;n<s;n++){const o=t[n];o.type==="inline"&&r.md.inline.parse(o.content,r.md,r.env,o.children)}}function isLinkOpen$1(r){return/^<a[>\s]/i.test(r)}function isLinkClose$1(r){return/^<\/a\s*>/i.test(r)}function linkify$1(r){const t=r.tokens;if(r.md.options.linkify)for(let n=0,s=t.length;n<s;n++){if(t[n].type!=="inline"||!r.md.linkify.pretest(t[n].content))continue;let o=t[n].children,a=0;for(let c=o.length-1;c>=0;c--){const f=o[c];if(f.type==="link_close"){for(c--;o[c].level!==f.level&&o[c].type!=="link_open";)c--;continue}if(f.type==="html_inline"&&(isLinkOpen$1(f.content)&&a>0&&a--,isLinkClose$1(f.content)&&a++),!(a>0)&&f.type==="text"&&r.md.linkify.test(f.content)){const g=f.content;let b=r.md.linkify.match(g);const _=[];let L=f.level,q=0;b.length>0&&b[0].index===0&&c>0&&o[c-1].type==="text_special"&&(b=b.slice(1));for(let X=0;X<b.length;X++){const te=b[X].url,ne=r.md.normalizeLink(te);if(!r.md.validateLink(ne))continue;let Ce=b[X].text;b[X].schema?b[X].schema==="mailto:"&&!/^mailto:/i.test(Ce)?Ce=r.md.normalizeLinkText("mailto:"+Ce).replace(/^mailto:/,""):Ce=r.md.normalizeLinkText(Ce):Ce=r.md.normalizeLinkText("http://"+Ce).replace(/^http:\/\//,"");const Le=b[X].index;if(Le>q){const He=new r.Token("text","",0);He.content=g.slice(q,Le),He.level=L,_.push(He)}const Ge=new r.Token("link_open","a",1);Ge.attrs=[["href",ne]],Ge.level=L++,Ge.markup="linkify",Ge.info="auto",_.push(Ge);const ze=new r.Token("text","",0);ze.content=Ce,ze.level=L,_.push(ze);const Xe=new r.Token("link_close","a",-1);Xe.level=--L,Xe.markup="linkify",Xe.info="auto",_.push(Xe),q=b[X].lastIndex}if(q<g.length){const X=new r.Token("text","",0);X.content=g.slice(q),X.level=L,_.push(X)}t[n].children=o=arrayReplaceAt(o,c,_)}}}}const RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,SCOPED_ABBR_TEST_RE=/\((c|tm|r)\)/i,SCOPED_ABBR_RE=/\((c|tm|r)\)/ig,SCOPED_ABBR={c:"",r:"",tm:""};function replaceFn(r,t){return SCOPED_ABBR[t.toLowerCase()]}function replace_scoped(r){let t=0;for(let n=r.length-1;n>=0;n--){const s=r[n];s.type==="text"&&!t&&(s.content=s.content.replace(SCOPED_ABBR_RE,replaceFn)),s.type==="link_open"&&s.info==="auto"&&t--,s.type==="link_close"&&s.info==="auto"&&t++}}function replace_rare(r){let t=0;for(let n=r.length-1;n>=0;n--){const s=r[n];s.type==="text"&&!t&&RARE_RE.test(s.content)&&(s.content=s.content.replace(/\+-/g,"").replace(/\.{2,}/g,"").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1").replace(/(^|\s)--(?=\s|$)/mg,"$1").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1")),s.type==="link_open"&&s.info==="auto"&&t--,s.type==="link_close"&&s.info==="auto"&&t++}}function replace(r){let t;if(r.md.options.typographer)for(t=r.tokens.length-1;t>=0;t--)r.tokens[t].type==="inline"&&(SCOPED_ABBR_TEST_RE.test(r.tokens[t].content)&&replace_scoped(r.tokens[t].children),RARE_RE.test(r.tokens[t].content)&&replace_rare(r.tokens[t].children))}const QUOTE_TEST_RE=/['"]/,QUOTE_RE=/['"]/g,APOSTROPHE$1="";function replaceAt(r,t,n){return r.slice(0,t)+n+r.slice(t+1)}function process_inlines(r,t){let n;const s=[];for(let o=0;o<r.length;o++){const a=r[o],c=r[o].level;for(n=s.length-1;n>=0&&!(s[n].level<=c);n--);if(s.length=n+1,a.type!=="text")continue;let f=a.content,g=0,b=f.length;e:for(;g<b;){QUOTE_RE.lastIndex=g;const _=QUOTE_RE.exec(f);if(!_)break;let L=!0,q=!0;g=_.index+1;const X=_[0]==="'";let te=32;if(_.index-1>=0)te=f.charCodeAt(_.index-1);else for(n=o-1;n>=0&&!(r[n].type==="softbreak"||r[n].type==="hardbreak");n--)if(r[n].content){te=r[n].content.charCodeAt(r[n].content.length-1);break}let ne=32;if(g<b)ne=f.charCodeAt(g);else for(n=o+1;n<r.length&&!(r[n].type==="softbreak"||r[n].type==="hardbreak");n++)if(r[n].content){ne=r[n].content.charCodeAt(0);break}const Ce=isMdAsciiPunct(te)||isPunctChar(String.fromCharCode(te)),Le=isMdAsciiPunct(ne)||isPunctChar(String.fromCharCode(ne)),Ge=isWhiteSpace(te),ze=isWhiteSpace(ne);if(ze?L=!1:Le&&(Ge||Ce||(L=!1)),Ge?q=!1:Ce&&(ze||Le||(q=!1)),ne===34&&_[0]==='"'&&te>=48&&te<=57&&(q=L=!1),L&&q&&(L=Ce,q=Le),!L&&!q){X&&(a.content=replaceAt(a.content,_.index,APOSTROPHE$1));continue}if(q)for(n=s.length-1;n>=0;n--){let Xe=s[n];if(s[n].level<c)break;if(Xe.single===X&&s[n].level===c){Xe=s[n];let He,Ve;X?(He=t.md.options.quotes[2],Ve=t.md.options.quotes[3]):(He=t.md.options.quotes[0],Ve=t.md.options.quotes[1]),a.content=replaceAt(a.content,_.index,Ve),r[Xe.token].content=replaceAt(r[Xe.token].content,Xe.pos,He),g+=Ve.length-1,Xe.token===o&&(g+=He.length-1),f=a.content,b=f.length,s.length=n;continue e}}L?s.push({token:o,pos:_.index,single:X,level:c}):q&&X&&(a.content=replaceAt(a.content,_.index,APOSTROPHE$1))}}}function smartquotes(r){if(r.md.options.typographer)for(let t=r.tokens.length-1;t>=0;t--)r.tokens[t].type!=="inline"||!QUOTE_TEST_RE.test(r.tokens[t].content)||process_inlines(r.tokens[t].children,r)}function text_join(r){let t,n;const s=r.tokens,o=s.length;for(let a=0;a<o;a++){if(s[a].type!=="inline")continue;const c=s[a].children,f=c.length;for(t=0;t<f;t++)c[t].type==="text_special"&&(c[t].type="text");for(t=n=0;t<f;t++)c[t].type==="text"&&t+1<f&&c[t+1].type==="text"?c[t+1].content=c[t].content+c[t+1].content:(t!==n&&(c[n]=c[t]),n++);t!==n&&(c.length=n)}}const _rules$2=[["normalize",normalize],["block",block],["inline",inline],["linkify",linkify$1],["replacements",replace],["smartquotes",smartquotes],["text_join",text_join]];function Core(){this.ruler=new Ruler;for(let r=0;r<_rules$2.length;r++)this.ruler.push(_rules$2[r][0],_rules$2[r][1])}Core.prototype.process=function(r){const t=this.ruler.getRules("");for(let n=0,s=t.length;n<s;n++)t[n](r)};Core.prototype.State=StateCore;function StateBlock(r,t,n,s){this.src=r,this.md=t,this.env=n,this.tokens=s,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const o=this.src;for(let a=0,c=0,f=0,g=0,b=o.length,_=!1;c<b;c++){const L=o.charCodeAt(c);if(!_)if(isSpace(L)){f++,L===9?g+=4-g%4:g++;continue}else _=!0;(L===10||c===b-1)&&(L!==10&&c++,this.bMarks.push(a),this.eMarks.push(c),this.tShift.push(f),this.sCount.push(g),this.bsCount.push(0),_=!1,f=0,g=0,a=c+1)}this.bMarks.push(o.length),this.eMarks.push(o.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}StateBlock.prototype.push=function(r,t,n){const s=new Token(r,t,n);return s.block=!0,n<0&&this.level--,s.level=this.level,n>0&&this.level++,this.tokens.push(s),s};StateBlock.prototype.isEmpty=function r(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};StateBlock.prototype.skipEmptyLines=function r(t){for(let n=this.lineMax;t<n&&!(this.bMarks[t]+this.tShift[t]<this.eMarks[t]);t++);return t};StateBlock.prototype.skipSpaces=function r(t){for(let n=this.src.length;t<n;t++){const s=this.src.charCodeAt(t);if(!isSpace(s))break}return t};StateBlock.prototype.skipSpacesBack=function r(t,n){if(t<=n)return t;for(;t>n;)if(!isSpace(this.src.charCodeAt(--t)))return t+1;return t};StateBlock.prototype.skipChars=function r(t,n){for(let s=this.src.length;t<s&&this.src.charCodeAt(t)===n;t++);return t};StateBlock.prototype.skipCharsBack=function r(t,n,s){if(t<=s)return t;for(;t>s;)if(n!==this.src.charCodeAt(--t))return t+1;return t};StateBlock.prototype.getLines=function r(t,n,s,o){if(t>=n)return"";const a=new Array(n-t);for(let c=0,f=t;f<n;f++,c++){let g=0;const b=this.bMarks[f];let _=b,L;for(f+1<n||o?L=this.eMarks[f]+1:L=this.eMarks[f];_<L&&g<s;){const q=this.src.charCodeAt(_);if(isSpace(q))q===9?g+=4-(g+this.bsCount[f])%4:g++;else if(_-b<this.tShift[f])g++;else break;_++}g>s?a[c]=new Array(g-s+1).join(" ")+this.src.slice(_,L):a[c]=this.src.slice(_,L)}return a.join("")};StateBlock.prototype.Token=Token;const MAX_AUTOCOMPLETED_CELLS=65536;function getLine(r,t){const n=r.bMarks[t]+r.tShift[t],s=r.eMarks[t];return r.src.slice(n,s)}function escapedSplit(r){const t=[],n=r.length;let s=0,o=r.charCodeAt(s),a=!1,c=0,f="";for(;s<n;)o===124&&(a?(f+=r.substring(c,s-1),c=s):(t.push(f+r.substring(c,s)),f="",c=s+1)),a=o===92,s++,o=r.charCodeAt(s);return t.push(f+r.substring(c)),t}function table(r,t,n,s){if(t+2>n)return!1;let o=t+1;if(r.sCount[o]<r.blkIndent||r.sCount[o]-r.blkIndent>=4)return!1;let a=r.bMarks[o]+r.tShift[o];if(a>=r.eMarks[o])return!1;const c=r.src.charCodeAt(a++);if(c!==124&&c!==45&&c!==58||a>=r.eMarks[o])return!1;const f=r.src.charCodeAt(a++);if(f!==124&&f!==45&&f!==58&&!isSpace(f)||c===45&&isSpace(f))return!1;for(;a<r.eMarks[o];){const Xe=r.src.charCodeAt(a);if(Xe!==124&&Xe!==45&&Xe!==58&&!isSpace(Xe))return!1;a++}let g=getLine(r,t+1),b=g.split("|");const _=[];for(let Xe=0;Xe<b.length;Xe++){const He=b[Xe].trim();if(!He){if(Xe===0||Xe===b.length-1)continue;return!1}if(!/^:?-+:?$/.test(He))return!1;He.charCodeAt(He.length-1)===58?_.push(He.charCodeAt(0)===58?"center":"right"):He.charCodeAt(0)===58?_.push("left"):_.push("")}if(g=getLine(r,t).trim(),g.indexOf("|")===-1||r.sCount[t]-r.blkIndent>=4)return!1;b=escapedSplit(g),b.length&&b[0]===""&&b.shift(),b.length&&b[b.length-1]===""&&b.pop();const L=b.length;if(L===0||L!==_.length)return!1;if(s)return!0;const q=r.parentType;r.parentType="table";const X=r.md.block.ruler.getRules("blockquote"),te=r.push("table_open","table",1),ne=[t,0];te.map=ne;const Ce=r.push("thead_open","thead",1);Ce.map=[t,t+1];const Le=r.push("tr_open","tr",1);Le.map=[t,t+1];for(let Xe=0;Xe<b.length;Xe++){const He=r.push("th_open","th",1);_[Xe]&&(He.attrs=[["style","text-align:"+_[Xe]]]);const Ve=r.push("inline","",0);Ve.content=b[Xe].trim(),Ve.children=[],r.push("th_close","th",-1)}r.push("tr_close","tr",-1),r.push("thead_close","thead",-1);let Ge,ze=0;for(o=t+2;o<n&&!(r.sCount[o]<r.blkIndent);o++){let Xe=!1;for(let Ve=0,We=X.length;Ve<We;Ve++)if(X[Ve](r,o,n,!0)){Xe=!0;break}if(Xe||(g=getLine(r,o).trim(),!g)||r.sCount[o]-r.blkIndent>=4||(b=escapedSplit(g),b.length&&b[0]===""&&b.shift(),b.length&&b[b.length-1]===""&&b.pop(),ze+=L-b.length,ze>MAX_AUTOCOMPLETED_CELLS))break;if(o===t+2){const Ve=r.push("tbody_open","tbody",1);Ve.map=Ge=[t+2,0]}const He=r.push("tr_open","tr",1);He.map=[o,o+1];for(let Ve=0;Ve<L;Ve++){const We=r.push("td_open","td",1);_[Ve]&&(We.attrs=[["style","text-align:"+_[Ve]]]);const rt=r.push("inline","",0);rt.content=b[Ve]?b[Ve].trim():"",rt.children=[],r.push("td_close","td",-1)}r.push("tr_close","tr",-1)}return Ge&&(r.push("tbody_close","tbody",-1),Ge[1]=o),r.push("table_close","table",-1),ne[1]=o,r.parentType=q,r.line=o,!0}function code(r,t,n){if(r.sCount[t]-r.blkIndent<4)return!1;let s=t+1,o=s;for(;s<n;){if(r.isEmpty(s)){s++;continue}if(r.sCount[s]-r.blkIndent>=4){s++,o=s;continue}break}r.line=o;const a=r.push("code_block","code",0);return a.content=r.getLines(t,o,4+r.blkIndent,!1)+`
`,a.map=[t,r.line],!0}function fence(r,t,n,s){let o=r.bMarks[t]+r.tShift[t],a=r.eMarks[t];if(r.sCount[t]-r.blkIndent>=4||o+3>a)return!1;const c=r.src.charCodeAt(o);if(c!==126&&c!==96)return!1;let f=o;o=r.skipChars(o,c);let g=o-f;if(g<3)return!1;const b=r.src.slice(f,o),_=r.src.slice(o,a);if(c===96&&_.indexOf(String.fromCharCode(c))>=0)return!1;if(s)return!0;let L=t,q=!1;for(;L++,!(L>=n||(o=f=r.bMarks[L]+r.tShift[L],a=r.eMarks[L],o<a&&r.sCount[L]<r.blkIndent));)if(r.src.charCodeAt(o)===c&&!(r.sCount[L]-r.blkIndent>=4)&&(o=r.skipChars(o,c),!(o-f<g)&&(o=r.skipSpaces(o),!(o<a)))){q=!0;break}g=r.sCount[t],r.line=L+(q?1:0);const X=r.push("fence","code",0);return X.info=_,X.content=r.getLines(t+1,L,g,!0),X.markup=b,X.map=[t,r.line],!0}function blockquote(r,t,n,s){let o=r.bMarks[t]+r.tShift[t],a=r.eMarks[t];const c=r.lineMax;if(r.sCount[t]-r.blkIndent>=4||r.src.charCodeAt(o)!==62)return!1;if(s)return!0;const f=[],g=[],b=[],_=[],L=r.md.block.ruler.getRules("blockquote"),q=r.parentType;r.parentType="blockquote";let X=!1,te;for(te=t;te<n;te++){const ze=r.sCount[te]<r.blkIndent;if(o=r.bMarks[te]+r.tShift[te],a=r.eMarks[te],o>=a)break;if(r.src.charCodeAt(o++)===62&&!ze){let He=r.sCount[te]+1,Ve,We;r.src.charCodeAt(o)===32?(o++,He++,We=!1,Ve=!0):r.src.charCodeAt(o)===9?(Ve=!0,(r.bsCount[te]+He)%4===3?(o++,He++,We=!1):We=!0):Ve=!1;let rt=He;for(f.push(r.bMarks[te]),r.bMarks[te]=o;o<a;){const st=r.src.charCodeAt(o);if(isSpace(st))st===9?rt+=4-(rt+r.bsCount[te]+(We?1:0))%4:rt++;else break;o++}X=o>=a,g.push(r.bsCount[te]),r.bsCount[te]=r.sCount[te]+1+(Ve?1:0),b.push(r.sCount[te]),r.sCount[te]=rt-He,_.push(r.tShift[te]),r.tShift[te]=o-r.bMarks[te];continue}if(X)break;let Xe=!1;for(let He=0,Ve=L.length;He<Ve;He++)if(L[He](r,te,n,!0)){Xe=!0;break}if(Xe){r.lineMax=te,r.blkIndent!==0&&(f.push(r.bMarks[te]),g.push(r.bsCount[te]),_.push(r.tShift[te]),b.push(r.sCount[te]),r.sCount[te]-=r.blkIndent);break}f.push(r.bMarks[te]),g.push(r.bsCount[te]),_.push(r.tShift[te]),b.push(r.sCount[te]),r.sCount[te]=-1}const ne=r.blkIndent;r.blkIndent=0;const Ce=r.push("blockquote_open","blockquote",1);Ce.markup=">";const Le=[t,0];Ce.map=Le,r.md.block.tokenize(r,t,te);const Ge=r.push("blockquote_close","blockquote",-1);Ge.markup=">",r.lineMax=c,r.parentType=q,Le[1]=r.line;for(let ze=0;ze<_.length;ze++)r.bMarks[ze+t]=f[ze],r.tShift[ze+t]=_[ze],r.sCount[ze+t]=b[ze],r.bsCount[ze+t]=g[ze];return r.blkIndent=ne,!0}function hr(r,t,n,s){const o=r.eMarks[t];if(r.sCount[t]-r.blkIndent>=4)return!1;let a=r.bMarks[t]+r.tShift[t];const c=r.src.charCodeAt(a++);if(c!==42&&c!==45&&c!==95)return!1;let f=1;for(;a<o;){const b=r.src.charCodeAt(a++);if(b!==c&&!isSpace(b))return!1;b===c&&f++}if(f<3)return!1;if(s)return!0;r.line=t+1;const g=r.push("hr","hr",0);return g.map=[t,r.line],g.markup=Array(f+1).join(String.fromCharCode(c)),!0}function skipBulletListMarker(r,t){const n=r.eMarks[t];let s=r.bMarks[t]+r.tShift[t];const o=r.src.charCodeAt(s++);if(o!==42&&o!==45&&o!==43)return-1;if(s<n){const a=r.src.charCodeAt(s);if(!isSpace(a))return-1}return s}function skipOrderedListMarker(r,t){const n=r.bMarks[t]+r.tShift[t],s=r.eMarks[t];let o=n;if(o+1>=s)return-1;let a=r.src.charCodeAt(o++);if(a<48||a>57)return-1;for(;;){if(o>=s)return-1;if(a=r.src.charCodeAt(o++),a>=48&&a<=57){if(o-n>=10)return-1;continue}if(a===41||a===46)break;return-1}return o<s&&(a=r.src.charCodeAt(o),!isSpace(a))?-1:o}function markTightParagraphs(r,t){const n=r.level+2;for(let s=t+2,o=r.tokens.length-2;s<o;s++)r.tokens[s].level===n&&r.tokens[s].type==="paragraph_open"&&(r.tokens[s+2].hidden=!0,r.tokens[s].hidden=!0,s+=2)}function list(r,t,n,s){let o,a,c,f,g=t,b=!0;if(r.sCount[g]-r.blkIndent>=4||r.listIndent>=0&&r.sCount[g]-r.listIndent>=4&&r.sCount[g]<r.blkIndent)return!1;let _=!1;s&&r.parentType==="paragraph"&&r.sCount[g]>=r.blkIndent&&(_=!0);let L,q,X;if((X=skipOrderedListMarker(r,g))>=0){if(L=!0,c=r.bMarks[g]+r.tShift[g],q=Number(r.src.slice(c,X-1)),_&&q!==1)return!1}else if((X=skipBulletListMarker(r,g))>=0)L=!1;else return!1;if(_&&r.skipSpaces(X)>=r.eMarks[g])return!1;if(s)return!0;const te=r.src.charCodeAt(X-1),ne=r.tokens.length;L?(f=r.push("ordered_list_open","ol",1),q!==1&&(f.attrs=[["start",q]])):f=r.push("bullet_list_open","ul",1);const Ce=[g,0];f.map=Ce,f.markup=String.fromCharCode(te);let Le=!1;const Ge=r.md.block.ruler.getRules("list"),ze=r.parentType;for(r.parentType="list";g<n;){a=X,o=r.eMarks[g];const Xe=r.sCount[g]+X-(r.bMarks[g]+r.tShift[g]);let He=Xe;for(;a<o;){const k=r.src.charCodeAt(a);if(k===9)He+=4-(He+r.bsCount[g])%4;else if(k===32)He++;else break;a++}const Ve=a;let We;Ve>=o?We=1:We=He-Xe,We>4&&(We=1);const rt=Xe+We;f=r.push("list_item_open","li",1),f.markup=String.fromCharCode(te);const st=[g,0];f.map=st,L&&(f.info=r.src.slice(c,X-1));const ht=r.tight,je=r.tShift[g],se=r.sCount[g],m=r.listIndent;if(r.listIndent=r.blkIndent,r.blkIndent=rt,r.tight=!0,r.tShift[g]=Ve-r.bMarks[g],r.sCount[g]=He,Ve>=o&&r.isEmpty(g+1)?r.line=Math.min(r.line+2,n):r.md.block.tokenize(r,g,n,!0),(!r.tight||Le)&&(b=!1),Le=r.line-g>1&&r.isEmpty(r.line-1),r.blkIndent=r.listIndent,r.listIndent=m,r.tShift[g]=je,r.sCount[g]=se,r.tight=ht,f=r.push("list_item_close","li",-1),f.markup=String.fromCharCode(te),g=r.line,st[1]=g,g>=n||r.sCount[g]<r.blkIndent||r.sCount[g]-r.blkIndent>=4)break;let A=!1;for(let k=0,Y=Ge.length;k<Y;k++)if(Ge[k](r,g,n,!0)){A=!0;break}if(A)break;if(L){if(X=skipOrderedListMarker(r,g),X<0)break;c=r.bMarks[g]+r.tShift[g]}else if(X=skipBulletListMarker(r,g),X<0)break;if(te!==r.src.charCodeAt(X-1))break}return L?f=r.push("ordered_list_close","ol",-1):f=r.push("bullet_list_close","ul",-1),f.markup=String.fromCharCode(te),Ce[1]=g,r.line=g,r.parentType=ze,b&&markTightParagraphs(r,ne),!0}function reference(r,t,n,s){let o=r.bMarks[t]+r.tShift[t],a=r.eMarks[t],c=t+1;if(r.sCount[t]-r.blkIndent>=4||r.src.charCodeAt(o)!==91)return!1;function f(Ge){const ze=r.lineMax;if(Ge>=ze||r.isEmpty(Ge))return null;let Xe=!1;if(r.sCount[Ge]-r.blkIndent>3&&(Xe=!0),r.sCount[Ge]<0&&(Xe=!0),!Xe){const We=r.md.block.ruler.getRules("reference"),rt=r.parentType;r.parentType="reference";let st=!1;for(let ht=0,je=We.length;ht<je;ht++)if(We[ht](r,Ge,ze,!0)){st=!0;break}if(r.parentType=rt,st)return null}const He=r.bMarks[Ge]+r.tShift[Ge],Ve=r.eMarks[Ge];return r.src.slice(He,Ve+1)}let g=r.src.slice(o,a+1);a=g.length;let b=-1;for(o=1;o<a;o++){const Ge=g.charCodeAt(o);if(Ge===91)return!1;if(Ge===93){b=o;break}else if(Ge===10){const ze=f(c);ze!==null&&(g+=ze,a=g.length,c++)}else if(Ge===92&&(o++,o<a&&g.charCodeAt(o)===10)){const ze=f(c);ze!==null&&(g+=ze,a=g.length,c++)}}if(b<0||g.charCodeAt(b+1)!==58)return!1;for(o=b+2;o<a;o++){const Ge=g.charCodeAt(o);if(Ge===10){const ze=f(c);ze!==null&&(g+=ze,a=g.length,c++)}else if(!isSpace(Ge))break}const _=r.md.helpers.parseLinkDestination(g,o,a);if(!_.ok)return!1;const L=r.md.normalizeLink(_.str);if(!r.md.validateLink(L))return!1;o=_.pos;const q=o,X=c,te=o;for(;o<a;o++){const Ge=g.charCodeAt(o);if(Ge===10){const ze=f(c);ze!==null&&(g+=ze,a=g.length,c++)}else if(!isSpace(Ge))break}let ne=r.md.helpers.parseLinkTitle(g,o,a);for(;ne.can_continue;){const Ge=f(c);if(Ge===null)break;g+=Ge,o=a,a=g.length,c++,ne=r.md.helpers.parseLinkTitle(g,o,a,ne)}let Ce;for(o<a&&te!==o&&ne.ok?(Ce=ne.str,o=ne.pos):(Ce="",o=q,c=X);o<a;){const Ge=g.charCodeAt(o);if(!isSpace(Ge))break;o++}if(o<a&&g.charCodeAt(o)!==10&&Ce)for(Ce="",o=q,c=X;o<a;){const Ge=g.charCodeAt(o);if(!isSpace(Ge))break;o++}if(o<a&&g.charCodeAt(o)!==10)return!1;const Le=normalizeReference(g.slice(1,b));return Le?(s||(typeof r.env.references>"u"&&(r.env.references={}),typeof r.env.references[Le]>"u"&&(r.env.references[Le]={title:Ce,href:L}),r.line=c),!0):!1}const block_names=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],attr_name="[a-zA-Z_:][a-zA-Z0-9:._-]*",unquoted="[^\"'=<>`\\x00-\\x20]+",single_quoted="'[^']*'",double_quoted='"[^"]*"',attr_value="(?:"+unquoted+"|"+single_quoted+"|"+double_quoted+")",attribute="(?:\\s+"+attr_name+"(?:\\s*=\\s*"+attr_value+")?)",open_tag="<[A-Za-z][A-Za-z0-9\\-]*"+attribute+"*\\s*\\/?>",close_tag="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",comment="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",processing="<[?][\\s\\S]*?[?]>",declaration="<![A-Za-z][^>]*>",cdata="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",HTML_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+"|"+comment+"|"+processing+"|"+declaration+"|"+cdata+")"),HTML_OPEN_CLOSE_TAG_RE=new RegExp("^(?:"+open_tag+"|"+close_tag+")"),HTML_SEQUENCES=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+block_names.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(HTML_OPEN_CLOSE_TAG_RE.source+"\\s*$"),/^$/,!1]];function html_block(r,t,n,s){let o=r.bMarks[t]+r.tShift[t],a=r.eMarks[t];if(r.sCount[t]-r.blkIndent>=4||!r.md.options.html||r.src.charCodeAt(o)!==60)return!1;let c=r.src.slice(o,a),f=0;for(;f<HTML_SEQUENCES.length&&!HTML_SEQUENCES[f][0].test(c);f++);if(f===HTML_SEQUENCES.length)return!1;if(s)return HTML_SEQUENCES[f][2];let g=t+1;if(!HTML_SEQUENCES[f][1].test(c)){for(;g<n&&!(r.sCount[g]<r.blkIndent);g++)if(o=r.bMarks[g]+r.tShift[g],a=r.eMarks[g],c=r.src.slice(o,a),HTML_SEQUENCES[f][1].test(c)){c.length!==0&&g++;break}}r.line=g;const b=r.push("html_block","",0);return b.map=[t,g],b.content=r.getLines(t,g,r.blkIndent,!0),!0}function heading(r,t,n,s){let o=r.bMarks[t]+r.tShift[t],a=r.eMarks[t];if(r.sCount[t]-r.blkIndent>=4)return!1;let c=r.src.charCodeAt(o);if(c!==35||o>=a)return!1;let f=1;for(c=r.src.charCodeAt(++o);c===35&&o<a&&f<=6;)f++,c=r.src.charCodeAt(++o);if(f>6||o<a&&!isSpace(c))return!1;if(s)return!0;a=r.skipSpacesBack(a,o);const g=r.skipCharsBack(a,35,o);g>o&&isSpace(r.src.charCodeAt(g-1))&&(a=g),r.line=t+1;const b=r.push("heading_open","h"+String(f),1);b.markup="########".slice(0,f),b.map=[t,r.line];const _=r.push("inline","",0);_.content=r.src.slice(o,a).trim(),_.map=[t,r.line],_.children=[];const L=r.push("heading_close","h"+String(f),-1);return L.markup="########".slice(0,f),!0}function lheading(r,t,n){const s=r.md.block.ruler.getRules("paragraph");if(r.sCount[t]-r.blkIndent>=4)return!1;const o=r.parentType;r.parentType="paragraph";let a=0,c,f=t+1;for(;f<n&&!r.isEmpty(f);f++){if(r.sCount[f]-r.blkIndent>3)continue;if(r.sCount[f]>=r.blkIndent){let X=r.bMarks[f]+r.tShift[f];const te=r.eMarks[f];if(X<te&&(c=r.src.charCodeAt(X),(c===45||c===61)&&(X=r.skipChars(X,c),X=r.skipSpaces(X),X>=te))){a=c===61?1:2;break}}if(r.sCount[f]<0)continue;let q=!1;for(let X=0,te=s.length;X<te;X++)if(s[X](r,f,n,!0)){q=!0;break}if(q)break}if(!a)return!1;const g=r.getLines(t,f,r.blkIndent,!1).trim();r.line=f+1;const b=r.push("heading_open","h"+String(a),1);b.markup=String.fromCharCode(c),b.map=[t,r.line];const _=r.push("inline","",0);_.content=g,_.map=[t,r.line-1],_.children=[];const L=r.push("heading_close","h"+String(a),-1);return L.markup=String.fromCharCode(c),r.parentType=o,!0}function paragraph(r,t,n){const s=r.md.block.ruler.getRules("paragraph"),o=r.parentType;let a=t+1;for(r.parentType="paragraph";a<n&&!r.isEmpty(a);a++){if(r.sCount[a]-r.blkIndent>3||r.sCount[a]<0)continue;let b=!1;for(let _=0,L=s.length;_<L;_++)if(s[_](r,a,n,!0)){b=!0;break}if(b)break}const c=r.getLines(t,a,r.blkIndent,!1).trim();r.line=a;const f=r.push("paragraph_open","p",1);f.map=[t,r.line];const g=r.push("inline","",0);return g.content=c,g.map=[t,r.line],g.children=[],r.push("paragraph_close","p",-1),r.parentType=o,!0}const _rules$1=[["table",table,["paragraph","reference"]],["code",code],["fence",fence,["paragraph","reference","blockquote","list"]],["blockquote",blockquote,["paragraph","reference","blockquote","list"]],["hr",hr,["paragraph","reference","blockquote","list"]],["list",list,["paragraph","reference","blockquote"]],["reference",reference],["html_block",html_block,["paragraph","reference","blockquote"]],["heading",heading,["paragraph","reference","blockquote"]],["lheading",lheading],["paragraph",paragraph]];function ParserBlock(){this.ruler=new Ruler;for(let r=0;r<_rules$1.length;r++)this.ruler.push(_rules$1[r][0],_rules$1[r][1],{alt:(_rules$1[r][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(r,t,n){const s=this.ruler.getRules(""),o=s.length,a=r.md.options.maxNesting;let c=t,f=!1;for(;c<n&&(r.line=c=r.skipEmptyLines(c),!(c>=n||r.sCount[c]<r.blkIndent));){if(r.level>=a){r.line=n;break}const g=r.line;let b=!1;for(let _=0;_<o;_++)if(b=s[_](r,c,n,!1),b){if(g>=r.line)throw new Error("block rule didn't increment state.line");break}if(!b)throw new Error("none of the block rules matched");r.tight=!f,r.isEmpty(r.line-1)&&(f=!0),c=r.line,c<n&&r.isEmpty(c)&&(f=!0,c++,r.line=c)}};ParserBlock.prototype.parse=function(r,t,n,s){if(!r)return;const o=new this.State(r,t,n,s);this.tokenize(o,o.line,o.lineMax)};ParserBlock.prototype.State=StateBlock;function StateInline(r,t,n,s){this.src=r,this.env=n,this.md=t,this.tokens=s,this.tokens_meta=Array(s.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}StateInline.prototype.pushPending=function(){const r=new Token("text","",0);return r.content=this.pending,r.level=this.pendingLevel,this.tokens.push(r),this.pending="",r};StateInline.prototype.push=function(r,t,n){this.pending&&this.pushPending();const s=new Token(r,t,n);let o=null;return n<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),s.level=this.level,n>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],o={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(s),this.tokens_meta.push(o),s};StateInline.prototype.scanDelims=function(r,t){const n=this.posMax,s=this.src.charCodeAt(r),o=r>0?this.src.charCodeAt(r-1):32;let a=r;for(;a<n&&this.src.charCodeAt(a)===s;)a++;const c=a-r,f=a<n?this.src.charCodeAt(a):32,g=isMdAsciiPunct(o)||isPunctChar(String.fromCharCode(o)),b=isMdAsciiPunct(f)||isPunctChar(String.fromCharCode(f)),_=isWhiteSpace(o),L=isWhiteSpace(f),q=!L&&(!b||_||g),X=!_&&(!g||L||b);return{can_open:q&&(t||!X||g),can_close:X&&(t||!q||b),length:c}};StateInline.prototype.Token=Token;function isTerminatorChar(r){switch(r){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function text(r,t){let n=r.pos;for(;n<r.posMax&&!isTerminatorChar(r.src.charCodeAt(n));)n++;return n===r.pos?!1:(t||(r.pending+=r.src.slice(r.pos,n)),r.pos=n,!0)}const SCHEME_RE=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function linkify(r,t){if(!r.md.options.linkify||r.linkLevel>0)return!1;const n=r.pos,s=r.posMax;if(n+3>s||r.src.charCodeAt(n)!==58||r.src.charCodeAt(n+1)!==47||r.src.charCodeAt(n+2)!==47)return!1;const o=r.pending.match(SCHEME_RE);if(!o)return!1;const a=o[1],c=r.md.linkify.matchAtStart(r.src.slice(n-a.length));if(!c)return!1;let f=c.url;if(f.length<=a.length)return!1;f=f.replace(/\*+$/,"");const g=r.md.normalizeLink(f);if(!r.md.validateLink(g))return!1;if(!t){r.pending=r.pending.slice(0,-a.length);const b=r.push("link_open","a",1);b.attrs=[["href",g]],b.markup="linkify",b.info="auto";const _=r.push("text","",0);_.content=r.md.normalizeLinkText(f);const L=r.push("link_close","a",-1);L.markup="linkify",L.info="auto"}return r.pos+=f.length-a.length,!0}function newline(r,t){let n=r.pos;if(r.src.charCodeAt(n)!==10)return!1;const s=r.pending.length-1,o=r.posMax;if(!t)if(s>=0&&r.pending.charCodeAt(s)===32)if(s>=1&&r.pending.charCodeAt(s-1)===32){let a=s-1;for(;a>=1&&r.pending.charCodeAt(a-1)===32;)a--;r.pending=r.pending.slice(0,a),r.push("hardbreak","br",0)}else r.pending=r.pending.slice(0,-1),r.push("softbreak","br",0);else r.push("softbreak","br",0);for(n++;n<o&&isSpace(r.src.charCodeAt(n));)n++;return r.pos=n,!0}const ESCAPED=[];for(let r=0;r<256;r++)ESCAPED.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(r){ESCAPED[r.charCodeAt(0)]=1});function escape(r,t){let n=r.pos;const s=r.posMax;if(r.src.charCodeAt(n)!==92||(n++,n>=s))return!1;let o=r.src.charCodeAt(n);if(o===10){for(t||r.push("hardbreak","br",0),n++;n<s&&(o=r.src.charCodeAt(n),!!isSpace(o));)n++;return r.pos=n,!0}let a=r.src[n];if(o>=55296&&o<=56319&&n+1<s){const f=r.src.charCodeAt(n+1);f>=56320&&f<=57343&&(a+=r.src[n+1],n++)}const c="\\"+a;if(!t){const f=r.push("text_special","",0);o<256&&ESCAPED[o]!==0?f.content=a:f.content=c,f.markup=c,f.info="escape"}return r.pos=n+1,!0}function backtick(r,t){let n=r.pos;if(r.src.charCodeAt(n)!==96)return!1;const o=n;n++;const a=r.posMax;for(;n<a&&r.src.charCodeAt(n)===96;)n++;const c=r.src.slice(o,n),f=c.length;if(r.backticksScanned&&(r.backticks[f]||0)<=o)return t||(r.pending+=c),r.pos+=f,!0;let g=n,b;for(;(b=r.src.indexOf("`",g))!==-1;){for(g=b+1;g<a&&r.src.charCodeAt(g)===96;)g++;const _=g-b;if(_===f){if(!t){const L=r.push("code_inline","code",0);L.markup=c,L.content=r.src.slice(n,b).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return r.pos=g,!0}r.backticks[_]=b}return r.backticksScanned=!0,t||(r.pending+=c),r.pos+=f,!0}function strikethrough_tokenize(r,t){const n=r.pos,s=r.src.charCodeAt(n);if(t||s!==126)return!1;const o=r.scanDelims(r.pos,!0);let a=o.length;const c=String.fromCharCode(s);if(a<2)return!1;let f;a%2&&(f=r.push("text","",0),f.content=c,a--);for(let g=0;g<a;g+=2)f=r.push("text","",0),f.content=c+c,r.delimiters.push({marker:s,length:0,token:r.tokens.length-1,end:-1,open:o.can_open,close:o.can_close});return r.pos+=o.length,!0}function postProcess$1(r,t){let n;const s=[],o=t.length;for(let a=0;a<o;a++){const c=t[a];if(c.marker!==126||c.end===-1)continue;const f=t[c.end];n=r.tokens[c.token],n.type="s_open",n.tag="s",n.nesting=1,n.markup="~~",n.content="",n=r.tokens[f.token],n.type="s_close",n.tag="s",n.nesting=-1,n.markup="~~",n.content="",r.tokens[f.token-1].type==="text"&&r.tokens[f.token-1].content==="~"&&s.push(f.token-1)}for(;s.length;){const a=s.pop();let c=a+1;for(;c<r.tokens.length&&r.tokens[c].type==="s_close";)c++;c--,a!==c&&(n=r.tokens[c],r.tokens[c]=r.tokens[a],r.tokens[a]=n)}}function strikethrough_postProcess(r){const t=r.tokens_meta,n=r.tokens_meta.length;postProcess$1(r,r.delimiters);for(let s=0;s<n;s++)t[s]&&t[s].delimiters&&postProcess$1(r,t[s].delimiters)}const r_strikethrough={tokenize:strikethrough_tokenize,postProcess:strikethrough_postProcess};function emphasis_tokenize(r,t){const n=r.pos,s=r.src.charCodeAt(n);if(t||s!==95&&s!==42)return!1;const o=r.scanDelims(r.pos,s===42);for(let a=0;a<o.length;a++){const c=r.push("text","",0);c.content=String.fromCharCode(s),r.delimiters.push({marker:s,length:o.length,token:r.tokens.length-1,end:-1,open:o.can_open,close:o.can_close})}return r.pos+=o.length,!0}function postProcess(r,t){const n=t.length;for(let s=n-1;s>=0;s--){const o=t[s];if(o.marker!==95&&o.marker!==42||o.end===-1)continue;const a=t[o.end],c=s>0&&t[s-1].end===o.end+1&&t[s-1].marker===o.marker&&t[s-1].token===o.token-1&&t[o.end+1].token===a.token+1,f=String.fromCharCode(o.marker),g=r.tokens[o.token];g.type=c?"strong_open":"em_open",g.tag=c?"strong":"em",g.nesting=1,g.markup=c?f+f:f,g.content="";const b=r.tokens[a.token];b.type=c?"strong_close":"em_close",b.tag=c?"strong":"em",b.nesting=-1,b.markup=c?f+f:f,b.content="",c&&(r.tokens[t[s-1].token].content="",r.tokens[t[o.end+1].token].content="",s--)}}function emphasis_post_process(r){const t=r.tokens_meta,n=r.tokens_meta.length;postProcess(r,r.delimiters);for(let s=0;s<n;s++)t[s]&&t[s].delimiters&&postProcess(r,t[s].delimiters)}const r_emphasis={tokenize:emphasis_tokenize,postProcess:emphasis_post_process};function link(r,t){let n,s,o,a,c="",f="",g=r.pos,b=!0;if(r.src.charCodeAt(r.pos)!==91)return!1;const _=r.pos,L=r.posMax,q=r.pos+1,X=r.md.helpers.parseLinkLabel(r,r.pos,!0);if(X<0)return!1;let te=X+1;if(te<L&&r.src.charCodeAt(te)===40){for(b=!1,te++;te<L&&(n=r.src.charCodeAt(te),!(!isSpace(n)&&n!==10));te++);if(te>=L)return!1;if(g=te,o=r.md.helpers.parseLinkDestination(r.src,te,r.posMax),o.ok){for(c=r.md.normalizeLink(o.str),r.md.validateLink(c)?te=o.pos:c="",g=te;te<L&&(n=r.src.charCodeAt(te),!(!isSpace(n)&&n!==10));te++);if(o=r.md.helpers.parseLinkTitle(r.src,te,r.posMax),te<L&&g!==te&&o.ok)for(f=o.str,te=o.pos;te<L&&(n=r.src.charCodeAt(te),!(!isSpace(n)&&n!==10));te++);}(te>=L||r.src.charCodeAt(te)!==41)&&(b=!0),te++}if(b){if(typeof r.env.references>"u")return!1;if(te<L&&r.src.charCodeAt(te)===91?(g=te+1,te=r.md.helpers.parseLinkLabel(r,te),te>=0?s=r.src.slice(g,te++):te=X+1):te=X+1,s||(s=r.src.slice(q,X)),a=r.env.references[normalizeReference(s)],!a)return r.pos=_,!1;c=a.href,f=a.title}if(!t){r.pos=q,r.posMax=X;const ne=r.push("link_open","a",1),Ce=[["href",c]];ne.attrs=Ce,f&&Ce.push(["title",f]),r.linkLevel++,r.md.inline.tokenize(r),r.linkLevel--,r.push("link_close","a",-1)}return r.pos=te,r.posMax=L,!0}function image(r,t){let n,s,o,a,c,f,g,b,_="";const L=r.pos,q=r.posMax;if(r.src.charCodeAt(r.pos)!==33||r.src.charCodeAt(r.pos+1)!==91)return!1;const X=r.pos+2,te=r.md.helpers.parseLinkLabel(r,r.pos+1,!1);if(te<0)return!1;if(a=te+1,a<q&&r.src.charCodeAt(a)===40){for(a++;a<q&&(n=r.src.charCodeAt(a),!(!isSpace(n)&&n!==10));a++);if(a>=q)return!1;for(b=a,f=r.md.helpers.parseLinkDestination(r.src,a,r.posMax),f.ok&&(_=r.md.normalizeLink(f.str),r.md.validateLink(_)?a=f.pos:_=""),b=a;a<q&&(n=r.src.charCodeAt(a),!(!isSpace(n)&&n!==10));a++);if(f=r.md.helpers.parseLinkTitle(r.src,a,r.posMax),a<q&&b!==a&&f.ok)for(g=f.str,a=f.pos;a<q&&(n=r.src.charCodeAt(a),!(!isSpace(n)&&n!==10));a++);else g="";if(a>=q||r.src.charCodeAt(a)!==41)return r.pos=L,!1;a++}else{if(typeof r.env.references>"u")return!1;if(a<q&&r.src.charCodeAt(a)===91?(b=a+1,a=r.md.helpers.parseLinkLabel(r,a),a>=0?o=r.src.slice(b,a++):a=te+1):a=te+1,o||(o=r.src.slice(X,te)),c=r.env.references[normalizeReference(o)],!c)return r.pos=L,!1;_=c.href,g=c.title}if(!t){s=r.src.slice(X,te);const ne=[];r.md.inline.parse(s,r.md,r.env,ne);const Ce=r.push("image","img",0),Le=[["src",_],["alt",""]];Ce.attrs=Le,Ce.children=ne,Ce.content=s,g&&Le.push(["title",g])}return r.pos=a,r.posMax=q,!0}const EMAIL_RE=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,AUTOLINK_RE=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function autolink$1(r,t){let n=r.pos;if(r.src.charCodeAt(n)!==60)return!1;const s=r.pos,o=r.posMax;for(;;){if(++n>=o)return!1;const c=r.src.charCodeAt(n);if(c===60)return!1;if(c===62)break}const a=r.src.slice(s+1,n);if(AUTOLINK_RE.test(a)){const c=r.md.normalizeLink(a);if(!r.md.validateLink(c))return!1;if(!t){const f=r.push("link_open","a",1);f.attrs=[["href",c]],f.markup="autolink",f.info="auto";const g=r.push("text","",0);g.content=r.md.normalizeLinkText(a);const b=r.push("link_close","a",-1);b.markup="autolink",b.info="auto"}return r.pos+=a.length+2,!0}if(EMAIL_RE.test(a)){const c=r.md.normalizeLink("mailto:"+a);if(!r.md.validateLink(c))return!1;if(!t){const f=r.push("link_open","a",1);f.attrs=[["href",c]],f.markup="autolink",f.info="auto";const g=r.push("text","",0);g.content=r.md.normalizeLinkText(a);const b=r.push("link_close","a",-1);b.markup="autolink",b.info="auto"}return r.pos+=a.length+2,!0}return!1}function isLinkOpen(r){return/^<a[>\s]/i.test(r)}function isLinkClose(r){return/^<\/a\s*>/i.test(r)}function isLetter(r){const t=r|32;return t>=97&&t<=122}function html_inline(r,t){if(!r.md.options.html)return!1;const n=r.posMax,s=r.pos;if(r.src.charCodeAt(s)!==60||s+2>=n)return!1;const o=r.src.charCodeAt(s+1);if(o!==33&&o!==63&&o!==47&&!isLetter(o))return!1;const a=r.src.slice(s).match(HTML_TAG_RE);if(!a)return!1;if(!t){const c=r.push("html_inline","",0);c.content=a[0],isLinkOpen(c.content)&&r.linkLevel++,isLinkClose(c.content)&&r.linkLevel--}return r.pos+=a[0].length,!0}const DIGITAL_RE=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;function entity(r,t){const n=r.pos,s=r.posMax;if(r.src.charCodeAt(n)!==38||n+1>=s)return!1;if(r.src.charCodeAt(n+1)===35){const a=r.src.slice(n).match(DIGITAL_RE);if(a){if(!t){const c=a[1][0].toLowerCase()==="x"?parseInt(a[1].slice(1),16):parseInt(a[1],10),f=r.push("text_special","",0);f.content=isValidEntityCode(c)?fromCodePoint(c):fromCodePoint(65533),f.markup=a[0],f.info="entity"}return r.pos+=a[0].length,!0}}else{const a=r.src.slice(n).match(NAMED_RE);if(a){const c=decodeHTML(a[0]);if(c!==a[0]){if(!t){const f=r.push("text_special","",0);f.content=c,f.markup=a[0],f.info="entity"}return r.pos+=a[0].length,!0}}}return!1}function processDelimiters(r){const t={},n=r.length;if(!n)return;let s=0,o=-2;const a=[];for(let c=0;c<n;c++){const f=r[c];if(a.push(0),(r[s].marker!==f.marker||o!==f.token-1)&&(s=c),o=f.token,f.length=f.length||0,!f.close)continue;t.hasOwnProperty(f.marker)||(t[f.marker]=[-1,-1,-1,-1,-1,-1]);const g=t[f.marker][(f.open?3:0)+f.length%3];let b=s-a[s]-1,_=b;for(;b>g;b-=a[b]+1){const L=r[b];if(L.marker===f.marker&&L.open&&L.end<0){let q=!1;if((L.close||f.open)&&(L.length+f.length)%3===0&&(L.length%3!==0||f.length%3!==0)&&(q=!0),!q){const X=b>0&&!r[b-1].open?a[b-1]+1:0;a[c]=c-b+X,a[b]=X,f.open=!1,L.end=c,L.close=!1,_=-1,o=-2;break}}}_!==-1&&(t[f.marker][(f.open?3:0)+(f.length||0)%3]=_)}}function link_pairs(r){const t=r.tokens_meta,n=r.tokens_meta.length;processDelimiters(r.delimiters);for(let s=0;s<n;s++)t[s]&&t[s].delimiters&&processDelimiters(t[s].delimiters)}function fragments_join(r){let t,n,s=0;const o=r.tokens,a=r.tokens.length;for(t=n=0;t<a;t++)o[t].nesting<0&&s--,o[t].level=s,o[t].nesting>0&&s++,o[t].type==="text"&&t+1<a&&o[t+1].type==="text"?o[t+1].content=o[t].content+o[t+1].content:(t!==n&&(o[n]=o[t]),n++);t!==n&&(o.length=n)}const _rules=[["text",text],["linkify",linkify],["newline",newline],["escape",escape],["backticks",backtick],["strikethrough",r_strikethrough.tokenize],["emphasis",r_emphasis.tokenize],["link",link],["image",image],["autolink",autolink$1],["html_inline",html_inline],["entity",entity]],_rules2=[["balance_pairs",link_pairs],["strikethrough",r_strikethrough.postProcess],["emphasis",r_emphasis.postProcess],["fragments_join",fragments_join]];function ParserInline(){this.ruler=new Ruler;for(let r=0;r<_rules.length;r++)this.ruler.push(_rules[r][0],_rules[r][1]);this.ruler2=new Ruler;for(let r=0;r<_rules2.length;r++)this.ruler2.push(_rules2[r][0],_rules2[r][1])}ParserInline.prototype.skipToken=function(r){const t=r.pos,n=this.ruler.getRules(""),s=n.length,o=r.md.options.maxNesting,a=r.cache;if(typeof a[t]<"u"){r.pos=a[t];return}let c=!1;if(r.level<o){for(let f=0;f<s;f++)if(r.level++,c=n[f](r,!0),r.level--,c){if(t>=r.pos)throw new Error("inline rule didn't increment state.pos");break}}else r.pos=r.posMax;c||r.pos++,a[t]=r.pos};ParserInline.prototype.tokenize=function(r){const t=this.ruler.getRules(""),n=t.length,s=r.posMax,o=r.md.options.maxNesting;for(;r.pos<s;){const a=r.pos;let c=!1;if(r.level<o){for(let f=0;f<n;f++)if(c=t[f](r,!1),c){if(a>=r.pos)throw new Error("inline rule didn't increment state.pos");break}}if(c){if(r.pos>=s)break;continue}r.pending+=r.src[r.pos++]}r.pending&&r.pushPending()};ParserInline.prototype.parse=function(r,t,n,s){const o=new this.State(r,t,n,s);this.tokenize(o);const a=this.ruler2.getRules(""),c=a.length;for(let f=0;f<c;f++)a[f](o)};ParserInline.prototype.State=StateInline;function reFactory(r){const t={};r=r||{},t.src_Any=Any.source,t.src_Cc=Cc.source,t.src_Z=Z.source,t.src_P=P.source,t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|"),t.src_ZCc=[t.src_Z,t.src_Cc].join("|");const n="[><]";return t.src_pseudo_letter="(?:(?!"+n+"|"+t.src_ZPCc+")"+t.src_Any+")",t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?",t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",t.src_host_terminator="(?=$|"+n+"|"+t.src_ZPCc+")(?!"+(r["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))",t.src_path="(?:[/?#](?:(?!"+t.src_ZCc+"|"+n+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+t.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+t.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+t.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+t.src_ZCc+"|[']).)+\\'|\\'(?="+t.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+t.src_ZCc+"|[.]|$)|"+(r["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+t.src_ZCc+"|$)|;(?!"+t.src_ZCc+"|$)|\\!+(?!"+t.src_ZCc+"|[!]|$)|\\?(?!"+t.src_ZCc+"|[?]|$))+|\\/)?",t.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',t.src_xn="xn--[a-z0-9\\-]{1,59}",t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63})",t.src_domain="(?:"+t.src_xn+"|(?:"+t.src_pseudo_letter+")|(?:"+t.src_pseudo_letter+"(?:-|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+"))",t.src_host="(?:(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+"))",t.tpl_host_fuzzy="(?:"+t.src_ip4+"|(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%)))",t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))",t.src_host_strict=t.src_host+t.src_host_terminator,t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator,t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator,t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))",t.tpl_email_fuzzy="(^|"+n+'|"|\\(|'+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")",t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+t.src_ZPCc+"))((?![$+<=>^`|])"+t.tpl_host_port_fuzzy_strict+t.src_path+")",t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|]|"+t.src_ZPCc+"))((?![$+<=>^`|])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")",t}function assign(r){return Array.prototype.slice.call(arguments,1).forEach(function(n){n&&Object.keys(n).forEach(function(s){r[s]=n[s]})}),r}function _class(r){return Object.prototype.toString.call(r)}function isString(r){return _class(r)==="[object String]"}function isObject(r){return _class(r)==="[object Object]"}function isRegExp(r){return _class(r)==="[object RegExp]"}function isFunction(r){return _class(r)==="[object Function]"}function escapeRE(r){return r.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const defaultOptions={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function isOptionsObj(r){return Object.keys(r||{}).reduce(function(t,n){return t||defaultOptions.hasOwnProperty(n)},!1)}const defaultSchemas={"http:":{validate:function(r,t,n){const s=r.slice(t);return n.re.http||(n.re.http=new RegExp("^\\/\\/"+n.re.src_auth+n.re.src_host_port_strict+n.re.src_path,"i")),n.re.http.test(s)?s.match(n.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(r,t,n){const s=r.slice(t);return n.re.no_http||(n.re.no_http=new RegExp("^"+n.re.src_auth+"(?:localhost|(?:(?:"+n.re.src_domain+")\\.)+"+n.re.src_domain_root+")"+n.re.src_port+n.re.src_host_terminator+n.re.src_path,"i")),n.re.no_http.test(s)?t>=3&&r[t-3]===":"||t>=3&&r[t-3]==="/"?0:s.match(n.re.no_http)[0].length:0}},"mailto:":{validate:function(r,t,n){const s=r.slice(t);return n.re.mailto||(n.re.mailto=new RegExp("^"+n.re.src_email_name+"@"+n.re.src_host_strict,"i")),n.re.mailto.test(s)?s.match(n.re.mailto)[0].length:0}}},tlds_2ch_src_re="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",tlds_default="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|".split("|");function resetScanCache(r){r.__index__=-1,r.__text_cache__=""}function createValidator(r){return function(t,n){const s=t.slice(n);return r.test(s)?s.match(r)[0].length:0}}function createNormalizer(){return function(r,t){t.normalize(r)}}function compile(r){const t=r.re=reFactory(r.__opts__),n=r.__tlds__.slice();r.onCompile(),r.__tlds_replaced__||n.push(tlds_2ch_src_re),n.push(t.src_xn),t.src_tlds=n.join("|");function s(f){return f.replace("%TLDS%",t.src_tlds)}t.email_fuzzy=RegExp(s(t.tpl_email_fuzzy),"i"),t.link_fuzzy=RegExp(s(t.tpl_link_fuzzy),"i"),t.link_no_ip_fuzzy=RegExp(s(t.tpl_link_no_ip_fuzzy),"i"),t.host_fuzzy_test=RegExp(s(t.tpl_host_fuzzy_test),"i");const o=[];r.__compiled__={};function a(f,g){throw new Error('(LinkifyIt) Invalid schema "'+f+'": '+g)}Object.keys(r.__schemas__).forEach(function(f){const g=r.__schemas__[f];if(g===null)return;const b={validate:null,link:null};if(r.__compiled__[f]=b,isObject(g)){isRegExp(g.validate)?b.validate=createValidator(g.validate):isFunction(g.validate)?b.validate=g.validate:a(f,g),isFunction(g.normalize)?b.normalize=g.normalize:g.normalize?a(f,g):b.normalize=createNormalizer();return}if(isString(g)){o.push(f);return}a(f,g)}),o.forEach(function(f){r.__compiled__[r.__schemas__[f]]&&(r.__compiled__[f].validate=r.__compiled__[r.__schemas__[f]].validate,r.__compiled__[f].normalize=r.__compiled__[r.__schemas__[f]].normalize)}),r.__compiled__[""]={validate:null,normalize:createNormalizer()};const c=Object.keys(r.__compiled__).filter(function(f){return f.length>0&&r.__compiled__[f]}).map(escapeRE).join("|");r.re.schema_test=RegExp("(^|(?!_)(?:[><]|"+t.src_ZPCc+"))("+c+")","i"),r.re.schema_search=RegExp("(^|(?!_)(?:[><]|"+t.src_ZPCc+"))("+c+")","ig"),r.re.schema_at_start=RegExp("^"+r.re.schema_search.source,"i"),r.re.pretest=RegExp("("+r.re.schema_test.source+")|("+r.re.host_fuzzy_test.source+")|@","i"),resetScanCache(r)}function Match(r,t){const n=r.__index__,s=r.__last_index__,o=r.__text_cache__.slice(n,s);this.schema=r.__schema__.toLowerCase(),this.index=n+t,this.lastIndex=s+t,this.raw=o,this.text=o,this.url=o}function createMatch(r,t){const n=new Match(r,t);return r.__compiled__[n.schema].normalize(n,r),n}function LinkifyIt(r,t){if(!(this instanceof LinkifyIt))return new LinkifyIt(r,t);t||isOptionsObj(r)&&(t=r,r={}),this.__opts__=assign({},defaultOptions,t),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=assign({},defaultSchemas,r),this.__compiled__={},this.__tlds__=tlds_default,this.__tlds_replaced__=!1,this.re={},compile(this)}LinkifyIt.prototype.add=function r(t,n){return this.__schemas__[t]=n,compile(this),this};LinkifyIt.prototype.set=function r(t){return this.__opts__=assign(this.__opts__,t),this};LinkifyIt.prototype.test=function r(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return!1;let n,s,o,a,c,f,g,b,_;if(this.re.schema_test.test(t)){for(g=this.re.schema_search,g.lastIndex=0;(n=g.exec(t))!==null;)if(a=this.testSchemaAt(t,n[2],g.lastIndex),a){this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+a;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(b=t.search(this.re.host_fuzzy_test),b>=0&&(this.__index__<0||b<this.__index__)&&(s=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(c=s.index+s[1].length,(this.__index__<0||c<this.__index__)&&(this.__schema__="",this.__index__=c,this.__last_index__=s.index+s[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(_=t.indexOf("@"),_>=0&&(o=t.match(this.re.email_fuzzy))!==null&&(c=o.index+o[1].length,f=o.index+o[0].length,(this.__index__<0||c<this.__index__||c===this.__index__&&f>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=c,this.__last_index__=f))),this.__index__>=0};LinkifyIt.prototype.pretest=function r(t){return this.re.pretest.test(t)};LinkifyIt.prototype.testSchemaAt=function r(t,n,s){return this.__compiled__[n.toLowerCase()]?this.__compiled__[n.toLowerCase()].validate(t,s,this):0};LinkifyIt.prototype.match=function r(t){const n=[];let s=0;this.__index__>=0&&this.__text_cache__===t&&(n.push(createMatch(this,s)),s=this.__last_index__);let o=s?t.slice(s):t;for(;this.test(o);)n.push(createMatch(this,s)),o=o.slice(this.__last_index__),s+=this.__last_index__;return n.length?n:null};LinkifyIt.prototype.matchAtStart=function r(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return null;const n=this.re.schema_at_start.exec(t);if(!n)return null;const s=this.testSchemaAt(t,n[2],n[0].length);return s?(this.__schema__=n[2],this.__index__=n.index+n[1].length,this.__last_index__=n.index+n[0].length+s,createMatch(this,0)):null};LinkifyIt.prototype.tlds=function r(t,n){return t=Array.isArray(t)?t:[t],n?(this.__tlds__=this.__tlds__.concat(t).sort().filter(function(s,o,a){return s!==a[o-1]}).reverse(),compile(this),this):(this.__tlds__=t.slice(),this.__tlds_replaced__=!0,compile(this),this)};LinkifyIt.prototype.normalize=function r(t){t.schema||(t.url="http://"+t.url),t.schema==="mailto:"&&!/^mailto:/i.test(t.url)&&(t.url="mailto:"+t.url)};LinkifyIt.prototype.onCompile=function r(){};const maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\0-\x7F]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(r){throw new RangeError(errors[r])}function map(r,t){const n=[];let s=r.length;for(;s--;)n[s]=t(r[s]);return n}function mapDomain(r,t){const n=r.split("@");let s="";n.length>1&&(s=n[0]+"@",r=n[1]),r=r.replace(regexSeparators,".");const o=r.split("."),a=map(o,t).join(".");return s+a}function ucs2decode(r){const t=[];let n=0;const s=r.length;for(;n<s;){const o=r.charCodeAt(n++);if(o>=55296&&o<=56319&&n<s){const a=r.charCodeAt(n++);(a&64512)==56320?t.push(((o&1023)<<10)+(a&1023)+65536):(t.push(o),n--)}else t.push(o)}return t}const ucs2encode=r=>String.fromCodePoint(...r),basicToDigit=function(r){return r>=48&&r<58?26+(r-48):r>=65&&r<91?r-65:r>=97&&r<123?r-97:base},digitToBasic=function(r,t){return r+22+75*(r<26)-((t!=0)<<5)},adapt=function(r,t,n){let s=0;for(r=n?floor(r/damp):r>>1,r+=floor(r/t);r>baseMinusTMin*tMax>>1;s+=base)r=floor(r/baseMinusTMin);return floor(s+(baseMinusTMin+1)*r/(r+skew))},decode$2=function(r){const t=[],n=r.length;let s=0,o=initialN,a=initialBias,c=r.lastIndexOf(delimiter);c<0&&(c=0);for(let f=0;f<c;++f)r.charCodeAt(f)>=128&&error("not-basic"),t.push(r.charCodeAt(f));for(let f=c>0?c+1:0;f<n;){const g=s;for(let _=1,L=base;;L+=base){f>=n&&error("invalid-input");const q=basicToDigit(r.charCodeAt(f++));q>=base&&error("invalid-input"),q>floor((maxInt-s)/_)&&error("overflow"),s+=q*_;const X=L<=a?tMin:L>=a+tMax?tMax:L-a;if(q<X)break;const te=base-X;_>floor(maxInt/te)&&error("overflow"),_*=te}const b=t.length+1;a=adapt(s-g,b,g==0),floor(s/b)>maxInt-o&&error("overflow"),o+=floor(s/b),s%=b,t.splice(s++,0,o)}return String.fromCodePoint(...t)},encode$1=function(r){const t=[];r=ucs2decode(r);const n=r.length;let s=initialN,o=0,a=initialBias;for(const g of r)g<128&&t.push(stringFromCharCode(g));const c=t.length;let f=c;for(c&&t.push(delimiter);f<n;){let g=maxInt;for(const _ of r)_>=s&&_<g&&(g=_);const b=f+1;g-s>floor((maxInt-o)/b)&&error("overflow"),o+=(g-s)*b,s=g;for(const _ of r)if(_<s&&++o>maxInt&&error("overflow"),_===s){let L=o;for(let q=base;;q+=base){const X=q<=a?tMin:q>=a+tMax?tMax:q-a;if(L<X)break;const te=L-X,ne=base-X;t.push(stringFromCharCode(digitToBasic(X+te%ne,0))),L=floor(te/ne)}t.push(stringFromCharCode(digitToBasic(L,0))),a=adapt(o,b,f===c),o=0,++f}++o,++s}return t.join("")},toUnicode=function(r){return mapDomain(r,function(t){return regexPunycode.test(t)?decode$2(t.slice(4).toLowerCase()):t})},toASCII=function(r){return mapDomain(r,function(t){return regexNonASCII.test(t)?"xn--"+encode$1(t):t})},punycode={version:"2.3.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode$2,encode:encode$1,toASCII,toUnicode},cfg_default={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},cfg_zero={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},cfg_commonmark={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},config={default:cfg_default,zero:cfg_zero,commonmark:cfg_commonmark},BAD_PROTO_RE=/^(vbscript|javascript|file|data):/,GOOD_DATA_RE=/^data:image\/(gif|png|jpeg|webp);/;function validateLink(r){const t=r.trim().toLowerCase();return BAD_PROTO_RE.test(t)?GOOD_DATA_RE.test(t):!0}const RECODE_HOSTNAME_FOR=["http:","https:","mailto:"];function normalizeLink(r){const t=urlParse(r,!0);if(t.hostname&&(!t.protocol||RECODE_HOSTNAME_FOR.indexOf(t.protocol)>=0))try{t.hostname=punycode.toASCII(t.hostname)}catch{}return encode$2(format(t))}function normalizeLinkText(r){const t=urlParse(r,!0);if(t.hostname&&(!t.protocol||RECODE_HOSTNAME_FOR.indexOf(t.protocol)>=0))try{t.hostname=punycode.toUnicode(t.hostname)}catch{}return decode$3(format(t),decode$3.defaultChars+"%")}function MarkdownIt(r,t){if(!(this instanceof MarkdownIt))return new MarkdownIt(r,t);t||isString$1(r)||(t=r||{},r="default"),this.inline=new ParserInline,this.block=new ParserBlock,this.core=new Core,this.renderer=new Renderer,this.linkify=new LinkifyIt,this.validateLink=validateLink,this.normalizeLink=normalizeLink,this.normalizeLinkText=normalizeLinkText,this.utils=utils$2,this.helpers=assign$1({},helpers),this.options={},this.configure(r),t&&this.set(t)}MarkdownIt.prototype.set=function(r){return assign$1(this.options,r),this};MarkdownIt.prototype.configure=function(r){const t=this;if(isString$1(r)){const n=r;if(r=config[n],!r)throw new Error('Wrong `markdown-it` preset "'+n+'", check name')}if(!r)throw new Error("Wrong `markdown-it` preset, can't be empty");return r.options&&t.set(r.options),r.components&&Object.keys(r.components).forEach(function(n){r.components[n].rules&&t[n].ruler.enableOnly(r.components[n].rules),r.components[n].rules2&&t[n].ruler2.enableOnly(r.components[n].rules2)}),this};MarkdownIt.prototype.enable=function(r,t){let n=[];Array.isArray(r)||(r=[r]),["core","block","inline"].forEach(function(o){n=n.concat(this[o].ruler.enable(r,!0))},this),n=n.concat(this.inline.ruler2.enable(r,!0));const s=r.filter(function(o){return n.indexOf(o)<0});if(s.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+s);return this};MarkdownIt.prototype.disable=function(r,t){let n=[];Array.isArray(r)||(r=[r]),["core","block","inline"].forEach(function(o){n=n.concat(this[o].ruler.disable(r,!0))},this),n=n.concat(this.inline.ruler2.disable(r,!0));const s=r.filter(function(o){return n.indexOf(o)<0});if(s.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+s);return this};MarkdownIt.prototype.use=function(r){const t=[this].concat(Array.prototype.slice.call(arguments,1));return r.apply(r,t),this};MarkdownIt.prototype.parse=function(r,t){if(typeof r!="string")throw new Error("Input data should be a String");const n=new this.core.State(r,this,t);return this.core.process(n),n.tokens};MarkdownIt.prototype.render=function(r,t){return t=t||{},this.renderer.render(this.parse(r,t),this.options,t)};MarkdownIt.prototype.parseInline=function(r,t){const n=new this.core.State(r,this,t);return n.inlineMode=!0,this.core.process(n),n.tokens};MarkdownIt.prototype.renderInline=function(r,t){return t=t||{},this.renderer.render(this.parseInline(r,t),this.options,t)};const schema=new Schema({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(r){return["h"+r.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:r=>({params:r.getAttribute("data-params")||""})}],toDOM(r){return["pre",r.attrs.params?{"data-params":r.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(r){return{order:r.hasAttribute("start")?+r.getAttribute("start"):1,tight:r.hasAttribute("data-tight")}}}],toDOM(r){return["ol",{start:r.attrs.order==1?null:r.attrs.order,"data-tight":r.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:r=>({tight:r.hasAttribute("data-tight")})}],toDOM(r){return["ul",{"data-tight":r.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(r){return{src:r.getAttribute("src"),title:r.getAttribute("title"),alt:r.getAttribute("alt")}}}],toDOM(r){return["img",r.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:r=>r.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name=="strong"},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(r){return{href:r.getAttribute("href"),title:r.getAttribute("title")}}}],toDOM(r){return["a",r.attrs]}},code:{code:!0,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function maybeMerge(r,t){if(r.isText&&t.isText&&Mark$1.sameSet(r.marks,t.marks))return r.withText(r.text+t.text)}class MarkdownParseState{constructor(t,n){this.schema=t,this.tokenHandlers=n,this.stack=[{type:t.topNodeType,attrs:null,content:[],marks:Mark$1.none}]}top(){return this.stack[this.stack.length-1]}push(t){this.stack.length&&this.top().content.push(t)}addText(t){if(!t)return;let n=this.top(),s=n.content,o=s[s.length-1],a=this.schema.text(t,n.marks),c;o&&(c=maybeMerge(o,a))?s[s.length-1]=c:s.push(a)}openMark(t){let n=this.top();n.marks=t.addToSet(n.marks)}closeMark(t){let n=this.top();n.marks=t.removeFromSet(n.marks)}parseTokens(t){for(let n=0;n<t.length;n++){let s=t[n],o=this.tokenHandlers[s.type];if(!o)throw new Error("Token type `"+s.type+"` not supported by Markdown parser");o(this,s,t,n)}}addNode(t,n,s){let o=this.top(),a=t.createAndFill(n,s,o?o.marks:[]);return a?(this.push(a),a):null}openNode(t,n){this.stack.push({type:t,attrs:n,content:[],marks:Mark$1.none})}closeNode(){let t=this.stack.pop();return this.addNode(t.type,t.attrs,t.content)}}function attrs(r,t,n,s){return r.getAttrs?r.getAttrs(t,n,s):r.attrs instanceof Function?r.attrs(t):r.attrs}function noCloseToken(r,t){return r.noCloseToken||t=="code_inline"||t=="code_block"||t=="fence"}function withoutTrailingNewline(r){return r[r.length-1]==`
`?r.slice(0,r.length-1):r}function noOp(){}function tokenHandlers(r,t){let n=Object.create(null);for(let s in t){let o=t[s];if(o.block){let a=r.nodeType(o.block);noCloseToken(o,s)?n[s]=(c,f,g,b)=>{c.openNode(a,attrs(o,f,g,b)),c.addText(withoutTrailingNewline(f.content)),c.closeNode()}:(n[s+"_open"]=(c,f,g,b)=>c.openNode(a,attrs(o,f,g,b)),n[s+"_close"]=c=>c.closeNode())}else if(o.node){let a=r.nodeType(o.node);n[s]=(c,f,g,b)=>c.addNode(a,attrs(o,f,g,b))}else if(o.mark){let a=r.marks[o.mark];noCloseToken(o,s)?n[s]=(c,f,g,b)=>{c.openMark(a.create(attrs(o,f,g,b))),c.addText(withoutTrailingNewline(f.content)),c.closeMark(a)}:(n[s+"_open"]=(c,f,g,b)=>c.openMark(a.create(attrs(o,f,g,b))),n[s+"_close"]=c=>c.closeMark(a))}else if(o.ignore)noCloseToken(o,s)?n[s]=noOp:(n[s+"_open"]=noOp,n[s+"_close"]=noOp);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(o))}return n.text=(s,o)=>s.addText(o.content),n.inline=(s,o)=>s.parseTokens(o.children),n.softbreak=n.softbreak||(s=>s.addText(" ")),n}class MarkdownParser{constructor(t,n,s){this.schema=t,this.tokenizer=n,this.tokens=s,this.tokenHandlers=tokenHandlers(t,s)}parse(t,n={}){let s=new MarkdownParseState(this.schema,this.tokenHandlers),o;s.parseTokens(this.tokenizer.parse(t,n));do o=s.closeNode();while(s.stack.length);return o||this.schema.topNodeType.createAndFill()}}function listIsTight(r,t){for(;++t<r.length;)if(r[t].type!="list_item_open")return r[t].hidden;return!1}new MarkdownParser(schema,MarkdownIt("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(r,t,n)=>({tight:listIsTight(t,n)})},ordered_list:{block:"ordered_list",getAttrs:(r,t,n)=>({order:+r.attrGet("start")||1,tight:listIsTight(t,n)})},heading:{block:"heading",getAttrs:r=>({level:+r.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:r=>({params:r.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:r=>({src:r.attrGet("src"),title:r.attrGet("title")||null,alt:r.children[0]&&r.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:r=>({href:r.attrGet("href"),title:r.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});const blankMark={open:"",close:"",mixable:!0};class MarkdownSerializer{constructor(t,n,s={}){this.nodes=t,this.marks=n,this.options=s}serialize(t,n={}){n=Object.assign({},this.options,n);let s=new MarkdownSerializerState(this.nodes,this.marks,n);return s.renderContent(t),s.out}}const defaultMarkdownSerializer=new MarkdownSerializer({blockquote(r,t){r.wrapBlock("> ",null,t,()=>r.renderContent(t))},code_block(r,t){const n=t.textContent.match(/`{3,}/gm),s=n?n.sort().slice(-1)[0]+"`":"```";r.write(s+(t.attrs.params||"")+`
`),r.text(t.textContent,!1),r.write(`
`),r.write(s),r.closeBlock(t)},heading(r,t){r.write(r.repeat("#",t.attrs.level)+" "),r.renderInline(t,!1),r.closeBlock(t)},horizontal_rule(r,t){r.write(t.attrs.markup||"---"),r.closeBlock(t)},bullet_list(r,t){r.renderList(t,"  ",()=>(t.attrs.bullet||"*")+" ")},ordered_list(r,t){let n=t.attrs.order||1,s=String(n+t.childCount-1).length,o=r.repeat(" ",s+2);r.renderList(t,o,a=>{let c=String(n+a);return r.repeat(" ",s-c.length)+c+". "})},list_item(r,t){r.renderContent(t)},paragraph(r,t){r.renderInline(t),r.closeBlock(t)},image(r,t){r.write("!["+r.esc(t.attrs.alt||"")+"]("+t.attrs.src.replace(/[\(\)]/g,"\\$&")+(t.attrs.title?' "'+t.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(r,t,n,s){for(let o=s+1;o<n.childCount;o++)if(n.child(o).type!=t.type){r.write(`\\
`);return}},text(r,t){r.text(t.text,!r.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(r,t,n,s){return r.inAutolink=isPlainURL(t,n,s),r.inAutolink?"<":"["},close(r,t,n,s){let{inAutolink:o}=r;return r.inAutolink=void 0,o?">":"]("+t.attrs.href.replace(/[\(\)"]/g,"\\$&")+(t.attrs.title?` "${t.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(r,t,n,s){return backticksFor(n.child(s),-1)},close(r,t,n,s){return backticksFor(n.child(s-1),1)},escape:!1}});function backticksFor(r,t){let n=/`+/g,s,o=0;if(r.isText)for(;s=n.exec(r.text);)o=Math.max(o,s[0].length);let a=o>0&&t>0?" `":"`";for(let c=0;c<o;c++)a+="`";return o>0&&t<0&&(a+=" "),a}function isPlainURL(r,t,n){if(r.attrs.title||!/^\w+:/.test(r.attrs.href))return!1;let s=t.child(n);return!s.isText||s.text!=r.attrs.href||s.marks[s.marks.length-1]!=r?!1:n==t.childCount-1||!r.isInSet(t.child(n+1).marks)}class MarkdownSerializerState{constructor(t,n,s){this.nodes=t,this.marks=n,this.options=s,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(t=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),t>1){let n=this.delim,s=/\s+$/.exec(n);s&&(n=n.slice(0,n.length-s[0].length));for(let o=1;o<t;o++)this.out+=n+`
`}this.closed=null}}getMark(t){let n=this.marks[t];if(!n){if(this.options.strict!==!1)throw new Error(`Mark type \`${t}\` not supported by Markdown renderer`);n=blankMark}return n}wrapBlock(t,n,s,o){let a=this.delim;this.write(n??t),this.delim+=t,o(),this.delim=a,this.closeBlock(s)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(t){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),t&&(this.out+=t)}closeBlock(t){this.closed=t}text(t,n=!0){let s=t.split(`
`);for(let o=0;o<s.length;o++)this.write(),!n&&s[o][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=n?this.esc(s[o],this.atBlockStart):s[o],o!=s.length-1&&(this.out+=`
`)}render(t,n,s){if(this.nodes[t.type.name])this.nodes[t.type.name](this,t,n,s);else{if(this.options.strict!==!1)throw new Error("Token type `"+t.type.name+"` not supported by Markdown renderer");t.type.isLeaf||(t.type.inlineContent?this.renderInline(t):this.renderContent(t),t.isBlock&&this.closeBlock(t))}}renderContent(t){t.forEach((n,s,o)=>this.render(n,t,o))}renderInline(t,n=!0){this.atBlockStart=n;let s=[],o="",a=(c,f,g)=>{let b=c?c.marks:[];c&&c.type.name===this.options.hardBreakNodeName&&(b=b.filter(ne=>{if(g+1==t.childCount)return!1;let Ce=t.child(g+1);return ne.isInSet(Ce.marks)&&(!Ce.isText||/\S/.test(Ce.text))}));let _=o;if(o="",c&&c.isText&&b.some(ne=>{let Ce=this.getMark(ne.type.name);return Ce&&Ce.expelEnclosingWhitespace&&!ne.isInSet(s)})){let[ne,Ce,Le]=/^(\s*)(.*)$/m.exec(c.text);Ce&&(_+=Ce,c=Le?c.withText(Le):null,c||(b=s))}if(c&&c.isText&&b.some(ne=>{let Ce=this.getMark(ne.type.name);return Ce&&Ce.expelEnclosingWhitespace&&(g==t.childCount-1||!ne.isInSet(t.child(g+1).marks))})){let[ne,Ce,Le]=/^(.*?)(\s*)$/m.exec(c.text);Le&&(o=Le,c=Ce?c.withText(Ce):null,c||(b=s))}let L=b.length?b[b.length-1]:null,q=L&&this.getMark(L.type.name).escape===!1,X=b.length-(q?1:0);e:for(let ne=0;ne<X;ne++){let Ce=b[ne];if(!this.getMark(Ce.type.name).mixable)break;for(let Le=0;Le<s.length;Le++){let Ge=s[Le];if(!this.getMark(Ge.type.name).mixable)break;if(Ce.eq(Ge)){ne>Le?b=b.slice(0,Le).concat(Ce).concat(b.slice(Le,ne)).concat(b.slice(ne+1,X)):Le>ne&&(b=b.slice(0,ne).concat(b.slice(ne+1,Le)).concat(Ce).concat(b.slice(Le,X)));continue e}}}let te=0;for(;te<Math.min(s.length,X)&&b[te].eq(s[te]);)++te;for(;te<s.length;)this.text(this.markString(s.pop(),!1,t,g),!1);if(_&&this.text(_),c){for(;s.length<X;){let ne=b[s.length];s.push(ne),this.text(this.markString(ne,!0,t,g),!1),this.atBlockStart=!1}q&&c.isText?this.text(this.markString(L,!0,t,g)+c.text+this.markString(L,!1,t,g+1),!1):this.render(c,t,g),this.atBlockStart=!1}c?.isText&&c.nodeSize>0&&(this.atBlockStart=!1)};t.forEach(a),a(null,0,t.childCount),this.atBlockStart=!1}renderList(t,n,s){this.closed&&this.closed.type==t.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let o=typeof t.attrs.tight<"u"?t.attrs.tight:this.options.tightLists,a=this.inTightList;this.inTightList=o,t.forEach((c,f,g)=>{g&&o&&this.flushClose(1),this.wrapBlock(n,s(g),t,()=>this.render(c,t,g))}),this.inTightList=a}esc(t,n=!1){return t=t.replace(/[`*\\~\[\]_]/g,(s,o)=>s=="_"&&o>0&&o+1<t.length&&t[o-1].match(/\w/)&&t[o+1].match(/\w/)?s:"\\"+s),n&&(t=t.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(t=t.replace(this.options.escapeExtraCharacters,"\\$&")),t}quote(t){let n=t.indexOf('"')==-1?'""':t.indexOf("'")==-1?"''":"()";return n[0]+t+n[1]}repeat(t,n){let s="";for(let o=0;o<n;o++)s+=t;return s}markString(t,n,s,o){let a=this.getMark(t.type.name),c=n?a.open:a.close;return typeof c=="string"?c:c(this,t,s,o)}getEnclosingWhitespace(t){return{leading:(t.match(/^(\s+)/)||[void 0])[0],trailing:(t.match(/(\s+)$/)||[void 0])[0]}}}const encodedTlds="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",encodedUtlds="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",numeric="numeric",ascii="ascii",alpha="alpha",asciinumeric="asciinumeric",alphanumeric="alphanumeric",domain="domain",emoji="emoji",scheme="scheme",slashscheme="slashscheme",whitespace="whitespace";function registerGroup(r,t){return r in t||(t[r]=[]),t[r]}function addToGroups(r,t,n){t[numeric]&&(t[asciinumeric]=!0,t[alphanumeric]=!0),t[ascii]&&(t[asciinumeric]=!0,t[alpha]=!0),t[asciinumeric]&&(t[alphanumeric]=!0),t[alpha]&&(t[alphanumeric]=!0),t[alphanumeric]&&(t[domain]=!0),t[emoji]&&(t[domain]=!0);for(const s in t){const o=registerGroup(s,n);o.indexOf(r)<0&&o.push(r)}}function flagsForToken(r,t){const n={};for(const s in t)t[s].indexOf(r)>=0&&(n[s]=!0);return n}function State(r=null){this.j={},this.jr=[],this.jd=null,this.t=r}State.groups={};State.prototype={accepts(){return!!this.t},go(r){const t=this,n=t.j[r];if(n)return n;for(let s=0;s<t.jr.length;s++){const o=t.jr[s][0],a=t.jr[s][1];if(a&&o.test(r))return a}return t.jd},has(r,t=!1){return t?r in this.j:!!this.go(r)},ta(r,t,n,s){for(let o=0;o<r.length;o++)this.tt(r[o],t,n,s)},tr(r,t,n,s){s=s||State.groups;let o;return t&&t.j?o=t:(o=new State(t),n&&s&&addToGroups(t,n,s)),this.jr.push([r,o]),o},ts(r,t,n,s){let o=this;const a=r.length;if(!a)return o;for(let c=0;c<a-1;c++)o=o.tt(r[c]);return o.tt(r[a-1],t,n,s)},tt(r,t,n,s){s=s||State.groups;const o=this;if(t&&t.j)return o.j[r]=t,t;const a=t;let c,f=o.go(r);if(f?(c=new State,Object.assign(c.j,f.j),c.jr.push.apply(c.jr,f.jr),c.jd=f.jd,c.t=f.t):c=new State,a){if(s)if(c.t&&typeof c.t=="string"){const g=Object.assign(flagsForToken(c.t,s),n);addToGroups(a,g,s)}else n&&addToGroups(a,n,s);c.t=a}return o.j[r]=c,c}};const ta=(r,t,n,s,o)=>r.ta(t,n,s,o),tr=(r,t,n,s,o)=>r.tr(t,n,s,o),ts=(r,t,n,s,o)=>r.ts(t,n,s,o),tt=(r,t,n,s,o)=>r.tt(t,n,s,o),WORD="WORD",UWORD="UWORD",ASCIINUMERICAL="ASCIINUMERICAL",ALPHANUMERICAL="ALPHANUMERICAL",LOCALHOST="LOCALHOST",TLD="TLD",UTLD="UTLD",SCHEME="SCHEME",SLASH_SCHEME="SLASH_SCHEME",NUM="NUM",WS="WS",NL="NL",OPENBRACE="OPENBRACE",CLOSEBRACE="CLOSEBRACE",OPENBRACKET="OPENBRACKET",CLOSEBRACKET="CLOSEBRACKET",OPENPAREN="OPENPAREN",CLOSEPAREN="CLOSEPAREN",OPENANGLEBRACKET="OPENANGLEBRACKET",CLOSEANGLEBRACKET="CLOSEANGLEBRACKET",FULLWIDTHLEFTPAREN="FULLWIDTHLEFTPAREN",FULLWIDTHRIGHTPAREN="FULLWIDTHRIGHTPAREN",LEFTCORNERBRACKET="LEFTCORNERBRACKET",RIGHTCORNERBRACKET="RIGHTCORNERBRACKET",LEFTWHITECORNERBRACKET="LEFTWHITECORNERBRACKET",RIGHTWHITECORNERBRACKET="RIGHTWHITECORNERBRACKET",FULLWIDTHLESSTHAN="FULLWIDTHLESSTHAN",FULLWIDTHGREATERTHAN="FULLWIDTHGREATERTHAN",AMPERSAND="AMPERSAND",APOSTROPHE="APOSTROPHE",ASTERISK="ASTERISK",AT="AT",BACKSLASH="BACKSLASH",BACKTICK="BACKTICK",CARET="CARET",COLON="COLON",COMMA="COMMA",DOLLAR="DOLLAR",DOT="DOT",EQUALS="EQUALS",EXCLAMATION="EXCLAMATION",HYPHEN="HYPHEN",PERCENT="PERCENT",PIPE="PIPE",PLUS="PLUS",POUND="POUND",QUERY="QUERY",QUOTE="QUOTE",FULLWIDTHMIDDLEDOT="FULLWIDTHMIDDLEDOT",SEMI="SEMI",SLASH="SLASH",TILDE="TILDE",UNDERSCORE="UNDERSCORE",EMOJI$1="EMOJI",SYM="SYM";var tk=Object.freeze({__proto__:null,ALPHANUMERICAL,AMPERSAND,APOSTROPHE,ASCIINUMERICAL,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,CLOSEANGLEBRACKET,CLOSEBRACE,CLOSEBRACKET,CLOSEPAREN,COLON,COMMA,DOLLAR,DOT,EMOJI:EMOJI$1,EQUALS,EXCLAMATION,FULLWIDTHGREATERTHAN,FULLWIDTHLEFTPAREN,FULLWIDTHLESSTHAN,FULLWIDTHMIDDLEDOT,FULLWIDTHRIGHTPAREN,HYPHEN,LEFTCORNERBRACKET,LEFTWHITECORNERBRACKET,LOCALHOST,NL,NUM,OPENANGLEBRACKET,OPENBRACE,OPENBRACKET,OPENPAREN,PERCENT,PIPE,PLUS,POUND,QUERY,QUOTE,RIGHTCORNERBRACKET,RIGHTWHITECORNERBRACKET,SCHEME,SEMI,SLASH,SLASH_SCHEME,SYM,TILDE,TLD,UNDERSCORE,UTLD,UWORD,WORD,WS});const ASCII_LETTER=/[a-z]/,LETTER=new RegExp("\\p{L}","u"),EMOJI=new RegExp("\\p{Emoji}","u"),DIGIT=/\d/,SPACE=/\s/,CR="\r",LF=`
`,EMOJI_VARIATION="",EMOJI_JOINER="",OBJECT_REPLACEMENT="";let tlds=null,utlds=null;function init$2(r=[]){const t={};State.groups=t;const n=new State;tlds==null&&(tlds=decodeTlds(encodedTlds)),utlds==null&&(utlds=decodeTlds(encodedUtlds)),tt(n,"'",APOSTROPHE),tt(n,"{",OPENBRACE),tt(n,"}",CLOSEBRACE),tt(n,"[",OPENBRACKET),tt(n,"]",CLOSEBRACKET),tt(n,"(",OPENPAREN),tt(n,")",CLOSEPAREN),tt(n,"<",OPENANGLEBRACKET),tt(n,">",CLOSEANGLEBRACKET),tt(n,"",FULLWIDTHLEFTPAREN),tt(n,"",FULLWIDTHRIGHTPAREN),tt(n,"",LEFTCORNERBRACKET),tt(n,"",RIGHTCORNERBRACKET),tt(n,"",LEFTWHITECORNERBRACKET),tt(n,"",RIGHTWHITECORNERBRACKET),tt(n,"",FULLWIDTHLESSTHAN),tt(n,"",FULLWIDTHGREATERTHAN),tt(n,"&",AMPERSAND),tt(n,"*",ASTERISK),tt(n,"@",AT),tt(n,"`",BACKTICK),tt(n,"^",CARET),tt(n,":",COLON),tt(n,",",COMMA),tt(n,"$",DOLLAR),tt(n,".",DOT),tt(n,"=",EQUALS),tt(n,"!",EXCLAMATION),tt(n,"-",HYPHEN),tt(n,"%",PERCENT),tt(n,"|",PIPE),tt(n,"+",PLUS),tt(n,"#",POUND),tt(n,"?",QUERY),tt(n,'"',QUOTE),tt(n,"/",SLASH),tt(n,";",SEMI),tt(n,"~",TILDE),tt(n,"_",UNDERSCORE),tt(n,"\\",BACKSLASH),tt(n,"",FULLWIDTHMIDDLEDOT);const s=tr(n,DIGIT,NUM,{[numeric]:!0});tr(s,DIGIT,s);const o=tr(s,ASCII_LETTER,ASCIINUMERICAL,{[asciinumeric]:!0}),a=tr(s,LETTER,ALPHANUMERICAL,{[alphanumeric]:!0}),c=tr(n,ASCII_LETTER,WORD,{[ascii]:!0});tr(c,DIGIT,o),tr(c,ASCII_LETTER,c),tr(o,DIGIT,o),tr(o,ASCII_LETTER,o);const f=tr(n,LETTER,UWORD,{[alpha]:!0});tr(f,ASCII_LETTER),tr(f,DIGIT,a),tr(f,LETTER,f),tr(a,DIGIT,a),tr(a,ASCII_LETTER),tr(a,LETTER,a);const g=tt(n,LF,NL,{[whitespace]:!0}),b=tt(n,CR,WS,{[whitespace]:!0}),_=tr(n,SPACE,WS,{[whitespace]:!0});tt(n,OBJECT_REPLACEMENT,_),tt(b,LF,g),tt(b,OBJECT_REPLACEMENT,_),tr(b,SPACE,_),tt(_,CR),tt(_,LF),tr(_,SPACE,_),tt(_,OBJECT_REPLACEMENT,_);const L=tr(n,EMOJI,EMOJI$1,{[emoji]:!0});tt(L,"#"),tr(L,EMOJI,L),tt(L,EMOJI_VARIATION,L);const q=tt(L,EMOJI_JOINER);tt(q,"#"),tr(q,EMOJI,L);const X=[[ASCII_LETTER,c],[DIGIT,o]],te=[[ASCII_LETTER,null],[LETTER,f],[DIGIT,a]];for(let ne=0;ne<tlds.length;ne++)fastts(n,tlds[ne],TLD,WORD,X);for(let ne=0;ne<utlds.length;ne++)fastts(n,utlds[ne],UTLD,UWORD,te);addToGroups(TLD,{tld:!0,ascii:!0},t),addToGroups(UTLD,{utld:!0,alpha:!0},t),fastts(n,"file",SCHEME,WORD,X),fastts(n,"mailto",SCHEME,WORD,X),fastts(n,"http",SLASH_SCHEME,WORD,X),fastts(n,"https",SLASH_SCHEME,WORD,X),fastts(n,"ftp",SLASH_SCHEME,WORD,X),fastts(n,"ftps",SLASH_SCHEME,WORD,X),addToGroups(SCHEME,{scheme:!0,ascii:!0},t),addToGroups(SLASH_SCHEME,{slashscheme:!0,ascii:!0},t),r=r.sort((ne,Ce)=>ne[0]>Ce[0]?1:-1);for(let ne=0;ne<r.length;ne++){const Ce=r[ne][0],Ge=r[ne][1]?{[scheme]:!0}:{[slashscheme]:!0};Ce.indexOf("-")>=0?Ge[domain]=!0:ASCII_LETTER.test(Ce)?DIGIT.test(Ce)?Ge[asciinumeric]=!0:Ge[ascii]=!0:Ge[numeric]=!0,ts(n,Ce,Ce,Ge)}return ts(n,"localhost",LOCALHOST,{ascii:!0}),n.jd=new State(SYM),{start:n,tokens:Object.assign({groups:t},tk)}}function run$1(r,t){const n=stringToArray(t.replace(/[A-Z]/g,f=>f.toLowerCase())),s=n.length,o=[];let a=0,c=0;for(;c<s;){let f=r,g=null,b=0,_=null,L=-1,q=-1;for(;c<s&&(g=f.go(n[c]));)f=g,f.accepts()?(L=0,q=0,_=f):L>=0&&(L+=n[c].length,q++),b+=n[c].length,a+=n[c].length,c++;a-=L,c-=q,b-=L,o.push({t:_.t,v:t.slice(a-b,a),s:a-b,e:a})}return o}function stringToArray(r){const t=[],n=r.length;let s=0;for(;s<n;){let o=r.charCodeAt(s),a,c=o<55296||o>56319||s+1===n||(a=r.charCodeAt(s+1))<56320||a>57343?r[s]:r.slice(s,s+2);t.push(c),s+=c.length}return t}function fastts(r,t,n,s,o){let a;const c=t.length;for(let f=0;f<c-1;f++){const g=t[f];r.j[g]?a=r.j[g]:(a=new State(s),a.jr=o.slice(),r.j[g]=a),r=a}return a=new State(n),a.jr=o.slice(),r.j[t[c-1]]=a,a}function decodeTlds(r){const t=[],n=[];let s=0,o="0123456789";for(;s<r.length;){let a=0;for(;o.indexOf(r[s+a])>=0;)a++;if(a>0){t.push(n.join(""));for(let c=parseInt(r.substring(s,s+a),10);c>0;c--)n.pop();s+=a}else n.push(r[s]),s++}return t}const defaults={defaultProtocol:"http",events:null,format:noop,formatHref:noop,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Options(r,t=null){let n=Object.assign({},defaults);r&&(n=Object.assign(n,r instanceof Options?r.o:r));const s=n.ignoreTags,o=[];for(let a=0;a<s.length;a++)o.push(s[a].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=o}Options.prototype={o:defaults,ignoreTags:[],defaultRender(r){return r},check(r){return this.get("validate",r.toString(),r)},get(r,t,n){const s=t!=null;let o=this.o[r];return o&&(typeof o=="object"?(o=n.t in o?o[n.t]:defaults[r],typeof o=="function"&&s&&(o=o(t,n))):typeof o=="function"&&s&&(o=o(t,n.t,n)),o)},getObj(r,t,n){let s=this.o[r];return typeof s=="function"&&t!=null&&(s=s(t,n.t,n)),s},render(r){const t=r.render(this);return(this.get("render",null,r)||this.defaultRender)(t,r.t,r)}};function noop(r){return r}function MultiToken(r,t){this.t="token",this.v=r,this.tk=t}MultiToken.prototype={isLink:!1,toString(){return this.v},toHref(r){return this.toString()},toFormattedString(r){const t=this.toString(),n=r.get("truncate",t,this),s=r.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(r){return r.get("formatHref",this.toHref(r.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(r=defaults.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(r),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(r){return{type:this.t,value:this.toFormattedString(r),isLink:this.isLink,href:this.toFormattedHref(r),start:this.startIndex(),end:this.endIndex()}},validate(r){return r.get("validate",this.toString(),this)},render(r){const t=this,n=this.toHref(r.get("defaultProtocol")),s=r.get("formatHref",n,this),o=r.get("tagName",n,t),a=this.toFormattedString(r),c={},f=r.get("className",n,t),g=r.get("target",n,t),b=r.get("rel",n,t),_=r.getObj("attributes",n,t),L=r.getObj("events",n,t);return c.href=s,f&&(c.class=f),g&&(c.target=g),b&&(c.rel=b),_&&Object.assign(c,_),{tagName:o,attributes:c,content:a,eventListeners:L}}};function createTokenClass(r,t){class n extends MultiToken{constructor(o,a){super(o,a),this.t=r}}for(const s in t)n.prototype[s]=t[s];return n.t=r,n}const Email=createTokenClass("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Text=createTokenClass("text"),Nl=createTokenClass("nl"),Url=createTokenClass("url",{isLink:!0,toHref(r=defaults.defaultProtocol){return this.hasProtocol()?this.v:`${r}://${this.v}`},hasProtocol(){const r=this.tk;return r.length>=2&&r[0].t!==LOCALHOST&&r[1].t===COLON}}),makeState=r=>new State(r);function init$1({groups:r}){const t=r.domain.concat([AMPERSAND,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,NUM,PERCENT,PIPE,PLUS,POUND,SLASH,SYM,TILDE,UNDERSCORE]),n=[APOSTROPHE,COLON,COMMA,DOT,EXCLAMATION,PERCENT,QUERY,QUOTE,SEMI,OPENANGLEBRACKET,CLOSEANGLEBRACKET,OPENBRACE,CLOSEBRACE,CLOSEBRACKET,OPENBRACKET,OPENPAREN,CLOSEPAREN,FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN,LEFTCORNERBRACKET,RIGHTCORNERBRACKET,LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET,FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN],s=[AMPERSAND,APOSTROPHE,ASTERISK,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,OPENBRACE,CLOSEBRACE,PERCENT,PIPE,PLUS,POUND,QUERY,SLASH,SYM,TILDE,UNDERSCORE],o=makeState(),a=tt(o,TILDE);ta(a,s,a),ta(a,r.domain,a);const c=makeState(),f=makeState(),g=makeState();ta(o,r.domain,c),ta(o,r.scheme,f),ta(o,r.slashscheme,g),ta(c,s,a),ta(c,r.domain,c);const b=tt(c,AT);tt(a,AT,b),tt(f,AT,b),tt(g,AT,b);const _=tt(a,DOT);ta(_,s,a),ta(_,r.domain,a);const L=makeState();ta(b,r.domain,L),ta(L,r.domain,L);const q=tt(L,DOT);ta(q,r.domain,L);const X=makeState(Email);ta(q,r.tld,X),ta(q,r.utld,X),tt(b,LOCALHOST,X);const te=tt(L,HYPHEN);tt(te,HYPHEN,te),ta(te,r.domain,L),ta(X,r.domain,L),tt(X,DOT,q),tt(X,HYPHEN,te);const ne=tt(X,COLON);ta(ne,r.numeric,Email);const Ce=tt(c,HYPHEN),Le=tt(c,DOT);tt(Ce,HYPHEN,Ce),ta(Ce,r.domain,c),ta(Le,s,a),ta(Le,r.domain,c);const Ge=makeState(Url);ta(Le,r.tld,Ge),ta(Le,r.utld,Ge),ta(Ge,r.domain,c),ta(Ge,s,a),tt(Ge,DOT,Le),tt(Ge,HYPHEN,Ce),tt(Ge,AT,b);const ze=tt(Ge,COLON),Xe=makeState(Url);ta(ze,r.numeric,Xe);const He=makeState(Url),Ve=makeState();ta(He,t,He),ta(He,n,Ve),ta(Ve,t,He),ta(Ve,n,Ve),tt(Ge,SLASH,He),tt(Xe,SLASH,He);const We=tt(f,COLON),rt=tt(g,COLON),st=tt(rt,SLASH),ht=tt(st,SLASH);ta(f,r.domain,c),tt(f,DOT,Le),tt(f,HYPHEN,Ce),ta(g,r.domain,c),tt(g,DOT,Le),tt(g,HYPHEN,Ce),ta(We,r.domain,He),tt(We,SLASH,He),tt(We,QUERY,He),ta(ht,r.domain,He),ta(ht,t,He),tt(ht,SLASH,He);const je=[[OPENBRACE,CLOSEBRACE],[OPENBRACKET,CLOSEBRACKET],[OPENPAREN,CLOSEPAREN],[OPENANGLEBRACKET,CLOSEANGLEBRACKET],[FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN],[LEFTCORNERBRACKET,RIGHTCORNERBRACKET],[LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET],[FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN]];for(let se=0;se<je.length;se++){const[m,A]=je[se],k=tt(He,m);tt(Ve,m,k),tt(k,A,He);const Y=makeState(Url);ta(k,t,Y);const Q=makeState();ta(k,n),ta(Y,t,Y),ta(Y,n,Q),ta(Q,t,Y),ta(Q,n,Q),tt(Y,A,He),tt(Q,A,He)}return tt(o,LOCALHOST,Ge),tt(o,NL,Nl),{start:o,tokens:tk}}function run(r,t,n){let s=n.length,o=0,a=[],c=[];for(;o<s;){let f=r,g=null,b=null,_=0,L=null,q=-1;for(;o<s&&!(g=f.go(n[o].t));)c.push(n[o++]);for(;o<s&&(b=g||f.go(n[o].t));)g=null,f=b,f.accepts()?(q=0,L=f):q>=0&&q++,o++,_++;if(q<0)o-=_,o<s&&(c.push(n[o]),o++);else{c.length>0&&(a.push(initMultiToken(Text,t,c)),c=[]),o-=q,_-=q;const X=L.t,te=n.slice(o-_,o);a.push(initMultiToken(X,t,te))}}return c.length>0&&a.push(initMultiToken(Text,t,c)),a}function initMultiToken(r,t,n){const s=n[0].s,o=n[n.length-1].e,a=t.slice(s,o);return new r(a,n)}const warn=typeof console<"u"&&console&&console.warn||(()=>{}),warnAdvice="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",INIT={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function reset(){return State.groups={},INIT.scanner=null,INIT.parser=null,INIT.tokenQueue=[],INIT.pluginQueue=[],INIT.customSchemes=[],INIT.initialized=!1,INIT}function registerCustomProtocol(r,t=!1){if(INIT.initialized&&warn(`linkifyjs: already initialized - will not register custom scheme "${r}" ${warnAdvice}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(r))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);INIT.customSchemes.push([r,t])}function init(){INIT.scanner=init$2(INIT.customSchemes);for(let r=0;r<INIT.tokenQueue.length;r++)INIT.tokenQueue[r][1]({scanner:INIT.scanner});INIT.parser=init$1(INIT.scanner.tokens);for(let r=0;r<INIT.pluginQueue.length;r++)INIT.pluginQueue[r][1]({scanner:INIT.scanner,parser:INIT.parser});return INIT.initialized=!0,INIT}function tokenize(r){return INIT.initialized||init(),run(INIT.parser.start,r,run$1(INIT.scanner.start,r))}tokenize.scan=run$1;function find(r,t=null,n=null){if(t&&typeof t=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const s=new Options(n),o=tokenize(r),a=[];for(let c=0;c<o.length;c++){const f=o[c];f.isLink&&(!t||f.t===t)&&s.check(f)&&a.push(f.toFormattedObject(s))}return a}const UNICODE_WHITESPACE_PATTERN="[\0- -\u2029]",UNICODE_WHITESPACE_REGEX=new RegExp(UNICODE_WHITESPACE_PATTERN),UNICODE_WHITESPACE_REGEX_END=new RegExp(`${UNICODE_WHITESPACE_PATTERN}$`),UNICODE_WHITESPACE_REGEX_GLOBAL=new RegExp(UNICODE_WHITESPACE_PATTERN,"g");function isValidLinkStructure(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function autolink(r){return new Plugin({key:new PluginKey("autolink"),appendTransaction:(t,n,s)=>{const o=t.some(b=>b.docChanged)&&!n.doc.eq(s.doc),a=t.some(b=>b.getMeta("preventAutolink"));if(!o||a)return;const{tr:c}=s,f=combineTransactionSteps(n.doc,[...t]);if(getChangedRanges(f).forEach(({newRange:b})=>{const _=findChildrenInRange(s.doc,b,X=>X.isTextblock);let L,q;if(_.length>1)L=_[0],q=s.doc.textBetween(L.pos,L.pos+L.node.nodeSize,void 0," ");else if(_.length){const X=s.doc.textBetween(b.from,b.to," "," ");if(!UNICODE_WHITESPACE_REGEX_END.test(X))return;L=_[0],q=s.doc.textBetween(L.pos,b.to,void 0," ")}if(L&&q){const X=q.split(UNICODE_WHITESPACE_REGEX).filter(Boolean);if(X.length<=0)return!1;const te=X[X.length-1],ne=L.pos+q.lastIndexOf(te);if(!te)return!1;const Ce=tokenize(te).map(Le=>Le.toObject(r.defaultProtocol));if(!isValidLinkStructure(Ce))return!1;Ce.filter(Le=>Le.isLink).map(Le=>({...Le,from:ne+Le.start+1,to:ne+Le.end+1})).filter(Le=>s.schema.marks.code?!s.doc.rangeHasMark(Le.from,Le.to,s.schema.marks.code):!0).filter(Le=>r.validate(Le.value)).filter(Le=>r.shouldAutoLink(Le.value)).forEach(Le=>{getMarksBetween(Le.from,Le.to,s.doc).some(Ge=>Ge.mark.type===r.type)||c.addMark(Le.from,Le.to,r.type.create({href:Le.href}))})}}),!!c.steps.length)return c}})}function clickHandler(r){return new Plugin({key:new PluginKey("handleClickLink"),props:{handleClick:(t,n,s)=>{var o,a;if(s.button!==0||!t.editable)return!1;let c=s.target;const f=[];for(;c.nodeName!=="DIV";)f.push(c),c=c.parentNode;if(!f.find(q=>q.nodeName==="A"))return!1;const g=getAttributes(t.state,r.type.name),b=s.target,_=(o=b?.href)!==null&&o!==void 0?o:g.href,L=(a=b?.target)!==null&&a!==void 0?a:g.target;return b&&_?(window.open(_,L),!0):!1}}})}function pasteHandler(r){return new Plugin({key:new PluginKey("handlePasteLink"),props:{handlePaste:(t,n,s)=>{const{state:o}=t,{selection:a}=o,{empty:c}=a;if(c)return!1;let f="";s.content.forEach(b=>{f+=b.textContent});const g=find(f,{defaultProtocol:r.defaultProtocol}).find(b=>b.isLink&&b.value===f);return!f||!g?!1:r.editor.commands.setMark(r.type,{href:g.href})}}})}function isAllowedUri(r,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(s=>{const o=typeof s=="string"?s:s.scheme;o&&n.push(o)}),!r||r.replace(UNICODE_WHITESPACE_REGEX_GLOBAL,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Link=Mark.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){registerCustomProtocol(r);return}registerCustomProtocol(r.scheme,r.optionalSlashes)})},onDestroy(){reset()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,t)=>!!isAllowedUri(r,t.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const t=r.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:n=>!!isAllowedUri(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:t=>!!isAllowedUri(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",mergeAttributes(this.options.HTMLAttributes,r),0]:["a",mergeAttributes(this.options.HTMLAttributes,{...r,href:""}),0]},addCommands(){return{setLink:r=>({chain:t})=>{const{href:n}=r;return this.options.isAllowedUri(n,{defaultValidate:s=>!!isAllowedUri(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:t})=>{const{href:n}=r;return this.options.isAllowedUri(n,{defaultValidate:s=>!!isAllowedUri(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[markPasteRule({find:r=>{const t=[];if(r){const{protocols:n,defaultProtocol:s}=this.options,o=find(r).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:c=>!!isAllowedUri(c,n),protocols:n,defaultProtocol:s}));o.length&&o.forEach(a=>t.push({text:a.value,data:{href:a.href},index:a.start}))}return t},type:this.type,getAttributes:r=>{var t;return{href:(t=r.data)===null||t===void 0?void 0:t.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:t,defaultProtocol:n}=this.options;return this.options.autolink&&r.push(autolink({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:o=>!!isAllowedUri(o,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&r.push(clickHandler({type:this.type})),this.options.linkOnPaste&&r.push(pasteHandler({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),r}});var lib$2={};(function(r){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.bytes=r.stringToBytes=r.str=r.bytesToString=r.hex=r.utf8=r.bech32m=r.bech32=r.base58check=r.base58xmr=r.base58xrp=r.base58flickr=r.base58=r.base64url=r.base64=r.base32crockford=r.base32hex=r.base32=r.base16=r.utils=r.assertNumber=void 0;function t(je){if(!Number.isSafeInteger(je))throw new Error(`Wrong integer: ${je}`)}r.assertNumber=t;function n(...je){const se=(k,Y)=>Q=>k(Y(Q)),m=Array.from(je).reverse().reduce((k,Y)=>k?se(k,Y.encode):Y.encode,void 0),A=je.reduce((k,Y)=>k?se(k,Y.decode):Y.decode,void 0);return{encode:m,decode:A}}function s(je){return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return se.map(m=>{if(t(m),m<0||m>=je.length)throw new Error(`Digit index outside alphabet: ${m} (alphabet: ${je.length})`);return je[m]})},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("alphabet.decode input should be array of strings");return se.map(m=>{if(typeof m!="string")throw new Error(`alphabet.decode: not string element=${m}`);const A=je.indexOf(m);if(A===-1)throw new Error(`Unknown letter: "${m}". Allowed: ${je}`);return A})}}}function o(je=""){if(typeof je!="string")throw new Error("join separator should be string");return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("join.encode input should be array of strings");for(let m of se)if(typeof m!="string")throw new Error(`join.encode: non-string input=${m}`);return se.join(je)},decode:se=>{if(typeof se!="string")throw new Error("join.decode input should be string");return se.split(je)}}}function a(je,se="="){if(t(je),typeof se!="string")throw new Error("padding chr should be string");return{encode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let A of m)if(typeof A!="string")throw new Error(`padding.encode: non-string input=${A}`);for(;m.length*je%8;)m.push(se);return m},decode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let k of m)if(typeof k!="string")throw new Error(`padding.decode: non-string input=${k}`);let A=m.length;if(A*je%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;A>0&&m[A-1]===se;A--)if(!((A-1)*je%8))throw new Error("Invalid padding: string has too much padding");return m.slice(0,A)}}}function c(je){if(typeof je!="function")throw new Error("normalize fn should be function");return{encode:se=>se,decode:se=>je(se)}}function f(je,se,m){if(se<2)throw new Error(`convertRadix: wrong from=${se}, base cannot be less than 2`);if(m<2)throw new Error(`convertRadix: wrong to=${m}, base cannot be less than 2`);if(!Array.isArray(je))throw new Error("convertRadix: data should be array");if(!je.length)return[];let A=0;const k=[],Y=Array.from(je);for(Y.forEach(Q=>{if(t(Q),Q<0||Q>=se)throw new Error(`Wrong integer: ${Q}`)});;){let Q=0,$e=!0;for(let ve=A;ve<Y.length;ve++){const re=Y[ve],B=se*Q+re;if(!Number.isSafeInteger(B)||se*Q/se!==Q||B-re!==se*Q)throw new Error("convertRadix: carry overflow");if(Q=B%m,Y[ve]=Math.floor(B/m),!Number.isSafeInteger(Y[ve])||Y[ve]*m+Q!==B)throw new Error("convertRadix: carry overflow");if($e)Y[ve]?$e=!1:A=ve;else continue}if(k.push(Q),$e)break}for(let Q=0;Q<je.length-1&&je[Q]===0;Q++)k.push(0);return k.reverse()}const g=(je,se)=>se?g(se,je%se):je,b=(je,se)=>je+(se-g(je,se));function _(je,se,m,A){if(!Array.isArray(je))throw new Error("convertRadix2: data should be array");if(se<=0||se>32)throw new Error(`convertRadix2: wrong from=${se}`);if(m<=0||m>32)throw new Error(`convertRadix2: wrong to=${m}`);if(b(se,m)>32)throw new Error(`convertRadix2: carry overflow from=${se} to=${m} carryBits=${b(se,m)}`);let k=0,Y=0;const Q=2**m-1,$e=[];for(const ve of je){if(t(ve),ve>=2**se)throw new Error(`convertRadix2: invalid data word=${ve} from=${se}`);if(k=k<<se|ve,Y+se>32)throw new Error(`convertRadix2: carry overflow pos=${Y} from=${se}`);for(Y+=se;Y>=m;Y-=m)$e.push((k>>Y-m&Q)>>>0);k&=2**Y-1}if(k=k<<m-Y&Q,!A&&Y>=se)throw new Error("Excess padding");if(!A&&k)throw new Error(`Non-zero padding: ${k}`);return A&&Y>0&&$e.push(k>>>0),$e}function L(je){return t(je),{encode:se=>{if(!(se instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return f(Array.from(se),2**8,je)},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(f(se,je,2**8))}}}function q(je,se=!1){if(t(je),je<=0||je>32)throw new Error("radix2: bits should be in (0..32]");if(b(8,je)>32||b(je,8)>32)throw new Error("radix2: carry overflow");return{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return _(Array.from(m),8,je,!se)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(_(m,je,8,se))}}}function X(je){if(typeof je!="function")throw new Error("unsafeWrapper fn should be function");return function(...se){try{return je.apply(null,se)}catch{}}}function te(je,se){if(t(je),typeof se!="function")throw new Error("checksum fn should be function");return{encode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const A=se(m).slice(0,je),k=new Uint8Array(m.length+je);return k.set(m),k.set(A,m.length),k},decode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const A=m.slice(0,-je),k=se(A).slice(0,je),Y=m.slice(-je);for(let Q=0;Q<je;Q++)if(k[Q]!==Y[Q])throw new Error("Invalid checksum");return A}}}r.utils={alphabet:s,chain:n,checksum:te,radix:L,radix2:q,join:o,padding:a},r.base16=n(q(4),s("0123456789ABCDEF"),o("")),r.base32=n(q(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),o("")),r.base32hex=n(q(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),o("")),r.base32crockford=n(q(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),c(je=>je.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),r.base64=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),o("")),r.base64url=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),o(""));const ne=je=>n(L(58),s(je),o(""));r.base58=ne("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),r.base58flickr=ne("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),r.base58xrp=ne("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ce=[0,2,3,5,6,7,9,10,11];r.base58xmr={encode(je){let se="";for(let m=0;m<je.length;m+=8){const A=je.subarray(m,m+8);se+=r.base58.encode(A).padStart(Ce[A.length],"1")}return se},decode(je){let se=[];for(let m=0;m<je.length;m+=11){const A=je.slice(m,m+11),k=Ce.indexOf(A.length),Y=r.base58.decode(A);for(let Q=0;Q<Y.length-k;Q++)if(Y[Q]!==0)throw new Error("base58xmr: wrong padding");se=se.concat(Array.from(Y.slice(Y.length-k)))}return Uint8Array.from(se)}};const Le=je=>n(te(4,se=>je(je(se))),r.base58);r.base58check=Le;const Ge=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),ze=[996825010,642813549,513874426,1027748829,705979059];function Xe(je){const se=je>>25;let m=(je&33554431)<<5;for(let A=0;A<ze.length;A++)(se>>A&1)===1&&(m^=ze[A]);return m}function He(je,se,m=1){const A=je.length;let k=1;for(let Y=0;Y<A;Y++){const Q=je.charCodeAt(Y);if(Q<33||Q>126)throw new Error(`Invalid prefix (${je})`);k=Xe(k)^Q>>5}k=Xe(k);for(let Y=0;Y<A;Y++)k=Xe(k)^je.charCodeAt(Y)&31;for(let Y of se)k=Xe(k)^Y;for(let Y=0;Y<6;Y++)k=Xe(k);return k^=m,Ge.encode(_([k%2**30],30,5,!1))}function Ve(je){const se=je==="bech32"?1:734539939,m=q(5),A=m.decode,k=m.encode,Y=X(A);function Q(B,oe,Ue=90){if(typeof B!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof B}`);if(!Array.isArray(oe)||oe.length&&typeof oe[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof oe}`);const Ze=B.length+7+oe.length;if(Ue!==!1&&Ze>Ue)throw new TypeError(`Length ${Ze} exceeds limit ${Ue}`);return B=B.toLowerCase(),`${B}1${Ge.encode(oe)}${He(B,oe,se)}`}function $e(B,oe=90){if(typeof B!="string")throw new Error(`bech32.decode input should be string, not ${typeof B}`);if(B.length<8||oe!==!1&&B.length>oe)throw new TypeError(`Wrong string length: ${B.length} (${B}). Expected (8..${oe})`);const Ue=B.toLowerCase();if(B!==Ue&&B!==B.toUpperCase())throw new Error("String must be lowercase or uppercase");B=Ue;const Ze=B.lastIndexOf("1");if(Ze===0||Ze===-1)throw new Error('Letter "1" must be present between prefix and data only');const lt=B.slice(0,Ze),St=B.slice(Ze+1);if(St.length<6)throw new Error("Data must be at least 6 characters long");const Mt=Ge.decode(St).slice(0,-6),Ft=He(lt,Mt,se);if(!St.endsWith(Ft))throw new Error(`Invalid checksum in ${B}: expected "${Ft}"`);return{prefix:lt,words:Mt}}const ve=X($e);function re(B){const{prefix:oe,words:Ue}=$e(B,!1);return{prefix:oe,words:Ue,bytes:A(Ue)}}return{encode:Q,decode:$e,decodeToBytes:re,decodeUnsafe:ve,fromWords:A,fromWordsUnsafe:Y,toWords:k}}r.bech32=Ve("bech32"),r.bech32m=Ve("bech32m"),r.utf8={encode:je=>new TextDecoder().decode(je),decode:je=>new TextEncoder().encode(je)},r.hex=n(q(4),s("0123456789abcdef"),o(""),c(je=>{if(typeof je!="string"||je.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof je} with length ${je.length}`);return je.toLowerCase()}));const We={utf8:r.utf8,hex:r.hex,base16:r.base16,base32:r.base32,base64:r.base64,base64url:r.base64url,base58:r.base58,base58xmr:r.base58xmr},rt=`Invalid encoding type. Available types: ${Object.keys(We).join(", ")}`,st=(je,se)=>{if(typeof je!="string"||!We.hasOwnProperty(je))throw new TypeError(rt);if(!(se instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return We[je].encode(se)};r.bytesToString=st,r.str=r.bytesToString;const ht=(je,se)=>{if(!We.hasOwnProperty(je))throw new TypeError(rt);if(typeof se!="string")throw new TypeError("stringToBytes() expects string");return We[je].decode(se)};r.stringToBytes=ht,r.bytes=r.stringToBytes})(lib$2);const{bech32,hex,utf8}=lib$2,DEFAULTNETWORK={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},TESTNETWORK={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIGNETNETWORK={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},REGTESTNETWORK={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIMNETWORK={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},FEATUREBIT_ORDER=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],DIVISORS={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},MAX_MILLISATS=BigInt("2100000000000000000"),MILLISATS_PER_BTC=BigInt(1e11),TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},TAGNAMES={};for(let r=0,t=Object.keys(TAGCODES);r<t.length;r++){const n=t[r],s=TAGCODES[t[r]].toString();TAGNAMES[s]=n}const TAGPARSERS={1:r=>hex.encode(bech32.fromWordsUnsafe(r)),16:r=>hex.encode(bech32.fromWordsUnsafe(r)),13:r=>utf8.encode(bech32.fromWordsUnsafe(r)),19:r=>hex.encode(bech32.fromWordsUnsafe(r)),23:r=>hex.encode(bech32.fromWordsUnsafe(r)),27:r=>hex.encode(bech32.fromWordsUnsafe(r)),6:wordsToIntBE,24:wordsToIntBE,3:routingInfoParser,5:featureBitsParser};function getUnknownParser(r){return t=>({tagCode:parseInt(r),words:bech32.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function wordsToIntBE(r){return r.reverse().reduce((t,n,s)=>t+n*Math.pow(32,s),0)}function routingInfoParser(r){const t=[];let n,s,o,a,c,f=bech32.fromWordsUnsafe(r);for(;f.length>0;)n=hex.encode(f.slice(0,33)),s=hex.encode(f.slice(33,41)),o=parseInt(hex.encode(f.slice(41,45)),16),a=parseInt(hex.encode(f.slice(45,49)),16),c=parseInt(hex.encode(f.slice(49,51)),16),f=f.slice(51),t.push({pubkey:n,short_channel_id:s,fee_base_msat:o,fee_proportional_millionths:a,cltv_expiry_delta:c});return t}function featureBitsParser(r){const t=r.slice().reverse().map(o=>[!!(o&1),!!(o&2),!!(o&4),!!(o&8),!!(o&16)]).reduce((o,a)=>o.concat(a),[]);for(;t.length<FEATUREBIT_ORDER.length*2;)t.push(!1);const n={};FEATUREBIT_ORDER.forEach((o,a)=>{let c;t[a*2]?c="required":t[a*2+1]?c="supported":c="unsupported",n[o]=c});const s=t.slice(FEATUREBIT_ORDER.length*2);return n.extra_bits={start_bit:FEATUREBIT_ORDER.length*2,bits:s,has_required:s.reduce((o,a,c)=>c%2!==0?o||!1:o||a,!1)},n}function hrpToMillisat(r,t){let n,s;if(r.slice(-1).match(/^[munp]$/))n=r.slice(-1),s=r.slice(0,-1);else{if(r.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");s=r}if(!s.match(/^\d+$/))throw new Error("Not a valid human readable amount");const o=BigInt(s),a=n?o*MILLISATS_PER_BTC/DIVISORS[n]:o*MILLISATS_PER_BTC;if(n==="p"&&o%BigInt(10)!==BigInt(0)||a>MAX_MILLISATS)throw new Error("Amount is outside of valid range");return t?a.toString():a}function decode$1(r,t){if(typeof r!="string")throw new Error("Lightning Payment Request must be string");if(r.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const n=[],s=bech32.decode(r,Number.MAX_SAFE_INTEGER);r=r.toLowerCase();const o=s.prefix;let a=s.words,c=r.slice(o.length+1),f=a.slice(-104);a=a.slice(0,-104);let g=o.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(g&&!g[2]&&(g=o.match(/^ln(\S+)$/)),!g)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const b=g[1];let _;if(t){if(t.bech32===void 0||t.pubKeyHash===void 0||t.scriptHash===void 0||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");_=t}else switch(b){case DEFAULTNETWORK.bech32:_=DEFAULTNETWORK;break;case TESTNETWORK.bech32:_=TESTNETWORK;break;case SIGNETNETWORK.bech32:_=SIGNETNETWORK;break;case REGTESTNETWORK.bech32:_=REGTESTNETWORK;break;case SIMNETWORK.bech32:_=SIMNETWORK;break}if(!_||_.bech32!==b)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:b,value:_});const L=g[2];let q;if(L){const Xe=g[3];q=hrpToMillisat(L+Xe,!0),n.push({name:"amount",letters:g[2]+g[3],value:q})}else q=null;n.push({name:"separator",letters:"1"});const X=wordsToIntBE(a.slice(0,7));a=a.slice(7),n.push({name:"timestamp",letters:c.slice(0,7),value:X}),c=c.slice(7);let te,ne,Ce,Le;for(;a.length>0;){const Xe=a[0].toString();te=TAGNAMES[Xe]||"unknown_tag",ne=TAGPARSERS[Xe]||getUnknownParser(Xe),a=a.slice(1),Ce=wordsToIntBE(a.slice(0,2)),a=a.slice(2),Le=a.slice(0,Ce),a=a.slice(Ce),n.push({name:te,tag:c[0],letters:c.slice(0,3+Ce),value:ne(Le)}),c=c.slice(3+Ce)}n.push({name:"signature",letters:c.slice(0,104),value:hex.encode(bech32.fromWordsUnsafe(f))}),c=c.slice(104),n.push({name:"checksum",letters:c});let Ge={paymentRequest:r,sections:n,get expiry(){let Xe=n.find(He=>He.name==="expiry");if(Xe)return ze("timestamp")+Xe.value},get route_hints(){return n.filter(Xe=>Xe.name==="route_hint").map(Xe=>Xe.value)}};for(let Xe in TAGCODES)Xe!=="route_hint"&&Object.defineProperty(Ge,Xe,{get(){return ze(Xe)}});return Ge;function ze(Xe){let He=n.find(Ve=>Ve.name===Xe);return He?He.value:void 0}}var bolt11$1={decode:decode$1,hrpToMillisat};const createPasteRuleMatch=(r,t)=>({index:r.index,replaceWith:r[2],text:r[0],match:r,data:t});function parseRelayAttribute(r){const t=r.getAttribute("relays")||[];return typeof t=="string"?t.split(","):t}const IMAGE_EXTENSIONS=/\.(jpg|jpeg|gif|png|bmp|svg|webp)$/,VIDEO_EXTENSIONS=/\.(webm|mp4|ogg|mov)$/,YOUTUBE_EMBED=/^(?:(?:https?:)?\/\/)?(?:(?:(?:www|m(?:usic)?)\.)?youtu(?:\.be|be\.com)\/(?:shorts\/|live\/|v\/|e(?:mbed)?\/|watch(?:\/|\?(?:\S+=\S+&)*v=)|oembed\?url=https?%3A\/\/(?:www|m(?:usic)?)\.youtube\.com\/watch\?(?:\S+=\S+&)*v%3D|attribution_link\?(?:\S+=\S+&)*u=(?:\/|%2F)watch(?:\?|%3F)v(?:=|%3D))?|www\.youtube-nocookie\.com\/embed\/)([\w-]{1})[?&#]?\S*$/,TWITTER_EMBED=/^https?:\/\/(twitter|x)\.com\/(?:#!\/)?(\w+)\/status(es)?\/(\d+)/;function getLinkKind(r,t){var n,s,o,a;const c=(a=(o=(s=(n=t?.[r])==null?void 0:n.m)==null?void 0:s.split)==null?void 0:o.call(s,"/"))==null?void 0:a[0];if(c==="image")return"image";if(c==="video")return"video";if(YOUTUBE_EMBED.test(r))return"youtube";if(TWITTER_EMBED.test(r))return"tweet";try{const{pathname:f}=new URL(r);return IMAGE_EXTENSIONS.test(f)?"image":VIDEO_EXTENSIONS.test(f)?"video":"text"}catch(f){return console.log("url parser error",f),"text"}}function replaceTextContent(r){return r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/(\n|\r)+/g,"<br />")}const LNBC_REGEX=new RegExp("(?<![\\w./:?=])(lnbc[0-9a-z]{10,})","g"),makeBolt11Attrs=r=>({bolt11:bolt11$1.decode(r),lnbc:r}),makeBolt11Node=r=>({type:"bolt11",attrs:makeBolt11Attrs(r)}),Bolt11Extension=Node.create({name:"bolt11",group:"block",atom:!0,selectable:!0,draggable:!0,addAttributes(){return{lnbc:{default:null},bolt11:{default:null,renderHTML(r){return{bolt11:JSON.stringify(r.bolt11||{})}},parseHTML(r){const t=r.getAttribute("bolt11");return typeof t=="string"?JSON.parse(t||"{}"):t}}}},addStorage(){return{markdown:{serialize(r,t){r.write(t.attrs.lnbc)},parse:{}}}},addCommands(){return{insertBolt11:({lnbc:r})=>({commands:t})=>t.insertContent(makeBolt11Node(r),{updateSelection:!1})}},renderHTML({HTMLAttributes:r}){return["div",mergeAttributes(r,{"data-type":this.name})]},renderText(r){return r.node.attrs.lnbc},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},addPasteRules(){return[nodePasteRule({type:this.type,getAttributes:r=>r.data,find:r=>{const t=[];for(const n of r.matchAll(LNBC_REGEX))t.push(createPasteRuleMatch(n,makeBolt11Attrs(n[0])));return t}})]}}),FileUploadExtension=Extension.create({name:"fileUpload",addOptions(){return{allowedMimeTypes:["image/jpeg","image/png","image/gif","video/mp4","video/mpeg","video/webm"],immediateUpload:!1,async upload(){return{error:"No uploader specified"}},onDrop(){},onStart(){},onUpload(){},onUploadError(){},onComplete(){}}},addCommands(){return{addFile:(r,t)=>n=>(n.tr.setMeta("addFile",[r,t]),!0),selectFiles:()=>r=>(r.tr.setMeta("selectFiles",!0),!0),uploadFiles:()=>r=>(r.tr.setMeta("uploadFiles",!0),!0),removePendingUploads:()=>r=>(r.state.doc.descendants((t,n)=>{["image","video"].includes(t.type.name)&&t.attrs.uploading&&r.state.tr.delete(n,n+t.nodeSize)}),!0),removeFailedUploads:()=>r=>(r.state.doc.descendants((t,n)=>{["image","video"].includes(t.type.name)&&t.attrs.error&&r.state.tr.delete(n,n+t.nodeSize)}),!0)}},addStorage(){return{uploader:null,getFiles:()=>[]}},onBeforeCreate(){const r=new Uploader(this.editor,this.options);this.storage.uploader=r,this.storage.getFiles=()=>r.getFiles()},addProseMirrorPlugins(){const r=this.storage.uploader;return[new Plugin({key:new PluginKey("fileUploadPlugin"),state:{init:()=>{},apply:t=>(setTimeout(async()=>{if(t.getMeta("addFile")){const[n,s]=t.getMeta("addFile");r.addFile(n,s),t.setMeta("addFile",null),this.options.immediateUpload&&r.start()}else t.getMeta("selectFiles")?(await r.selectFiles(),t.setMeta("selectFiles",null),this.options.immediateUpload&&r.start()):t.getMeta("uploadFiles")&&(r.start(),t.setMeta("uploadFiles",null))}),t)},props:{handleDrop:(t,n)=>{r.handleDrop(n),this.options.immediateUpload&&r.start()},handlePaste:(t,n)=>{r.handlePaste(n),this.options.immediateUpload&&r.start()}}})]}});class Uploader{constructor(t,n){this.editor=t,this.options=n}get view(){return this.editor.view}addFile(t,n){if(!this.options.allowedMimeTypes.includes(t.type))return!1;const{tr:s}=this.view.state,[o]=t.type.split("/"),a=this.view.state.schema.nodes[o].create({file:t,src:URL.createObjectURL(t),alt:""});return s.insert(n,a),this.view.dispatch(s),this.options.onDrop(this.editor,t,n),!0}getFiles(){return this.findNodes().map(([t])=>t.attrs)}findNodes(t){const n=[];return this.view.state.doc.descendants((s,o)=>{(s.type.name==="image"||s.type.name==="video")&&(t!==void 0&&!s.attrs.src.startsWith("blob:")!==t||n.push([s,o]))}),n}updateNodeAttributes(t,n){const{tr:s}=this.view.state;Object.entries(n).forEach(([o,a])=>a!==void 0&&s.setNodeAttribute(t,o,a)),this.view.dispatch(s)}onUploadDone(t,n){this.findNodes(!1).forEach(([s,o])=>{s.attrs.src===t.attrs.src&&(n.result?this.updateNodeAttributes(o,{src:encodeURI(n.result.url),sha256:n.result.sha256,tags:n.result.tags,uploading:!1}):this.updateNodeAttributes(o,{error:n.error,uploading:!1}))})}async upload(t,n){this.updateNodeAttributes(n,{uploading:!0,error:null});const s=await this.options.upload(t.attrs);if(!s.error&&!s.result)throw new Error("upload did not return either a result or an error");return this.onUploadDone(t,s),s}async start(){this.options.onStart(this.editor);const t=this.findNodes(!1).map(([s,o])=>this.upload(s,o)),n=[];for await(const s of t)"error"in s?(n.push(s.error),this.options.onUploadError(this.editor,s)):this.options.onUpload(this.editor,s);if(n.length===0){const s=this.getFiles();return this.options.onComplete(this.editor,s),s}throw new Error(n.join(","))}selectFiles(){return new Promise(t=>{const n=document.createElement("input");n.type="file",n.multiple=!0,n.accept=this.options.allowedMimeTypes.join(","),n.onchange=s=>{const o=s.target.files;o&&Array.from(o).forEach(a=>{if(a){const c=this.view.state.selection.from+1;this.addFile(a,c)}}),t(o)},n.click()})}handleDrop(t){var n;t.preventDefault();const s=(n=this.view.posAtCoords({left:t.clientX,top:t.clientY}))==null?void 0:n.pos;if(s&&t.dataTransfer)for(const o of t.dataTransfer.files)this.addFile(o,s)}handlePaste(t){const n=t.clipboardData;if(n){const s=n.items;let o=!1;for(let a=0;a<s.length;a++){const c=s[a];if(c.kind==="file"&&this.options.allowedMimeTypes.includes(c.type)){const f=c.getAsFile();f&&(this.addFile(f,this.view.state.selection.from+1),o=!0)}}return o}}}const ImageExtension=Image.extend({draggable:!0,addOptions(){return{inline:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.image,parse:{}}}},addAttributes(){return{src:{default:null},alt:{default:null},file:{default:null},tags:{default:null},sha256:{default:null},uploading:{default:!1},error:{default:null}}},parseHTML(){return[{tag:"img[src]"}]},renderText(r){return r.node.attrs.src},renderHTML({HTMLAttributes:r}){return["img",r]}});registerCustomProtocol("wss");const LinkExtension=Link.configure({autolink:!1}).extend({addPasteRules(){return[{find:r=>{const t=[];for(const{start:n,value:s,href:o}of find(r.replace(/\ufffc/g," ")))t.push({index:n,text:s,data:{href:o}});return t},handler:r=>{var t;const{range:n,state:s,match:o}=r,{from:a,to:c}=n,{nodes:f,marks:g}=s.schema,b=this.editor.storage.nostr.imeta,_=(t=o.data)==null?void 0:t.href,L=getLinkKind(_,b);if(L!=="text"&&f[L]){s.tr.replaceWith(a,c,f[L].create({src:_}));return}s.tr.addMark(a,c,g.link.create({href:_}))}}]}}),getNip19Relays=(r,t)=>{let n=r.data.relays||[];return t?.getRelayHints&&(n=Array.from(new Set([...n,...t.getRelayHints(r)]))),n},makeNAddrAttrs=(r,t)=>{const n=r.replace(/^nostr:/,""),{type:s,data:o}=decode$5(n),a=getNip19Relays({type:s,data:o},t);switch(s){case"naddr":return{type:s,bech32:n,relays:a,identifier:o.identifier,pubkey:o.pubkey,kind:o.kind};default:throw new Error(`Invalid nostr entity type for this context: ${s}`)}},makeNAddrNode=(r,t)=>({type:"naddr",attrs:makeNAddrAttrs(r,t)}),NADDR_REGEX=new RegExp("(?<![\\w./:?=])(nostr:)?(naddr1[0-9a-z]+)","g"),NAddrExtension=Node.create({name:"naddr",group:"block",atom:!0,selectable:!0,draggable:!0,priority:1e3,addOptions(){return{getRelayHints:()=>[]}},addAttributes(){return{type:{default:null},bech32:{default:null},identifier:{default:null},pubkey:{default:null},kind:{default:null},relays:{default:[],parseHTML:parseRelayAttribute}}},renderHTML({HTMLAttributes:r}){return["div",mergeAttributes(r,{"data-type":this.name})]},renderText(r){return"nostr:"+r.node.attrs.bech32},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},addStorage(){return{markdown:{serialize(r,t){r.write("nostr:"+t.attrs.bech32)},parse:{}}}},addCommands(){return{insertNAddr:({bech32:r})=>({commands:t})=>t.insertContent(makeNAddrNode(r,this.options),{updateSelection:!1})}},addPasteRules(){return[nodePasteRule({type:this.type,getAttributes:r=>r.data,find:r=>{const t=[];for(const n of r.matchAll(NADDR_REGEX))try{t.push(createPasteRuleMatch(n,makeNAddrAttrs(n[2],this.options)))}catch{continue}return t}})]}}),makeNEventAttrs=(r,t)=>{const n=r.replace(/^nostr:/,""),{type:s,data:o}=decode$5(n),a=getNip19Relays({type:s,data:o},t);switch(s){case"note":return{type:s,bech32:n,relays:a,id:o};case"nevent":return{type:s,bech32:n,relays:a,id:o.id,kind:o.kind,author:o.author};default:throw new Error(`Invalid nostr entity type for this context: ${s}`)}},makeNEventNode=(r,t)=>({type:"nevent",attrs:makeNEventAttrs(r,t)}),EVENT_REGEX=new RegExp("(?<![\\w./:?=])(nostr:)?(n(ote|event)1[0-9a-z]+)","g"),NEventExtension=Node.create({name:"nevent",group:"block",selectable:!0,draggable:!0,priority:1e3,addOptions(){return{getRelayHints:()=>[]}},addAttributes(){return{type:{default:null},id:{default:null},kind:{default:null},author:{default:null},bech32:{default:null},relays:{default:[],parseHTML:parseRelayAttribute}}},renderHTML({HTMLAttributes:r}){return["div",mergeAttributes(r,{"data-type":this.name})]},renderText(r){return"nostr:"+r.node.attrs.bech32},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]},addStorage(){return{markdown:{serialize(r,t){r.write("nostr:"+t.attrs.bech32)},parse:{}}}},addCommands(){return{insertNEvent:({bech32:r})=>({commands:t})=>t.insertContent(makeNEventNode(r,this.options),{updateSelection:!1})}},addPasteRules(){return[nodePasteRule({type:this.type,getAttributes:r=>r.data,find:r=>{const t=[];for(const n of r.matchAll(EVENT_REGEX))try{t.push(createPasteRuleMatch(n,makeNEventAttrs(n[2],this.options)))}catch{continue}return t}})]}}),YOUTUBE_REGEX=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,YOUTUBE_REGEX_GLOBAL=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/g,isValidYoutubeUrl=r=>r.match(YOUTUBE_REGEX),getYoutubeEmbedUrl=(r,t)=>t?"https://www.youtube-nocookie.com/embed/videoseries?list=":r?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",getYoutubeVideoOrPlaylistId=r=>r.searchParams.has("v")?{id:r.searchParams.get("v")}:r.hostname==="youtu.be"||r.pathname.includes("shorts")||r.pathname.includes("live")?{id:r.pathname.split("/").pop()}:r.searchParams.has("list")?{id:r.searchParams.get("list"),isPlaylist:!0}:null,getEmbedUrlFromYoutubeUrl=r=>{var t;const{url:n,allowFullscreen:s,autoplay:o,ccLanguage:a,ccLoadPolicy:c,controls:f,disableKBcontrols:g,enableIFrameApi:b,endTime:_,interfaceLanguage:L,ivLoadPolicy:q,loop:X,modestBranding:te,nocookie:ne,origin:Ce,playlist:Le,progressBarColor:Ge,startAt:ze,rel:Xe}=r;if(!isValidYoutubeUrl(n))return null;if(n.includes("/embed/"))return n;const He=new URL(n),{id:Ve,isPlaylist:We}=(t=getYoutubeVideoOrPlaylistId(He))!==null&&t!==void 0?t:{};if(!Ve)return null;const rt=new URL(`${getYoutubeEmbedUrl(ne,We)}${Ve}`);return He.searchParams.has("t")&&rt.searchParams.set("start",He.searchParams.get("t").replaceAll("s","")),s===!1&&rt.searchParams.set("fs","0"),o&&rt.searchParams.set("autoplay","1"),a&&rt.searchParams.set("cc_lang_pref",a),c&&rt.searchParams.set("cc_load_policy","1"),f||rt.searchParams.set("controls","0"),g&&rt.searchParams.set("disablekb","1"),b&&rt.searchParams.set("enablejsapi","1"),_&&rt.searchParams.set("end",_.toString()),L&&rt.searchParams.set("hl",L),q&&rt.searchParams.set("iv_load_policy",q.toString()),X&&rt.searchParams.set("loop","1"),te&&rt.searchParams.set("modestbranding","1"),Ce&&rt.searchParams.set("origin",Ce),Le&&rt.searchParams.set("playlist",Le),ze&&rt.searchParams.set("start",ze.toString()),Ge&&rt.searchParams.set("color",Ge),Xe!==void 0&&rt.searchParams.set("rel",Xe.toString()),rt.toString()},Youtube=Node.create({name:"youtube",addOptions(){return{addPasteHandler:!0,allowFullscreen:!0,autoplay:!1,ccLanguage:void 0,ccLoadPolicy:void 0,controls:!0,disableKBcontrols:!1,enableIFrameApi:!1,endTime:0,height:480,interfaceLanguage:void 0,ivLoadPolicy:0,loop:!1,modestBranding:!1,HTMLAttributes:{},inline:!1,nocookie:!1,origin:"",playlist:"",progressBarColor:void 0,width:640,rel:1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},start:{default:0},width:{default:this.options.width},height:{default:this.options.height}}},parseHTML(){return[{tag:"div[data-youtube-video] iframe"}]},addCommands(){return{setYoutubeVideo:r=>({commands:t})=>isValidYoutubeUrl(r.src)?t.insertContent({type:this.name,attrs:r}):!1}},addPasteRules(){return this.options.addPasteHandler?[nodePasteRule({find:YOUTUBE_REGEX_GLOBAL,type:this.type,getAttributes:r=>({src:r.input})})]:[]},renderHTML({HTMLAttributes:r}){const t=getEmbedUrlFromYoutubeUrl({url:r.src,allowFullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,controls:this.options.controls,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,nocookie:this.options.nocookie,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,startAt:r.start||0,rel:this.options.rel});return r.src=t,["div",{"data-youtube-video":""},["iframe",mergeAttributes(this.options.HTMLAttributes,{width:this.options.width,height:this.options.height,allowfullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,rel:this.options.rel},r)]]}}),IMETA_RENAME={bh:"blurhash"};function parseImeta(r){const t={};for(const n of r)if(n[0]==="imeta"){let s;for(const[o,a]of n.map(c=>c.split(/ (.+)/))){const c=IMETA_RENAME[o]||o;if(c==="url"&&(s=a,t[s]??(t[s]={})),a&&s)switch(c){case"fallback":{t[s].fallback=[...t[s].fallback||[],a];break}case"dim":{const f=a.split("x");t[s].dim={width:parseInt(f[0]),height:parseInt(f[1])};break}default:{t[s][c]=a;break}}}}return t}const makeNProfileAttrs=(r,t)=>{const n=r.replace(/^nostr:/,""),{type:s,data:o}=decode$5(n),a=getNip19Relays({type:s,data:o},t);switch(s){case"npub":return{type:s,bech32:n,relays:a,pubkey:o};case"nprofile":return{type:s,bech32:n,relays:a,pubkey:o.pubkey};default:throw new Error(`Invalid nostr entity type for this context: ${s}`)}},makeNProfileNode=(r,t)=>({type:"nprofile",attrs:makeNProfileAttrs(r,t)}),PROFILE_REGEX=new RegExp("(?<![\\w./:?=])(nostr:)?(np(ub|rofile)1[0-9a-z]+)","g"),NProfileExtension=Node.create({name:"nprofile",atom:!0,inline:!0,group:"inline",priority:1e3,addOptions(){return{getRelayHints:()=>[]}},addAttributes(){return{type:{default:null},bech32:{default:null},pubkey:{default:null},relays:{default:[],parseHTML:parseRelayAttribute}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:r}){return["span",mergeAttributes(r,{"data-type":this.name}),"@"]},renderText(r){return"nostr:"+r.node.attrs.bech32},addStorage(){return{markdown:{serialize(r,t){r.write("nostr:"+t.attrs.bech32)},parse:{}}}},addCommands(){return{insertNProfile:({bech32:r})=>({commands:t})=>t.insertContent(makeNProfileNode(r,this.options),{updateSelection:!1})}},addPasteRules(){return[nodePasteRule({type:this.type,getAttributes:r=>r.data,find:r=>{const t=[];for(const n of r.matchAll(PROFILE_REGEX))try{t.push(createPasteRuleMatch(n,makeNProfileAttrs(n[2],this.options)))}catch{continue}return t}})]}}),NSEC_REGEX=/(nsec1[0-9a-z]+)/g,NSecRejectExtension=Extension.create({name:"nsecReject",addOptions(){return{}},addPasteRules(){return[{find:NSEC_REGEX,handler:r=>{if(r.chain().deleteRange(r.range).insertContentAt(r.range.from,{text:"*NSEC_DELETED*",type:"text"}).run(),this.options.onError){this.options.onError(r);return}window.alert("DO NOT PASTE YOUR NSEC INTO THE EDITOR")}}]}}),REGEX_TAG=new RegExp("(?<![\\w./:?=])#[\\p{L}\\p{N}_]+","gu"),TagExtension=Mark.create({name:"tag",inline:!0,selectable:!0,inclusive:!0,group:"inline",priority:100,addStorage(){return{markdown:{serialize:{open:"",close:"",mixable:!1,expelEnclosingWhitespace:!0},parse:{}}}},renderHTML(r){return["a",mergeAttributes(r.HTMLAttributes,{"data-type":this.name})]},parseHTML(){return[{tag:`a[data-type="${this.name}"]`}]},addAttributes(){return{tag:{default:null}}},addPasteRules(){return[markPasteRule({find:REGEX_TAG,getAttributes:r=>({tag:r[0]}),type:this.type})]},addProseMirrorPlugins(){const r=this.type;return[new Plugin({key:new PluginKey("tagExtension"),appendTransaction(t,n,s){var o;if(!t.some(L=>L.docChanged))return null;const{$from:a}=s.selection;if(!a.parent.isTextblock)return null;const c=a.parent.childAfter(Math.max(0,a.parentOffset-1));if(!((o=c.node)!=null&&o.isText))return null;const f=a.start()+c.offset,g=c.node.text||"",b=Array.from(g.matchAll(REGEX_TAG)),_=s.tr;_.removeMark(f,f+g.length,r);for(const L of b){const q=f+(L.index||0),X=q+L[0].length;_.addMark(q,X,r.create({tag:L[0]}))}return _.steps.length?_:null}})]}}),TweetExtension=Node.create({name:"tweet",group:"block",selectable:!0,draggable:!0,addAttributes(){return{src:{default:null}}},addStorage(){return{markdown:{serialize(r,t){r.write(t.attrs.src)},parse:{}}}},renderText(r){return r.node.attrs.src},renderHTML({HTMLAttributes:r}){return["div",mergeAttributes(r,{"data-type":this.name})]},parseHTML(){return[{tag:`div[data-type="${this.name}"]`}]}}),VideoExtension=Node.create({name:"video",inline:!1,group:"block",atom:!0,selectable:!0,draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},file:{default:null},tags:{default:null},sha256:{default:null},uploading:{default:!1},error:{default:null}}},renderText(r){return r.node.attrs.src},renderHTML({HTMLAttributes:r}){return["video",mergeAttributes(r,{"data-type":this.name})]},parseHTML(){return[{tag:"video"}]},addStorage(){return{markdown:{serialize:defaultMarkdownSerializer.nodes.image,parse:{}}}}});Extension.create({name:"nostr",addExtensions(){const{extend:r={}}=this.options,t=[];return this.options.nprofile!==!1&&t.push(NProfileExtension.extend(r.nprofile)),this.options.nevent!==!1&&t.push(NEventExtension.extend(r.nevent)),this.options.naddr!==!1&&t.push(NAddrExtension.extend(r.naddr)),this.options.link!==!1&&t.push(LinkExtension.extend(r.link).configure(this.options.link)),this.options.tag!==!1&&t.push(TagExtension.extend(r.tag)),this.options.youtube!==!1&&t.push(Youtube.extend({renderText:n=>n.node.attrs.src,...r.youtube})),this.options.image!==!1&&t.push(ImageExtension.configure(this.options.image).extend(r.image)),this.options.video!==!1&&t.push(VideoExtension.configure(this.options.video).extend(r.video)),this.options.tweet!==!1&&t.push(TweetExtension.extend(r.tweet)),this.options.bolt11!==!1&&t.push(Bolt11Extension.extend(r.bolt11)),this.options.nsecReject!==!1&&t.push(NSecRejectExtension),this.options.fileUpload!==!1&&t.push(FileUploadExtension.configure(this.options.fileUpload)),t},addStorage(){return{imeta:null,setImeta:()=>{},getTags:()=>[],getNaddrs:()=>[],getNprofiles:()=>[],getNevents:()=>[],getPtags:()=>[],getQtags:()=>[],getAtags:()=>[],getTtags:()=>[],getImetaTags:()=>[],getEditorTags:()=>[]}},onBeforeCreate(){this.storage.setImeta=r=>{this.storage.imeta=r},this.storage.getTags=()=>{const r=[];return this.editor.state.doc.descendants(t=>{t.type.name==="text"&&t.marks.length>0&&t.marks.forEach(n=>{n.type.name==="tag"&&r.push(n.attrs)})}),r},this.storage.getNprofiles=()=>{const r=[];return this.editor.state.doc.descendants(t=>{t.type.name==="nprofile"&&r.push(t.attrs)}),r},this.storage.getNevents=()=>{const r=[];return this.editor.state.doc.descendants(t=>{t.type.name==="nevent"&&r.push(t.attrs)}),r},this.storage.getNaddrs=()=>{const r=[];return this.editor.state.doc.descendants(t=>{t.type.name==="naddr"&&r.push(t.attrs)}),r},this.storage.getTtags=()=>{const r=[];return this.storage.getTags().forEach(({tag:t})=>{const n=t.slice(1).toLocaleLowerCase();r.some(s=>s[1]===n)||r.push(["t",n])}),r},this.storage.getPtags=(r=!0)=>this.storage.getNprofiles().map(({pubkey:t,relays:n})=>{const s=["p",t];return r&&s.push(n[0]||""),s}),this.storage.getQtags=(r=!0)=>this.storage.getNevents().map(({id:t,author:n,relays:s})=>{const o=["q",t];return r&&(o.push(s[0]||""),n&&o.push(n)),o}),this.storage.getAtags=(r=!0)=>this.storage.getNaddrs().map(({kind:t,pubkey:n,identifier:s,relays:o})=>{const a=["a",`${t}:${n}:${s}`];return r&&a.push(o[0]||""),a}),this.storage.getImetaTags=()=>{var r;const t=(r=this.editor.storage.fileUpload)==null?void 0:r.uploader;return t?.getFiles().filter(n=>!!n.sha256).map(n=>{const s={url:n.src,x:n.sha256,ox:n.sha256,m:n.file.type,size:String(n.file.size)};for(const[o,a]of n.tags||[])s[o]=a;return["imeta",...Object.entries(s).map(o=>o.join(" ")).sort()]})||[]},this.storage.getEditorTags=(r=!0)=>[...this.storage.getPtags(r),...this.storage.getQtags(r),...this.storage.getAtags(r),...this.storage.getImetaTags(),...this.storage.getTtags()]},addCommands(){return{setEventContent:(r,t)=>n=>(this.storage.setImeta(t||parseImeta(r.tags)),n.chain().setMeta("parse",!0).setMeta("uiEvent","paste").setContent(r.kind===1?replaceTextContent(r.content):r.content),!0),setEventContentKind0:r=>t=>{if(r.kind!==0)return!1;let n;try{n=JSON.parse(r.content)}catch{return!1}return n.about&&t.chain().setMeta("parse",!0).setMeta("uiEvent","paste").setContent(replaceTextContent(n.about)),!0}}}});delegate(["click"]);delegate(["click"]);delegate(["click","keydown"]);delegate(["click"]);function targetToId(r){return"pubkey"in r&&typeof r.pubkey=="string"?r.pubkey:r.tagId()}function randomId(){return Math.random().toString(36).substring(2,15)}function getZapperTarget(r){const{target:t}=r;return"pubkey"in t&&typeof t.pubkey=="string"?{id:t.pubkey,type:"user"}:{id:t.tagId(),type:"event"}}delegate(["click"]);var SessionError$1=class extends Error{constructor(t){super(t),this.name="SessionError"}},SignerDeserializationError=class extends SessionError$1{constructor(r){super(r),this.name="SignerDeserializationError"}},StorageError$1=class extends SessionError$1{constructor(t){super(t),this.name="StorageError"}},SessionNotFoundError=class extends SessionError$1{constructor(r){super(`Session not found for pubkey: ${r}`),this.name="SessionNotFoundError"}},NoActiveSessionError=class extends SessionError$1{constructor(){super("No active session"),this.name="NoActiveSessionError"}},NDKNotInitializedError=class extends SessionError$1{constructor(){super("NDK not initialized. Call init() first."),this.name="NDKNotInitializedError"}},AuthManager=class{constructor(r,t){this.store=r,this.getStore=t}async login(r,t={}){const{setActive:n=!0,...s}=t,o=await this.store.addSession(r,n);return this.store.startSession(o,s),o}logout(r){const t=r??this.getStore().activePubkey;if(!t)throw new NoActiveSessionError;this.store.removeSession(t)}async switchTo(r){await this.store.switchToUser(r)}};async function serializeSigner(r){try{return r.toPayload()}catch{return}}async function deserializeSigner(r,t){try{const n=await ndkSignerFromPayload$1(r,t);if(!n)throw new Error("NDK returned undefined signer");return n}catch(n){const s=n instanceof Error?n.message:"Unknown error";throw new SignerDeserializationError(`Failed to deserialize signer: ${s}`)}}async function serializeSession(r,t){return{pubkey:r.pubkey,signerPayload:t?await serializeSigner(t):void 0,lastActive:r.lastActive,preferences:r.preferences}}var PersistenceManager=class{constructor(r,t){this.storage=r,this.getStore=t}async restore(){if(!this.storage)throw new StorageError$1("No storage configured");const{sessions:r,activePubkey:t}=await this.storage.load();for(const[n,s]of r)await this.restoreSession(n,s);t&&this.getStore().sessions.has(t)&&this.getStore().switchToUser(t)}async persist(){if(!this.storage)throw new StorageError$1("No storage configured");const r=await this.serializeAllSessions();await this.storage.save(r,this.getStore().activePubkey)}async clear(){if(!this.storage)throw new StorageError$1("No storage configured");await this.storage.clear()}async restoreSession(r,t){const n=this.getStore();let s;if(t.signerPayload)try{s=await deserializeSigner(t.signerPayload,n.ndk)}catch(a){a instanceof SignerDeserializationError&&console.warn(`Failed to restore signer for ${r}: ${a.message}`)}const o=s?await s.user():n.ndk?.getUser({pubkey:r})??new NDKUser$1({pubkey:r});await n.addSession(s||o,!1),n.updateSession(r,{lastActive:t.lastActive,preferences:t.preferences})}async serializeAllSessions(){const r=this.getStore(),t=new Map;for(const[n,s]of r.sessions){const o=r.signers.get(n),a=await serializeSession(s,o);t.set(n,a)}return t}};function normalizeSessionOptions(r){if(!r.eventConstructors||r.eventConstructors.length===0)return r;const t=new Map(r.events);for(const n of r.eventConstructors)for(const s of n.kinds)t.set(s,n);return{...r,events:t,eventConstructors:void 0}}function createSessionStore(){return createStore((r,t)=>({sessions:new Map,signers:new Map,activePubkey:void 0,init:n=>{r({ndk:n})},addSession:async(n,s)=>{const o=t();let a,c;"user"in n&&typeof n.user=="function"?(c=n,a=await c.user()):a=n;const f=a.pubkey,b=o.sessions.get(f)||{pubkey:f,events:new Map,lastActive:s?Math.floor(Date.now()/1e3):0},_=new Map(o.sessions);_.set(f,b);const L={sessions:_};if(c){const q=new Map(o.signers);q.set(f,c),L.signers=q}return s&&(L.activePubkey=f,o.ndk&&c&&(o.ndk.signer=c,a.ndk=o.ndk,o.ndk.activeUser=a)),r(L),f},startSession:(n,s)=>{const o=t(),{ndk:a,sessions:c}=o;if(!a)throw new NDKNotInitializedError;const f=c.get(n);if(!f)throw new SessionNotFoundError(n);f.subscription&&f.subscription.stop();const g=normalizeSessionOptions(s),b=buildSubscriptionKinds(g);if(b.length===0)return;const _=a.subscribe({kinds:b,authors:[n]},{closeOnEose:!1,subId:"session"},{onEvent:L=>handleIncomingEvent(L,n,g,t)});t().updateSession(n,{subscription:_})},stopSession:n=>{const o=t().sessions.get(n);o?.subscription&&(o.subscription.stop(),t().updateSession(n,{subscription:void 0}))},switchToUser:async n=>{const s=t();if(n===null){r({activePubkey:void 0}),s.ndk&&(s.ndk.signer=void 0,s.ndk.activeUser=void 0,s.ndk.muteFilter=void 0,s.ndk.relayConnectionFilter=void 0);return}const o=s.sessions.get(n);if(!o)throw new SessionNotFoundError(n);const a=s.signers.get(n);if(t().updateSession(n,{lastActive:Math.floor(Date.now()/1e3)}),r({activePubkey:n}),s.ndk){if(s.ndk.signer=a,a){const c=await a.user();c.ndk=s.ndk,s.ndk.activeUser=c}if(o.muteSet||o.mutedWords?s.ndk.muteFilter=c=>{if(o.muteSet?.has(c.pubkey)||c.id&&o.muteSet?.has(c.id))return!0;if(c.content&&o.mutedWords&&o.mutedWords.size>0){const f=c.content.toLowerCase();for(const g of o.mutedWords)if(f.includes(g))return!0}return!1}:s.ndk.muteFilter=void 0,o.blockedRelays&&o.blockedRelays.size>0){const c=o.blockedRelays;s.ndk.relayConnectionFilter=f=>!c.has(f)}else s.ndk.relayConnectionFilter=void 0}},removeSession:n=>{const s=t();t().stopSession(n);const o=new Map(s.sessions),a=new Map(s.signers);o.delete(n),a.delete(n);const c={sessions:o,signers:a};if(s.activePubkey===n&&Array.from(o.keys()).length===0&&(c.activePubkey=void 0,s.ndk&&(s.ndk.signer=void 0,s.ndk.muteFilter=void 0,s.ndk.relayConnectionFilter=void 0)),r(c),s.activePubkey===n){const f=Array.from(o.keys());f.length>0&&t().switchToUser(f[0]).catch(g=>{console.error("Failed to switch session after removal:",g)})}},updateSession:(n,s)=>{const o=t(),a=o.sessions.get(n);if(!a)return;const c={...a,...s},f=new Map(o.sessions);f.set(n,c),r({sessions:f})},updatePreferences:(n,s)=>{const a=t().sessions.get(n);if(!a)return;const c={...a.preferences,...s};t().updateSession(n,{preferences:c})}}))}function buildSubscriptionKinds(r){const t=[];if(r.follows&&(t.push(NDKKind$1.Contacts),Array.isArray(r.follows)&&t.push(...r.follows)),r.mutes&&t.push(NDKKind$1.MuteList),r.blockedRelays&&t.push(NDKKind$1.BlockRelayList),r.relayList&&t.push(NDKKind$1.RelayList),r.wallet&&t.push(NDKKind$1.CashuWallet,NDKKind$1.CashuMintList),r.events)for(const n of r.events.keys())t.push(n);return t}function handleIncomingEvent(r,t,n,s){const o=s().sessions.get(t);if(o){if(r.kind===NDKKind$1.Contacts){handleContactListEvent(r,t,s);return}if(r.kind===NDKKind$1.MuteList){handleMuteListEvent(r,t,s);return}if(r.kind===NDKKind$1.BlockRelayList){handleBlockRelayListEvent(r,t,s);return}if(r.kind===NDKKind$1.RelayList){handleRelayListEvent(r,t,s);return}handleReplaceableEvent(r,o,t,n,s)}}function handleContactListEvent(r,t,n){const s=n().sessions.get(t);if(!s||r.kind===void 0)return;const o=s.events.get(r.kind);if(o&&(o.id===r.id||(o.created_at??0)>(r.created_at??0)))return;const a=new Set;for(const c of r.tags)c[0]==="p"&&c[1]&&isValidPubkey$1(c[1])&&a.add(c[1]);s.events.set(r.kind,r),n().updateSession(t,{followSet:a,events:new Map(s.events)})}function handleMuteListEvent(r,t,n){const s=n().sessions.get(t);if(!s||r.kind===void 0)return;const o=s.events.get(r.kind);if(o&&(o.id===r.id||(o.created_at??0)>(r.created_at??0)))return;const a=new Map,c=new Set;for(const f of r.tags)(f[0]==="p"||f[0]==="e")&&f[1]&&a.set(f[1],f[0]),f[0]==="word"&&f[1]&&c.add(f[1].toLowerCase());s.events.set(r.kind,r),n().updateSession(t,{muteSet:a,mutedWords:c,events:new Map(s.events)})}function handleBlockRelayListEvent(r,t,n){const s=n().sessions.get(t);if(!s||r.kind===void 0)return;const o=s.events.get(r.kind);if(o&&(o.id===r.id||(o.created_at??0)>(r.created_at??0)))return;const a=new Set;for(const c of r.tags)c[0]==="relay"&&c[1]&&a.add(c[1]);s.events.set(r.kind,r),n().updateSession(t,{blockedRelays:a,events:new Map(s.events)})}function handleRelayListEvent(r,t,n){const s=n().sessions.get(t);if(!s||r.kind===void 0)return;const o=s.events.get(r.kind);if(o&&(o.id===r.id||(o.created_at??0)>(r.created_at??0)))return;const a=NDKRelayList$1.from(r),c=new Map;for(const f of a.readRelayUrls)c.set(f,{read:!0,write:!1});for(const f of a.writeRelayUrls){const g=c.get(f);g?g.write=!0:c.set(f,{read:!1,write:!0})}for(const f of a.bothRelayUrls)c.set(f,{read:!0,write:!0});s.events.set(r.kind,r),n().updateSession(t,{relayList:c,events:new Map(s.events)})}function handleReplaceableEvent(r,t,n,s,o){if(r.kind===void 0)return;const a=t.events.get(r.kind);if(a&&(a.id===r.id||(a.created_at??0)>(r.created_at??0)))return;const c=s.events?.get(r.kind),f=c&&typeof c.from=="function"?c.from(r):r;t.events.set(r.kind,f),o().updateSession(n,{events:new Map(t.events)})}function debounce(r,t){let n=null;return(...s)=>{n&&clearTimeout(n),n=setTimeout(()=>{r(...s)},t)}}function serializeSessionData$1(r){const t={sessions:Array.from(r.sessions.entries()),activePubkey:r.activePubkey,version:1,updatedAt:Date.now()};return JSON.stringify(t,null,2)}function deserializeSessionData$1(r){const t=JSON.parse(r);return{sessions:new Map(t.sessions||[]),activePubkey:t.activePubkey}}var NDKSessionManager=class{constructor(r,t={}){this.store=createSessionStore(),this.options={autoSave:t.autoSave??!0,saveDebounceMs:t.saveDebounceMs??500,...t},this.store.getState().init(r),this.authManager=new AuthManager(this.store.getState(),()=>this.store.getState()),this.persistenceManager=new PersistenceManager(this.options.storage,()=>this.store.getState()),this.options.autoSave&&this.options.storage&&this.setupAutoSave()}getCurrentState(){return this.store.getState()}getSessions(){return this.getCurrentState().sessions}getSession(r){return this.getCurrentState().sessions.get(r)}get activeSession(){const{activePubkey:r,sessions:t}=this.getCurrentState();return r?t.get(r):void 0}get activeUser(){const r=this.activeSession,t=this.getCurrentState();if(!(!r||!t.ndk))return t.ndk.getUser({pubkey:r.pubkey})}get activePubkey(){return this.getCurrentState().activePubkey}isReadOnly(r){const t=r??this.getCurrentState().activePubkey;return t?!this.getCurrentState().signers.has(t):!0}async login(r,t={}){const n={...this.options.fetches,setActive:t.setActive};return this.authManager.login(r,n)}async createAccount(r,t){const s=this.getCurrentState().ndk;if(!s)throw new Error("NDK not initialized");const o=t?.signer??NDKPrivateKeySigner$1.generate();t?.signer||await this.login(o,{setActive:!0});const a=t?.publish!==!1,c=[];if(r?.profile){const f=new NDKEvent$1(s,{kind:NDKKind$1.Metadata,content:JSON.stringify(r.profile)});await f.sign(o),a?await f.publish():c.push(f)}if(r?.relays&&r.relays.length>0){const f=new NDKRelayList$1(s);f.bothRelayUrls=r.relays,await f.sign(o),a?await f.publish():c.push(f)}if(r?.wallet){const{NDKCashuWallet:f}=await __vitePreload(async()=>{const{NDKCashuWallet:g}=await import("./BQhZuWdo.js");return{NDKCashuWallet:g}},__vite__mapDeps([0,1]),import.meta.url);await f.create(s,r.wallet.mints,r.wallet.relays)}if(r?.follows&&r.follows.length>0){const f=new NDKEvent$1(s,{kind:NDKKind$1.Contacts,tags:r.follows.map(g=>["p",g]),content:""});await f.sign(o),a?await f.publish():c.push(f)}return{signer:o,events:c}}logout(r){this.authManager.logout(r)}async switchTo(r){await this.authManager.switchTo(r)}startSession(r,t){this.getCurrentState().startSession(r,t)}stopSession(r){this.getCurrentState().stopSession(r)}enableWallet(r){const t=r??this.getCurrentState().activePubkey;if(!t)return;const n=this.getCurrentState(),s=n.sessions.get(t);if(!s)return;n.updatePreferences(t,{walletEnabled:!0}),s.subscription&&(n.stopSession(t),n.startSession(t,{...this.options.fetches,wallet:!0}))}disableWallet(r){const t=r??this.getCurrentState().activePubkey;if(!t)return;const n=this.getCurrentState(),s=n.sessions.get(t);if(!s)return;n.updatePreferences(t,{walletEnabled:!1}),s.subscription&&(n.stopSession(t),n.startSession(t,{...this.options.fetches,wallet:!1}))}isWalletEnabled(r){const t=r??this.getCurrentState().activePubkey;return t?this.getCurrentState().sessions.get(t)?.preferences?.walletEnabled??!1:!1}subscribe(r){return this.store.subscribe(r)}async restore(){if(await this.persistenceManager.restore(),this.options.fetches){const r=this.getCurrentState();for(const t of r.sessions.keys()){const n=r.sessions.get(t);if(!n)continue;const s=n.preferences?.walletEnabled??this.options.fetches.wallet??!1,o={...this.options.fetches,wallet:s};r.startSession(t,o)}}}async persist(){return this.persistenceManager.persist()}async clear(){return this.persistenceManager.clear()}destroy(){const r=this.getCurrentState();for(const t of r.sessions.keys())r.stopSession(t);this.unsubscribe&&this.unsubscribe()}setupAutoSave(){const r=debounce(()=>{this.persistenceManager.persist().catch(t=>{console.error("Failed to auto-save sessions:",t)})},this.options.saveDebounceMs);this.unsubscribe=this.store.subscribe(()=>{r()})}},LocalStorage$1=class{constructor(t="ndk-sessions"){this.key=t}async save(t,n){if(typeof window>"u"||!window.localStorage)throw new StorageError$1("localStorage is not available");try{const o=serializeSessionData$1({sessions:t,activePubkey:n});localStorage.setItem(this.key,o)}catch(s){const o=s instanceof Error?s.message:"Unknown error";throw new StorageError$1(`Failed to save sessions to localStorage: ${o}`)}}async load(){if(typeof window>"u"||!window.localStorage)return{sessions:new Map};const t=localStorage.getItem(this.key);if(!t)return{sessions:new Map};try{return deserializeSessionData$1(t)}catch(n){const s=n instanceof Error?n.message:"Unknown error";throw new StorageError$1(`Failed to parse sessions from localStorage: ${s}`)}}async clear(){if(typeof window>"u"||!window.localStorage)throw new StorageError$1("localStorage is not available");try{localStorage.removeItem(this.key)}catch(t){const n=t instanceof Error?t.message:"Unknown error";throw new StorageError$1(`Failed to clear sessions from localStorage: ${n}`)}}};function constructing(r,t,n){r.session||n("ndksvelte-no-session",`NDKSvelte instantiated without 'session' parameter.

Session support is disabled. This means:
   No login/logout functionality
   No wallet integration ($wallet store unavailable)
   No automatic session persistence
   No follows/mutes management

Most interactive apps need session support.`,`Enable sessions: new NDKSvelte({ session: true })
Or with custom options: new NDKSvelte({ session: { follows: true, wallet: true } })`)}function subscribing(r,t,n){typeof r!="function"&&typeof r=="object"&&r!==null&&t("ndksvelte-subscribe-wrong-api",`$subscribe() requires a CALLBACK FUNCTION, not direct config.

You're trying to use an API that doesn't exist.

WRONG:
  const notes = ndk.$subscribe({ kinds: [1] });
  const notes = ndk.$subscribe([{ kinds: [1] }]);

CORRECT:
  const notes = ndk.$subscribe(() => ({
    filters: [{ kinds: [1], limit: 50 }]
  }));

The callback enables reactive filters and conditional subscriptions.`,"Always wrap your config in a callback function: () => ({ ... })")}let LRUCache$1=class{cache;maxSize;constructor(t){this.cache=new Map,this.maxSize=t}get(t){const n=this.cache.get(t);return n!==void 0&&(this.cache.delete(t),this.cache.set(t,n)),n}set(t,n){if(this.cache.delete(t),this.cache.set(t,n),this.cache.size>this.maxSize){const s=this.cache.keys().next().value;this.cache.delete(s)}}has(t){return this.cache.has(t)}clear(){this.cache.clear()}get size(){return this.cache.size}};function validateCallback(r,t,n){if(typeof r!="function")throw new TypeError(`${t} expects ${n} to be a function, but received ${typeof r}. Example: ndk.${t}(() => value) instead of ndk.${t}(value)`)}const profileCache=new LRUCache$1(1e3);function createFetchProfile(r,t){validateCallback(t,"$fetchProfile","pubkey");let n=state(void 0);const s=user_derived(t);return user_effect(()=>{const o=get(s);if(!o){set(n,void 0);return}const a=profileCache.get(o);if(a){set(n,a,!0);return}const c=r.getUser({pubkey:o});c.fetchProfile({closeOnEose:!0,groupable:!0,groupableDelay:250}).then(()=>{c.profile&&(profileCache.set(o,c.profile),set(n,c.profile,!0))}).catch(()=>{set(n,void 0)})}),new Proxy({},{get(o,a){if(a==="ready")return get(n)!==void 0;if(get(n)&&a in get(n)){const c=get(n)[a];return typeof c=="function"?c.bind(get(n)):c}},has(o,a){return a==="ready"?!0:get(n)?a in get(n):!1},ownKeys(){return["ready",...get(n)?Reflect.ownKeys(get(n)):[]]},getOwnPropertyDescriptor(o,a){return a==="ready"?{configurable:!0,enumerable:!0,value:get(n)!==void 0}:get(n)?Reflect.getOwnPropertyDescriptor(get(n),a):void 0}})}function createFetchEvent(r,t,n){validateCallback(t,"$fetchEvent","idOrFilter");let s=state(void 0);const o=user_derived(t),a=n?.wrap??!0;return user_effect(()=>{const c=get(o);if(!c){set(s,void 0);return}r.fetchEvent(c,{wrap:a}).then(f=>{set(s,f||void 0,!0)}).catch(()=>{set(s,void 0)})}),new Proxy({},{get(c,f){if(f==="ready")return get(s)!==void 0;if(get(s)&&f in get(s)){const g=get(s)[f];return typeof g=="function"?g.bind(get(s)):g}},has(c,f){return f==="ready"?!0:get(s)?f in get(s):!1},ownKeys(){return["ready",...get(s)?Reflect.ownKeys(get(s)):[]]},getOwnPropertyDescriptor(c,f){return f==="ready"?{configurable:!0,enumerable:!0,value:get(s)!==void 0}:get(s)?Reflect.getOwnPropertyDescriptor(get(s),f):void 0}})}function createFetchEvents(r,t,n){validateCallback(t,"$fetchEvents","filters");let s=state(proxy([]));const o=user_derived(t),a=n?.wrap??!0;return user_effect(()=>{const c=get(o);if(!c){set(s,[],!0);return}r.fetchEvents(c,{wrap:a}).then(f=>{set(s,Array.from(f),!0)}).catch(()=>{set(s,[],!0)})}),get(s)}class ReactivePaymentsStore{#e=state(proxy([]));get pending(){return get(this.#e)}set pending(t){set(this.#e,t,!0)}#t=state(proxy([]));get history(){return get(this.#t)}set history(t){set(this.#t,t,!0)}#r=state(proxy(new Map));get byTarget(){return get(this.#r)}set byTarget(t){set(this.#r,t,!0)}getZapAmount(t){const n=targetToId(t);return(this.byTarget.get(n)||[]).filter(o=>o.type==="zap_sent"&&o.status==="complete").reduce((o,a)=>o+a.amount,0)}isZapped(t){const n=targetToId(t);return(this.byTarget.get(n)||[]).some(o=>o.type==="zap_sent"&&(o.status==="complete"||o.status==="pending"))}addPending(t,n){const{id:s,type:o}=getZapperTarget(t),a=t.amount,c=t.unit,f={internalId:randomId(),targetId:s,targetType:o,target:t.target,recipient:o==="user"?s:t.target.pubkey,sender:n,amount:a,unit:c,status:"pending",comment:t.comment,timestamp:Date.now(),zapper:t};this.pending=[...this.pending,f]}completePending(t,n){const s=this.pending.find(c=>c.internalId===t);if(!s)return;const o={id:n.id,type:"zap_sent",direction:"out",status:"complete",amount:s.amount,unit:s.unit,timestamp:n.created_at||s.timestamp,target:s.target,targetId:s.targetId,targetType:s.targetType,recipient:s.recipient,sender:s.sender,comment:s.comment,event:n};this.pending=this.pending.filter(c=>c.internalId!==t),this.history=[...this.history,o];const a=this.byTarget.get(s.targetId)||[];this.byTarget.set(s.targetId,[...a,o])}failPending(t,n){const s=this.pending.find(o=>o.internalId===t);s&&(s.status="failed",s.error=n,this.pending=[...this.pending])}}function createReactivePayments(){return new ReactivePaymentsStore}class ReactivePoolStore{#e;#t=state(proxy(new Map));get relays(){return get(this.#t)}set relays(t){set(this.#t,t,!0)}#r=state(0);get connectedCount(){return get(this.#r)}set connectedCount(t){set(this.#r,t,!0)}#n=state(0);get connectingCount(){return get(this.#n)}set connectingCount(t){set(this.#n,t,!0)}constructor(t){this.#e=t,this.#o()}#o(){const t=this.#e.pool;if(!t){console.error("[svelte] Pool not initialized, skipping event listeners");return}for(const n of t.relays.values())this.#i(n);t.on("relay:connect",this.#a),t.on("relay:disconnect",this.#l),t.on("relay:connecting",this.#c)}#i(t){const n=t.connectivity.status;let s;n>=NDKRelayStatus.CONNECTED?s="connected":n===NDKRelayStatus.CONNECTING?s="connecting":n===NDKRelayStatus.RECONNECTING?s="reconnecting":s="disconnected",this.#s(t,s)}#a=t=>{this.#s(t,"connected"),this.#u()};#l=t=>{this.#s(t,"disconnected"),this.#u()};#c=t=>{this.#s(t,"connecting"),this.#u()};#s(t,n){const s=this.relays.get(t.url),o={url:t.url,status:n,connectionStats:s?.connectionStats||{attempts:0,success:0}};n==="connecting"?o.connectionStats.attempts++:n==="connected"&&(o.connectionStats.success++,o.connectionStats.connectedAt=Date.now()),this.relays.set(t.url,o),this.relays=new Map(this.relays)}#u(){let t=0,n=0;for(const s of this.relays.values())s.status==="connected"&&t++,s.status==="connecting"&&n++;this.connectedCount=t,this.connectingCount=n}getRelay(t){return this.relays.get(t)}getConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status==="connected")}}function createReactivePool(r){return new ReactivePoolStore(r)}class ReactiveSessionsStore{#e;#t=state(proxy({}));get sessions(){return get(this.#t)}set sessions(t){set(this.#t,t,!0)}#r=state(void 0);get activePubkey(){return get(this.#r)}set activePubkey(t){set(this.#r,t,!0)}constructor(t){this.#e=t,this.#e.subscribe(n=>{const s={};if(n.sessions.forEach((o,a)=>{s[a]=o}),this.sessions=s,this.activePubkey=n.activePubkey,n.activePubkey){const o=n.signers.get(n.activePubkey);o&&n.ndk&&(n.ndk.signer=o)}}),this.#e.restore().catch(n=>{console.error("[svelte] Failed to restore sessions:",n)})}get current(){if(this.activePubkey)return this.sessions[this.activePubkey]}get currentUser(){return this.#e.activeUser}get follows(){return this.current?.followSet??new Set}get mutes(){return this.current?.muteSet??new Map}get mutedWords(){return this.current?.mutedWords??new Set}get blockedRelays(){return this.current?.blockedRelays??new Set}get relayList(){return this.current?.relayList??new Map}getSessionEvent(t){return this.current?.events.get(t)}get walletEvent(){return this.getSessionEvent(NDKKind$1.CashuWallet)}get all(){return Object.values(this.sessions)}async login(t,n){return await this.#e.login(t,n)}async add(t){return await this.#e.login(t,{setActive:!1})}logout(t){const n=t??this.activePubkey;n&&(this.#e.logout(n),delete this.sessions[n],this.activePubkey===n&&(this.activePubkey=void 0),Object.keys(this.sessions).length===0&&this.#e.clear().catch(s=>{console.error("[svelte] Failed to clear sessions from storage:",s)}))}logoutAll(){const t=Object.keys(this.sessions);for(const n of t)this.#e.logout(n);this.sessions={},this.activePubkey=void 0,this.#e.clear().catch(n=>{console.error("[svelte] Failed to clear sessions from storage:",n)})}async switch(t){await this.#e.switchTo(t)}async switchTo(t){await this.#e.switchTo(t)}get(t){return this.sessions[t]}start(t,n){this.#e.startSession(t,n)}stop(t){this.#e.stopSession(t)}isReadOnly(t){return this.#e.isReadOnly(t)}async createAccount(t,n){return await this.#e.createAccount(t,n)}}function createReactiveSessions(r){return new ReactiveSessionsStore(r)}class ReactiveWalletStore{#e=state(0);get balance(){return get(this.#e)}set balance(t){set(this.#e,t,!0)}#t=state(void 0);#r=state(proxy(NDKWalletStatus.INITIAL));get status(){return get(this.#r)}set status(t){set(this.#r,t,!0)}#n;#o;#i;#a;#l=!1;constructor(t,n){this.#n=t,this.#o=n,n.subscribe(s=>{const o=s.activePubkey;if(!o){this.clear();return}const c=s.sessions.get(o)?.events.get(NDKKind$1.CashuWallet),f=this.#a&&this.#a!==o;if(!c){get(this.#t)&&!f&&this.clear();return}c.id===this.#i&&o===this.#a||this.#l||this.#c(c,o)})}async#c(t,n){this.#l=!0;try{const s=await NDKCashuWallet.from(t);s&&(this.#i=t.id,this.#a=n,this.set(s),await s.start({pubkey:n}))}catch(s){console.error("[ReactiveWalletStore] Failed to load wallet from event:",s)}finally{this.#l=!1}}set(t){get(this.#t)&&(get(this.#t).off("balance_updated",this.#s),get(this.#t).off("status_changed",this.#u)),set(this.#t,t,!0),this.status=t.status,this.#n.wallet=t,t.on("balance_updated",this.#s),t.on("status_changed",this.#u),this.refreshBalance()}#s=t=>{t?this.balance=t.amount||0:this.refreshBalance()};#u=t=>{this.status=t};async refreshBalance(){if(get(this.#t))try{const t=get(this.#t).balance;this.balance=t?.amount||0}catch(t){console.error("[svelte] Failed to refresh wallet balance:",t)}}clear(){get(this.#t)&&(get(this.#t).off("balance_updated",this.#s),get(this.#t).off("status_changed",this.#u)),set(this.#t,void 0),this.balance=0,this.status=NDKWalletStatus.INITIAL,this.#i=void 0,this.#a=void 0,this.#n.wallet=void 0}get mints(){const t=get(this.#t);return!t||!(t instanceof NDKCashuWallet)?[]:t.mints}get mintBalances(){const t=get(this.#t);if(!t||!(t instanceof NDKCashuWallet))return[];const n=t.state.getMintsBalance(),s=t.mints,o=new Map;for(const a of s)o.set(a,0);for(const[a,c]of Object.entries(n))typeof c=="number"&&o.set(a,c);return Array.from(o.entries()).map(([a,c])=>({url:a,balance:c})).sort((a,c)=>c.balance-a.balance)}get relays(){const t=get(this.#t);return!t||!(t instanceof NDKCashuWallet)?[]:t.relaySet?Array.from(t.relaySet.relays).map(n=>n.url):[]}get transactions(){return this.#n.$payments.history.map(n=>({type:n.direction==="out"?"send":"receive",amount:n.amount,timestamp:n.timestamp,memo:n.comment,status:n.status==="confirmed"?"completed":n.status})).sort((n,s)=>s.timestamp-n.timestamp)}get needsOnboarding(){const t=get(this.#t);return!t||t instanceof NDKCashuWallet&&t.mints.length===0}get privkey(){const t=get(this.#t);if(!(t instanceof NDKCashuWallet))return;const n=Array.from(t.privkeys);return n.length>0?n[0]:void 0}get relaySet(){const t=get(this.#t);if(t instanceof NDKCashuWallet)return t.relaySet}deposit(t,n){const s=get(this.#t);if(s instanceof NDKCashuWallet)return s.deposit(t,n)}async send(t,n){const s=get(this.#t);if(!(s instanceof NDKCashuWallet))throw new Error("No wallet");return s.send(t,n)}async receiveToken(t,n){const s=get(this.#t);if(!(s instanceof NDKCashuWallet))throw new Error("No wallet");await s.receiveToken(t,n)}async getP2PKPubkey(){const t=get(this.#t);if(!(t instanceof NDKCashuWallet))throw new Error("No wallet");return await t.getP2pk()}async save(t){let n=get(this.#t);if(n instanceof NDKCashuWallet)await n.update(t);else{const s=this.#o.getState().activePubkey;if(!s)throw new Error("No active session");const o=await NDKCashuWallet.create(this.#n,t.mints,t.relays);await o.start({pubkey:s}),this.set(o),n=o}await n.publishMintList()}}function createReactiveWallet(r,t){return new ReactiveWalletStore(r,t)}class ReactiveWoTStore{#e;#t;#r=null;#n=state(!1);get loaded(){return get(this.#n)}set loaded(t){set(this.#n,t,!0)}#o=state(!1);get autoFilterEnabled(){return get(this.#o)}set autoFilterEnabled(t){set(this.#o,t,!0)}#i=state(void 0);constructor(t,n){this.#e=t,this.#t=n}async load(t={}){const n=this.#t.currentUser?.pubkey;if(!n)throw new Error("Cannot load WoT: no user logged in");this.#r=new NDKWoT(this.#e,n);const s={depth:t.maxDepth||3,maxFollows:t.maxFollows,timeout:t.timeout};await this.#r.load(s),this.loaded=!0}enableAutoFilter(t){this.autoFilterEnabled=!0,set(this.#i,t,!0)}disableAutoFilter(){this.autoFilterEnabled=!1,set(this.#i,void 0)}getScore(t){return this.#r?this.#r.getScore(t):0}getDistance(t){return this.#r?this.#r.getDistance(t):null}includes(t,n){return this.#r?this.#r.includes(t,n):!1}shouldFilterEvent(t){if(!this.#r||!this.autoFilterEnabled)return!1;const{maxDepth:n,minScore:s,includeUnknown:o=!1}=get(this.#i)||{};return this.includes(t.pubkey,{maxDepth:n})?s!==void 0?this.getScore(t.pubkey)<s:!1:!o}rankEvents(t,n){return this.#r?rankByWoT(this.#r,t,n):t}}function createReactiveWoT(r,t){return new ReactiveWoTStore(r,t)}function createSubscriptionInternal(r,t,n){const s=r.$wot;let o=state(proxy([])),a=state(!1);const c=new Map;let f,g,b;const _=user_derived(()=>{const Ve=t();return!Ve||"filters"in Ve?Ve:Array.isArray(Ve)?{filters:Ve}:["kinds","authors","ids","since","until","limit","#e","#p","#a","#d","#t","search"].some(st=>st in Ve)?{filters:Ve}:Ve}),L=user_derived(()=>{const Ve=get(_);return Ve?.filters?Array.isArray(Ve.filters)?Ve.filters:[Ve.filters]:[]}),q=user_derived(()=>{const Ve=get(_);if(!Ve)return{};const{filters:We,noDedupe:rt,dedupeKey:st,wot:ht,wotRank:je,...se}=Ve;return se}),X=user_derived(()=>{const Ve=get(_);return Ve?{noDedupe:Ve.noDedupe,dedupeKey:Ve.dedupeKey,wot:Ve.wot,wotRank:Ve.wotRank}:{noDedupe:void 0,dedupeKey:void 0,wot:void 0,wotRank:void 0}}),te=user_derived(()=>get(X).dedupeKey??(Ve=>Ve.deduplicationKey()));user_effect(()=>{const Ve=get(L),We=get(q);if(Ve.length===0){Ge();return}g=Ve,b=We,Xe()}),user_effect(()=>{get(X),Ce()});function ne(Ve){const We=get(X),rt=get(te)(Ve);if(!We.noDedupe&&c.has(rt)){const st=c.get(rt);if(st){const ht=st.created_at||0,je=Ve.created_at||0;if(ht>=je)return}}c.set(rt,Ve),Ce()}function Ce(){const Ve=get(X);let We=Array.from(c.values()),rt=!1;s&&s.loaded&&(Ve.wot!==!1&&(Ve.wot||s.autoFilterEnabled)&&(We=We.filter(ht=>{if(Ve.wot&&typeof Ve.wot=="object"){const{maxDepth:je,minScore:se,includeUnknown:m=!1}=Ve.wot;return s.includes(ht.pubkey,{maxDepth:je})?se!==void 0?s.getScore(ht.pubkey)>=se:!0:m}else return!s.shouldFilterEvent(ht)})),Ve.wotRank&&(We=s.rankEvents(We,Ve.wotRank),rt=!0)),rt||We.sort((st,ht)=>(ht.created_at||0)-(st.created_at||0)),set(o,We,!0)}function Le(){if(f)return;const Ve=n(g,{...b,closeOnEose:!1,onEvent:ne,onEose:()=>{set(a,!0)}});Ve instanceof Promise?Ve.then(We=>{f=We}).catch(We=>{console.error("[createSubscription] Failed to start subscription:",We)}):f=Ve}function Ge(){f?.stop(),f=void 0}let ze=!1;function Xe(){ze||(ze=!0,Ge(),c.clear(),set(o,[],!0),set(a,!1),Le(),queueMicrotask(()=>{ze=!1}))}function He(){c.clear(),set(o,[],!0),set(a,!1)}return{get events(){return get(o)},get count(){return get(o).length},get eosed(){return get(a)},start:Le,stop:Ge,clear:He}}function createSubscription(r,t){return validateCallback(t,"$subscribe","config"),createSubscriptionInternal(r,t,(n,s)=>r.subscribe(n,s))}function createMetaSubscription(r,t){validateCallback(t,"$metaSubscribe","config");let n=state(proxy([])),s=state(!1),o=state(proxy(new Map));const a=new Map,c=new Map;let f,g,b,_;const L=user_derived(()=>{const We=t();return!We||"filters"in We?We:Array.isArray(We)?{filters:We}:["kinds","authors","ids","since","until","limit","#e","#p","#a","#d","#t","search"].some(ht=>ht in We)?{filters:We}:We}),q=user_derived(()=>{const We=get(L);return We?.filters?Array.isArray(We.filters)?We.filters:[We.filters]:[]}),X=user_derived(()=>{const We=get(L);if(!We)return{};const{filters:rt,sort:st,...ht}=We;return ht}),te=user_derived(()=>{const We=get(L);return We&&"sort"in We?We.sort??"time":"time"});user_effect(()=>{const We=get(q),rt=get(X),st=get(te);if(We.length===0){ze();return}g=We,b=rt,_=st,He()});async function ne(We){const rt=We.getMatchingTags("e"),st=We.getMatchingTags("a"),ht=[];for(const je of rt)je[1]&&ht.push(je[1]);for(const je of st)je[1]&&ht.push(je[1]);for(const je of ht)try{const se=await r.fetchEvent(je);se&&Ce(se,We)}catch(se){console.error(`[metaSubscribe] Failed to fetch event ${je}:`,se)}}function Ce(We,rt){const st=We.tagId();a.set(st,We);const ht=c.get(st)||[];ht.find(je=>je.id===rt.id)||c.set(st,[...ht,rt]),Le()}function Le(){let We=Array.from(a.values());switch(_){case"time":We.sort((rt,st)=>(st.created_at||0)-(rt.created_at||0));break;case"count":We.sort((rt,st)=>{const ht=c.get(rt.tagId())?.length||0;return(c.get(st.tagId())?.length||0)-ht});break;case"tag-time":We.sort((rt,st)=>{const ht=c.get(rt.tagId())||[],je=c.get(st.tagId())||[],se=Math.max(...ht.map(A=>A.created_at||0),0);return Math.max(...je.map(A=>A.created_at||0),0)-se});break}set(n,We,!0),set(o,new Map(c),!0)}function Ge(){f||(f=r.subscribe(g,{...b,closeOnEose:!1,onEvent:We=>{ne(We)},onEose:()=>{set(s,!0)}}))}function ze(){f?.stop(),f=void 0}let Xe=!1;function He(){Xe||(Xe=!0,ze(),a.clear(),c.clear(),set(n,[],!0),set(o,new Map,!0),set(s,!1),Ge(),queueMicrotask(()=>{Xe=!1}))}function Ve(){a.clear(),c.clear(),set(n,[],!0),set(o,new Map,!0),set(s,!1)}return{get events(){return get(n)},get count(){return get(n).length},get eosed(){return get(s)},get pointedBy(){return get(o)},start:Ge,stop:ze,clear:Ve}}function validateNip57Zap(r,t){if(r.kind!==NDKKind$1.Zap)return!1;const n=zapInvoiceFromEvent(r);if(!n)return!1;if(t){if(t instanceof NDKEvent$1){if(n.zappedEvent!==t.id&&n.zappedEvent!==t.tagId())return!1}else if(n.zapped!==t.pubkey)return!1}return!0}function validateNip61Zap(r,t){if(r.kind!==NDKKind$1.Nutzap)return!1;const n=NDKNutzap$1.from(r);if(!n||!n.isValid)return!1;if(t){if(t instanceof NDKEvent$1){const s=n.tagValue("e"),o=n.tagValue("a");if(s!==t.id&&o!==t.tagId())return!1}else if(n.recipientPubkey!==t.pubkey)return!1}return!0}function validateZap(r,t){return r.kind===NDKKind$1.Zap?validateNip57Zap(r,t):r.kind===NDKKind$1.Nutzap?validateNip61Zap(r,t):!1}function getZapAmount(r){if(r.kind===NDKKind$1.Zap){const t=zapInvoiceFromEvent(r);return t?Math.floor(t.amount/1e3):0}else if(r.kind===NDKKind$1.Nutzap){const t=NDKNutzap$1.from(r);return t?t.amount:0}return 0}function getZapSender(r){if(r.ndk){if(r.kind===NDKKind$1.Zap){const t=zapInvoiceFromEvent(r);return t?r.ndk.getUser({pubkey:t.zappee}):void 0}else if(r.kind===NDKKind$1.Nutzap){const t=NDKNutzap$1.from(r);return t?t.sender:void 0}}}function hasZappedBy(r,t){return r.some(n=>getZapSender(n)?.pubkey===t)}function createZapSubscription(r,t){validateCallback(t,"$zaps","config");let n=state(proxy([])),s=state(!1);const o=new Map;let a;const c=user_derived(t),f=user_derived(()=>{const ze=get(c);if(!ze)return;const{target:Xe,method:He,limit:Ve}=ze;let We;return He==="nip57"?We=[NDKKind$1.Zap]:He==="nip61"?We=[NDKKind$1.Nutzap]:We=[NDKKind$1.Zap,NDKKind$1.Nutzap],{...Xe.filter(),kinds:We,limit:Ve}});function g(ze){const Xe=ze.deduplicationKey();if(o.has(Xe)){const He=o.get(Xe);if(He){const Ve=He.created_at||0,We=ze.created_at||0;if(Ve>=We)return}}o.set(Xe,ze),_()}function b(ze){for(const Xe of ze){const He=Xe.deduplicationKey();if(!o.has(He))o.set(He,Xe);else{const Ve=o.get(He);if(Ve){const We=Ve.created_at||0;(Xe.created_at||0)>We&&o.set(He,Xe)}}}_()}function _(){let ze=Array.from(o.values());ze.sort((Xe,He)=>(He.created_at||0)-(Xe.created_at||0)),set(n,ze,!0)}function L(){a||!get(f)||(a=r.subscribe(get(f),{closeOnEose:!1,onEvent:g,onEvents:b,onEose:()=>{set(s,!0)}}))}function q(){a?.stop(),a=void 0}function X(){q(),o.clear(),set(n,[],!0),set(s,!1),L()}function te(){o.clear(),set(n,[],!0),set(s,!1)}user_effect(()=>{if(!get(f)){q();return}X()});const ne=user_derived(()=>{const ze=get(c);if(!ze)return[];let Xe=get(n);return ze.validated&&(Xe=Xe.filter(He=>validateZap(He,ze.target))),Xe}),Ce=user_derived(()=>get(ne).filter(ze=>ze.kind===NDKKind$1.Zap)),Le=user_derived(()=>get(ne).filter(ze=>ze.kind===NDKKind$1.Nutzap).map(ze=>NDKNutzap$1.from(ze)).filter(ze=>ze!==void 0)),Ge=user_derived(()=>get(ne).reduce((ze,Xe)=>ze+getZapAmount(Xe),0));return{get events(){return get(ne)},get count(){return get(ne).length},get totalAmount(){return get(Ge)},get eosed(){return get(s)},get lightningZaps(){return get(Ce)},get nutzaps(){return get(Le)},stop:q,start:L,clear:te}}function createFetchUser(r,t){validateCallback(t,"$fetchUser","identifier");let n=state(void 0);const s=user_derived(t);return user_effect(()=>{const o=get(s);if(!o){set(n,void 0);return}r.fetchUser(o).then(a=>{set(n,a||void 0,!0)}).catch(()=>{set(n,void 0)})}),new Proxy({},{get(o,a){if(a==="ready")return get(n)!==void 0;if(get(n)&&a in get(n)){const c=get(n)[a];return typeof c=="function"?c.bind(get(n)):c}},has(o,a){return a==="ready"?!0:get(n)?a in get(n):!1},ownKeys(){return["ready",...get(n)?Reflect.ownKeys(get(n)):[]]},getOwnPropertyDescriptor(o,a){return a==="ready"?{configurable:!0,enumerable:!0,value:get(n)!==void 0}:get(n)?Reflect.getOwnPropertyDescriptor(get(n),a):void 0}})}class NDKSvelte extends NDK{$sessions;$wot;$wallet;$payments;$pool;#e=state(void 0);constructor(t={}){if(super(t),this.aiGuardrails?.register("ndkSvelte",{constructing}),this.aiGuardrails?.register("ndkSvelteSubscribe",{subscribing}),this.aiGuardrails?.ndkSvelte?.constructing(t),t.session){const n=t.session===!0?{storage:new LocalStorage$1,autoSave:!0,fetches:{follows:!0,mutes:!0,wallet:!0}}:{storage:new LocalStorage$1,autoSave:!0,...t.session},s=new NDKSessionManager(this,n);this.$wallet=createReactiveWallet(this,s),this.$sessions=createReactiveSessions(s),this.$wot=createReactiveWoT(this,this.$sessions)}this.$payments=createReactivePayments(),this.$pool=createReactivePool(this),this.on("activeUser:change",n=>{set(this.#e,n,!0)}),set(this.#e,this.activeUser,!0)}$subscribe(t){return this.aiGuardrails?.ndkSvelteSubscribe?.subscribing(t),createSubscription(this,t)}$metaSubscribe(t){return createMetaSubscription(this,t)}$zaps(t){return createZapSubscription(this,t)}$fetchUser(t){return createFetchUser(this,t)}$fetchProfile(t){return createFetchProfile(this,t)}$fetchEvent(t,n){return createFetchEvent(this,t,n)}$fetchEvents(t,n){return createFetchEvents(this,t,n)}get $currentUser(){return get(this.#e)}get $activeUser(){return get(this.#e)}get $currentPubkey(){return get(this.#e)?.pubkey}get $currentSession(){return this.$sessions?.current}get $follows(){return Array.from(this.$sessions?.follows??[])}}var lib$1={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0})),types}var ee={},taskCollection$1={},taskCollection={},utils$1={},hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;hasRequiredUtils$1=1,Object.defineProperty(utils$1,"__esModule",{value:!0}),utils$1._fast_remove_single=void 0;function r(t,n){n!==-1&&(n===0?t.shift():n===t.length-1?t.length=t.length-1:t.splice(n,1))}return utils$1._fast_remove_single=r,utils$1}var bakeCollection={},hasRequiredBakeCollection;function requireBakeCollection(){return hasRequiredBakeCollection||(hasRequiredBakeCollection=1,(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=(function(){});var FORLOOP_FALLBACK=1500;function generateArgsDefCode(r){var t="";if(r===0)return t;for(var n=0;n<r-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(r-1),t}function generateBodyPartsCode(r,t){for(var n="",s="",o=0;o<t;++o)n+="var f".concat(o," = collection[").concat(o,`];
`),s+="f".concat(o,"(").concat(r,`)
`);return{funcDefCode:n,funcCallCode:s}}function generateBodyPartsVariadicCode(r){for(var t="",n="",s=0;s<r;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),n+="f".concat(s,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection)),bakeCollection}var hasRequiredTaskCollection$1;function requireTaskCollection$1(){if(hasRequiredTaskCollection$1)return taskCollection;hasRequiredTaskCollection$1=1;var r=taskCollection&&taskCollection.__spreadArray||function(ze,Xe,He){if(He||arguments.length===2)for(var Ve=0,We=Xe.length,rt;Ve<We;Ve++)(rt||!(Ve in Xe))&&(rt||(rt=Array.prototype.slice.call(Xe,0,Ve)),rt[Ve]=Xe[Ve]);return ze.concat(rt||Array.prototype.slice.call(Xe))};Object.defineProperty(taskCollection,"__esModule",{value:!0}),taskCollection.TaskCollection=void 0;var t=requireUtils$1(),n=requireBakeCollection();function s(ze,Xe){var He=this.length;if(He>1)if(Xe){var Ve;(Ve=this._tasks).push.apply(Ve,arguments),this.length+=arguments.length}else this._tasks.push(ze),this.length++;else if(Xe){if(He===1){var We=Array(1+arguments.length);We.push(We),We.push.apply(We,arguments),this._tasks=We}else{var We=Array(arguments.length);We.push.apply(We,arguments),this._tasks=We}this.length+=arguments.length}else He===1?this._tasks=[this._tasks,ze]:this._tasks=ze,this.length++}function o(ze,Xe){var He=this.length;if(He>1)if(Xe){var Ve;(Ve=this._tasks).push.apply(Ve,arguments),this.length+=arguments.length}else this._tasks.push(ze),this.length++;else if(Xe){if(He===1){var We=Array(1+arguments.length);We.push(We),We.push.apply(We,arguments),this._tasks=We}else{var We=Array(arguments.length);We.push.apply(We,arguments),this._tasks=We}this.length+=arguments.length}else He===1?this._tasks=[this._tasks,ze]:this._tasks=ze,this.length++;this.firstEmitBuildStrategy?this.call=L:this.rebuild()}function a(ze){this.length!==0&&(this.length===1?this._tasks===ze&&(this.length=0):((0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(ze)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function c(ze){if(this.length!==0){if(this.length===1)if(this._tasks===ze&&(this.length=0),this.firstEmitBuildStrategy){this.call=n.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(ze)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=L:this.rebuild()}}function f(ze){for(var Xe,He=[],Ve=1;Ve<arguments.length;Ve++)He[Ve-1]=arguments[Ve];this.length===0?(this._tasks=He,this.length=1):this.length===1?(He.unshift(this._tasks),this._tasks=He,this.length=this._tasks.length):((Xe=this._tasks).splice.apply(Xe,r([ze,0],He,!1)),this.length=this._tasks.length)}function g(ze){for(var Xe,He=[],Ve=1;Ve<arguments.length;Ve++)He[Ve-1]=arguments[Ve];this.length===0?(this._tasks=He,this.length=1):this.length===1?(He.unshift(this._tasks),this._tasks=He,this.length=this._tasks.length):((Xe=this._tasks).splice.apply(Xe,r([ze,0],He,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=L:this.rebuild()}function b(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollection)(this._tasks,this.argsNum)}function _(){this.length===0?this.call=n.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,n.bakeCollectionAwait)(this._tasks,this.argsNum)}function L(){this.rebuild(),this.call.apply(void 0,arguments)}var q=(function(){function ze(Xe,He,Ve,We){He===void 0&&(He=!0),Ve===void 0&&(Ve=null),We===void 0&&(We=!1),this.awaitTasks=We,this.call=n.BAKED_EMPTY_FUNC,this.argsNum=Xe,this.firstEmitBuildStrategy=!0,We?this.rebuild=_.bind(this):this.rebuild=b.bind(this),this.setAutoRebuild(He),Ve?typeof Ve=="function"?(this._tasks=Ve,this.length=1):(this._tasks=Ve,this.length=Ve.length):(this._tasks=null,this.length=0),He&&this.rebuild()}return ze})();taskCollection.TaskCollection=q;function X(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function te(){this._tasks=null,this.length=0,this.call=n.BAKED_EMPTY_FUNC}function ne(ze){this.argsNum<ze&&(this.argsNum=ze,this.firstEmitBuildStrategy?this.call=L:this.rebuild())}function Ce(ze){ze?(this.push=o.bind(this),this.insert=g.bind(this),this.removeLast=c.bind(this)):(this.push=s.bind(this),this.insert=f.bind(this),this.removeLast=a.bind(this))}function Le(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function Ge(ze){ze.length===0?(this.length=0,this.call=n.BAKED_EMPTY_FUNC):ze.length===1?(this.length=1,this.call=ze[0],this._tasks=ze[0]):(this.length=ze.length,this._tasks=ze,this.firstEmitBuildStrategy?this.call=L:this.rebuild())}return q.prototype.fastClear=X,q.prototype.clear=te,q.prototype.growArgsNum=ne,q.prototype.setAutoRebuild=Ce,q.prototype.tasksAsArray=Le,q.prototype.setTasks=Ge,taskCollection}var hasRequiredTaskCollection;function requireTaskCollection(){return hasRequiredTaskCollection||(hasRequiredTaskCollection=1,(function(r){var t=taskCollection$1&&taskCollection$1.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=taskCollection$1&&taskCollection$1.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireTaskCollection$1(),r)})(taskCollection$1)),taskCollection$1}var utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1,Object.defineProperty(utils,"__esModule",{value:!0}),utils.nullObj=void 0;function r(){var t={};return t.__proto__=null,t}return utils.nullObj=r,utils}var hasRequiredEe;function requireEe(){if(hasRequiredEe)return ee;hasRequiredEe=1;var r=ee&&ee.__spreadArray||function(He,Ve,We){if(We||arguments.length===2)for(var rt=0,st=Ve.length,ht;rt<st;rt++)(ht||!(rt in Ve))&&(ht||(ht=Array.prototype.slice.call(Ve,0,rt)),ht[rt]=Ve[rt]);return He.concat(ht||Array.prototype.slice.call(Ve))};Object.defineProperty(ee,"__esModule",{value:!0}),ee.EventEmitter=void 0;var t=requireTaskCollection(),n=requireUtils$1(),s=requireUtils();function o(He,Ve,We,rt,st,ht){var je=this.events[He];if(je){if(je.length===0)return!1;if(je.argsNum<6)je.call(Ve,We,rt,st,ht);else{for(var se=new Array(je.argsNum),m=0,A=se.length;m<A;++m)se[m]=arguments[m+1];je.call.apply(void 0,se)}return!0}return!1}function a(He,Ve,We,rt,st,ht){var je=this.events[He],se;if(je!==void 0){if(je.length===0)return!1;if(je.argsNum<6)je.call(Ve,We,rt,st,ht);else{se=new Array(je.argsNum);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1];je.call.apply(void 0,se)}}var k=this.onceEvents[He];if(k){if(typeof k=="function")if(this.onceEvents[He]=void 0,arguments.length<6)k(Ve,We,rt,st,ht);else{if(se===void 0){se=new Array(arguments.length-1);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1]}k.apply(void 0,se)}else{var Y=k;if(this.onceEvents[He]=void 0,arguments.length<6)for(var m=0;m<Y.length;++m)Y[m](Ve,We,rt,st,ht);else{if(se===void 0){se=new Array(arguments.length-1);for(var m=0,A=se.length;m<A;++m)se[m]=arguments[m+1]}for(var m=0;m<Y.length;++m)Y[m].apply(void 0,se)}}return!0}return je!==void 0}var c=(function(){function He(){this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(He.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),He})();ee.EventEmitter=c;function f(He,Ve){switch(this.emit===o&&(this.emit=a),typeof this.onceEvents[He]){case"undefined":this.onceEvents[He]=Ve,typeof He=="symbol"&&this._symbolKeys.add(He);break;case"function":this.onceEvents[He]=[this.onceEvents[He],Ve];break;case"object":this.onceEvents[He].push(Ve)}return this}function g(He,Ve,We){if(We===void 0&&(We=Ve.length),typeof Ve!="function")throw new TypeError("The listener must be a function");var rt=this.events[He];return rt?(rt.push(Ve),rt.growArgsNum(We),this.maxListeners!==1/0&&this.maxListeners<=rt.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" event!'))):(this.events[He]=new t.TaskCollection(We,!0,Ve,!1),typeof He=="symbol"&&this._symbolKeys.add(He)),this}function b(He,Ve){var We=this.events[He];We&&We.removeLast(Ve);var rt=this.onceEvents[He];return rt&&(typeof rt=="function"?this.onceEvents[He]=void 0:typeof rt=="object"&&(rt.length===1&&rt[0]===Ve?this.onceEvents[He]=void 0:(0,n._fast_remove_single)(rt,rt.lastIndexOf(Ve)))),this}function _(He,Ve,We,rt){We===void 0&&(We=this),rt===void 0&&(rt=Ve.length),this.boundFuncs||(this.boundFuncs=new Map);var st=Ve.bind(We);return this.boundFuncs.set(Ve,st),this.addListener(He,st,rt)}function L(He,Ve){var We,rt,st=(We=this.boundFuncs)===null||We===void 0?void 0:We.get(Ve);return(rt=this.boundFuncs)===null||rt===void 0||rt.delete(Ve),this.removeListener(He,st)}function q(He){return this.events[He]&&!!this.events[He].length}function X(He,Ve,We){if(We===void 0&&(We=Ve.length),typeof Ve!="function")throw new TypeError("The listener must be a function");var rt=this.events[He];return!rt||!(rt instanceof t.TaskCollection)?(rt=this.events[He]=new t.TaskCollection(We,!0,Ve,!1),typeof He=="symbol"&&this._symbolKeys.add(He)):(rt.insert(0,Ve),rt.growArgsNum(We),this.maxListeners!==1/0&&this.maxListeners<=rt.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" event!'))),this}function te(He,Ve){this.emit===o&&(this.emit=a);var We=this.onceEvents[He];return We?typeof We!="object"?(this.onceEvents[He]=[Ve,We],typeof He=="symbol"&&this._symbolKeys.add(He)):(We.unshift(Ve),this.maxListeners!==1/0&&this.maxListeners<=We.length&&console.warn('Maximum event listeners for "'.concat(String(He),'" once event!'))):(this.onceEvents[He]=[Ve],typeof He=="symbol"&&this._symbolKeys.add(He)),this}function ne(He){return He===void 0?(this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set):(this.events[He]=void 0,this.onceEvents[He]=void 0,typeof He=="symbol"&&this._symbolKeys.delete(He)),this}function Ce(He){return this.maxListeners=He,this}function Le(){return this.maxListeners}function Ge(He){return this.emit===o?this.events[He]?this.events[He].tasksAsArray().slice():[]:this.events[He]&&this.onceEvents[He]?r(r([],this.events[He].tasksAsArray(),!0),typeof this.onceEvents[He]=="function"?[this.onceEvents[He]]:this.onceEvents[He],!0):this.events[He]?this.events[He].tasksAsArray():this.onceEvents[He]?typeof this.onceEvents[He]=="function"?[this.onceEvents[He]]:this.onceEvents[He]:[]}function ze(){var He=this;if(this.emit===o){var Ve=Object.keys(this.events);return r(r([],Ve,!0),Array.from(this._symbolKeys),!0).filter(function(rt){return rt in He.events&&He.events[rt]&&He.events[rt].length})}else{var Ve=Object.keys(this.events).filter(function(st){return He.events[st]&&He.events[st].length}),We=Object.keys(this.onceEvents).filter(function(st){return He.onceEvents[st]&&He.onceEvents[st].length});return r(r(r([],Ve,!0),We,!0),Array.from(this._symbolKeys).filter(function(st){return st in He.events&&He.events[st]&&He.events[st].length||st in He.onceEvents&&He.onceEvents[st]&&He.onceEvents[st].length}),!0)}}function Xe(He){return this.emit===o?this.events[He]&&this.events[He].length||0:(this.events[He]&&this.events[He].length||0)+(this.onceEvents[He]&&this.onceEvents[He].length||0)}return c.prototype.emit=o,c.prototype.on=g,c.prototype.once=f,c.prototype.addListener=g,c.prototype.removeListener=b,c.prototype.addListenerBound=_,c.prototype.removeListenerBound=L,c.prototype.hasListeners=q,c.prototype.prependListener=X,c.prototype.prependOnceListener=te,c.prototype.off=b,c.prototype.removeAllListeners=ne,c.prototype.setMaxListeners=Ce,c.prototype.getMaxListeners=Le,c.prototype.listeners=Ge,c.prototype.eventNames=ze,c.prototype.listenerCount=Xe,ee}var hasRequiredLib$1;function requireLib$1(){return hasRequiredLib$1||(hasRequiredLib$1=1,(function(r){var t=lib$1&&lib$1.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=lib$1&&lib$1.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireTypes(),r),n(requireEe(),r)})(lib$1)),lib$1}var libExports=requireLib$1(),browser$1={exports:{}},ms$1,hasRequiredMs$1;function requireMs$1(){if(hasRequiredMs$1)return ms$1;hasRequiredMs$1=1;var r=1e3,t=r*60,n=t*60,s=n*24,o=s*7,a=s*365.25;ms$1=function(_,L){L=L||{};var q=typeof _;if(q==="string"&&_.length>0)return c(_);if(q==="number"&&isFinite(_))return L.long?g(_):f(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function c(_){if(_=String(_),!(_.length>100)){var L=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(L){var q=parseFloat(L[1]),X=(L[2]||"ms").toLowerCase();switch(X){case"years":case"year":case"yrs":case"yr":case"y":return q*a;case"weeks":case"week":case"w":return q*o;case"days":case"day":case"d":return q*s;case"hours":case"hour":case"hrs":case"hr":case"h":return q*n;case"minutes":case"minute":case"mins":case"min":case"m":return q*t;case"seconds":case"second":case"secs":case"sec":case"s":return q*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return q;default:return}}}}function f(_){var L=Math.abs(_);return L>=s?Math.round(_/s)+"d":L>=n?Math.round(_/n)+"h":L>=t?Math.round(_/t)+"m":L>=r?Math.round(_/r)+"s":_+"ms"}function g(_){var L=Math.abs(_);return L>=s?b(_,L,s,"day"):L>=n?b(_,L,n,"hour"):L>=t?b(_,L,t,"minute"):L>=r?b(_,L,r,"second"):_+" ms"}function b(_,L,q,X){var te=L>=q*1.5;return Math.round(_/q)+" "+X+(te?"s":"")}return ms$1}var common$1,hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;function r(t){s.debug=s,s.default=s,s.coerce=b,s.disable=f,s.enable=a,s.enabled=g,s.humanize=requireMs$1(),s.destroy=_,Object.keys(t).forEach(L=>{s[L]=t[L]}),s.names=[],s.skips=[],s.formatters={};function n(L){let q=0;for(let X=0;X<L.length;X++)q=(q<<5)-q+L.charCodeAt(X),q|=0;return s.colors[Math.abs(q)%s.colors.length]}s.selectColor=n;function s(L){let q,X=null,te,ne;function Ce(...Le){if(!Ce.enabled)return;const Ge=Ce,ze=Number(new Date),Xe=ze-(q||ze);Ge.diff=Xe,Ge.prev=q,Ge.curr=ze,q=ze,Le[0]=s.coerce(Le[0]),typeof Le[0]!="string"&&Le.unshift("%O");let He=0;Le[0]=Le[0].replace(/%([a-zA-Z%])/g,(We,rt)=>{if(We==="%%")return"%";He++;const st=s.formatters[rt];if(typeof st=="function"){const ht=Le[He];We=st.call(Ge,ht),Le.splice(He,1),He--}return We}),s.formatArgs.call(Ge,Le),(Ge.log||s.log).apply(Ge,Le)}return Ce.namespace=L,Ce.useColors=s.useColors(),Ce.color=s.selectColor(L),Ce.extend=o,Ce.destroy=s.destroy,Object.defineProperty(Ce,"enabled",{enumerable:!0,configurable:!1,get:()=>X!==null?X:(te!==s.namespaces&&(te=s.namespaces,ne=s.enabled(L)),ne),set:Le=>{X=Le}}),typeof s.init=="function"&&s.init(Ce),Ce}function o(L,q){const X=s(this.namespace+(typeof q>"u"?":":q)+L);return X.log=this.log,X}function a(L){s.save(L),s.namespaces=L,s.names=[],s.skips=[];const q=(typeof L=="string"?L:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const X of q)X[0]==="-"?s.skips.push(X.slice(1)):s.names.push(X)}function c(L,q){let X=0,te=0,ne=-1,Ce=0;for(;X<L.length;)if(te<q.length&&(q[te]===L[X]||q[te]==="*"))q[te]==="*"?(ne=te,Ce=X,te++):(X++,te++);else if(ne!==-1)te=ne+1,Ce++,X=Ce;else return!1;for(;te<q.length&&q[te]==="*";)te++;return te===q.length}function f(){const L=[...s.names,...s.skips.map(q=>"-"+q)].join(",");return s.enable(""),L}function g(L){for(const q of s.skips)if(c(L,q))return!1;for(const q of s.names)if(c(L,q))return!0;return!1}function b(L){return L instanceof Error?L.stack||L.message:L}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return common$1=r,common$1}var hasRequiredBrowser$1;function requireBrowser$1(){return hasRequiredBrowser$1||(hasRequiredBrowser$1=1,(function(r,t){var n={};t.formatArgs=o,t.save=a,t.load=c,t.useColors=s,t.storage=f(),t.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let b;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(b[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;b.splice(1,0,_,"color: inherit");let L=0,q=0;b[0].replace(/%[a-zA-Z%]/g,X=>{X!=="%%"&&(L++,X==="%c"&&(q=L))}),b.splice(q,0,_)}t.log=console.debug||console.log||(()=>{});function a(b){try{b?t.storage.setItem("debug",b):t.storage.removeItem("debug")}catch{}}function c(){let b;try{b=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=n.DEBUG),b}function f(){try{return localStorage}catch{}}r.exports=requireCommon$1()(t);const{formatters:g}=r.exports;g.j=function(b){try{return JSON.stringify(b)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}})(browser$1,browser$1.exports)),browser$1.exports}var browserExports$1=requireBrowser$1();const createDebug$1=getDefaultExportFromCjs(browserExports$1),crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function anumber(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function abytes(r,...t){if(!isBytes(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function ahash(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber(r.outputLen),anumber(r.blockLen)}function aexists(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function aoutput(r,t){abytes(r);const n=t.outputLen;if(r.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function clean(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}function createView(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function rotr(r,t){return r<<32-t|r>>>t}function rotl$1(r,t){return r<<t|r>>>32-t>>>0}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function bytesToHex(r){if(abytes(r),hasHexBuiltin)return r.toHex();let t="";for(let n=0;n<r.length;n++)t+=hexes[r[n]];return t}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(r){if(r>=asciis._0&&r<=asciis._9)return r-asciis._0;if(r>=asciis.A&&r<=asciis.F)return r-(asciis.A-10);if(r>=asciis.a&&r<=asciis.f)return r-(asciis.a-10)}function hexToBytes(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(hasHexBuiltin)return Uint8Array.fromHex(r);const t=r.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(n);for(let o=0,a=0;o<n;o++,a+=2){const c=asciiToBase16(r.charCodeAt(a)),f=asciiToBase16(r.charCodeAt(a+1));if(c===void 0||f===void 0){const g=r[a]+r[a+1];throw new Error('hex string expected, got non-hex character "'+g+'" at index '+a)}s[o]=c*16+f}return s}function utf8ToBytes(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function toBytes(r){return typeof r=="string"&&(r=utf8ToBytes(r)),abytes(r),r}function concatBytes(...r){let t=0;for(let s=0;s<r.length;s++){const o=r[s];abytes(o),t+=o.length}const n=new Uint8Array(t);for(let s=0,o=0;s<r.length;s++){const a=r[s];n.set(a,o),o+=a.length}return n}class Hash{}function createHasher(r){const t=s=>r().update(toBytes(s)).digest(),n=r();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>r(),t}function randomBytes(r=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(r));if(crypto$1&&typeof crypto$1.randomBytes=="function")return Uint8Array.from(crypto$1.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(r,t,n,s){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,n,s);const o=BigInt(32),a=BigInt(4294967295),c=Number(n>>o&a),f=Number(n&a),g=s?4:0,b=s?0:4;r.setUint32(t+g,c,s),r.setUint32(t+b,f,s)}function Chi(r,t,n){return r&t^~r&n}function Maj(r,t,n){return r&t^r&n^t&n}class HashMD extends Hash{constructor(t,n,s,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.buffer=new Uint8Array(t),this.view=createView(this.buffer)}update(t){aexists(this),t=toBytes(t),abytes(t);const{view:n,buffer:s,blockLen:o}=this,a=t.length;for(let c=0;c<a;){const f=Math.min(o-this.pos,a-c);if(f===o){const g=createView(t);for(;o<=a-c;c+=o)this.process(g,c);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,c+=f,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){aexists(this),aoutput(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:c}=this;n[c++]=128,clean(this.buffer.subarray(c)),this.padOffset>o-c&&(this.process(s,0),c=0);for(let L=c;L<o;L++)n[L]=0;setBigUint64(s,o-8,BigInt(this.length*8),a),this.process(s,0);const f=createView(t),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const b=g/4,_=this.get();if(b>_.length)throw new Error("_sha2: outputLen bigger than state");for(let L=0;L<b;L++)f.setUint32(4*L,_[L],a)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:a,destroyed:c,pos:f}=this;return t.destroyed=c,t.finished=a,t.length=o,t.pos=f,o%n&&t.buffer.set(s),t}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(r,t=!1){return t?{h:Number(r&U32_MASK64),l:Number(r>>_32n&U32_MASK64)}:{h:Number(r>>_32n&U32_MASK64)|0,l:Number(r&U32_MASK64)|0}}function split(r,t=!1){const n=r.length;let s=new Uint32Array(n),o=new Uint32Array(n);for(let a=0;a<n;a++){const{h:c,l:f}=fromBig(r[a],t);[s[a],o[a]]=[c,f]}return[s,o]}const shrSH=(r,t,n)=>r>>>n,shrSL=(r,t,n)=>r<<32-n|t>>>n,rotrSH=(r,t,n)=>r>>>n|t<<32-n,rotrSL=(r,t,n)=>r<<32-n|t>>>n,rotrBH=(r,t,n)=>r<<64-n|t>>>n-32,rotrBL=(r,t,n)=>r>>>n-32|t<<64-n;function add(r,t,n,s){const o=(t>>>0)+(s>>>0);return{h:r+n+(o/2**32|0)|0,l:o|0}}const add3L=(r,t,n)=>(r>>>0)+(t>>>0)+(n>>>0),add3H=(r,t,n,s)=>t+n+s+(r/2**32|0)|0,add4L=(r,t,n,s)=>(r>>>0)+(t>>>0)+(n>>>0)+(s>>>0),add4H=(r,t,n,s,o)=>t+n+s+o+(r/2**32|0)|0,add5L=(r,t,n,s,o)=>(r>>>0)+(t>>>0)+(n>>>0)+(s>>>0)+(o>>>0),add5H=(r,t,n,s,o,a)=>t+n+s+o+a+(r/2**32|0)|0,SHA256_K=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(t=32){super(64,t,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:t,B:n,C:s,D:o,E:a,F:c,G:f,H:g}=this;return[t,n,s,o,a,c,f,g]}set(t,n,s,o,a,c,f,g){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=a|0,this.F=c|0,this.G=f|0,this.H=g|0}process(t,n){for(let L=0;L<16;L++,n+=4)SHA256_W[L]=t.getUint32(n,!1);for(let L=16;L<64;L++){const q=SHA256_W[L-15],X=SHA256_W[L-2],te=rotr(q,7)^rotr(q,18)^q>>>3,ne=rotr(X,17)^rotr(X,19)^X>>>10;SHA256_W[L]=ne+SHA256_W[L-7]+te+SHA256_W[L-16]|0}let{A:s,B:o,C:a,D:c,E:f,F:g,G:b,H:_}=this;for(let L=0;L<64;L++){const q=rotr(f,6)^rotr(f,11)^rotr(f,25),X=_+q+Chi(f,g,b)+SHA256_K[L]+SHA256_W[L]|0,ne=(rotr(s,2)^rotr(s,13)^rotr(s,22))+Maj(s,o,a)|0;_=b,b=g,g=f,f=c+X|0,c=a,a=o,o=s,s=X+ne|0}s=s+this.A|0,o=o+this.B|0,a=a+this.C|0,c=c+this.D|0,f=f+this.E|0,g=g+this.F|0,b=b+this.G|0,_=_+this.H|0,this.set(s,o,a,c,f,g,b,_)}roundClean(){clean(SHA256_W)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}const K512=split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),SHA512_Kh=K512[0],SHA512_Kl=K512[1],SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends HashMD{constructor(t=64){super(128,t,16,!1),this.Ah=SHA512_IV[0]|0,this.Al=SHA512_IV[1]|0,this.Bh=SHA512_IV[2]|0,this.Bl=SHA512_IV[3]|0,this.Ch=SHA512_IV[4]|0,this.Cl=SHA512_IV[5]|0,this.Dh=SHA512_IV[6]|0,this.Dl=SHA512_IV[7]|0,this.Eh=SHA512_IV[8]|0,this.El=SHA512_IV[9]|0,this.Fh=SHA512_IV[10]|0,this.Fl=SHA512_IV[11]|0,this.Gh=SHA512_IV[12]|0,this.Gl=SHA512_IV[13]|0,this.Hh=SHA512_IV[14]|0,this.Hl=SHA512_IV[15]|0}get(){const{Ah:t,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:g,Eh:b,El:_,Fh:L,Fl:q,Gh:X,Gl:te,Hh:ne,Hl:Ce}=this;return[t,n,s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce]}set(t,n,s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce){this.Ah=t|0,this.Al=n|0,this.Bh=s|0,this.Bl=o|0,this.Ch=a|0,this.Cl=c|0,this.Dh=f|0,this.Dl=g|0,this.Eh=b|0,this.El=_|0,this.Fh=L|0,this.Fl=q|0,this.Gh=X|0,this.Gl=te|0,this.Hh=ne|0,this.Hl=Ce|0}process(t,n){for(let ze=0;ze<16;ze++,n+=4)SHA512_W_H[ze]=t.getUint32(n),SHA512_W_L[ze]=t.getUint32(n+=4);for(let ze=16;ze<80;ze++){const Xe=SHA512_W_H[ze-15]|0,He=SHA512_W_L[ze-15]|0,Ve=rotrSH(Xe,He,1)^rotrSH(Xe,He,8)^shrSH(Xe,He,7),We=rotrSL(Xe,He,1)^rotrSL(Xe,He,8)^shrSL(Xe,He,7),rt=SHA512_W_H[ze-2]|0,st=SHA512_W_L[ze-2]|0,ht=rotrSH(rt,st,19)^rotrBH(rt,st,61)^shrSH(rt,st,6),je=rotrSL(rt,st,19)^rotrBL(rt,st,61)^shrSL(rt,st,6),se=add4L(We,je,SHA512_W_L[ze-7],SHA512_W_L[ze-16]),m=add4H(se,Ve,ht,SHA512_W_H[ze-7],SHA512_W_H[ze-16]);SHA512_W_H[ze]=m|0,SHA512_W_L[ze]=se|0}let{Ah:s,Al:o,Bh:a,Bl:c,Ch:f,Cl:g,Dh:b,Dl:_,Eh:L,El:q,Fh:X,Fl:te,Gh:ne,Gl:Ce,Hh:Le,Hl:Ge}=this;for(let ze=0;ze<80;ze++){const Xe=rotrSH(L,q,14)^rotrSH(L,q,18)^rotrBH(L,q,41),He=rotrSL(L,q,14)^rotrSL(L,q,18)^rotrBL(L,q,41),Ve=L&X^~L&ne,We=q&te^~q&Ce,rt=add5L(Ge,He,We,SHA512_Kl[ze],SHA512_W_L[ze]),st=add5H(rt,Le,Xe,Ve,SHA512_Kh[ze],SHA512_W_H[ze]),ht=rt|0,je=rotrSH(s,o,28)^rotrBH(s,o,34)^rotrBH(s,o,39),se=rotrSL(s,o,28)^rotrBL(s,o,34)^rotrBL(s,o,39),m=s&a^s&f^a&f,A=o&c^o&g^c&g;Le=ne|0,Ge=Ce|0,ne=X|0,Ce=te|0,X=L|0,te=q|0,{h:L,l:q}=add(b|0,_|0,st|0,ht|0),b=f|0,_=g|0,f=a|0,g=c|0,a=s|0,c=o|0;const k=add3L(ht,se,A);s=add3H(k,st,je,m),o=k|0}({h:s,l:o}=add(this.Ah|0,this.Al|0,s|0,o|0)),{h:a,l:c}=add(this.Bh|0,this.Bl|0,a|0,c|0),{h:f,l:g}=add(this.Ch|0,this.Cl|0,f|0,g|0),{h:b,l:_}=add(this.Dh|0,this.Dl|0,b|0,_|0),{h:L,l:q}=add(this.Eh|0,this.El|0,L|0,q|0),{h:X,l:te}=add(this.Fh|0,this.Fl|0,X|0,te|0),{h:ne,l:Ce}=add(this.Gh|0,this.Gl|0,ne|0,Ce|0),{h:Le,l:Ge}=add(this.Hh|0,this.Hl|0,Le|0,Ge|0),this.set(s,o,a,c,f,g,b,_,L,q,X,te,ne,Ce,Le,Ge)}roundClean(){clean(SHA512_W_H,SHA512_W_L)}destroy(){clean(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha256$1=createHasher(()=>new SHA256),sha512=createHasher(()=>new SHA512);class HMAC extends Hash{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ahash(t);const s=toBytes(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,a=new Uint8Array(o);a.set(s.length>o?t.create().update(s).digest():s);for(let c=0;c<a.length;c++)a[c]^=54;this.iHash.update(a),this.oHash=t.create();for(let c=0;c<a.length;c++)a[c]^=106;this.oHash.update(a),clean(a)}update(t){return aexists(this),this.iHash.update(t),this}digestInto(t){aexists(this),abytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:o,destroyed:a,blockLen:c,outputLen:f}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=c,t.outputLen=f,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(r,t,n)=>new HMAC(r,t).update(n).digest();hmac.create=(r,t)=>new HMAC(r,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1);function _abool2(r,t=""){if(typeof r!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof r)}return r}function _abytes2(r,t,n=""){const s=isBytes(r),o=r?.length,a=t!==void 0;if(!s||a&&o!==t){const c=n&&`"${n}" `,f=a?` of length ${t}`:"",g=s?`length=${o}`:`type=${typeof r}`;throw new Error(c+"expected Uint8Array"+f+", got "+g)}return r}function numberToHexUnpadded(r){const t=r.toString(16);return t.length&1?"0"+t:t}function hexToNumber(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?_0n$4:BigInt("0x"+r)}function bytesToNumberBE(r){return hexToNumber(bytesToHex(r))}function bytesToNumberLE(r){return abytes(r),hexToNumber(bytesToHex(Uint8Array.from(r).reverse()))}function numberToBytesBE(r,t){return hexToBytes(r.toString(16).padStart(t*2,"0"))}function numberToBytesLE(r,t){return numberToBytesBE(r,t).reverse()}function ensureBytes(r,t,n){let s;if(typeof t=="string")try{s=hexToBytes(t)}catch(a){throw new Error(r+" must be hex string or Uint8Array, cause: "+a)}else if(isBytes(t))s=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");const o=s.length;if(typeof n=="number"&&o!==n)throw new Error(r+" of length "+n+" expected, got "+o);return s}const isPosBig=r=>typeof r=="bigint"&&_0n$4<=r;function inRange(r,t,n){return isPosBig(r)&&isPosBig(t)&&isPosBig(n)&&t<=r&&r<n}function aInRange(r,t,n,s){if(!inRange(t,n,s))throw new Error("expected valid "+r+": "+n+" <= n < "+s+", got "+t)}function bitLen(r){let t;for(t=0;r>_0n$4;r>>=_1n$4,t+=1);return t}const bitMask=r=>(_1n$4<<BigInt(r))-_1n$4;function createHmacDrbg(r,t,n){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const s=X=>new Uint8Array(X),o=X=>Uint8Array.of(X);let a=s(r),c=s(r),f=0;const g=()=>{a.fill(1),c.fill(0),f=0},b=(...X)=>n(c,a,...X),_=(X=s(0))=>{c=b(o(0),X),a=b(),X.length!==0&&(c=b(o(1),X),a=b())},L=()=>{if(f++>=1e3)throw new Error("drbg: tried 1000 values");let X=0;const te=[];for(;X<t;){a=b();const ne=a.slice();te.push(ne),X+=a.length}return concatBytes(...te)};return(X,te)=>{g(),_(X);let ne;for(;!(ne=te(L()));)_();return g(),ne}}function _validateObject(r,t,n={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function s(o,a,c){const f=r[o];if(c&&f===void 0)return;const g=typeof f;if(g!==a||f===null)throw new Error(`param "${o}" is invalid: expected ${a}, got ${g}`)}Object.entries(t).forEach(([o,a])=>s(o,a,!1)),Object.entries(n).forEach(([o,a])=>s(o,a,!0))}function memoized(r){const t=new WeakMap;return(n,...s)=>{const o=t.get(n);if(o!==void 0)return o;const a=r(n,...s);return t.set(n,a),a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$2=BigInt(2),_3n$1=BigInt(3),_4n$1=BigInt(4),_5n=BigInt(5),_7n=BigInt(7),_8n=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod(r,t){const n=r%t;return n>=_0n$3?n:t+n}function pow2(r,t,n){let s=r;for(;t-- >_0n$3;)s*=s,s%=n;return s}function invert(r,t){if(r===_0n$3)throw new Error("invert: expected non-zero number");if(t<=_0n$3)throw new Error("invert: expected positive modulus, got "+t);let n=mod(r,t),s=t,o=_0n$3,a=_1n$3;for(;n!==_0n$3;){const f=s/n,g=s%n,b=o-a*f;s=n,n=g,o=a,a=b}if(s!==_1n$3)throw new Error("invert: does not exist");return mod(o,t)}function assertIsSquare(r,t,n){if(!r.eql(r.sqr(t),n))throw new Error("Cannot find square root")}function sqrt3mod4(r,t){const n=(r.ORDER+_1n$3)/_4n$1,s=r.pow(t,n);return assertIsSquare(r,s,t),s}function sqrt5mod8(r,t){const n=(r.ORDER-_5n)/_8n,s=r.mul(t,_2n$2),o=r.pow(s,n),a=r.mul(t,o),c=r.mul(r.mul(a,_2n$2),o),f=r.mul(a,r.sub(c,r.ONE));return assertIsSquare(r,f,t),f}function sqrt9mod16(r){const t=Field(r),n=tonelliShanks(r),s=n(t,t.neg(t.ONE)),o=n(t,s),a=n(t,t.neg(s)),c=(r+_7n)/_16n;return(f,g)=>{let b=f.pow(g,c),_=f.mul(b,s);const L=f.mul(b,o),q=f.mul(b,a),X=f.eql(f.sqr(_),g),te=f.eql(f.sqr(L),g);b=f.cmov(b,_,X),_=f.cmov(q,L,te);const ne=f.eql(f.sqr(_),g),Ce=f.cmov(b,_,ne);return assertIsSquare(f,Ce,g),Ce}}function tonelliShanks(r){if(r<_3n$1)throw new Error("sqrt is not defined for small field");let t=r-_1n$3,n=0;for(;t%_2n$2===_0n$3;)t/=_2n$2,n++;let s=_2n$2;const o=Field(r);for(;FpLegendre(o,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return sqrt3mod4;let a=o.pow(s,t);const c=(t+_1n$3)/_2n$2;return function(g,b){if(g.is0(b))return b;if(FpLegendre(g,b)!==1)throw new Error("Cannot find square root");let _=n,L=g.mul(g.ONE,a),q=g.pow(b,t),X=g.pow(b,c);for(;!g.eql(q,g.ONE);){if(g.is0(q))return g.ZERO;let te=1,ne=g.sqr(q);for(;!g.eql(ne,g.ONE);)if(te++,ne=g.sqr(ne),te===_)throw new Error("Cannot find square root");const Ce=_1n$3<<BigInt(_-te-1),Le=g.pow(L,Ce);_=te,L=g.sqr(Le),q=g.mul(q,L),X=g.mul(X,Le)}return X}}function FpSqrt(r){return r%_4n$1===_3n$1?sqrt3mod4:r%_8n===_5n?sqrt5mod8:r%_16n===_9n?sqrt9mod16(r):tonelliShanks(r)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(r){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=FIELD_FIELDS.reduce((s,o)=>(s[o]="function",s),t);return _validateObject(r,n),r}function FpPow(r,t,n){if(n<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(n===_0n$3)return r.ONE;if(n===_1n$3)return t;let s=r.ONE,o=t;for(;n>_0n$3;)n&_1n$3&&(s=r.mul(s,o)),o=r.sqr(o),n>>=_1n$3;return s}function FpInvertBatch(r,t,n=!1){const s=new Array(t.length).fill(n?r.ZERO:void 0),o=t.reduce((c,f,g)=>r.is0(f)?c:(s[g]=c,r.mul(c,f)),r.ONE),a=r.inv(o);return t.reduceRight((c,f,g)=>r.is0(f)?c:(s[g]=r.mul(c,s[g]),r.mul(c,f)),a),s}function FpLegendre(r,t){const n=(r.ORDER-_1n$3)/_2n$2,s=r.pow(t,n),o=r.eql(s,r.ONE),a=r.eql(s,r.ZERO),c=r.eql(s,r.neg(r.ONE));if(!o&&!a&&!c)throw new Error("invalid Legendre symbol result");return o?1:a?0:-1}function nLength(r,t){t!==void 0&&anumber(t);const n=t!==void 0?t:r.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field(r,t,n=!1,s={}){if(r<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,a,c=!1,f;if(typeof t=="object"&&t!=null){if(s.sqrt||n)throw new Error("cannot specify opts in two arguments");const q=t;q.BITS&&(o=q.BITS),q.sqrt&&(a=q.sqrt),typeof q.isLE=="boolean"&&(n=q.isLE),typeof q.modFromBytes=="boolean"&&(c=q.modFromBytes),f=q.allowedLengths}else typeof t=="number"&&(o=t),s.sqrt&&(a=s.sqrt);const{nBitLength:g,nByteLength:b}=nLength(r,o);if(b>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let _;const L=Object.freeze({ORDER:r,isLE:n,BITS:g,BYTES:b,MASK:bitMask(g),ZERO:_0n$3,ONE:_1n$3,allowedLengths:f,create:q=>mod(q,r),isValid:q=>{if(typeof q!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof q);return _0n$3<=q&&q<r},is0:q=>q===_0n$3,isValidNot0:q=>!L.is0(q)&&L.isValid(q),isOdd:q=>(q&_1n$3)===_1n$3,neg:q=>mod(-q,r),eql:(q,X)=>q===X,sqr:q=>mod(q*q,r),add:(q,X)=>mod(q+X,r),sub:(q,X)=>mod(q-X,r),mul:(q,X)=>mod(q*X,r),pow:(q,X)=>FpPow(L,q,X),div:(q,X)=>mod(q*invert(X,r),r),sqrN:q=>q*q,addN:(q,X)=>q+X,subN:(q,X)=>q-X,mulN:(q,X)=>q*X,inv:q=>invert(q,r),sqrt:a||(q=>(_||(_=FpSqrt(r)),_(L,q))),toBytes:q=>n?numberToBytesLE(q,b):numberToBytesBE(q,b),fromBytes:(q,X=!0)=>{if(f){if(!f.includes(q.length)||q.length>b)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+q.length);const ne=new Uint8Array(b);ne.set(q,n?0:ne.length-q.length),q=ne}if(q.length!==b)throw new Error("Field.fromBytes: expected "+b+" bytes, got "+q.length);let te=n?bytesToNumberLE(q):bytesToNumberBE(q);if(c&&(te=mod(te,r)),!X&&!L.isValid(te))throw new Error("invalid field element: outside of range 0..ORDER");return te},invertBatch:q=>FpInvertBatch(L,q),cmov:(q,X,te)=>te?X:q});return Object.freeze(L)}function getFieldBytesLength(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const t=r.toString(2).length;return Math.ceil(t/8)}function getMinHashLength(r){const t=getFieldBytesLength(r);return t+Math.ceil(t/2)}function mapHashToField(r,t,n=!1){const s=r.length,o=getFieldBytesLength(t),a=getMinHashLength(t);if(s<16||s<a||s>1024)throw new Error("expected "+a+"-1024 bytes of input, got "+s);const c=n?bytesToNumberLE(r):bytesToNumberBE(r),f=mod(c,t-_1n$3)+_1n$3;return n?numberToBytesLE(f,o):numberToBytesBE(f,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function negateCt(r,t){const n=t.negate();return r?n:t}function normalizeZ(r,t){const n=FpInvertBatch(r.Fp,t.map(s=>s.Z));return t.map((s,o)=>r.fromAffine(s.toAffine(n[o])))}function validateW(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function calcWOpts(r,t){validateW(r,t);const n=Math.ceil(t/r)+1,s=2**(r-1),o=2**r,a=bitMask(r),c=BigInt(r);return{windows:n,windowSize:s,mask:a,maxNumber:o,shiftBy:c}}function calcOffsets(r,t,n){const{windowSize:s,mask:o,maxNumber:a,shiftBy:c}=n;let f=Number(r&o),g=r>>c;f>s&&(f-=a,g+=_1n$2);const b=t*s,_=b+Math.abs(f)-1,L=f===0,q=f<0,X=t%2!==0;return{nextN:g,offset:_,isZero:L,isNeg:q,isNegF:X,offsetF:b}}function validateMSMPoints(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((n,s)=>{if(!(n instanceof t))throw new Error("invalid point at index "+s)})}function validateMSMScalars(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((n,s)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+s)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(r){return pointWindowSizes.get(r)||1}function assert0(r){if(r!==_0n$2)throw new Error("invalid wNAF")}class wNAF{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,s=this.ZERO){let o=t;for(;n>_0n$2;)n&_1n$2&&(s=s.add(o)),o=o.double(),n>>=_1n$2;return s}precomputeWindow(t,n){const{windows:s,windowSize:o}=calcWOpts(n,this.bits),a=[];let c=t,f=c;for(let g=0;g<s;g++){f=c,a.push(f);for(let b=1;b<o;b++)f=f.add(c),a.push(f);c=f.double()}return a}wNAF(t,n,s){if(!this.Fn.isValid(s))throw new Error("invalid scalar");let o=this.ZERO,a=this.BASE;const c=calcWOpts(t,this.bits);for(let f=0;f<c.windows;f++){const{nextN:g,offset:b,isZero:_,isNeg:L,isNegF:q,offsetF:X}=calcOffsets(s,f,c);s=g,_?a=a.add(negateCt(q,n[X])):o=o.add(negateCt(L,n[b]))}return assert0(s),{p:o,f:a}}wNAFUnsafe(t,n,s,o=this.ZERO){const a=calcWOpts(t,this.bits);for(let c=0;c<a.windows&&s!==_0n$2;c++){const{nextN:f,offset:g,isZero:b,isNeg:_}=calcOffsets(s,c,a);if(s=f,!b){const L=n[g];o=o.add(_?L.negate():L)}}return assert0(s),o}getPrecomputes(t,n,s){let o=pointPrecomputes.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof s=="function"&&(o=s(o)),pointPrecomputes.set(n,o))),o}cached(t,n,s){const o=getW(t);return this.wNAF(o,this.getPrecomputes(o,t,s),n)}unsafe(t,n,s,o){const a=getW(t);return a===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),n,o)}createCache(t,n){validateW(n,this.bits),pointWindowSizes.set(t,n),pointPrecomputes.delete(t)}hasCache(t){return getW(t)!==1}}function mulEndoUnsafe(r,t,n,s){let o=t,a=r.ZERO,c=r.ZERO;for(;n>_0n$2||s>_0n$2;)n&_1n$2&&(a=a.add(o)),s&_1n$2&&(c=c.add(o)),o=o.double(),n>>=_1n$2,s>>=_1n$2;return{p1:a,p2:c}}function pippenger(r,t,n,s){validateMSMPoints(n,r),validateMSMScalars(s,t);const o=n.length,a=s.length;if(o!==a)throw new Error("arrays of points and scalars must have equal length");const c=r.ZERO,f=bitLen(BigInt(o));let g=1;f>12?g=f-3:f>4?g=f-2:f>0&&(g=2);const b=bitMask(g),_=new Array(Number(b)+1).fill(c),L=Math.floor((t.BITS-1)/g)*g;let q=c;for(let X=L;X>=0;X-=g){_.fill(c);for(let ne=0;ne<a;ne++){const Ce=s[ne],Le=Number(Ce>>BigInt(X)&b);_[Le]=_[Le].add(n[ne])}let te=c;for(let ne=_.length-1,Ce=c;ne>0;ne--)Ce=Ce.add(_[ne]),te=te.add(Ce);if(q=q.add(te),X!==0)for(let ne=0;ne<g;ne++)q=q.double()}return q}function createField(r,t,n){if(t){if(t.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField(t),t}else return Field(r,{isLE:n})}function _createCurveFields(r,t,n={},s){if(s===void 0&&(s=r==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${r} CURVE object`);for(const g of["p","n","h"]){const b=t[g];if(!(typeof b=="bigint"&&b>_0n$2))throw new Error(`CURVE.${g} must be positive bigint`)}const o=createField(t.p,n.Fp,s),a=createField(t.n,n.Fn,s),f=["Gx","Gy","a","b"];for(const g of f)if(!o.isValid(t[g]))throw new Error(`CURVE.${g} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:a}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const divNearest=(r,t)=>(r+(r>=0?t:-t)/_2n$1)/t;function _splitEndoScalar(r,t,n){const[[s,o],[a,c]]=t,f=divNearest(c*r,n),g=divNearest(-o*r,n);let b=r-f*s-g*a,_=-f*o-g*c;const L=b<_0n$1,q=_<_0n$1;L&&(b=-b),q&&(_=-_);const X=bitMask(Math.ceil(bitLen(n)/2))+_1n$1;if(b<_0n$1||b>=X||_<_0n$1||_>=X)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:L,k1:b,k2neg:q,k2:_}}function validateSigFormat(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function validateSigOpts(r,t){const n={};for(let s of Object.keys(t))n[s]=r[s]===void 0?t[s]:r[s];return _abool2(n.lowS,"lowS"),_abool2(n.prehash,"prehash"),n.format!==void 0&&validateSigFormat(n.format),n}class DERErr extends Error{constructor(t=""){super(t)}}const DER={Err:DERErr,_tlv:{encode:(r,t)=>{const{Err:n}=DER;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const s=t.length/2,o=numberToHexUnpadded(s);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const a=s>127?numberToHexUnpadded(o.length/2|128):"";return numberToHexUnpadded(r)+a+o+t},decode(r,t){const{Err:n}=DER;let s=0;if(r<0||r>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[s++]!==r)throw new n("tlv.decode: wrong tlv");const o=t[s++],a=!!(o&128);let c=0;if(!a)c=o;else{const g=o&127;if(!g)throw new n("tlv.decode(long): indefinite length not supported");if(g>4)throw new n("tlv.decode(long): byte length is too big");const b=t.subarray(s,s+g);if(b.length!==g)throw new n("tlv.decode: length bytes not complete");if(b[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const _ of b)c=c<<8|_;if(s+=g,c<128)throw new n("tlv.decode(long): not minimal encoding")}const f=t.subarray(s,s+c);if(f.length!==c)throw new n("tlv.decode: wrong value length");return{v:f,l:t.subarray(s+c)}}},_int:{encode(r){const{Err:t}=DER;if(r<_0n$1)throw new t("integer: negative integers are not allowed");let n=numberToHexUnpadded(r);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(r){const{Err:t}=DER;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE(r)}},toSig(r){const{Err:t,_int:n,_tlv:s}=DER,o=ensureBytes("signature",r),{v:a,l:c}=s.decode(48,o);if(c.length)throw new t("invalid signature: left bytes after parsing");const{v:f,l:g}=s.decode(2,a),{v:b,l:_}=s.decode(2,g);if(_.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(f),s:n.decode(b)}},hexFromSig(r){const{_tlv:t,_int:n}=DER,s=t.encode(2,n.encode(r.r)),o=t.encode(2,n.encode(r.s)),a=s+o;return t.encode(48,a)}},_0n$1=BigInt(0),_1n$1=BigInt(1),_2n$1=BigInt(2),_3n=BigInt(3),_4n=BigInt(4);function _normFnElement(r,t){const{BYTES:n}=r;let s;if(typeof t=="bigint")s=t;else{let o=ensureBytes("private key",t);try{s=r.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}function weierstrassN(r,t={}){const n=_createCurveFields("weierstrass",r,t),{Fp:s,Fn:o}=n;let a=n.CURVE;const{h:c,n:f}=a;_validateObject(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:g}=t;if(g&&(!s.is0(a.a)||typeof g.beta!="bigint"||!Array.isArray(g.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const b=getWLengths(s,o);function _(){if(!s.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function L(se,m,A){const{x:k,y:Y}=m.toAffine(),Q=s.toBytes(k);if(_abool2(A,"isCompressed"),A){_();const $e=!s.isOdd(Y);return concatBytes(pprefix($e),Q)}else return concatBytes(Uint8Array.of(4),Q,s.toBytes(Y))}function q(se){_abytes2(se,void 0,"Point");const{publicKey:m,publicKeyUncompressed:A}=b,k=se.length,Y=se[0],Q=se.subarray(1);if(k===m&&(Y===2||Y===3)){const $e=s.fromBytes(Q);if(!s.isValid($e))throw new Error("bad point: is not on curve, wrong x");const ve=ne($e);let re;try{re=s.sqrt(ve)}catch(Ue){const Ze=Ue instanceof Error?": "+Ue.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ze)}_();const B=s.isOdd(re);return(Y&1)===1!==B&&(re=s.neg(re)),{x:$e,y:re}}else if(k===A&&Y===4){const $e=s.BYTES,ve=s.fromBytes(Q.subarray(0,$e)),re=s.fromBytes(Q.subarray($e,$e*2));if(!Ce(ve,re))throw new Error("bad point: is not on curve");return{x:ve,y:re}}else throw new Error(`bad point: got length ${k}, expected compressed=${m} or uncompressed=${A}`)}const X=t.toBytes||L,te=t.fromBytes||q;function ne(se){const m=s.sqr(se),A=s.mul(m,se);return s.add(s.add(A,s.mul(se,a.a)),a.b)}function Ce(se,m){const A=s.sqr(m),k=ne(se);return s.eql(A,k)}if(!Ce(a.Gx,a.Gy))throw new Error("bad curve params: generator point");const Le=s.mul(s.pow(a.a,_3n),_4n),Ge=s.mul(s.sqr(a.b),BigInt(27));if(s.is0(s.add(Le,Ge)))throw new Error("bad curve params: a or b");function ze(se,m,A=!1){if(!s.isValid(m)||A&&s.is0(m))throw new Error(`bad point coordinate ${se}`);return m}function Xe(se){if(!(se instanceof st))throw new Error("ProjectivePoint expected")}function He(se){if(!g||!g.basises)throw new Error("no endo");return _splitEndoScalar(se,g.basises,o.ORDER)}const Ve=memoized((se,m)=>{const{X:A,Y:k,Z:Y}=se;if(s.eql(Y,s.ONE))return{x:A,y:k};const Q=se.is0();m==null&&(m=Q?s.ONE:s.inv(Y));const $e=s.mul(A,m),ve=s.mul(k,m),re=s.mul(Y,m);if(Q)return{x:s.ZERO,y:s.ZERO};if(!s.eql(re,s.ONE))throw new Error("invZ was invalid");return{x:$e,y:ve}}),We=memoized(se=>{if(se.is0()){if(t.allowInfinityPoint&&!s.is0(se.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:A}=se.toAffine();if(!s.isValid(m)||!s.isValid(A))throw new Error("bad point: x or y not field elements");if(!Ce(m,A))throw new Error("bad point: equation left != right");if(!se.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function rt(se,m,A,k,Y){return A=new st(s.mul(A.X,se),A.Y,A.Z),m=negateCt(k,m),A=negateCt(Y,A),m.add(A)}class st{constructor(m,A,k){this.X=ze("x",m),this.Y=ze("y",A,!0),this.Z=ze("z",k),Object.freeze(this)}static CURVE(){return a}static fromAffine(m){const{x:A,y:k}=m||{};if(!m||!s.isValid(A)||!s.isValid(k))throw new Error("invalid affine point");if(m instanceof st)throw new Error("projective point not allowed");return s.is0(A)&&s.is0(k)?st.ZERO:new st(A,k,s.ONE)}static fromBytes(m){const A=st.fromAffine(te(_abytes2(m,void 0,"point")));return A.assertValidity(),A}static fromHex(m){return st.fromBytes(ensureBytes("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,A=!0){return je.createCache(this,m),A||this.multiply(_3n),this}assertValidity(){We(this)}hasEvenY(){const{y:m}=this.toAffine();if(!s.isOdd)throw new Error("Field doesn't support isOdd");return!s.isOdd(m)}equals(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m,re=s.eql(s.mul(A,ve),s.mul(Q,Y)),B=s.eql(s.mul(k,ve),s.mul($e,Y));return re&&B}negate(){return new st(this.X,s.neg(this.Y),this.Z)}double(){const{a:m,b:A}=a,k=s.mul(A,_3n),{X:Y,Y:Q,Z:$e}=this;let ve=s.ZERO,re=s.ZERO,B=s.ZERO,oe=s.mul(Y,Y),Ue=s.mul(Q,Q),Ze=s.mul($e,$e),lt=s.mul(Y,Q);return lt=s.add(lt,lt),B=s.mul(Y,$e),B=s.add(B,B),ve=s.mul(m,B),re=s.mul(k,Ze),re=s.add(ve,re),ve=s.sub(Ue,re),re=s.add(Ue,re),re=s.mul(ve,re),ve=s.mul(lt,ve),B=s.mul(k,B),Ze=s.mul(m,Ze),lt=s.sub(oe,Ze),lt=s.mul(m,lt),lt=s.add(lt,B),B=s.add(oe,oe),oe=s.add(B,oe),oe=s.add(oe,Ze),oe=s.mul(oe,lt),re=s.add(re,oe),Ze=s.mul(Q,$e),Ze=s.add(Ze,Ze),oe=s.mul(Ze,lt),ve=s.sub(ve,oe),B=s.mul(Ze,Ue),B=s.add(B,B),B=s.add(B,B),new st(ve,re,B)}add(m){Xe(m);const{X:A,Y:k,Z:Y}=this,{X:Q,Y:$e,Z:ve}=m;let re=s.ZERO,B=s.ZERO,oe=s.ZERO;const Ue=a.a,Ze=s.mul(a.b,_3n);let lt=s.mul(A,Q),St=s.mul(k,$e),Mt=s.mul(Y,ve),Ft=s.add(A,k),Zt=s.add(Q,$e);Ft=s.mul(Ft,Zt),Zt=s.add(lt,St),Ft=s.sub(Ft,Zt),Zt=s.add(A,Y);let Ut=s.add(Q,ve);return Zt=s.mul(Zt,Ut),Ut=s.add(lt,Mt),Zt=s.sub(Zt,Ut),Ut=s.add(k,Y),re=s.add($e,ve),Ut=s.mul(Ut,re),re=s.add(St,Mt),Ut=s.sub(Ut,re),oe=s.mul(Ue,Zt),re=s.mul(Ze,Mt),oe=s.add(re,oe),re=s.sub(St,oe),oe=s.add(St,oe),B=s.mul(re,oe),St=s.add(lt,lt),St=s.add(St,lt),Mt=s.mul(Ue,Mt),Zt=s.mul(Ze,Zt),St=s.add(St,Mt),Mt=s.sub(lt,Mt),Mt=s.mul(Ue,Mt),Zt=s.add(Zt,Mt),lt=s.mul(St,Zt),B=s.add(B,lt),lt=s.mul(Ut,Zt),re=s.mul(Ft,re),re=s.sub(re,lt),lt=s.mul(Ft,St),oe=s.mul(Ut,oe),oe=s.add(oe,lt),new st(re,B,oe)}subtract(m){return this.add(m.negate())}is0(){return this.equals(st.ZERO)}multiply(m){const{endo:A}=t;if(!o.isValidNot0(m))throw new Error("invalid scalar: out of range");let k,Y;const Q=$e=>je.cached(this,$e,ve=>normalizeZ(st,ve));if(A){const{k1neg:$e,k1:ve,k2neg:re,k2:B}=He(m),{p:oe,f:Ue}=Q(ve),{p:Ze,f:lt}=Q(B);Y=Ue.add(lt),k=rt(A.beta,oe,Ze,$e,re)}else{const{p:$e,f:ve}=Q(m);k=$e,Y=ve}return normalizeZ(st,[k,Y])[0]}multiplyUnsafe(m){const{endo:A}=t,k=this;if(!o.isValid(m))throw new Error("invalid scalar: out of range");if(m===_0n$1||k.is0())return st.ZERO;if(m===_1n$1)return k;if(je.hasCache(this))return this.multiply(m);if(A){const{k1neg:Y,k1:Q,k2neg:$e,k2:ve}=He(m),{p1:re,p2:B}=mulEndoUnsafe(st,k,Q,ve);return rt(A.beta,re,B,Y,$e)}else return je.unsafe(k,m)}multiplyAndAddUnsafe(m,A,k){const Y=this.multiplyUnsafe(A).add(m.multiplyUnsafe(k));return Y.is0()?void 0:Y}toAffine(m){return Ve(this,m)}isTorsionFree(){const{isTorsionFree:m}=t;return c===_1n$1?!0:m?m(st,this):je.unsafe(this,f).is0()}clearCofactor(){const{clearCofactor:m}=t;return c===_1n$1?this:m?m(st,this):this.multiplyUnsafe(c)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}toBytes(m=!0){return _abool2(m,"isCompressed"),this.assertValidity(),X(st,this,m)}toHex(m=!0){return bytesToHex(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return normalizeZ(st,m)}static msm(m,A){return pippenger(st,o,m,A)}static fromPrivateKey(m){return st.BASE.multiply(_normFnElement(o,m))}}st.BASE=new st(a.Gx,a.Gy,s.ONE),st.ZERO=new st(s.ZERO,s.ONE,s.ZERO),st.Fp=s,st.Fn=o;const ht=o.BITS,je=new wNAF(st,t.endo?Math.ceil(ht/2):ht);return st.BASE.precompute(8),st}function pprefix(r){return Uint8Array.of(r?2:3)}function getWLengths(r,t){return{secretKey:t.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ecdh(r,t={}){const{Fn:n}=r,s=t.randomBytes||randomBytes,o=Object.assign(getWLengths(r.Fp,n),{seed:getMinHashLength(n.ORDER)});function a(X){try{return!!_normFnElement(n,X)}catch{return!1}}function c(X,te){const{publicKey:ne,publicKeyUncompressed:Ce}=o;try{const Le=X.length;return te===!0&&Le!==ne||te===!1&&Le!==Ce?!1:!!r.fromBytes(X)}catch{return!1}}function f(X=s(o.seed)){return mapHashToField(_abytes2(X,o.seed,"seed"),n.ORDER)}function g(X,te=!0){return r.BASE.multiply(_normFnElement(n,X)).toBytes(te)}function b(X){const te=f(X);return{secretKey:te,publicKey:g(te)}}function _(X){if(typeof X=="bigint")return!1;if(X instanceof r)return!0;const{secretKey:te,publicKey:ne,publicKeyUncompressed:Ce}=o;if(n.allowedLengths||te===ne)return;const Le=ensureBytes("key",X).length;return Le===ne||Le===Ce}function L(X,te,ne=!0){if(_(X)===!0)throw new Error("first arg must be private key");if(_(te)===!1)throw new Error("second arg must be public key");const Ce=_normFnElement(n,X);return r.fromHex(te).multiply(Ce).toBytes(ne)}return Object.freeze({getPublicKey:g,getSharedSecret:L,keygen:b,Point:r,utils:{isValidSecretKey:a,isValidPublicKey:c,randomSecretKey:f,isValidPrivateKey:a,randomPrivateKey:f,normPrivateKeyToScalar:X=>_normFnElement(n,X),precompute(X=8,te=r.BASE){return te.precompute(X,!1)}},lengths:o})}function ecdsa(r,t,n={}){ahash(t),_validateObject(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const s=n.randomBytes||randomBytes,o=n.hmac||((A,...k)=>hmac(t,A,concatBytes(...k))),{Fp:a,Fn:c}=r,{ORDER:f,BITS:g}=c,{keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X}=ecdh(r,n),te={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},ne="compact";function Ce(A){const k=f>>_1n$1;return A>k}function Le(A,k){if(!c.isValidNot0(k))throw new Error(`invalid signature ${A}: out of range 1..Point.Fn.ORDER`);return k}function Ge(A,k){validateSigFormat(k);const Y=X.signature,Q=k==="compact"?Y:k==="recovered"?Y+1:void 0;return _abytes2(A,Q,`${k} signature`)}class ze{constructor(k,Y,Q){this.r=Le("r",k),this.s=Le("s",Y),Q!=null&&(this.recovery=Q),Object.freeze(this)}static fromBytes(k,Y=ne){Ge(k,Y);let Q;if(Y==="der"){const{r:B,s:oe}=DER.toSig(_abytes2(k));return new ze(B,oe)}Y==="recovered"&&(Q=k[0],Y="compact",k=k.subarray(1));const $e=c.BYTES,ve=k.subarray(0,$e),re=k.subarray($e,$e*2);return new ze(c.fromBytes(ve),c.fromBytes(re),Q)}static fromHex(k,Y){return this.fromBytes(hexToBytes(k),Y)}addRecoveryBit(k){return new ze(this.r,this.s,k)}recoverPublicKey(k){const Y=a.ORDER,{r:Q,s:$e,recovery:ve}=this;if(ve==null||![0,1,2,3].includes(ve))throw new Error("recovery id invalid");if(f*_2n$1<Y&&ve>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=ve===2||ve===3?Q+f:Q;if(!a.isValid(B))throw new Error("recovery id 2 or 3 invalid");const oe=a.toBytes(B),Ue=r.fromBytes(concatBytes(pprefix((ve&1)===0),oe)),Ze=c.inv(B),lt=He(ensureBytes("msgHash",k)),St=c.create(-lt*Ze),Mt=c.create($e*Ze),Ft=r.BASE.multiplyUnsafe(St).add(Ue.multiplyUnsafe(Mt));if(Ft.is0())throw new Error("point at infinify");return Ft.assertValidity(),Ft}hasHighS(){return Ce(this.s)}toBytes(k=ne){if(validateSigFormat(k),k==="der")return hexToBytes(DER.hexFromSig(this));const Y=c.toBytes(this.r),Q=c.toBytes(this.s);if(k==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes(Uint8Array.of(this.recovery),Y,Q)}return concatBytes(Y,Q)}toHex(k){return bytesToHex(this.toBytes(k))}assertValidity(){}static fromCompact(k){return ze.fromBytes(ensureBytes("sig",k),"compact")}static fromDER(k){return ze.fromBytes(ensureBytes("sig",k),"der")}normalizeS(){return this.hasHighS()?new ze(this.r,c.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex(this.toBytes("compact"))}}const Xe=n.bits2int||function(k){if(k.length>8192)throw new Error("input is too large");const Y=bytesToNumberBE(k),Q=k.length*8-g;return Q>0?Y>>BigInt(Q):Y},He=n.bits2int_modN||function(k){return c.create(Xe(k))},Ve=bitMask(g);function We(A){return aInRange("num < 2^"+g,A,_0n$1,Ve),c.toBytes(A)}function rt(A,k){return _abytes2(A,void 0,"message"),k?_abytes2(t(A),void 0,"prehashed message"):A}function st(A,k,Y){if(["recovered","canonical"].some(St=>St in Y))throw new Error("sign() legacy options not supported");const{lowS:Q,prehash:$e,extraEntropy:ve}=validateSigOpts(Y,te);A=rt(A,$e);const re=He(A),B=_normFnElement(c,k),oe=[We(B),We(re)];if(ve!=null&&ve!==!1){const St=ve===!0?s(X.secretKey):ve;oe.push(ensureBytes("extraEntropy",St))}const Ue=concatBytes(...oe),Ze=re;function lt(St){const Mt=Xe(St);if(!c.isValidNot0(Mt))return;const Ft=c.inv(Mt),Zt=r.BASE.multiply(Mt).toAffine(),Ut=c.create(Zt.x);if(Ut===_0n$1)return;const vr=c.create(Ft*c.create(Ze+Ut*B));if(vr===_0n$1)return;let zr=(Zt.x===Ut?0:2)|Number(Zt.y&_1n$1),or=vr;return Q&&Ce(vr)&&(or=c.neg(vr),zr^=1),new ze(Ut,or,zr)}return{seed:Ue,k2sig:lt}}function ht(A,k,Y={}){A=ensureBytes("message",A);const{seed:Q,k2sig:$e}=st(A,k,Y);return createHmacDrbg(t.outputLen,c.BYTES,o)(Q,$e)}function je(A){let k;const Y=typeof A=="string"||isBytes(A),Q=!Y&&A!==null&&typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!Y&&!Q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Q)k=new ze(A.r,A.s);else if(Y){try{k=ze.fromBytes(ensureBytes("sig",A),"der")}catch($e){if(!($e instanceof DER.Err))throw $e}if(!k)try{k=ze.fromBytes(ensureBytes("sig",A),"compact")}catch{return!1}}return k||!1}function se(A,k,Y,Q={}){const{lowS:$e,prehash:ve,format:re}=validateSigOpts(Q,te);if(Y=ensureBytes("publicKey",Y),k=rt(ensureBytes("message",k),ve),"strict"in Q)throw new Error("options.strict was renamed to lowS");const B=re===void 0?je(A):ze.fromBytes(ensureBytes("sig",A),re);if(B===!1)return!1;try{const oe=r.fromBytes(Y);if($e&&B.hasHighS())return!1;const{r:Ue,s:Ze}=B,lt=He(k),St=c.inv(Ze),Mt=c.create(lt*St),Ft=c.create(Ue*St),Zt=r.BASE.multiplyUnsafe(Mt).add(oe.multiplyUnsafe(Ft));return Zt.is0()?!1:c.create(Zt.x)===Ue}catch{return!1}}function m(A,k,Y={}){const{prehash:Q}=validateSigOpts(Y,te);return k=rt(k,Q),ze.fromBytes(A,"recovered").recoverPublicKey(k).toBytes()}return Object.freeze({keygen:b,getPublicKey:_,getSharedSecret:L,utils:q,lengths:X,Point:r,sign:ht,verify:se,recoverPublicKey:m,Signature:ze,hash:t})}function _weierstrass_legacy_opts_to_new(r){const t={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},n=r.Fp;let s=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(c=>Math.ceil(c/2)))):void 0;const o=Field(t.n,{BITS:r.nBitLength,allowedLengths:s,modFromBytes:r.wrapPrivateKey}),a={Fp:n,Fn:o,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:t,curveOpts:a}}function _ecdsa_legacy_opts_to_new(r){const{CURVE:t,curveOpts:n}=_weierstrass_legacy_opts_to_new(r),s={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:t,curveOpts:n,hash:r.hash,ecdsaOpts:s}}function _ecdsa_new_output_to_legacy(r,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},r,nLength(n.Fn.ORDER,n.Fn.BITS))})}function weierstrass(r){const{CURVE:t,curveOpts:n,hash:s,ecdsaOpts:o}=_ecdsa_legacy_opts_to_new(r),a=weierstrassN(t,n),c=ecdsa(a,s,o);return _ecdsa_new_output_to_legacy(r,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve(r,t){const n=s=>weierstrass({...r,hash:s});return{...n(t),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2);function sqrtMod(r){const t=secp256k1_CURVE.p,n=BigInt(3),s=BigInt(6),o=BigInt(11),a=BigInt(22),c=BigInt(23),f=BigInt(44),g=BigInt(88),b=r*r*r%t,_=b*b*r%t,L=pow2(_,n,t)*_%t,q=pow2(L,n,t)*_%t,X=pow2(q,_2n,t)*b%t,te=pow2(X,o,t)*X%t,ne=pow2(te,a,t)*te%t,Ce=pow2(ne,f,t)*ne%t,Le=pow2(Ce,g,t)*Ce%t,Ge=pow2(Le,f,t)*ne%t,ze=pow2(Ge,n,t)*_%t,Xe=pow2(ze,c,t)*te%t,He=pow2(Xe,s,t)*b%t,Ve=pow2(He,_2n,t);if(!Fpk1.eql(Fpk1.sqr(Ve),r))throw new Error("Cannot find square root");return Ve}const Fpk1=Field(secp256k1_CURVE.p,{sqrt:sqrtMod}),secp256k1=createCurve({...secp256k1_CURVE,Fp:Fpk1,lowS:!0,endo:secp256k1_ENDO},sha256$1),TAGGED_HASH_PREFIXES={};function taggedHash(r,...t){let n=TAGGED_HASH_PREFIXES[r];if(n===void 0){const s=sha256$1(utf8ToBytes(r));n=concatBytes(s,s),TAGGED_HASH_PREFIXES[r]=n}return sha256$1(concatBytes(n,...t))}const pointToBytes=r=>r.toBytes(!0).slice(1),Pointk1=secp256k1.Point,hasEven=r=>r%_2n===_0n;function schnorrGetExtPubKey(r){const{Fn:t,BASE:n}=Pointk1,s=_normFnElement(t,r),o=n.multiply(s);return{scalar:hasEven(o.y)?s:t.neg(s),bytes:pointToBytes(o)}}function lift_x(r){const t=Fpk1;if(!t.isValidNot0(r))throw new Error("invalid x: Fail if x  p");const n=t.create(r*r),s=t.create(n*r+BigInt(7));let o=t.sqrt(s);hasEven(o)||(o=t.neg(o));const a=Pointk1.fromAffine({x:r,y:o});return a.assertValidity(),a}const num=bytesToNumberBE;function challenge(...r){return Pointk1.Fn.create(num(taggedHash("BIP0340/challenge",...r)))}function schnorrGetPublicKey(r){return schnorrGetExtPubKey(r).bytes}function schnorrSign(r,t,n=randomBytes(32)){const{Fn:s}=Pointk1,o=ensureBytes("message",r),{bytes:a,scalar:c}=schnorrGetExtPubKey(t),f=ensureBytes("auxRand",n,32),g=s.toBytes(c^num(taggedHash("BIP0340/aux",f))),b=taggedHash("BIP0340/nonce",g,a,o),{bytes:_,scalar:L}=schnorrGetExtPubKey(b),q=challenge(_,a,o),X=new Uint8Array(64);if(X.set(_,0),X.set(s.toBytes(s.create(L+q*c)),32),!schnorrVerify(X,o,a))throw new Error("sign: Invalid signature produced");return X}function schnorrVerify(r,t,n){const{Fn:s,BASE:o}=Pointk1,a=ensureBytes("signature",r,64),c=ensureBytes("message",t),f=ensureBytes("publicKey",n,32);try{const g=lift_x(num(f)),b=num(a.subarray(0,32));if(!inRange(b,_1n,secp256k1_CURVE.p))return!1;const _=num(a.subarray(32,64));if(!inRange(_,_1n,secp256k1_CURVE.n))return!1;const L=challenge(s.toBytes(b),pointToBytes(g),c),q=o.multiplyUnsafe(_).add(g.multiplyUnsafe(s.neg(L))),{x:X,y:te}=q.toAffine();return!(q.is0()||!hasEven(te)||X!==b)}catch{return!1}}const schnorr=(()=>{const n=(o=randomBytes(48))=>mapHashToField(o,secp256k1_CURVE.n);secp256k1.utils.randomSecretKey;function s(o){const a=n(o);return{secretKey:a,publicKey:schnorrGetPublicKey(a)}}return{keygen:s,getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,Point:Pointk1,utils:{randomSecretKey:n,randomPrivateKey:n,taggedHash,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,mod},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),sha256=sha256$1;var dist={},LRUCache={},LRUCacheNode={},hasRequiredLRUCacheNode;function requireLRUCacheNode(){if(hasRequiredLRUCacheNode)return LRUCacheNode;hasRequiredLRUCacheNode=1,Object.defineProperty(LRUCacheNode,"__esModule",{value:!0}),LRUCacheNode.LRUCacheNode=void 0;let r=class{constructor(n,s,o){const{entryExpirationTimeInMS:a=null,next:c=null,prev:f=null,onEntryEvicted:g,onEntryMarkedAsMostRecentlyUsed:b,clone:_,cloneFn:L}=o??{};if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=_??!1,this.cloneFn=L??this.defaultClone,this.key=n,this.internalValue=this.clone?this.cloneFn(s):s,this.created=Date.now(),this.entryExpirationTimeInMS=a,this.next=c,this.prev=f,this.onEntryEvicted=g,this.onEntryMarkedAsMostRecentlyUsed=b}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:n,value:s,isExpired:o}=this;this.onEntryEvicted({key:n,value:s,isExpired:o})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:n,value:s}=this;this.onEntryMarkedAsMostRecentlyUsed({key:n,value:s})}}defaultClone(n){return typeof n=="boolean"||typeof n=="string"||typeof n=="number"?n:JSON.parse(JSON.stringify(n))}};return LRUCacheNode.LRUCacheNode=r,LRUCacheNode}var hasRequiredLRUCache;function requireLRUCache(){if(hasRequiredLRUCache)return LRUCache;hasRequiredLRUCache=1,Object.defineProperty(LRUCache,"__esModule",{value:!0}),LRUCache.LRUCache=void 0;const r=requireLRUCacheNode();let t=class{constructor(s){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:o=25,entryExpirationTimeInMS:a=null,onEntryEvicted:c,onEntryMarkedAsMostRecentlyUsed:f,cloneFn:g,clone:b}=s??{};if(Number.isNaN(o)||o<=0)throw new Error("maxSize must be greater than 0.");if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=o,this.entryExpirationTimeInMS=a,this.onEntryEvicted=c,this.onEntryMarkedAsMostRecentlyUsed=f,this.clone=b,this.cloneFn=g}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(s){if(Number.isNaN(s)||s<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=s,this.enforceSizeLimit()}set(s,o,a){const c=this.lookupTable.get(s);c&&this.removeNodeFromListAndLookupTable(c);const f=new r.LRUCacheNode(s,o,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...a});return this.setNodeAsHead(f),this.lookupTable.set(s,f),this.enforceSizeLimit(),this}get(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):(this.setNodeAsHead(o),o.value):null}peek(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),null):o.value:null}delete(s){const o=this.lookupTable.get(s);return o?this.removeNodeFromListAndLookupTable(o):!1}has(s){const o=this.lookupTable.get(s);return o?o.isExpired?(this.removeNodeFromListAndLookupTable(o),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(s){let o=this.head;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}const a=this.mapNodeToEntry(o);if(s(a))return this.setNodeAsHead(o),a;o=o.next}return null}forEach(s){let o=this.head,a=0;for(;o;){if(o.isExpired){const c=o.next;this.removeNodeFromListAndLookupTable(o),o=c;continue}s(o.value,o.key,a),o=o.next,a++}}*values(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield s.value,s=s.next}}*keys(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield s.key,s=s.next}}*entries(){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield this.mapNodeToEntry(s),s=s.next}}*[Symbol.iterator](){let s=this.head;for(;s;){if(s.isExpired){const o=s.next;this.removeNodeFromListAndLookupTable(s),s=o;continue}yield this.mapNodeToEntry(s),s=s.next}}enforceSizeLimit(){let s=this.tail;for(;s!==null&&this.size>this.maxSizeInternal;){const o=s.prev;this.removeNodeFromListAndLookupTable(s),s=o}}mapNodeToEntry({key:s,value:o}){return{key:s,value:o}}setNodeAsHead(s){this.removeNodeFromList(s),this.head?(s.next=this.head,this.head.prev=s,this.head=s):(this.head=s,this.tail=s),s.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(s){s.prev!==null&&(s.prev.next=s.next),s.next!==null&&(s.next.prev=s.prev),this.head===s&&(this.head=s.next),this.tail===s&&(this.tail=s.prev),s.next=null,s.prev=null}removeNodeFromListAndLookupTable(s){return s.invokeOnEvicted(),this.removeNodeFromList(s),this.lookupTable.delete(s.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const s=[];for(const o of this.lookupTable.values())o.isExpired&&s.push(o);s.forEach(o=>this.removeNodeFromListAndLookupTable(o))}};return LRUCache.LRUCache=t,LRUCache}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(r){var t=dist&&dist.__createBinding||(Object.create?(function(s,o,a,c){c===void 0&&(c=a);var f=Object.getOwnPropertyDescriptor(o,a);(!f||("get"in f?!o.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return o[a]}}),Object.defineProperty(s,c,f)}):(function(s,o,a,c){c===void 0&&(c=a),s[c]=o[a]})),n=dist&&dist.__exportStar||function(s,o){for(var a in s)a!=="default"&&!Object.prototype.hasOwnProperty.call(o,a)&&t(o,s,a)};Object.defineProperty(r,"__esModule",{value:!0}),n(requireLRUCache(),r)})(dist)),dist}var distExports=requireDist();function pbkdf2Init(r,t,n,s){assert.hash(r);const o=checkOpts$1({dkLen:32,asyncTick:10},s),{c:a,dkLen:c,asyncTick:f}=o;if(assert.number(a),assert.number(c),assert.number(f),a<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const g=toBytes$2(t),b=toBytes$2(n),_=new Uint8Array(c),L=hmac$1.create(r,g),q=L._cloneInto().update(b);return{c:a,dkLen:c,asyncTick:f,DK:_,PRF:L,PRFSalt:q}}function pbkdf2Output(r,t,n,s,o){return r.destroy(),t.destroy(),s&&s.destroy(),o.fill(0),n}function pbkdf2(r,t,n,s){const{c:o,dkLen:a,DK:c,PRF:f,PRFSalt:g}=pbkdf2Init(r,t,n,s);let b;const _=new Uint8Array(4),L=createView$2(_),q=new Uint8Array(f.outputLen);for(let X=1,te=0;te<a;X++,te+=f.outputLen){const ne=c.subarray(te,te+f.outputLen);L.setInt32(0,X,!1),(b=g._cloneInto(b)).update(_).digestInto(q),ne.set(q.subarray(0,ne.length));for(let Ce=1;Ce<o;Ce++){f._cloneInto(b).update(q).digestInto(q);for(let Le=0;Le<ne.length;Le++)ne[Le]^=q[Le]}}return pbkdf2Output(f,g,c,b,q)}const rotl=(r,t)=>r<<t|r>>>32-t;function XorAndSalsa(r,t,n,s,o,a){let c=r[t++]^n[s++],f=r[t++]^n[s++],g=r[t++]^n[s++],b=r[t++]^n[s++],_=r[t++]^n[s++],L=r[t++]^n[s++],q=r[t++]^n[s++],X=r[t++]^n[s++],te=r[t++]^n[s++],ne=r[t++]^n[s++],Ce=r[t++]^n[s++],Le=r[t++]^n[s++],Ge=r[t++]^n[s++],ze=r[t++]^n[s++],Xe=r[t++]^n[s++],He=r[t++]^n[s++],Ve=c,We=f,rt=g,st=b,ht=_,je=L,se=q,m=X,A=te,k=ne,Y=Ce,Q=Le,$e=Ge,ve=ze,re=Xe,B=He;for(let oe=0;oe<8;oe+=2)ht^=rotl(Ve+$e|0,7),A^=rotl(ht+Ve|0,9),$e^=rotl(A+ht|0,13),Ve^=rotl($e+A|0,18),k^=rotl(je+We|0,7),ve^=rotl(k+je|0,9),We^=rotl(ve+k|0,13),je^=rotl(We+ve|0,18),re^=rotl(Y+se|0,7),rt^=rotl(re+Y|0,9),se^=rotl(rt+re|0,13),Y^=rotl(se+rt|0,18),st^=rotl(B+Q|0,7),m^=rotl(st+B|0,9),Q^=rotl(m+st|0,13),B^=rotl(Q+m|0,18),We^=rotl(Ve+st|0,7),rt^=rotl(We+Ve|0,9),st^=rotl(rt+We|0,13),Ve^=rotl(st+rt|0,18),se^=rotl(je+ht|0,7),m^=rotl(se+je|0,9),ht^=rotl(m+se|0,13),je^=rotl(ht+m|0,18),Q^=rotl(Y+k|0,7),A^=rotl(Q+Y|0,9),k^=rotl(A+Q|0,13),Y^=rotl(k+A|0,18),$e^=rotl(B+re|0,7),ve^=rotl($e+B|0,9),re^=rotl(ve+$e|0,13),B^=rotl(re+ve|0,18);o[a++]=c+Ve|0,o[a++]=f+We|0,o[a++]=g+rt|0,o[a++]=b+st|0,o[a++]=_+ht|0,o[a++]=L+je|0,o[a++]=q+se|0,o[a++]=X+m|0,o[a++]=te+A|0,o[a++]=ne+k|0,o[a++]=Ce+Y|0,o[a++]=Le+Q|0,o[a++]=Ge+$e|0,o[a++]=ze+ve|0,o[a++]=Xe+re|0,o[a++]=He+B|0}function BlockMix(r,t,n,s,o){let a=s+0,c=s+16*o;for(let f=0;f<16;f++)n[c+f]=r[t+(2*o-1)*16+f];for(let f=0;f<o;f++,a+=16,t+=16)XorAndSalsa(n,c,r,t,n,a),f>0&&(c+=16),XorAndSalsa(n,a,r,t+=16,n,c)}function scryptInit(r,t,n){const s=checkOpts$1({dkLen:32,asyncTick:10,maxmem:1073742848},n),{N:o,r:a,p:c,dkLen:f,asyncTick:g,maxmem:b,onProgress:_}=s;if(assert.number(o),assert.number(a),assert.number(c),assert.number(f),assert.number(g),assert.number(b),_!==void 0&&typeof _!="function")throw new Error("progressCb should be function");const L=128*a,q=L/4;if(o<=1||(o&o-1)!==0||o>=2**(L/8)||o>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(c<0||c>(2**32-1)*32/L)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(f<0||f>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const X=L*(o+c);if(X>b)throw new Error(`Scrypt: parameters too large, ${X} (128 * r * (N + p)) > ${b} (maxmem)`);const te=pbkdf2(sha256$2,r,t,{c:1,dkLen:L*c}),ne=u32$1(te),Ce=u32$1(new Uint8Array(L*o)),Le=u32$1(new Uint8Array(L));let Ge=()=>{};if(_){const ze=2*o*c,Xe=Math.max(Math.floor(ze/1e4),1);let He=0;Ge=()=>{He++,_&&(!(He%Xe)||He===ze)&&_(He/ze)}}return{N:o,r:a,p:c,dkLen:f,blockSize32:q,V:Ce,B32:ne,B:te,tmp:Le,blockMixCb:Ge,asyncTick:g}}function scryptOutput(r,t,n,s,o){const a=pbkdf2(sha256$2,r,n,{c:1,dkLen:t});return n.fill(0),s.fill(0),o.fill(0),a}function scrypt(r,t,n){const{N:s,r:o,p:a,dkLen:c,blockSize32:f,V:g,B32:b,B:_,tmp:L,blockMixCb:q}=scryptInit(r,t,n);for(let X=0;X<a;X++){const te=f*X;for(let ne=0;ne<f;ne++)g[ne]=b[te+ne];for(let ne=0,Ce=0;ne<s-1;ne++)BlockMix(g,Ce,g,Ce+=f,o),q();BlockMix(g,(s-1)*f,b,te,o),q();for(let ne=0;ne<s;ne++){const Ce=b[te+f-16]%s;for(let Le=0;Le<f;Le++)L[Le]=b[te+Le]^g[Ce*f+Le];BlockMix(L,0,b,te,o),q()}}return scryptOutput(r,c,_,g,L)}var Bech32MaxSize$1=5e3;function encodeBech32$1(r,t){let n=bech32$1.toWords(t);return bech32$1.encode(r,n,Bech32MaxSize$1)}function encodeBytes$1(r,t){return encodeBech32$1(r,t)}function encrypt$1(r,t,n=16,s=2){let o=randomBytes$1(16),a=2**n,c=scrypt(t.normalize("NFKC"),o,{N:a,r:8,p:1,dkLen:32}),f=randomBytes$1(24),g=Uint8Array.from([s]),_=xchacha20poly1305(c,f,g).encrypt(r),L=concatBytes$1(Uint8Array.from([2]),Uint8Array.from([n]),o,f,g,_);return encodeBytes$1("ncryptsec",L)}function decrypt$1(r,t){let{prefix:n,words:s}=bech32$1.decode(r,Bech32MaxSize$1);if(n!=="ncryptsec")throw new Error(`invalid prefix ${n}, expected 'ncryptsec'`);let o=new Uint8Array(bech32$1.fromWords(s)),a=o[0];if(a!==2)throw new Error(`invalid version ${a}, expected 0x02`);let f=2**o[1],g=o.slice(2,18),b=o.slice(18,42),_=o[42],L=Uint8Array.from([_]),q=o.slice(43),X=scrypt(t.normalize("NFKC"),g,{N:f,r:8,p:1,dkLen:32});return xchacha20poly1305(X,b,L).decrypt(q)}const nip49_star=Object.freeze(Object.defineProperty({__proto__:null,decrypt:decrypt$1,encrypt:encrypt$1},Symbol.toStringTag,{value:"Module"}));var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder,NostrTypeGuard={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},Bech32MaxSize=5e3,BECH32_REGEX=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(r){const t=new Uint8Array(4);return t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=r&255,t}function decodeNostrURI(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),decode(r)}catch{return{type:"invalid",data:null}}}function decode(r){let{prefix:t,words:n}=bech32$1.decode(r,Bech32MaxSize),s=new Uint8Array(bech32$1.fromWords(n));switch(t){case"nprofile":{let o=parseTLV(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$1(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder.decode(a)):[]}}}case"nevent":{let o=parseTLV(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for nevent");if(o[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(o[2]&&o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(o[3]&&o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$1(o[0][0]),relays:o[1]?o[1].map(a=>utf8Decoder.decode(a)):[],author:o[2]?.[0]?bytesToHex$1(o[2][0]):void 0,kind:o[3]?.[0]?parseInt(bytesToHex$1(o[3][0]),16):void 0}}}case"naddr":{let o=parseTLV(s);if(!o[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!o[2]?.[0])throw new Error("missing TLV 2 for naddr");if(o[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!o[3]?.[0])throw new Error("missing TLV 3 for naddr");if(o[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(o[0][0]),pubkey:bytesToHex$1(o[2][0]),kind:parseInt(bytesToHex$1(o[3][0]),16),relays:o[1]?o[1].map(a=>utf8Decoder.decode(a)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex$1(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV(r){let t={},n=r;for(;n.length>0;){let s=n[0],o=n[1],a=n.slice(2,2+o);if(n=n.slice(2+o),a.length<o)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(a)}return t}function nsecEncode(r){return encodeBytes("nsec",r)}function npubEncode(r){return encodeBytes("npub",hexToBytes$1(r))}function noteEncode(r){return encodeBytes("note",hexToBytes$1(r))}function encodeBech32(r,t){let n=bech32$1.toWords(t);return bech32$1.encode(r,n,Bech32MaxSize)}function encodeBytes(r,t){return encodeBech32(r,t)}function nprofileEncode(r){let t=encodeTLV({0:[hexToBytes$1(r.pubkey)],1:(r.relays||[]).map(n=>utf8Encoder.encode(n))});return encodeBech32("nprofile",t)}function neventEncode(r){let t;r.kind!==void 0&&(t=integerToUint8Array(r.kind));let n=encodeTLV({0:[hexToBytes$1(r.id)],1:(r.relays||[]).map(s=>utf8Encoder.encode(s)),2:r.author?[hexToBytes$1(r.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32("nevent",n)}function naddrEncode(r){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,r.kind,!1);let n=encodeTLV({0:[utf8Encoder.encode(r.identifier)],1:(r.relays||[]).map(s=>utf8Encoder.encode(s)),2:[hexToBytes$1(r.pubkey)],3:[new Uint8Array(t)]});return encodeBech32("naddr",n)}function encodeTLV(r){let t=[];return Object.entries(r).reverse().forEach(([n,s])=>{s.forEach(o=>{let a=new Uint8Array(o.length+2);a.set([parseInt(n)],0),a.set([o.length],1),a.set(o,2),t.push(a)})}),concatBytes$1(...t)}const nip19_star=Object.freeze(Object.defineProperty({__proto__:null,BECH32_REGEX,Bech32MaxSize,NostrTypeGuard,decode,decodeNostrURI,encodeBytes,naddrEncode,neventEncode,noteEncode,nprofileEncode,npubEncode,nsecEncode},Symbol.toStringTag,{value:"Module"}));var lib={},hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,(function(r){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.bytes=r.stringToBytes=r.str=r.bytesToString=r.hex=r.utf8=r.bech32m=r.bech32=r.base58check=r.base58xmr=r.base58xrp=r.base58flickr=r.base58=r.base64url=r.base64=r.base32crockford=r.base32hex=r.base32=r.base16=r.utils=r.assertNumber=void 0;function t(je){if(!Number.isSafeInteger(je))throw new Error(`Wrong integer: ${je}`)}r.assertNumber=t;function n(...je){const se=(k,Y)=>Q=>k(Y(Q)),m=Array.from(je).reverse().reduce((k,Y)=>k?se(k,Y.encode):Y.encode,void 0),A=je.reduce((k,Y)=>k?se(k,Y.decode):Y.decode,void 0);return{encode:m,decode:A}}function s(je){return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return se.map(m=>{if(t(m),m<0||m>=je.length)throw new Error(`Digit index outside alphabet: ${m} (alphabet: ${je.length})`);return je[m]})},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("alphabet.decode input should be array of strings");return se.map(m=>{if(typeof m!="string")throw new Error(`alphabet.decode: not string element=${m}`);const A=je.indexOf(m);if(A===-1)throw new Error(`Unknown letter: "${m}". Allowed: ${je}`);return A})}}}function o(je=""){if(typeof je!="string")throw new Error("join separator should be string");return{encode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="string")throw new Error("join.encode input should be array of strings");for(let m of se)if(typeof m!="string")throw new Error(`join.encode: non-string input=${m}`);return se.join(je)},decode:se=>{if(typeof se!="string")throw new Error("join.decode input should be string");return se.split(je)}}}function a(je,se="="){if(t(je),typeof se!="string")throw new Error("padding chr should be string");return{encode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let A of m)if(typeof A!="string")throw new Error(`padding.encode: non-string input=${A}`);for(;m.length*je%8;)m.push(se);return m},decode(m){if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("padding.encode input should be array of strings");for(let k of m)if(typeof k!="string")throw new Error(`padding.decode: non-string input=${k}`);let A=m.length;if(A*je%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;A>0&&m[A-1]===se;A--)if(!((A-1)*je%8))throw new Error("Invalid padding: string has too much padding");return m.slice(0,A)}}}function c(je){if(typeof je!="function")throw new Error("normalize fn should be function");return{encode:se=>se,decode:se=>je(se)}}function f(je,se,m){if(se<2)throw new Error(`convertRadix: wrong from=${se}, base cannot be less than 2`);if(m<2)throw new Error(`convertRadix: wrong to=${m}, base cannot be less than 2`);if(!Array.isArray(je))throw new Error("convertRadix: data should be array");if(!je.length)return[];let A=0;const k=[],Y=Array.from(je);for(Y.forEach(Q=>{if(t(Q),Q<0||Q>=se)throw new Error(`Wrong integer: ${Q}`)});;){let Q=0,$e=!0;for(let ve=A;ve<Y.length;ve++){const re=Y[ve],B=se*Q+re;if(!Number.isSafeInteger(B)||se*Q/se!==Q||B-re!==se*Q)throw new Error("convertRadix: carry overflow");if(Q=B%m,Y[ve]=Math.floor(B/m),!Number.isSafeInteger(Y[ve])||Y[ve]*m+Q!==B)throw new Error("convertRadix: carry overflow");if($e)Y[ve]?$e=!1:A=ve;else continue}if(k.push(Q),$e)break}for(let Q=0;Q<je.length-1&&je[Q]===0;Q++)k.push(0);return k.reverse()}const g=(je,se)=>se?g(se,je%se):je,b=(je,se)=>je+(se-g(je,se));function _(je,se,m,A){if(!Array.isArray(je))throw new Error("convertRadix2: data should be array");if(se<=0||se>32)throw new Error(`convertRadix2: wrong from=${se}`);if(m<=0||m>32)throw new Error(`convertRadix2: wrong to=${m}`);if(b(se,m)>32)throw new Error(`convertRadix2: carry overflow from=${se} to=${m} carryBits=${b(se,m)}`);let k=0,Y=0;const Q=2**m-1,$e=[];for(const ve of je){if(t(ve),ve>=2**se)throw new Error(`convertRadix2: invalid data word=${ve} from=${se}`);if(k=k<<se|ve,Y+se>32)throw new Error(`convertRadix2: carry overflow pos=${Y} from=${se}`);for(Y+=se;Y>=m;Y-=m)$e.push((k>>Y-m&Q)>>>0);k&=2**Y-1}if(k=k<<m-Y&Q,!A&&Y>=se)throw new Error("Excess padding");if(!A&&k)throw new Error(`Non-zero padding: ${k}`);return A&&Y>0&&$e.push(k>>>0),$e}function L(je){return t(je),{encode:se=>{if(!(se instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return f(Array.from(se),2**8,je)},decode:se=>{if(!Array.isArray(se)||se.length&&typeof se[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(f(se,je,2**8))}}}function q(je,se=!1){if(t(je),je<=0||je>32)throw new Error("radix2: bits should be in (0..32]");if(b(8,je)>32||b(je,8)>32)throw new Error("radix2: carry overflow");return{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return _(Array.from(m),8,je,!se)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(_(m,je,8,se))}}}function X(je){if(typeof je!="function")throw new Error("unsafeWrapper fn should be function");return function(...se){try{return je.apply(null,se)}catch{}}}function te(je,se){if(t(je),typeof se!="function")throw new Error("checksum fn should be function");return{encode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const A=se(m).slice(0,je),k=new Uint8Array(m.length+je);return k.set(m),k.set(A,m.length),k},decode(m){if(!(m instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const A=m.slice(0,-je),k=se(A).slice(0,je),Y=m.slice(-je);for(let Q=0;Q<je;Q++)if(k[Q]!==Y[Q])throw new Error("Invalid checksum");return A}}}r.utils={alphabet:s,chain:n,checksum:te,radix:L,radix2:q,join:o,padding:a},r.base16=n(q(4),s("0123456789ABCDEF"),o("")),r.base32=n(q(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),o("")),r.base32hex=n(q(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),o("")),r.base32crockford=n(q(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),c(je=>je.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),r.base64=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),o("")),r.base64url=n(q(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),o(""));const ne=je=>n(L(58),s(je),o(""));r.base58=ne("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),r.base58flickr=ne("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),r.base58xrp=ne("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ce=[0,2,3,5,6,7,9,10,11];r.base58xmr={encode(je){let se="";for(let m=0;m<je.length;m+=8){const A=je.subarray(m,m+8);se+=r.base58.encode(A).padStart(Ce[A.length],"1")}return se},decode(je){let se=[];for(let m=0;m<je.length;m+=11){const A=je.slice(m,m+11),k=Ce.indexOf(A.length),Y=r.base58.decode(A);for(let Q=0;Q<Y.length-k;Q++)if(Y[Q]!==0)throw new Error("base58xmr: wrong padding");se=se.concat(Array.from(Y.slice(Y.length-k)))}return Uint8Array.from(se)}};const Le=je=>n(te(4,se=>je(je(se))),r.base58);r.base58check=Le;const Ge=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),ze=[996825010,642813549,513874426,1027748829,705979059];function Xe(je){const se=je>>25;let m=(je&33554431)<<5;for(let A=0;A<ze.length;A++)(se>>A&1)===1&&(m^=ze[A]);return m}function He(je,se,m=1){const A=je.length;let k=1;for(let Y=0;Y<A;Y++){const Q=je.charCodeAt(Y);if(Q<33||Q>126)throw new Error(`Invalid prefix (${je})`);k=Xe(k)^Q>>5}k=Xe(k);for(let Y=0;Y<A;Y++)k=Xe(k)^je.charCodeAt(Y)&31;for(let Y of se)k=Xe(k)^Y;for(let Y=0;Y<6;Y++)k=Xe(k);return k^=m,Ge.encode(_([k%2**30],30,5,!1))}function Ve(je){const se=je==="bech32"?1:734539939,m=q(5),A=m.decode,k=m.encode,Y=X(A);function Q(B,oe,Ue=90){if(typeof B!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof B}`);if(!Array.isArray(oe)||oe.length&&typeof oe[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof oe}`);const Ze=B.length+7+oe.length;if(Ue!==!1&&Ze>Ue)throw new TypeError(`Length ${Ze} exceeds limit ${Ue}`);return B=B.toLowerCase(),`${B}1${Ge.encode(oe)}${He(B,oe,se)}`}function $e(B,oe=90){if(typeof B!="string")throw new Error(`bech32.decode input should be string, not ${typeof B}`);if(B.length<8||oe!==!1&&B.length>oe)throw new TypeError(`Wrong string length: ${B.length} (${B}). Expected (8..${oe})`);const Ue=B.toLowerCase();if(B!==Ue&&B!==B.toUpperCase())throw new Error("String must be lowercase or uppercase");B=Ue;const Ze=B.lastIndexOf("1");if(Ze===0||Ze===-1)throw new Error('Letter "1" must be present between prefix and data only');const lt=B.slice(0,Ze),St=B.slice(Ze+1);if(St.length<6)throw new Error("Data must be at least 6 characters long");const Mt=Ge.decode(St).slice(0,-6),Ft=He(lt,Mt,se);if(!St.endsWith(Ft))throw new Error(`Invalid checksum in ${B}: expected "${Ft}"`);return{prefix:lt,words:Mt}}const ve=X($e);function re(B){const{prefix:oe,words:Ue}=$e(B,!1);return{prefix:oe,words:Ue,bytes:A(Ue)}}return{encode:Q,decode:$e,decodeToBytes:re,decodeUnsafe:ve,fromWords:A,fromWordsUnsafe:Y,toWords:k}}r.bech32=Ve("bech32"),r.bech32m=Ve("bech32m"),r.utf8={encode:je=>new TextDecoder().decode(je),decode:je=>new TextEncoder().encode(je)},r.hex=n(q(4),s("0123456789abcdef"),o(""),c(je=>{if(typeof je!="string"||je.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof je} with length ${je.length}`);return je.toLowerCase()}));const We={utf8:r.utf8,hex:r.hex,base16:r.base16,base32:r.base32,base64:r.base64,base64url:r.base64url,base58:r.base58,base58xmr:r.base58xmr},rt=`Invalid encoding type. Available types: ${Object.keys(We).join(", ")}`,st=(je,se)=>{if(typeof je!="string"||!We.hasOwnProperty(je))throw new TypeError(rt);if(!(se instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return We[je].encode(se)};r.bytesToString=st,r.str=r.bytesToString;const ht=(je,se)=>{if(!We.hasOwnProperty(je))throw new TypeError(rt);if(typeof se!="string")throw new TypeError("stringToBytes() expects string");return We[je].decode(se)};r.stringToBytes=ht,r.bytes=r.stringToBytes})(lib)),lib}var bolt11,hasRequiredBolt11;function requireBolt11(){if(hasRequiredBolt11)return bolt11;hasRequiredBolt11=1;const{bech32:r,hex:t,utf8:n}=requireLib(),s={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},o={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},a={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},f={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},g=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],b={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},_=BigInt("2100000000000000000"),L=BigInt(1e11),q={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},X={};for(let He=0,Ve=Object.keys(q);He<Ve.length;He++){const We=Ve[He],rt=q[Ve[He]].toString();X[rt]=We}const te={1:He=>t.encode(r.fromWordsUnsafe(He)),16:He=>t.encode(r.fromWordsUnsafe(He)),13:He=>n.encode(r.fromWordsUnsafe(He)),19:He=>t.encode(r.fromWordsUnsafe(He)),23:He=>t.encode(r.fromWordsUnsafe(He)),27:He=>t.encode(r.fromWordsUnsafe(He)),6:Ce,24:Ce,3:Le,5:Ge};function ne(He){return Ve=>({tagCode:parseInt(He),words:r.encode("unknown",Ve,Number.MAX_SAFE_INTEGER)})}function Ce(He){return He.reverse().reduce((Ve,We,rt)=>Ve+We*Math.pow(32,rt),0)}function Le(He){const Ve=[];let We,rt,st,ht,je,se=r.fromWordsUnsafe(He);for(;se.length>0;)We=t.encode(se.slice(0,33)),rt=t.encode(se.slice(33,41)),st=parseInt(t.encode(se.slice(41,45)),16),ht=parseInt(t.encode(se.slice(45,49)),16),je=parseInt(t.encode(se.slice(49,51)),16),se=se.slice(51),Ve.push({pubkey:We,short_channel_id:rt,fee_base_msat:st,fee_proportional_millionths:ht,cltv_expiry_delta:je});return Ve}function Ge(He){const Ve=He.slice().reverse().map(st=>[!!(st&1),!!(st&2),!!(st&4),!!(st&8),!!(st&16)]).reduce((st,ht)=>st.concat(ht),[]);for(;Ve.length<g.length*2;)Ve.push(!1);const We={};g.forEach((st,ht)=>{let je;Ve[ht*2]?je="required":Ve[ht*2+1]?je="supported":je="unsupported",We[st]=je});const rt=Ve.slice(g.length*2);return We.extra_bits={start_bit:g.length*2,bits:rt,has_required:rt.reduce((st,ht,je)=>je%2!==0?st||!1:st||ht,!1)},We}function ze(He,Ve){let We,rt;if(He.slice(-1).match(/^[munp]$/))We=He.slice(-1),rt=He.slice(0,-1);else{if(He.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");rt=He}if(!rt.match(/^\d+$/))throw new Error("Not a valid human readable amount");const st=BigInt(rt),ht=We?st*L/b[We]:st*L;if(We==="p"&&st%BigInt(10)!==BigInt(0)||ht>_)throw new Error("Amount is outside of valid range");return Ve?ht.toString():ht}function Xe(He,Ve){if(typeof He!="string")throw new Error("Lightning Payment Request must be string");if(He.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const We=[],rt=r.decode(He,Number.MAX_SAFE_INTEGER);He=He.toLowerCase();const st=rt.prefix;let ht=rt.words,je=He.slice(st.length+1),se=ht.slice(-104);ht=ht.slice(0,-104);let m=st.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(m&&!m[2]&&(m=st.match(/^ln(\S+)$/)),!m)throw new Error("Not a proper lightning payment request");We.push({name:"lightning_network",letters:"ln"});const A=m[1];let k;if(Ve){if(Ve.bech32===void 0||Ve.pubKeyHash===void 0||Ve.scriptHash===void 0||!Array.isArray(Ve.validWitnessVersions))throw new Error("Invalid network");k=Ve}else switch(A){case s.bech32:k=s;break;case o.bech32:k=o;break;case a.bech32:k=a;break;case c.bech32:k=c;break;case f.bech32:k=f;break}if(!k||k.bech32!==A)throw new Error("Unknown coin bech32 prefix");We.push({name:"coin_network",letters:A,value:k});const Y=m[2];let Q;if(Y){const lt=m[3];Q=ze(Y+lt,!0),We.push({name:"amount",letters:m[2]+m[3],value:Q})}else Q=null;We.push({name:"separator",letters:"1"});const $e=Ce(ht.slice(0,7));ht=ht.slice(7),We.push({name:"timestamp",letters:je.slice(0,7),value:$e}),je=je.slice(7);let ve,re,B,oe;for(;ht.length>0;){const lt=ht[0].toString();ve=X[lt]||"unknown_tag",re=te[lt]||ne(lt),ht=ht.slice(1),B=Ce(ht.slice(0,2)),ht=ht.slice(2),oe=ht.slice(0,B),ht=ht.slice(B),We.push({name:ve,tag:je[0],letters:je.slice(0,3+B),value:re(oe)}),je=je.slice(3+B)}We.push({name:"signature",letters:je.slice(0,104),value:t.encode(r.fromWordsUnsafe(se))}),je=je.slice(104),We.push({name:"checksum",letters:je});let Ue={paymentRequest:He,sections:We,get expiry(){let lt=We.find(St=>St.name==="expiry");if(lt)return Ze("timestamp")+lt.value},get route_hints(){return We.filter(lt=>lt.name==="route_hint").map(lt=>lt.value)}};for(let lt in q)lt!=="route_hint"&&Object.defineProperty(Ue,lt,{get(){return Ze(lt)}});return Ue;function Ze(lt){let St=We.find(Mt=>Mt.name===lt);return St?St.value:void 0}}return bolt11={decode:Xe,hrpToMillisat:ze},bolt11}var bolt11Exports=requireBolt11(),__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__copyProps=(r,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of __getOwnPropNames(t))!__hasOwnProp.call(r,o)&&o!==n&&__defProp(r,o,{get:()=>t[o],enumerable:!(s=__getOwnPropDesc(t,o))||s.enumerable});return r},__reExport=(r,t,n)=>(__copyProps(r,t,"default"),n),NDKKind=(r=>(r[r.Metadata=0]="Metadata",r[r.Text=1]="Text",r[r.RecommendRelay=2]="RecommendRelay",r[r.Contacts=3]="Contacts",r[r.EncryptedDirectMessage=4]="EncryptedDirectMessage",r[r.EventDeletion=5]="EventDeletion",r[r.Repost=6]="Repost",r[r.Reaction=7]="Reaction",r[r.BadgeAward=8]="BadgeAward",r[r.GroupChat=9]="GroupChat",r[r.Thread=11]="Thread",r[r.GroupReply=12]="GroupReply",r[r.GiftWrapSeal=13]="GiftWrapSeal",r[r.PrivateDirectMessage=14]="PrivateDirectMessage",r[r.Image=20]="Image",r[r.Video=21]="Video",r[r.ShortVideo=22]="ShortVideo",r[r.Story=23]="Story",r[r.Vanish=62]="Vanish",r[r.CashuWalletBackup=375]="CashuWalletBackup",r[r.GiftWrap=1059]="GiftWrap",r[r.GenericRepost=16]="GenericRepost",r[r.ChannelCreation=40]="ChannelCreation",r[r.ChannelMetadata=41]="ChannelMetadata",r[r.ChannelMessage=42]="ChannelMessage",r[r.ChannelHideMessage=43]="ChannelHideMessage",r[r.ChannelMuteUser=44]="ChannelMuteUser",r[r.WikiMergeRequest=818]="WikiMergeRequest",r[r.GenericReply=1111]="GenericReply",r[r.Media=1063]="Media",r[r.DraftCheckpoint=1234]="DraftCheckpoint",r[r.Task=1934]="Task",r[r.Report=1984]="Report",r[r.Label=1985]="Label",r[r.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",r[r.DVMReqTextSummarization=5001]="DVMReqTextSummarization",r[r.DVMReqTextTranslation=5002]="DVMReqTextTranslation",r[r.DVMReqTextGeneration=5050]="DVMReqTextGeneration",r[r.DVMReqImageGeneration=5100]="DVMReqImageGeneration",r[r.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",r[r.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",r[r.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",r[r.DVMReqTimestamping=5900]="DVMReqTimestamping",r[r.DVMEventSchedule=5905]="DVMEventSchedule",r[r.DVMJobFeedback=7e3]="DVMJobFeedback",r[r.Subscribe=7001]="Subscribe",r[r.Unsubscribe=7002]="Unsubscribe",r[r.SubscriptionReceipt=7003]="SubscriptionReceipt",r[r.CashuReserve=7373]="CashuReserve",r[r.CashuQuote=7374]="CashuQuote",r[r.CashuToken=7375]="CashuToken",r[r.CashuWalletTx=7376]="CashuWalletTx",r[r.GroupAdminAddUser=9e3]="GroupAdminAddUser",r[r.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",r[r.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",r[r.GroupAdminEditStatus=9006]="GroupAdminEditStatus",r[r.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",r[r.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",r[r.MuteList=1e4]="MuteList",r[r.PinList=10001]="PinList",r[r.RelayList=10002]="RelayList",r[r.BookmarkList=10003]="BookmarkList",r[r.CommunityList=10004]="CommunityList",r[r.PublicChatList=10005]="PublicChatList",r[r.BlockRelayList=10006]="BlockRelayList",r[r.SearchRelayList=10007]="SearchRelayList",r[r.SimpleGroupList=10009]="SimpleGroupList",r[r.InterestList=10015]="InterestList",r[r.CashuMintList=10019]="CashuMintList",r[r.EmojiList=10030]="EmojiList",r[r.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",r[r.BlossomList=10063]="BlossomList",r[r.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",r[r.TierList=17e3]="TierList",r[r.CashuWallet=17375]="CashuWallet",r[r.FollowSet=3e4]="FollowSet",r[r.CategorizedPeopleList=3e4]="CategorizedPeopleList",r[r.CategorizedBookmarkList=30001]="CategorizedBookmarkList",r[r.RelaySet=30002]="RelaySet",r[r.CategorizedRelayList=30002]="CategorizedRelayList",r[r.BookmarkSet=30003]="BookmarkSet",r[r.CurationSet=30004]="CurationSet",r[r.ArticleCurationSet=30004]="ArticleCurationSet",r[r.VideoCurationSet=30005]="VideoCurationSet",r[r.ImageCurationSet=30006]="ImageCurationSet",r[r.InterestSet=30015]="InterestSet",r[r.InterestsList=30015]="InterestsList",r[r.ProjectTemplate=30717]="ProjectTemplate",r[r.EmojiSet=30030]="EmojiSet",r[r.ModularArticle=30040]="ModularArticle",r[r.ModularArticleItem=30041]="ModularArticleItem",r[r.Wiki=30818]="Wiki",r[r.Draft=31234]="Draft",r[r.Project=31933]="Project",r[r.SubscriptionTier=37001]="SubscriptionTier",r[r.EcashMintRecommendation=38e3]="EcashMintRecommendation",r[r.CashuMintAnnouncement=38172]="CashuMintAnnouncement",r[r.FedimintMintAnnouncement=38173]="FedimintMintAnnouncement",r[r.P2POrder=38383]="P2POrder",r[r.HighlightSet=39802]="HighlightSet",r[r.CategorizedHighlightList=39802]="CategorizedHighlightList",r[r.Nutzap=9321]="Nutzap",r[r.ZapRequest=9734]="ZapRequest",r[r.Zap=9735]="Zap",r[r.Highlight=9802]="Highlight",r[r.ClientAuth=22242]="ClientAuth",r[r.NostrWalletConnectReq=23194]="NostrWalletConnectReq",r[r.NostrWalletConnectRes=23195]="NostrWalletConnectRes",r[r.NostrConnect=24133]="NostrConnect",r[r.BlossomUpload=24242]="BlossomUpload",r[r.HttpAuth=27235]="HttpAuth",r[r.ProfileBadge=30008]="ProfileBadge",r[r.BadgeDefinition=30009]="BadgeDefinition",r[r.MarketStall=30017]="MarketStall",r[r.MarketProduct=30018]="MarketProduct",r[r.Article=30023]="Article",r[r.AppSpecificData=30078]="AppSpecificData",r[r.Classified=30402]="Classified",r[r.HorizontalVideo=34235]="HorizontalVideo",r[r.VerticalVideo=34236]="VerticalVideo",r[r.GroupMetadata=39e3]="GroupMetadata",r[r.GroupAdmins=39001]="GroupAdmins",r[r.GroupMembers=39002]="GroupMembers",r[r.FollowPack=39089]="FollowPack",r[r.MediaFollowPack=39092]="MediaFollowPack",r[r.AppRecommendation=31989]="AppRecommendation",r[r.AppHandler=31990]="AppHandler",r))(NDKKind||{});function getRelaysForSync(r,t,n="write"){if(!r.outboxTracker)return;const s=r.outboxTracker.data.get(t);if(s)return n==="write"?s.writeRelays:s.readRelays}async function getWriteRelaysFor(r,t,n="write"){if(r.outboxTracker)return r.outboxTracker.data.has(t)||await r.outboxTracker.trackUsers([t]),getRelaysForSync(r,t,n)}function getTopRelaysForAuthors(r,t){const n=new Map;return t.forEach(o=>{const a=getRelaysForSync(r,o);a&&a.forEach(c=>{const f=n.get(c)||0;n.set(c,f+1)})}),Array.from(n.entries()).sort((o,a)=>a[1]-o[1]).map(o=>o[0])}function getAllRelaysForAllPubkeys(r,t,n="read"){const s=new Map,o=new Set;return t.forEach(a=>{const c=getRelaysForSync(r,a,n);c&&c.size>0?(c.forEach(f=>{(s.get(f)||new Set).add(a)}),s.set(a,c)):o.add(a)}),{pubkeysToRelays:s,authorsMissingRelays:o}}function chooseRelayCombinationForPubkeys(r,t,n,{count:s,preferredRelays:o}={}){s??=2,o??=new Set;const a=r.pool,c=a.connectedRelays();c.forEach(q=>{o?.add(q.url)});const f=new Map,{pubkeysToRelays:g,authorsMissingRelays:b}=getAllRelaysForAllPubkeys(r,t,n),_=getTopRelaysForAuthors(r,t),L=(q,X)=>{const te=f.get(X)||[];te.push(q),f.set(X,te)};for(const[q,X]of g.entries()){let te=s;const ne=new Set;for(const Ce of c)X.has(Ce.url)&&(L(q,Ce.url),ne.add(Ce.url),te--);for(const Ce of X)ne.has(Ce)||f.has(Ce)&&(L(q,Ce),ne.add(Ce),te--);if(!(te<=0))for(const Ce of _){if(te<=0)break;ne.has(Ce)||X.has(Ce)&&(L(q,Ce),ne.add(Ce),te--)}}for(const q of b)a.permanentAndConnectedRelays().forEach(X=>{const te=f.get(X.url)||[];te.push(q),f.set(X.url,te)});return f}function tryNormalizeRelayUrl(r){try{return normalizeRelayUrl(r)}catch{return}}function normalizeRelayUrl(r){let t=normalizeUrl(r,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(r,t)=>t.some(n=>n instanceof RegExp?n.test(r):n===r),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=r=>{try{const{protocol:t}=new URL(r);return t.endsWith(":")&&!t.includes(".")&&!supportedProtocols.has(t)}catch{return!1}},normalizeDataURL=(r,{stripHash:t})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(r);if(!n)throw new Error(`Invalid URL: ${r}`);const s=n.groups?.type??"",o=n.groups?.data??"";let a=n.groups?.hash??"";const c=s.split(";");a=t?"":a;let f=!1;c[c.length-1]==="base64"&&(c.pop(),f=!0);const g=c.shift()?.toLowerCase()??"",_=[...c.map(L=>{let[q,X=""]=L.split("=").map(te=>te.trim());return q==="charset"&&(X=X.toLowerCase(),X===DATA_URL_DEFAULT_CHARSET)?"":`${q}${X?`=${X}`:""}`}).filter(Boolean)];return f&&_.push("base64"),(_.length>0||g&&g!==DATA_URL_DEFAULT_MIME_TYPE)&&_.unshift(g),`data:${_.join(";")},${f?o.trim():o}${a?`#${a}`:""}`};function normalizeUrl(r,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),r=r.trim(),/^data:/i.test(r))return normalizeDataURL(r,t);if(hasCustomProtocol(r))return r;const n=r.startsWith("//");!n&&/^\.*\//.test(r)||(r=r.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const o=new URL(r);if(o.hostname=o.hostname.toLowerCase(),t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&o.protocol==="https:"&&(o.protocol="http:"),t.forceHttps&&o.protocol==="http:"&&(o.protocol="https:"),t.stripAuthentication&&(o.username="",o.password=""),t.stripHash?o.hash="":t.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname){const c=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let f=0,g="";for(;;){const _=c.exec(o.pathname);if(!_)break;const L=_[0],q=_.index,X=o.pathname.slice(f,q);g+=X.replace(/\/{2,}/g,"/"),g+=L,f=q+L.length}const b=o.pathname.slice(f,o.pathname.length);g+=b.replace(/\/{2,}/g,"/"),o.pathname=g}if(o.pathname)try{o.pathname=decodeURI(o.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let c=o.pathname.split("/");const f=c[c.length-1];testParameter(f,t.removeDirectoryIndex)&&(c=c.slice(0,-1),o.pathname=`${c.slice(1).join("/")}/`)}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const c of[...o.searchParams.keys()])testParameter(c,t.removeQueryParameters)&&o.searchParams.delete(c);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(o.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const c of[...o.searchParams.keys()])testParameter(c,t.keepQueryParameters)||o.searchParams.delete(c);if(t.sortQueryParameters){o.searchParams.sort();try{o.search=decodeURIComponent(o.search)}catch{}}t.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,"")),t.removeExplicitPort&&o.port&&(o.port="");const a=r;return r=o.toString(),!t.removeSingleSlash&&o.pathname==="/"&&!a.endsWith("/")&&o.hash===""&&(r=r.replace(/\/$/,"")),(t.removeTrailingSlash||o.pathname==="/")&&o.hash===""&&t.removeSingleSlash&&(r=r.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(r=r.replace(/^http:\/\//,"//")),t.stripProtocol&&(r=r.replace(/^(?:https?:)?\/\//,"")),r}var NDKRelayKeepalive=class{constructor(r=3e4,t){this.onSilenceDetected=t,this.timeout=r}lastActivity=Date.now();timer;timeout;isRunning=!1;recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const r=Date.now()-this.lastActivity;if(r>=this.timeout)this.onSilenceDetected();else{const t=this.timeout-r;this.timer=setTimeout(()=>{this.onSilenceDetected()},t)}},this.timeout)}};async function probeRelayConnection(r){const t=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(n=>{let s=!1;const o=setTimeout(()=>{s||(s=!0,r.send(["CLOSE",t]),n(!1))},5e3),a=()=>{s||(s=!0,clearTimeout(o),r.send(["CLOSE",t]),n(!0))};r.once("message",a),r.send(["REQ",t,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;netDebug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;pendingAuthPublishes=new Map;serial=0;baseEoseTimeout=4400;keepalive;wsStateMonitor;sleepDetector;lastSleepCheck=Date.now();lastMessageSent=Date.now();wasIdle=!1;constructor(r,t){this.ndkRelay=r,this._status=1;const n=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${n}`),this.ndk=t,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive(12e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection({send:t=>this.send(JSON.stringify(t)),once:(t,n)=>{const s=o=>{try{const a=JSON.parse(o.data);(a[0]==="EOSE"||a[0]==="EVENT"||a[0]==="NOTICE")&&(n(),this.ws?.removeEventListener("message",s))}catch{}};this.ws?.addEventListener("message",s)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const r=Date.now(),t=r-this.lastSleepCheck;t>15e3&&(this.debug(`Detected possible sleep/wake (${t}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=r},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection({send:r=>this.send(JSON.stringify(r)),once:(r,t)=>{const n=s=>{try{const o=JSON.parse(s.data);(o[0]==="EOSE"||o[0]==="EVENT"||o[0]==="NOTICE")&&(t(),this.ws?.removeEventListener("message",n))}catch{}};this.ws?.addEventListener("message",n)}}).then(r=>{r||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(r,t=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),r??=this.timeoutMs,!this.timeoutMs&&r&&(this.timeoutMs=r),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(t),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(n){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,n),this._status=1,t?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2880*60*1e3),n}}disconnect(){this._status=0,this.keepalive?.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{this.ws?.close()}catch(r){this.debug("Failed to disconnect",r),this._status=1}}onConnectionError(r){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),r&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.netDebug?.("connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.keepalive?.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.netDebug?.("disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this.keepalive?.stop(),this.clearPendingPublishes(new Error(`Relay ${this.ndkRelay.url} disconnected`)),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(r){this.netDebug?.(r.data,this.ndkRelay,"recv"),this.keepalive?.recordActivity();try{const t=JSON.parse(r.data),[n,s,...o]=t,a=this.ndkRelay.getProtocolHandler(n);if(a){a(this.ndkRelay,t);return}switch(n){case"EVENT":{const c=this.openSubs.get(s),f=t[2];if(!c){this.debug(`Received event for unknown subscription ${s}`);return}c.onevent(f);return}case"COUNT":{const c=t[2],f=this.openCountRequests.get(s);f&&(f.resolve(c.count),this.openCountRequests.delete(s));return}case"EOSE":{const c=this.openSubs.get(s);if(!c)return;c.oneose(s);return}case"OK":{const c=t[2],f=t[3],g=this.openEventPublishes.get(s),b=g?.pop();if(!g||!b){this.debug("Received OK for unknown event publish",s);return}c?(b.resolve(f),this.pendingAuthPublishes.delete(s)):f&&(f.toLowerCase().includes("auth-required")||f.toLowerCase().includes("not authorized")||f.toLowerCase().includes("blocked: not authorized"))?this.pendingAuthPublishes.get(s)?(this.debug("Publish failed due to auth-required, will retry after auth",s),g.push(b),this.openEventPublishes.set(s,g)):b.reject(new Error(f)):(b.reject(new Error(f)),this.pendingAuthPublishes.delete(s)),g.length===0?this.openEventPublishes.delete(s):!c&&!(f?.toLowerCase().includes("auth-required")||f?.toLowerCase().includes("not authorized")||f?.toLowerCase().includes("blocked: not authorized"))&&this.openEventPublishes.set(s,g);return}case"CLOSED":{const c=this.openSubs.get(s);if(!c)return;c.onclosed(t[2]);return}case"NOTICE":this.onNotice(t[1]);return;case"AUTH":{this.onAuthRequested(t[1]);return}}}catch(t){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t?.stack);return}}async onAuthRequested(r){const t=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!t}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,t){if(this._status>=5){this._status=7;let n;try{n=await t(this.ndkRelay,r)}catch(s){this.debug("Authentication policy threw an error",s),n=!1}if(this.debug("Authentication policy returned",!!n),n instanceof NDKEvent||n===!0){n instanceof NDKEvent&&await this.auth(n);const s=async()=>{if(this._status>=5&&this._status<8){const o=new NDKEvent(this.ndk);o.kind=22242,o.tags=[["relay",this.ndkRelay.url],["challenge",r]],await o.sign(),this.auth(o).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful"),this.retryPendingAuthPublishes()}).catch(a=>{this._status=6,this.ndkRelay.emit("auth:failed",a),this.debug("Authentication failed",a),this.rejectPendingAuthPublishes(a)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};n===!0&&(this.ndk?.signer?s().catch(o=>{console.error("Error authenticating",o)}):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",s))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",r)}onError(r){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,r)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const r=this._connectionStats.durations;if(r.length%3!==0)return!1;const n=r.reduce((c,f)=>c+f,0)/r.length,s=r.map(c=>(c-n)**2).reduce((c,f)=>c+f,0)/r.length;return Math.sqrt(s)<FLAPPING_THRESHOLD_MS}async onNotice(r){this.ndkRelay.emit("notice",r)}handleReconnection(r=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let t;if(this.wasIdle){const n=[0,1e3,2e3,5e3,1e4,3e4];t=n[Math.min(r,n.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${r}, delay ${t}ms`)}else this.connectedAt?t=Math.max(0,6e4-(Date.now()-this.connectedAt)):(t=Math.min(1e3*2**r,3e4),this.debug(`Using standard backoff, attempt ${r}, delay ${t}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(n=>{r<MAX_RECONNECT_ATTEMPTS?this.handleReconnection(r+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},t),this.ndkRelay.emit("delayed-connect",t),this.debug("Reconnecting in",t),this._connectionStats.nextReconnectAt=Date.now()+t}async send(r){Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&this.ws?.readyState===WebSocket.OPEN?(this.ws?.send(r),this.netDebug?.(r,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${r}`,this._status),this._status>=5&&this.ws?.readyState!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${this.ws?.readyState}`),this.handleStaleConnection()))}async auth(r){const t=new Promise((n,s)=>{const o=this.openEventPublishes.get(r.id)??[];o.push({resolve:n,reject:s}),this.openEventPublishes.set(r.id,o)});return this.send(`["AUTH",${JSON.stringify(r.rawEvent())}]`),t}clearPendingPublishes(r){this.rejectPendingAuthPublishes(r);for(const[t,n]of this.openEventPublishes.entries()){for(;n.length>0;){const s=n.shift();s&&s.reject(r)}this.openEventPublishes.delete(t)}}retryPendingAuthPublishes(){if(this.pendingAuthPublishes.size!==0){this.debug(`Retrying ${this.pendingAuthPublishes.size} pending publishes after auth`);for(const[r,t]of this.pendingAuthPublishes.entries())this.debug(`Retrying publish for event ${r}`),this.send(`["EVENT",${JSON.stringify(t)}]`);this.pendingAuthPublishes.clear()}}rejectPendingAuthPublishes(r){if(this.pendingAuthPublishes.size!==0){this.debug(`Rejecting ${this.pendingAuthPublishes.size} pending publishes due to auth failure`);for(const[t]of this.pendingAuthPublishes.entries()){const n=this.openEventPublishes.get(t);if(n&&n.length>0){const s=n.pop();s&&s.reject(new Error(`Authentication failed: ${r.message}`)),n.length===0&&this.openEventPublishes.delete(t)}}this.pendingAuthPublishes.clear()}}async publish(r){const t=new Promise((n,s)=>{const o=this.openEventPublishes.get(r.id)??[];o.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${r.id} twice`),o.push({resolve:n,reject:s}),this.openEventPublishes.set(r.id,o)});return this.pendingAuthPublishes.set(r.id,r),this.send(`["EVENT",${JSON.stringify(r)}]`),t}async count(r,t){this.serial++;const n=t?.id||`count:${this.serial}`,s=new Promise((o,a)=>{this.openCountRequests.set(n,{resolve:o,reject:a})});return this.send(`["COUNT","${n}",${JSON.stringify(r).substring(1)}`),s}close(r,t){this.send(`["CLOSE","${r}"]`);const n=this.openSubs.get(r);this.openSubs.delete(r),n&&n.onclose(t)}req(r){`${this.send(`["REQ","${r.subId}",${JSON.stringify(r.executeFilters).substring(1)}`)}`,this.openSubs.set(r.subId,r)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}};async function fetchRelayInformation(r){const t=r.replace(/^wss:\/\//,"https://").replace(/^ws:\/\//,"http://"),n=await fetch(t,{headers:{Accept:"application/nostr+json"}});if(!n.ok)throw new Error(`Failed to fetch relay information: ${n.status} ${n.statusText}`);return await n.json()}var NDKRelayPublisher=class{ndkRelay;debug;constructor(r){this.ndkRelay=r,this.debug=r.debug.extend("publisher")}async publish(r,t=2500){let n;const s=()=>new Promise((_,L)=>{try{this.publishEvent(r).then(q=>{this.ndkRelay.emit("published",r),r.emit("relay:published",this.ndkRelay),_(!0)}).catch(L)}catch(q){L(q)}}),o=new Promise((_,L)=>{n=setTimeout(()=>{n=void 0,L(new Error(`Timeout: ${t}ms`))},t)}),a=()=>{s().then(_=>c(_)).catch(_=>f(_))};let c,f;const g=_=>{throw this.ndkRelay.debug("Publish failed",_,r.id),this.ndkRelay.emit("publish:failed",r,_),r.emit("relay:publish:failed",this.ndkRelay,_),_},b=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",a)};return this.ndkRelay.status>=5?Promise.race([s(),o]).catch(g).finally(b):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((_,L)=>{c=_,f=L,this.ndkRelay.on("connect",a)}),o]).catch(g).finally(b))}async publishEvent(r){return this.ndkRelay.connectivity.publish(r.rawEvent())}};function filterFingerprint(r,t){const n=[];for(const o of r){const a=Object.entries(o||{}).map(([c,f])=>["since","until"].includes(c)?`${c}:${f}`:c).sort().join("-");n.push(a)}let s=t?"+":"";return s+=n.join("|"),s}function mergeFilters(r){const t=[],n={};return r.filter(s=>!!s.limit).forEach(s=>t.push(s)),r=r.filter(s=>!s.limit),r.length===0?t:(r.forEach(s=>{Object.entries(s).forEach(([o,a])=>{Array.isArray(a)?n[o]===void 0?n[o]=[...a]:n[o]=Array.from(new Set([...n[o],...a])):n[o]=a})}),[...t,n])}var MAX_ITEMS=3;function formatArray(r,t){const s=(t?r.slice(0,MAX_ITEMS).map(t):r.slice(0,MAX_ITEMS)).join(",");return r.length>MAX_ITEMS?`${s}+${r.length-MAX_ITEMS}`:s}function formatFilters(r){return r.map(t=>{const n=[];t.ids?.length&&n.push(`ids:[${formatArray(t.ids,s=>String(s).slice(0,8))}]`),t.kinds?.length&&n.push(`kinds:[${formatArray(t.kinds)}]`),t.authors?.length&&n.push(`authors:[${formatArray(t.authors,s=>String(s).slice(0,8))}]`),t.since&&n.push(`since:${t.since}`),t.until&&n.push(`until:${t.until}`),t.limit&&n.push(`limit:${t.limit}`),t.search&&n.push(`search:"${String(t.search).slice(0,20)}"`);for(const[s,o]of Object.entries(t))s.startsWith("#")&&Array.isArray(o)&&o.length>0&&n.push(`${s}:[${formatArray(o,a=>String(a).slice(0,8))}]`);return`{${n.join(" ")}}`}).join(", ")}var NDKRelaySubscription=class{fingerprint;items=new Map;topSubManager;debug;status=0;onClose;relay;eosed=!1;executionTimer;fireTime;delayType;executeFilters;id=Math.random().toString(36).substring(7);constructor(r,t,n){this.relay=r,this.topSubManager=n,this.debug=r.debug.extend(`sub[${this.id}]`),this.fingerprint=t||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}subIdParts=new Set;addSubIdPart(r){this.subIdParts.add(r)}addItem(r,t){if(this.debug("Adding item",{filters:formatFilters(t),internalId:r.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,itemsSize:this.items.size}),!this.items.has(r.internalId))switch(r.on("close",this.removeItem.bind(this,r)),this.items.set(r.internalId,{subscription:r,filters:t}),this.status!==3&&r.subId&&(!this._subId||this._subId.length<25)&&(this.status===0||this.status===1)&&this.addSubIdPart(r.subId),this.status){case 0:this.evaluateExecutionPlan(r);break;case 3:break;case 1:this.evaluateExecutionPlan(r);break;case 4:throw this.debug("Subscription is closed, cannot add new items",{filters:formatFilters(t),subId:r.subId,internalId:r.internalId}),new Error("Cannot add new items to a closed subscription")}}removeItem(r){if(this.items.delete(r.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const r=this.status;if(this.status=4,r===3)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:r,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(r){if(!r.isGroupable()){this.status=1,this.execute();return}if(r.filters.find(s=>!!s.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const t=r.groupableDelay,n=r.groupableDelayType;if(!t)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(t,n);else{const s=this.delayType,o=this.fireTime-Date.now();if(s==="at-least"&&n==="at-least")o<t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-least"&&n==="at-most")o>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-most"&&n==="at-most")o>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-most"&&n==="at-least")o>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else throw new Error(`Unknown delay type combination ${s} ${n}`)}}schedule(r,t){this.status=1;const n=Date.now();this.fireTime=n+r,this.delayType=t;const s=setTimeout(this.execute.bind(this),r);t==="at-least"&&(this.executionTimer=s)}executeOnRelayReady=()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size,filters:formatFilters(this.compileFilters())}),this.status=1,this.execute()}};finalizeSubId(){if(this.subIdParts.size>0){let t=Array.from(this.subIdParts).map(n=>n.substring(0,10)).join("-");t.length>20&&(t=t.substring(0,20)),this._subId=t}else this._subId=this.fingerprint.slice(0,15);this._subId+=`-${Math.random().toString(36).substring(2,7)}`}reExecuteAfterAuth=(()=>{const r=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:r}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",r,this.subId)}).bind(this);execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(r){this.topSubManager.dispatchEvent(r,this.relay)}oneose(r){if(this.eosed=!0,r!==this.subId){this.debug("Received EOSE for an abandoned subscription",r,this.subId),this.relay.close(r);return}this.items.size===0&&this.close();for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:formatFilters(t.filters),internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,itemsSize:this.items.size}),this.removeItem(t))}onclose(r){this.status=4}onclosed(r){if(r)for(const{subscription:t}of this.items.values())t.closedReceived(this.relay,r)}compileFilters(){const r=[],t=Array.from(this.items.values()).map(s=>s.filters);if(!t[0])return this.debug(" No filters to merge",{itemsSize:this.items.size}),[];const n=t[0].length;for(let s=0;s<n;s++){const o=t.map(c=>c[s]),a=mergeFilters(o);r.push(...a)}return r}},NDKRelaySubscriptionManager=class{relay;subscriptions;generalSubManager;constructor(r,t){this.relay=r,this.subscriptions=new Map,this.generalSubManager=t}addSubscription(r,t){let n;if(!r.isGroupable())n=this.createSubscription(r,t);else{const s=filterFingerprint(t,r.closeOnEose);s&&(n=(this.subscriptions.get(s)||[]).find(a=>a.status<3)),n??=this.createSubscription(r,t,s)}n.addItem(r,t)}createSubscription(r,t,n){const s=new NDKRelaySubscription(this.relay,n||null,this.generalSubManager);s.onClose=this.onRelaySubscriptionClose.bind(this);const o=this.subscriptions.get(s.fingerprint)??[];return this.subscriptions.set(s.fingerprint,[...o,s]),s}onRelaySubscriptionClose(r){let t=this.subscriptions.get(r.fingerprint)??[];t?t.length===1?this.subscriptions.delete(r.fingerprint):(t=t.filter(n=>n.id!==r.id),this.subscriptions.set(r.fingerprint,t)):console.warn("Unexpectedly did not find a subscription with fingerprint",r.fingerprint)}},NDKRelay=class Ao extends libExports.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;protocolHandlers=new Map;_relayInfo;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,n,s)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let o=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const a=n/100;o=Math.max(t.lowestValidationRatio,t.validationRatio-a)}return o<t.validationRatio?o:t.validationRatio};constructor(t,n,s){super(),this.url=normalizeRelayUrl(t),this.scores=new Map,this.debug=createDebug$1(`ndk:relay:${t}`),this.connectivity=new NDKRelayConnectivity(this,s),this.connectivity.netDebug=s?.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,s.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=n,this.targetValidationRatio=s?.initialValidationRatio,this.lowestValidationRatio=s?.lowestValidationRatio,this.validationRatioFn=(s?.validationRatioFn??Ao.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const t=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=t}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,n=!0){return this.connectivity.connect(t,n)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,n){this.subs.addSubscription(t,n)}async publish(t,n=2500){return this.publisher.publish(t,n)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}req;close;registerProtocolHandler(t,n){this.protocolHandlers.set(t,n)}unregisterProtocolHandler(t){this.protocolHandlers.delete(t)}getProtocolHandler(t){return this.protocolHandlers.get(t)}async fetchInfo(t=!1){const s=this.connectivity.ndk;if(!t&&s?.cacheAdapter?.getRelayStatus){const o=await s.cacheAdapter.getRelayStatus(this.url);if(o?.nip11&&Date.now()-o.nip11.fetchedAt<864e5)return this._relayInfo=o.nip11.data,o.nip11.data}return!t&&this._relayInfo?this._relayInfo:(this._relayInfo=await fetchRelayInformation(this.url),s?.cacheAdapter?.updateRelayStatus&&await s.cacheAdapter.updateRelayStatus(this.url,{nip11:{data:this._relayInfo,fetchedAt:Date.now()}}),this._relayInfo)}get info(){return this._relayInfo}},NDKPublishError=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(r,t,n,s){super(r),this.errors=t,this.publishedToRelays=n,this.intendedRelaySet=s}get relayErrors(){const r=[];for(const[t,n]of this.errors)r.push(`${t.url}: ${n}`);return r.join(`
`)}},NDKRelaySet=class To{relays;debug;ndk;pool;constructor(t,n,s){this.relays=t,this.ndk=n,this.pool=s??n.pool,this.debug=n.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,n,s=!0,o){if(o=o??n.pool,!o)throw new Error("No pool provided");const a=new Set;for(const c of t){const f=o.relays.get(normalizeRelayUrl(c));if(f)f.status<5&&s&&f.connect(),a.add(f);else{const g=new NDKRelay(normalizeRelayUrl(c),n?.relayAuthDefaultPolicy,n);o.useTemporaryRelay(g,void 0,`requested from fromRelayUrls ${t}`),a.add(g)}}return new To(new Set(a),n,o)}async publish(t,n,s=1){const o=new Set,a=new Map,c=t.isEphemeral();t.publishStatus="pending";const f=g=>{o.add(g)};t.on("relay:published",f);try{const g=Array.from(this.relays).map(b=>new Promise(_=>{const L=n?setTimeout(()=>{o.has(b)||(a.set(b,new Error(`Publish timeout after ${n}ms`)),_(!1))},n):null;b.publish(t,n).then(q=>{L&&clearTimeout(L),q?(o.add(b),_(!0)):_(!1)}).catch(q=>{L&&clearTimeout(L),c||a.set(b,q),_(!1)})}));if(await Promise.all(g),o.size<s){if(!c){const b=new NDKPublishError("Not enough relays received the event ("+o.size+" published, "+s+" required)",a,o,this);throw t.publishStatus="error",t.publishError=b,this.ndk?.emit("event:publish-failed",t,b,this.relayUrls),b}}else t.publishStatus="success",t.emit("published",{relaySet:this,publishedToRelays:o});return o}finally{t.off("relay:published",f)}}get size(){return this.relays.size}},d=createDebug$1("ndk:outbox:calculate");async function calculateRelaySetFromEvent(r,t,n){const s=new Set,o=await getWriteRelaysFor(r,t.pubkey);o&&o.forEach(f=>{const g=r.pool?.getRelay(f);g&&s.add(g)});let a=t.tags.filter(f=>["a","e"].includes(f[0])).map(f=>f[2]).filter(f=>f?.startsWith("wss://")).filter(f=>{try{return new URL(f),!0}catch{return!1}}).map(f=>normalizeRelayUrl(f));a=Array.from(new Set(a)).slice(0,5),a.forEach(f=>{const g=r.pool?.getRelay(f,!0,!0);g&&(d("Adding relay hint %s",f),s.add(g))});const c=t.getMatchingTags("p").map(f=>f[1]);return c.length<5?Array.from(chooseRelayCombinationForPubkeys(r,c,"read",{preferredRelays:new Set(o)}).keys()).forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d("Adding p-tagged relay %s",g),s.add(b))}):d("Too many p-tags to consider %d",c.length),r.pool?.permanentAndConnectedRelays().forEach(f=>s.add(f)),n&&s.size<n&&r.explicitRelayUrls?.filter(g=>!Array.from(s).some(b=>b.url===g)).slice(0,n-s.size)?.forEach(g=>{const b=r.pool?.getRelay(g,!1,!0);b&&(d("Adding explicit relay %s",g),s.add(b))}),new NDKRelaySet(s,r)}function isValidHex64(r){if(typeof r!="string"||r.length!==64)return!1;for(let t=0;t<64;t++){const n=r.charCodeAt(t);if(!(n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70))return!1}return!0}function isValidPubkey(r){return isValidHex64(r)}function mergeTags(r,t){const n=new Map,s=c=>c.join(","),o=(c,f)=>c.every((g,b)=>g===f[b]),a=c=>{for(const[f,g]of n)if(o(g,c)||o(c,g)){c.length>=g.length&&n.set(f,c);return}n.set(s(c),c)};return r.concat(t).forEach(a),Array.from(n.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(r){const t=r.match(hashtagRegex),n=new Set,s=new Set;if(t)for(const o of t)n.has(o.slice(1))||(s.add(o.slice(1)),n.add(o.slice(1)));return Array.from(s)}async function generateContentTags(r,t=[],n,s){if(n?.skipContentTagging)return{content:r,tags:t};const o=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,a=[],c=f=>{t.find(g=>["q",f[0]].includes(g[0])&&g[1]===f[1])||t.push(f)};if(r=r.replace(o,f=>{try{const g=f.split(/(@|nostr:)/)[2],{type:b,data:_}=nip19_exports$1.decode(g);let L;if(n?.filters){const q=!n.filters.includeTypes||n.filters.includeTypes.includes(b),X=n.filters.excludeTypes?.includes(b);if(!q||X)return f}switch(b){case"npub":n?.pTags!==!1&&(L=["p",_]);break;case"nprofile":n?.pTags!==!1&&(L=["p",_.pubkey]);break;case"note":a.push(new Promise(async q=>{const X=await maybeGetEventRelayUrl(g);c(["q",_,X]),q()}));break;case"nevent":a.push(new Promise(async q=>{const{id:X,author:te}=_;let{relays:ne}=_;(!ne||ne.length===0)&&(ne=[await maybeGetEventRelayUrl(g)]),c(["q",X,ne[0]]),te&&n?.pTags!==!1&&n?.pTagOnQTags!==!1&&c(["p",te]),q()}));break;case"naddr":a.push(new Promise(async q=>{const X=[_.kind,_.pubkey,_.identifier].join(":");let te=_.relays??[];te.length===0&&(te=[await maybeGetEventRelayUrl(g)]),c(["q",X,te[0]]),n?.pTags!==!1&&n?.pTagOnQTags!==!1&&n?.pTagOnATags!==!1&&c(["p",_.pubkey]),q()}));break;default:return f}return L&&c(L),`nostr:${g}`}catch{return f}}),await Promise.all(a),!n?.filters?.excludeTypes?.includes("hashtag")){const f=generateHashtags(r).map(g=>["t",g]);t=mergeTags(t,f)}if(n?.pTags!==!1&&n?.copyPTagsFromTarget&&s){const f=s.getMatchingTags("p");for(const g of f)!g[1]||!isValidPubkey(g[1])||t.find(b=>b[0]==="p"&&b[1]===g[1])||t.push(g)}return{content:r,tags:t}}async function maybeGetEventRelayUrl(r){return""}async function encrypt(r,t,n="nip44"){let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||(()=>{const c=this.getMatchingTags("p");if(c.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:c[0][1]})})();if(n==="nip44"&&await isEncryptionEnabled(o,"nip44")&&(s=await o.encrypt(a,this.content,"nip44")),(!s||n==="nip04")&&await isEncryptionEnabled(o,"nip04")&&(s=await o.encrypt(a,this.content,"nip04")),!s)throw new Error("Failed to encrypt event.");this.content=s}async function decrypt(r,t,n){if(this.ndk?.cacheAdapter?.getDecryptedEvent){const f=await this.ndk.cacheAdapter.getDecryptedEvent(this.id);if(f){this.content=f.content;return}}let s;if(!this.ndk)throw new Error("No NDK instance found!");let o=t;if(o||(this.ndk.assertSigner(),o=this.ndk.signer),!o)throw new Error("no NDK signer");const a=r||this.author;if(!a)throw new Error("No sender provided and no author available");const c=n||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((c==="nip04"||this.kind===4)&&await isEncryptionEnabled(o,"nip04")&&this.content.search("\\?iv=")&&(s=await o.decrypt(a,this.content,"nip04")),!s&&c==="nip44"&&await isEncryptionEnabled(o,"nip44")&&(s=await o.decrypt(a,this.content,"nip44")),!s)throw new Error("Failed to decrypt event.");this.content=s,this.ndk?.cacheAdapter?.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this.id,this)}async function isEncryptionEnabled(r,t){return r.encryptionEnabled?t?!!await r.encryptionEnabled(t):!0:!1}function eventHasETagMarkers(r){for(const t of r.tags)if(t[0]==="e"&&(t[3]??"").length>0)return!0;return!1}function getRootTag(r,t){t??=r.tagType();const n=r.tags.find(isTagRootTag);if(!n){if(eventHasETagMarkers(r))return;const s=r.getMatchingTags(t);if(s.length<3)return s[0]}return n}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(r,t){if(r.kind===1111){let o;for(const a of r.tags)if(nip22RootTags.has(a[0]))o=a;else if(nip22ReplyTags.has(a[0])){o=a;break}return o}t??=r.tagType();let n=!1,s;for(const o of r.tags)if(o[0]===t){if((o[3]??"").length>0&&(n=!0),n&&o[3]==="reply")return o;n&&o[3]==="root"&&(s=o),n||(s=o)}return s}function isTagRootTag(r){return r[0]==="E"||r[3]==="root"}async function fetchTaggedEvent(r,t){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(r,t);if(n.length===0)return;const[s,o,a]=n[0],c=a!==""?this.ndk.pool.getRelay(a):void 0;return await this.ndk.fetchEvent(o,{},c)}async function fetchRootEvent(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getRootTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}async function fetchReplyEvent(r){if(!this.ndk)throw new Error("NDK instance not found");const t=getReplyTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,r)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode(r=DEFAULT_RELAY_COUNT){let t=[];return this.onRelays.length>0?t=this.onRelays.map(n=>n.url):this.relay&&(t=[this.relay.url]),t.length>r&&(t=t.slice(0,r)),this.isParamReplaceable()?nip19_exports$1.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?nip19_exports$1.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):nip19_exports$1.noteEncode(this.tagId())}async function repost(r=!0,t){if(!t&&r){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const n=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(n.content=JSON.stringify(this.rawEvent())),n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),t&&await n.sign(t),r&&await n.publish(),n}function getKind(r){return r.kind===1?6:16}function getEventDetails(r){return"inspect"in r&&typeof r.inspect=="string"?r.inspect:JSON.stringify(r)}function validateForSerialization(r){if(typeof r.kind!="number")throw new Error(`Can't serialize event with invalid properties: kind (must be number, got ${typeof r.kind}). Event: ${getEventDetails(r)}`);if(typeof r.content!="string")throw new Error(`Can't serialize event with invalid properties: content (must be string, got ${typeof r.content}). Event: ${getEventDetails(r)}`);if(typeof r.created_at!="number")throw new Error(`Can't serialize event with invalid properties: created_at (must be number, got ${typeof r.created_at}). Event: ${getEventDetails(r)}`);if(typeof r.pubkey!="string")throw new Error(`Can't serialize event with invalid properties: pubkey (must be string, got ${typeof r.pubkey}). Event: ${getEventDetails(r)}`);if(!Array.isArray(r.tags))throw new Error(`Can't serialize event with invalid properties: tags (must be array, got ${typeof r.tags}). Event: ${getEventDetails(r)}`);for(let t=0;t<r.tags.length;t++){const n=r.tags[t];if(!Array.isArray(n))throw new Error(`Can't serialize event with invalid properties: tags[${t}] (must be array, got ${typeof n}). Event: ${getEventDetails(r)}`);for(let s=0;s<n.length;s++)if(typeof n[s]!="string")throw new Error(`Can't serialize event with invalid properties: tags[${t}][${s}] (must be string, got ${typeof n[s]}). Event: ${getEventDetails(r)}`)}}function serialize(r=!1,t=!1){validateForSerialization(this);const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return r&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}function deserialize(r){const t=JSON.parse(r),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};if(t.length>=7){const s=t[6],o=t[7];s&&s.length===128?(n.sig=s,o&&o.length===64&&(n.id=o)):s&&s.length===64&&(n.id=s,o&&o.length===128&&(n.sig=o))}return n}var processingQueue={};async function verifySignatureAsync(r,t,n){const s=r.ndk,o=Date.now();let a;return s.signatureVerificationFunction?a=await s.signatureVerificationFunction(r):a=await new Promise(c=>{r.serialize();let f=!1;processingQueue[r.id]||(processingQueue[r.id]={event:r,resolves:[],relay:n},f=!0),processingQueue[r.id].resolves.push(c)}),s.signatureVerificationTimeMs+=Date.now()-o,a}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let r=0;r<this.tags.length;r++){const t=this.tags[r];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]=="object")return!1}return!0}var verifiedSignatures=new distExports.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(r){if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const t=verifiedSignatures.get(this.id);if(t!==null)return this.signatureVerified=!!t,this.signatureVerified;try{if(this.ndk?.asyncSigVerification){const n=this.relay;verifySignatureAsync(this,r,n).then(s=>{r&&(this.signatureVerified=s,s&&verifiedSignatures.set(this.id,this.sig)),s?n&&n.addValidatedEvent():(n?this.ndk?.reportInvalidSignature(this,n):this.ndk?.reportInvalidSignature(this),verifiedSignatures.set(this.id,!1))}).catch(s=>{console.error("signature verification error",this.id,s)})}else{const n=sha256(new TextEncoder().encode(this.serialize())),s=schnorr.verify(this.sig,n,this.pubkey);return s?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=s,s}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(r){const t=sha256(new TextEncoder().encode(r));return bytesToHex(t)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class hi extends libExports.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(t,n){super(),this.ndk=t,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof hi&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(t,n){return new hi(t,deserialize(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,n,s){const o=["i"],a=["k"];switch(n){case"url":{const c=new URL(t);c.hash="",o.push(c.toString()),a.push(`${c.protocol}//${c.host}`);break}case"hashtag":o.push(`#${t.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${t.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${t.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${t}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${t}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${t}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${t.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${t.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${n}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(t,n,s,o,a){let c=[];if(t.fetchProfile!==void 0){if(o??="p",o==="p"&&a?.pTags===!1)return;const g=[o,t.pubkey];n&&g.push("",n),c.push(g)}else if(t instanceof hi){const g=t;if(s??=g?.pubkey===this.pubkey,c=g.referenceTags(n,s,o,a),a?.pTags!==!1)for(const b of g.getMatchingTags("p"))!b[1]||!isValidPubkey(b[1])||b[1]!==this.pubkey&&(this.tags.find(_=>_[0]==="p"&&_[1]===b[1])||this.tags.push(["p",b[1]]))}else if(Array.isArray(t))c=[t];else throw new Error("Invalid argument",t);this.tags=mergeTags(this.tags,c)}async toNostrEvent(t,n){if(!t&&this.pubkey===""){const a=await this.ndk?.signer?.user();this.pubkey=a?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:s,tags:o}=await this.generateTags(n);this.content=s||"",this.tags=o;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}serialize=serialize.bind(this);getEventHash=getEventHash.bind(this);validate=validate.bind(this);verifySignature=verifySignature.bind(this);isReplaceable=isReplaceable.bind(this);isEphemeral=isEphemeral.bind(this);isDvm=()=>this.kind&&this.kind>=5e3&&this.kind<=7e3;isParamReplaceable=isParamReplaceable.bind(this);encode=encode.bind(this);encrypt=encrypt.bind(this);decrypt=decrypt.bind(this);getMatchingTags(t,n){const s=this.tags.filter(o=>o[0]===t);return n===void 0?s:s.filter(o=>o[3]===n)}hasTag(t,n){return this.tags.some(s=>s[0]===t&&(!n||s[3]===n))}tagValue(t,n){const s=this.getMatchingTags(t,n);if(s.length!==0)return s[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t,n){const s=Array.isArray(t)?t:[t];this.tags=this.tags.filter(o=>{const a=s.includes(o[0]),c=n?o[3]===n:!0;return!(a&&c)})}replaceTag(t){this.removeTag(t[0]),this.tags.push(t)}async sign(t,n){this.ndk?.aiGuardrails?.event?.signing(this),t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk?.signer);const s=await this.toNostrEvent(void 0,n);return this.sig=await t.sign(s),this.sig}async publishReplaceable(t,n,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,n,s)}async publish(t,n,s,o){if(s||(s=1),this.sig||await this.sign(void 0,o),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if(this.ndk.aiGuardrails?.event?.publishing(this),(!t||t.size===0)&&(t=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this,s)),this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds){const f=this.getMatchingTags("e").map(g=>g[1]);this.ndk.cacheAdapter.deleteEventIds(f)}const a=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(f){console.error("Error adding unpublished event to cache",f)}this.kind===5&&this.ndk.cacheAdapter?.deleteEventIds&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(f=>f[1])),this.ndk.subManager.dispatchEvent(a,void 0,!0);const c=await t.publish(this,n,s);return c.forEach(f=>this.ndk?.subManager.seenEvent(this.id,f)),c}async generateTags(t){let n=[];const s=await generateContentTags(this.content,this.tags,t,this),o=s.content;if(n=s.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const c=this.tagValue("title");let g=[...Array(c?6:16)].map(()=>Math.random().toString(36)[2]).join("");c&&c.length>0&&(g=`${c.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${g}`),n.push(["d",g])}if(this.shouldAddClientTag){const a=["client",this.ndk?.clientName??""];this.ndk?.clientNip89&&a.push(this.ndk?.clientNip89),n.push(a)}else this.shouldStripClientTag&&(n=n.filter(a=>a[0]!=="client"));return{content:o||"",tags:n}}get shouldAddClientTag(){return!(!this.ndk?.clientName&&!this.ndk?.clientNip89||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){return this.ndk?.muteFilter&&this.ndk.muteFilter(this)?"muted":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const t=this.dTag??"";return`${this.kind}:${this.pubkey}:${t}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let n;return this.isParamReplaceable()?n=["a",this.tagAddress()]:n=["e",this.tagId()],this.relay?n.push(this.relay.url):n.push(""),n.push(t??""),this.isParamReplaceable()||n.push(this.pubkey),n}referenceTags(t,n,s,o){let a=[];return this.isParamReplaceable()?a=[[s??"a",this.tagAddress()],[s??"e",this.id]]:a=[[s??"e",this.id]],a=a.map(c=>(c[0]==="e"||t?c.push(this.relay?.url??""):this.relay?.url&&c.push(this.relay?.url),c)),a.forEach(c=>{c[0]==="e"?(c.push(t??""),c.push(this.pubkey)):t&&c.push(t)}),a=[...a,...this.getMatchingTags("h")],!n&&o?.pTags!==!1&&a.push(...this.author.referenceTags()),a}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new hi(this.ndk,{kind:5,content:t||""});return s.tag(this,void 0,!0),s.tags.push(["k",this.kind?.toString()]),n&&(this.emit("deleted"),await s.publish()),s}set isProtected(t){this.removeTag("-"),t&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}fetchTaggedEvent=fetchTaggedEvent.bind(this);fetchRootEvent=fetchRootEvent.bind(this);fetchReplyEvent=fetchReplyEvent.bind(this);repost=repost.bind(this);async react(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new hi(this.ndk,{kind:7,content:t});return s.tag(this),this.kind!==1&&s.tags.push(["k",`${this.kind}`]),n&&await s.publish(),s}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(t=>t.url).join(", "))}reply(t,n){const s=new hi(this.ndk);if(this.ndk?.aiGuardrails?.event?.creatingReply(s),this.kind===1&&!t)s.kind=1,this.hasTag("e")?s.tags=[...s.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,n)]:s.tag(this,"root",!1,void 0,n);else{s.kind=1111;const o=["A","E","I","P"],a=this.tags.filter(c=>o.includes(c[0]));if(a.length>0){const c=this.tagValue("K");s.tags.push(...a),c&&s.tags.push(["K",c]);let f;if(this.isParamReplaceable()){f=["a",this.tagAddress()];const g=this.relay?.url??"";g&&f.push(g)}else{f=["e",this.tagId()];const g=this.relay?.url??"";f.push(g),f.push(this.pubkey)}s.tags.push(f)}else{let c,f;const g=this.relay?.url??"";this.isParamReplaceable()?(c=["a",this.tagAddress(),g],f=["A",this.tagAddress(),g]):(c=["e",this.tagId(),g,this.pubkey],f=["E",this.tagId(),g,this.pubkey]),s.tags.push(c),s.tags.push(f),s.tags.push(["K",this.kind?.toString()]),n?.pTags!==!1&&n?.pTagOnATags!==!1&&s.tags.push(["P",this.pubkey])}s.tags.push(["k",this.kind?.toString()]),n?.pTags!==!1&&(s.tags.push(...this.getMatchingTags("p")),s.tags.push(["p",this.pubkey]))}return s}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(r){return!untrackedUnpublishedEvents.has(r.kind)}var NDKPool=class extends libExports.EventEmitter{_relays=new Map;status="idle";autoConnectRelays=new Set;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;disconnectionTimes=new Map;systemEventDetector;constructor(r,t,{debug:n,name:s}={}){super(),this.debug=n??t.debug.extend("pool"),s&&(this._name=s),this.ndk=t,this.relayUrls=r,this.ndk.pools&&this.ndk.pools.push(this)}get relays(){return this._relays}set relayUrls(r){this._relays.clear();for(const t of r){const n=new NDKRelay(t,void 0,this.ndk);n.connectivity.netDebug=this.ndk.netDebug,this.addRelay(n)}}_name="unnamed";get name(){return this._name}set name(r){this._name=r,this.debug=this.debug.extend(r)}useTemporaryRelay(r,t=3e4,n){const s=this.relays.has(r.url);s||(this.addRelay(r),this.debug("Adding temporary relay %s for filters %o",r.url,n));const o=this.temporaryRelayTimers.get(r.url);if(o&&clearTimeout(o),!s||o){const a=setTimeout(()=>{this.ndk.explicitRelayUrls?.includes(r.url)||this.removeRelay(r.url)},t);this.temporaryRelayTimers.set(r.url,a)}}addRelay(r,t=!0){const n=this.relays.has(r.url),s=r.url.includes("/npub1");let o=!0;const a=r.url;if(n)return;if(this.ndk.relayConnectionFilter&&!this.ndk.relayConnectionFilter(a)){this.debug(`Refusing to add relay ${a}: blocked by relayConnectionFilter`);return}if(s){this.debug(`Refusing to add relay ${a}: is a filter relay`);return}if(this.ndk.cacheAdapter?.getRelayStatus){const X=this.ndk.cacheAdapter.getRelayStatus(a),te=X instanceof Promise?void 0:X;if(te?.dontConnectBefore){if(te.dontConnectBefore>Date.now()){const ne=te.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${a}: delayed connect for ${ne}ms`),setTimeout(()=>{this.addRelay(r,t)},ne);return}o=!1}}const c=X=>this.emit("notice",r,X),f=()=>this.handleRelayConnect(a),g=()=>this.handleRelayReady(r),b=()=>{this.recordDisconnection(r),this.emit("relay:disconnect",r)},_=()=>this.handleFlapping(r),L=X=>this.emit("relay:auth",r,X),q=()=>this.emit("relay:authed",r);r.off("notice",c),r.off("connect",f),r.off("ready",g),r.off("disconnect",b),r.off("flapping",_),r.off("auth",L),r.off("authed",q),r.on("notice",c),r.on("connect",f),r.on("ready",g),r.on("disconnect",b),r.on("flapping",_),r.on("auth",L),r.on("authed",q),r.on("delayed-connect",X=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(r.url,{dontConnectBefore:Date.now()+X})}),this._relays.set(a,r),t&&this.autoConnectRelays.add(a),t&&this.status==="active"&&(this.emit("relay:connecting",r),r.connect(void 0,o).catch(X=>{this.debug(`Failed to connect to relay ${a}`,X)}))}removeRelay(r){const t=this.relays.get(r);if(t)return t.disconnect(),this.relays.delete(r),this.autoConnectRelays.delete(r),this.emit("relay:disconnect",t),!0;const n=this.temporaryRelayTimers.get(r);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(r)),!1}isRelayConnected(r){const t=normalizeRelayUrl(r),n=this.relays.get(t);return n?n.status===5:!1}getRelay(r,t=!0,n=!1,s){let o=this.relays.get(normalizeRelayUrl(r));return o||(o=new NDKRelay(r,void 0,this.ndk),o.connectivity.netDebug=this.ndk.netDebug,n?this.useTemporaryRelay(o,3e4,s):this.addRelay(o,t)),o}handleRelayConnect(r){const t=this.relays.get(r);if(!t){console.error("NDK BUG: relay not found in pool",{relayUrl:r});return}this.emit("relay:connect",t),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(r){this.emit("relay:ready",r)}async connect(r){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${r?`, timeout ${r}ms`:""}...`);const t=Array.from(this.autoConnectRelays.keys()).map(a=>this.relays.get(a)).filter(a=>!!a);for(const a of t)a.status!==5&&a.status!==4&&(this.emit("relay:connecting",a),a.connect().catch(c=>{this.debug(`Failed to connect to relay ${a.url}: ${c??"No reason specified"}`)}));const n=()=>t.every(a=>a.status===5),s=new Promise(a=>{if(n()){a();return}const c=[];for(const f of t){const g=()=>{if(n()){for(let b=0;b<t.length;b++)t[b].off("connect",c[b]);a()}};c.push(g),f.on("connect",g)}}),o=typeof r=="number"?new Promise(a=>setTimeout(a,r)):new Promise(()=>{});await Promise.race([s,o])}checkOnFlappingRelays(){const r=this.flappingRelays.size,t=this.relays.size;if(r/t>=.8)for(const n of this.flappingRelays)this.backoffTimes.set(n,0)}recordDisconnection(r){const t=Date.now();this.disconnectionTimes.set(r.url,t);for(const[n,s]of this.disconnectionTimes.entries())t-s>1e4&&this.disconnectionTimes.delete(n);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const r=Date.now(),t=[];for(const n of this.disconnectionTimes.values())r-n<5e3&&t.push(n);t.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${t.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){if(this.systemEventDetector){this.debug("System-wide reconnection already in progress, skipping");return}this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const r of this.relays.values())r.connectivity&&(r.connectivity.resetReconnectionState(),r.status!==5&&r.status!==4&&r.connect().catch(t=>{this.debug(`Failed to reconnect relay ${r.url} after system event: ${t}`)}));this.disconnectionTimes.clear()}handleFlapping(r){this.debug(`Relay ${r.url} is flapping`);let t=this.backoffTimes.get(r.url)||5e3;t=t*2,this.backoffTimes.set(r.url,t),this.debug(`Backoff time for ${r.url} is ${t}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${r.url}`),this.emit("relay:connecting",r),r.connect(),this.checkOnFlappingRelays()},t),r.disconnect(),this.emit("flapping",r)}size(){return this.relays.size}stats(){const r={total:0,connected:0,disconnected:0,connecting:0};for(const t of this.relays.values())r.total++,t.status===5?r.connected++:t.status===1?r.disconnected++:t.status===4&&r.connecting++;return r}connectedRelays(){return Array.from(this.relays.values()).filter(r=>r.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(r=>r.status>=5&&!this.temporaryRelayTimers.has(r.url))}urls(){return Array.from(this.relays.keys())}},NDKDVMJobFeedback=class Mo extends NDKEvent{static kinds=[7e3];constructor(t,n){super(t,n),this.kind??=7e3}static async from(t){const n=new Mo(t.ndk,t.rawEvent());return n.encrypted&&await n.dvmDecrypt(),n}get status(){return this.tagValue("status")}set status(t){this.removeTag("status"),t!==void 0&&this.tags.push(["status",t])}get encrypted(){return!!this.getMatchingTags("encrypted")[0]}async dvmDecrypt(){await this.decrypt();const t=JSON.parse(this.content);this.tags.push(...t)}},NDKCashuMintList=class Ro extends NDKEvent{static kind=10019;static kinds=[10019];_p2pk;constructor(t,n){super(t,n),this.kind??=10019}static from(t){return new Ro(t.ndk,t)}set relays(t){this.tags=this.tags.filter(n=>n[0]!=="relay");for(const n of t)this.tags.push(["relay",n])}get relays(){const t=[];for(const n of this.tags)n[0]==="relay"&&t.push(n[1]);return t}set mints(t){this.tags=this.tags.filter(n=>n[0]!=="mint");for(const n of t)this.tags.push(["mint",n])}get mints(){const t=[];for(const n of this.tags)n[0]==="mint"&&t.push(n[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},NDKArticle=class Co extends NDKEvent{static kind=30023;static kinds=[30023];constructor(t,n){super(t,n),this.kind??=30023}static from(t){return new Co(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t){let n=Number.parseInt(t);return n>1e12&&(n=Math.floor(n/1e3)),n}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},NDKBlossomList=class Io extends NDKEvent{static kinds=[10063];constructor(t,n){super(t,n),this.kind??=10063}static from(t){return new Io(t.ndk,t.rawEvent())}get servers(){return this.tags.filter(t=>t[0]==="server").map(t=>t[1])}set servers(t){this.tags=this.tags.filter(n=>n[0]!=="server");for(const n of t)this.tags.push(["server",n])}get default(){const t=this.servers;return t.length>0?t[0]:void 0}set default(t){if(!t)return;const s=this.servers.filter(o=>o!==t);this.servers=[t,...s]}addServer(t){if(!t)return;const n=this.servers;n.includes(t)||(this.servers=[...n,t])}removeServer(t){if(!t)return;const n=this.servers;this.servers=n.filter(s=>s!==t)}},NDKFedimintMint=class No extends NDKEvent{static kind=38173;static kinds=[38173];constructor(t,n){super(t,n),this.kind??=38173}static async from(t){return new No(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get inviteCodes(){return this.getMatchingTags("u").map(t=>t[1])}set inviteCodes(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get modules(){return this.getMatchingTags("modules").map(t=>t[1])}set modules(t){this.removeTag("modules");for(const n of t)this.tags.push(["modules",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKCashuMintAnnouncement=class Bo extends NDKEvent{static kind=38172;static kinds=[38172];constructor(t,n){super(t,n),this.kind??=38172}static async from(t){return new Bo(t.ndk,t)}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get url(){return this.tagValue("u")}set url(t){this.removeTag("u"),t&&this.tags.push(["u",t])}get nuts(){return this.getMatchingTags("nuts").map(t=>t[1])}set nuts(t){this.removeTag("nuts");for(const n of t)this.tags.push(["nuts",n])}get network(){return this.tagValue("n")}set network(t){this.removeTag("n"),t&&this.tags.push(["n",t])}get metadata(){if(this.content)try{return JSON.parse(this.content)}catch{return}}set metadata(t){t?this.content=JSON.stringify(t):this.content=""}},NDKMintRecommendation=class Po extends NDKEvent{static kind=38e3;static kinds=[38e3];constructor(t,n){super(t,n),this.kind??=38e3}static async from(t){return new Po(t.ndk,t)}get recommendedKind(){const t=this.tagValue("k");return t?Number(t):void 0}set recommendedKind(t){this.removeTag("k"),t&&this.tags.push(["k",t.toString()])}get identifier(){return this.tagValue("d")}set identifier(t){this.removeTag("d"),t&&this.tags.push(["d",t])}get urls(){return this.getMatchingTags("u").map(t=>t[1])}set urls(t){this.removeTag("u");for(const n of t)this.tags.push(["u",n])}get mintEventPointers(){return this.getMatchingTags("a").map(t=>({kind:Number(t[1].split(":")[0]),identifier:t[1].split(":")[2],relay:t[2]}))}addMintEventPointer(t,n,s,o){const a=["a",`${t}:${n}:${s}`];o&&a.push(o),this.tags.push(a)}get review(){return this.content}set review(t){this.content=t}},NDKClassified=class Lo extends NDKEvent{static kinds=[30402];constructor(t,n){super(t,n),this.kind??=30402}static from(t){return new Lo(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}get location(){return this.tagValue("location")}set location(t){this.removeTag("location"),t&&this.tags.push(["location",t])}get price(){const t=this.tags.find(n=>n[0]==="price");if(t)return{amount:Number.parseFloat(t[1]),currency:t[2],frequency:t[3]}}set price(t){if(typeof t=="string"&&(t={amount:Number.parseFloat(t)}),t?.amount){const n=["price",t.amount.toString()];t.currency&&n.push(t.currency),t.frequency&&n.push(t.frequency),this.tags.push(n)}else this.removeTag("price")}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}},NDKDraft=class Do extends NDKEvent{_event;static kind=31234;static kinds=[31234,1234];counterparty;constructor(t,n){super(t,n),this.kind??=31234}static from(t){return new Do(t.ndk,t)}set identifier(t){this.removeTag("d"),this.tags.push(["d",t])}get identifier(){return this.dTag}set event(t){t instanceof NDKEvent?this._event=t:this._event=new NDKEvent(void 0,t),this.prepareEvent()}set checkpoint(t){t?(this.tags.push(t.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const t=this.tagValue("p");return!!t&&t!==this.pubkey}async getEvent(t){if(this._event)return this._event;if(t??=this.ndk?.signer,!t)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const n=t.pubkey,o=[this.tagValue("p"),this.pubkey].filter(Boolean).find(f=>f!==n);let a;a=new NDKUser({pubkey:o??n}),await this.decrypt(a,t);const c=JSON.parse(this.content);return this._event=await wrapEvent(new NDKEvent(this.ndk,c)),this._event}catch(n){console.error(n);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:t,publish:n,relaySet:s}){if(t??=this.ndk?.signer,!t)throw new Error("No signer available");const o=this.counterparty||await t.user();if(await this.encrypt(o,t),this.counterparty){const a=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",a])}if(n!==!1)return this.publishReplaceable(s)}};function mapImetaTag(r){const t={};if(r.length===2){const s=r[1].split(" ");for(let o=0;o<s.length;o+=2){const a=s[o],c=s[o+1];a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}const n=r.slice(1);for(const s of n){const o=s.split(" "),a=o[0],c=o.slice(1).join(" ");a==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(c)):t[a]=c}return t}function imetaTagToTag(r){const t=["imeta"];for(const[n,s]of Object.entries(r))if(Array.isArray(s))for(const o of s)t.push(`${n} ${o}`);else s&&t.push(`${n} ${s}`);return t}var NDKFollowPack=class Oo extends NDKEvent{static kind=39089;static kinds=[39089,39092];constructor(t,n){super(t,n),this.kind??=39089}static from(t){return new Oo(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){const t=this.tags.find(n=>n[0]==="imeta");if(t){const n=mapImetaTag(t);if(n.url)return n.url}return this.tagValue("image")}set image(t){this.tags=this.tags.filter(n=>n[0]!=="imeta"&&n[0]!=="image"),typeof t=="string"?t!==void 0&&this.tags.push(["image",t]):t&&typeof t=="object"&&(this.tags.push(imetaTagToTag(t)),t.url&&this.tags.push(["image",t.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(t=>t[0]==="p"&&t[1]&&isValidPubkey(t[1])).map(t=>t[1])))}set pubkeys(t){this.tags=this.tags.filter(n=>n[0]!=="p");for(const n of t)this.tags.push(["p",n])}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}},NDKHighlight=class Fo extends NDKEvent{_article;static kind=9802;static kinds=[9802];constructor(t,n){super(t,n),this.kind??=9802}static from(t){return new Fo(t.ndk,t)}get url(){return this.tagValue("r")}set context(t){t===void 0?this.tags=this.tags.filter(([n,s])=>n!=="context"):(this.tags=this.tags.filter(([n,s])=>n!=="context"),this.tags.push(["context",t]))}get context(){return this.tags.find(([t,n])=>t==="context")?.[1]??void 0}get article(){return this._article}set article(t){this._article=t,typeof t=="string"?this.tags.push(["r",t]):this.tag(t)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){if(this._article!==void 0)return this._article;let t;const n=this.getArticleTag();if(n){switch(n[0]){case"a":{const[s,o,a]=n[1].split(":");t=nip19_exports$1.naddrEncode({kind:Number.parseInt(s),pubkey:o,identifier:a});break}case"e":t=nip19_exports$1.noteEncode(n[1]);break;case"r":this._article=n[1];break}if(t){let s=await this.ndk?.fetchEvent(t);s&&(s.kind===30023&&(s=NDKArticle.from(s)),this._article=s)}return this._article}}},NDKImage=class Uo extends NDKEvent{static kind=20;static kinds=[20];_imetas;constructor(t,n){super(t,n),this.kind??=20}static from(t){return new Uo(t.ndk,t.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag).filter(t=>!!t.url),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag))}},NDKList=class Ho extends NDKEvent{_encryptedTags;static kinds=[30001,10004,10050,10030,10015,10001,10002,10007,10006,10003];encryptedTagsLength;constructor(t,n){super(t,n),this.kind??=30001}static from(t){return new Ho(t.ndk,t)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(n,this.content),o=JSON.parse(s);return o?.[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(n=>n[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,n=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(t instanceof NDKEvent)a=[t.tagReference(n)];else if(t instanceof NDKUser)a=t.referenceTags();else if(t instanceof NDKRelay)a=t.referenceTags();else if(Array.isArray(t))a=[t];else throw new Error("Invalid object type");if(n&&a[0].push(n),s){const c=await this.ndk.signer.user(),f=await this.encryptedTags();o==="top"?f.unshift(...a):f.push(...a),this._encryptedTags=f,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(f),await this.encrypt(c)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,n=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(f=>f[1]===t);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),c=a.findIndex(f=>f[1]===t);if(c>=0&&(a.splice(c,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),n)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,n){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(n){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(t,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(n=>n[1]===t)}filterForItems(){const t=new Set,n=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])t.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,c,f]=o[1].split(":");if(!a||!c)continue;const g=`${a}:${c}`,b=n.get(g)||[];b.push(f||""),n.set(g,b)}if(t.size>0&&s.push({ids:Array.from(t)}),n.size>0)for(const[o,a]of n.entries()){const[c,f]=o.split(":");s.push({kinds:[Number.parseInt(c)],authors:[f],"#d":a})}return s}},NDKAppHandlerEvent=class qo extends NDKEvent{profile;static kinds=[31990];constructor(t,n){super(t,n),this.kind??=31990}static from(t){const n=new qo(t.ndk,t.rawEvent());return n.isValid?n:null}get isValid(){const t=new Map,n=o=>[o[0],o[2]].join(":").toLowerCase(),s=["web","android","ios"];for(const o of this.tags)if(s.includes(o[0])){const a=n(o);if(t.has(a)&&t.get(a)!==o[1].toLowerCase())return!1;t.set(a,o[1].toLowerCase())}return!0}async fetchProfile(){if(this.profile===void 0&&this.content.length>0)try{const t=JSON.parse(this.content);if(t?.name)return t;this.profile=null}catch{this.profile=null}return new Promise((t,n)=>{const s=this.author;s.fetchProfile().then(()=>{t(s.profile)}).catch(n)})}},NDKNutzap=class Ui extends NDKEvent{debug;_proofs=[];static kind=9321;static kinds=[Ui.kind];constructor(t,n){super(t,n),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??createDebug$1("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const s=this.getMatchingTags("proof");s.length?this._proofs=s.map(o=>JSON.parse(o[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(t){const n=new Ui(t.ndk,t);if(!(!n._proofs||!n._proofs.length))return n}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(n=>n[0]!=="proof");for(const n of t)this.tags.push(["proof",JSON.stringify(n)])}get proofs(){return this._proofs}get rawP2pk(){const t=this.proofs[0];try{const n=JSON.parse(t.secret);let s;if(typeof n=="string"?(s=JSON.parse(n),this.debug("stringified payload",t.secret)):typeof n=="object"&&(s=n),Array.isArray(s)&&s[0]==="P2PK"&&s.length>1&&typeof s[1]=="object"&&s[1]!==null||typeof s=="object"&&s!==null&&typeof s[1]?.data=="string")return s[1].data}catch(n){this.debug("error parsing p2pk pubkey",n,this.proofs[0])}}get p2pk(){const t=this.rawP2pk;if(t)return t.startsWith("02")?t.slice(2):t}get mint(){return this.tagValue("u")}set mint(t){this.replaceTag(["u",t])}get unit(){let t=this.tagValue("unit")??"sat";return t?.startsWith("msat")&&(t="sat"),t}set unit(t){if(this.removeTag("unit"),t?.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((n,s)=>n+s.amount,0)}sender=this.author;set target(t){this.tags=this.tags.filter(n=>n[0]!=="p"),t instanceof NDKEvent&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new NDKUser({pubkey:t})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const t=await super.toNostrEvent();return t.content=this.comment,t}get isValid(){let t=0,n=0,s=0;for(const o of this.tags)o[0]==="e"&&t++,o[0]==="p"&&n++,o[0]==="u"&&s++;return n===1&&s===1&&t<=1&&this.proofs.length>0}},NDKProject=class zo extends NDKEvent{static kind=31933;static kinds=[31933];_signer;constructor(t,n){super(t,n),this.kind=31933}static from(t){return new zo(t.ndk,t.rawEvent())}set repo(t){this.removeTag("repo"),t&&this.tags.push(["repo",t])}set hashtags(t){this.removeTag("hashtags"),t.filter(n=>n.length>0).length&&this.tags.push(["hashtags",...t])}get hashtags(){const t=this.tags.find(n=>n[0]==="hashtags");return t?t.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get picture(){return this.tagValue("picture")}set picture(t){this.removeTag("picture"),t&&this.tags.push(["picture",t])}set description(t){this.content=t}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){if(this._signer)return this._signer;const t=this.tagValue("key");if(!t)this._signer=NDKPrivateKeySigner.generate(),await this.encryptAndSaveNsec();else{const n=await this.ndk?.signer?.decrypt(this.ndk.activeUser,t);if(!n)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner(n)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(t){this._signer=new NDKPrivateKeySigner(t),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){if(!this._signer)throw new Error("Signer is not set.");const t=this._signer.privateKey,n=await this.ndk?.signer?.encrypt(this.ndk.activeUser,t);n&&(this.removeTag("key"),this.tags.push(["key",n]))}},NDKProjectTemplate=class Vo extends NDKEvent{static kind=30717;static kinds=[30717];constructor(t,n){super(t,n),this.kind=30717}static from(t){return new Vo(t.ndk,t.rawEvent())}get templateId(){return this.dTag??""}set templateId(t){this.dTag=t}get name(){return this.tagValue("title")??""}set name(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get description(){return this.tagValue("description")??""}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(t){this.removeTag("uri"),t&&this.tags.push(["uri",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get command(){return this.tagValue("command")}set command(t){this.removeTag("command"),t&&this.tags.push(["command",t])}get agentConfig(){const t=this.tagValue("agent");if(t)try{return JSON.parse(t)}catch{return}}set agentConfig(t){this.removeTag("agent"),t&&this.tags.push(["agent",JSON.stringify(t)])}get templateTags(){return this.getMatchingTags("t").map(t=>t[1]).filter(Boolean)}set templateTags(t){this.tags=this.tags.filter(n=>n[0]!=="t"),t.forEach(n=>{n&&this.tags.push(["t",n])})}},READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Wo extends NDKEvent{static kinds=[10002];constructor(t,n){super(t,n),this.kind??=10002}static from(t){return new Wo(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===READ_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(const n of t)this.tags.push(["r",n,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===WRITE_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(const n of t)this.tags.push(["r",n,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(const n of t)this.tags.push(["r",n])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(t=>this.ndk?.pool.getRelay(t)).filter(t=>!!t)),this.ndk)}},NDKRepost=class jo extends NDKEvent{_repostedEvents;static kinds=[6,16];static from(t){return new jo(t.ndk,t.rawEvent())}async repostedEvents(t,n){const s=[];if(!this.ndk)throw new Error("NDK instance not set");if(this._repostedEvents!==void 0)return this._repostedEvents;for(const o of this.repostedEventIds()){const a=filterForId(o),c=await this.ndk.fetchEvent(a,n);c&&s.push(t?t.from(c):c)}return s}repostedEventIds(){return this.tags.filter(t=>t[0]==="e"||t[0]==="a").map(t=>t[1])}};function filterForId(r){if(r.match(/:/)){const[t,n,s]=r.split(":");return{kinds:[Number.parseInt(t)],authors:[n],"#d":[s]}}return{ids:[r]}}var NDKSimpleGroupMemberList=class Ko extends NDKEvent{relaySet;memberSet=new Set;static kind=39002;static kinds=[39002];constructor(t,n){super(t,n),this.kind??=39002,this.memberSet=new Set(this.members)}static from(t){return new Ko(t.ndk,t)}get members(){return this.getMatchingTags("p").map(t=>t[1])}hasMember(t){return this.memberSet.has(t)}async publish(t,n,s){return t??=this.relaySet,super.publishReplaceable(t,n,s)}},NDKSimpleGroupMetadata=class Go extends NDKEvent{static kind=39e3;static kinds=[39e3];constructor(t,n){super(t,n),this.kind??=39e3}static from(t){return new Go(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}};function strToPosition(r){const[t,n]=r.split(",").map(Number);return{x:t,y:n}}function strToDimension(r){const[t,n]=r.split("x").map(Number);return{width:t,height:n}}var NDKStorySticker=class Jo{static Text="text";static Pubkey="pubkey";static Event="event";static Prompt="prompt";static Countdown="countdown";type;value;position;dimension;properties;constructor(t){if(Array.isArray(t)){const n=t;if(n[0]!=="sticker"||n.length<5)throw new Error("Invalid sticker tag");this.type=n[1],this.value=n[2],this.position=strToPosition(n[3]),this.dimension=strToDimension(n[4]);const s={};for(let o=5;o<n.length;o++){const[a,...c]=n[o].split(" ");s[a]=c.join(" ")}Object.keys(s).length>0&&(this.properties=s)}else this.type=t,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(t){try{return new Jo(t)}catch{return null}}get style(){return this.properties?.style}set style(t){t?this.properties={...this.properties,style:t}:delete this.properties?.style}get rotation(){return this.properties?.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(t){t!==void 0?this.properties={...this.properties,rot:t.toString()}:delete this.properties?.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}hasValidDimensions=()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height);hasValidPosition=()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y);toTag(){if(!this.isValid){const s=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${s.join(", ")}`)}let t;switch(this.type){case"event":t=this.value.tagId();break;case"pubkey":t=this.value.pubkey;break;default:t=this.value}const n=["sticker",this.type,t,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[s,o]of Object.entries(this.properties))n.push(`${s} ${o}`);return n}},NDKStory=class Zo extends NDKEvent{static kind=23;static kinds=[23];_imeta;_dimensions;constructor(t,n){if(super(t,n),this.kind??=23,n)for(const s of n.tags)switch(s[0]){case"imeta":this._imeta=mapImetaTag(s);break;case"dim":this.dimensions=strToDimension(s[1]);break}}static from(t){return new Zo(t.ndk,t)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(t){this._imeta=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),t&&this.tags.push(imetaTagToTag(t))}get dimensions(){const t=this.tagValue("dim");if(t)return strToDimension(t)}set dimensions(t){this.removeTag("dim"),t&&this.tags.push(["dim",`${t.width}x${t.height}`])}get duration(){const t=this.tagValue("dur");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("dur"),t!==void 0&&this.tags.push(["dur",t.toString()])}get stickers(){const t=[];for(const n of this.tags){if(n[0]!=="sticker"||n.length<5)continue;const s=NDKStorySticker.fromTag(n);s&&t.push(s)}return t}addSticker(t){let n;if(t instanceof NDKStorySticker)n=t;else{const s=["sticker",t.type,typeof t.value=="string"?t.value:"",coordinates(t.position),dimension(t.dimension)];if(t.properties)for(const[o,a]of Object.entries(t.properties))s.push(`${o} ${a}`);n=new NDKStorySticker(s),n.value=t.value}n.type==="pubkey"?this.tag(n.value):n.type==="event"&&this.tag(n.value),this.tags.push(n.toTag())}removeSticker(t){const n=this.stickers;if(t<0||t>=n.length)return;let s=0;for(let o=0;o<this.tags.length;o++)if(this.tags[o][0]==="sticker"){if(s===t){this.tags.splice(o,1);break}s++}}},coordinates=r=>`${r.x},${r.y}`,dimension=r=>`${r.width}x${r.height}`,NDKSubscriptionReceipt=class Yo extends NDKEvent{debug;static kinds=[7003];constructor(t,n){super(t,n),this.kind??=7003,this.debug=t?.debug.extend("subscription-start")??createDebug$1("ndk:subscription-start")}static from(t){return new Yo(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get subscriber(){const t=this.getMatchingTags("P")?.[0];return t?new NDKUser({pubkey:t[1]}):void 0}set subscriber(t){this.removeTag("P"),t&&this.tags.push(["P",t.pubkey])}set subscriptionStart(t){this.debug(`before setting subscription start: ${this.rawEvent}`),this.removeTag("e"),this.tag(t,"subscription",!0),this.debug(`after setting subscription start: ${this.rawEvent}`)}get tierName(){return this.getMatchingTags("tier")?.[0]?.[1]}get isValid(){const t=this.validPeriod;if(!t||t.start>t.end)return!1;const n=this.getMatchingTags("p"),s=this.getMatchingTags("P");return!(n.length!==1||s.length!==1)}get validPeriod(){const t=this.getMatchingTags("valid")?.[0];if(t)try{return{start:new Date(Number.parseInt(t[1])*1e3),end:new Date(Number.parseInt(t[2])*1e3)}}catch{return}}set validPeriod(t){this.removeTag("valid"),t&&this.tags.push(["valid",Math.floor(t.start.getTime()/1e3).toString(),Math.floor(t.end.getTime()/1e3).toString()])}get startPeriod(){return this.validPeriod?.start}get endPeriod(){return this.validPeriod?.end}isActive(t){t??=new Date;const n=this.validPeriod;return!(!n||t<n.start||t>n.end)}},possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(r,t,n){return["amount",r.toString(),t,n]}function parseTagToSubscriptionAmount(r){const t=Number.parseInt(r[1]);if(Number.isNaN(t)||t===void 0||t===null||t<=0)return;const n=r[2];if(n===void 0||n==="")return;const s=r[3];if(s!==void 0&&possibleIntervalFrequencies.includes(s))return{amount:t,currency:n,term:s}}var NDKSubscriptionTier=class Xo extends NDKArticle{static kind=37001;static kinds=[37001];constructor(t,n){const s=n?.kind??37001;super(t,n),this.kind=s}static from(t){return new Xo(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>parseTagToSubscriptionAmount(t)).filter(t=>t!==void 0)}addAmount(t,n,s){this.tags.push(newAmount(t,n,s))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},NDKSubscriptionStart=class Qo extends NDKEvent{debug;static kinds=[7001];constructor(t,n){super(t,n),this.kind??=7001,this.debug=t?.debug.extend("subscription-start")??createDebug$1("ndk:subscription-start")}static from(t){return new Qo(t.ndk,t.rawEvent())}get recipient(){const t=this.getMatchingTags("p")?.[0];return t?new NDKUser({pubkey:t[1]}):void 0}set recipient(t){this.removeTag("p"),t&&this.tags.push(["p",t.pubkey])}get amount(){const t=this.getMatchingTags("amount")?.[0];if(t)return parseTagToSubscriptionAmount(t)}set amount(t){this.removeTag("amount"),t&&this.tags.push(newAmount(t.amount,t.currency,t.term))}get tierId(){const t=this.getMatchingTags("e")?.[0],n=this.getMatchingTags("a")?.[0];if(!(!t||!n))return t[1]??n[1]}set tier(t){this.removeTag("e"),this.removeTag("a"),this.removeTag("event"),t&&(this.tag(t),this.removeTag("p"),this.tags.push(["p",t.pubkey]),this.tags.push(["event",JSON.stringify(t.rawEvent())]))}async fetchTier(){const t=this.tagValue("event");if(t)try{const o=JSON.parse(t);return new NDKSubscriptionTier(this.ndk,o)}catch{this.debug("Failed to parse event tag")}const n=this.tierId;if(!n)return;const s=await this.ndk?.fetchEvent(n);if(s)return NDKSubscriptionTier.from(s)}get isValid(){return this.getMatchingTags("amount").length!==1?(this.debug("Invalid # of amount tag"),!1):this.amount?this.getMatchingTags("p").length!==1?(this.debug("Invalid # of p tag"),!1):this.recipient?!0:(this.debug("Invalid p tag"),!1):(this.debug("Invalid amount tag"),!1)}},NDKTask=class ea extends NDKEvent{static kind=1934;static kinds=[1934];constructor(t,n){super(t,n),this.kind=1934}static from(t){return new ea(t.ndk,t.rawEvent())}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get title(){return this.tagValue("title")}set project(t){this.removeTag("a"),this.tags.push(t.tagReference())}get projectSlug(){const t=this.getMatchingTags("a")[0];return t?t[1].split(/:/)?.[2]:void 0}},NDKThread=class ra extends NDKEvent{static kind=11;static kinds=[11];constructor(t,n){super(t,n),this.kind??=11}static from(t){return new ra(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}},NDKVideo=class na extends NDKEvent{static kind=21;static kinds=[34235,34236,22,21];_imetas;static from(t){return new na(t.ndk,t.rawEvent())}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get thumbnail(){let t;return this.imetas&&this.imetas.length>0&&(t=this.imetas[0].image?.[0]),t??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(n=>n[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}async generateTags(){if(super.generateTags(),!this.kind&&this.imetas?.[0]?.dim){const[t,n]=this.imetas[0].dim.split("x"),s=t&&n&&Number.parseInt(t)<Number.parseInt(n);this.duration&&this.duration<120&&s?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const t=this.tagValue("duration");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("duration"),t!==void 0&&this.tags.push(["duration",Math.floor(t).toString()])}},NDKWiki=class ia extends NDKArticle{static kind=30818;static kinds=[30818];static from(t){return new ia(t.ndk,t.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(t){this.removeTag("a","defer"),this.tag(t,"defer")}},NDKWikiMergeRequest=class sa extends NDKEvent{static kinds=[818];static from(t){return new sa(t.ndk,t.rawEvent())}get targetId(){return this.tagValue("a")}set target(t){this.tags=this.tags.filter(n=>{if(n[0]==="a"||n[0]==="e"&&n[3]!=="source")return!0}),this.tag(t)}get sourceId(){return this.tagValue("e","source")}set source(t){this.removeTag("e","source"),this.tag(t,"source",!1,"e")}},registeredEventClasses=new Set;function wrapEvent(r){const t=new Map,s=[...[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKDraft,NDKWiki,NDKWikiMergeRequest,NDKNutzap,NDKProject,NDKTask,NDKProjectTemplate,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKSubscriptionStart,NDKSubscriptionReceipt,NDKList,NDKRelayList,NDKStory,NDKBlossomList,NDKFollowPack,NDKThread,NDKRepost,NDKClassified,NDKAppHandlerEvent,NDKDVMJobFeedback,NDKCashuMintAnnouncement,NDKFedimintMint,NDKMintRecommendation],...registeredEventClasses];for(const a of s)for(const c of a.kinds)t.set(c,a);const o=t.get(r.kind);return o?o.from(r):r}var NDKSubscriptionCacheUsage=(r=>(r.ONLY_CACHE="ONLY_CACHE",r.CACHE_FIRST="CACHE_FIRST",r.PARALLEL="PARALLEL",r.ONLY_RELAY="ONLY_RELAY",r))(NDKSubscriptionCacheUsage||{});async function follows(r,t,n=3){if(!this.ndk)throw new Error("NDK not set");const s=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},r||{groupable:!1});if(s){const o=new Set;return s.tags.forEach(a=>{a[0]==="p"&&a[1]&&isValidPubkey(a[1])&&o.add(a[1])}),t&&this.ndk?.outboxTracker?.trackUsers(Array.from(o)),[...o].reduce((a,c)=>{const f=new NDKUser({pubkey:c});return f.ndk=this.ndk,a.add(f),a},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(r,t,n=fetch,s={}){return await r.queuesNip05.add({id:t,func:async()=>{if(r.cacheAdapter?.loadNip05){const g=await r.cacheAdapter.loadNip05(t);if(g!=="missing"){if(g){const b=new NDKUser({pubkey:g.pubkey,relayUrls:g.relays,nip46Urls:g.nip46});return b.ndk=r,b}if(s.cache!=="no-cache")return null}}const o=t.match(NIP05_REGEX);if(!o)return null;const[a,c="_",f]=o;try{const g=await n(`https://${f}/.well-known/nostr.json?name=${c}`,s),{names:b,relays:_,nip46:L}=parseNIP05Result(await g.json()),q=b[c.toLowerCase()];let X=null;return q&&(X={pubkey:q,relays:_?.[q],nip46:L?.[q]}),r?.cacheAdapter?.saveNip05&&r.cacheAdapter.saveNip05(t,X),X}catch(g){return r?.cacheAdapter?.saveNip05&&r?.cacheAdapter.saveNip05(t,null),console.error("Failed to fetch NIP05 for",t,g),null}}})}function parseNIP05Result(r){const t={names:{}};for(const[n,s]of Object.entries(r.names))typeof n=="string"&&typeof s=="string"&&(t.names[n.toLowerCase()]=s);if(r.relays){t.relays={};for(const[n,s]of Object.entries(r.relays))typeof n=="string"&&Array.isArray(s)&&(t.relays[n]=s.filter(o=>typeof o=="string"))}if(r.nip46){t.nip46={};for(const[n,s]of Object.entries(r.nip46))typeof n=="string"&&Array.isArray(s)&&(t.nip46[n]=s.filter(o=>typeof o=="string"))}return t}function profileFromEvent(r){const t={};let n;try{n=JSON.parse(r.content)}catch(s){throw new Error(`Failed to parse profile event: ${s}`)}t.profileEvent=JSON.stringify(r.rawEvent());for(const s of Object.keys(n))switch(s){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.picture=n.picture||n.image,t.image=t.picture;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"website":t.website=n.website;break;default:t[s]=n[s];break}return t.created_at=r.created_at,t}function serializeProfile(r){const t={};for(const[n,s]of Object.entries(r))switch(n){case"username":case"name":t.name=s;break;case"displayName":t.display_name=s;break;case"image":case"picture":t.picture=s;break;case"bio":case"about":t.about=s;break;default:t[n]=s;break}return JSON.stringify(t)}var NDKUser=class oa{ndk;profile;profileEvent;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){if(t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls),t.nprofile)try{const n=nip19_exports$1.decode(t.nprofile);n.type==="nprofile"&&(this._pubkey=n.data.pubkey,n.data.relays&&n.data.relays.length>0&&this.relayUrls.push(...n.data.relays))}catch(n){console.error("Failed to decode nprofile",n)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports$1.npubEncode(this.pubkey)}return this._npub}get nprofile(){const t=this.profileEvent?.onRelays?.map(n=>n.url);return nip19_exports$1.nprofileEncode({pubkey:this.pubkey,relays:t})}set npub(t){this._npub=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports$1.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}filter(){return{"#p":[this.pubkey]}}async getZapInfo(t){if(!this.ndk)throw new Error("No NDK instance found");const n=async c=>{if(!t)return c;let f;const g=new Promise((b,_)=>{f=setTimeout(()=>_(new Error("Timeout")),t)});try{const b=await Promise.race([c,g]);return f&&clearTimeout(f),b}catch(b){if(b instanceof Error&&b.message==="Timeout")try{return await c}catch{return}return}},[s,o]=await Promise.all([n(this.fetchProfile()),n(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),a=new Map;if(o){const c=NDKCashuMintList.from(o);c.mints.length>0&&a.set("nip61",{mints:c.mints,relays:c.relays,p2pk:c.p2pk})}if(s){const{lud06:c,lud16:f}=s;a.set("nip57",{lud06:c,lud16:f})}return a}static async fromNip05(t,n,s=!1){if(!n)throw new Error("No NDK instance found");const o={};s&&(o.cache="no-cache");const a=await getNip05For(n,t,n?.httpFetch,o);if(a){const c=new oa({pubkey:a.pubkey,relayUrls:a.relays,nip46Urls:a.nip46});return c.ndk=n,c}}async fetchProfile(t,n=!1){if(!this.ndk)throw new Error("NDK not set");let s=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&t?.cacheUsage!=="ONLY_RELAY"){let o=null;if(this.ndk.cacheAdapter.fetchProfileSync?o=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(o=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),o)return this.profile=o,o}return t??={},t.cacheUsage??="ONLY_RELAY",t.closeOnEose??=!0,t.groupable??=!0,t.groupableDelay??=250,s||(s=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},t)),s?(this.profile=profileFromEvent(s),n&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}follows=follows.bind(this);async followSet(t,n,s=3){const o=await this.follows(t,n,s);return new Set(Array.from(o).map(a=>a.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){const n=[["p",this.pubkey]];return t&&n[0].push("",t),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey;if(Array.from(n).some(f=>typeof f=="string"?f===o:f.pubkey===o))return!1;n.add(t);const c=new NDKEvent(this.ndk,{kind:s});for(const f of n)typeof f=="string"?c.tags.push(["p",f]):c.tag(f);return await c.publish(),!0}async unfollow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const o=typeof t=="string"?t:t.pubkey,a=new Set;let c=!1;for(const g of n)(typeof g=="string"?g:g.pubkey)!==o?a.add(g):c=!0;if(!c)return!1;const f=new NDKEvent(this.ndk,{kind:s});for(const g of a)typeof g=="string"?f.tags.push(["p",g]):f.tag(g);return await f.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const n=await getNip05For(this.ndk,t);return n===null?null:n.pubkey===this.pubkey}},signerRegistry=new Map;function registerSigner(r,t){signerRegistry.set(r,t)}var NDKPrivateKeySigner=class Ai{_user;_privateKey;_pubkey;constructor(t,n){if(typeof t=="string")if(t.startsWith("nsec1")){const{type:s,data:o}=nip19_exports$1.decode(t);if(s==="nsec")this._privateKey=o;else throw new Error("Invalid private key provided.")}else if(t.length===64)this._privateKey=hexToBytes(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._pubkey=getPublicKey(this._privateKey),n&&(this._user=n.getUser({pubkey:this._pubkey})),this._user??=new NDKUser({pubkey:this._pubkey})}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports$1.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports$1.npubEncode(this._pubkey)}encryptToNcryptsec(t,n=16,s=2){if(!this._privateKey)throw new Error("Private key not available");return encrypt$1(this._privateKey,t,n,s)}static generate(){const t=generateSecretKey();return new Ai(t)}static fromNcryptsec(t,n,s){const o=decrypt$1(t,n);return new Ai(o,s)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(t,this._privateKey).sig}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&n.push("nip04"),(!t||t==="nip44")&&n.push("nip44"),n}async encrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports.v2.encrypt(n,a)}return await nip04_exports.encrypt(this._privateKey,o,n)}async decrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const o=t.pubkey;if(s==="nip44"){const a=nip44_exports.v2.utils.getConversationKey(this._privateKey,o);return await nip44_exports.v2.decrypt(n,a)}return await nip04_exports.decrypt(this._privateKey,o,n)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const t={type:"private-key",payload:this.privateKey};return JSON.stringify(t)}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${s.type}`);if(!s.payload||typeof s.payload!="string")throw new Error("Invalid payload content for private-key signer");return new Ai(s.payload,n)}};registerSigner("private-key",NDKPrivateKeySigner);async function giftWrap(r,t,n,s={}){let o=n;if(s.scheme??="nip44",!o){if(!r.ndk)throw new Error("no signer available for giftWrap");o=r.ndk.signer}if(!o)throw new Error("no signer");if(!o.encryptionEnabled||!o.encryptionEnabled(s.scheme))throw new Error("signer is not able to giftWrap");if(!r.pubkey){const g=await o.user();r.pubkey=g.pubkey}r.sig&&console.warn(" NIP-17 Warning: Rumor event should not be signed. The signature will be removed during gift wrapping.");const a=getRumorEvent(r,s?.rumorKind),c=await getSealEvent(a,t,o,s.scheme),f=await getWrapEvent(c,t,s);return new NDKEvent(r.ndk,f)}async function giftUnwrap(r,t,n,s="nip44"){if(r.ndk?.cacheAdapter?.getDecryptedEvent){const c=await r.ndk.cacheAdapter.getDecryptedEvent(r.id);if(c)return c}const o=new NDKUser({pubkey:r.pubkey}),a=n||r.ndk?.signer;if(!a)throw new Error("no signer");try{const c=JSON.parse(await a.decrypt(o,r.content,s));if(!c)throw new Error("Failed to decrypt wrapper");if(!new NDKEvent(void 0,c).verifySignature(!1))throw new Error("GiftSeal signature verification failed!");const f=new NDKUser({pubkey:c.pubkey}),g=JSON.parse(await a.decrypt(f,c.content,s));if(!g)throw new Error("Failed to decrypt seal");if(g.pubkey!==c.pubkey)throw new Error("Invalid GiftWrap, sender validation failed!");const b=new NDKEvent(r.ndk,g);return r.ndk?.cacheAdapter?.addDecryptedEvent&&await r.ndk.cacheAdapter.addDecryptedEvent(r.id,b),b}catch{return Promise.reject("Got error unwrapping event! See console log.")}}function getRumorEvent(r,t){const n=r.rawEvent();return n.kind=t||n.kind||14,n.sig=void 0,n.id=getEventHash$1(n),new NDKEvent(r.ndk,n)}async function getSealEvent(r,t,n,s="nip44"){const o=new NDKEvent(r.ndk);return o.kind=13,o.created_at=approximateNow(5),o.content=JSON.stringify(r.rawEvent()),await o.encrypt(t,n,s),await o.sign(n),o}async function getWrapEvent(r,t,n,s="nip44"){const o=NDKPrivateKeySigner.generate(),a=new NDKEvent(r.ndk);return a.kind=1059,a.created_at=approximateNow(5),n?.wrapTags&&(a.tags=n.wrapTags),a.tag(t),a.content=JSON.stringify(r.rawEvent()),await a.encrypt(t,o,s),await a.sign(o),a}function approximateNow(r=0){return Math.round(Date.now()/1e3-Math.random()*10**r)}function proofsTotalBalance(r){return r.reduce((t,n)=>{if(n.amount<0)throw new Error("proof amount is negative");return t+n.amount},0)}var NDKCashuToken=class aa extends NDKEvent{_proofs=[];_mint;static kind=7375;static kinds=[7375];_deletes=[];original;constructor(t,n){super(t,n),this.kind??=7375}static async from(t){const n=new aa(t.ndk,t);n.original=t;try{await n.decrypt()}catch{n.content=n.original.content}try{const s=JSON.parse(n.content);if(n.proofs=s.proofs,n.mint=s.mint??n.tagValue("mint"),n.deletedTokens=s.del??[],!Array.isArray(n.proofs))return}catch{return}return n}get proofs(){return this._proofs}set proofs(t){const n=new Set;this._proofs=t.filter(s=>n.has(s.C)?(console.warn("Passed in proofs had duplicates, ignoring",s.C),!1):s.amount<0?(console.warn("Invalid proof with negative amount",s),!1):(n.add(s.C),!0)).map(this.cleanProof)}cleanProof(t){return{id:t.id,amount:t.amount,C:t.C,secret:t.secret}}async toNostrEvent(t){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const n={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(n);const s=await this.ndk.signer.user();return await this.encrypt(s,void 0,"nip44"),super.toNostrEvent(t)}set mint(t){this._mint=t}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(t){this._deletes=t}get amount(){return proofsTotalBalance(this.proofs)}async publish(t,n,s){return this.original?this.original.publish(t,n,s):super.publish(t,n,s)}},MARKERS={REDEEMED:"redeemed",CREATED:"created",DESTROYED:"destroyed",RESERVED:"reserved"},NDKCashuWalletTx=class ua extends NDKEvent{static MARKERS=MARKERS;static kind=7376;static kinds=[7376];constructor(t,n){super(t,n),this.kind??=7376}static async from(t){const n=new ua(t.ndk,t),s=n.content;try{await n.decrypt()}catch{n.content??=s}try{const o=JSON.parse(n.content);n.tags=[...o,...n.tags]}catch{return}return n}set direction(t){this.removeTag("direction"),t&&this.tags.push(["direction",t])}get direction(){return this.tagValue("direction")}set amount(t){this.removeTag("amount"),this.tags.push(["amount",t.toString()])}get amount(){const t=this.tagValue("amount");if(t!==void 0)return Number(t)}set fee(t){this.removeTag("fee"),this.tags.push(["fee",t.toString()])}get fee(){const t=this.tagValue("fee");if(t!==void 0)return Number(t)}set unit(t){this.removeTag("unit"),t&&this.tags.push(["unit",t.toString()])}get unit(){return this.tagValue("unit")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t.toString()])}get description(){return this.tagValue("description")}set mint(t){this.removeTag("mint"),t&&this.tags.push(["mint",t.toString()])}get mint(){return this.tagValue("mint")}set destroyedTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS.DESTROYED))}set destroyedTokenIds(t){for(const n of t)this.tags.push(["e",n,"",MARKERS.DESTROYED])}set createdTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS.CREATED))}set reservedTokens(t){for(const n of t)this.tags.push(n.tagReference(MARKERS.RESERVED))}addRedeemedNutzap(t){this.tag(t,MARKERS.REDEEMED)}async toNostrEvent(t){const n=[],s=[];for(const a of this.tags)this.shouldEncryptTag(a)?n.push(a):s.push(a);this.tags=s.filter(a=>a[0]!=="client"),this.content=JSON.stringify(n);const o=await this.ndk?.signer?.user();if(o){const a=o.pubkey;this.tags=this.tags.filter(c=>c[0]!=="p"||c[1]!==a)}return await this.encrypt(o,void 0,"nip44"),super.toNostrEvent(t)}get hasNutzapRedemption(){return this.getMatchingTags("e",MARKERS.REDEEMED).length>0}shouldEncryptTag(t){return!(["client"].includes(t[0])||t[0]==="e"&&t[3]===MARKERS.REDEEMED||t[0]==="p")}},NDKInterestList=class la extends NDKEvent{static kinds=[10015];constructor(t,n){super(t,n),this.kind??=10015}static from(t){return new la(t.ndk,t.rawEvent())}get interests(){return this.tags.filter(t=>t[0]==="t").map(t=>t[1]).filter(Boolean)}set interests(t){this.tags=this.tags.filter(n=>n[0]!=="t");for(const n of t)this.tags.push(["t",n])}addInterest(t){this.hasInterest(t)||(this.tags.push(["t",t]),this.created_at=Math.floor(Date.now()/1e3))}removeInterest(t){const n=this.tags.findIndex(s=>s[0]==="t"&&s[1]===t);n>=0&&(this.tags.splice(n,1),this.created_at=Math.floor(Date.now()/1e3))}hasInterest(t){return this.tags.some(n=>n[0]==="t"&&n[1]===t)}get interestSetReferences(){return this.tags.filter(t=>t[0]==="a").map(t=>t[1]).filter(t=>t?.startsWith("30015:"))}};createDebug$1("ndk:active-user");var nip19_exports={};__reExport(nip19_exports,nip19_star);var nip49_exports={};__reExport(nip49_exports,nip49_star);function disconnect(r,t){return t??=createDebug$1("ndk:relay:auth-policies:disconnect"),async n=>{t?.(`Relay ${n.url} requested authentication, disconnecting`),r.removeRelay(n.url)}}async function signAndAuth(r,t,n,s,o,a){try{await r.sign(n),o(r)}catch(c){s?.(`Failed to publish auth event to relay ${t.url}`,c),a(r)}}function signIn({ndk:r,signer:t,debug:n}={}){return n??=createDebug$1("ndk:auth-policies:signIn"),async(s,o)=>{n?.(`Relay ${s.url} requested authentication, signing in`);const a=new NDKEvent(r);return a.kind=22242,a.tags=[["relay",s.url],["challenge",o]],t??=r?.signer,new Promise(async(c,f)=>{t?await signAndAuth(a,s,t,n,c,f):r?.once("signer:ready",async g=>{await signAndAuth(a,s,g,n,c,f)})})}}var NDKRelayAuthPolicies={disconnect,signIn};async function ndkSignerFromPayload(r,t){let n;try{n=JSON.parse(r)}catch(o){console.error("Failed to parse signer payload string",r,o);return}if(!n||typeof n.type!="string"){console.error("Failed to parse signer payload string",r,new Error("Missing type field"));return}const s=signerRegistry.get(n.type);if(!s)throw new Error(`Unknown signer type: ${n.type}`);try{return await s.fromPayload(r,t)}catch(o){const a=o instanceof Error?o.message:String(o);throw new Error(`Failed to deserialize signer type ${n.type}: ${a}`)}}var NDKNip07Signer=class ca{_userPromise;encryptionQueue=[];encryptionProcessing=!1;debug;waitTimeout;_pubkey;ndk;_user;constructor(t=1e3,n){this.debug=createDebug$1("ndk:nip07"),this.waitTimeout=t,this.ndk=n}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr?.getPublicKey();if(!t)throw new Error("User rejected access");this._pubkey=t;let n;return this.ndk?n=this.ndk.getUser({pubkey:t}):n=new NDKUser({pubkey:t}),this._user=n,n}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(t){await this.waitForExtension();const n=await window.nostr?.signEvent(t);if(!n)throw new Error("Failed to sign event");return n.sig}async relays(t){await this.waitForExtension();const n=await window.nostr?.getRelays?.()||{},s=[];for(const o of Object.keys(n))n[o].read&&n[o].write&&s.push(o);return s.map(o=>new NDKRelay(o,t?.relayAuthDefaultPolicy,t))}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&window.nostr?.nip04&&n.push("nip04"),(!t||t==="nip44")&&window.nostr?.nip44&&n.push("nip44"),n}async encrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"encrypt",o,n)}async decrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const o=t.pubkey;return this.queueEncryption(s,"decrypt",o,n)}async queueEncryption(t,n,s,o){return new Promise((a,c)=>{this.encryptionQueue.push({scheme:t,method:n,counterpartyHexpubkey:s,value:o,resolve:a,reject:c}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(t,n=0){if(!t&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const s=t||this.encryptionQueue.shift();if(!s){this.encryptionProcessing=!1;return}const{scheme:o,method:a,counterpartyHexpubkey:c,value:f,resolve:g,reject:b}=s;this.debug("Processing encryption queue item",{method:a,counterpartyHexpubkey:c,value:f});try{const _=await window.nostr?.[o]?.[a](c,f);if(!_)throw new Error("Failed to encrypt/decrypt");g(_)}catch(_){const L=_ instanceof Error?_.message:String(_);if(L.includes("call already executing")&&n<5){this.debug("Retrying encryption queue item",{method:a,counterpartyHexpubkey:c,value:f,retries:n}),setTimeout(()=>{this.processEncryptionQueue(s,n+1)},50*n);return}b(_ instanceof Error?_:new Error(L))}this.processEncryptionQueue()}waitForExtension(){return new Promise((t,n)=>{if(window.nostr){t();return}let s;const o=setInterval(()=>{window.nostr&&(clearTimeout(s),clearInterval(o),t())},100);s=setTimeout(()=>{clearInterval(o),n(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${s.type}`);return new ca(void 0,n)}};registerSigner("nip07",NDKNip07Signer);var NDKNostrRpc=class extends libExports.EventEmitter{ndk;signer;relaySet;debug;encryptionType="nip04";pool;constructor(r,t,n,s){if(super(),this.ndk=r,this.signer=t,s){this.pool=new NDKPool(s,r,{debug:n.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,r,this.pool);for(const o of s){const a=this.pool.getRelay(o,!1,!1);a.authPolicy=NDKRelayAuthPolicies.signIn({ndk:r,signer:t,debug:n}),this.relaySet.addRelay(a),a.connect()}}this.debug=n.extend("rpc")}subscribe(r){return new Promise(t=>{const n=this.ndk.subscribe(r,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet,onEvent:async s=>{try{const o=await this.parseEvent(s);o.method?this.emit("request",o):(this.emit(`response-${o.id}`,o),this.emit("response",o))}catch(o){this.debug("error parsing event",o,s.rawEvent())}},onEose:()=>{this.debug("eosed"),t(n)}})})}async parseEvent(r){this.encryptionType==="nip44"&&r.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!r.content.includes("?iv=")&&(this.encryptionType="nip44");const t=this.ndk.getUser({pubkey:r.pubkey});t.ndk=this.ndk;let n;try{n=await this.signer.decrypt(t,r.content,this.encryptionType)}catch{const _=this.encryptionType==="nip04"?"nip44":"nip04";n=await this.signer.decrypt(t,r.content,_),this.encryptionType=_}const s=JSON.parse(n),{id:o,method:a,params:c,result:f,error:g}=s;return a?{id:o,pubkey:r.pubkey,method:a,params:c,event:r}:{id:o,result:f,error:g,event:r}}async sendResponse(r,t,n,s=24133,o){const a={id:r,result:n};o&&(a.error=o);const c=await this.signer.user(),f=this.ndk.getUser({pubkey:t}),g=new NDKEvent(this.ndk,{kind:s,content:JSON.stringify(a),tags:[["p",t]],pubkey:c.pubkey});g.content=await this.signer.encrypt(f,g.content,this.encryptionType),await g.sign(this.signer),await g.publish(this.relaySet)}async sendRequest(r,t,n=[],s=24133,o){const a=Math.random().toString(36).substring(7),c=await this.signer.user(),f=this.ndk.getUser({pubkey:r}),g={id:a,method:t,params:n},b=new Promise(()=>{const L=q=>{q.result==="auth_url"?(this.once(`response-${a}`,L),this.emit("authUrl",q.error)):o&&o(q)};this.once(`response-${a}`,L)}),_=new NDKEvent(this.ndk,{kind:s,content:JSON.stringify(g),tags:[["p",r]],pubkey:c.pubkey});return _.content=await this.signer.encrypt(f,_.content,this.encryptionType),await _.sign(this.signer),await _.publish(this.relaySet),b}};function nostrConnectGenerateSecret(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri(r,t,n,s){const o={name:s?.name?encodeURIComponent(s.name):"",url:s?.url?encodeURIComponent(s.url):"",image:s?.image?encodeURIComponent(s.image):"",perms:s?.perms?encodeURIComponent(s.perms):""};let a=`nostrconnect://${r}?image=${o.image}&url=${o.url}&name=${o.name}&perms=${o.perms}&secret=${encodeURIComponent(t)}`;return n&&(a+=`&relay=${encodeURIComponent(n)}`),a}var NDKNip46Signer=class Ti extends libExports.EventEmitter{ndk;_user;bunkerPubkey;userPubkey;get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}secret;localSigner;nip05;rpc;debug;relayUrls;subscription;nostrConnectUri;nostrConnectSecret;constructor(t,n,s,o,a){super(),this.ndk=t,this.debug=t.debug.extend("nip46:signer"),this.relayUrls=o,s?typeof s=="string"?this.localSigner=new NDKPrivateKeySigner(s):this.localSigner=s:this.localSigner=NDKPrivateKeySigner.generate(),n===!1||(n?n.startsWith("bunker://")?this.bunkerFlowInit(n):this.nip05Init(n):this.nostrconnectFlowInit(a)),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}static bunker(t,n,s){return new Ti(t,n,s)}static nostrconnect(t,n,s,o){return new Ti(t,void 0,s,[n],o)}nostrconnectFlowInit(t){this.nostrConnectSecret=nostrConnectGenerateSecret();const n=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri(n,this.nostrConnectSecret,this.relayUrls?.[0],t)}bunkerFlowInit(t){const n=new URL(t),s=n.hostname||n.pathname.replace(/^\/\//,""),o=n.searchParams.get("pubkey"),a=n.searchParams.getAll("relay"),c=n.searchParams.get("secret");this.bunkerPubkey=s,this.userPubkey=o,this.relayUrls=a,this.secret=c}nip05Init(t){this.nip05=t}async startListening(){if(this.subscription)return;const t=await this.localSigner.user();if(!t)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[t.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((t,n)=>{const s=o=>{o.result===this.nostrConnectSecret&&(this._user=o.event.author,this.userPubkey=o.event.pubkey,this.bunkerPubkey=o.event.pubkey,this.rpc.off("response",s),t(this._user))};this.startListening(),this.rpc.on("response",s)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const t=await NDKUser.fromNip05(this.nip05,this.ndk);t&&(this._user=t,this.userPubkey=t.pubkey,this.relayUrls=t.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...t)=>{this.emit("authUrl",...t)}),new Promise((t,n)=>{const s=[this.userPubkey??""];if(this.secret&&s.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",s,24133,o=>{o.result==="ack"?this.getPublicKey().then(a=>{this.userPubkey=a,this._user=this.ndk.getUser({pubkey:a}),t(this._user)}):n(o.error)})})}stop(){this.subscription?.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((t,n)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,s=>{t(s.result)})})}async encryptionEnabled(t){return t?[t]:Promise.resolve(["nip04","nip44"])}async encrypt(t,n,s="nip04"){return this.encryption(t,n,s,"encrypt")}async decrypt(t,n,s="nip04"){return this.encryption(t,n,s,"decrypt")}async encryption(t,n,s,o){return new Promise((c,f)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${s}_${o}`,[t.pubkey,n],24133,g=>{g.error?f(g.error):c(g.result)})})}async sign(t){return new Promise((s,o)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(t)],24133,a=>{if(a.error)o(a.error);else{const c=JSON.parse(a.result);s(c.sig)}})})}async createAccount(t,n,s){await this.startListening();const o=[];return t&&o.push(t),n&&o.push(n),s&&o.push(s),new Promise((a,c)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",o,24133,f=>{if(f.error)c(f.error);else{const g=f.result;a(g)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const t={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(t)}static async fromPayload(t,n){if(!n)throw new Error("NDK instance is required to deserialize NIP-46 signer");const s=JSON.parse(t);if(s.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${s.type}`);const o=s.payload;if(!o||typeof o!="object"||!o.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const a=await ndkSignerFromPayload(o.localSignerPayload,n);if(!a)throw new Error("Failed to deserialize local signer for NIP-46");if(!(a instanceof NDKPrivateKeySigner))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let c;return c=new Ti(n,!1,a,o.relayUrls),c.userPubkey=o.userPubkey,c.bunkerPubkey=o.bunkerPubkey,c.relayUrls=o.relayUrls,c.secret=o.secret,o.userPubkey&&(c._user=new NDKUser({pubkey:o.userPubkey}),c._user&&(c._user.ndk=n)),c}};registerSigner("nip46",NDKNip46Signer);createDebug$1("ndk:zapper:ln");createDebug$1("ndk:zapper");const index=Object.freeze(Object.defineProperty({__proto__:null,NDKAppHandlerEvent,NDKArticle,NDKBlossomList,NDKCashuMintAnnouncement,NDKCashuMintList,NDKCashuToken,NDKCashuWalletTx,NDKClassified,NDKDVMJobFeedback,NDKDraft,NDKEvent,NDKFedimintMint,NDKFollowPack,NDKHighlight,NDKImage,NDKInterestList,NDKKind,NDKList,NDKMintRecommendation,NDKNip07Signer,NDKNip46Signer,NDKNostrRpc,NDKNutzap,NDKPool,NDKPrivateKeySigner,NDKProject,NDKProjectTemplate,NDKPublishError,NDKRelay,NDKRelayAuthPolicies,NDKRelayList,NDKRelaySet,NDKRepost,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKStory,NDKStorySticker,NDKSubscriptionCacheUsage,NDKSubscriptionReceipt,NDKSubscriptionStart,NDKSubscriptionTier,NDKTask,NDKThread,NDKUser,NDKVideo,NDKWiki,NDKWikiMergeRequest,calculateRelaySetFromEvent,deserialize,eventHasETagMarkers,fetchRelayInformation,filterFingerprint,generateContentTags,generateHashtags,getReplyTag,getRootTag,giftUnwrap,giftWrap,imetaTagToTag,isValidHex64,isValidPubkey,mapImetaTag,mergeFilters,mergeTags,ndkSignerFromPayload,newAmount,nip19:nip19_exports,nip49:nip49_exports,normalizeRelayUrl,normalizeUrl,parseTagToSubscriptionAmount,possibleIntervalFrequencies,profileFromEvent,proofsTotalBalance,registerSigner,serialize,serializeProfile,strToDimension,strToPosition,tryNormalizeRelayUrl,wrapEvent},Symbol.toStringTag,{value:"Module"}));var SessionError=class extends Error{constructor(r){super(r),this.name="SessionError"}},StorageError=class extends SessionError{constructor(r){super(r),this.name="StorageError"}};function serializeSessionData(r){const t={sessions:Array.from(r.sessions.entries()),activePubkey:r.activePubkey,version:1,updatedAt:Date.now()};return JSON.stringify(t,null,2)}function deserializeSessionData(r){const t=JSON.parse(r);return{sessions:new Map(t.sessions||[]),activePubkey:t.activePubkey}}var LocalStorage=class{constructor(r="ndk-sessions"){this.key=r}async save(r,t){if(typeof window>"u"||!window.localStorage)throw new StorageError("localStorage is not available");try{const s=serializeSessionData({sessions:r,activePubkey:t});localStorage.setItem(this.key,s)}catch(n){const s=n instanceof Error?n.message:"Unknown error";throw new StorageError(`Failed to save sessions to localStorage: ${s}`)}}async load(){if(typeof window>"u"||!window.localStorage)return{sessions:new Map};const r=localStorage.getItem(this.key);if(!r)return{sessions:new Map};try{return deserializeSessionData(r)}catch(t){const n=t instanceof Error?t.message:"Unknown error";throw new StorageError(`Failed to parse sessions from localStorage: ${n}`)}}async clear(){if(typeof window>"u"||!window.localStorage)throw new StorageError("localStorage is not available");try{localStorage.removeItem(this.key)}catch(r){const t=r instanceof Error?r.message:"Unknown error";throw new StorageError(`Failed to clear sessions from localStorage: ${t}`)}}},browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var r=1e3,t=r*60,n=t*60,s=n*24,o=s*7,a=s*365.25;ms=function(_,L){L=L||{};var q=typeof _;if(q==="string"&&_.length>0)return c(_);if(q==="number"&&isFinite(_))return L.long?g(_):f(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function c(_){if(_=String(_),!(_.length>100)){var L=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(L){var q=parseFloat(L[1]),X=(L[2]||"ms").toLowerCase();switch(X){case"years":case"year":case"yrs":case"yr":case"y":return q*a;case"weeks":case"week":case"w":return q*o;case"days":case"day":case"d":return q*s;case"hours":case"hour":case"hrs":case"hr":case"h":return q*n;case"minutes":case"minute":case"mins":case"min":case"m":return q*t;case"seconds":case"second":case"secs":case"sec":case"s":return q*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return q;default:return}}}}function f(_){var L=Math.abs(_);return L>=s?Math.round(_/s)+"d":L>=n?Math.round(_/n)+"h":L>=t?Math.round(_/t)+"m":L>=r?Math.round(_/r)+"s":_+"ms"}function g(_){var L=Math.abs(_);return L>=s?b(_,L,s,"day"):L>=n?b(_,L,n,"hour"):L>=t?b(_,L,t,"minute"):L>=r?b(_,L,r,"second"):_+" ms"}function b(_,L,q,X){var te=L>=q*1.5;return Math.round(_/q)+" "+X+(te?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function r(t){s.debug=s,s.default=s,s.coerce=b,s.disable=f,s.enable=a,s.enabled=g,s.humanize=requireMs(),s.destroy=_,Object.keys(t).forEach(L=>{s[L]=t[L]}),s.names=[],s.skips=[],s.formatters={};function n(L){let q=0;for(let X=0;X<L.length;X++)q=(q<<5)-q+L.charCodeAt(X),q|=0;return s.colors[Math.abs(q)%s.colors.length]}s.selectColor=n;function s(L){let q,X=null,te,ne;function Ce(...Le){if(!Ce.enabled)return;const Ge=Ce,ze=Number(new Date),Xe=ze-(q||ze);Ge.diff=Xe,Ge.prev=q,Ge.curr=ze,q=ze,Le[0]=s.coerce(Le[0]),typeof Le[0]!="string"&&Le.unshift("%O");let He=0;Le[0]=Le[0].replace(/%([a-zA-Z%])/g,(We,rt)=>{if(We==="%%")return"%";He++;const st=s.formatters[rt];if(typeof st=="function"){const ht=Le[He];We=st.call(Ge,ht),Le.splice(He,1),He--}return We}),s.formatArgs.call(Ge,Le),(Ge.log||s.log).apply(Ge,Le)}return Ce.namespace=L,Ce.useColors=s.useColors(),Ce.color=s.selectColor(L),Ce.extend=o,Ce.destroy=s.destroy,Object.defineProperty(Ce,"enabled",{enumerable:!0,configurable:!1,get:()=>X!==null?X:(te!==s.namespaces&&(te=s.namespaces,ne=s.enabled(L)),ne),set:Le=>{X=Le}}),typeof s.init=="function"&&s.init(Ce),Ce}function o(L,q){const X=s(this.namespace+(typeof q>"u"?":":q)+L);return X.log=this.log,X}function a(L){s.save(L),s.namespaces=L,s.names=[],s.skips=[];const q=(typeof L=="string"?L:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const X of q)X[0]==="-"?s.skips.push(X.slice(1)):s.names.push(X)}function c(L,q){let X=0,te=0,ne=-1,Ce=0;for(;X<L.length;)if(te<q.length&&(q[te]===L[X]||q[te]==="*"))q[te]==="*"?(ne=te,Ce=X,te++):(X++,te++);else if(ne!==-1)te=ne+1,Ce++,X=Ce;else return!1;for(;te<q.length&&q[te]==="*";)te++;return te===q.length}function f(){const L=[...s.names,...s.skips.map(q=>"-"+q)].join(",");return s.enable(""),L}function g(L){for(const q of s.skips)if(c(L,q))return!1;for(const q of s.names)if(c(L,q))return!0;return!1}function b(L){return L instanceof Error?L.stack||L.message:L}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return common=r,common}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,(function(r,t){var n={};t.formatArgs=o,t.save=a,t.load=c,t.useColors=s,t.storage=f(),t.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let b;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(b[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const _="color: "+this.color;b.splice(1,0,_,"color: inherit");let L=0,q=0;b[0].replace(/%[a-zA-Z%]/g,X=>{X!=="%%"&&(L++,X==="%c"&&(q=L))}),b.splice(q,0,_)}t.log=console.debug||console.log||(()=>{});function a(b){try{b?t.storage.setItem("debug",b):t.storage.removeItem("debug")}catch{}}function c(){let b;try{b=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!b&&typeof process<"u"&&"env"in process&&(b=n.DEBUG),b}function f(){try{return localStorage}catch{}}r.exports=requireCommon()(t);const{formatters:g}=r.exports;g.j=function(b){try{return JSON.stringify(b)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}})(browser,browser.exports)),browser.exports}var browserExports=requireBrowser();const createDebug=getDefaultExportFromCjs(browserExports);function createModalStore(){let r=state(!1),t=state(null);return{get show(){return get(r)},set show(n){set(r,n,!0)},get data(){return get(t)},set data(n){set(t,n,!0)},open(n){set(t,n??null,!0),set(r,!0)},close(){set(r,!1),set(t,null)}}}const baseModal=createModalStore(),relayAuthModal={get show(){return baseModal.show},get request(){return baseModal.data},open(r){baseModal.open(r)},confirm(){baseModal.data&&(baseModal.data.onConfirm(),baseModal.close())},reject(){baseModal.data&&(baseModal.data.onReject(),baseModal.close())},close(){baseModal.close()}},AGORAS_SELECTION="agoras",AGORA_RELAYS=["wss://ve.agorawlc.com/","wss://ni.agorawlc.com/","wss://zw.agorawlc.com/","wss://4cfbf6275e9a.ngrok.app/"],WALLET_DEFAULT_RELAYS=["wss://relay.primal.net/","wss://relay.nostr.band/"],AGORA_LANGUAGE_MAP={"wss://ve.agorawlc.com/":"es","wss://ni.agorawlc.com/":"es","wss://zw.agorawlc.com/":"en"};function isAgoraRelay(r){return r?r.includes("agorawlc.com")||r.includes("ngrok.app"):!1}function isAgorasSelection(r){return r===AGORAS_SELECTION}function getRelaysToUse(r,t){return isAgorasSelection(r)?[...AGORA_RELAYS]:r?[r]:[]}function getAgoraLanguage(r){return r?AGORA_LANGUAGE_MAP[r]??null:null}function applyThemeColor(r){typeof window>"u"||document.documentElement.setAttribute("data-theme",r)}const DEFAULT_RELAYS$1=[...AGORA_RELAYS.map(r=>({url:r,read:!0,write:!0,enabled:!0})),{url:"wss://relay.damus.io",read:!0,write:!0,enabled:!0},{url:"wss://nos.lol",read:!0,write:!0,enabled:!0},{url:"wss://relay.primal.net",read:!0,write:!0,enabled:!0}],DEFAULT_SETTINGS={relays:DEFAULT_RELAYS$1,selectedRelay:"agoras",theme:"system",themeColor:"orange",language:"en",notifications:{enabled:!0,mentions:!0,replies:!0,zaps:!0},privacy:{hideReadReceipts:!1,hideTypingIndicator:!1},zap:{defaultAmount:21},wallet:{npubCashEnabled:!1},relayAuth:{mode:"always"}};function loadSettings(){if(typeof window>"u")return DEFAULT_SETTINGS;try{const r=localStorage.getItem("voces-settings");if(r){const t=JSON.parse(r);return t.relays&&(t.relays=t.relays.map(n=>({...n,url:n.url.replace(/^wss:\/\/ws:\/\//,"ws://").replace(/^wss:\/\/wss:\/\//,"wss://")}))),{...DEFAULT_SETTINGS,...t}}}catch(r){console.error("Failed to load settings:",r)}return DEFAULT_SETTINGS}function saveSettings(r){if(!(typeof window>"u"))try{localStorage.setItem("voces-settings",JSON.stringify(r))}catch(t){console.error("Failed to save settings:",t)}}class SettingsStore{#e=state(proxy(loadSettings()));get state(){return get(this.#e)}set state(t){set(this.#e,t,!0)}get relays(){return this.state.relays}get selectedRelay(){return this.state.selectedRelay}get theme(){return this.state.theme}get themeColor(){return this.state.themeColor}get language(){return this.state.language}get notifications(){return this.state.notifications}get privacy(){return this.state.privacy}get zap(){return this.state.zap}get wallet(){return this.state.wallet}get relayAuth(){return this.state.relayAuth}addRelay(t){this.state.relays=[...this.state.relays,t],saveSettings(this.state)}removeRelay(t){this.state.relays=this.state.relays.filter(n=>n.url!==t),saveSettings(this.state)}updateRelay(t,n){this.state.relays=this.state.relays.map(s=>s.url===t?{...s,...n}:s),saveSettings(this.state)}toggleRelay(t){this.state.relays=this.state.relays.map(n=>n.url===t?{...n,enabled:!n.enabled}:n),saveSettings(this.state)}setRelays(t){this.state.relays=t,saveSettings(this.state)}setSelectedRelay(t){this.state.selectedRelay=t,saveSettings(this.state)}setTheme(t){this.state.theme=t,saveSettings(this.state),typeof window<"u"&&(t==="dark"||t==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light")))}setThemeColor(t){this.state.themeColor=t,saveSettings(this.state),applyThemeColor(t)}setLanguage(t){this.state.language=t,saveSettings(this.state)}updateNotifications(t){this.state.notifications={...this.state.notifications,...t},saveSettings(this.state)}updatePrivacy(t){this.state.privacy={...this.state.privacy,...t},saveSettings(this.state)}updateZap(t){this.state.zap={...this.state.zap,...t},saveSettings(this.state)}updateWallet(t){this.state.wallet={...this.state.wallet,...t},saveSettings(this.state)}updateRelayAuth(t){this.state.relayAuth={...this.state.relayAuth,...t},saveSettings(this.state)}save(){saveSettings(this.state)}resetToDefaults(){this.state={...DEFAULT_SETTINGS},saveSettings(this.state)}}const settings=new SettingsStore,debug=createDebug("agora:relay:auth"),AUTH_DECISIONS_KEY="agora:relay-auth-decisions",authDecisionsCache=new Map;function loadAuthDecisions(){try{const r=localStorage.getItem(AUTH_DECISIONS_KEY);if(r){const t=JSON.parse(r),n=new Map;return t.forEach(s=>n.set(s.relay,s.accepted)),n}}catch(r){debug("Failed to load auth decisions:",r)}return new Map}function saveAuthDecisions(r){try{const t=Array.from(r.entries()).map(([n,s])=>({relay:n,accepted:s,timestamp:Date.now()}));localStorage.setItem(AUTH_DECISIONS_KEY,JSON.stringify(t))}catch(t){debug("Failed to save auth decisions:",t)}}typeof window<"u"&&loadAuthDecisions().forEach((t,n)=>authDecisionsCache.set(n,t));async function promptUserForAuth(r){return new Promise(t=>{relayAuthModal.open({relayUrl:r.url,onConfirm:()=>{authDecisionsCache.set(r.url,!0),saveAuthDecisions(authDecisionsCache),t(!0)},onReject:()=>{authDecisionsCache.set(r.url,!1),saveAuthDecisions(authDecisionsCache),t(!1)}})})}function getStoredDecision(r){return authDecisionsCache.get(r)}async function createAndSignAuthEvent(r,t,n){const s=new NDKEvent(r);s.kind=NDKKind.ClientAuth,s.tags=[["relay",t.url],["challenge",n]];const o=r?.signer||r?.activeUser?.signer;if(o)try{return await s.sign(o),debug(`Successfully signed auth event for ${t.url}`),s}catch(a){return debug("Failed to sign auth event:",a),!1}else return debug(`No signer available for ${t.url}, waiting for signer...`),new Promise(a=>{const c=setTimeout(()=>{debug(`Signer timeout for ${t.url}, authentication failed`),a(!1)},5e3),f=async g=>{clearTimeout(c);try{await s.sign(g),debug(`Successfully signed auth event for ${t.url} after waiting`),a(s)}catch(b){debug("Failed to sign auth event after waiting:",b),a(!1)}};r?.once("signer:ready",f)})}function createAuthPolicyWithConfirmation({ndk:r}={}){return debug("Creating auth policy with user confirmation"),async(t,n)=>{if(debug(`Relay ${t.url} requested authentication`),settings.relayAuth.mode==="always")return debug(`Auto-authenticating to ${t.url} (mode: always)`),createAndSignAuthEvent(r,t,n);if(isAgoraRelay(t.url))return debug(`Auto-authenticating to Agora relay: ${t.url}`),createAndSignAuthEvent(r,t,n);const o=getStoredDecision(t.url);return o!==void 0?(debug(`Using stored decision for ${t.url}: ${o?"accepted":"rejected"}`),o?createAndSignAuthEvent(r,t,n):!1):(debug(`Prompting user for auth decision for ${t.url}`),await promptUserForAuth(t)?(debug(`User accepted authentication for ${t.url}`),createAndSignAuthEvent(r,t,n)):(debug(`User rejected authentication for ${t.url}`),!1))}}function createHashtagInterestsStore(r){const t=user_derived(()=>r.$sessions?.getSessionEvent(10015)),n=user_derived(()=>get(t)?get(t).tags.filter(c=>c[0]==="t"&&c[1]).map(c=>c[1].toLowerCase()):[]);async function s(c){if(!r.$currentUser)throw new Error("No user logged in");const g=c.toLowerCase();if(get(n).includes(g))return;const b=get(t),_=new NDKEvent(r);_.kind=NDKKind.InterestList,b?_.tags=[...b.tags.filter(L=>L[0]==="t"),["t",g]]:_.tags=[["t",g]],_.content=b?.content||"",await _.publish()}async function o(c){if(!r.$currentUser)throw new Error("No user logged in");const g=c.toLowerCase();if(!get(n).includes(g))return;const b=get(t);if(!b)return;const _=new NDKEvent(r);_.kind=NDKKind.InterestList,_.tags=b.tags.filter(L=>!(L[0]==="t"&&L[1]?.toLowerCase()===g)),_.content=b.content||"",await _.publish()}async function a(c){const f=c.toLowerCase();get(n).includes(f)?await o(f):await s(f)}return{get interests(){return get(n)},addHashtag:s,removeHashtag:o,toggleHashtag:a}}const DEFAULT_RELAYS=["wss://relay.primal.net","wss://relay.nostr.band"],cacheAdapter=browser$3?new src_default({dbName:"voces-cache",useWorker:!0,workerUrl:"/worker.js",wasmUrl:"/sql-wasm.wasm"}):void 0;let sigVerifyWorker;const ndk=new NDKSvelte({explicitRelayUrls:DEFAULT_RELAYS,autoConnectUserRelays:!0,cacheAdapter,signatureVerificationWorker:sigVerifyWorker,initialValidationRatio:1,lowestValidationRatio:.1,aiGuardrails:!1,session:browser$3?{storage:new LocalStorage,autoSave:!0,fetches:{follows:!0,mutes:!0,wallet:!0,relayList:!0,eventConstructors:[NDKBlossomList,NDKInterestList]}}:void 0});browser$3&&(ndk.relayAuthDefaultPolicy=createAuthPolicyWithConfirmation({ndk}));const ndkReady=(async()=>{if(browser$3)try{const r=(await __vitePreload(async()=>{const{default:t}=await import("./DSb2m4Rn.js");return{default:t}},[],import.meta.url)).default;sigVerifyWorker=new r,ndk.signatureVerificationWorker=sigVerifyWorker,cacheAdapter&&await cacheAdapter.initializeAsync(ndk),ndk.connect()}catch(r){console.error(" Failed to initialize cache:",r)}})(),hashtagInterests=browser$3?createHashtagInterestsStore(ndk):null;export{giftWrap as $,AGORA_RELAYS as A,NDKCashuMintList$1 as B,NDKCashuWalletTx$1 as C,NDKUser$1 as D,proofsTotalBalance$1 as E,NDKCashuToken$1 as F,fetchRelayInformation$2 as G,normalizeUrl$1 as H,NdkNutzapStatus as I,NDKNutzap$1 as J,proofP2pk as K,cashuPubkeyToNostrPubkey as L,isAgorasSelection as M,NDKKind as N,AGORAS_SELECTION as O,isAgoraRelay as P,bind_select_value as Q,NDKClassified as R,EventContent as S,mapImetaTag as T,set_checked as U,getDefaultExportFromCjs as V,WALLET_DEFAULT_RELAYS as W,sha256$2 as X,bytesToHex$1 as Y,schnorr$1 as Z,NDKUser as _,NDKFollowPack as a,giftUnwrap as a0,hashtagInterests as a1,getRelaysToUse as a2,init_select as a3,select_option as a4,NDKZapper as a5,hasZappedBy as a6,NDKList as a7,createDebug$1 as a8,wrapEvent as a9,proofsTotalBalance as aA,normalizeUrl as aB,NDKMintRecommendation as aC,NDKCashuMintAnnouncement as aD,NDKNip07Signer as aE,relayAuthModal as aF,EventContentHandlersProxy as aG,setEventContentComponents as aH,applyThemeColor as aI,ndkReady as aJ,index as aK,NDKBlossomList as aa,NDKPrivateKeySigner as ab,hexToBytes as ac,bytesToHex as ad,sha256 as ae,secp256k1 as af,createHasher as ag,HashMD as ah,rotl$1 as ai,clean as aj,createView as ak,concatBytes as al,abytes as am,hmac as an,utf8ToBytes as ao,sha512 as ap,mod as aq,sha256$1 as ar,schnorr as as,randomBytes as at,fetchRelayInformation as au,libExports as av,NDKRelayList as aw,bolt11Exports as ax,NDKCashuToken as ay,NDKCashuWalletTx as az,attribute_effect as b,createModalStore as c,set_class as d,each as e,Avatar as f,set_style as g,set_attribute as h,settings as i,NDKArticle as j,NDKSubscriptionCacheUsage as k,getAgoraLanguage as l,NDKEvent as m,ndk as n,NDKRelaySet as o,isValidPubkey as p,NDKCashuMintList as q,remove_input_defaults as r,set_value as s,index$1 as t,NDKEvent$1 as u,NDKPrivateKeySigner$1 as v,NDKRelaySet$1 as w,NDKKind$1 as x,NDKSubscriptionCacheUsage$1 as y,NDKRelayList$1 as z};
