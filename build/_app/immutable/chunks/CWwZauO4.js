import{d as Oe,c as Se,i as je,a as b,f as C,s as _,r as Qe,j as Ye}from"./CiPFrJr-.js";import{p as qe,b as A,x as Ge,a as He,s,f as Me,c as Je,$ as We,g as e,e as o,d,r as t,y as Le,t as D,z as Xe,u as X}from"./CSbKtK4P.js";import{p as Ze,i as T}from"./87vUJtvC.js";import{n as h,d as de,a as Ue,r as ke,h as $e,e as ze,f as Ne}from"./D0X4VYcq.js";import{a as er,p as rr}from"./DzBAiUtV.js";import{b as se}from"./DphWBL27.js";import{t as M}from"./B0fEDaa-.js";async function tr(f,r,u,g,m,F,S,k,l){if(!e(r).trim()||e(u)){M.error("Please provide a title");return}if(e(g).size===0){M.error("Please add at least one member");return}try{s(u,!0);const a=m.editingPack?Ue.from(m.editingPack):new Ue(h);if(a.title=e(r).trim(),a.description=e(F).trim()||void 0,a.image=e(S).trim()||void 0,a.pubkeys=Array.from(e(g)),await a.sign(),await a.publishReplaceable(),a.publishStatus==="error"){const le=a.publishError?.relayErrors||{},Z=Object.entries(le).map(([$,ee])=>`${$}: ${ee}`).join(`
`);M.error(`Failed to publish:
${Z||"Unknown error"}`);return}M.success(m.editingPack?"Follow pack updated":"Follow pack created"),k(),l(!1),m.onClose?.()}catch(a){console.error("Failed to publish follow pack:",a),M.error(`${m.editingPack?"Failed to update":"Failed to create"} follow pack: ${a instanceof Error?a.message:"Unknown error"}`)}finally{s(u,!1)}}function or(f,r){f.target===f.currentTarget&&r()}var ar=f=>f.stopPropagation(),ir=(f,r)=>s(r,"details"),dr=(f,r)=>s(r,"members"),sr=C('<div class="mt-3 rounded-lg overflow-hidden border border-border"><img alt="Preview" class="w-full h-48 object-cover"/></div>'),nr=C('<div class="space-y-5"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Cover Image URL (optional)</label> <input type="url" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Title <span class="text-red-500">*</span></label> <input type="text" placeholder="e.g., Bitcoin Developers" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors" maxlength="100"/></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Description (optional)</label> <textarea placeholder="Describe what this follow pack is about..." class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors resize-none" rows="4" maxlength="500"></textarea> <p class="text-xs text-muted-foreground mt-1"> </p></div></div>'),lr=(f,r,u)=>{f.key==="Enter"&&e(r).trim()&&u()},cr=C('<button class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-primary hover:bg-accent-dark text-foreground rounded text-sm font-medium transition-colors">Add</button>'),ur=C('<div class="text-center py-8 text-muted-foreground text-sm"> </div>'),vr=(f,r,u)=>r(u),fr=Ye('<svg class="w-3 h-3 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),mr=C('<button><!> <div class="flex-1 min-w-0 text-left"><div class="font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <div><!></div></button>'),br=(f,r,u)=>r(u),pr=C('<div class="flex items-center gap-3 p-2 rounded-lg bg-card/50"><!> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <button class="p-1 text-muted-foreground hover:text-red-500 transition-colors" aria-label="Remove member"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),gr=C('<div class="bg-muted/50 rounded-lg p-4 border border-border"><div class="text-sm font-medium text-muted-foreground mb-3"> </div> <div class="space-y-2 max-h-48 overflow-y-auto"></div></div>'),xr=C('<div class="space-y-4"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Add members</label> <div class="relative"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search follows or enter npub/NIP-05..." class="w-full pl-10 pr-20 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <p class="text-xs text-muted-foreground mt-1.5">Search your follows by name, or paste an npub/NIP-05 to add anyone</p></div> <div><div class="max-h-96 overflow-y-auto space-y-2 bg-muted/30 rounded-lg p-2 border border-border"><!></div></div> <!></div>'),_r=C('<div class="fixed inset-0 z-50 flex items-start justify-center bg-background/80 backdrop-blur-sm overflow-y-auto py-8" role="presentation"><div class="w-full max-w-3xl mx-4 bg-card rounded-2xl border border-border shadow-2xl my-auto" role="dialog" aria-modal="true"><div class="flex items-center justify-between px-6 py-4 border-b border-border"><div class="flex items-center gap-3"><button class="text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <h2 class="text-xl font-bold text-foreground flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg> </h2></div> <button class="px-5 py-2.5 bg-primary hover:bg-accent-dark disabled:bg-muted disabled:cursor-not-allowed text-foreground rounded-lg transition-colors font-semibold text-sm"> </button></div> <div class="flex border-b border-border"><button>Details</button> <button> </button></div> <div class="p-6"><!></div> <div class="px-6 py-4 border-t border-border bg-card/50"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel</p></div></div></div>');function Sr(f,r){qe(r,!0);let u=Ze(r,"open",15,!1),g=A("details"),m=A(!1),F=A(""),S=A(""),k=A(""),l=A(Ge(new Set(r.initialPubkey?[r.initialPubkey]:[]))),a=A("");const ne=h.$currentUser,le=h.$subscribe(()=>ne?.pubkey?{filters:[{kinds:[3],authors:[ne.pubkey],limit:1}],bufferMs:100}:void 0),Z=X(()=>{const i=le.events[0];return i?new Set(i.tags.filter(n=>n[0]==="p").map(n=>n[1])):new Set}),$=X(()=>{if(!e(a))return Array.from(e(Z));const i=e(a).toLowerCase();return Array.from(e(Z)).filter(n=>{const j=h.$fetchProfile(()=>n);return n.toLowerCase().includes(i)||j?.name?.toLowerCase().includes(i)||j?.displayName?.toLowerCase().includes(i)||j?.nip05?.toLowerCase().includes(i)})});function ee(i){e(l).has(i)?e(l).delete(i):e(l).add(i),s(l,new Set(e(l)),!0)}async function we(){if(e(a).trim())try{const i=e(a).trim();let n=await h.fetchUser(i);!n&&i.includes("@")&&(n=await h.fetchUser(i)),n?.pubkey?(e(l).add(n.pubkey),s(l,new Set(e(l)),!0),s(a,""),M.success("User added")):M.error("User not found")}catch(i){console.error("Failed to fetch user:",i),M.error("Failed to fetch user")}}function ye(){s(F,""),s(S,""),s(k,""),s(l,new Set(r.initialPubkey?[r.initialPubkey]:[]),!0),s(a,""),s(g,"details")}function ce(){e(m)||(ye(),u(!1),r.onClose?.())}function Be(i){i.key==="Escape"&&!e(m)&&ce()}He(()=>{if(u()&&r.editingPack){s(F,r.editingPack.tagValue("title")||"",!0),s(S,r.editingPack.tagValue("description")||"",!0),s(k,r.editingPack.tagValue("image")||"",!0);const i=r.editingPack.tags.filter(n=>n[0]==="p").map(n=>n[1]);s(l,new Set(i),!0),s(g,"details")}else u()&&r.initialPubkey&&s(l,new Set([r.initialPubkey]),!0)});var Pe=Se();je("keydown",We,Be);var Ee=Me(Pe);{var Ae=i=>{var n=_r();n.__click=[or,ce];var j=o(n);j.__click=[ar];var ue=o(j),ve=o(ue),fe=o(ve);fe.__click=ce;var Ce=d(fe,2),De=d(o(Ce));t(Ce),t(ve);var re=d(ve,2);re.__click=[tr,F,m,l,r,S,k,ye,u];var Te=o(re,!0);t(re),t(ue);var me=d(ue,2),be=o(me);be.__click=[ir,g];var te=d(be,2);te.__click=[dr,g];var Ie=o(te);t(te),t(me);var Fe=d(me,2),Re=o(Fe);{var Ve=x=>{var L=nr(),U=o(L),I=d(o(U),2);ke(I);var R=d(I,2);{var pe=p=>{var G=sr(),c=o(G);t(G),D(()=>$e(c,"src",e(k))),je("error",c,v=>v.currentTarget.style.display="none"),Qe(c),b(p,G)};T(R,p=>{e(k).trim()&&p(pe)})}t(U);var Q=d(U,2),V=d(o(Q),2);ke(V),t(Q);var Y=d(Q,2),q=d(o(Y),2);Xe(q);var oe=d(q,2),ge=o(oe);t(oe),t(Y),t(L),D(()=>_(ge,`${e(S).length??""}/500 characters`)),se(I,()=>e(k),p=>s(k,p)),se(V,()=>e(F),p=>s(F,p)),se(q,()=>e(S),p=>s(S,p)),b(x,L)},Ke=x=>{var L=xr(),U=o(L),I=d(o(U),2),R=d(o(I),2);ke(R),R.__keydown=[lr,a,we];var pe=d(R,2);{var Q=c=>{var v=cr();v.__click=we,b(c,v)};T(pe,c=>{e(a).trim()&&(e(a).includes("npub1")||e(a).includes("@"))&&c(Q)})}t(I),Le(2),t(U);var V=d(U,2),Y=o(V),q=o(Y);{var oe=c=>{var v=ur(),z=o(v,!0);t(v),D(()=>_(z,e(a)?"No matches found":"You don't follow anyone yet")),b(c,v)},ge=c=>{var v=Se(),z=Me(v);ze(z,16,()=>e($),H=>H,(H,w)=>{const N=X(()=>h.$fetchProfile(()=>w)),y=X(()=>e(l).has(w));var P=mr();P.__click=[vr,ee,w];var K=o(P);Ne(K,{get ndk(){return h},get pubkey(){return w},class:"w-10 h-10 flex-shrink-0"});var O=d(K,2),B=o(O),J=o(B,!0);t(B);var ae=d(B,2),ie=o(ae,!0);t(ae),t(O);var W=d(O,2),xe=o(W);{var _e=E=>{var he=fr();b(E,he)};T(xe,E=>{e(y)&&E(_e)})}t(W),t(P),D((E,he)=>{de(P,1,`w-full flex items-center gap-3 p-3 rounded-lg transition-colors ${e(y)?"bg-primary/20 border border-primary/50":"bg-card border border-border hover:border-border"}`),_(J,E),_(ie,he),de(W,1,`w-5 h-5 rounded border-2 flex items-center justify-center ${e(y)?"bg-primary border-primary":"border"}`)},[()=>e(N)?.displayName||e(N)?.name||`${w.slice(0,8)}...`,()=>e(N)?.nip05||`${w.slice(0,16)}...`]),b(H,P)}),b(c,v)};T(q,c=>{e($).length===0?c(oe):c(ge,!1)})}t(Y),t(V);var p=d(V,2);{var G=c=>{var v=gr(),z=o(v),H=o(z);t(z);var w=d(z,2);ze(w,20,()=>Array.from(e(l)),N=>N,(N,y)=>{const P=X(()=>h.$fetchProfile(()=>y));var K=pr(),O=o(K);Ne(O,{get ndk(){return h},get pubkey(){return y},class:"w-8 h-8 flex-shrink-0"});var B=d(O,2),J=o(B),ae=o(J,!0);t(J);var ie=d(J,2),W=o(ie,!0);t(ie),t(B);var xe=d(B,2);xe.__click=[br,ee,y],t(K),D((_e,E)=>{_(ae,_e),_(W,E)},[()=>e(P)?.displayName||e(P)?.name||`${y.slice(0,8)}...`,()=>e(P)?.nip05||`${y.slice(0,16)}...`]),b(N,K)}),t(w),t(v),D(()=>_(H,`Selected Members (${e(l).size??""})`)),b(c,v)};T(p,c=>{e(l).size>0&&c(G)})}t(L),se(R,()=>e(a),c=>s(a,c)),b(x,L)};T(Re,x=>{e(g)==="details"?x(Ve):x(Ke,!1)})}t(Fe),Le(2),t(j),t(n),er(n,x=>rr?.(x)),D(x=>{fe.disabled=e(m),_(De,` ${r.editingPack?"Edit Follow Pack":"Create Follow Pack"}`),re.disabled=x,_(Te,e(m)?r.editingPack?"Updating...":"Creating...":r.editingPack?"Update Pack":"Create Pack"),de(be,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(g)==="details"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),de(te,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(g)==="members"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),_(Ie,`Members (${e(l).size??""})`)},[()=>!e(F).trim()||e(l).size===0||e(m)]),b(i,n)};T(Ee,i=>{u()&&i(Ae)})}b(f,Pe),Je()}Oe(["click","keydown"]);export{Sr as C};
