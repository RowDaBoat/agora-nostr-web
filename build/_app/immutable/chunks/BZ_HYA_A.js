import{d as F,c as R,a as _,f as I}from"./CiPFrJr-.js";import{p as S,a as M,g as e,b as m,f as T,c as D,e as O,r as P,s as r,x,u as y}from"./CSbKtK4P.js";import{p as j,i as w}from"./87vUJtvC.js";import{b as q}from"./I2MJeYPS.js";var A=I('<div class="inline-block w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>'),B=I('<button class="px-4 py-2 text-muted-foreground hover:text-muted-foreground transition-colors">Load more</button>'),H=I('<div class="p-4 text-center"><!></div>');function U(E,o){S(o,!0);const p=j(o,"isLoading",3,!1);let d=m(void 0);M(()=>{if(!e(d))return;const t=new IntersectionObserver(n=>{n[0].isIntersecting&&o.hasMore&&!p()&&o.onIntersect()},{rootMargin:"200px",threshold:.1});return t.observe(e(d)),()=>{t.unobserve(e(d))}});var b=R(),u=T(b);{var i=t=>{var n=H(),s=O(n);{var f=a=>{var c=A();_(a,c)},v=a=>{var c=B();c.__click=function(...L){o.onIntersect?.apply(this,L)},_(a,c)};w(s,a=>{p()?a(f):a(v,!1)})}P(n),q(n,a=>r(d,a),()=>e(d)),_(t,n)};w(u,t=>{o.hasMore&&t(i)})}_(E,b),D()}F(["click"]);function V(E,o,p={}){const{initialLimit:d=20,pageSize:b=20}=p;let u=E.$subscribe(o),i=m(x(d)),t=m(x([])),n=m(!1),s=m(x([]));const f=new Set;let v=0;M(()=>{const g=u.events;if(!e(n)&&u.eosed)r(t,[...g],!0),r(n,!0),g.forEach(l=>{f.add(l.id),l.created_at&&l.created_at>v&&(v=l.created_at)});else if(!e(n))r(t,[...g],!0);else if(e(n)){const l=g.filter(h=>!f.has(h.id)&&h.created_at&&h.created_at>v);l.length>0&&(r(s,[...l,...e(s)],!0),l.forEach(h=>f.add(h.id)))}});const a=y(()=>e(t).slice(0,e(i))),c=y(()=>e(i)<e(t).length),L=y(()=>!u.eosed);function C(){e(c)&&r(i,Math.min(e(i)+b,e(t).length),!0)}function z(){if(e(s).length>0){const g=e(s).length;r(t,[...e(s),...e(t)],!0),r(s,[],!0),r(i,e(i)+g)}}let k=!0;return M(()=>{if(o(),k){k=!1;return}r(i,d,!0),r(t,[],!0),r(n,!1),r(s,[],!0),f.clear(),v=0}),{get events(){return e(a)},get allEvents(){return e(t)},get pendingEvents(){return e(s)},get hasMore(){return e(c)},get isLoading(){return e(L)},get eosed(){return u.eosed},get count(){return u.count},get totalCount(){return e(t).length},get visibleCount(){return e(a).length},get pendingCount(){return e(s).length},loadMore:C,loadPendingEvents:z}}export{U as L,V as c};
